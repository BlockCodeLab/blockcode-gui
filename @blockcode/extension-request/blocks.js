import{Text as N} from"@blockcode/ui";var A={en:{"extension.request.name":"Request","extension.request.request":"send [MOTHOD] request to [URL]","extension.request.getText":"text content","extension.request.getContent":"item [PATH] of content","extension.request.clearCache":"clear request cache","extension.request.whenResponds":"when a site responds","extension.request.whenFails":"when a request fails","extension.request.statusCode":"status code","extension.request.isResponds":"site responds?","extension.request.setHeader":"set headers [HEADER] to [VALUE]","extension.request.setContentType":"set content type to [CONTENTTYPE]","extension.request.setBody":"set body [KEY] to [VALUE]","extension.request.setForm":"set request body to a form"},"zh-Hans":{"extension.request.name":"\u6570\u636E\u8BF7\u6C42","extension.request.request":"\u7528 [MOTHOD] \u65B9\u6CD5\u4ECE [URL] \u8BF7\u6C42\u6570\u636E","extension.request.getText":"\u6570\u636E\u6587\u672C\u5185\u5BB9","extension.request.getContent":"\u6570\u636E\u4E2D\u8DEF\u5F84 [PATH] \u7684\u9879\u76EE","extension.request.clearCache":"\u6E05\u9664\u6570\u636E\u8BF7\u6C42\u7F13\u5B58","extension.request.whenResponds":"\u5F53\u7F51\u7AD9\u5E94\u7B54","extension.request.whenFails":"\u5F53\u8BF7\u6C42\u5931\u8D25","extension.request.statusCode":"\u5E94\u7B54\u72B6\u6001\u7801","extension.request.isResponds":"\u7F51\u7AD9\u6709\u5E94\u7B54\uFF1F","extension.request.setHeader":"\u5C06\u6807\u5934\u4FE1\u606F [HEADER] \u8BBE\u4E3A [VALUE]","extension.request.setContentType":"\u5C06\u5185\u5BB9\u7C7B\u578B\u8BBE\u4E3A [CONTENTTYPE]","extension.request.setBody":"\u5C06\u8BF7\u6C42\u53C2\u6570 [KEY] \u8BBE\u4E3A [VALUE]"}};var E="./assets/icon-009605474af8dbd1.svg";var f="./assets/request-e3e549b9eb5ecf07.py";var R=function(){return this.definitions_.request_response="runtime.data['request_response'] = null;",this.provideFunction_("request_get_content",[`const ${this.FUNCTION_NAME_PLACEHOLDER_} = async (path) => {`,"  const res = runtime.data['request_response']","  if (!res) return '';","  let result = await res.json();","  if (!result) return '';","  const indexPath = path.split('.');","  for (const index of indexPath) {","    result = Array.isArray(result) ? result.at(+index - 1) : result[index];","    if (result !== 0 && !result) return '';","  }","  return result;","};"])},S=function(){return this.definitions_.request_response="runtime.data['request_response'] = null;",this.provideFunction_("request_get_text",[`const ${this.FUNCTION_NAME_PLACEHOLDER_} = async (path) => {`,"  const res = runtime.data['request_response']","  if (!res) return '';","  return await res.text();","};"])},$=function(){return this.definitions_.request_option="runtime.data['request_option'] = {};",this.provideFunction_("request_fetch",[`const ${this.FUNCTION_NAME_PLACEHOLDER_} = (method, url) => {`,"  const option = {","    ...runtime.data['request_option'],","    method: method,","  };","  if ((option.method !== 'GET' || option.method !== 'HEAD') && option.body) {","    option.body = JSON.stringify(option.body);","  }","  fetch(url, option).then((res) => {","    runtime.data['request_response'] = res;","    runtime.fire('request_success');","  }).catch(() => {","    runtime.fire('request_fails');","  });","};"])};import{jsx as O} from"preact/jsx-runtime";var Y={iconURI:E,name:O(N,{id:"extension.request.name",defaultMessage:"Request"}),files:[{name:"request",type:"text/x-python",uri:f}],blocks:[{id:"request",text:O(N,{id:"extension.request.request",defaultMessage:"request content [MOTHOD] to [URL]"}),inputs:{MOTHOD:{type:"string",default:"GET",menu:[["GET","GET"],["POST","POST"],["PUT","PUT"],["PATCH","PATCH"],["DELETE","DELETE"],["HEAD","HEAD"],["OPTIONS","OPTIONS"]]},URL:{type:"string",default:"https://make.blockcode.fun/hello.txt"}},python(s){this.definitions_.import_extension_request="from extensions.request import request";let i="";if(this.STATEMENT_PREFIX)i+=this.injectId(this.STATEMENT_PREFIX,s);const r=this.quote_(s.getFieldValue("MOTHOD")||"GET"),_=this.valueToCode(s,"URL",this.ORDER_NONE)||'""';return i+=`request.fetch(str(${r}), str(${_}))\n`,i},vm(s){let i="";if(this.STATEMENT_PREFIX)i+=this.injectId(this.STATEMENT_PREFIX,s);const r=$.call(this),_=this.quote_(s.getFieldValue("MOTHOD")||"GET"),a=this.valueToCode(s,"URL",this.ORDER_NONE)||'""';return i+=`${r}(String(${_}), String(${a}))`,i}},{id:"clear_cache",text:O(N,{id:"extension.request.clearCache",defaultMessage:"clear request cache"}),python(){this.definitions_.import_extension_request="from extensions.request import request";let s="";if(this.STATEMENT_PREFIX)s+=this.injectId(this.STATEMENT_PREFIX,block);return s+="request.clear_cache()\n",s},vm(){this.definitions_.request_option="runtime.data['request_option'] = {};",this.definitions_.request_response="runtime.data['request_response'] = null;";let s="";if(this.STATEMENT_PREFIX)s+=this.injectId(this.STATEMENT_PREFIX,block);return s+="runtime.data['request_option'] = {};\n",s+="runtime.data['request_response'] = null;\n",s}},{id:"get_content",text:O(N,{id:"extension.request.getContent",defaultMessage:"item [PATH] of content"}),inputs:{PATH:{type:"string",default:"path.2.item"}},output:"string",python(s){return this.definitions_.import_extension_request="from extensions.request import request",[`request.get_content(${this.valueToCode(s,"PATH",this.ORDER_NONE)||'""'})`,this.ORDER_FUNCTION_CALL]},vm(s){this.definitions_.request_response="runtime.data['request_response'] = null;";const i=R.call(this),r=this.valueToCode(s,"PATH",this.ORDER_NONE)||'""';return[`(await ${i}(${r}))`,this.ORDER_FUNCTION_CALL]}},{id:"get_text",text:O(N,{id:"extension.request.getText",defaultMessage:"text content"}),output:"string",python(){return this.definitions_.import_extension_request="from extensions.request import request",["request.get_content()",this.ORDER_FUNCTION_CALL]},vm(){return this.definitions_.request_response="runtime.data['request_response'] = null;",[`(await ${S.call(this)}())`,this.ORDER_FUNCTION_CALL]}},"---",{id:"when_responds",text:O(N,{id:"extension.request.whenResponds",defaultMessage:"when a site responds"}),hat:!0,python(){return this.definitions_.import_extension_request="from extensions.request import request",`${this.hatToCode("request_success","target")}runtime.when(request.REQUEST_SUCCESS, ${this.HAT_FUNCTION_PLACEHOLDER}, target)\n`},vm(){return`runtime.when('request_success', ${`async (target, done) => {\ndo {\n${this.HAT_CODE}} while (false);\ndone();\n}`}, target);\n`}},{id:"when_fails",text:O(N,{id:"extension.request.whenFails",defaultMessage:"when a request fails"}),hat:!0,python(){return this.definitions_.import_extension_request="from extensions.request import request",`${this.hatToCode("request_fails")}runtime.when(request.REQUEST_FAILS, ${this.HAT_FUNCTION_PLACEHOLDER})\n`},vm(){return`runtime.when('request_fails', ${`async (done) => {\ndo {\n${this.HAT_CODE}} while (false);\ndone();\n}`});\n`}},{id:"is_responds",text:O(N,{id:"extension.request.isResponds",defaultMessage:"site responds?"}),output:"boolean",python(){return this.definitions_.import_extension_request="from extensions.request import request",["bool(request.response)",this.ORDER_FUNCTION_CALL]},vm(){return this.definitions_.request_response="runtime.data['request_response'] = null;",["Boolean(runtime.data['request_response'])",this.ORDER_FUNCTION_CALL]}},{id:"status_code",text:O(N,{id:"extension.request.statusCode",defaultMessage:"status code"}),output:"number",python(){return this.definitions_.import_extension_request="from extensions.request import request",["(request.response.status if request.response else 0)",this.ORDER_FUNCTION_CALL]},vm(){return this.definitions_.request_response="runtime.data['request_response'] = null;",["(runtime.data['request_response'] ? runtime.data['request_response'].status : 0)",this.ORDER_FUNCTION_CALL]}},"---",{id:"set_content_type",text:O(N,{id:"extension.request.setContentType",defaultMessage:"set content type to [CONTENTTYPE]"}),inputs:{CONTENTTYPE:{type:"string",default:"text/plain",menu:[["application/json","application/json"],["text/plain","text/plain"]]}},python(s){this.definitions_.import_extension_request="from extensions.request import request";let i="";if(this.STATEMENT_PREFIX)i+=this.injectId(this.STATEMENT_PREFIX,s);const r=this.quote_(s.getFieldValue("CONTENTTYPE")||"text/plain");return i+=`request.set_header('Content-Type', str(${r}))\n`,i},vm(s){this.definitions_.request_option="runtime.data['request_option'] = {};",this.definitions_.request_option_headers="runtime.data['request_option']['headers'] = {};";let i="";if(this.STATEMENT_PREFIX)i+=this.injectId(this.STATEMENT_PREFIX,s);const r=this.quote_(s.getFieldValue("CONTENTTYPE")||"text/plain");return i+=`runtime.data['request_option']['headers']['Content-Type'] = ${r};\n`,i}},{id:"set_header",text:O(N,{id:"extension.request.setHeader",defaultMessage:"set headers [HEADER] to [VALUE]"}),inputs:{HEADER:{type:"string",default:"Content-Type"},VALUE:{type:"string",default:"text/plain"}},python(s){this.definitions_.import_extension_request="from extensions.request import request";let i="";if(this.STATEMENT_PREFIX)i+=this.injectId(this.STATEMENT_PREFIX,s);const r=this.valueToCode(s,"HEADER",this.ORDER_NONE)||'""',_=this.valueToCode(s,"VALUE",this.ORDER_NONE)||'""';return i+=`request.set_header(str(${r}), str(${_}))\n`,i},vm(s){this.definitions_.request_option="runtime.data['request_option'] = {};",this.definitions_.request_option_headers="runtime.data['request_option']['headers'] = {};";let i="";if(this.STATEMENT_PREFIX)i+=this.injectId(this.STATEMENT_PREFIX,s);const r=this.valueToCode(s,"HEADER",this.ORDER_NONE)||'""',_=this.valueToCode(s,"VALUE",this.ORDER_NONE)||'""';return i+=`runtime.data['request_option']['headers'][${r}] = ${_};\n`,i}},{id:"set_body",text:O(N,{id:"extension.request.setBody",defaultMessage:"set body [KEY] to [VALUE]"}),inputs:{KEY:{type:"string",default:"key"},VALUE:{type:"string",default:"value"}},python(s){this.definitions_.import_extension_request="from extensions.request import request";let i="";if(this.STATEMENT_PREFIX)i+=this.injectId(this.STATEMENT_PREFIX,s);const r=this.valueToCode(s,"KEY",this.ORDER_NONE)||'""',_=this.valueToCode(s,"VALUE",this.ORDER_NONE)||'""';return i+=`request.set_header(str(${r}), str(${_}))\n`,i},vm(s){this.definitions_.request_option="runtime.data['request_option'] = {};",this.definitions_.request_option_headers="runtime.data['request_option']['body'] = {};";let i="";if(this.STATEMENT_PREFIX)i+=this.injectId(this.STATEMENT_PREFIX,s);const r=this.valueToCode(s,"KEY",this.ORDER_NONE)||'""',_=this.valueToCode(s,"VALUE",this.ORDER_NONE)||'""';return i+=`runtime.data['request_option']['body'][${r}] = ${_};\n`,i}}],translations:A};export{Y as default};
