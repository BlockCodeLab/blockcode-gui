import"@blockcode/aisdks";import{Text as n}from"@blockcode/ui";var l={en:{"extension.translate.name":"Translate","extension.translate.openplatform":"iFLYTEK Open Platform authorization","extension.translate.openplatform.description1":"Please register your own ","extension.translate.openplatform.description2":"iFLYTEK Open Platform (Chinese)","extension.translate.openplatform.description3":" account, the test account we provide does not guarantee that every","extension.translate.translate":"translate [WORDS] to [LANGUAGE]","extension.translate.hello":"hello","extension.translate.english":"English","extension.translate.chinese.simplified":"Chinese (Simplified)","extension.translate.chinese.traditional":"Chinese (Traditional)","extension.translate.japanese":"Japanese","extension.translate.languageOf":"language of [WORDS]","extension.translate.language":"language"},"zh-Hans":{"extension.translate.name":"翻译","extension.translate.openplatform":"讯飞开放平台认证信息","extension.translate.openplatform.description1":"请注册您自己的","extension.translate.openplatform.description2":"讯飞开放平台","extension.translate.openplatform.description3":"账号，我们提供的测试账号不保证每次请求都成功。","extension.translate.translate":"将 [WORDS] 译为 [LANGUAGE]","extension.translate.hello":"你好","extension.translate.english":"英文","extension.translate.chinese.simplified":"简体中文","extension.translate.chinese.traditional":"繁体中文","extension.translate.japanese":"日文","extension.translate.languageOf":"识别 [WORDS] 的语言","extension.translate.language":"访客语言"}};var f="./assets/icon-bf4kf31b.png";var g="./assets/translate-zrngtnkd.py";import{jsx as e,jsxs as u,Fragment as E}from"preact/jsx-runtime";var M={iconURI:f,name:e(n,{id:"extension.translate.name",defaultMessage:"Translate"}),files:[{name:"translate",type:"text/x-python",uri:g}],statusButton:{title:e(n,{id:"extension.translate.openplatform",defaultMessage:"iFLYTEK Open Platform authorization"}),storage:[{id:"sparkai.appid",text:"APPID"},{id:"sparkai.apisecret",text:"APISecret"},{id:"sparkai.apikey",text:"APIKey"}],description:u(E,{children:[e(n,{id:"extension.translate.openplatform.description1",defaultMessage:"Please register your own "}),e("a",{href:"https://xinghuo.xfyun.cn/sparkapi",target:"_blank",children:e(n,{id:"extension.translate.openplatform.description2",defaultMessage:"iFLYTEK Open Platform (Chinese)"})}),e(n,{id:"extension.translate.openplatform.description3",defaultMessage:" account, the test account we provide does not guarantee that every request will be successful."})]})},blocks:[{id:"translate",text:e(n,{id:"extension.translate.translate",defaultMessage:"translate [WORDS] to [LANGUAGE]"}),output:"string",inputs:{WORDS:{type:"string",default:e(n,{id:"extension.translate.hello",defaultMessage:"hello"})},LANGUAGE:{type:"string",default:"英语",menu:[[e(n,{id:"extension.translate.english",defaultMessage:"English"}),"英语"],[e(n,{id:"extension.translate.chinese.simplified",defaultMessage:"Chinese (Simplified)"}),"简体中文"],[e(n,{id:"extension.translate.chinese.traditional",defaultMessage:"Chinese (Traditional)"}),"繁体中文"],[e(n,{id:"extension.translate.japanese",defaultMessage:"Japanese"}),"日语"]]}},python(a){this.definitions_.translate_translate="from extensions.translate import translate";let s=localStorage.getItem("sparkai.apikey"),t=localStorage.getItem("sparkai.apisecret"),i=s&&t?`, key="${s}", secret="${t}"`:"",r=this.valueToCode(a,"WORDS",this.ORDER_NONE)||'""',o=this.quote_(a.getFieldValue("LANGUAGE")||"英文");return[`(await translate.translate(str(${r}), ${o} ${i}))`,this.ORDER_FUNCTION_CALL]},vm(a){let s=m.call(this),t=this.valueToCode(a,"WORDS",this.ORDER_NONE)||'""',i=this.quote_(a.getFieldValue("LANGUAGE")||"英文");return[`(await ${s}(String(${t}), ${i}))`,this.ORDER_FUNCTION_CALL]}},{id:"languageOf",text:e(n,{id:"extension.translate.languageOf",defaultMessage:"language of [WORDS]"}),output:"string",inputs:{WORDS:{type:"string",default:e(n,{id:"extension.translate.hello",defaultMessage:"hello"})}},python(a){this.definitions_.translate_translate="from extensions.translate import translate";let s=localStorage.getItem("sparkai.apikey"),t=localStorage.getItem("sparkai.apisecret"),i=s&&t?`, key="${s}", secret="${t}"`:"";return[`(await translate.translate(str(${this.valueToCode(a,"WORDS",this.ORDER_NONE)||'""'}) ${i}))`,this.ORDER_FUNCTION_CALL]},vm(a){let s=m.call(this),t=this.valueToCode(a,"WORDS",this.ORDER_NONE)||'""';return[`(await ${s}(String(${t})))`,this.ORDER_FUNCTION_CALL]}},{id:"language",text:e(n,{id:"extension.translate.language",defaultMessage:"language"}),output:"string",python(){return this.definitions_.translate_translate="from extensions.translate import translate",["translate.language_name()",this.ORDER_FUNCTION_CALL]},vm(){return[`${d.call(this)}()`,this.ORDER_FUNCTION_CALL]}}],translations:l};function d(){return this.provideFunction_("translate_language",[`const ${this.FUNCTION_NAME_PLACEHOLDER_} = (i = 0) => {`,"  switch(runtime.language) {","    case 'en': return ['English', '英语'][i];","    case 'jp': return ['日本語', '日语'][i];","    case 'zh-Hans': return ['简体中文', '简体中文'][i];","    default: return ['English', '英语'][i];","  }","};"])}function m(){let a=d.call(this);return this.provideFunction_("translate_translate",[`const ${this.FUNCTION_NAME_PLACEHOLDER_} = async (content, language) => {`,"  if (!content) return '';","  let message = await window.ai.askSpark([{","    role: 'user', ",'    content: language ? `把"${content}"翻译为${language}。` : `"${content}"是什么语言？`,',"  }]);","  if (language) {",'    const matches = /("[^"]*"[^"“「]*)?["“「]([^"”」]*)["”」]/.exec(message);',"    if (matches) {","      message = matches[2];","    } else {","      let i = message.lastIndexOf('(');","      i = i === -1 ?? message.lastIndexOf('（');","      message = i === -1 ? message : message.slice(0, i);","    }","  } else {","    if (message.match(/不是[^语]*[语文]/)) return '';","    const matches = /是([^语]*[语文])/.exec(message);","    if (!matches) return '';","    message = matches[1];","    if (runtime.language !== 'zh-Hans') {",`      language = ${a}(1);`,`      message = await ${this.FUNCTION_NAME_PLACEHOLDER_}(message, language);`,"    }","  }","  return message;","};"])}export{M as default};
