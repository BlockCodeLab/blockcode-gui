import"@blockcode/aisdks";import{Text as n}from"@blockcode/ui";var o={en:{"extension.brain.name":"Brain","extension.brain.openplatform":"iFLYTEK Open Platform authorization","extension.brain.openplatform.description1":"Please register your own ","extension.brain.openplatform.description2":"iFLYTEK Open Platform (Chinese)","extension.brain.openplatform.description3":" account, the test account we provide does not guarantee that every request will be successful.","extension.brain.addPrompt":"add prompt [PROMPT] to Brain","extension.brain.prompt":"your role is a cat","extension.brain.clearPrompt":"delete all prompts","extension.brain.askQuestion":"ask Brain [QUESTION] and wait","extension.brain.question":"who are you","extension.brain.answer":"answer"},"zh-Hans":{"extension.brain.name":"\u667A\u8111","extension.brain.openplatform":"\u8BAF\u98DE\u5F00\u653E\u5E73\u53F0\u8BA4\u8BC1\u4FE1\u606F","extension.brain.openplatform.description1":"\u8BF7\u6CE8\u518C\u60A8\u81EA\u5DF1\u7684","extension.brain.openplatform.description2":"\u8BAF\u98DE\u5F00\u653E\u5E73\u53F0","extension.brain.openplatform.description3":"\u8D26\u53F7\uFF0C\u6211\u4EEC\u63D0\u4F9B\u7684\u6D4B\u8BD5\u8D26\u53F7\u4E0D\u4FDD\u8BC1\u6BCF\u6B21\u8BF7\u6C42\u90FD\u6210\u529F\u3002","extension.brain.addPrompt":"\u5C06\u6307\u4EE4\u8BF4\u660E [PROMPT] \u52A0\u5165\u667A\u8111","extension.brain.prompt":"\u4F60\u7684\u89D2\u8272\u662F\u4E00\u53EA\u5C0F\u732B","extension.brain.clearPrompt":"\u5220\u9664\u6240\u6709\u6307\u4EE4\u8BF4\u660E","extension.brain.askQuestion":"\u8BE2\u95EE\u667A\u8111 [QUESTION] \u5E76\u7B49\u5F85","extension.brain.question":"\u4F60\u662F\u8C01","extension.brain.answer":"\u56DE\u7B54"}};var d="./assets/icon-xdp12efg.svg";var p="./assets/brain-jjqe2f76.py";function c(){return this.definitions_.brain_brains="runtime.data['brain_brains'] = {};",this.provideFunction_("brain_add_prompt",[`const ${this.FUNCTION_NAME_PLACEHOLDER_} = (id, prompt) => {`,"  if (!prompt) return;","  if (!runtime.data['brain_brains'][id]) {","    runtime.data['brain_brains'][id] = {};","  }","  if (!runtime.data['brain_brains'][id].prompts) {","    runtime.data['brain_brains'][id].prompts = [];","  }","  runtime.data['brain_brains'][id].prompts.push(prompt.replaceAll('\u3002', '\uFF1B').replace(/\uFF1B$/, ''));","};"])}function f(){return this.definitions_.brain_brains="runtime.data['brain_brains'] = {};",this.provideFunction_("brain_clear_prompt",[`const ${this.FUNCTION_NAME_PLACEHOLDER_} = (id) => {`,"  if (!runtime.data['brain_brains'][id]) {","    runtime.data['brain_brains'][id] = {};","  }","  runtime.data['brain_brains'][id].prompt = [];","};"])}function b(){return this.provideFunction_("brain_language",[`const ${this.FUNCTION_NAME_PLACEHOLDER_} = () => {`,"  switch(runtime.language) {","    case 'en': return '\u82F1\u8BED';","    case 'jp': return '\u65E5\u8BED';","    case 'zh-Hans': return '\u7B80\u4F53\u4E2D\u6587';","    default: return '\u82F1\u8BED';","  }","};"])}function g(){this.definitions_.brain_brains="runtime.data['brain_brains'] = {};";const i=b.call(this);return this.provideFunction_("brain_ask_question",[`const ${this.FUNCTION_NAME_PLACEHOLDER_} = async (id, content) => {`,"  if (!content) return;","  if (!runtime.data['brain_brains'][id]) {","    runtime.data['brain_brains'][id] = {};","  }",`  const language = ${i}();`,"  const prompts = runtime.data['brain_brains'][id].prompts || [];","  const dialogs = runtime.data['brain_brains'][id].dialogs || [];","  runtime.data['brain_brains'][id].dialogs = dialogs",`  if (dialogs.length > ${C}) dialogs.shift();`,"  dialogs.push({ role: 'user', content: content });","  runtime.data['brain_brains'][id].message = '';","  const message = await window.ai.askSpark([","    { role: 'system', content: `${prompts.join('\uFF1B')}\u3002\u8BF7\u7528${language}\u56DE\u7B54\uFF0C\u6BCF\u6B21\u53EA\u56DE\u7B54\u4E00\u53E5\u8BDD\u3002` },","    ...dialogs,","  ]);","  if (!message) return;","  runtime.data['brain_brains'][id].message = message;",`  if (dialogs.length > ${C}) dialogs.shift();`,"  dialogs.push({ role: 'assistant', content: message });","};"])}import{jsx as e,jsxs as h,Fragment as _}from"preact/jsx-runtime";var C=3,k={iconURI:d,name:e(n,{id:"extension.brain.name",defaultMessage:"Brain"}),files:[{name:"brain",type:"text/x-python",uri:p}],statusButton:{title:e(n,{id:"extension.brain.openplatform",defaultMessage:"iFLYTEK Open Platform authorization"}),storage:[{id:"sparkai.appid",text:"APPID"},{id:"sparkai.apisecret",text:"APISecret"},{id:"sparkai.apikey",text:"APIKey"}],description:h(_,{children:[e(n,{id:"extension.brain.openplatform.description1",defaultMessage:"Please register your own "}),e("a",{href:"https://xinghuo.xfyun.cn/sparkapi",target:"_blank",children:e(n,{id:"extension.brain.openplatform.description2",defaultMessage:"iFLYTEK Open Platform (Chinese)"})}),e(n,{id:"extension.brain.openplatform.description3",defaultMessage:" account, the test account we provide does not guarantee that every request will be successful."})]})},blocks:[{id:"addPrompt",text:e(n,{id:"extension.brain.addPrompt",defaultMessage:"add [PROMPT] prompt to Brain"}),inputs:{PROMPT:{type:"string",default:e(n,{id:"extension.brain.prompt",defaultMessage:"your role is a cat"})}},vm(i){let t="";if(this.STATEMENT_PREFIX)t+=this.injectId(this.STATEMENT_PREFIX,i);const a=c.call(this),r=this.valueToCode(i,"PROMPT",this.ORDER_NONE)||"";return t+=`${a}(target.id, String(${r}));\n`,t},python(i){this.definitions_.import_extension_brain="from extensions.brain import brain";let t="";if(this.STATEMENT_PREFIX)t+=this.injectId(this.STATEMENT_PREFIX,i);const a=this.valueToCode(i,"PROMPT",this.ORDER_NONE)||"";return t+=`brain.set_prompt(target.id, str(${a}))\n`,t}},{id:"clearPrompt",text:e(n,{id:"extension.brain.clearPrompt",defaultMessage:"delete all prompts"}),vm(i){let t="";if(this.STATEMENT_PREFIX)t+=this.injectId(this.STATEMENT_PREFIX,i);const a=f.call(this);return t+=`${a}(target.id);\n`,t},python(i){this.definitions_.import_extension_brain="from extensions.brain import brain";let t="";if(this.STATEMENT_PREFIX)t+=this.injectId(this.STATEMENT_PREFIX,i);return t+="brain.clear_prompt(target.id)\n",t}},{id:"askQuestion",text:e(n,{id:"extension.brain.askQuestion",defaultMessage:"ask Brain [QUESTION] and wait"}),inputs:{QUESTION:{type:"string",default:e(n,{id:"extension.brain.question",defaultMessage:"Who are you?"})}},vm(i){this.definitions_.brain_brains="runtime.data['brain_brains'] = {};";let t="";if(this.STATEMENT_PREFIX)t+=this.injectId(this.STATEMENT_PREFIX,i);const a=g.call(this,3),r=this.valueToCode(i,"QUESTION",this.ORDER_NONE)||0;return t+=`await ${a}(target.id, String(${r}))\n`,t},python(i){this.definitions_.import_extension_brain="from extensions.brain import brain";const t=localStorage.getItem("sparkai.apikey"),a=localStorage.getItem("sparkai.apisecret"),r=t&&a?`, key="${t}", secret="${a}"`:"";let s="";if(this.STATEMENT_PREFIX)s+=this.injectId(this.STATEMENT_PREFIX,i);const l=this.valueToCode(i,"QUESTION",this.ORDER_NONE)||'""';return s+=`await brain.ask(target.id, str(${l}) ${r})\n`,s}},{id:"answer",text:e(n,{id:"extension.brain.answer",defaultMessage:"answer"}),output:"string",vm(){return this.definitions_.brain_brains="runtime.data['brain_brains'] = {};",["(runtime.data['brain_brains'][target.id]?.message ?? '')",this.ORDER_ATOMIC]},python(){return this.definitions_.import_extension_brain="from extensions.brain import brain",["brain.answer(target.id)",this.ORDER_FUNCTION_CALL]}}],translations:o};export{k as default};
