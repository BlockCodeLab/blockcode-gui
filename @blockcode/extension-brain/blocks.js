import"@blockcode/aisdks";import{Text as n}from"@blockcode/ui";var o={en:{"extension.brain.name":"Brain","extension.brain.openplatform":"iFLYTEK Open Platform authorization","extension.brain.openplatform.description1":"Please register your own ","extension.brain.openplatform.description2":"iFLYTEK Open Platform (Chinese)","extension.brain.openplatform.description3":" account, the test account we provide does not guarantee that every request will be successful.","extension.brain.addPrompt":"add prompt [PROMPT] to Brain","extension.brain.prompt":"your role is a cat","extension.brain.clearPrompt":"delete all prompts","extension.brain.askQuestion":"ask Brain [QUESTION] and wait","extension.brain.question":"who are you","extension.brain.answer":"answer"},"zh-Hans":{"extension.brain.name":"智脑","extension.brain.openplatform":"讯飞开放平台认证信息","extension.brain.openplatform.description1":"请注册您自己的","extension.brain.openplatform.description2":"讯飞开放平台","extension.brain.openplatform.description3":"账号，我们提供的测试账号不保证每次请求都成功。","extension.brain.addPrompt":"将指令说明 [PROMPT] 加入智脑","extension.brain.prompt":"你的角色是一只小猫","extension.brain.clearPrompt":"删除所有指令说明","extension.brain.askQuestion":"询问智脑 [QUESTION] 并等待","extension.brain.question":"你是谁","extension.brain.answer":"回答"}};var d="./assets/icon-xdp12efg.svg";var p="./assets/brain-jjqe2f76.py";import{jsx as e,jsxs as h,Fragment as _}from"preact/jsx-runtime";var C=3,k={iconURI:d,name:e(n,{id:"extension.brain.name",defaultMessage:"Brain"}),files:[{name:"brain",type:"text/x-python",uri:p}],statusButton:{title:e(n,{id:"extension.brain.openplatform",defaultMessage:"iFLYTEK Open Platform authorization"}),storage:[{id:"sparkai.appid",text:"APPID"},{id:"sparkai.apisecret",text:"APISecret"},{id:"sparkai.apikey",text:"APIKey"}],description:h(_,{children:[e(n,{id:"extension.brain.openplatform.description1",defaultMessage:"Please register your own "}),e("a",{href:"https://xinghuo.xfyun.cn/sparkapi",target:"_blank",children:e(n,{id:"extension.brain.openplatform.description2",defaultMessage:"iFLYTEK Open Platform (Chinese)"})}),e(n,{id:"extension.brain.openplatform.description3",defaultMessage:" account, the test account we provide does not guarantee that every request will be successful."})]})},blocks:[{id:"addPrompt",text:e(n,{id:"extension.brain.addPrompt",defaultMessage:"add [PROMPT] prompt to Brain"}),inputs:{PROMPT:{type:"string",default:e(n,{id:"extension.brain.prompt",defaultMessage:"your role is a cat"})}},vm(i){let t="";if(this.STATEMENT_PREFIX)t+=this.injectId(this.STATEMENT_PREFIX,i);let a=c.call(this),r=this.valueToCode(i,"PROMPT",this.ORDER_NONE)||"";return t+=`${a}(target.id, String(${r}));
`,t},python(i){this.definitions_.import_extension_brain="from extensions.brain import brain";let t="";if(this.STATEMENT_PREFIX)t+=this.injectId(this.STATEMENT_PREFIX,i);let a=this.valueToCode(i,"PROMPT",this.ORDER_NONE)||"";return t+=`brain.set_prompt(target.id, str(${a}))
`,t}},{id:"clearPrompt",text:e(n,{id:"extension.brain.clearPrompt",defaultMessage:"delete all prompts"}),vm(i){let t="";if(this.STATEMENT_PREFIX)t+=this.injectId(this.STATEMENT_PREFIX,i);let a=f.call(this);return t+=`${a}(target.id);
`,t},python(i){this.definitions_.import_extension_brain="from extensions.brain import brain";let t="";if(this.STATEMENT_PREFIX)t+=this.injectId(this.STATEMENT_PREFIX,i);return t+=`brain.clear_prompt(target.id)
`,t}},{id:"askQuestion",text:e(n,{id:"extension.brain.askQuestion",defaultMessage:"ask Brain [QUESTION] and wait"}),inputs:{QUESTION:{type:"string",default:e(n,{id:"extension.brain.question",defaultMessage:"Who are you?"})}},vm(i){this.definitions_.brain_brains="runtime.data['brain_brains'] = {};";let t="";if(this.STATEMENT_PREFIX)t+=this.injectId(this.STATEMENT_PREFIX,i);let a=g.call(this,3),r=this.valueToCode(i,"QUESTION",this.ORDER_NONE)||0;return t+=`await ${a}(target.id, String(${r}))
`,t},python(i){this.definitions_.import_extension_brain="from extensions.brain import brain";let t=localStorage.getItem("sparkai.apikey"),a=localStorage.getItem("sparkai.apisecret"),r=t&&a?`, key="${t}", secret="${a}"`:"",s="";if(this.STATEMENT_PREFIX)s+=this.injectId(this.STATEMENT_PREFIX,i);let l=this.valueToCode(i,"QUESTION",this.ORDER_NONE)||'""';return s+=`await brain.ask(target.id, str(${l}) ${r})
`,s}},{id:"answer",text:e(n,{id:"extension.brain.answer",defaultMessage:"answer"}),output:"string",vm(){return this.definitions_.brain_brains="runtime.data['brain_brains'] = {};",["(runtime.data['brain_brains'][target.id]?.message ?? '')",this.ORDER_ATOMIC]},python(){return this.definitions_.import_extension_brain="from extensions.brain import brain",["brain.answer(target.id)",this.ORDER_FUNCTION_CALL]}}],translations:o};function c(){return this.definitions_.brain_brains="runtime.data['brain_brains'] = {};",this.provideFunction_("brain_add_prompt",[`const ${this.FUNCTION_NAME_PLACEHOLDER_} = (id, prompt) => {`,"  if (!prompt) return;","  if (!runtime.data['brain_brains'][id]) {","    runtime.data['brain_brains'][id] = {};","  }","  if (!runtime.data['brain_brains'][id].prompts) {","    runtime.data['brain_brains'][id].prompts = [];","  }","  runtime.data['brain_brains'][id].prompts.push(prompt.replaceAll('。', '；').replace(/；$/, ''));","};"])}function f(){return this.definitions_.brain_brains="runtime.data['brain_brains'] = {};",this.provideFunction_("brain_clear_prompt",[`const ${this.FUNCTION_NAME_PLACEHOLDER_} = (id) => {`,"  if (!runtime.data['brain_brains'][id]) {","    runtime.data['brain_brains'][id] = {};","  }","  runtime.data['brain_brains'][id].prompt = [];","};"])}function b(){return this.provideFunction_("brain_language",[`const ${this.FUNCTION_NAME_PLACEHOLDER_} = () => {`,"  switch(runtime.language) {","    case 'en': return '英语';","    case 'jp': return '日语';","    case 'zh-Hans': return '简体中文';","    default: return '英语';","  }","};"])}function g(){this.definitions_.brain_brains="runtime.data['brain_brains'] = {};";let i=b.call(this);return this.provideFunction_("brain_ask_question",[`const ${this.FUNCTION_NAME_PLACEHOLDER_} = async (id, content) => {`,"  if (!content) return;","  if (!runtime.data['brain_brains'][id]) {","    runtime.data['brain_brains'][id] = {};","  }",`  const language = ${i}();`,"  const prompts = runtime.data['brain_brains'][id].prompts || [];","  const dialogs = runtime.data['brain_brains'][id].dialogs || [];","  runtime.data['brain_brains'][id].dialogs = dialogs",`  if (dialogs.length > ${C}) dialogs.shift();`,"  dialogs.push({ role: 'user', content: content });","  runtime.data['brain_brains'][id].message = '';","  const message = await window.ai.askSpark([","    { role: 'system', content: `${prompts.join('；')}。请用${language}回答，每次只回答一句话。` },","    ...dialogs,","  ]);","  if (!message) return;","  runtime.data['brain_brains'][id].message = message;",`  if (dialogs.length > ${C}) dialogs.shift();`,"  dialogs.push({ role: 'assistant', content: message });","};"])}export{k as default};
