var a5=Object.defineProperty;var V5=(m,s)=>{for(var C in s)a5(m,C,{get:s[C],enumerable:!0,configurable:!0,set:(a)=>s[C]=()=>a})};import{Text as D8} from"@blockcode/ui";import{Keys as e0} from"@blockcode/core";import{Text as T0,Spinner as R5} from"@blockcode/ui";import{ScratchBlocks as O5} from"@blockcode/blocks-editor";import{Serial as A5,sleep as i8} from"@blockcode/core";var e5=function(m,s){return new Promise((C)=>{const a=new Image;a.src=`data:${m};base64,${s}`,a.addEventListener("load",async()=>{const D=new OffscreenCanvas(a.width,a.height).getContext("2d",{willReadFrequently:!0});D.drawImage(a,0,0);const F=[];for(let T=0;T<a.height;T++)for(let k=0;k<a.width;k++){const[$,U,I0,t0]=D.getImageData(k,T,1,1).data,p0=t0===0?0:q5($,U,I0);F.push(p0>>8&255),F.push(p0&255)}C(Uint8Array.from(F))})})},o8=function(m){return m.replaceAll("\r\n","\n")},B8=function(m){return m.slice(2,-3)},E5="\x01",z8="\x02",u8="\x03",h8="\x04",k8=128;class _8{constructor(){this.serial=null,this._connected=!1,this._encoder=new TextEncoder,this._decoder=new TextDecoder}requestPort(m=[]){return navigator.serial.requestPort({filters:m}).then((s)=>{this.serial=new A5(s),this.serial.on("connect",()=>this._connected=!0),this.serial.on("disconnect",()=>this._connected=!1)})}connect(m={}){return new Promise((s,C)=>{if(this.serial)this.serial.open({baudRate:115200,...m}).then(s).catch(C);else C(new Error("No device specified"))})}get connected(){return this._connected}disconnect(){return this.serial.close()}get deviceInfo(){return this.serial.getInfo()}readUntil(m,s){return new Promise((C)=>{let a="";const D=async(F)=>{if(F){if(a+=this._decoder.decode(F),s)s(F)}if(a.indexOf(m)!==-1)this.serial.off("data",D),C(a)};this.serial.on("data",D)})}writeAndReadUntil(m,s,C){return new Promise(async(a)=>{if(s)this.readUntil(s,C).then(a);for(let D=0;D<m.length;D+=k8)await this.serial.write(m.slice(D,D+k8)),await i8(10);if(!s)a()})}async getPrompt(){return await i8(150),await this.stop(),await i8(150),await this.writeAndReadUntil(`\r${u8}${z8}`,"\r\n>>>")}async enterRawRepl(){return await this.writeAndReadUntil(E5,"raw REPL; CTRL-B to exit")}async exitRawRepl(){return await this.writeAndReadUntil(z8,"\r\n>>>")}async execRaw(m,s){return await this.writeAndReadUntil(m),await this.writeAndReadUntil(h8,`${h8}>`,s)}async execFile(m,s){if(s=s||function(){},m){await this.enterRawRepl();const C=await this.execRaw(m,s);return await this.exitRawRepl(),C}return Promise.reject()}async run(m,s){return s=s||function(){},new Promise(async(C,a)=>{if(this.rejectRun)this.rejectRun(new Error("re-run")),this.rejectRun=null;this.rejectRun=a;try{await this.enterRawRepl();const D=await this.execRaw(m||"#",s);return await this.exitRawRepl(),C(D)}catch(D){a(D),this.rejectRun=null}})}async eval(m){await this.serial.write(m)}async stop(){if(this.rejectRun)this.rejectRun(new Error("pre stop")),this.rejectRun=null;await this.serial.write(u8)}async reset(){if(this.rejectRun)this.rejectRun(new Error("pre reset")),this.rejectRun=null;await this.serial.write(u8),await this.serial.write(h8)}async exists(m){m=m||"";let s="";s+="try:\n",s+=`  f = open('${m}', 'r')\n`,s+="  print(1)\n",s+="except OSError:\n",s+="  print(0)\n",await this.enterRawRepl();let C=await this.execRaw(s);return await this.exitRawRepl(),C[2]=="1"}async listdir(m){m=m||"";let s="";s+="import os\n",s+="try:\n",s+=`  print(os.listdir('${m}'))\n`,s+="except OSError:\n",s+="  print([])\n",await this.enterRawRepl();let C=await this.execRaw(s);return await this.exitRawRepl(),C=B8(C),C=C.replace(/'/g,'"'),JSON.parse(C)}async mkdir(m){if(m){await this.enterRawRepl();const s=await this.execRaw(`import os\nos.mkdir('${m}')`);return await this.exitRawRepl(),s}return Promise.reject(new Error("Path to file was not specified"))}async rmdir(m){if(m){let s="";s+="import os\n",s+="try:\n",s+=`  os.rmdir("${m}")\n`,s+="except OSError:\n",s+="  print(0)\n",await this.enterRawRepl();const C=await this.execRaw(s);return await this.exitRawRepl(),C}return Promise.reject(new Error("Path to file was not specified"))}async remove(m){if(m){let s="";s+="import os\n",s+="try:\n",s+=`  os.remove("${m}")\n`,s+="except OSError:\n",s+="  print(0)\n",await this.enterRawRepl();const C=await this.execRaw(s);return this.exitRawRepl()}return Promise.reject(new Error("Path to file was not specified"))}async rename(m,s){if(m&&s){await this.enterRawRepl();const C=await this.execRaw(`import os\nos.rename('${m}', '${s}')`);return this.exitRawRepl()}return Promise.reject(new Error("Path to file was not specified"))}async cat(m){if(m){await this.enterRawRepl();let s=await this.execRaw(`with open('${m}','r') as f:\n while 1:\n  b=f.read(256)\n  if not b:break\n  print(b,end='')`);return await this.exitRawRepl(),s=B8(s),o8(s)}return Promise.reject(new Error("Path to file was not specified"))}async put(m,s,C){if(C=C||function(){},m&&s){let a;if(typeof m==="string")a=this._encoder.encode(o8(m));else if(m instanceof ArrayBuffer)a=new Uint8Array(m);else if(m instanceof Uint8Array)a=m;else Promise.reject(new Error(`${m} must string, Uint8Array or ArrayBuffer`));const D=Array.from(a).map((k)=>k.toString(16).padStart(2,"0"));let F="";F+=await this.enterRawRepl(),F+=await this.execRaw(`f=open('${s}','w')\nw=f.write`);const T=48;for(let k=0;k<D.length;k+=T){let $=`w(bytes([${D.slice(k,k+T).map((U)=>`0x${U}`).join(",")}]))`;F+=await this.execRaw($),C(parseInt(k/D.length*100))}return F+=await this.execRaw("f.close()"),F+=await this.exitRawRepl(),C(100),F}return Promise.reject(new Error("Must specify content and destination path"))}}var q5=(m,s,C)=>(m&248)<<8|(s&252)<<3|C>>3,f8=async(m,s)=>{const C=new _8;await C.requestPort(m),await C.connect(),await C.stop(),s(C);const a=()=>setTimeout(async()=>{if(C.connected)a();else s(null)},1000);return a(),C},M8=async(m,s)=>{await m.disconnect(),s(null)},t8=async(m,s,C)=>{await m.stop();const a=s.length;let D=0;const F=(T)=>{C(parseInt((D+1/a*(T/100))*100))};for(let T of s){let{id:k,content:$}=T;if(T.type==="text/x-python")k+=".py";else if(T.type.startsWith("image/"))$=await e5(T.type,T.data);console.log(k),await m.put($,k,F),D+=1/a}C(100),await m.reset()};import{jsx as R0} from"preact/jsx-runtime";var a8=function({newProject:m,openStoreLibrary:s,setPrompt:C,setAlert:a,removeAlert:D,extendsMenu:F,filters:T}={}){let k=()=>{},$=()=>{},U;const I0=()=>{if(U=O5.getMainWorkspace(),U){U.addChangeListener(()=>{k(U.undoStack_.length===0),$(U.redoStack_.length===0)}),k(U.undoStack_.length===0),$(U.redoStack_.length===0);return}setTimeout(I0)};I0();const t0=(J)=>{if(!t0.id)t0.id=`download.${Date.now()}`;if(J<100){if(a)a({id:t0.id,icon:R0(R5,{level:"success"}),message:R0(T0,{id:"blocks.alert.downloading",defaultMessage:"Downloading...{progress}%",progress:J})})}else if(D)D(t0.id),delete t0.id},p0={label:R0(T0,{id:"blocks.menu.file",defaultMessage:"File"}),menuItems:[[{label:R0(T0,{id:"blocks.menu.file.newProject",defaultMessage:"New"}),hotkey:[L6?e0.COMMAND:e0.CONTROL,e0.N],onClick({context:J}){if(J.modified)C({title:R0(T0,{id:"gui.projects.notSaved",defaultMessage:"Not saved"}),label:R0(T0,{id:"gui.projects.replaceProject",defaultMessage:"Replace contents of the current project?"}),onSubmit:m});else m()}}],[{label:R0(T0,{id:"blocks.menu.file.openProject",defaultMessage:"Open"}),hotkey:[L6?e0.COMMAND:e0.CONTROL,e0.O],onClick(){s()}},{label:R0(T0,{id:"blocks.menu.file.saveProject",defaultMessage:"Save"}),hotkey:[L6?e0.COMMAND:e0.CONTROL,e0.S],onClick({context:J}){if(J.saveNow(),t0.id)return;if(J.device&&J.editor.autoDownload)t8(J.device,[].concat(J.fileList,J.assetList),t0)}}],[{label:R0(T0,{id:"blocks.menu.file.uploadProject",defaultMessage:"Load from your computer"}),disabled:!0,async onClick(){console.log("upload")}},{label:R0(T0,{id:"blocks.menu.file.downloadProject",defaultMessage:"save to your computer"}),disabled:!0,async onClick(){console.log("download")}}]]},v0={label:R0(T0,{id:"blocks.menu.edit",defaultMessage:"Edit"}),menuItems:[[{label:R0(T0,{id:"blocks.menu.edit.undo",defaultMessage:"Undo"}),hotkey:[L6?e0.COMMAND:e0.CONTROL,e0.Z],onDisable({setDisable:J}){if(k=J,U)k(U.undoStack_.length===0)},async onClick(J){if(J instanceof MouseEvent&&U)U.undo(!1)}},{label:R0(T0,{id:"blocks.menu.edit.redo",defaultMessage:"Redo"}),hotkey:L6?[e0.SHIFT,e0.COMMAND,e0.Z]:[e0.CONTROL,e0.Y],onDisable({setDisable:J}){if($=J,U)$(U.redoStack_.length===0)},async onClick(J){if(J instanceof MouseEvent&&U)U.undo(!0)}}]]},r0={label:R0(T0,{id:"blocks.menu.device",defaultMessage:"Device"}),menuItems:[[{label:R0(T0,{id:"blocks.menu.device.connect",defaultMessage:"Connect your device"}),onLabel({locale:J,context:W}){if(W.device)return J.getText("blocks.menu.device.disconnect","Disconnect this device");else return J.getText("blocks.menu.device.connect","Connect your device")},onClick({context:J}){if(J.device)M8(J.device,J.connectDevice);else f8(T||X5,J.connectDevice)}},{label:R0(T0,{id:"blocks.menu.device.download",defaultMessage:"Download program"}),async onClick({context:J}){if(t0.id)return;let{device:W}=J;if(!W)W=await f8(T,J.connectDevice);t8(W,[].concat(J.fileList,J.assetList),t0)}}],[{label:R0(T0,{id:"blocks.menu.device.turnOnAutoDownload",defaultMessage:"Turn on auto download"}),onLabel({locale:J,context:W}){if(W.editor.autoDownload)return J.getText("blocks.menu.device.turnOffAutoDownload","Turn off auto download");else return J.getText("blocks.menu.device.turnOnAutoDownload","Turn on auto download")},onDisable({context:J,setDisable:W}){if(!J.device&&J.editor.autoDownload)J.setEditor({autoDownload:!1});W(!J.device)},async onClick({context:J}){J.setEditor({autoDownload:!J.editor.autoDownload})}}]]};F=F||[];const A=(J,W)=>{const u6=F.findIndex((u0)=>u0.id===W);if(u6>=0){const[u0]=F.splice(u6,1);if(u0.hidden)return[];J.menuItems.concat(u0.menuItems)}return J};return[].concat(A(p0,"file"),A(v0,"edit"),A(r0,"device"),F)};import{ScratchBlocks as U0} from"@blockcode/blocks-editor";import{ScratchBlocks as m8} from"@blockcode/blocks-editor";import{ScratchBlocks as V8} from"@blockcode/blocks-editor";import{useState as L8} from"preact/hooks";import{useLocale as F5,useEditor as T5} from"@blockcode/core";import{classNames as H5,ComingSoon as Y5} from"@blockcode/ui";import{BlocksEditor as Z5,ScratchBlocks as n6,makeToolboxXML as W5} from"@blockcode/blocks-editor";import{useRef as K5,useEffect as U5,useState as c8} from"preact/hooks";import{classNames as J5,Text as o6,Button as G8,Modal as Q5,BufferedInput as $5} from"@blockcode/ui";var g8=function(m){const s=globalThis.document,C=s.createElement("style");C.appendChild(s.createTextNode(m)),s.head.append(C)};import{jsx as G0} from"preact/jsx-runtime";var i4=function({title:m,label:s,defaultValue:C,enableLocalVariable:a,showListMessage:D,showVariableOptions:F,showCloudOption:T,onClose:k,onSubmit:$}){const U=K5(null),[I0,t0]=c8(C),[p0,v0]=c8({scope:"global",isCloud:!1}),r0=()=>{$(I0,p0)},A=(J)=>{if(J.key==="Escape")k();if(J.key==="Enter")$(U.current.base.value,p0)};return U5(()=>{if(U.current)U.current.base.focus(),window.addEventListener("keydown",A);return()=>{window.removeEventListener("keydown",A)}},[U]),G0(Q5,{title:m,className:m6.promptModal,onClose:k,children:G0("div",{className:m6.promptContent,children:[G0("div",{className:m6.label,children:s}),G0($5,{autoFocus:!0,forceFocus:!0,ref:U,className:m6.variableNameTextInput,defaultValue:I0,onSubmit:t0}),F&&G0("div",{children:a?G0("div",{className:m6.options,children:[G0("label",{children:[G0("input",{checked:p0.scope==="global",name:"variableScopeOption",type:"radio",value:"global",onChange:()=>v0({...p0,scope:"global"})}),G0(o6,{id:"blocks.dataPrompt.forAllTargets",defaultMessage:"For all targets"})]}),G0("label",{children:[G0("input",{checked:p0.scope==="local",name:"variableScopeOption",type:"radio",value:"local",onChange:()=>v0({...p0,scope:"local"})}),G0(o6,{id:"blocks.dataPrompt.forThisTarget",defaultMessage:"For this target only"})]})]}):G0("div",{className:m6.infoMessage,children:D?G0(o6,{id:"blocks.dataPrompt.listAvailableToAllTargets",defaultMessage:"This list will be available to all targets."}):G0(o6,{id:"blocks.dataPrompt.availableToAllTargets",defaultMessage:"This variable will be available to all targets."})})}),G0("div",{className:m6.buttonRow,children:[G0(G8,{className:m6.button,onClick:k,children:G0(o6,{id:"blocks.dataPrompt.cancel",defaultMessage:"Cancel"})}),G0(G8,{className:J5(m6.button,m6.okButton),onClick:r0,children:G0(o6,{id:"blocks.dataPrompt.ok",defaultMessage:"OK"})})]})]})})};import{jsx as b6} from"preact/jsx-runtime";var h4=function({toolbox:m,messages:s,xml:C,enableMultiTargets:a,enableLocalVariable:D,disableGenerator:F,disableExtension:T,onChange:k}){const{getText:$}=F5(),{fileList:U,selectedIndex:I0,modifyFile:t0}=T5(),[p0,v0]=L8(),[r0,A]=L8(!1);if(s={EVENT_WHENPROGRAMSTART:$("blocks.event.programStart","when program start"),CONTROL_STOP_OTHER:$("blocks.control.stopOther","other scripts"),...s||[]},n6.prompt=(H0,j0,k0,v6,m0)=>{const q0={callback:k0,message:H0,defaultValue:j0};q0.title=v6?v6:n6.Msg.VARIABLE_MODAL_TITLE,q0.varType=typeof m0==="string"?m0:n6.SCALAR_VARIABLE_TYPE,q0.showVariableOptions=a&&m0!==n6.BROADCAST_MESSAGE_VARIABLE_TYPE&&q0.title!==n6.Msg.RENAME_VARIABLE_MODAL_TITLE&&q0.title!==n6.Msg.RENAME_LIST_MODAL_TITLE,q0.showCloudOption=m0===n6.SCALAR_VARIABLE_TYPE&&this.props.canUseCloud,A(q0)},m=m||W5(),!C&&I0!==-1){const H0=U[I0];C=H0&&H0.xml}let J;if(p0)J=p0.getAllVariables().filter((H0)=>{if(H0.isLocal)return!1;if(H0.type===n6.BROADCAST_MESSAGE_VARIABLE_TYPE){if(H0.name===n6.Msg.DEFAULT_BROADCAST_MESSAGE_NAME)return!1;const j0=H0.id_.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),k0=new RegExp(`<field name="BROADCAST_OPTION" id="${j0}"[^>]+>[^<]+</field>`,"g");for(let v6 of U)if(k0.test(v6.xml))return!0;return!1}return!0});const W=k||((H0,j0)=>{const k0={xml:H0};if(!F)k0.content=c.workspaceToCode(j0);t0(k0)}),u6=(H0,j0)=>{r0.callback(H0,[],j0),A(!1)},u0=()=>A(!1);return b6("div",{className:n8.editorWrapper,children:[b6(Z5,{toolbox:m,messages:s,xml:C,variables:J,onWorkspaceCreated:v0,onChange:I0!==-1?W:null}),T?null:b6("div",{className:H5("scratchCategoryMenu",n8.extensionButton),children:b6(Y5,{children:b6("button",{className:n8.addButton,title:$("blocks.extensions.addExtension","Add Extension"),children:b6("img",{src:u4,title:"Add Extension"})})})}),r0&&b6(i4,{title:r0.title,label:r0.message,defaultValue:r0.defaultValue,enableLocalVariable:D,showListMessage:r0.varType===n6.LIST_VARIABLE_TYPE,showVariableOptions:r0.showVariableOptions,showCloudOption:r0.showCloudOption,onClose:u0,onSubmit:u6})]})};import{jsx as t4} from"preact/jsx-runtime";var n4=function(){return t4("div",{className:f4.pane})};import{jsx as A8} from"preact/jsx-runtime";var X5=[{usbVendorId:12346},{usbVendorId:11914}],L6=/Mac/i.test(navigator.platform||navigator.userAgent);var c=new U0.Generator("Python");c.addReservedWords("False,None,True,and,as,assert,break,class,continue,def,del,elif,else,except,exec,finally,for,from,global,if,import,in,is,lambda,nonlocal,not,or,pass,print,raise,return,try,while,with,yield,NotImplemented,Ellipsis,__debug__,quit,exit,copyright,license,credits,ArithmeticError,AssertionError,AttributeError,BaseException,BlockingIOError,BrokenPipeError,BufferError,BytesWarning,ChildProcessError,ConnectionAbortedError,ConnectionError,ConnectionRefusedError,ConnectionResetError,DeprecationWarning,EOFError,Ellipsis,EnvironmentError,Exception,FileExistsError,FileNotFoundError,FloatingPointError,FutureWarning,GeneratorExit,IOError,ImportError,ImportWarning,IndentationError,IndexError,InterruptedError,IsADirectoryError,KeyError,KeyboardInterrupt,LookupError,MemoryError,ModuleNotFoundError,NameError,NotADirectoryError,NotImplemented,NotImplementedError,OSError,OverflowError,PendingDeprecationWarning,PermissionError,ProcessLookupError,RecursionError,ReferenceError,ResourceWarning,RuntimeError,RuntimeWarning,StandardError,StopAsyncIteration,StopIteration,SyntaxError,SyntaxWarning,SystemError,SystemExit,TabError,TimeoutError,TypeError,UnboundLocalError,UnicodeDecodeError,UnicodeEncodeError,UnicodeError,UnicodeTranslateError,UnicodeWarning,UserWarning,ValueError,Warning,ZeroDivisionError,_,__build_class__,__debug__,__doc__,__import__,__loader__,__name__,__package__,__spec__,abs,all,any,apply,ascii,basestring,bin,bool,buffer,bytearray,bytes,callable,chr,classmethod,cmp,coerce,compile,complex,copyright,credits,delattr,dict,dir,divmod,enumerate,eval,exec,execfile,exit,file,filter,float,format,frozenset,getattr,globals,hasattr,hash,help,hex,id,input,int,intern,isinstance,issubclass,iter,len,license,list,locals,long,map,max,memoryview,min,next,object,oct,open,ord,pow,print,property,quit,range,raw_input,reduce,reload,repr,reversed,round,set,setattr,slice,sorted,staticmethod,str,sum,super,tuple,type,unichr,unicode,vars,xrange,zip");c.ORDER_ATOMIC=0;c.ORDER_COLLECTION=1;c.ORDER_STRING_CONVERSION=1;c.ORDER_MEMBER=2.1;c.ORDER_FUNCTION_CALL=2.2;c.ORDER_EXPONENTIATION=3;c.ORDER_UNARY_SIGN=4;c.ORDER_BITWISE_NOT=4;c.ORDER_MULTIPLICATIVE=5;c.ORDER_ADDITIVE=6;c.ORDER_BITWISE_SHIFT=7;c.ORDER_BITWISE_AND=8;c.ORDER_BITWISE_XOR=9;c.ORDER_BITWISE_OR=10;c.ORDER_RELATIONAL=11;c.ORDER_LOGICAL_NOT=12;c.ORDER_LOGICAL_AND=13;c.ORDER_LOGICAL_OR=14;c.ORDER_CONDITIONAL=15;c.ORDER_LAMBDA=16;c.ORDER_NONE=99;c.ORDER_OVERRIDES=[[c.ORDER_FUNCTION_CALL,c.ORDER_MEMBER],[c.ORDER_FUNCTION_CALL,c.ORDER_FUNCTION_CALL],[c.ORDER_MEMBER,c.ORDER_MEMBER],[c.ORDER_MEMBER,c.ORDER_FUNCTION_CALL],[c.ORDER_LOGICAL_NOT,c.ORDER_LOGICAL_NOT],[c.ORDER_LOGICAL_AND,c.ORDER_LOGICAL_AND],[c.ORDER_LOGICAL_OR,c.ORDER_LOGICAL_OR]];c.init=(m)=>{if(c.PASS=c.INDENT+"pass\n",c.definitions_=Object.create(null),c.functionNames_=Object.create(null),!c.variableDB_)c.variableDB_=new U0.Names(c.RESERVED_WORDS_);else c.variableDB_.reset();c.variableDB_.setVariableMap(m.getVariableMap());const s=[],C=m.getAllVariables();for(let D=0;D<C.length;D++){if(C[D].type===U0.BROADCAST_MESSAGE_VARIABLE_TYPE)continue;const F=c.variableDB_.getName(C[D].getId(),U0.Variables.NAME_TYPE);if(C[D].type===U0.LIST_VARIABLE_TYPE)s.push(`${F}_${U0.LIST_VARIABLE_TYPE} = []`);else s.push(`${F} = None`)}const a=U0.Variables.allDeveloperVariables(m);for(let D=0;D<a.length;D++){const F=c.variableDB_.getName(a[D],U0.Names.DEVELOPER_VARIABLE_TYPE);if(C[D].type===U0.LIST_VARIABLE_TYPE)s.push(`${F}_${U0.LIST_VARIABLE_TYPE} = []`);else s.push(`${F} = None`)}if(s.length)c.definitions_.variables=s.join("\n");c.definitions_.import_popsicle_scratch="from popsicle.scratch import *"};c.finish=(m)=>{const s=[],C=[];for(let a in c.definitions_){const D=c.definitions_[a];if(D.match(/^(from\s+\S+\s+)?import\s+\S+/))s.push(D);else C.push(D)}return delete c.definitions_,delete c.functionNames_,c.variableDB_.reset(),(s.join("\n")+"\n\n"+C.join("\n\n")).replace(/\n\n+/g,"\n\n").replace(/\n*$/,"\n\n\n")+m};c.scrubNakedValue=(m)=>{return m+"\n"};c.quote_=(m)=>{m=m.replace(/\\/g,"\\\\").replace(/\n/g,"\\\n").replace(/\%/g,"\\%");let s="'";if(m.indexOf("'")!==-1)if(m.indexOf('"')===-1)s='"';else m=m.replace(/'/g,"\\'");return s+m+s};c.scrub_=(m,s)=>{let C="";if(!m.outputConnection||!m.outputConnection.targetConnection){let a=m.getCommentText();if(a=U0.utils.wrap(a,c.COMMENT_WRAP-3),a)if(m.getProcedureDef)C+='"""'+a+'\n"""\n';else C+=c.prefixLines(a+"\n","# ");for(let D=0;D<m.inputList.length;D++)if(m.inputList[D].type==U0.INPUT_VALUE){const F=m.inputList[D].connection.targetBlock();if(F){const T=c.allNestedComments(F);if(T)C+=c.prefixLines(T,"# ")}}}if(m.startHat_){const a=m.nextConnection&&m.nextConnection.targetBlock();let D=c.blockToCode(a);if(D)D=c.prefixLines(D,c.INDENT),s=s.replace(`:\n${c.PASS}`,`:\n${D}`);return C+s}if(m.parentBlock_){const a=m.nextConnection&&m.nextConnection.targetBlock(),D=c.blockToCode(a);return C+s+D}};c.getAdjustedInt=(m,s,C,a)=>{let D=C||0;if(m.workspace.options.oneBasedIndex)D--;const F=m.workspace.options.oneBasedIndex?"1":"0",T=D?c.ORDER_ADDITIVE:c.ORDER_NONE;let k=c.valueToCode(m,s,T)||F;if(U0.isNumber(k)){if(k=parseInt(k,10)+D,a)k=-k}else{if(D>0)k="int("+k+" + "+D+")";else if(D<0)k="int("+k+" - "+-D+")";else k="int("+k+")";if(a)k="-"+k}return k};c.functionToCode=(m="",...s)=>{if(!c.functionNames_[m])c.functionNames_[m]=0;c.functionNames_[m]+=1,m=`${m}_${c.functionNames_[m]}`;const C=`async def ${m}(${s.join(",")}):\n${c.PASS}`;return[m,C]};c.control_wait=(m)=>{let s="";if(c.STATEMENT_PREFIX)s+=c.injectId(c.STATEMENT_PREFIX,m);const C=c.valueToCode(m,"DURATION",c.ORDER_NONE);return s+=`await wait_for(${C})\n`,s};c.control_repeat=(m)=>{let s="",C,a;if(c.STATEMENT_PREFIX)s+=c.injectId(c.STATEMENT_PREFIX,m);if(C=c.valueToCode(m,"TIMES",c.ORDER_NONE)||"False",a=c.statementToCode(m,"SUBSTACK")||c.PASS,c.STATEMENT_SUFFIX)a=c.prefixLines(c.injectId(c.STATEMENT_SUFFIX,m),c.INDENT)+a;return s+=`for _ in range(${C}):\n${a}  await sleep_fps()\n`,s};c.control_forever=(m)=>{let s="",C;if(c.STATEMENT_PREFIX)s+=c.injectId(c.STATEMENT_PREFIX,m);if(C=c.statementToCode(m,"SUBSTACK")||c.PASS,c.STATEMENT_SUFFIX)C=c.prefixLines(c.injectId(c.STATEMENT_SUFFIX,m),c.INDENT)+C;return s+=`while True:\n${C}  await sleep_fps()\n`,s};c.control_if=(m)=>{let s="",C,a;if(c.STATEMENT_PREFIX)s+=c.injectId(c.STATEMENT_PREFIX,m);if(a=c.valueToCode(m,"CONDITION",c.ORDER_NONE)||"False",C=c.statementToCode(m,"SUBSTACK")||c.PASS,c.STATEMENT_SUFFIX)C=c.prefixLines(c.injectId(c.STATEMENT_SUFFIX,m),c.INDENT)+C;if(s+=`if ${a}:\n${C}`,m.getInput("SUBSTACK2")){if(C=c.statementToCode(m,"SUBSTACK2")||c.PASS,c.STATEMENT_SUFFIX)C=c.prefixLines(c.injectId(c.STATEMENT_SUFFIX,m),c.INDENT)+C;s+=`else:\n${C}`}return s};c.control_if_else=c.control_if;c.control_wait_until=(m)=>{let s="";if(c.STATEMENT_PREFIX)s+=c.injectId(c.STATEMENT_PREFIX,m);const C=c.valueToCode(m,"CONDITION",c.ORDER_NONE)||"False";return s+=`while not ${C}: await sleep_fps()\n`,s};c.control_repeat_until=(m)=>{let s="",C,a;if(c.STATEMENT_PREFIX)s+=c.injectId(c.STATEMENT_PREFIX,m);if(a=c.valueToCode(m,"CONDITION",c.ORDER_NONE)||"False",C=c.statementToCode(m,"SUBSTACK")||c.PASS,c.STATEMENT_SUFFIX)C=c.prefixLines(c.injectId(c.STATEMENT_SUFFIX,m),c.INDENT)+C;return s+=`while not ${a}:\n${C}  await sleep_fps()\n`,s};c.control_while=(m)=>{let s="",C,a;if(c.STATEMENT_PREFIX)s+=c.injectId(c.STATEMENT_PREFIX,m);if(a=c.valueToCode(m,"CONDITION",c.ORDER_NONE)||"False",C=c.statementToCode(m,"SUBSTACK")||c.PASS,c.STATEMENT_SUFFIX)C=c.prefixLines(c.injectId(c.STATEMENT_SUFFIX,m),c.INDENT)+C;return s+=`while ${a}:\n${C}  await sleep_fps()\n`,s};c.control_stop=(m)=>{let s="";if(c.STATEMENT_PREFIX)s+=c.injectId(c.STATEMENT_PREFIX,m);switch(m.getFieldValue("STOP_OPTION")){case"all":c.definitions_.import_sys="import sys",s+="sys.exit()\n";break;case"this script":s+="return\n";break;case"other scripts in sprite":s+="pass\n";break}return s};c.data_variable=(m)=>{return[`${c.variableDB_.getName(m.getFieldValue("VARIABLE"),m8.Variables.NAME_TYPE)}.value`,c.ORDER_ATOMIC]};c.data_setvariableto=(m)=>{const s=c.variableDB_.getName(m.getFieldValue("VARIABLE"),m8.Variables.NAME_TYPE),C=c.valueToCode(m,"VALUE",c.ORDER_NONE)||"0";return`${s}.set(${C})\n`};c.data_changevariableby=(m)=>{const s=c.variableDB_.getName(m.getFieldValue("VARIABLE"),m8.Variables.NAME_TYPE),C=c.valueToCode(m,"VALUE",c.ORDER_NONE)||"0";return`${s}.inc(${C})\n`};c.data_listcontents=(m)=>{};c.data_addtolist=(m)=>{};c.data_deleteoflist=(m)=>{};c.data_deletealloflist=(m)=>{};c.data_insertatlist=(m)=>{};c.data_replaceitemoflist=(m)=>{};c.data_itemoflist=(m)=>{};c.data_itemnumoflist=(m)=>{};c.data_lengthoflist=(m)=>{};c.data_listcontainsitem=(m)=>{};c.event_whenflagclicked=(m)=>{let s="";const[C,a]=c.functionToCode("start");return s+=`${a}when_start(${C})\n`,s};c.event_whengreaterthan=(m)=>{};c.event_whenbroadcastreceived=(m)=>{let s="";const C=c.variableDB_.getName(m.getFieldValue("BROADCAST_OPTION"),V8.Variables.NAME_TYPE),[a,D]=c.functionToCode("broadcast_received","sprite");return s+=`${D}when_broadcast_received("${C}",${a},sprite)\n`,s};c.event_broadcast_menu=(m)=>{return[c.variableDB_.getName(m.getFieldValue("BROADCAST_OPTION"),V8.Variables.NAME_TYPE),c.ORDER_ATOMIC]};c.event_broadcast=(m)=>{return`broadcast_message("${c.valueToCode(m,"BROADCAST_INPUT",c.ORDER_NONE)||"None"}")\n`};c.event_broadcastandwait=(m)=>{return`await broadcast_message("${c.valueToCode(m,"BROADCAST_INPUT",c.ORDER_NONE)||"None"}")\n`};c.addReservedWords("math,random,Number");c.math_number=(m)=>{let s=parseFloat(m.getFieldValue("NUM")),C;if(s===Infinity)s='float("inf")',C=c.ORDER_FUNCTION_CALL;else if(s===(-Infinity))s='-float("inf")',C=c.ORDER_UNARY_SIGN;else if(Number.isNaN(s))s='float("nan")',C=c.ORDER_UNARY_SIGN;else C=s<0?c.ORDER_UNARY_SIGN:c.ORDER_ATOMIC;return[s,C]};c.math_integer=(m)=>{const s=parseInt(m.getFieldValue("NUM")),C=s<0?c.ORDER_UNARY_SIGN:c.ORDER_ATOMIC;return[s,C]};c.math_whole_number=(m)=>{return[Math.abs(parseInt(m.getFieldValue("NUM"))),c.ORDER_ATOMIC]};c.math_positive_number=(m)=>{let s=parseFloat(m.getFieldValue("NUM")),C;if(s===Infinity)s='float("inf")',C=c.ORDER_FUNCTION_CALL;else if(s===(-Infinity))s='-float("inf")',C=c.ORDER_FUNCTION_CALL;else if(Number.isNaN(s))s='float("nan")',C=c.ORDER_FUNCTION_CALL;else s=s<0?0:s,C=c.ORDER_ATOMIC;return[s,C]};c.math_angle=(m)=>{let s=parseFloat(m.getFieldValue("NUM")),C;if(s==Infinity)s='float("inf")',C=c.ORDER_FUNCTION_CALL;else if(s==(-Infinity))s='-float("inf")',C=c.ORDER_UNARY_SIGN;else s=s%360,s=s<0?s+360:s,C=c.ORDER_ATOMIC;return[s,C]};c.operator_add=(m)=>{};c.operator_subtract=(m)=>{};c.operator_multiply=(m)=>{};c.operator_divide=(m)=>{};c.operator_random=(m)=>{};c.operator_gt=(m)=>{};c.operator_lt=(m)=>{};c.operator_equals=(m)=>{};c.operator_and=(m)=>{};c.operator_or=(m)=>{};c.operator_not=(m)=>{};c.operator_join=(m)=>{};c.operator_letter_of=(m)=>{};c.operator_length=(m)=>{};c.operator_contains=(m)=>{};c.operator_mod=(m)=>{};c.operator_round=(m)=>{};c.operator_mathop=(m)=>{};c.procedures_definition=(m)=>{};c.procedures_call=(m)=>{};c.procedures_prototype=(m)=>{};c.procedures_declaration=(m)=>{};c.argument_reporter_boolean=(m)=>{};c.argument_reporter_string_number=(m)=>{};c.argument_editor_boolean=(m)=>{};c.argument_editor_string_number=(m)=>{};c.sensing_timer=(m)=>{return["get_timer()",c.ORDER_FUNCTION_CALL]};c.sensing_resettimer=(m)=>{return"reset_timer()\n"};c.text=(m)=>{return[c.quote_(m.getFieldValue("TEXT")),c.ORDER_ATOMIC]};g8(".R1cW-q_prompt-modal{width:360px}.R1cW-q_prompt-content{background:var(--ui-white);padding:1.5rem 2.25rem}.R1cW-q_prompt-content input[type=checkbox],.R1cW-q_prompt-content input[type=radio]{margin:3px}.R1cW-q_label{margin:0 0 .75rem;font-weight:500}.R1cW-q_variable-name-text-input{border:1px solid var(--ui-black-transparent);color:var(--text-primary-transparent);border-radius:5px;width:100%;height:3rem;margin-bottom:1.5rem;padding:0 1rem;font-size:.875rem}.R1cW-q_info-message{text-align:center;margin-bottom:1.5rem;font-size:.875rem;font-weight:400}.R1cW-q_options{justify-content:space-between;margin-bottom:1.5rem;font-weight:400;display:flex}.R1cW-q_button-row{text-align:right;font-weight:bolder}.R1cW-q_button{padding:.75rem 1rem;font-size:.85rem;font-weight:600}.R1cW-q_ok-button{background:var(--motion-primary);border:var(--motion-primary);color:var(--ui-white);margin-left:var(--space)}");var m6={buttonRow:"R1cW-q_button-row",promptContent:"R1cW-q_prompt-content",button:"R1cW-q_button",infoMessage:"R1cW-q_info-message",promptModal:"R1cW-q_prompt-modal",variableNameTextInput:"R1cW-q_variable-name-text-input",options:"R1cW-q_options",okButton:"R1cW-q_ok-button",label:"R1cW-q_label"};g8(".OF790G_editor-wrapper{border-radius:inherit;width:100%;height:100%;position:relative}.OF790G_extension-button{z-index:var(--z-index-extension-button);background:var(--motion-primary);border:1px solid var(--motion-primary);box-sizing:content-box;border-bottom-left-radius:inherit;border-top:0;height:3.25rem;position:absolute;bottom:-1px;left:-1px}.OF790G_extension-button:before{--fade-out-distance:15px;content:\"\";top:calc(calc(-1*var(--fade-out-distance)));height:var(--fade-out-distance);background:linear-gradient(#0000,#00000026);position:absolute;left:0;right:0}.OF790G_add-button{cursor:pointer;background:0 0;border:none;outline:none;width:100%;height:100%}.OF790G_add-button img{width:1.75rem;height:1.75rem}");var n8={addButton:"OF790G_add-button",editorWrapper:"OF790G_editor-wrapper",extensionButton:"OF790G_extension-button"},u4="./assets/icon-add-extension-5ec2ee35b87b4126.svg";g8(".GS2oYa_pane{height:8rem}");var f4={pane:"GS2oYa_pane"},m4="./assets/icon-blocks-d7e4a3a3eb74d0fb.svg",g4={"blocks.menu.file":"File","blocks.menu.file.newProject":"New","blocks.menu.file.openProject":"Open","blocks.menu.file.saveProject":"Save","blocks.menu.file.uploadProject":"Load from your computer","blocks.menu.file.downloadProject":"Save to your computer","blocks.menu.edit":"Edit","blocks.menu.edit.undo":"Undo","blocks.menu.edit.redo":"Redo","blocks.menu.device":"Device","blocks.menu.device.connect":"Connect to your device","blocks.menu.device.disconnect":"Disconnect this device","blocks.menu.device.download":"Download program","blocks.menu.device.turnOnAutoDownload":"Turn on Auto Download","blocks.menu.device.turnOffAutoDownload":"Turn off Auto Download","blocks.alert.downloading":"Downloading...{progress}%","blocks.codeTab":"Code","blocks.backpackPane.title":"Backpack","blocks.downloadToDevice":"Download","blocks.extensions.addExtension":"Add Extension","blocks.dataPrompt.forAllTargets":"For all targets","blocks.dataPrompt.forThisTarget":"For this target only","blocks.dataPrompt.availableToAllTargets":"This variable will be available to all targets.","blocks.dataPrompt.listAvailableToAllTargets":"This list will be available to all targets.","blocks.dataPrompt.cancel":"Cancel","blocks.dataPrompt.ok":"OK","blocks.event.programStart":"when program start","blocks.control.stopOther":"other scripts"},v4={"blocks.menu.file":"\u6587\u4EF6","blocks.menu.file.newProject":"\u65B0\u4F5C\u54C1","blocks.menu.file.openProject":"\u6253\u5F00","blocks.menu.file.saveProject":"\u4FDD\u5B58","blocks.menu.file.uploadProject":"\u4ECE\u7535\u8111\u4E2D\u6253\u5F00","blocks.menu.file.downloadProject":"\u4FDD\u5B58\u5230\u7535\u8111","blocks.menu.edit":"\u7F16\u8F91","blocks.menu.edit.undo":"\u64A4\u9500","blocks.menu.edit.redo":"\u6062\u590D","blocks.menu.device":"\u8BBE\u5907","blocks.menu.device.connect":"\u8FDE\u63A5\u8BBE\u5907","blocks.menu.device.disconnect":"\u65AD\u5F00\u8BBE\u5907\u8FDE\u63A5","blocks.menu.device.download":"\u4E0B\u8F7D\u7A0B\u5E8F","blocks.menu.device.turnOnAutoDownload":"\u6253\u5F00\u81EA\u52A8\u4E0B\u8F7D","blocks.menu.device.turnOffAutoDownload":"\u5173\u95ED\u81EA\u52A8\u4E0B\u8F7D","blocks.alert.downloading":"\u6B63\u5728\u4E0B\u8F7D\u2026{progress}%","blocks.codeTab":"\u4EE3\u7801","blocks.backpackPane.title":"\u4E66\u5305","blocks.downloadToDevice":"\u4E0B\u8F7D","blocks.extensions.addExtension":"\u6DFB\u52A0\u6269\u5C55","blocks.dataPrompt.forAllTargets":"\u9002\u7528\u4E8E\u5168\u5C40","blocks.dataPrompt.forThisTarget":"\u4EC5\u9002\u7528\u4E8E\u5F53\u524D","blocks.dataPrompt.availableToAllTargets":"\u5168\u5C40\u90FD\u53EF\u4F7F\u7528\u8BE5\u53D8\u91CF\u3002","blocks.dataPrompt.listAvailableToAllTargets":"\u5168\u5C40\u90FD\u53EF\u4F7F\u7528\u8BE5\u5217\u8868\u3002","blocks.dataPrompt.cancel":"\u53D6\u6D88","blocks.dataPrompt.ok":"\u786E\u5B9A","blocks.event.programStart":"\u5F53\u7A0B\u5E8F\u5F00\u59CB\u8FD0\u884C","blocks.control.stopOther":"\u5176\u4ED6\u811A\u672C"},E8={en:g4,"zh-Hans":v4},q6={icon:m4,label:A8(D8,{id:"blocks.codeTab",defaultMessage:"Code"}),Content:h4},w4={label:A8(D8,{id:"blocks.backpackPane.title",defaultMessage:"Backpack"}),Content:n4};import{useLocale as M4,useEditor as L4,exportFile as w7} from"@blockcode/core";import{ScratchBlocks as h7,makeToolboxXML as B4,blockSeparator as g6,categorySeparator as w8} from"@blockcode/blocks-editor";import{ScratchBlocks as e6} from"@blockcode/blocks-editor";e6.Blocks.event_whenflagclicked={init(){this.jsonInit({message0:e6.Msg.EVENT_WHENFLAGCLICKED,args0:[{type:"field_image",src:e6.mainWorkspace.options.pathToMedia+"green-flag.svg",width:24,height:24,alt:"flag"}],category:e6.Categories.event,extensions:["colours_event","shape_hat"]})}};import{ScratchBlocks as Y0} from"@blockcode/blocks-editor";Y0.Blocks.motion_attack={init(){this.jsonInit({message0:Y0.Msg.MOTION_ATTACK,args0:[{type:"input_value",name:"DIRECTION"},{type:"input_value",name:"DISTANCE"}],category:Y0.Categories.motion,extensions:["colours_motion","shape_statement"]})}};Y0.Blocks.motion_move={init(){this.jsonInit({message0:Y0.Msg.MOTION_MOVE,args0:[{type:"input_value",name:"DIRECTION"},{type:"input_value",name:"SPEED"}],category:Y0.Categories.motion,extensions:["colours_motion","shape_statement"]})}};Y0.Blocks.motion_setspeed={init(){this.jsonInit({message0:Y0.Msg.MOTION_SETSPEED,args0:[{type:"input_value",name:"SPEED"}],category:Y0.Categories.motion,extensions:["colours_motion","shape_statement"]})}};Y0.Blocks.motion_stop={init(){this.jsonInit({message0:Y0.Msg.MOTION_STOP,category:Y0.Categories.motion,extensions:["colours_motion","shape_statement"]})}};Y0.Blocks.motion_speed={init(){this.jsonInit({message0:Y0.Msg.MOTION_SPEED,category:Y0.Categories.motion,checkboxInFlyout:!0,extensions:["colours_motion","output_number"]})}};import{ScratchBlocks as J0} from"@blockcode/blocks-editor";J0.Blocks.sensing_scanwidth={init(){this.jsonInit({message0:J0.Msg.SENSING_SCANWIDTH,args0:[{type:"input_value",name:"WIDTH"}],category:J0.Categories.sensing,extensions:["colours_sensing","shape_statement"]})}};J0.Blocks.sensing_scan={init(){this.jsonInit({message0:J0.Msg.SENSING_SCAN,args0:[{type:"input_value",name:"DIRECTION"}],category:J0.Categories.sensing,extensions:["colours_sensing","output_boolean"]})}};J0.Blocks.sensing_scandistance={init(){this.jsonInit({message0:J0.Msg.SENSING_DISTANCE,args0:[{type:"input_value",name:"DIRECTION"}],category:J0.Categories.sensing,extensions:["colours_sensing","output_number"]})}};J0.Blocks.sensing_health={init(){this.jsonInit({message0:J0.Msg.SENSING_HEALTH,category:J0.Categories.sensing,checkboxInFlyout:!0,extensions:["colours_sensing","output_number"]})}};import{useRef as j4,useEffect as P4,useState as e8} from"preact/hooks";import{useEditor as r4} from"@blockcode/core";import{ScratchBlocks as W0} from"@blockcode/blocks-editor";import{ScratchBlocks as Q0} from"@blockcode/blocks-editor";import{ScratchBlocks as _0} from"@blockcode/blocks-editor";import{ScratchBlocks as T8} from"@blockcode/blocks-editor";var H8=function({width:m,height:s,onSetup:C,...a}){const D=j4(null),[F,T]=e8(null),[k,$]=e8(null),{selectedIndex:U,modifyFile:I0}=r4();return P4(()=>{if(D.current){if(v8.default.setup(D.current),C)C(D.current);let t0;const p0=()=>{if(t0=W0.getMainWorkspace(),t0){t0.addChangeListener((v0)=>{if(t0.isDragging())return;if(!b4.has(v0.type))return;const r0=W0.Xml.workspaceToDom(t0),A=W0.Xml.domToText(r0).replace(/<variable type="broadcast_msg"[^>]+>[^<]+<\/variable>/gi,"");if(A!==F||U!==k){if(I0({script:P.workspaceToCode(t0)}),A!==F)T(A);if(U!==k)$(U)}});return}setTimeout(p0)};p0()}return()=>{v8.default.project.clear(),v8.default.project.remove()}},[D]),C4("canvas",{ref:D,style:{width:m,height:s},...a})};import{jsx as C4} from"preact/jsx-runtime";var x4=Object.create,{defineProperty:q8,getPrototypeOf:s4,getOwnPropertyNames:d4}=Object,p4=Object.prototype.hasOwnProperty,X8=(m,s,C)=>{C=m!=null?x4(s4(m)):{};const a=s||!m||!m.__esModule?q8(C,"default",{value:m,enumerable:!0}):C;for(let D of d4(m))if(!p4.call(a,D))q8(a,D,{get:()=>m[D],enumerable:!0});return a},y4=(m,s)=>()=>(s||m((s={exports:{}}).exports,s),s.exports);var F8=y4((m,s)=>{/*!
 * Paper.js v0.12.17 - The Swiss Army Knife of Vector Graphics Scripting.
 * http://paperjs.org/
 *
 * Copyright (c) 2011 - 2020, Jürg Lehni & Jonathan Puckey
 * http://juerglehni.com/ & https://puckey.studio/
 *
 * Distributed under the MIT license. See LICENSE file for details.
 *
 * All rights reserved.
 *
 * Date: Thu Nov 3 21:15:36 2022 +0100
 *
 ***
 *
 * Straps.js - Class inheritance library with support for bean-style accessors
 *
 * Copyright (c) 2006 - 2020 Jürg Lehni
 * http://juerglehni.com/
 *
 * Distributed under the MIT license.
 *
 ***
 *
 * Acorn.js
 * https://marijnhaverbeke.nl/acorn/
 *
 * Acorn is a tiny, fast JavaScript parser written in JavaScript,
 * created by Marijn Haverbeke and released under an MIT license.
 *
 */var C=function(a,D){a=a||(()=>({}));var{window:F,document:T}=a,k=new function(){var i=/^(statics|enumerable|beans|preserve)$/,u=[],h=u.slice,f=Object.create,t=Object.getOwnPropertyDescriptor,n=Object.defineProperty,v=u.forEach||function(l,p){for(var b=0,o=this.length;b<o;b++)l.call(p,this[b],b,this)},g=function(l,p){for(var b in this)if(this.hasOwnProperty(b))l.call(p,this[b],b,this)},w=Object.assign||function(l){for(var p=1,b=arguments.length;p<b;p++){var o=arguments[p];for(var z in o)if(o.hasOwnProperty(z))l[z]=o[z]}return l},x=function(l,p,b){if(l){var o=t(l,"length");(o&&typeof o.value==="number"?v:g).call(l,p,b=b||l)}return b};function y(l,p,b,o,z){var N={};function S(_,M){if(M=M||(M=t(p,_))&&(M.get?M:M.value),typeof M==="string"&&M[0]==="#")M=l[M.substring(1)]||M;var L=typeof M==="function",G=M,V=z||L&&!M.base?M&&M.get?_ in l:l[_]:null,R;if(!z||!V){if(L&&V)M.base=V;if(L&&o!==!1&&(R=_.match(/^([gs]et|is)(([A-Z])(.*))$/)))N[R[3].toLowerCase()+R[4]]=R[2];if(!G||L||!G.get||typeof G.get!=="function"||!j.isPlainObject(G))G={value:G,writable:!0};if((t(l,_)||{configurable:!0}).configurable)G.configurable=!0,G.enumerable=b!=null?b:!R;n(l,_,G)}}if(p){for(var d in p)if(p.hasOwnProperty(d)&&!i.test(d))S(d);for(var d in N){var r=N[d],I=l["set"+r],B=l["get"+r]||I&&l["is"+r];if(B&&(o===!0||B.length===0))S(d,{get:B,set:I})}}return l}function j(){for(var l=0,p=arguments.length;l<p;l++){var b=arguments[l];if(b)w(this,b)}return this}return y(j,{inject:function(l){if(l){var p=l.statics===!0?l:l.statics,b=l.beans,o=l.preserve;if(p!==l)y(this.prototype,l,l.enumerable,b,o);y(this,p,null,b,o)}for(var z=1,N=arguments.length;z<N;z++)this.inject(arguments[z]);return this},extend:function(){var l=this,p,b;for(var o=0,z,N=arguments.length;o<N&&!(p&&b);o++)z=arguments[o],p=p||z.initialize,b=b||z.prototype;if(p=p||function(){l.apply(this,arguments)},b=p.prototype=b||f(this.prototype),n(b,"constructor",{value:p,writable:!0,configurable:!0}),y(p,this),arguments.length)this.inject.apply(p,arguments);return p.base=l,p}}).inject({enumerable:!1,initialize:j,set:j,inject:function(){for(var l=0,p=arguments.length;l<p;l++){var b=arguments[l];if(b)y(this,b,b.enumerable,b.beans,b.preserve)}return this},extend:function(){var l=f(this);return l.inject.apply(l,arguments)},each:function(l,p){return x(this,l,p)},clone:function(){return new this.constructor(this)},statics:{set:w,each:x,create:f,define:n,describe:t,clone:function(l){return w(new l.constructor,l)},isPlainObject:function(l){var p=l!=null&&l.constructor;return p&&(p===Object||p===j||p.name==="Object")},pick:function(l,p){return l!==D?l:p},slice:function(l,p,b){return h.call(l,p,b)}}})};if(typeof s!=="undefined")s.exports=k;k.inject({enumerable:!1,toString:function(){return this._id!=null?(this._class||"Object")+(this._name?" '"+this._name+"'":" @"+this._id):"{ "+k.each(this,function(i,u){if(!/^_/.test(u)){var h=typeof i;this.push(u+": "+(h==="number"?p0.instance.number(i):h==="string"?"'"+i+"'":i))}},[]).join(", ")+" }"},getClassName:function(){return this._class||""},importJSON:function(i){return k.importJSON(i,this)},exportJSON:function(i){return k.exportJSON(this,i)},toJSON:function(){return k.serialize(this)},set:function(i,u){if(i)k.filter(this,i,u,this._prioritize);return this}},{beans:!1,statics:{exports:{},extend:function i(){var u=i.base.apply(this,arguments),h=u.prototype._class;if(h&&!k.exports[h])k.exports[h]=u;return u},equals:function(i,u){if(i===u)return!0;if(i&&i.equals)return i.equals(u);if(u&&u.equals)return u.equals(i);if(i&&u&&typeof i==="object"&&typeof u==="object"){if(Array.isArray(i)&&Array.isArray(u)){var h=i.length;if(h!==u.length)return!1;while(h--)if(!k.equals(i[h],u[h]))return!1}else{var f=Object.keys(i),h=f.length;if(h!==Object.keys(u).length)return!1;while(h--){var t=f[h];if(!(u.hasOwnProperty(t)&&k.equals(i[t],u[t])))return!1}}return!0}return!1},read:function(i,u,h,f){if(this===k){var t=this.peek(i,u);return i.__index++,t}var n=this.prototype,v=n._readIndex,g=u||v&&i.__index||0,w=i.length,x=i[g];if(f=f||w-g,x instanceof this||h&&h.readNull&&x==null&&f<=1){if(v)i.__index=g+1;return x&&h&&h.clone?x.clone():x}if(x=k.create(n),v)x.__read=!0;if(x=x.initialize.apply(x,g>0||g+f<w?k.slice(i,g,g+f):i)||x,v){i.__index=g+x.__read;var y=x.__filtered;if(y)i.__filtered=y,x.__filtered=D;x.__read=D}return x},peek:function(i,u){return i[i.__index=u||i.__index||0]},remain:function(i){return i.length-(i.__index||0)},readList:function(i,u,h,f){var t=[],n,v=u||0,g=f?v+f:i.length;for(var w=v;w<g;w++)t.push(Array.isArray(n=i[w])?this.read(n,0,h):this.read(i,w,h,1));return t},readNamed:function(i,u,h,f,t){var n=this.getNamed(i,u),v=n!==D;if(v){var g=i.__filtered;if(!g){var w=this.getSource(i);g=i.__filtered=k.create(w),g.__unfiltered=w}g[u]=D}return this.read(v?[n]:i,h,f,t)},readSupported:function(i,u){var h=this.getSource(i),f=this,t=!1;if(h)Object.keys(h).forEach(function(n){if(n in u){var v=f.readNamed(i,n);if(v!==D)u[n]=v;t=!0}});return t},getSource:function(i){var u=i.__source;if(u===D){var h=i.length===1&&i[0];u=i.__source=h&&k.isPlainObject(h)?h:null}return u},getNamed:function(i,u){var h=this.getSource(i);if(h)return u?h[u]:i.__filtered||h},hasNamed:function(i,u){return!!this.getNamed(i,u)},filter:function(i,u,h,f){var t;function n(y){if(!(h&&(y in h))&&!(t&&(y in t))){var j=u[y];if(j!==D)i[y]=j}}if(f){var v={};for(var g=0,w,x=f.length;g<x;g++)if((w=f[g])in u)n(w),v[w]=!0;t=v}return Object.keys(u.__unfiltered||u).forEach(n),i},isPlainValue:function(i,u){return k.isPlainObject(i)||Array.isArray(i)||u&&typeof i==="string"},serialize:function(i,u,h,f){u=u||{};var t=!f,n;if(t)u.formatter=new p0(u.precision),f={length:0,definitions:{},references:{},add:function(j,l){var p="#"+j._id,b=this.references[p];if(!b){this.length++;var o=l.call(j),z=j._class;if(z&&o[0]!==z)o.unshift(z);this.definitions[p]=o,b=this.references[p]=[p]}return b}};if(i&&i._serialize){n=i._serialize(u,f);var v=i._class;if(v&&!i._compactSerialize&&(t||!h)&&n[0]!==v)n.unshift(v)}else if(Array.isArray(i)){n=[];for(var g=0,w=i.length;g<w;g++)n[g]=k.serialize(i[g],u,h,f)}else if(k.isPlainObject(i)){n={};var x=Object.keys(i);for(var g=0,w=x.length;g<w;g++){var y=x[g];n[y]=k.serialize(i[y],u,h,f)}}else if(typeof i==="number")n=u.formatter.number(i,u.precision);else n=i;return t&&f.length>0?[["dictionary",f.definitions],n]:n},deserialize:function(i,u,h,f,t){var n=i,v=!h,g=v&&i&&i.length&&i[0][0]==="dictionary";if(h=h||{},Array.isArray(i)){var w=i[0],x=w==="dictionary";if(i.length==1&&/^#/.test(w))return h.dictionary[w];w=k.exports[w],n=[];for(var y=w?1:0,j=i.length;y<j;y++)n.push(k.deserialize(i[y],u,h,x,g));if(w){var l=n;if(u)n=u(w,l,v||t);else n=new w(l)}}else if(k.isPlainObject(i)){if(n={},f)h.dictionary=n;for(var p in i)n[p]=k.deserialize(i[p],u,h)}return g?n[1]:n},exportJSON:function(i,u){var h=k.serialize(i,u);return u&&u.asString==!1?h:JSON.stringify(h)},importJSON:function(i,u){return k.deserialize(typeof i==="string"?JSON.parse(i):i,function(h,f,t){var n=t&&u&&u.constructor===h,v=n?u:k.create(h.prototype);if(f.length===1&&v instanceof m0&&(n||!(v instanceof k6))){var g=f[0];if(k.isPlainObject(g)){if(g.insert=!1,n)f=f.concat([m0.INSERT])}}if((n?v.set:h).apply(v,f),n)u=null;return v})},push:function(i,u){var h=u.length;if(h<4096)i.push.apply(i,u);else{var f=i.length;i.length+=h;for(var t=0;t<h;t++)i[f+t]=u[t]}return i},splice:function(i,u,h,f){var t=u&&u.length,n=h===D;if(h=n?i.length:h,h>i.length)h=i.length;for(var v=0;v<t;v++)u[v]._index=h+v;if(n)return k.push(i,u),[];else{var g=[h,f];if(u)k.push(g,u);var w=i.splice.apply(i,g);for(var v=0,x=w.length;v<x;v++)w[v]._index=D;for(var v=h+t,x=i.length;v<x;v++)i[v]._index=v;return w}},capitalize:function(i){return i.replace(/\b[a-z]/g,function(u){return u.toUpperCase()})},camelize:function(i){return i.replace(/-(.)/g,function(u,h){return h.toUpperCase()})},hyphenate:function(i){return i.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}}});var $={on:function(i,u){if(typeof i!=="string")k.each(i,function(n,v){this.on(v,n)},this);else{var h=this._eventTypes,f=h&&h[i],t=this._callbacks=this._callbacks||{};if(t=t[i]=t[i]||[],t.indexOf(u)===-1){if(t.push(u),f&&f.install&&t.length===1)f.install.call(this,i)}}return this},off:function(i,u){if(typeof i!=="string"){k.each(i,function(v,g){this.off(g,v)},this);return}var h=this._eventTypes,f=h&&h[i],t=this._callbacks&&this._callbacks[i],n;if(t){if(!u||(n=t.indexOf(u))!==-1&&t.length===1){if(f&&f.uninstall)f.uninstall.call(this,i);delete this._callbacks[i]}else if(n!==-1)t.splice(n,1)}return this},once:function(i,u){return this.on(i,function h(){u.apply(this,arguments),this.off(i,h)})},emit:function(i,u){var h=this._callbacks&&this._callbacks[i];if(!h)return!1;var f=k.slice(arguments,1),t=u&&u.target&&!u.currentTarget;if(h=h.slice(),t)u.currentTarget=this;for(var n=0,v=h.length;n<v;n++)if(h[n].apply(this,f)==!1){if(u&&u.stop)u.stop();break}if(t)delete u.currentTarget;return!0},responds:function(i){return!!(this._callbacks&&this._callbacks[i])},attach:"#on",detach:"#off",fire:"#emit",_installEvents:function(i){var u=this._eventTypes,h=this._callbacks,f=i?"install":"uninstall";if(u){for(var t in h)if(h[t].length>0){var n=u[t],v=n&&n[f];if(v)v.call(this,t)}}},statics:{inject:function i(u){var h=u._events;if(h){var f={};k.each(h,function(t,n){var v=typeof t==="string",g=v?t:n,w=k.capitalize(g),x=g.substring(2).toLowerCase();f[x]=v?{}:t,g="_"+g,u["get"+w]=function(){return this[g]},u["set"+w]=function(y){var j=this[g];if(j)this.off(x,j);if(y)this.on(x,y);this[g]=y}}),u._eventTypes=f}return i.base.apply(this,arguments)}}},U=k.extend({_class:"PaperScope",initialize:function i(){P0=this,this.settings=new k({applyMatrix:!0,insertItems:!0,handleSize:4,hitTolerance:0}),this.project=null,this.projects=[],this.tools=[],this._id=i._id++,i._scopes[this._id]=this;var u=i.prototype;if(!this.support){var h=D0.getContext(1,1)||{};u.support={nativeDash:"setLineDash"in h||"mozDash"in h,nativeBlendModes:$6.nativeModes},D0.release(h)}if(!this.agent){var f=a.navigator.userAgent.toLowerCase(),t=(/(darwin|win|mac|linux|freebsd|sunos)/.exec(f)||[])[0],n=t==="darwin"?"mac":t,v=u.agent=u.browser={platform:n};if(n)v[n]=!0;if(f.replace(/(opera|chrome|safari|webkit|firefox|msie|trident|atom|node|jsdom)\/?\s*([.\d]+)(?:.*version\/([.\d]+))?(?:.*rv\:v?([.\d]+))?/g,function(g,w,x,y,j){if(!v.chrome){var l=w==="opera"?y:/^(node|trident)$/.test(w)?j:x;v.version=l,v.versionNumber=parseFloat(l),w={trident:"msie",jsdom:"node"}[w]||w,v.name=w,v[w]=!0}}),v.chrome)delete v.webkit;if(v.atom)delete v.chrome}},version:"0.12.17",getView:function(){var i=this.project;return i&&i._view},getPaper:function(){return this},execute:function(i,u){},install:function(i){var u=this;k.each(["project","view","tool"],function(f){k.define(i,f,{configurable:!0,get:function(){return u[f]}})});for(var h in this)if(!/^_/.test(h)&&this[h])i[h]=this[h]},setup:function(i){return P0=this,this.project=new v6(i),this},createCanvas:function(i,u){return D0.getCanvas(i,u)},activate:function(){P0=this},clear:function(){var i=this.projects,u=this.tools;for(var h=i.length-1;h>=0;h--)i[h].remove();for(var h=u.length-1;h>=0;h--)u[h].remove()},remove:function(){this.clear(),delete U._scopes[this._id]},statics:new function(){function i(u){return u+="Attribute",function(h,f){return h[u](f)||h[u]("data-paper-"+f)}}return{_scopes:{},_id:0,get:function(u){return this._scopes[u]||null},getAttribute:i("get"),hasAttribute:i("has")}}}),I0=k.extend($,{initialize:function(i){if(this._scope=P0,this._index=this._scope[this._list].push(this)-1,i||!this._scope[this._reference])this.activate()},activate:function(){if(!this._scope)return!1;var i=this._scope[this._reference];if(i&&i!==this)i.emit("deactivate");return this._scope[this._reference]=this,this.emit("activate",i),!0},isActive:function(){return this._scope[this._reference]===this},remove:function(){if(this._index==null)return!1;if(k.splice(this._scope[this._list],null,this._index,1),this._scope[this._reference]==this)this._scope[this._reference]=null;return this._scope=null,!0},getView:function(){return this._scope.getView()}}),t0={findItemBoundsCollisions:function(i,u,h){function f(v){var g=new Array(v.length);for(var w=0;w<v.length;w++){var x=v[w].getBounds();g[w]=[x.left,x.top,x.right,x.bottom]}return g}var t=f(i),n=!u||u===i?t:f(u);return this.findBoundsCollisions(t,n,h||0)},findCurveBoundsCollisions:function(i,u,h,f){function t(l){var{min:p,max:b}=Math,o=new Array(l.length);for(var z=0;z<l.length;z++){var N=l[z];o[z]=[p(N[0],N[2],N[4],N[6]),p(N[1],N[3],N[5],N[7]),b(N[0],N[2],N[4],N[6]),b(N[1],N[3],N[5],N[7])]}return o}var n=t(i),v=!u||u===i?n:t(u);if(f){var g=this.findBoundsCollisions(n,v,h||0,!1,!0),w=this.findBoundsCollisions(n,v,h||0,!0,!0),x=[];for(var y=0,j=g.length;y<j;y++)x[y]={hor:g[y],ver:w[y]};return x}return this.findBoundsCollisions(n,v,h||0)},findBoundsCollisions:function(i,u,h,f,t){var n=!u||i===u,v=n?i:i.concat(u),g=i.length,w=v.length;function x(Y,K,f0){var i0=0,g0=Y.length;while(i0<g0){var Q=g0+i0>>>1;if(v[Y[Q]][K]<f0)i0=Q+1;else g0=Q}return i0-1}var y=f?1:0,j=y+2,l=f?0:1,p=l+2,b=new Array(w);for(var o=0;o<w;o++)b[o]=o;b.sort(function(Y,K){return v[Y][y]-v[K][y]});var z=[],N=new Array(g);for(var o=0;o<w;o++){var S=b[o],d=v[S],r=n?S:S-g,I=S<g,B=n||!I,_=I?[]:null;if(z.length){var M=x(z,j,d[y]-h)+1;if(z.splice(0,M),n&&t){_=_.concat(z);for(var L=0;L<z.length;L++){var G=z[L];N[G].push(r)}}else{var V=d[p],R=d[l];for(var L=0;L<z.length;L++){var G=z[L],q=v[G],E=G<g,e=n||G>=g;if(t||(I&&e||B&&E)&&(V>=q[l]-h&&R<=q[p]+h)){if(I&&e)_.push(n?G:G-g);if(B&&E)N[G].push(r)}}}}if(I){if(i===u)_.push(S);N[S]=_}if(z.length){var O=d[j],X=x(z,j,O);z.splice(X+1,0,S)}else z.push(S)}for(var o=0;o<N.length;o++){var H=N[o];if(H)H.sort(function(K,f0){return K-f0})}return N}},p0=k.extend({initialize:function(i){this.precision=k.pick(i,5),this.multiplier=Math.pow(10,this.precision)},number:function(i){return this.precision<16?Math.round(i*this.multiplier)/this.multiplier:i},pair:function(i,u,h){return this.number(i)+(h||",")+this.number(u)},point:function(i,u){return this.number(i.x)+(u||",")+this.number(i.y)},size:function(i,u){return this.number(i.width)+(u||",")+this.number(i.height)},rectangle:function(i,u){return this.point(i,u)+(u||",")+this.size(i,u)}});p0.instance=new p0;var v0=new function(){var i=[[0.5773502691896257],[0,0.7745966692414834],[0.33998104358485626,0.8611363115940526],[0,0.5384693101056831,0.906179845938664],[0.2386191860831969,0.6612093864662645,0.932469514203152],[0,0.4058451513773972,0.7415311855993945,0.9491079123427585],[0.1834346424956498,0.525532409916329,0.7966664774136267,0.9602898564975363],[0,0.3242534234038089,0.6133714327005904,0.8360311073266358,0.9681602395076261],[0.14887433898163122,0.4333953941292472,0.6794095682990244,0.8650633666889845,0.9739065285171717],[0,0.26954315595234496,0.5190961292068118,0.7301520055740494,0.8870625997680953,0.978228658146057],[0.1252334085114689,0.3678314989981802,0.5873179542866175,0.7699026741943047,0.9041172563704749,0.9815606342467192],[0,0.2304583159551348,0.44849275103644687,0.6423493394403402,0.8015780907333099,0.9175983992229779,0.9841830547185881],[0.10805494870734367,0.31911236892788974,0.5152486363581541,0.6872929048116855,0.827201315069765,0.9284348836635735,0.9862838086968123],[0,0.20119409399743451,0.3941513470775634,0.5709721726085388,0.7244177313601701,0.8482065834104272,0.937273392400706,0.9879925180204854],[0.09501250983763744,0.2816035507792589,0.45801677765722737,0.6178762444026438,0.755404408355003,0.8656312023878318,0.9445750230732326,0.9894009349916499]],u=[[1],[0.8888888888888888,0.5555555555555556],[0.6521451548625461,0.34785484513745385],[0.5688888888888889,0.47862867049936647,0.23692688505618908],[0.46791393457269104,0.3607615730481386,0.17132449237917036],[0.4179591836734694,0.3818300505051189,0.27970539148927664,0.1294849661688697],[0.362683783378362,0.31370664587788727,0.22238103445337448,0.10122853629037626],[0.3302393550012598,0.31234707704000286,0.26061069640293544,0.1806481606948574,0.08127438836157441],[0.29552422471475287,0.26926671930999635,0.21908636251598204,0.1494513491505806,0.06667134430868814],[0.2729250867779006,0.26280454451024665,0.23319376459199048,0.18629021092773426,0.1255803694649046,0.05566856711617366],[0.24914704581340277,0.2334925365383548,0.20316742672306592,0.16007832854334622,0.10693932599531843,0.04717533638651183],[0.2325515532308739,0.22628318026289723,0.2078160475368885,0.17814598076194574,0.13887351021978725,0.09212149983772845,0.04048400476531588],[0.2152638534631578,0.2051984637212956,0.18553839747793782,0.15720316715819355,0.12151857068790319,0.08015808715976021,0.03511946033175186],[0.2025782419255613,0.19843148532711158,0.1861610000155622,0.16626920581699392,0.13957067792615432,0.10715922046717194,0.07036604748810812,0.03075324199611727],[0.1894506104550685,0.18260341504492358,0.16915651939500254,0.14959598881657674,0.12462897125553388,0.09515851168249279,0.062253523938647894,0.027152459411754096]],h=Math.abs,f=Math.sqrt,t=Math.pow,n=Math.log2||function(j){return Math.log(j)*Math.LOG2E},v=0.000000000001,g=0.000000000000000112;function w(j,l,p){return j<l?l:j>p?p:j}function x(j,l,p){function b(M){var L=M*134217729,G=M-L,V=G+L,R=M-V;return[V,R]}var o=l*l-j*p,z=l*l+j*p;if(h(o)*3<z){var N=b(j),S=b(l),d=b(p),r=l*l,I=S[0]*S[0]-r+2*S[0]*S[1]+S[1]*S[1],B=j*p,_=N[0]*d[0]-B+N[0]*d[1]+N[1]*d[0]+N[1]*d[1];o=r-B+(I-_)}return o}function y(){var j=Math.max.apply(Math,arguments);return j&&(j<0.00000001||j>1e8)?t(2,-Math.round(n(j))):0}return{EPSILON:v,MACHINE_EPSILON:g,CURVETIME_EPSILON:0.00000001,GEOMETRIC_EPSILON:0.0000001,TRIGONOMETRIC_EPSILON:0.00000001,ANGULAR_EPSILON:0.00001,KAPPA:4*(f(2)-1)/3,isZero:function(j){return j>=-v&&j<=v},isMachineZero:function(j){return j>=-g&&j<=g},clamp:w,integrate:function(j,l,p,b){var o=i[b-2],z=u[b-2],N=(p-l)*0.5,S=N+l,d=0,r=b+1>>1,I=b&1?z[d++]*j(S):0;while(d<r){var B=N*o[d];I+=z[d++]*(j(S+B)+j(S-B))}return N*I},findRoot:function(j,l,p,b,o,z,N){for(var S=0;S<z;S++){var d=j(p),r=d/l(p),I=p-r;if(h(r)<N){p=I;break}if(d>0)o=p,p=I<=b?(b+o)*0.5:I;else b=p,p=I>=o?(b+o)*0.5:I}return w(p,b,o)},solveQuadratic:function(j,l,p,b,o,z){var N,S=Infinity;if(h(j)<v){if(h(l)<v)return h(p)<v?-1:0;N=-p/l}else{l*=-0.5;var d=x(j,l,p);if(d&&h(d)<g){var r=y(h(j),h(l),h(p));if(r)j*=r,l*=r,p*=r,d=x(j,l,p)}if(d>=-g){var I=d<0?0:f(d),B=l+(l<0?-I:I);if(B===0)N=p/j,S=-N;else N=B/j,S=p/B}}var _=0,M=o==null,L=o-v,G=z+v;if(isFinite(N)&&(M||N>L&&N<G))b[_++]=M?N:w(N,o,z);if(S!==N&&isFinite(S)&&(M||S>L&&S<G))b[_++]=M?S:w(S,o,z);return _},solveCubic:function(j,l,p,b,o,z,N){var S=y(h(j),h(l),h(p),h(b)),d,r,I,B,_;if(S)j*=S,l*=S,p*=S,b*=S;function M(X){d=X;var H=j*d;r=H+l,I=r*d+p,B=(H+r)*d+I,_=I*d+b}if(h(j)<v)j=l,r=p,I=b,d=Infinity;else if(h(b)<v)r=l,I=p,d=0;else{M(-(l/j)/3);var L=_/j,G=t(h(L),0.3333333333333333),V=L<0?-1:1,R=-B/j,q=R>0?1.324717957244746*Math.max(G,f(R)):G,E=d-V*q;if(E!==d){do M(E),E=B===0?d:d-_/B/(1+g);while(V*E>V*d);if(h(j)*d*d>h(b/d))I=-b/d,r=(I-p)/d}}var e=v0.solveQuadratic(j,r,I,o,z,N),O=z==null;if(isFinite(d)&&(e===0||e>0&&d!==o[0]&&d!==o[1])&&(O||d>z-v&&d<N+v))o[e++]=O?d:w(d,z,N);return e}}},r0={_id:1,_pools:{},get:function(i){if(i){var u=this._pools[i];if(!u)u=this._pools[i]={_id:1};return u._id++}else return this._id++}},A=k.extend({_class:"Point",_readIndex:!0,initialize:function i(u,h){var f=typeof u,t=this.__read,n=0;if(f==="number"){var v=typeof h==="number";if(this._set(u,v?h:u),t)n=v?2:1}else if(f==="undefined"||u===null){if(this._set(0,0),t)n=u===null?1:0}else{var g=f==="string"?u.split(/[\s,]+/)||[]:u;if(n=1,Array.isArray(g))this._set(+g[0],+(g.length>1?g[1]:g[0]));else if("x"in g)this._set(g.x||0,g.y||0);else if("width"in g)this._set(g.width||0,g.height||0);else if("angle"in g)this._set(g.length||0,0),this.setAngle(g.angle||0);else this._set(0,0),n=0}if(t)this.__read=n;return this},set:"#initialize",_set:function(i,u){return this.x=i,this.y=u,this},equals:function(i){return this===i||i&&(this.x===i.x&&this.y===i.y||Array.isArray(i)&&this.x===i[0]&&this.y===i[1])||!1},clone:function(){return new A(this.x,this.y)},toString:function(){var i=p0.instance;return"{ x: "+i.number(this.x)+", y: "+i.number(this.y)+" }"},_serialize:function(i){var u=i.formatter;return[u.number(this.x),u.number(this.y)]},getLength:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},setLength:function(i){if(this.isZero()){var u=this._angle||0;this._set(Math.cos(u)*i,Math.sin(u)*i)}else{var h=i/this.getLength();if(v0.isZero(h))this.getAngle();this._set(this.x*h,this.y*h)}},getAngle:function(){return this.getAngleInRadians.apply(this,arguments)*180/Math.PI},setAngle:function(i){this.setAngleInRadians.call(this,i*Math.PI/180)},getAngleInDegrees:"#getAngle",setAngleInDegrees:"#setAngle",getAngleInRadians:function(){if(!arguments.length)return this.isZero()?this._angle||0:this._angle=Math.atan2(this.y,this.x);else{var i=A.read(arguments),u=this.getLength()*i.getLength();if(v0.isZero(u))return NaN;else{var h=this.dot(i)/u;return Math.acos(h<-1?-1:h>1?1:h)}}},setAngleInRadians:function(i){if(this._angle=i,!this.isZero()){var u=this.getLength();this._set(Math.cos(i)*u,Math.sin(i)*u)}},getQuadrant:function(){return this.x>=0?this.y>=0?1:4:this.y>=0?2:3}},{beans:!1,getDirectedAngle:function(){var i=A.read(arguments);return Math.atan2(this.cross(i),this.dot(i))*180/Math.PI},getDistance:function(){var i=arguments,u=A.read(i),h=u.x-this.x,f=u.y-this.y,t=h*h+f*f,n=k.read(i);return n?t:Math.sqrt(t)},normalize:function(i){if(i===D)i=1;var u=this.getLength(),h=u!==0?i/u:0,f=new A(this.x*h,this.y*h);if(h>=0)f._angle=this._angle;return f},rotate:function(i,u){if(i===0)return this.clone();i=i*Math.PI/180;var h=u?this.subtract(u):this,f=Math.sin(i),t=Math.cos(i);return h=new A(h.x*t-h.y*f,h.x*f+h.y*t),u?h.add(u):h},transform:function(i){return i?i._transformPoint(this):this},add:function(){var i=A.read(arguments);return new A(this.x+i.x,this.y+i.y)},subtract:function(){var i=A.read(arguments);return new A(this.x-i.x,this.y-i.y)},multiply:function(){var i=A.read(arguments);return new A(this.x*i.x,this.y*i.y)},divide:function(){var i=A.read(arguments);return new A(this.x/i.x,this.y/i.y)},modulo:function(){var i=A.read(arguments);return new A(this.x%i.x,this.y%i.y)},negate:function(){return new A(-this.x,-this.y)},isInside:function(){return u0.read(arguments).contains(this)},isClose:function(){var i=arguments,u=A.read(i),h=k.read(i);return this.getDistance(u)<=h},isCollinear:function(){var i=A.read(arguments);return A.isCollinear(this.x,this.y,i.x,i.y)},isColinear:"#isCollinear",isOrthogonal:function(){var i=A.read(arguments);return A.isOrthogonal(this.x,this.y,i.x,i.y)},isZero:function(){var i=v0.isZero;return i(this.x)&&i(this.y)},isNaN:function(){return isNaN(this.x)||isNaN(this.y)},isInQuadrant:function(i){return this.x*(i>1&&i<4?-1:1)>=0&&this.y*(i>2?-1:1)>=0},dot:function(){var i=A.read(arguments);return this.x*i.x+this.y*i.y},cross:function(){var i=A.read(arguments);return this.x*i.y-this.y*i.x},project:function(){var i=A.read(arguments),u=i.isZero()?0:this.dot(i)/i.dot(i);return new A(i.x*u,i.y*u)},statics:{min:function(){var i=arguments,u=A.read(i),h=A.read(i);return new A(Math.min(u.x,h.x),Math.min(u.y,h.y))},max:function(){var i=arguments,u=A.read(i),h=A.read(i);return new A(Math.max(u.x,h.x),Math.max(u.y,h.y))},random:function(){return new A(Math.random(),Math.random())},isCollinear:function(i,u,h,f){return Math.abs(i*f-u*h)<=Math.sqrt((i*i+u*u)*(h*h+f*f))*0.00000001},isOrthogonal:function(i,u,h,f){return Math.abs(i*h+u*f)<=Math.sqrt((i*i+u*u)*(h*h+f*f))*0.00000001}}},k.each(["round","ceil","floor","abs"],function(i){var u=Math[i];this[i]=function(){return new A(u(this.x),u(this.y))}},{})),J=A.extend({initialize:function i(u,h,f,t){this._x=u,this._y=h,this._owner=f,this._setter=t},_set:function(i,u,h){if(this._x=i,this._y=u,!h)this._owner[this._setter](this);return this},getX:function(){return this._x},setX:function(i){this._x=i,this._owner[this._setter](this)},getY:function(){return this._y},setY:function(i){this._y=i,this._owner[this._setter](this)},isSelected:function(){return!!(this._owner._selection&this._getSelection())},setSelected:function(i){this._owner._changeSelection(this._getSelection(),i)},_getSelection:function(){return this._setter==="setPosition"?4:0}}),W=k.extend({_class:"Size",_readIndex:!0,initialize:function i(u,h){var f=typeof u,t=this.__read,n=0;if(f==="number"){var v=typeof h==="number";if(this._set(u,v?h:u),t)n=v?2:1}else if(f==="undefined"||u===null){if(this._set(0,0),t)n=u===null?1:0}else{var g=f==="string"?u.split(/[\s,]+/)||[]:u;if(n=1,Array.isArray(g))this._set(+g[0],+(g.length>1?g[1]:g[0]));else if("width"in g)this._set(g.width||0,g.height||0);else if("x"in g)this._set(g.x||0,g.y||0);else this._set(0,0),n=0}if(t)this.__read=n;return this},set:"#initialize",_set:function(i,u){return this.width=i,this.height=u,this},equals:function(i){return i===this||i&&(this.width===i.width&&this.height===i.height||Array.isArray(i)&&this.width===i[0]&&this.height===i[1])||!1},clone:function(){return new W(this.width,this.height)},toString:function(){var i=p0.instance;return"{ width: "+i.number(this.width)+", height: "+i.number(this.height)+" }"},_serialize:function(i){var u=i.formatter;return[u.number(this.width),u.number(this.height)]},add:function(){var i=W.read(arguments);return new W(this.width+i.width,this.height+i.height)},subtract:function(){var i=W.read(arguments);return new W(this.width-i.width,this.height-i.height)},multiply:function(){var i=W.read(arguments);return new W(this.width*i.width,this.height*i.height)},divide:function(){var i=W.read(arguments);return new W(this.width/i.width,this.height/i.height)},modulo:function(){var i=W.read(arguments);return new W(this.width%i.width,this.height%i.height)},negate:function(){return new W(-this.width,-this.height)},isZero:function(){var i=v0.isZero;return i(this.width)&&i(this.height)},isNaN:function(){return isNaN(this.width)||isNaN(this.height)},statics:{min:function(i,u){return new W(Math.min(i.width,u.width),Math.min(i.height,u.height))},max:function(i,u){return new W(Math.max(i.width,u.width),Math.max(i.height,u.height))},random:function(){return new W(Math.random(),Math.random())}}},k.each(["round","ceil","floor","abs"],function(i){var u=Math[i];this[i]=function(){return new W(u(this.width),u(this.height))}},{})),u6=W.extend({initialize:function i(u,h,f,t){this._width=u,this._height=h,this._owner=f,this._setter=t},_set:function(i,u,h){if(this._width=i,this._height=u,!h)this._owner[this._setter](this);return this},getWidth:function(){return this._width},setWidth:function(i){this._width=i,this._owner[this._setter](this)},getHeight:function(){return this._height},setHeight:function(i){this._height=i,this._owner[this._setter](this)}}),u0=k.extend({_class:"Rectangle",_readIndex:!0,beans:!0,initialize:function i(u,h,f,t){var n=arguments,v=typeof u,g;if(v==="number")this._set(u,h,f,t),g=4;else if(v==="undefined"||u===null)this._set(0,0,0,0),g=u===null?1:0;else if(n.length===1){if(Array.isArray(u))this._set.apply(this,u),g=1;else if(u.x!==D||u.width!==D)this._set(u.x||0,u.y||0,u.width||0,u.height||0),g=1;else if(u.from===D&&u.to===D){if(this._set(0,0,0,0),k.readSupported(n,this))g=1}}if(g===D){var w=A.readNamed(n,"from"),x=k.peek(n),y=w.x,j=w.y,l,p;if(x&&x.x!==D||k.hasNamed(n,"to")){var b=A.readNamed(n,"to");if(l=b.x-y,p=b.y-j,l<0)y=b.x,l=-l;if(p<0)j=b.y,p=-p}else{var o=W.read(n);l=o.width,p=o.height}this._set(y,j,l,p),g=n.__index}var z=n.__filtered;if(z)this.__filtered=z;if(this.__read)this.__read=g;return this},set:"#initialize",_set:function(i,u,h,f){return this.x=i,this.y=u,this.width=h,this.height=f,this},clone:function(){return new u0(this.x,this.y,this.width,this.height)},equals:function(i){var u=k.isPlainValue(i)?u0.read(arguments):i;return u===this||u&&this.x===u.x&&this.y===u.y&&this.width===u.width&&this.height===u.height||!1},toString:function(){var i=p0.instance;return"{ x: "+i.number(this.x)+", y: "+i.number(this.y)+", width: "+i.number(this.width)+", height: "+i.number(this.height)+" }"},_serialize:function(i){var u=i.formatter;return[u.number(this.x),u.number(this.y),u.number(this.width),u.number(this.height)]},getPoint:function(i){var u=i?A:J;return new u(this.x,this.y,this,"setPoint")},setPoint:function(){var i=A.read(arguments);this.x=i.x,this.y=i.y},getSize:function(i){var u=i?W:u6;return new u(this.width,this.height,this,"setSize")},_fw:1,_fh:1,setSize:function(){var i=W.read(arguments),u=this._sx,h=this._sy,f=i.width,t=i.height;if(u)this.x+=(this.width-f)*u;if(h)this.y+=(this.height-t)*h;this.width=f,this.height=t,this._fw=this._fh=1},getLeft:function(){return this.x},setLeft:function(i){if(!this._fw){var u=i-this.x;this.width-=this._sx===0.5?u*2:u}this.x=i,this._sx=this._fw=0},getTop:function(){return this.y},setTop:function(i){if(!this._fh){var u=i-this.y;this.height-=this._sy===0.5?u*2:u}this.y=i,this._sy=this._fh=0},getRight:function(){return this.x+this.width},setRight:function(i){if(!this._fw){var u=i-this.x;this.width=this._sx===0.5?u*2:u}this.x=i-this.width,this._sx=1,this._fw=0},getBottom:function(){return this.y+this.height},setBottom:function(i){if(!this._fh){var u=i-this.y;this.height=this._sy===0.5?u*2:u}this.y=i-this.height,this._sy=1,this._fh=0},getCenterX:function(){return this.x+this.width/2},setCenterX:function(i){if(this._fw||this._sx===0.5)this.x=i-this.width/2;else{if(this._sx)this.x+=(i-this.x)*2*this._sx;this.width=(i-this.x)*2}this._sx=0.5,this._fw=0},getCenterY:function(){return this.y+this.height/2},setCenterY:function(i){if(this._fh||this._sy===0.5)this.y=i-this.height/2;else{if(this._sy)this.y+=(i-this.y)*2*this._sy;this.height=(i-this.y)*2}this._sy=0.5,this._fh=0},getCenter:function(i){var u=i?A:J;return new u(this.getCenterX(),this.getCenterY(),this,"setCenter")},setCenter:function(){var i=A.read(arguments);return this.setCenterX(i.x),this.setCenterY(i.y),this},getArea:function(){return this.width*this.height},isEmpty:function(){return this.width===0||this.height===0},contains:function(i){return i&&i.width!==D||(Array.isArray(i)?i:arguments).length===4?this._containsRectangle(u0.read(arguments)):this._containsPoint(A.read(arguments))},_containsPoint:function(i){var{x:u,y:h}=i;return u>=this.x&&h>=this.y&&u<=this.x+this.width&&h<=this.y+this.height},_containsRectangle:function(i){var{x:u,y:h}=i;return u>=this.x&&h>=this.y&&u+i.width<=this.x+this.width&&h+i.height<=this.y+this.height},intersects:function(){var i=u0.read(arguments),u=k.read(arguments)||0;return i.x+i.width>this.x-u&&i.y+i.height>this.y-u&&i.x<this.x+this.width+u&&i.y<this.y+this.height+u},intersect:function(){var i=u0.read(arguments),u=Math.max(this.x,i.x),h=Math.max(this.y,i.y),f=Math.min(this.x+this.width,i.x+i.width),t=Math.min(this.y+this.height,i.y+i.height);return new u0(u,h,f-u,t-h)},unite:function(){var i=u0.read(arguments),u=Math.min(this.x,i.x),h=Math.min(this.y,i.y),f=Math.max(this.x+this.width,i.x+i.width),t=Math.max(this.y+this.height,i.y+i.height);return new u0(u,h,f-u,t-h)},include:function(){var i=A.read(arguments),u=Math.min(this.x,i.x),h=Math.min(this.y,i.y),f=Math.max(this.x+this.width,i.x),t=Math.max(this.y+this.height,i.y);return new u0(u,h,f-u,t-h)},expand:function(){var i=W.read(arguments),u=i.width,h=i.height;return new u0(this.x-u/2,this.y-h/2,this.width+u,this.height+h)},scale:function(i,u){return this.expand(this.width*i-this.width,this.height*(u===D?i:u)-this.height)}},k.each([["Top","Left"],["Top","Right"],["Bottom","Left"],["Bottom","Right"],["Left","Center"],["Top","Center"],["Right","Center"],["Bottom","Center"]],function(i,u){var h=i.join(""),f=/^[RL]/.test(h);if(u>=4)i[1]+=f?"Y":"X";var t=i[f?0:1],n=i[f?1:0],v="get"+t,g="get"+n,w="set"+t,x="set"+n,y="get"+h,j="set"+h;this[y]=function(l){var p=l?A:J;return new p(this[v](),this[g](),this,j)},this[j]=function(){var l=A.read(arguments);this[w](l.x),this[x](l.y)}},{beans:!0})),H0=u0.extend({initialize:function i(u,h,f,t,n,v){this._set(u,h,f,t,!0),this._owner=n,this._setter=v},_set:function(i,u,h,f,t){if(this._x=i,this._y=u,this._width=h,this._height=f,!t)this._owner[this._setter](this);return this}},new function(){var i=u0.prototype;return k.each(["x","y","width","height"],function(u){var h=k.capitalize(u),f="_"+u;this["get"+h]=function(){return this[f]},this["set"+h]=function(t){if(this[f]=t,!this._dontNotify)this._owner[this._setter](this)}},k.each(["Point","Size","Center","Left","Top","Right","Bottom","CenterX","CenterY","TopLeft","TopRight","BottomLeft","BottomRight","LeftCenter","TopCenter","RightCenter","BottomCenter"],function(u){var h="set"+u;this[h]=function(){this._dontNotify=!0,i[h].apply(this,arguments),this._dontNotify=!1,this._owner[this._setter](this)}},{isSelected:function(){return!!(this._owner._selection&2)},setSelected:function(u){var h=this._owner;if(h._changeSelection)h._changeSelection(2,u)}}))}),j0=k.extend({_class:"Matrix",initialize:function i(u,h){var f=arguments,t=f.length,n=!0;if(t>=6)this._set.apply(this,f);else if(t===1||t===2)if(u instanceof i)this._set(u._a,u._b,u._c,u._d,u._tx,u._ty,h);else if(Array.isArray(u))this._set.apply(this,h?u.concat([h]):u);else n=!1;else if(!t)this.reset();else n=!1;if(!n)throw new Error("Unsupported matrix parameters");return this},set:"#initialize",_set:function(i,u,h,f,t,n,v){if(this._a=i,this._b=u,this._c=h,this._d=f,this._tx=t,this._ty=n,!v)this._changed();return this},_serialize:function(i,u){return k.serialize(this.getValues(),i,!0,u)},_changed:function(){var i=this._owner;if(i)if(i._applyMatrix)i.transform(null,!0);else i._changed(25)},clone:function(){return new j0(this._a,this._b,this._c,this._d,this._tx,this._ty)},equals:function(i){return i===this||i&&this._a===i._a&&this._b===i._b&&this._c===i._c&&this._d===i._d&&this._tx===i._tx&&this._ty===i._ty},toString:function(){var i=p0.instance;return"[["+[i.number(this._a),i.number(this._c),i.number(this._tx)].join(", ")+"], ["+[i.number(this._b),i.number(this._d),i.number(this._ty)].join(", ")+"]]"},reset:function(i){if(this._a=this._d=1,this._b=this._c=this._tx=this._ty=0,!i)this._changed();return this},apply:function(i,u){var h=this._owner;if(h)return h.transform(null,k.pick(i,!0),u),this.isIdentity();return!1},translate:function(){var i=A.read(arguments),u=i.x,h=i.y;return this._tx+=u*this._a+h*this._c,this._ty+=u*this._b+h*this._d,this._changed(),this},scale:function(){var i=arguments,u=A.read(i),h=A.read(i,0,{readNull:!0});if(h)this.translate(h);if(this._a*=u.x,this._b*=u.x,this._c*=u.y,this._d*=u.y,h)this.translate(h.negate());return this._changed(),this},rotate:function(i){i*=Math.PI/180;var u=A.read(arguments,1),h=u.x,f=u.y,t=Math.cos(i),n=Math.sin(i),v=h-h*t+f*n,g=f-h*n-f*t,w=this._a,x=this._b,y=this._c,j=this._d;return this._a=t*w+n*y,this._b=t*x+n*j,this._c=-n*w+t*y,this._d=-n*x+t*j,this._tx+=v*w+g*y,this._ty+=v*x+g*j,this._changed(),this},shear:function(){var i=arguments,u=A.read(i),h=A.read(i,0,{readNull:!0});if(h)this.translate(h);var f=this._a,t=this._b;if(this._a+=u.y*this._c,this._b+=u.y*this._d,this._c+=u.x*f,this._d+=u.x*t,h)this.translate(h.negate());return this._changed(),this},skew:function(){var i=arguments,u=A.read(i),h=A.read(i,0,{readNull:!0}),f=Math.PI/180,t=new A(Math.tan(u.x*f),Math.tan(u.y*f));return this.shear(t,h)},append:function(i,u){if(i){var h=this._a,f=this._b,t=this._c,n=this._d,v=i._a,g=i._c,w=i._b,x=i._d,y=i._tx,j=i._ty;if(this._a=v*h+w*t,this._c=g*h+x*t,this._b=v*f+w*n,this._d=g*f+x*n,this._tx+=y*h+j*t,this._ty+=y*f+j*n,!u)this._changed()}return this},prepend:function(i,u){if(i){var h=this._a,f=this._b,t=this._c,n=this._d,v=this._tx,g=this._ty,w=i._a,x=i._c,y=i._b,j=i._d,l=i._tx,p=i._ty;if(this._a=w*h+x*f,this._c=w*t+x*n,this._b=y*h+j*f,this._d=y*t+j*n,this._tx=w*v+x*g+l,this._ty=y*v+j*g+p,!u)this._changed()}return this},appended:function(i){return this.clone().append(i)},prepended:function(i){return this.clone().prepend(i)},invert:function(){var i=this._a,u=this._b,h=this._c,f=this._d,t=this._tx,n=this._ty,v=i*f-u*h,g=null;if(v&&!isNaN(v)&&isFinite(t)&&isFinite(n))this._a=f/v,this._b=-u/v,this._c=-h/v,this._d=i/v,this._tx=(h*n-f*t)/v,this._ty=(u*t-i*n)/v,g=this;return g},inverted:function(){return this.clone().invert()},concatenate:"#append",preConcatenate:"#prepend",chain:"#appended",_shiftless:function(){return new j0(this._a,this._b,this._c,this._d,0,0)},_orNullIfIdentity:function(){return this.isIdentity()?null:this},isIdentity:function(){return this._a===1&&this._b===0&&this._c===0&&this._d===1&&this._tx===0&&this._ty===0},isInvertible:function(){var i=this._a*this._d-this._c*this._b;return i&&!isNaN(i)&&isFinite(this._tx)&&isFinite(this._ty)},isSingular:function(){return!this.isInvertible()},transform:function(i,u,h){return arguments.length<3?this._transformPoint(A.read(arguments)):this._transformCoordinates(i,u,h)},_transformPoint:function(i,u,h){var{x:f,y:t}=i;if(!u)u=new A;return u._set(f*this._a+t*this._c+this._tx,f*this._b+t*this._d+this._ty,h)},_transformCoordinates:function(i,u,h){for(var f=0,t=2*h;f<t;f+=2){var n=i[f],v=i[f+1];u[f]=n*this._a+v*this._c+this._tx,u[f+1]=n*this._b+v*this._d+this._ty}return u},_transformCorners:function(i){var{x:u,y:h}=i,f=u+i.width,t=h+i.height,n=[u,h,f,h,f,t,u,t];return this._transformCoordinates(n,n,4)},_transformBounds:function(i,u,h){var f=this._transformCorners(i),t=f.slice(0,2),n=t.slice();for(var v=2;v<8;v++){var g=f[v],w=v&1;if(g<t[w])t[w]=g;else if(g>n[w])n[w]=g}if(!u)u=new u0;return u._set(t[0],t[1],n[0]-t[0],n[1]-t[1],h)},inverseTransform:function(){return this._inverseTransform(A.read(arguments))},_inverseTransform:function(i,u,h){var f=this._a,t=this._b,n=this._c,v=this._d,g=this._tx,w=this._ty,x=f*v-t*n,y=null;if(x&&!isNaN(x)&&isFinite(g)&&isFinite(w)){var j=i.x-this._tx,l=i.y-this._ty;if(!u)u=new A;y=u._set((j*v-l*n)/x,(l*f-j*t)/x,h)}return y},decompose:function(){var i=this._a,u=this._b,h=this._c,f=this._d,t=i*f-u*h,n=Math.sqrt,v=Math.atan2,g=180/Math.PI,w,x,y;if(i!==0||u!==0){var j=n(i*i+u*u);w=Math.acos(i/j)*(u>0?1:-1),x=[j,t/j],y=[v(i*h+u*f,j*j),0]}else if(h!==0||f!==0){var l=n(h*h+f*f);w=Math.asin(h/l)*(f>0?1:-1),x=[t/l,l],y=[0,v(i*h+u*f,l*l)]}else w=0,y=x=[0,0];return{translation:this.getTranslation(),rotation:w*g,scaling:new A(x),skewing:new A(y[0]*g,y[1]*g)}},getValues:function(){return[this._a,this._b,this._c,this._d,this._tx,this._ty]},getTranslation:function(){return new A(this._tx,this._ty)},getScaling:function(){return this.decompose().scaling},getRotation:function(){return this.decompose().rotation},applyToContext:function(i){if(!this.isIdentity())i.transform(this._a,this._b,this._c,this._d,this._tx,this._ty)}},k.each(["a","b","c","d","tx","ty"],function(i){var u=k.capitalize(i),h="_"+i;this["get"+u]=function(){return this[h]},this["set"+u]=function(f){this[h]=f,this._changed()}},{})),k0=k.extend({_class:"Line",initialize:function i(u,h,f,t,n){var v=!1;if(arguments.length>=4)this._px=u,this._py=h,this._vx=f,this._vy=t,v=n;else this._px=u.x,this._py=u.y,this._vx=h.x,this._vy=h.y,v=f;if(!v)this._vx-=this._px,this._vy-=this._py},getPoint:function(){return new A(this._px,this._py)},getVector:function(){return new A(this._vx,this._vy)},getLength:function(){return this.getVector().getLength()},intersect:function(i,u){return k0.intersect(this._px,this._py,this._vx,this._vy,i._px,i._py,i._vx,i._vy,!0,u)},getSide:function(i,u){return k0.getSide(this._px,this._py,this._vx,this._vy,i.x,i.y,!0,u)},getDistance:function(i){return Math.abs(this.getSignedDistance(i))},getSignedDistance:function(i){return k0.getSignedDistance(this._px,this._py,this._vx,this._vy,i.x,i.y,!0)},isCollinear:function(i){return A.isCollinear(this._vx,this._vy,i._vx,i._vy)},isOrthogonal:function(i){return A.isOrthogonal(this._vx,this._vy,i._vx,i._vy)},statics:{intersect:function(i,u,h,f,t,n,v,g,w,x){if(!w)h-=i,f-=u,v-=t,g-=n;var y=h*g-f*v;if(!v0.isMachineZero(y)){var j=i-t,l=u-n,p=(v*l-g*j)/y,b=(h*l-f*j)/y,o=0.000000000001,z=-o,N=1+o;if(x||z<p&&p<N&&z<b&&b<N){if(!x)p=p<=0?0:p>=1?1:p;return new A(i+p*h,u+p*f)}}},getSide:function(i,u,h,f,t,n,v,g){if(!v)h-=i,f-=u;var w=t-i,x=n-u,y=w*f-x*h;if(!g&&v0.isMachineZero(y)){if(y=(w*h+w*h)/(h*h+f*f),y>=0&&y<=1)y=0}return y<0?-1:y>0?1:0},getSignedDistance:function(i,u,h,f,t,n,v){if(!v)h-=i,f-=u;return h===0?f>0?t-i:i-t:f===0?h<0?n-u:u-n:((t-i)*f-(n-u)*h)/(f>h?f*Math.sqrt(1+h*h/(f*f)):h*Math.sqrt(1+f*f/(h*h)))},getDistance:function(i,u,h,f,t,n,v){return Math.abs(k0.getSignedDistance(i,u,h,f,t,n,v))}}}),v6=I0.extend({_class:"Project",_list:"projects",_reference:"project",_compactSerialize:!0,initialize:function i(u){I0.call(this,!0),this._children=[],this._namedChildren={},this._activeLayer=null,this._currentStyle=new Q6(null,null,this),this._view=L0.create(this,u||D0.getCanvas(1,1)),this._selectionItems={},this._selectionCount=0,this._updateVersion=0},_serialize:function(i,u){return k.serialize(this._children,i,!0,u)},_changed:function(i,u){if(i&1){var h=this._view;if(h){if(h._needsUpdate=!0,!h._requested&&h._autoUpdate)h.requestUpdate()}}var f=this._changes;if(f&&u){var t=this._changesById,n=u._id,v=t[n];if(v)v.flags|=i;else f.push(t[n]={item:u,flags:i})}},clear:function(){var i=this._children;for(var u=i.length-1;u>=0;u--)i[u].remove()},isEmpty:function(){return!this._children.length},remove:function i(){if(!i.base.call(this))return!1;if(this._view)this._view.remove();return!0},getView:function(){return this._view},getCurrentStyle:function(){return this._currentStyle},setCurrentStyle:function(i){this._currentStyle.set(i)},getIndex:function(){return this._index},getOptions:function(){return this._scope.settings},getLayers:function(){return this._children},getActiveLayer:function(){return this._activeLayer||new k6({project:this,insert:!0})},getSymbolDefinitions:function(){var i=[],u={};return this.getItems({class:K6,match:function(h){var f=h._definition,t=f._id;if(!u[t])u[t]=!0,i.push(f);return!1}}),i},getSymbols:"getSymbolDefinitions",getSelectedItems:function(){var i=this._selectionItems,u=[];for(var h in i){var f=i[h],t=f._selection;if(t&1&&f.isInserted())u.push(f);else if(!t)this._updateSelection(f)}return u},_updateSelection:function(i){var u=i._id,h=this._selectionItems;if(i._selection){if(h[u]!==i)this._selectionCount++,h[u]=i}else if(h[u]===i)this._selectionCount--,delete h[u]},selectAll:function(){var i=this._children;for(var u=0,h=i.length;u<h;u++)i[u].setFullySelected(!0)},deselectAll:function(){var i=this._selectionItems;for(var u in i)i[u].setFullySelected(!1)},addLayer:function(i){return this.insertLayer(D,i)},insertLayer:function(i,u){if(u instanceof k6){u._remove(!1,!0),k.splice(this._children,[u],i,0),u._setProject(this,!0);var h=u._name;if(h)u.setName(h);if(this._changes)u._changed(5);if(!this._activeLayer)this._activeLayer=u}else u=null;return u},_insertItem:function(i,u,h){if(u=this.insertLayer(i,u)||(this._activeLayer||this._insertItem(D,new k6(m0.NO_INSERT),!0)).insertChild(i,u),h&&u.activate)u.activate();return u},getItems:function(i){return m0._getItems(this,i)},getItem:function(i){return m0._getItems(this,i,null,null,!0)[0]||null},importJSON:function(i){this.activate();var u=this._activeLayer;return k.importJSON(i,u&&u.isEmpty()&&u)},removeOn:function(i){var u=this._removeSets;if(u){if(i==="mouseup")u.mousedrag=null;var h=u[i];if(h){for(var f in h){var t=h[f];for(var n in u){var v=u[n];if(v&&v!=h)delete v[t._id]}t.remove()}u[i]=null}}},draw:function(i,u,h){this._updateVersion++,i.save(),u.applyToContext(i);var f=this._children,t=new k({offset:new A(0,0),pixelRatio:h,viewMatrix:u.isIdentity()?null:u,matrices:[new j0],updateMatrix:!0});for(var n=0,v=f.length;n<v;n++)f[n].draw(i,t);if(i.restore(),this._selectionCount>0){i.save(),i.strokeWidth=1;var g=this._selectionItems,w=this._scope.settings.handleSize,x=this._updateVersion;for(var y in g)g[y]._drawSelection(i,u,w,g,x);i.restore()}}}),m0=k.extend($,{statics:{extend:function i(u){if(u._serializeFields)u._serializeFields=k.set({},this.prototype._serializeFields,u._serializeFields);return i.base.apply(this,arguments)},INSERT:{insert:!0},NO_INSERT:{insert:!1}},_class:"Item",_name:null,_applyMatrix:!0,_canApplyMatrix:!0,_canScaleStroke:!1,_pivot:null,_visible:!0,_blendMode:"normal",_opacity:1,_locked:!1,_guide:!1,_clipMask:!1,_selection:0,_selectBounds:!0,_selectChildren:!1,_serializeFields:{name:null,applyMatrix:null,matrix:new j0,pivot:null,visible:!0,blendMode:"normal",opacity:1,locked:!1,guide:!1,clipMask:!1,selected:!1,data:{}},_prioritize:["applyMatrix"]},new function(){var i=["onMouseDown","onMouseUp","onMouseDrag","onClick","onDoubleClick","onMouseMove","onMouseEnter","onMouseLeave"];return k.each(i,function(u){this._events[u]={install:function(h){this.getView()._countItemEvent(h,1)},uninstall:function(h){this.getView()._countItemEvent(h,-1)}}},{_events:{onFrame:{install:function(){this.getView()._animateItem(this,!0)},uninstall:function(){this.getView()._animateItem(this,!1)}},onLoad:{},onError:{}},statics:{_itemHandlers:i}})},{initialize:function i(){},_initialize:function(i,u){var h=i&&k.isPlainObject(i),f=h&&i.internal===!0,t=this._matrix=new j0,n=h&&i.project||P0.project,v=P0.settings;if(this._id=f?null:r0.get(),this._parent=this._index=null,this._applyMatrix=this._canApplyMatrix&&v.applyMatrix,u)t.translate(u);if(t._owner=this,this._style=new Q6(n._currentStyle,this,n),f||h&&i.insert==!1||!v.insertItems&&!(h&&i.insert==!0))this._setProject(n);else(h&&i.parent||n)._insertItem(D,this,!0);if(h&&i!==m0.NO_INSERT&&i!==m0.INSERT)this.set(i,{internal:!0,insert:!0,project:!0,parent:!0});return h},_serialize:function(i,u){var h={},f=this;function t(n){for(var v in n){var g=f[v];if(!k.equals(g,v==="leading"?n.fontSize*1.2:n[v]))h[v]=k.serialize(g,i,v!=="data",u)}}if(t(this._serializeFields),!(this instanceof q0))t(this._style._defaults);return[this._class,h]},_changed:function(i){var u=this._symbol,h=this._parent||u,f=this._project;if(i&8)this._bounds=this._position=this._decomposed=D;if(i&16)this._globalMatrix=D;if(h&&i&72)m0._clearBoundsCache(h);if(i&2)m0._clearBoundsCache(this);if(f)f._changed(i,this);if(u)u._changed(i)},getId:function(){return this._id},getName:function(){return this._name},setName:function(i){if(this._name)this._removeNamed();if(i===+i+"")throw new Error("Names consisting only of numbers are not supported.");var u=this._getOwner();if(i&&u){var{_children:h,_namedChildren:f}=u;if((f[i]=f[i]||[]).push(this),!(i in h))h[i]=this}this._name=i||D,this._changed(256)},getStyle:function(){return this._style},setStyle:function(i){this.getStyle().set(i)}},k.each(["locked","visible","blendMode","opacity","guide"],function(i){var u=k.capitalize(i),h="_"+i,f={locked:256,visible:265};this["get"+u]=function(){return this[h]},this["set"+u]=function(t){if(t!=this[h])this[h]=t,this._changed(f[i]||257)}},{}),{beans:!0,getSelection:function(){return this._selection},setSelection:function(i){if(i!==this._selection){this._selection=i;var u=this._project;if(u)u._updateSelection(this),this._changed(257)}},_changeSelection:function(i,u){var h=this._selection;this.setSelection(u?h|i:h&~i)},isSelected:function(){if(this._selectChildren){var i=this._children;for(var u=0,h=i.length;u<h;u++)if(i[u].isSelected())return!0}return!!(this._selection&1)},setSelected:function(i){if(this._selectChildren){var u=this._children;for(var h=0,f=u.length;h<f;h++)u[h].setSelected(i)}this._changeSelection(1,i)},isFullySelected:function(){var i=this._children,u=!!(this._selection&1);if(i&&u){for(var h=0,f=i.length;h<f;h++)if(!i[h].isFullySelected())return!1;return!0}return u},setFullySelected:function(i){var u=this._children;if(u)for(var h=0,f=u.length;h<f;h++)u[h].setFullySelected(i);this._changeSelection(1,i)},isClipMask:function(){return this._clipMask},setClipMask:function(i){if(this._clipMask!=(i=!!i)){if(this._clipMask=i,i)this.setFillColor(null),this.setStrokeColor(null);if(this._changed(257),this._parent)this._parent._changed(2048)}},getData:function(){if(!this._data)this._data={};return this._data},setData:function(i){this._data=i},getPosition:function(i){var u=i?A:J,h=this._position||(this._position=this._getPositionFromBounds());return new u(h.x,h.y,this,"setPosition")},setPosition:function(){this.translate(A.read(arguments).subtract(this.getPosition(!0)))},_getPositionFromBounds:function(i){return this._pivot?this._matrix._transformPoint(this._pivot):(i||this.getBounds()).getCenter(!0)},getPivot:function(){var i=this._pivot;return i?new J(i.x,i.y,this,"setPivot"):null},setPivot:function(){this._pivot=A.read(arguments,0,{clone:!0,readNull:!0}),this._position=D}},k.each({getStrokeBounds:{stroke:!0},getHandleBounds:{handle:!0},getInternalBounds:{internal:!0}},function(i,u){this[u]=function(h){return this.getBounds(h,i)}},{beans:!0,getBounds:function(i,u){var h=u||i instanceof j0,f=k.set({},h?u:i,this._boundsOptions);if(!f.stroke||this.getStrokeScaling())f.cacheItem=this;var t=this._getCachedBounds(h&&i,f).rect;return!arguments.length?new H0(t.x,t.y,t.width,t.height,this,"setBounds"):t},setBounds:function(){var i=u0.read(arguments),u=this.getBounds(),h=this._matrix,f=new j0,t=i.getCenter();if(f.translate(t),i.width!=u.width||i.height!=u.height){if(!h.isInvertible())h.set(h._backup||new j0().translate(h.getTranslation())),u=this.getBounds();f.scale(u.width!==0?i.width/u.width:0,u.height!==0?i.height/u.height:0)}t=u.getCenter(),f.translate(-t.x,-t.y),this.transform(f)},_getBounds:function(i,u){var h=this._children;if(!h||!h.length)return new u0;return m0._updateBoundsCache(this,u.cacheItem),m0._getBounds(h,i,u)},_getBoundsCacheKey:function(i,u){return[i.stroke?1:0,i.handle?1:0,u?1:0].join("")},_getCachedBounds:function(i,u,h){i=i&&i._orNullIfIdentity();var f=u.internal&&!h,t=u.cacheItem,n=f?null:this._matrix._orNullIfIdentity(),v=t&&(!i||i.equals(n))&&this._getBoundsCacheKey(u,f),g=this._bounds;if(m0._updateBoundsCache(this._parent||this._symbol,t),v&&g&&v in g){var w=g[v];return{rect:w.rect.clone(),nonscaling:w.nonscaling}}var x=this._getBounds(i||n,u),y=x.rect||x,j=this._style,l=x.nonscaling||j.hasStroke()&&!j.getStrokeScaling();if(v){if(!g)this._bounds=g={};var w=g[v]={rect:y.clone(),nonscaling:l,internal:f}}return{rect:y,nonscaling:l}},_getStrokeMatrix:function(i,u){var h=this.getStrokeScaling()?null:u&&u.internal?this:this._parent||this._symbol&&this._symbol._item,f=h?h.getViewMatrix().invert():i;return f&&f._shiftless()},statics:{_updateBoundsCache:function(i,u){if(i&&u){var h=u._id,f=i._boundsCache=i._boundsCache||{ids:{},list:[]};if(!f.ids[h])f.list.push(u),f.ids[h]=u}},_clearBoundsCache:function(i){var u=i._boundsCache;if(u){i._bounds=i._position=i._boundsCache=D;for(var h=0,f=u.list,t=f.length;h<t;h++){var n=f[h];if(n!==i){if(n._bounds=n._position=D,n._boundsCache)m0._clearBoundsCache(n)}}}},_getBounds:function(i,u,h){var f=Infinity,t=-f,n=f,v=t,g=!1;h=h||{};for(var w=0,x=i.length;w<x;w++){var y=i[w];if(y._visible&&!y.isEmpty(!0)){var j=y._getCachedBounds(u&&u.appended(y._matrix),h,!0),l=j.rect;if(f=Math.min(l.x,f),n=Math.min(l.y,n),t=Math.max(l.x+l.width,t),v=Math.max(l.y+l.height,v),j.nonscaling)g=!0}}return{rect:isFinite(f)?new u0(f,n,t-f,v-n):new u0,nonscaling:g}}}}),{beans:!0,_decompose:function(){return this._applyMatrix?null:this._decomposed||(this._decomposed=this._matrix.decompose())},getRotation:function(){var i=this._decompose();return i?i.rotation:0},setRotation:function(i){var u=this.getRotation();if(u!=null&&i!=null){var h=this._decomposed;if(this.rotate(i-u),h)h.rotation=i,this._decomposed=h}},getScaling:function(){var i=this._decompose(),u=i&&i.scaling;return new J(u?u.x:1,u?u.y:1,this,"setScaling")},setScaling:function(){var i=this.getScaling(),u=A.read(arguments,0,{clone:!0,readNull:!0});if(i&&u&&!i.equals(u)){var h=this.getRotation(),f=this._decomposed,t=new j0,n=v0.isZero;if(n(i.x)||n(i.y)){if(t.translate(f.translation),h)t.rotate(h);t.scale(u.x,u.y),this._matrix.set(t)}else{var v=this.getPosition(!0);if(t.translate(v),h)t.rotate(h);if(t.scale(u.x/i.x,u.y/i.y),h)t.rotate(-h);t.translate(v.negate()),this.transform(t)}if(f)f.scaling=u,this._decomposed=f}},getMatrix:function(){return this._matrix},setMatrix:function(){var i=this._matrix;i.set.apply(i,arguments)},getGlobalMatrix:function(i){var u=this._globalMatrix;if(u){var h=this._parent,f=[];while(h){if(!h._globalMatrix){u=null;for(var t=0,n=f.length;t<n;t++)f[t]._globalMatrix=null;break}f.push(h),h=h._parent}}if(!u){u=this._globalMatrix=this._matrix.clone();var h=this._parent;if(h)u.prepend(h.getGlobalMatrix(!0))}return i?u:u.clone()},getViewMatrix:function(){return this.getGlobalMatrix().prepend(this.getView()._matrix)},getApplyMatrix:function(){return this._applyMatrix},setApplyMatrix:function(i){if(this._applyMatrix=this._canApplyMatrix&&!!i)this.transform(null,!0)},getTransformContent:"#getApplyMatrix",setTransformContent:"#setApplyMatrix"},{getProject:function(){return this._project},_setProject:function(i,u){if(this._project!==i){if(this._project)this._installEvents(!1);this._project=i;var h=this._children;for(var f=0,t=h&&h.length;f<t;f++)h[f]._setProject(i);u=!0}if(u)this._installEvents(!0)},getView:function(){return this._project._view},_installEvents:function i(u){i.base.call(this,u);var h=this._children;for(var f=0,t=h&&h.length;f<t;f++)h[f]._installEvents(u)},getLayer:function(){var i=this;while(i=i._parent)if(i instanceof k6)return i;return null},getParent:function(){return this._parent},setParent:function(i){return i.addChild(this)},_getOwner:"#getParent",getChildren:function(){return this._children},setChildren:function(i){this.removeChildren(),this.addChildren(i)},getFirstChild:function(){return this._children&&this._children[0]||null},getLastChild:function(){return this._children&&this._children[this._children.length-1]||null},getNextSibling:function(){var i=this._getOwner();return i&&i._children[this._index+1]||null},getPreviousSibling:function(){var i=this._getOwner();return i&&i._children[this._index-1]||null},getIndex:function(){return this._index},equals:function(i){return i===this||i&&this._class===i._class&&this._style.equals(i._style)&&this._matrix.equals(i._matrix)&&this._locked===i._locked&&this._visible===i._visible&&this._blendMode===i._blendMode&&this._opacity===i._opacity&&this._clipMask===i._clipMask&&this._guide===i._guide&&this._equals(i)||!1},_equals:function(i){return k.equals(this._children,i._children)},clone:function(i){var u=new this.constructor(m0.NO_INSERT),h=this._children,f=k.pick(i?i.insert:D,i===D||i===!0),t=k.pick(i?i.deep:D,!0);if(h)u.copyAttributes(this);if(!h||t)u.copyContent(this);if(!h)u.copyAttributes(this);if(f)u.insertAbove(this);var n=this._name,v=this._parent;if(n&&v){var h=v._children,g=n,w=1;while(h[n])n=g+" "+w++;if(n!==g)u.setName(n)}return u},copyContent:function(i){var u=i._children;for(var h=0,f=u&&u.length;h<f;h++)this.addChild(u[h].clone(!1),!0)},copyAttributes:function(i,u){this.setStyle(i._style);var h=["_locked","_visible","_blendMode","_opacity","_clipMask","_guide"];for(var f=0,t=h.length;f<t;f++){var n=h[f];if(i.hasOwnProperty(n))this[n]=i[n]}if(!u)this._matrix.set(i._matrix,!0);this.setApplyMatrix(i._applyMatrix),this.setPivot(i._pivot),this.setSelection(i._selection);var{_data:v,_name:g}=i;if(this._data=v?k.clone(v):null,g)this.setName(g)},rasterize:function(i,u){var h,f,t;if(k.isPlainObject(i))h=i.resolution,f=i.insert,t=i.raster;else h=i,f=u;if(!t)t=new _6(m0.NO_INSERT);var n=this.getStrokeBounds(),v=(h||this.getView().getResolution())/72,g=n.getTopLeft().floor(),w=n.getBottomRight().ceil(),x=new W(w.subtract(g)),y=x.multiply(v);if(t.setSize(y,!0),!y.isZero()){var j=t.getContext(!0),l=new j0().scale(v).translate(g.negate());j.save(),l.applyToContext(j),this.draw(j,new k({matrices:[l]})),j.restore()}if(t._matrix.set(new j0().translate(g.add(x.divide(2))).scale(1/v)),f===D||f)t.insertAbove(this);return t},contains:function(){var i=this._matrix;return i.isInvertible()&&!!this._contains(i._inverseTransform(A.read(arguments)))},_contains:function(i){var u=this._children;if(u){for(var h=u.length-1;h>=0;h--)if(u[h].contains(i))return!0;return!1}return i.isInside(this.getInternalBounds())},isInside:function(){return u0.read(arguments).contains(this.getBounds())},_asPathItem:function(){return new N0.Rectangle({rectangle:this.getInternalBounds(),matrix:this._matrix,insert:!1})},intersects:function(i,u){if(!(i instanceof m0))return!1;return this._asPathItem().getIntersections(i._asPathItem(),null,u,!0).length>0}},new function(){function i(){var f=arguments;return this._hitTest(A.read(f),w6.getOptions(f))}function u(){var f=arguments,t=A.read(f),n=w6.getOptions(f),v=[];return this._hitTest(t,new k({all:v},n)),v}function h(f,t,n,v){var g=this._children;if(g)for(var w=g.length-1;w>=0;w--){var x=g[w],y=x!==v&&x._hitTest(f,t,n);if(y&&!t.all)return y}return null}return v6.inject({hitTest:i,hitTestAll:u,_hitTest:h}),{hitTest:i,hitTestAll:u,_hitTestChildren:h}},{_hitTest:function(i,u,h){if(this._locked||!this._visible||this._guide&&!u.guides||this.isEmpty())return null;var f=this._matrix,t=h?h.appended(f):this.getGlobalMatrix().prepend(this.getView()._matrix),n=Math.max(u.tolerance,0.000000000001),v=u._tolerancePadding=new W(N0._getStrokePadding(n,f._shiftless().invert()));if(i=f._inverseTransform(i),!i||!this._children&&!this.getBounds({internal:!0,stroke:!0,handle:!0}).expand(v.multiply(2))._containsPoint(i))return null;var g=!(u.guides&&!this._guide||u.selected&&!this.isSelected()||u.type&&u.type!==k.hyphenate(this._class)||u.class&&!(this instanceof u.class)),w=u.match,x=this,y,j;function l(d){if(d&&w&&!w(d))d=null;if(d&&u.all)u.all.push(d);return d}function p(d,r){var I=r?y["get"+r]():x.getPosition();if(i.subtract(I).divide(v).length<=1)return new w6(d,x,{name:r?k.hyphenate(r):d,point:I})}var{position:b,center:o,bounds:z}=u;if(g&&this._parent&&(b||o||z)){if(o||z)y=this.getInternalBounds();if(j=b&&p("position")||o&&p("center","Center"),!j&&z){var N=["TopLeft","TopRight","BottomLeft","BottomRight","LeftCenter","TopCenter","RightCenter","BottomCenter"];for(var S=0;S<8&&!j;S++)j=p("bounds",N[S])}j=l(j)}if(!j)j=this._hitTestChildren(i,u,t)||g&&l(this._hitTestSelf(i,u,t,this.getStrokeScaling()?null:t._shiftless().invert()))||null;if(j&&j.point)j.point=f.transform(j.point);return j},_hitTestSelf:function(i,u){if(u.fill&&this.hasFill()&&this._contains(i))return new w6("fill",this)},matches:function(i,u){function h(v,g){for(var w in v)if(v.hasOwnProperty(w)){var x=v[w],y=g[w];if(k.isPlainObject(x)&&k.isPlainObject(y)){if(!h(x,y))return!1}else if(!k.equals(x,y))return!1}return!0}var f=typeof i;if(f==="object"){for(var t in i)if(i.hasOwnProperty(t)&&!this.matches(t,i[t]))return!1;return!0}else if(f==="function")return i(this);else if(i==="match")return u(this);else{var n=/^(empty|editable)$/.test(i)?this["is"+k.capitalize(i)]():i==="type"?k.hyphenate(this._class):this[i];if(i==="class"){if(typeof u==="function")return this instanceof u;n=this._class}if(typeof u==="function")return!!u(n);else if(u){if(u.test)return u.test(n);else if(k.isPlainObject(u))return h(u,n)}return k.equals(n,u)}},getItems:function(i){return m0._getItems(this,i,this._matrix)},getItem:function(i){return m0._getItems(this,i,this._matrix,null,!0)[0]||null},statics:{_getItems:function i(u,h,f,t,n){if(!t){var v=typeof h==="object"&&h,g=v&&v.overlapping,w=v&&v.inside,x=g||w,l=x&&u0.read([x]);if(t={items:[],recursive:v&&v.recursive!==!1,inside:!!w,overlapping:!!g,rect:l,path:g&&new N0.Rectangle({rectangle:l,insert:!1})},v)h=k.filter({},h,{recursive:!0,inside:!0,overlapping:!0})}var y=u._children,j=t.items,l=t.rect;f=l&&(f||new j0);for(var p=0,b=y&&y.length;p<b;p++){var o=y[p],z=f&&f.appended(o._matrix),N=!0;if(l){var x=o.getBounds(z);if(!l.intersects(x))continue;if(!(l.contains(x)||t.overlapping&&(x.contains(l)||t.path.intersects(o,z))))N=!1}if(N&&o.matches(h)){if(j.push(o),n)break}if(t.recursive!==!1)i(o,h,z,t,n);if(n&&j.length>0)break}return j}}},{importJSON:function(i){var u=k.importJSON(i,this);return u!==this?this.addChild(u):u},addChild:function(i){return this.insertChild(D,i)},insertChild:function(i,u){var h=u?this.insertChildren(i,[u]):null;return h&&h[0]},addChildren:function(i){return this.insertChildren(this._children.length,i)},insertChildren:function(i,u){var h=this._children;if(h&&u&&u.length>0){u=k.slice(u);var f={};for(var t=u.length-1;t>=0;t--){var n=u[t],v=n&&n._id;if(!n||f[v])u.splice(t,1);else n._remove(!1,!0),f[v]=!0}k.splice(h,u,i,0);var g=this._project,w=g._changes;for(var t=0,x=u.length;t<x;t++){var n=u[t],y=n._name;if(n._parent=this,n._setProject(g,!0),y)n.setName(y);if(w)n._changed(5)}this._changed(11)}else u=null;return u},_insertItem:"#insertChild",_insertAt:function(i,u){var h=i&&i._getOwner(),f=i!==this&&h?this:null;if(f)f._remove(!1,!0),h._insertItem(i._index+u,f);return f},insertAbove:function(i){return this._insertAt(i,1)},insertBelow:function(i){return this._insertAt(i,0)},sendToBack:function(){var i=this._getOwner();return i?i._insertItem(0,this):null},bringToFront:function(){var i=this._getOwner();return i?i._insertItem(D,this):null},appendTop:"#addChild",appendBottom:function(i){return this.insertChild(0,i)},moveAbove:"#insertAbove",moveBelow:"#insertBelow",addTo:function(i){return i._insertItem(D,this)},copyTo:function(i){return this.clone(!1).addTo(i)},reduce:function(i){var u=this._children;if(u&&u.length===1){var h=u[0].reduce(i);if(this._parent)h.insertAbove(this),this.remove();else h.remove();return h}return this},_removeNamed:function(){var i=this._getOwner();if(i){var{_children:u,_namedChildren:h}=i,f=this._name,t=h[f],n=t?t.indexOf(this):-1;if(n!==-1){if(u[f]==this)delete u[f];if(t.splice(n,1),t.length)u[f]=t[0];else delete h[f]}}},_remove:function(i,u){var h=this._getOwner(),f=this._project,t=this._index;if(this._style)this._style._dispose();if(h){if(this._name)this._removeNamed();if(t!=null){if(f._activeLayer===this)f._activeLayer=this.getNextSibling()||this.getPreviousSibling();k.splice(h._children,null,t,1)}if(this._installEvents(!1),i&&f._changes)this._changed(5);if(u)h._changed(11,this);return this._parent=null,!0}return!1},remove:function(){return this._remove(!0,!0)},replaceWith:function(i){var u=i&&i.insertBelow(this);if(u)this.remove();return u},removeChildren:function(i,u){if(!this._children)return null;i=i||0,u=k.pick(u,this._children.length);var h=k.splice(this._children,null,i,u-i);for(var f=h.length-1;f>=0;f--)h[f]._remove(!0,!1);if(h.length>0)this._changed(11);return h},clear:"#removeChildren",reverseChildren:function(){if(this._children){this._children.reverse();for(var i=0,u=this._children.length;i<u;i++)this._children[i]._index=i;this._changed(11)}},isEmpty:function(i){var u=this._children,h=u?u.length:0;if(i){for(var f=0;f<h;f++)if(!u[f].isEmpty(i))return!1;return!0}return!h},isEditable:function(){var i=this;while(i){if(!i._visible||i._locked)return!1;i=i._parent}return!0},hasFill:function(){return this.getStyle().hasFill()},hasStroke:function(){return this.getStyle().hasStroke()},hasShadow:function(){return this.getStyle().hasShadow()},_getOrder:function(i){function u(v){var g=[];do g.unshift(v);while(v=v._parent);return g}var h=u(this),f=u(i);for(var t=0,n=Math.min(h.length,f.length);t<n;t++)if(h[t]!=f[t])return h[t]._index<f[t]._index?1:-1;return 0},hasChildren:function(){return this._children&&this._children.length>0},isInserted:function(){return this._parent?this._parent.isInserted():!1},isAbove:function(i){return this._getOrder(i)===-1},isBelow:function(i){return this._getOrder(i)===1},isParent:function(i){return this._parent===i},isChild:function(i){return i&&i._parent===this},isDescendant:function(i){var u=this;while(u=u._parent)if(u===i)return!0;return!1},isAncestor:function(i){return i?i.isDescendant(this):!1},isSibling:function(i){return this._parent===i._parent},isGroupedWith:function(i){var u=this._parent;while(u){if(u._parent&&/^(Group|Layer|CompoundPath)$/.test(u._class)&&i.isDescendant(u))return!0;u=u._parent}return!1}},k.each(["rotate","scale","shear","skew"],function(i){var u=i==="rotate";this[i]=function(){var h=arguments,f=(u?k:A).read(h),t=A.read(h,0,{readNull:!0});return this.transform(new j0()[i](f,t||this.getPosition(!0)))}},{translate:function(){var i=new j0;return this.transform(i.translate.apply(i,arguments))},transform:function(i,u,h){var f=this._matrix,t=i&&!i.isIdentity(),n=h&&this._canApplyMatrix||this._applyMatrix&&(t||!f.isIdentity()||u&&this._children);if(!t&&!n)return this;if(t){if(!i.isInvertible()&&f.isInvertible())f._backup=f.getValues();f.prepend(i,!0);var v=this._style,g=v.getFillColor(!0),w=v.getStrokeColor(!0);if(g)g.transform(i);if(w)w.transform(i)}if(n&&(n=this._transformContent(f,u,h))){var x=this._pivot;if(x)f._transformPoint(x,x,!0);if(f.reset(!0),h&&this._canApplyMatrix)this._applyMatrix=!0}var y=this._bounds,j=this._position;if(t||n)this._changed(25);var l=t&&y&&i.decompose();if(l&&l.skewing.isZero()&&l.rotation%90===0){for(var p in y){var b=y[p];if(b.nonscaling)delete y[p];else if(n||!b.internal){var o=b.rect;i._transformBounds(o,o)}}this._bounds=y;var z=y[this._getBoundsCacheKey(this._boundsOptions||{})];if(z)this._position=this._getPositionFromBounds(z.rect)}else if(t&&j&&this._pivot)this._position=i._transformPoint(j,j);return this},_transformContent:function(i,u,h){var f=this._children;if(f){for(var t=0,n=f.length;t<n;t++)f[t].transform(i,u,h);return!0}},globalToLocal:function(){return this.getGlobalMatrix(!0)._inverseTransform(A.read(arguments))},localToGlobal:function(){return this.getGlobalMatrix(!0)._transformPoint(A.read(arguments))},parentToLocal:function(){return this._matrix._inverseTransform(A.read(arguments))},localToParent:function(){return this._matrix._transformPoint(A.read(arguments))},fitBounds:function(i,u){i=u0.read(arguments);var h=this.getBounds(),f=h.height/h.width,t=i.height/i.width,n=(u?f>t:f<t)?i.width/h.width:i.height/h.height,v=new u0(new A,new W(h.width*n,h.height*n));v.setCenter(i.getCenter()),this.setBounds(v)}}),{_setStyles:function(i,u,h){var f=this._style,t=this._matrix;if(f.hasFill())i.fillStyle=f.getFillColor().toCanvasStyle(i,t);if(f.hasStroke()){i.strokeStyle=f.getStrokeColor().toCanvasStyle(i,t),i.lineWidth=f.getStrokeWidth();var n=f.getStrokeJoin(),v=f.getStrokeCap(),g=f.getMiterLimit();if(n)i.lineJoin=n;if(v)i.lineCap=v;if(g)i.miterLimit=g;if(P0.support.nativeDash){var w=f.getDashArray(),x=f.getDashOffset();if(w&&w.length)if("setLineDash"in i)i.setLineDash(w),i.lineDashOffset=x;else i.mozDash=w,i.mozDashOffset=x}}if(f.hasShadow()){var y=u.pixelRatio||1,j=h._shiftless().prepend(new j0().scale(y,y)),l=j.transform(new A(f.getShadowBlur(),0)),p=j.transform(this.getShadowOffset());i.shadowColor=f.getShadowColor().toCanvasStyle(i),i.shadowBlur=l.getLength(),i.shadowOffsetX=p.x,i.shadowOffsetY=p.y}},draw:function(i,u,h){var f=this._updateVersion=this._project._updateVersion;if(!this._visible||this._opacity===0)return;var{matrices:t,viewMatrix:n}=u,v=this._matrix,g=t[t.length-1].appended(v);if(!g.isInvertible())return;if(n=n?n.appended(g):g,t.push(g),u.updateMatrix)this._globalMatrix=g;var w=this._blendMode,x=v0.clamp(this._opacity,0,1),y=w==="normal",j=$6.nativeModes[w],l=y&&x===1||u.dontStart||u.clip||(j||y&&x<1)&&this._canComposite(),p=u.pixelRatio||1,b,o,z;if(!l){var N=this.getStrokeBounds(n);if(!N.width||!N.height){t.pop();return}if(z=u.offset,o=u.offset=N.getTopLeft().floor(),b=i,i=D0.getContext(N.getSize().ceil().add(1).multiply(p)),p!==1)i.scale(p,p)}i.save();var S=h?h.appended(v):this._canScaleStroke&&!this.getStrokeScaling(!0)&&n,d=!l&&u.clipItem,r=!S||d;if(l){if(i.globalAlpha=x,j)i.globalCompositeOperation=w}else if(r)i.translate(-o.x,-o.y);if(r)(l?v:n).applyToContext(i);if(d)u.clipItem.draw(i,u.extend({clip:!0}));if(S){i.setTransform(p,0,0,p,0,0);var I=u.offset;if(I)i.translate(-I.x,-I.y)}if(this._draw(i,u,n,S),i.restore(),t.pop(),u.clip&&!u.dontFinish)i.clip(this.getFillRule());if(!l)$6.process(w,i,b,x,o.subtract(z).multiply(p)),D0.release(i),u.offset=z},_isUpdated:function(i){var u=this._parent;if(u instanceof f6)return u._isUpdated(i);var h=this._updateVersion===i;if(!h&&u&&u._visible&&u._isUpdated(i))this._updateVersion=i,h=!0;return h},_drawSelection:function(i,u,h,f,t){var n=this._selection,v=n&1,g=n&2||v&&this._selectBounds,w=n&4;if(!this._drawSelected)v=!1;if((v||g||w)&&this._isUpdated(t)){var x,y=this.getSelectedColor(!0)||(x=this.getLayer())&&x.getSelectedColor(!0),j=u.appended(this.getGlobalMatrix(!0)),l=h/2;if(i.strokeStyle=i.fillStyle=y?y.toCanvasStyle(i):"#009dec",v)this._drawSelected(i,j,f);if(w){var p=this.getPosition(!0),b=this._parent,o=b?b.localToGlobal(p):p,z=o.x,N=o.y;i.beginPath(),i.arc(z,N,l,0,Math.PI*2,!0),i.stroke();var S=[[0,-1],[1,0],[0,1],[-1,0]],d=l,r=h+1;for(var I=0;I<4;I++){var B=S[I],_=B[0],M=B[1];i.moveTo(z+_*d,N+M*d),i.lineTo(z+_*r,N+M*r),i.stroke()}}if(g){var L=j._transformCorners(this.getInternalBounds());i.beginPath();for(var I=0;I<8;I++)i[!I?"moveTo":"lineTo"](L[I],L[++I]);i.closePath(),i.stroke();for(var I=0;I<8;I++)i.fillRect(L[I]-l,L[++I]-l,h,h)}}},_canComposite:function(){return!1}},k.each(["down","drag","up","move"],function(i){this["removeOn"+k.capitalize(i)]=function(){var u={};return u[i]=!0,this.removeOn(u)}},{removeOn:function(i){for(var u in i)if(i[u]){var h="mouse"+u,f=this._project,t=f._removeSets=f._removeSets||{};t[h]=t[h]||{},t[h][this._id]=this}return this}}),{tween:function(i,u,h){if(!h){if(h=u,u=i,i=null,!h)h=u,u=null}var f=h&&h.easing,t=h&&h.start,n=h!=null&&(typeof h==="number"?h:h.duration),v=new c5(this,i,u,n,f,t);function g(w){if(v._handleFrame(w.time*1000),!v.running)this.off("frame",g)}if(n)this.on("frame",g);return v},tweenTo:function(i,u){return this.tween(null,i,u)},tweenFrom:function(i,u){return this.tween(i,null,u)}}),q0=m0.extend({_class:"Group",_selectBounds:!1,_selectChildren:!0,_serializeFields:{children:[]},initialize:function i(u){if(this._children=[],this._namedChildren={},!this._initialize(u))this.addChildren(Array.isArray(u)?u:arguments)},_changed:function i(u){if(i.base.call(this,u),u&2050)this._clipItem=D},_getClipItem:function(){var i=this._clipItem;if(i===D){i=null;var u=this._children;for(var h=0,f=u.length;h<f;h++)if(u[h]._clipMask){i=u[h];break}this._clipItem=i}return i},isClipped:function(){return!!this._getClipItem()},setClipped:function(i){var u=this.getFirstChild();if(u)u.setClipMask(i)},_getBounds:function i(u,h){var f=this._getClipItem();return f?f._getCachedBounds(f._matrix.prepended(u),k.set({},h,{stroke:!1})):i.base.call(this,u,h)},_hitTestChildren:function i(u,h,f){var t=this._getClipItem();return(!t||t.contains(u))&&i.base.call(this,u,h,f,t)},_draw:function(i,u){var h=u.clip,f=!h&&this._getClipItem();if(u=u.extend({clipItem:f,clip:!1}),h)i.beginPath(),u.dontStart=u.dontFinish=!0;else if(f)f.draw(i,u.extend({clip:!0}));var t=this._children;for(var n=0,v=t.length;n<v;n++){var g=t[n];if(g!==f)g.draw(i,u)}}}),k6=q0.extend({_class:"Layer",initialize:function i(){q0.apply(this,arguments)},_getOwner:function(){return this._parent||this._index!=null&&this._project},isInserted:function i(){return this._parent?i.base.call(this):this._index!=null},activate:function(){this._project._activeLayer=this},_hitTestSelf:function(){}}),K0=m0.extend({_class:"Shape",_applyMatrix:!1,_canApplyMatrix:!1,_canScaleStroke:!0,_serializeFields:{type:null,size:null,radius:null},initialize:function i(u,h){this._initialize(u,h)},_equals:function(i){return this._type===i._type&&this._size.equals(i._size)&&k.equals(this._radius,i._radius)},copyContent:function(i){this.setType(i._type),this.setSize(i._size),this.setRadius(i._radius)},getType:function(){return this._type},setType:function(i){this._type=i},getShape:"#getType",setShape:"#setType",getSize:function(){var i=this._size;return new u6(i.width,i.height,this,"setSize")},setSize:function(){var i=W.read(arguments);if(!this._size)this._size=i.clone();else if(!this._size.equals(i)){var u=this._type,h=i.width,f=i.height;if(u==="rectangle")this._radius.set(W.min(this._radius,i.divide(2).abs()));else if(u==="circle")h=f=(h+f)/2,this._radius=h/2;else if(u==="ellipse")this._radius._set(h/2,f/2);this._size._set(h,f),this._changed(9)}},getRadius:function(){var i=this._radius;return this._type==="circle"?i:new u6(i.width,i.height,this,"setRadius")},setRadius:function(i){var u=this._type;if(u==="circle"){if(i===this._radius)return;var h=i*2;this._radius=i,this._size._set(h,h)}else if(i=W.read(arguments),!this._radius)this._radius=i.clone();else{if(this._radius.equals(i))return;if(this._radius.set(i),u==="rectangle"){var h=W.max(this._size,i.multiply(2));this._size.set(h)}else if(u==="ellipse")this._size._set(i.width*2,i.height*2)}this._changed(9)},isEmpty:function(){return!1},toPath:function(i){var u=new N0[k.capitalize(this._type)]({center:new A,size:this._size,radius:this._radius,insert:!1});if(u.copyAttributes(this),P0.settings.applyMatrix)u.setApplyMatrix(!0);if(i===D||i)u.insertAbove(this);return u},toShape:"#clone",_asPathItem:function(){return this.toPath(!1)},_draw:function(i,u,h,f){var t=this._style,n=t.hasFill(),v=t.hasStroke(),g=u.dontFinish||u.clip,w=!f;if(n||v||g){var x=this._type,y=this._radius,j=x==="circle";if(!u.dontStart)i.beginPath();if(w&&j)i.arc(0,0,y,0,Math.PI*2,!0);else{var l=j?y:y.width,p=j?y:y.height,b=this._size,o=b.width,z=b.height;if(w&&x==="rectangle"&&l===0&&p===0)i.rect(-o/2,-z/2,o,z);else{var N=o/2,S=z/2,d=0.44771525016920644,r=l*d,I=p*d,B=[-N,-S+p,-N,-S+I,-N+r,-S,-N+l,-S,N-l,-S,N-r,-S,N,-S+I,N,-S+p,N,S-p,N,S-I,N-r,S,N-l,S,-N+l,S,-N+r,S,-N,S-I,-N,S-p];if(f)f.transform(B,B,32);if(i.moveTo(B[0],B[1]),i.bezierCurveTo(B[2],B[3],B[4],B[5],B[6],B[7]),N!==l)i.lineTo(B[8],B[9]);if(i.bezierCurveTo(B[10],B[11],B[12],B[13],B[14],B[15]),S!==p)i.lineTo(B[16],B[17]);if(i.bezierCurveTo(B[18],B[19],B[20],B[21],B[22],B[23]),N!==l)i.lineTo(B[24],B[25]);i.bezierCurveTo(B[26],B[27],B[28],B[29],B[30],B[31])}}i.closePath()}if(!g&&(n||v)){if(this._setStyles(i,u,h),n)i.fill(t.getFillRule()),i.shadowColor="rgba(0,0,0,0)";if(v)i.stroke()}},_canComposite:function(){return!(this.hasFill()&&this.hasStroke())},_getBounds:function(i,u){var h=new u0(this._size).setCenter(0,0),f=this._style,t=u.stroke&&f.hasStroke()&&f.getStrokeWidth();if(i)h=i._transformBounds(h);return t?h.expand(N0._getStrokePadding(t,this._getStrokeMatrix(i,u))):h}},new function(){function i(h,f,t){var n=h._radius;if(!n.isZero()){var v=h._size.divide(2);for(var g=1;g<=4;g++){var w=new A(g>1&&g<4?-1:1,g>2?-1:1),x=w.multiply(v),y=x.subtract(w.multiply(n)),j=new u0(t?x.add(w.multiply(t)):x,y);if(j.contains(f))return{point:y,quadrant:g}}}}function u(h,f,t,n){var v=h.divide(f);return(!n||v.isInQuadrant(n))&&v.subtract(v.normalize()).multiply(f).divide(t).length<=1}return{_contains:function h(f){if(this._type==="rectangle"){var t=i(this,f);return t?f.subtract(t.point).divide(this._radius).getLength()<=1:h.base.call(this,f)}else return f.divide(this.size).getLength()<=0.5},_hitTestSelf:function h(f,t,n,v){var g=!1,w=this._style,x=t.stroke&&w.hasStroke(),y=t.fill&&w.hasFill();if(x||y){var j=this._type,l=this._radius,p=x?w.getStrokeWidth()/2:0,b=t._tolerancePadding.add(N0._getStrokePadding(p,!w.getStrokeScaling()&&v));if(j==="rectangle"){var o=b.multiply(2),z=i(this,f,o);if(z)g=u(f.subtract(z.point),l,b,z.quadrant);else{var N=new u0(this._size).setCenter(0,0),S=N.expand(o),d=N.expand(o.negate());g=S._containsPoint(f)&&!d._containsPoint(f)}}else g=u(f,l,b)}return g?new w6(x?"stroke":"fill",this):h.base.apply(this,arguments)}}},{statics:new function(){function i(u,h,f,t,n){var v=k.create(K0.prototype);return v._type=u,v._size=f,v._radius=t,v._initialize(k.getNamed(n),h),v}return{Circle:function(){var u=arguments,h=A.readNamed(u,"center"),f=k.readNamed(u,"radius");return i("circle",h,new W(f*2),f,u)},Rectangle:function(){var u=arguments,h=u0.readNamed(u,"rectangle"),f=W.min(W.readNamed(u,"radius"),h.getSize(!0).divide(2));return i("rectangle",h.getCenter(!0),h.getSize(!0),f,u)},Ellipse:function(){var u=arguments,h=K0._readEllipse(u),f=h.radius;return i("ellipse",h.center,f.multiply(2),f,u)},_readEllipse:function(u){var h,f;if(k.hasNamed(u,"radius"))h=A.readNamed(u,"center"),f=W.readNamed(u,"radius");else{var t=u0.readNamed(u,"rectangle");h=t.getCenter(!0),f=t.getSize(!0).divide(2)}return{center:h,radius:f}}}}}),_6=m0.extend({_class:"Raster",_applyMatrix:!1,_canApplyMatrix:!1,_boundsOptions:{stroke:!1,handle:!1},_serializeFields:{crossOrigin:null,source:null},_prioritize:["crossOrigin"],_smoothing:"low",beans:!0,initialize:function i(u,h){if(!this._initialize(u,h!==D&&A.read(arguments))){var f,t=typeof u,n=t==="string"?T.getElementById(u):t==="object"?u:null;if(n&&n!==m0.NO_INSERT){if(n.getContext||n.naturalHeight!=null)f=n;else if(n){var v=W.read(arguments);if(!v.isZero())f=D0.getCanvas(v)}}if(f)this.setImage(f);else this.setSource(u)}if(!this._size)this._size=new W,this._loaded=!1},_equals:function(i){return this.getSource()===i.getSource()},copyContent:function(i){var{_image:u,_canvas:h}=i;if(u)this._setImage(u);else if(h){var f=D0.getCanvas(i._size);f.getContext("2d").drawImage(h,0,0),this._setImage(f)}this._crossOrigin=i._crossOrigin},getSize:function(){var i=this._size;return new u6(i?i.width:0,i?i.height:0,this,"setSize")},setSize:function(i,u){var h=W.read(arguments);if(!h.equals(this._size))if(h.width>0&&h.height>0){var f=!u&&this.getElement();if(this._setImage(D0.getCanvas(h)),f)this.getContext(!0).drawImage(f,0,0,h.width,h.height)}else{if(this._canvas)D0.release(this._canvas);this._size=h.clone()}else if(u)this.clear()},getWidth:function(){return this._size?this._size.width:0},setWidth:function(i){this.setSize(i,this.getHeight())},getHeight:function(){return this._size?this._size.height:0},setHeight:function(i){this.setSize(this.getWidth(),i)},getLoaded:function(){return this._loaded},isEmpty:function(){var i=this._size;return!i||i.width===0&&i.height===0},getResolution:function(){var i=this._matrix,u=new A(0,0).transform(i),h=new A(1,0).transform(i).subtract(u),f=new A(0,1).transform(i).subtract(u);return new W(72/h.getLength(),72/f.getLength())},getPpi:"#getResolution",getImage:function(){return this._image},setImage:function(i){var u=this;function h(f){var t=u.getView(),n=f&&f.type||"load";if(t&&u.responds(n))P0=t._scope,u.emit(n,new A6(f))}if(this._setImage(i),this._loaded)setTimeout(h,0);else if(i)V0.add(i,{load:function(f){u._setImage(i),h(f)},error:h})},_setImage:function(i){if(this._canvas)D0.release(this._canvas);if(i&&i.getContext)this._image=null,this._canvas=i,this._loaded=!0;else this._image=i,this._canvas=null,this._loaded=!!(i&&i.src&&i.complete);this._size=new W(i?i.naturalWidth||i.width:0,i?i.naturalHeight||i.height:0),this._context=null,this._changed(1033)},getCanvas:function(){if(!this._canvas){var i=D0.getContext(this._size);try{if(this._image)i.drawImage(this._image,0,0);this._canvas=i.canvas}catch(u){D0.release(i)}}return this._canvas},setCanvas:"#setImage",getContext:function(i){if(!this._context)this._context=this.getCanvas().getContext("2d");if(i)this._image=null,this._changed(1025);return this._context},setContext:function(i){this._context=i},getSource:function(){var i=this._image;return i&&i.src||this.toDataURL()},setSource:function(i){var u=new a.Image,h=this._crossOrigin;if(h)u.crossOrigin=h;if(i)u.src=i;this.setImage(u)},getCrossOrigin:function(){var i=this._image;return i&&i.crossOrigin||this._crossOrigin||""},setCrossOrigin:function(i){this._crossOrigin=i;var u=this._image;if(u)u.crossOrigin=i},getSmoothing:function(){return this._smoothing},setSmoothing:function(i){this._smoothing=typeof i==="string"?i:i?"low":"off",this._changed(257)},getElement:function(){return this._canvas||this._loaded&&this._image}},{beans:!1,getSubCanvas:function(){var i=u0.read(arguments),u=D0.getContext(i.getSize());return u.drawImage(this.getCanvas(),i.x,i.y,i.width,i.height,0,0,i.width,i.height),u.canvas},getSubRaster:function(){var i=u0.read(arguments),u=new _6(m0.NO_INSERT);return u._setImage(this.getSubCanvas(i)),u.translate(i.getCenter().subtract(this.getSize().divide(2))),u._matrix.prepend(this._matrix),u.insertAbove(this),u},toDataURL:function(){var i=this._image,u=i&&i.src;if(/^data:/.test(u))return u;var h=this.getCanvas();return h?h.toDataURL.apply(h,arguments):null},drawImage:function(i){var u=A.read(arguments,1);this.getContext(!0).drawImage(i,u.x,u.y)},getAverageColor:function(i){var u,h;if(!i)u=this.getBounds();else if(i instanceof I6)h=i,u=i.getBounds();else if(typeof i==="object"){if("width"in i)u=new u0(i);else if("x"in i)u=new u0(i.x-0.5,i.y-0.5,1,1)}if(!u)return null;var f=32,t=Math.min(u.width,f),n=Math.min(u.height,f),v=_6._sampleContext;if(!v)v=_6._sampleContext=D0.getContext(new W(f));else v.clearRect(0,0,f+1,f+1);v.save();var g=new j0().scale(t/u.width,n/u.height).translate(-u.x,-u.y);if(g.applyToContext(v),h)h.draw(v,new k({clip:!0,matrices:[g]}));this._matrix.applyToContext(v);var w=this.getElement(),x=this._size;if(w)v.drawImage(w,-x.width/2,-x.height/2);v.restore();var y=v.getImageData(0.5,0.5,Math.ceil(t),Math.ceil(n)).data,j=[0,0,0],l=0;for(var p=0,b=y.length;p<b;p+=4){var o=y[p+3];l+=o,o/=255,j[0]+=y[p]*o,j[1]+=y[p+1]*o,j[2]+=y[p+2]*o}for(var p=0;p<3;p++)j[p]/=l;return l?a0.read(j):null},getPixel:function(){var i=A.read(arguments),u=this.getContext().getImageData(i.x,i.y,1,1).data;return new a0("rgb",[u[0]/255,u[1]/255,u[2]/255],u[3]/255)},setPixel:function(){var i=arguments,u=A.read(i),h=a0.read(i),f=h._convert("rgb"),t=h._alpha,n=this.getContext(!0),v=n.createImageData(1,1),g=v.data;g[0]=f[0]*255,g[1]=f[1]*255,g[2]=f[2]*255,g[3]=t!=null?t*255:255,n.putImageData(v,u.x,u.y)},clear:function(){var i=this._size;this.getContext(!0).clearRect(0,0,i.width+1,i.height+1)},createImageData:function(){var i=W.read(arguments);return this.getContext().createImageData(i.width,i.height)},getImageData:function(){var i=u0.read(arguments);if(i.isEmpty())i=new u0(this._size);return this.getContext().getImageData(i.x,i.y,i.width,i.height)},putImageData:function(i){var u=A.read(arguments,1);this.getContext(!0).putImageData(i,u.x,u.y)},setImageData:function(i){this.setSize(i),this.getContext(!0).putImageData(i,0,0)},_getBounds:function(i,u){var h=new u0(this._size).setCenter(0,0);return i?i._transformBounds(h):h},_hitTestSelf:function(i){if(this._contains(i)){var u=this;return new w6("pixel",u,{offset:i.add(u._size.divide(2)).round(),color:{get:function(){return u.getPixel(this.offset)}}})}},_draw:function(i,u,h){var f=this.getElement();if(f&&f.width>0&&f.height>0){i.globalAlpha=v0.clamp(this._opacity,0,1),this._setStyles(i,u,h);var t=this._smoothing,n=t==="off";M0.setPrefixed(i,n?"imageSmoothingEnabled":"imageSmoothingQuality",n?!1:t),i.drawImage(f,-this._size.width/2,-this._size.height/2)}},_canComposite:function(){return!0}}),K6=m0.extend({_class:"SymbolItem",_applyMatrix:!1,_canApplyMatrix:!1,_boundsOptions:{stroke:!0},_serializeFields:{symbol:null},initialize:function i(u,h){if(!this._initialize(u,h!==D&&A.read(arguments,1)))this.setDefinition(u instanceof d6?u:new d6(u))},_equals:function(i){return this._definition===i._definition},copyContent:function(i){this.setDefinition(i._definition)},getDefinition:function(){return this._definition},setDefinition:function(i){this._definition=i,this._changed(9)},getSymbol:"#getDefinition",setSymbol:"#setDefinition",isEmpty:function(){return this._definition._item.isEmpty()},_getBounds:function(i,u){var h=this._definition._item;return h._getCachedBounds(h._matrix.prepended(i),u)},_hitTestSelf:function(i,u,h){var f=u.extend({all:!1}),t=this._definition._item._hitTest(i,f,h);if(t)t.item=this;return t},_draw:function(i,u){this._definition._item.draw(i,u)}}),d6=k.extend({_class:"SymbolDefinition",initialize:function i(u,h){if(this._id=r0.get(),this.project=P0.project,u)this.setItem(u,h)},_serialize:function(i,u){return u.add(this,function(){return k.serialize([this._class,this._item],i,!1,u)})},_changed:function(i){if(i&8)m0._clearBoundsCache(this);if(i&1)this.project._changed(i)},getItem:function(){return this._item},setItem:function(i,u){if(i._symbol)i=i.clone();if(this._item)this._item._symbol=null;if(this._item=i,i.remove(),i.setSelected(!1),!u)i.setPosition(new A);i._symbol=this,this._changed(9)},getDefinition:"#getItem",setDefinition:"#setItem",place:function(i){return new K6(this,i)},clone:function(){return new d6(this._item.clone(!1))},equals:function(i){return i===this||i&&this._item.equals(i._item)||!1}}),w6=k.extend({_class:"HitResult",initialize:function i(u,h,f){if(this.type=u,this.item=h,f)this.inject(f)},statics:{getOptions:function(i){var u=i&&k.read(i);return new k({type:null,tolerance:P0.settings.hitTolerance,fill:!u,stroke:!u,segments:!u,handles:!1,ends:!1,position:!1,center:!1,bounds:!1,guides:!1,selected:!1},u)}}}),n0=k.extend({_class:"Segment",beans:!0,_selection:0,initialize:function i(u,h,f,t,n,v){var g=arguments.length,w,x,y,j;if(g>0)if(u==null||typeof u==="object")if(g===1&&u&&"point"in u)w=u.point,x=u.handleIn,y=u.handleOut,j=u.selection;else w=u,x=h,y=f,j=t;else w=[u,h],x=f!==D?[f,t]:null,y=n!==D?[n,v]:null;if(new U6(w,this,"_point"),new U6(x,this,"_handleIn"),new U6(y,this,"_handleOut"),j)this.setSelection(j)},_serialize:function(i,u){var h=this._point,f=this._selection,t=f||this.hasHandles()?[h,this._handleIn,this._handleOut]:h;if(f)t.push(f);return k.serialize(t,i,!0,u)},_changed:function(i){var u=this._path;if(!u)return;var h=u._curves,f=this._index,t;if(h){if((!i||i===this._point||i===this._handleIn)&&(t=f>0?h[f-1]:u._closed?h[h.length-1]:null))t._changed();if((!i||i===this._point||i===this._handleOut)&&(t=h[f]))t._changed()}u._changed(41)},getPoint:function(){return this._point},setPoint:function(){this._point.set(A.read(arguments))},getHandleIn:function(){return this._handleIn},setHandleIn:function(){this._handleIn.set(A.read(arguments))},getHandleOut:function(){return this._handleOut},setHandleOut:function(){this._handleOut.set(A.read(arguments))},hasHandles:function(){return!this._handleIn.isZero()||!this._handleOut.isZero()},isSmooth:function(){var i=this._handleIn,u=this._handleOut;return!i.isZero()&&!u.isZero()&&i.isCollinear(u)},clearHandles:function(){this._handleIn._set(0,0),this._handleOut._set(0,0)},getSelection:function(){return this._selection},setSelection:function(i){var u=this._selection,h=this._path;if(this._selection=i=i||0,h&&i!==u)h._updateSelection(this,u,i),h._changed(257)},_changeSelection:function(i,u){var h=this._selection;this.setSelection(u?h|i:h&~i)},isSelected:function(){return!!(this._selection&7)},setSelected:function(i){this._changeSelection(7,i)},getIndex:function(){return this._index!==D?this._index:null},getPath:function(){return this._path||null},getCurve:function(){var i=this._path,u=this._index;if(i){if(u>0&&!i._closed&&u===i._segments.length-1)u--;return i.getCurves()[u]||null}return null},getLocation:function(){var i=this.getCurve();return i?new h6(i,this===i._segment1?0:1):null},getNext:function(){var i=this._path&&this._path._segments;return i&&(i[this._index+1]||this._path._closed&&i[0])||null},smooth:function(i,u,h){var f=i||{},t=f.type,n=f.factor,v=this.getPrevious(),g=this.getNext(),w=(v||this)._point,x=this._point,y=(g||this)._point,j=w.getDistance(x),l=x.getDistance(y);if(!t||t==="catmull-rom"){var p=n===D?0.5:n,b=Math.pow(j,p),o=b*b,z=Math.pow(l,p),N=z*z;if(!u&&v){var S=2*N+3*z*b+o,d=3*z*(z+b);this.setHandleIn(d!==0?new A((N*w._x+S*x._x-o*y._x)/d-x._x,(N*w._y+S*x._y-o*y._y)/d-x._y):new A)}if(!h&&g){var S=2*o+3*b*z+N,d=3*b*(b+z);this.setHandleOut(d!==0?new A((o*y._x+S*x._x-N*w._x)/d-x._x,(o*y._y+S*x._y-N*w._y)/d-x._y):new A)}}else if(t==="geometric"){if(v&&g){var r=w.subtract(y),I=n===D?0.4:n,B=I*j/(j+l);if(!u)this.setHandleIn(r.multiply(B));if(!h)this.setHandleOut(r.multiply(B-I))}}else throw new Error("Smoothing method \'"+t+"\' not supported.")},getPrevious:function(){var i=this._path&&this._path._segments;return i&&(i[this._index-1]||this._path._closed&&i[i.length-1])||null},isFirst:function(){return!this._index},isLast:function(){var i=this._path;return i&&this._index===i._segments.length-1||!1},reverse:function(){var i=this._handleIn,u=this._handleOut,h=i.clone();i.set(u),u.set(h)},reversed:function(){return new n0(this._point,this._handleOut,this._handleIn)},remove:function(){return this._path?!!this._path.removeSegment(this._index):!1},clone:function(){return new n0(this._point,this._handleIn,this._handleOut)},equals:function(i){return i===this||i&&this._class===i._class&&this._point.equals(i._point)&&this._handleIn.equals(i._handleIn)&&this._handleOut.equals(i._handleOut)||!1},toString:function(){var i=["point: "+this._point];if(!this._handleIn.isZero())i.push("handleIn: "+this._handleIn);if(!this._handleOut.isZero())i.push("handleOut: "+this._handleOut);return"{ "+i.join(", ")+" }"},transform:function(i){this._transformCoordinates(i,new Array(6),!0),this._changed()},interpolate:function(i,u,h){var f=1-h,t=h,n=i._point,v=u._point,g=i._handleIn,w=u._handleIn,x=u._handleOut,y=i._handleOut;this._point._set(f*n._x+t*v._x,f*n._y+t*v._y,!0),this._handleIn._set(f*g._x+t*w._x,f*g._y+t*w._y,!0),this._handleOut._set(f*y._x+t*x._x,f*y._y+t*x._y,!0),this._changed()},_transformCoordinates:function(i,u,h){var f=this._point,t=!h||!this._handleIn.isZero()?this._handleIn:null,n=!h||!this._handleOut.isZero()?this._handleOut:null,v=f._x,g=f._y,w=2;if(u[0]=v,u[1]=g,t)u[w++]=t._x+v,u[w++]=t._y+g;if(n)u[w++]=n._x+v,u[w++]=n._y+g;if(i)if(i._transformCoordinates(u,u,w/2),v=u[0],g=u[1],h){if(f._x=v,f._y=g,w=2,t)t._x=u[w++]-v,t._y=u[w++]-g;if(n)n._x=u[w++]-v,n._y=u[w++]-g}else{if(!t)u[w++]=v,u[w++]=g;if(!n)u[w++]=v,u[w++]=g}return u}}),U6=A.extend({initialize:function i(u,h,f){var t,n,v;if(!u)t=n=0;else if((t=u[0])!==D)n=u[1];else{var g=u;if((t=g.x)===D)g=A.read(arguments),t=g.x;n=g.y,v=g.selected}if(this._x=t,this._y=n,this._owner=h,h[f]=this,v)this.setSelected(!0)},_set:function(i,u){return this._x=i,this._y=u,this._owner._changed(this),this},getX:function(){return this._x},setX:function(i){this._x=i,this._owner._changed(this)},getY:function(){return this._y},setY:function(i){this._y=i,this._owner._changed(this)},isZero:function(){var i=v0.isZero;return i(this._x)&&i(this._y)},isSelected:function(){return!!(this._owner._selection&this._getSelection())},setSelected:function(i){this._owner._changeSelection(this._getSelection(),i)},_getSelection:function(){var i=this._owner;return this===i._point?1:this===i._handleIn?2:this===i._handleOut?4:0}}),Z=k.extend({_class:"Curve",beans:!0,initialize:function i(u,h,f,t,n,v,g,w){var x=arguments.length,y,j,l,p,b,o;if(x===3)this._path=u,y=h,j=f;else if(!x)y=new n0,j=new n0;else if(x===1){if("segment1"in u)y=new n0(u.segment1),j=new n0(u.segment2);else if("point1"in u)l=u.point1,b=u.handle1,o=u.handle2,p=u.point2;else if(Array.isArray(u))l=[u[0],u[1]],p=[u[6],u[7]],b=[u[2]-u[0],u[3]-u[1]],o=[u[4]-u[6],u[5]-u[7]]}else if(x===2)y=new n0(u),j=new n0(h);else if(x===4)l=u,b=h,o=f,p=t;else if(x===8)l=[u,h],p=[g,w],b=[f-u,t-h],o=[n-g,v-w];this._segment1=y||new n0(l,null,b),this._segment2=j||new n0(p,o,null)},_serialize:function(i,u){return k.serialize(this.hasHandles()?[this.getPoint1(),this.getHandle1(),this.getHandle2(),this.getPoint2()]:[this.getPoint1(),this.getPoint2()],i,!0,u)},_changed:function(){this._length=this._bounds=D},clone:function(){return new Z(this._segment1,this._segment2)},toString:function(){var i=["point1: "+this._segment1._point];if(!this._segment1._handleOut.isZero())i.push("handle1: "+this._segment1._handleOut);if(!this._segment2._handleIn.isZero())i.push("handle2: "+this._segment2._handleIn);return i.push("point2: "+this._segment2._point),"{ "+i.join(", ")+" }"},classify:function(){return Z.classify(this.getValues())},remove:function(){var i=!1;if(this._path){var u=this._segment2,h=u._handleOut;if(i=u.remove(),i)this._segment1._handleOut.set(h)}return i},getPoint1:function(){return this._segment1._point},setPoint1:function(){this._segment1._point.set(A.read(arguments))},getPoint2:function(){return this._segment2._point},setPoint2:function(){this._segment2._point.set(A.read(arguments))},getHandle1:function(){return this._segment1._handleOut},setHandle1:function(){this._segment1._handleOut.set(A.read(arguments))},getHandle2:function(){return this._segment2._handleIn},setHandle2:function(){this._segment2._handleIn.set(A.read(arguments))},getSegment1:function(){return this._segment1},getSegment2:function(){return this._segment2},getPath:function(){return this._path},getIndex:function(){return this._segment1._index},getNext:function(){var i=this._path&&this._path._curves;return i&&(i[this._segment1._index+1]||this._path._closed&&i[0])||null},getPrevious:function(){var i=this._path&&this._path._curves;return i&&(i[this._segment1._index-1]||this._path._closed&&i[i.length-1])||null},isFirst:function(){return!this._segment1._index},isLast:function(){var i=this._path;return i&&this._segment1._index===i._curves.length-1||!1},isSelected:function(){return this.getPoint1().isSelected()&&this.getHandle1().isSelected()&&this.getHandle2().isSelected()&&this.getPoint2().isSelected()},setSelected:function(i){this.getPoint1().setSelected(i),this.getHandle1().setSelected(i),this.getHandle2().setSelected(i),this.getPoint2().setSelected(i)},getValues:function(i){return Z.getValues(this._segment1,this._segment2,i)},getPoints:function(){var i=this.getValues(),u=[];for(var h=0;h<8;h+=2)u.push(new A(i[h],i[h+1]));return u}},{getLength:function(){if(this._length==null)this._length=Z.getLength(this.getValues(),0,1);return this._length},getArea:function(){return Z.getArea(this.getValues())},getLine:function(){return new k0(this._segment1._point,this._segment2._point)},getPart:function(i,u){return new Z(Z.getPart(this.getValues(),i,u))},getPartLength:function(i,u){return Z.getLength(this.getValues(),i,u)},divideAt:function(i){return this.divideAtTime(i&&i.curve===this?i.time:this.getTimeAt(i))},divideAtTime:function(i,u){var h=0.00000001,f=1-h,t=null;if(i>=h&&i<=f){var n=Z.subdivide(this.getValues(),i),v=n[0],g=n[1],w=u||this.hasHandles(),x=this._segment1,y=this._segment2,j=this._path;if(w)x._handleOut._set(v[2]-v[0],v[3]-v[1]),y._handleIn._set(g[4]-g[6],g[5]-g[7]);var l=v[6],p=v[7],b=new n0(new A(l,p),w&&new A(v[4]-l,v[5]-p),w&&new A(g[2]-l,g[3]-p));if(j)j.insert(x._index+1,b),t=this.getNext();else this._segment2=b,this._changed(),t=new Z(b,y)}return t},splitAt:function(i){var u=this._path;return u?u.splitAt(i):null},splitAtTime:function(i){return this.splitAt(this.getLocationAtTime(i))},divide:function(i,u){return this.divideAtTime(i===D?0.5:u?i:this.getTimeAt(i))},split:function(i,u){return this.splitAtTime(i===D?0.5:u?i:this.getTimeAt(i))},reversed:function(){return new Z(this._segment2.reversed(),this._segment1.reversed())},clearHandles:function(){this._segment1._handleOut._set(0,0),this._segment2._handleIn._set(0,0)},statics:{getValues:function(i,u,h,f){var{_point:t,_handleOut:n}=i,v=u._handleIn,g=u._point,w=t.x,x=t.y,y=g.x,j=g.y,l=f?[w,x,w,x,y,j,y,j]:[w,x,w+n._x,x+n._y,y+v._x,j+v._y,y,j];if(h)h._transformCoordinates(l,l,4);return l},subdivide:function(i,u){var h=i[0],f=i[1],t=i[2],n=i[3],v=i[4],g=i[5],w=i[6],x=i[7];if(u===D)u=0.5;var y=1-u,j=y*h+u*t,l=y*f+u*n,p=y*t+u*v,b=y*n+u*g,o=y*v+u*w,z=y*g+u*x,N=y*j+u*p,S=y*l+u*b,d=y*p+u*o,r=y*b+u*z,I=y*N+u*d,B=y*S+u*r;return[[h,f,j,l,N,S,I,B],[I,B,d,r,o,z,w,x]]},getMonoCurves:function(i,u){var h=[],f=u?0:1,t=i[f+0],n=i[f+2],v=i[f+4],g=i[f+6];if(t>=n===n>=v&&n>=v===v>=g||Z.isStraight(i))h.push(i);else{var w=3*(n-v)-t+g,x=2*(t+v)-4*n,y=n-t,j=0.00000001,l=1-j,p=[],b=v0.solveQuadratic(w,x,y,p,j,l);if(!b)h.push(i);else{p.sort();var o=p[0],z=Z.subdivide(i,o);if(h.push(z[0]),b>1)o=(p[1]-o)/(1-o),z=Z.subdivide(z[1],o),h.push(z[0]);h.push(z[1])}}return h},solveCubic:function(i,u,h,f,t,n){var v=i[u],g=i[u+2],w=i[u+4],x=i[u+6],y=0;if(!(v<h&&x<h&&g<h&&w<h||v>h&&x>h&&g>h&&w>h)){var j=3*(g-v),l=3*(w-g)-j,p=x-v-j-l;y=v0.solveCubic(p,l,j,v-h,f,t,n)}return y},getTimeOf:function(i,u){var h=new A(i[0],i[1]),f=new A(i[6],i[7]),t=0.000000000001,n=0.0000001,v=u.isClose(h,t)?0:u.isClose(f,t)?1:null;if(v===null){var g=[u.x,u.y],w=[];for(var x=0;x<2;x++){var y=Z.solveCubic(i,x,g[x],w,0,1);for(var j=0;j<y;j++){var l=w[j];if(u.isClose(Z.getPoint(i,l),n))return l}}}return u.isClose(h,n)?0:u.isClose(f,n)?1:null},getNearestTime:function(i,u){if(Z.isStraight(i)){var h=i[0],f=i[1],t=i[6],n=i[7],v=t-h,g=n-f,w=v*v+g*g;if(w===0)return 0;var x=((u.x-h)*v+(u.y-f)*g)/w;return x<0.000000000001?0:x>0.999999999999?1:Z.getTimeOf(i,new A(h+x*v,f+x*g))}var y=100,j=Infinity,l=0;function p(z){if(z>=0&&z<=1){var N=u.getDistance(Z.getPoint(i,z),!0);if(N<j)return j=N,l=z,!0}}for(var b=0;b<=y;b++)p(b/y);var o=1/(y*2);while(o>0.00000001)if(!p(l-o)&&!p(l+o))o/=2;return l},getPart:function(i,u,h){var f=u>h;if(f){var t=u;u=h,h=t}if(u>0)i=Z.subdivide(i,u)[1];if(h<1)i=Z.subdivide(i,(h-u)/(1-u))[0];return f?[i[6],i[7],i[4],i[5],i[2],i[3],i[0],i[1]]:i},isFlatEnough:function(i,u){var h=i[0],f=i[1],t=i[2],n=i[3],v=i[4],g=i[5],w=i[6],x=i[7],y=3*t-2*h-w,j=3*n-2*f-x,l=3*v-2*w-h,p=3*g-2*x-f;return Math.max(y*y,l*l)+Math.max(j*j,p*p)<=16*u*u},getArea:function(i){var u=i[0],h=i[1],f=i[2],t=i[3],n=i[4],v=i[5],g=i[6],w=i[7];return 3*((w-h)*(f+n)-(g-u)*(t+v)+t*(u-n)-f*(h-v)+w*(n+u/3)-g*(v+h/3))/20},getBounds:function(i){var u=i.slice(0,2),h=u.slice(),f=[0,0];for(var t=0;t<2;t++)Z._addBounds(i[t],i[t+2],i[t+4],i[t+6],t,0,u,h,f);return new u0(u[0],u[1],h[0]-u[0],h[1]-u[1])},_addBounds:function(i,u,h,f,t,n,v,g,w){function x(I,B){var _=I-B,M=I+B;if(_<v[t])v[t]=_;if(M>g[t])g[t]=M}n/=2;var y=v[t]+n,j=g[t]-n;if(i<y||u<y||h<y||f<y||i>j||u>j||h>j||f>j)if(u<i!=u<f&&h<i!=h<f)x(i,0),x(f,0);else{var l=3*(u-h)-i+f,p=2*(i+h)-4*u,b=u-i,o=v0.solveQuadratic(l,p,b,w),z=0.00000001,N=1-z;x(f,0);for(var S=0;S<o;S++){var d=w[S],r=1-d;if(z<=d&&d<=N)x(r*r*r*i+3*r*r*d*u+3*r*d*d*h+d*d*d*f,n)}}}}},k.each(["getBounds","getStrokeBounds","getHandleBounds"],function(i){this[i]=function(){if(!this._bounds)this._bounds={};var u=this._bounds[i];if(!u)u=this._bounds[i]=N0[i]([this._segment1,this._segment2],!1,this._path);return u.clone()}},{}),k.each({isStraight:function(i,u,h,f){if(u.isZero()&&h.isZero())return!0;else{var t=f.subtract(i);if(t.isZero())return!1;else if(t.isCollinear(u)&&t.isCollinear(h)){var n=new k0(i,f),v=0.0000001;if(n.getDistance(i.add(u))<v&&n.getDistance(f.add(h))<v){var g=t.dot(t),w=t.dot(u)/g,x=t.dot(h)/g;return w>=0&&w<=1&&x<=0&&x>=-1}}}return!1},isLinear:function(i,u,h,f){var t=f.subtract(i).divide(3);return u.equals(t)&&h.negate().equals(t)}},function(i,u){this[u]=function(h){var f=this._segment1,t=this._segment2;return i(f._point,f._handleOut,t._handleIn,t._point,h)},this.statics[u]=function(h,f){var t=h[0],n=h[1],v=h[6],g=h[7];return i(new A(t,n),new A(h[2]-t,h[3]-n),new A(h[4]-v,h[5]-g),new A(v,g),f)}},{statics:{},hasHandles:function(){return!this._segment1._handleOut.isZero()||!this._segment2._handleIn.isZero()},hasLength:function(i){return(!this.getPoint1().equals(this.getPoint2())||this.hasHandles())&&this.getLength()>(i||0)},isCollinear:function(i){return i&&this.isStraight()&&i.isStraight()&&this.getLine().isCollinear(i.getLine())},isHorizontal:function(){return this.isStraight()&&Math.abs(this.getTangentAtTime(0.5).y)<0.00000001},isVertical:function(){return this.isStraight()&&Math.abs(this.getTangentAtTime(0.5).x)<0.00000001}}),{beans:!1,getLocationAt:function(i,u){return this.getLocationAtTime(u?i:this.getTimeAt(i))},getLocationAtTime:function(i){return i!=null&&i>=0&&i<=1?new h6(this,i):null},getTimeAt:function(i,u){return Z.getTimeAt(this.getValues(),i,u)},getParameterAt:"#getTimeAt",getTimesWithTangent:function(){var i=A.read(arguments);return i.isZero()?[]:Z.getTimesWithTangent(this.getValues(),i)},getOffsetAtTime:function(i){return this.getPartLength(0,i)},getLocationOf:function(){return this.getLocationAtTime(this.getTimeOf(A.read(arguments)))},getOffsetOf:function(){var i=this.getLocationOf.apply(this,arguments);return i?i.getOffset():null},getTimeOf:function(){return Z.getTimeOf(this.getValues(),A.read(arguments))},getParameterOf:"#getTimeOf",getNearestLocation:function(){var i=A.read(arguments),u=this.getValues(),h=Z.getNearestTime(u,i),f=Z.getPoint(u,h);return new h6(this,h,f,null,i.getDistance(f))},getNearestPoint:function(){var i=this.getNearestLocation.apply(this,arguments);return i?i.getPoint():i}},new function(){var i=["getPoint","getTangent","getNormal","getWeightedTangent","getWeightedNormal","getCurvature"];return k.each(i,function(u){this[u+"At"]=function(h,f){var t=this.getValues();return Z[u](t,f?h:Z.getTimeAt(t,h))},this[u+"AtTime"]=function(h){return Z[u](this.getValues(),h)}},{statics:{_evaluateMethods:i}})},new function(){function i(f){var t=f[0],n=f[1],v=f[2],g=f[3],w=f[4],x=f[5],y=f[6],j=f[7],l=9*(v-w)+3*(y-t),p=6*(t+w)-12*v,b=3*(v-t),o=9*(g-x)+3*(j-n),z=6*(n+x)-12*g,N=3*(g-n);return function(S){var d=(l*S+p)*S+b,r=(o*S+z)*S+N;return Math.sqrt(d*d+r*r)}}function u(f,t){return Math.max(2,Math.min(16,Math.ceil(Math.abs(t-f)*32)))}function h(f,t,n,v){if(t==null||t<0||t>1)return null;var g=f[0],w=f[1],x=f[2],y=f[3],j=f[4],l=f[5],p=f[6],b=f[7],o=v0.isZero;if(o(x-g)&&o(y-w))x=g,y=w;if(o(j-p)&&o(l-b))j=p,l=b;var z=3*(x-g),N=3*(j-x)-z,S=p-g-z-N,d=3*(y-w),r=3*(l-y)-d,I=b-w-d-r,B,_;if(n===0)B=t===0?g:t===1?p:((S*t+N)*t+z)*t+g,_=t===0?w:t===1?b:((I*t+r)*t+d)*t+w;else{var M=0.00000001,L=1-M;if(t<M)B=z,_=d;else if(t>L)B=3*(p-j),_=3*(b-l);else B=(3*S*t+2*N)*t+z,_=(3*I*t+2*r)*t+d;if(v){if(B===0&&_===0&&(t<M||t>L))B=j-x,_=l-y;var G=Math.sqrt(B*B+_*_);if(G)B/=G,_/=G}if(n===3){var j=6*S*t+2*N,l=6*I*t+2*r,V=Math.pow(B*B+_*_,1.5);B=V!==0?(B*l-_*j)/V:0,_=0}}return n===2?new A(_,-B):new A(B,_)}return{statics:{classify:function(f){var t=f[0],n=f[1],v=f[2],g=f[3],w=f[4],x=f[5],y=f[6],j=f[7],l=t*(j-x)+n*(w-y)+y*x-j*w,p=v*(n-j)+g*(y-t)+t*j-n*y,b=w*(g-n)+x*(t-v)+v*n-g*t,o=3*b,z=o-p,N=z-p+l,S=Math.sqrt(N*N+z*z+o*o),d=S!==0?1/S:0,r=v0.isZero,I="serpentine";N*=d,z*=d,o*=d;function B(G,V,R){var q=V!==D,E=q&&V>0&&V<1,e=q&&R>0&&R<1;if(q&&(!(E||e)||G==="loop"&&!(E&&e)))G="arch",E=e=!1;return{type:G,roots:E||e?E&&e?V<R?[V,R]:[R,V]:[E?V:R]:null}}if(r(N))return r(z)?B(r(o)?"line":"quadratic"):B(I,o/(3*z));var _=3*z*z-4*N*o;if(r(_))return B("cusp",z/(2*N));var M=_>0?Math.sqrt(_/3):Math.sqrt(-_),L=2*N;return B(_>0?I:"loop",(z+M)/L,(z-M)/L)},getLength:function(f,t,n,v){if(t===D)t=0;if(n===D)n=1;if(Z.isStraight(f)){var g=f;if(n<1)g=Z.subdivide(g,n)[0],t/=n;if(t>0)g=Z.subdivide(g,t)[1];var w=g[6]-g[0],x=g[7]-g[1];return Math.sqrt(w*w+x*x)}return v0.integrate(v||i(f),t,n,u(t,n))},getTimeAt:function(f,t,n){if(n===D)n=t<0?1:0;if(t===0)return n;var v=Math.abs,g=0.000000000001,w=t>0,x=w?n:0,y=w?1:n,j=i(f),l=Z.getLength(f,x,y,j),p=v(t)-l;if(v(p)<g)return w?y:x;else if(p>g)return null;var b=t/l,o=0;function z(N){return o+=v0.integrate(j,n,N,u(n,N)),n=N,o-t}return v0.findRoot(z,j,n+b,x,y,32,0.000000000001)},getPoint:function(f,t){return h(f,t,0,!1)},getTangent:function(f,t){return h(f,t,1,!0)},getWeightedTangent:function(f,t){return h(f,t,1,!1)},getNormal:function(f,t){return h(f,t,2,!0)},getWeightedNormal:function(f,t){return h(f,t,2,!1)},getCurvature:function(f,t){return h(f,t,3,!1).x},getPeaks:function(f){var t=f[0],n=f[1],v=f[2],g=f[3],w=f[4],x=f[5],y=f[6],j=f[7],l=-t+3*v-3*w+y,p=3*t-6*v+3*w,b=-3*t+3*v,o=-n+3*g-3*x+j,z=3*n-6*g+3*x,N=-3*n+3*g,S=0.00000001,d=1-S,r=[];return v0.solveCubic(9*(l*l+o*o),9*(l*p+z*o),2*(p*p+z*z)+3*(b*l+N*o),b*p+z*N,r,S,d),r.sort()}}}},new function(){function i(p,b,o,z,N,S,d){var r=!d&&o.getPrevious()===N,I=!d&&o!==N&&o.getNext()===N,B=0.00000001,_=1-B;if(z!==null&&z>=(r?B:0)&&z<=(I?_:1)){if(S!==null&&S>=(I?B:0)&&S<=(r?_:1)){var M=new h6(o,z,null,d),L=new h6(N,S,null,d);if(M._intersection=L,L._intersection=M,!b||b(M))h6.insert(p,M,!0)}}}function u(p,b,o,z,N,S,d,r,I,B,_,M,L){if(++I>=4096||++r>=40)return I;var G=0.000000001,V=b[0],R=b[1],q=b[6],E=b[7],e=k0.getSignedDistance,O=e(V,R,q,E,b[2],b[3]),X=e(V,R,q,E,b[4],b[5]),H=O*X>0?0.75:0.4444444444444444,Y=H*Math.min(0,O,X),K=H*Math.max(0,O,X),f0=e(V,R,q,E,p[0],p[1]),i0=e(V,R,q,E,p[2],p[3]),g0=e(V,R,q,E,p[4],p[5]),Q=e(V,R,q,E,p[6],p[7]),x0=h(f0,i0,g0,Q),h0=x0[0],S0=x0[1],s0,C0;if(O===0&&X===0&&f0===0&&i0===0&&g0===0&&Q===0||(s0=f(h0,S0,Y,K))==null||(C0=f(h0.reverse(),S0.reverse(),Y,K))==null)return I;var b0=B+(_-B)*s0,l0=B+(_-B)*C0;if(Math.max(L-M,l0-b0)<G){var O0=(b0+l0)/2,X0=(M+L)/2;i(N,S,d?z:o,d?X0:O0,d?o:z,d?O0:X0)}else{p=Z.getPart(p,s0,C0);var Z0=L-M;if(C0-s0>0.8)if(l0-b0>Z0){var A0=Z.subdivide(p,0.5),O0=(b0+l0)/2;I=u(b,A0[0],z,o,N,S,!d,r,I,M,L,b0,O0),I=u(b,A0[1],z,o,N,S,!d,r,I,M,L,O0,l0)}else{var A0=Z.subdivide(b,0.5),X0=(M+L)/2;I=u(A0[0],p,z,o,N,S,!d,r,I,M,X0,b0,l0),I=u(A0[1],p,z,o,N,S,!d,r,I,X0,L,b0,l0)}else if(Z0===0||Z0>=G)I=u(b,p,z,o,N,S,!d,r,I,M,L,b0,l0);else I=u(p,b,o,z,N,S,d,r,I,b0,l0,M,L)}return I}function h(p,b,o,z){var N=[0,p],S=[0.3333333333333333,b],d=[0.6666666666666666,o],r=[1,z],I=b-(2*p+z)/3,B=o-(p+2*z)/3,_;if(I*B<0)_=[[N,S,r],[N,d,r]];else{var M=I/B;_=[M>=2?[N,S,r]:M<=0.5?[N,d,r]:[N,S,d,r],[N,r]]}return(I||B)<0?_.reverse():_}function f(p,b,o,z){if(p[0][1]<o)return t(p,!0,o);else if(b[0][1]>z)return t(b,!1,z);else return p[0][0]}function t(p,b,o){var z=p[0][0],N=p[0][1];for(var S=1,d=p.length;S<d;S++){var r=p[S][0],I=p[S][1];if(b?I>=o:I<=o)return I===o?r:z+(o-N)*(r-z)/(I-N);z=r,N=I}return null}function n(p,b,o,z,N){var S=v0.isZero;if(S(z)&&S(N)){var d=Z.getTimeOf(p,new A(b,o));return d===null?[]:[d]}var r=Math.atan2(-N,z),I=Math.sin(r),B=Math.cos(r),_=[],M=[];for(var L=0;L<8;L+=2){var G=p[L]-b,V=p[L+1]-o;_.push(G*B-V*I,G*I+V*B)}return Z.solveCubic(_,1,0,M,0,1),M}function v(p,b,o,z,N,S,d){var r=b[0],I=b[1],B=b[6],_=b[7],M=n(p,r,I,B-r,_-I);for(var L=0,G=M.length;L<G;L++){var V=M[L],R=Z.getPoint(p,V),q=Z.getTimeOf(b,R);if(q!==null)i(N,S,d?z:o,d?q:V,d?o:z,d?V:q)}}function g(p,b,o,z,N,S){var d=k0.intersect(p[0],p[1],p[6],p[7],b[0],b[1],b[6],b[7]);if(d)i(N,S,o,Z.getTimeOf(p,d),z,Z.getTimeOf(b,d))}function w(p,b,o,z,N,S){var d=0.000000000001,r=Math.min,I=Math.max;if(I(p[0],p[2],p[4],p[6])+d>r(b[0],b[2],b[4],b[6])&&r(p[0],p[2],p[4],p[6])-d<I(b[0],b[2],b[4],b[6])&&I(p[1],p[3],p[5],p[7])+d>r(b[1],b[3],b[5],b[7])&&r(p[1],p[3],p[5],p[7])-d<I(b[1],b[3],b[5],b[7])){var B=j(p,b);if(B)for(var _=0;_<2;_++){var M=B[_];i(N,S,o,M[0],z,M[1],!0)}else{var L=Z.isStraight(p),G=Z.isStraight(b),V=L&&G,R=L&&!G,q=N.length;if((V?g:L||G?v:u)(R?b:p,R?p:b,R?z:o,R?o:z,N,S,R,0,0,0,1,0,1),!V||N.length===q)for(var _=0;_<4;_++){var E=_>>1,e=_&1,O=E*6,X=e*6,H=new A(p[O],p[O+1]),Y=new A(b[X],b[X+1]);if(H.isClose(Y,d))i(N,S,o,E,z,e)}}}return N}function x(p,b,o,z){var N=Z.classify(p);if(N.type==="loop"){var S=N.roots;i(o,z,b,S[0],b,S[1])}return o}function y(p,b,o,z,N,S){var d=0.0000001,r=!b;if(r)b=p;var I=p.length,B=b.length,_=new Array(I),M=r?_:new Array(B),L=[];for(var G=0;G<I;G++)_[G]=p[G].getValues(z);if(!r)for(var G=0;G<B;G++)M[G]=b[G].getValues(N);var V=t0.findCurveBoundsCollisions(_,M,d);for(var R=0;R<I;R++){var q=p[R],E=_[R];if(r)x(E,q,L,o);var e=V[R];if(e)for(var O=0;O<e.length;O++){if(S&&L.length)return L;var X=e[O];if(!r||X>R){var H=b[X],Y=M[X];w(E,Y,q,H,L,o)}}}return L}function j(p,b){function o(Q){var x0=Q[6]-Q[0],h0=Q[7]-Q[1];return x0*x0+h0*h0}var z=Math.abs,N=k0.getDistance,S=0.00000001,d=0.0000001,r=Z.isStraight(p),I=Z.isStraight(b),B=r&&I,_=o(p)<o(b),M=_?b:p,L=_?p:b,G=M[0],V=M[1],R=M[6]-G,q=M[7]-V;if(N(G,V,R,q,L[0],L[1],!0)<d&&N(G,V,R,q,L[6],L[7],!0)<d){if(!B&&N(G,V,R,q,M[2],M[3],!0)<d&&N(G,V,R,q,M[4],M[5],!0)<d&&N(G,V,R,q,L[2],L[3],!0)<d&&N(G,V,R,q,L[4],L[5],!0)<d)r=I=B=!0}else if(B)return null;if(r^I)return null;var E=[p,b],e=[];for(var O=0;O<4&&e.length<2;O++){var X=O&1,H=X^1,Y=O>>1,K=Z.getTimeOf(E[X],new A(E[H][Y?6:0],E[H][Y?7:1]));if(K!=null){var f0=X?[Y,K]:[K,Y];if(!e.length||z(f0[0]-e[0][0])>S&&z(f0[1]-e[0][1])>S)e.push(f0)}if(O>2&&!e.length)break}if(e.length!==2)e=null;else if(!B){var i0=Z.getPart(p,e[0][0],e[1][0]),g0=Z.getPart(b,e[0][1],e[1][1]);if(z(g0[2]-i0[2])>d||z(g0[3]-i0[3])>d||z(g0[4]-i0[4])>d||z(g0[5]-i0[5])>d)e=null}return e}function l(p,b){var o=p[0],z=p[1],N=p[2],S=p[3],d=p[4],r=p[5],I=p[6],B=p[7],_=b.normalize(),M=_.x,L=_.y,G=3*I-9*d+9*N-3*o,V=3*B-9*r+9*S-3*z,R=6*d-12*N+6*o,q=6*r-12*S+6*z,E=3*N-3*o,e=3*S-3*z,O=2*G*L-2*V*M,X=[];if(Math.abs(O)<v0.CURVETIME_EPSILON){var H=G*e-V*E,O=G*q-V*R;if(O!=0){var Y=-H/O;if(Y>=0&&Y<=1)X.push(Y)}}else{var K=(R*R-4*G*E)*L*L+(-2*R*q+4*V*E+4*G*e)*M*L+(q*q-4*V*e)*M*M,f0=R*L-q*M;if(K>=0&&O!=0){var i0=Math.sqrt(K),g0=-(f0+i0)/O,Q=(-f0+i0)/O;if(g0>=0&&g0<=1)X.push(g0);if(Q>=0&&Q<=1)X.push(Q)}}return X}return{getIntersections:function(p){var b=this.getValues(),o=p&&p!==this&&p.getValues();return o?w(b,o,this,p,[]):x(b,this,[])},statics:{getOverlaps:j,getIntersections:y,getCurveLineIntersections:n,getTimesWithTangent:l}}}),h6=k.extend({_class:"CurveLocation",initialize:function i(u,h,f,t,n){if(h>=0.99999999){var v=u.getNext();if(v)h=0,u=v}this._setCurve(u),this._time=h,this._point=f||u.getPointAtTime(h),this._overlap=t,this._distance=n,this._intersection=this._next=this._previous=null},_setPath:function(i){this._path=i,this._version=i?i._version:0},_setCurve:function(i){this._setPath(i._path),this._curve=i,this._segment=null,this._segment1=i._segment1,this._segment2=i._segment2},_setSegment:function(i){var u=i.getCurve();if(u)this._setCurve(u);else this._setPath(i._path),this._segment1=i,this._segment2=null;this._segment=i,this._time=i===this._segment1?0:1,this._point=i._point.clone()},getSegment:function(){var i=this._segment;if(!i){var u=this.getCurve(),h=this.getTime();if(h===0)i=u._segment1;else if(h===1)i=u._segment2;else if(h!=null)i=u.getPartLength(0,h)<u.getPartLength(h,1)?u._segment1:u._segment2;this._segment=i}return i},getCurve:function(){var i=this._path,u=this;if(i&&i._version!==this._version)this._time=this._offset=this._curveOffset=this._curve=null;function h(f){var t=f&&f.getCurve();if(t&&(u._time=t.getTimeOf(u._point))!=null)return u._setCurve(t),t}return this._curve||h(this._segment)||h(this._segment1)||h(this._segment2.getPrevious())},getPath:function(){var i=this.getCurve();return i&&i._path},getIndex:function(){var i=this.getCurve();return i&&i.getIndex()},getTime:function(){var i=this.getCurve(),u=this._time;return i&&u==null?this._time=i.getTimeOf(this._point):u},getParameter:"#getTime",getPoint:function(){return this._point},getOffset:function(){var i=this._offset;if(i==null){i=0;var u=this.getPath(),h=this.getIndex();if(u&&h!=null){var f=u.getCurves();for(var t=0;t<h;t++)i+=f[t].getLength()}this._offset=i+=this.getCurveOffset()}return i},getCurveOffset:function(){var i=this._curveOffset;if(i==null){var u=this.getCurve(),h=this.getTime();this._curveOffset=i=h!=null&&u&&u.getPartLength(0,h)}return i},getIntersection:function(){return this._intersection},getDistance:function(){return this._distance},divide:function(){var i=this.getCurve(),u=i&&i.divideAtTime(this.getTime());if(u)this._setSegment(u._segment1);return u},split:function(){var i=this.getCurve(),u=i._path,h=i&&i.splitAtTime(this.getTime());if(h)this._setSegment(u.getLastSegment());return h},equals:function(i,u){var h=this===i;if(!h&&i instanceof h6){var f=this.getCurve(),t=i.getCurve(),n=f._path,v=t._path;if(n===v){var g=Math.abs,w=0.0000001,x=g(this.getOffset()-i.getOffset()),y=!u&&this._intersection,j=!u&&i._intersection;h=(x<w||n&&g(n.getLength()-x)<w)&&(!y&&!j||y&&j&&y.equals(j,!0))}}return h},toString:function(){var i=[],u=this.getPoint(),h=p0.instance;if(u)i.push("point: "+u);var f=this.getIndex();if(f!=null)i.push("index: "+f);var t=this.getTime();if(t!=null)i.push("time: "+h.number(t));if(this._distance!=null)i.push("distance: "+h.number(this._distance));return"{ "+i.join(", ")+" }"},isTouching:function(){var i=this._intersection;if(i&&this.getTangent().isCollinear(i.getTangent())){var u=this.getCurve(),h=i.getCurve();return!(u.isStraight()&&h.isStraight()&&u.getLine().intersect(h.getLine()))}return!1},isCrossing:function(){var i=this._intersection;if(!i)return!1;var u=this.getTime(),h=i.getTime(),f=0.00000001,t=1-f,n=u>=f&&u<=t,v=h>=f&&h<=t;if(n&&v)return!this.isTouching();var g=this.getCurve(),w=g&&u<f?g.getPrevious():g,x=i.getCurve(),y=x&&h<f?x.getPrevious():x;if(u>t)g=g.getNext();if(h>t)x=x.getNext();if(!w||!g||!y||!x)return!1;var j=[];function l(M,L){var G=M.getValues(),V=Z.classify(G).roots||Z.getPeaks(G),R=V.length,q=Z.getLength(G,L&&R?V[R-1]:0,!L&&R?V[0]:1);j.push(R?q:q/32)}function p(M,L,G){return L<G?M>L&&M<G:M>L||M<G}if(!n)l(w,!0),l(g,!1);if(!v)l(y,!0),l(x,!1);var b=this.getPoint(),o=Math.min.apply(Math,j),z=n?g.getTangentAtTime(u):g.getPointAt(o).subtract(b),N=n?z.negate():w.getPointAt(-o).subtract(b),S=v?x.getTangentAtTime(h):x.getPointAt(o).subtract(b),d=v?S.negate():y.getPointAt(-o).subtract(b),r=N.getAngle(),I=z.getAngle(),B=d.getAngle(),_=S.getAngle();return!!(n?p(r,B,_)^p(I,B,_)&&p(r,_,B)^p(I,_,B):p(B,r,I)^p(_,r,I)&&p(B,I,r)^p(_,I,r))},hasOverlap:function(){return!!this._overlap}},k.each(Z._evaluateMethods,function(i){var u=i+"At";this[i]=function(){var h=this.getCurve(),f=this.getTime();return f!=null&&h&&h[u](f,!0)}},{preserve:!0}),new function(){function i(u,h,f){var t=u.length,n=0,v=t-1;function g(b,o){for(var z=b+o;z>=-1&&z<=t;z+=o){var N=u[(z%t+t)%t];if(!h.getPoint().isClose(N.getPoint(),0.0000001))break;if(h.equals(N))return N}return null}while(n<=v){var w=n+v>>>1,x=u[w],y;if(f&&(y=h.equals(x)?x:g(w,-1)||g(w,1))){if(h._overlap)y._overlap=y._intersection._overlap=!0;return y}var j=h.getPath(),l=x.getPath(),p=j!==l?j._id-l._id:h.getIndex()+h.getTime()-(x.getIndex()+x.getTime());if(p<0)v=w-1;else n=w+1}return u.splice(n,0,h),h}return{statics:{insert:i,expand:function(u){var h=u.slice();for(var f=u.length-1;f>=0;f--)i(h,u[f]._intersection,!1);return h}}}}),I6=m0.extend({_class:"PathItem",_selectBounds:!1,_canScaleStroke:!0,beans:!0,initialize:function i(){},statics:{create:function(i){var u,h,f;if(k.isPlainObject(i))h=i.segments,u=i.pathData;else if(Array.isArray(i))h=i;else if(typeof i==="string")u=i;if(h){var t=h[0];f=t&&Array.isArray(t[0])}else if(u)f=(u.match(/m/gi)||[]).length>1||/z\s*\S+/i.test(u);var n=f?f6:N0;return new n(i)}},_asPathItem:function(){return this},isClockwise:function(){return this.getArea()>=0},setClockwise:function(i){if(this.isClockwise()!=(i=!!i))this.reverse()},setPathData:function(i){var u=i&&i.match(/[mlhvcsqtaz][^mlhvcsqtaz]*/ig),h,f=!1,t,n,v=new A,g=new A;function w(d,r){var I=+h[d];if(f)I+=v[r];return I}function x(d){return new A(w(d,"x"),w(d+1,"y"))}this.clear();for(var y=0,j=u&&u.length;y<j;y++){var l=u[y],p=l[0],b=p.toLowerCase();h=l.match(/[+-]?(?:\d*\.\d+|\d+\.?)(?:[eE][+-]?\d+)?/g);var o=h&&h.length;if(f=p===b,t==="z"&&!/[mz]/.test(b))this.moveTo(v);switch(b){case"m":case"l":var z=b==="m";for(var N=0;N<o;N+=2)if(this[z?"moveTo":"lineTo"](v=x(N)),z)g=v,z=!1;n=v;break;case"h":case"v":var S=b==="h"?"x":"y";v=v.clone();for(var N=0;N<o;N++)v[S]=w(N,S),this.lineTo(v);n=v;break;case"c":for(var N=0;N<o;N+=6)this.cubicCurveTo(x(N),n=x(N+2),v=x(N+4));break;case"s":for(var N=0;N<o;N+=4)this.cubicCurveTo(/[cs]/.test(t)?v.multiply(2).subtract(n):v,n=x(N),v=x(N+2)),t=b;break;case"q":for(var N=0;N<o;N+=4)this.quadraticCurveTo(n=x(N),v=x(N+2));break;case"t":for(var N=0;N<o;N+=2)this.quadraticCurveTo(n=/[qt]/.test(t)?v.multiply(2).subtract(n):v,v=x(N)),t=b;break;case"a":for(var N=0;N<o;N+=7)this.arcTo(v=x(N+5),new W(+h[N],+h[N+1]),+h[N+2],+h[N+4],+h[N+3]);break;case"z":this.closePath(0.000000000001),v=g;break}t=b}},_canComposite:function(){return!(this.hasFill()&&this.hasStroke())},_contains:function(i){var u=i.isInside(this.getBounds({internal:!0,handle:!0}))?this._getWinding(i):{};return u.onPath||!!(this.getFillRule()==="evenodd"?u.windingL&1||u.windingR&1:u.winding)},getIntersections:function(i,u,h,f){var t=this===i||!i,n=this._matrix._orNullIfIdentity(),v=t?n:(h||i._matrix)._orNullIfIdentity();return t||this.getBounds(n).intersects(i.getBounds(v),0.000000000001)?Z.getIntersections(this.getCurves(),!t&&i.getCurves(),u,n,v,f):[]},getCrossings:function(i){return this.getIntersections(i,function(u){return u.isCrossing()})},getNearestLocation:function(){var i=A.read(arguments),u=this.getCurves(),h=Infinity,f=null;for(var t=0,n=u.length;t<n;t++){var v=u[t].getNearestLocation(i);if(v._distance<h)h=v._distance,f=v}return f},getNearestPoint:function(){var i=this.getNearestLocation.apply(this,arguments);return i?i.getPoint():i},interpolate:function(i,u,h){var f=!this._children,t=f?"_segments":"_children",n=i[t],v=u[t],g=this[t];if(!n||!v||n.length!==v.length)throw new Error("Invalid operands in interpolate() call: "+i+", "+u);var w=g.length,x=v.length;if(w<x){var y=f?n0:N0;for(var j=w;j<x;j++)this.add(new y)}else if(w>x)this[f?"removeSegments":"removeChildren"](x,w);for(var j=0;j<x;j++)g[j].interpolate(n[j],v[j],h);if(f)this.setClosed(i._closed),this._changed(9)},compare:function(i){var u=!1;if(i){var h=this._children||[this],f=i._children?i._children.slice():[i],t=h.length,n=f.length,v=[],g=0;u=!0;var w=t0.findItemBoundsCollisions(h,f,v0.GEOMETRIC_EPSILON);for(var x=t-1;x>=0&&u;x--){var y=h[x];u=!1;var j=w[x];if(j){for(var l=j.length-1;l>=0&&!u;l--)if(y.compare(f[j[l]])){if(!v[j[l]])v[j[l]]=!0,g++;u=!0}}}u=u&&g===n}return u}}),N0=I6.extend({_class:"Path",_serializeFields:{segments:[],closed:!1},initialize:function i(u){this._closed=!1,this._segments=[],this._version=0;var h=arguments,f=Array.isArray(u)?typeof u[0]==="object"?u:h:u&&(u.size===D&&(u.x!==D||u.point!==D))?h:null;if(f&&f.length>0)this.setSegments(f);else if(this._curves=D,this._segmentSelection=0,!f&&typeof u==="string")this.setPathData(u),u=null;this._initialize(!f&&u)},_equals:function(i){return this._closed===i._closed&&k.equals(this._segments,i._segments)},copyContent:function(i){this.setSegments(i._segments),this._closed=i._closed},_changed:function i(u){if(i.base.call(this,u),u&8){if(this._length=this._area=D,u&32)this._version++;else if(this._curves)for(var h=0,f=this._curves.length;h<f;h++)this._curves[h]._changed()}else if(u&64)this._bounds=D},getStyle:function(){var i=this._parent;return(i instanceof f6?i:this)._style},getSegments:function(){return this._segments},setSegments:function(i){var u=this.isFullySelected(),h=i&&i.length;if(this._segments.length=0,this._segmentSelection=0,this._curves=D,h){var f=i[h-1];if(typeof f==="boolean")this.setClosed(f),h--;this._add(n0.readList(i,0,{},h))}if(u)this.setFullySelected(!0)},getFirstSegment:function(){return this._segments[0]},getLastSegment:function(){return this._segments[this._segments.length-1]},getCurves:function(){var i=this._curves,u=this._segments;if(!i){var h=this._countCurves();i=this._curves=new Array(h);for(var f=0;f<h;f++)i[f]=new Z(this,u[f],u[f+1]||u[0])}return i},getFirstCurve:function(){return this.getCurves()[0]},getLastCurve:function(){var i=this.getCurves();return i[i.length-1]},isClosed:function(){return this._closed},setClosed:function(i){if(this._closed!=(i=!!i)){if(this._closed=i,this._curves){var u=this._curves.length=this._countCurves();if(i)this._curves[u-1]=new Z(this,this._segments[u-1],this._segments[0])}this._changed(41)}}},{beans:!0,getPathData:function(i,u){var h=this._segments,f=h.length,t=new p0(u),n=new Array(6),v=!0,g,w,x,y,j,l,p,b,o=[];function z(S,d){if(S._transformCoordinates(i,n),g=n[0],w=n[1],v)o.push("M"+t.pair(g,w)),v=!1;else if(j=n[2],l=n[3],j===g&&l===w&&p===x&&b===y){if(!d){var r=g-x,I=w-y;o.push(r===0?"v"+t.number(I):I===0?"h"+t.number(r):"l"+t.pair(r,I))}}else o.push("c"+t.pair(p-x,b-y)+" "+t.pair(j-x,l-y)+" "+t.pair(g-x,w-y));x=g,y=w,p=n[4],b=n[5]}if(!f)return"";for(var N=0;N<f;N++)z(h[N]);if(this._closed&&f>0)z(h[0],!0),o.push("z");return o.join("")},isEmpty:function(){return!this._segments.length},_transformContent:function(i){var u=this._segments,h=new Array(6);for(var f=0,t=u.length;f<t;f++)u[f]._transformCoordinates(i,h,!0);return!0},_add:function(i,v){var h=this._segments,f=this._curves,t=i.length,n=v==null,v=n?h.length:v;for(var g=0;g<t;g++){var w=i[g];if(w._path)w=i[g]=w.clone();if(w._path=this,w._index=v+g,w._selection)this._updateSelection(w,0,w._selection)}if(n)k.push(h,i);else{h.splice.apply(h,[v,0].concat(i));for(var g=v+t,x=h.length;g<x;g++)h[g]._index=g}if(f){var y=this._countCurves(),j=v>0&&v+t-1===y?v-1:v,l=j,p=Math.min(j+t,y);if(i._curves)f.splice.apply(f,[j,0].concat(i._curves)),l+=i._curves.length;for(var g=l;g<p;g++)f.splice(g,0,new Z(this,null,null));this._adjustCurves(j,p)}return this._changed(41),i},_adjustCurves:function(i,u){var h=this._segments,f=this._curves,t;for(var n=i;n<u;n++)t=f[n],t._path=this,t._segment1=h[n],t._segment2=h[n+1]||h[0],t._changed();if(t=f[this._closed&&!i?h.length-1:i-1])t._segment2=h[i]||h[0],t._changed();if(t=f[u])t._segment1=h[u],t._changed()},_countCurves:function(){var i=this._segments.length;return!this._closed&&i>0?i-1:i},add:function(i){var u=arguments;return u.length>1&&typeof i!=="number"?this._add(n0.readList(u)):this._add([n0.read(u)])[0]},insert:function(i,u){var h=arguments;return h.length>2&&typeof u!=="number"?this._add(n0.readList(h,1),i):this._add([n0.read(h,1)],i)[0]},addSegment:function(){return this._add([n0.read(arguments)])[0]},insertSegment:function(i){return this._add([n0.read(arguments,1)],i)[0]},addSegments:function(i){return this._add(n0.readList(i))},insertSegments:function(i,u){return this._add(n0.readList(u),i)},removeSegment:function(i){return this.removeSegments(i,i+1)[0]||null},removeSegments:function(i,u,h){i=i||0,u=k.pick(u,this._segments.length);var f=this._segments,t=this._curves,n=f.length,v=f.splice(i,u-i),g=v.length;if(!g)return v;for(var w=0;w<g;w++){var x=v[w];if(x._selection)this._updateSelection(x,x._selection,0);x._index=x._path=null}for(var w=i,y=f.length;w<y;w++)f[w]._index=w;if(t){var j=i>0&&u===n+(this._closed?1:0)?i-1:i,t=t.splice(j,g);for(var w=t.length-1;w>=0;w--)t[w]._path=null;if(h)v._curves=t.slice(1);this._adjustCurves(j,j)}return this._changed(41),v},clear:"#removeSegments",hasHandles:function(){var i=this._segments;for(var u=0,h=i.length;u<h;u++)if(i[u].hasHandles())return!0;return!1},clearHandles:function(){var i=this._segments;for(var u=0,h=i.length;u<h;u++)i[u].clearHandles()},getLength:function(){if(this._length==null){var i=this.getCurves(),u=0;for(var h=0,f=i.length;h<f;h++)u+=i[h].getLength();this._length=u}return this._length},getArea:function(){var i=this._area;if(i==null){var u=this._segments,h=this._closed;i=0;for(var f=0,t=u.length;f<t;f++){var n=f+1===t;i+=Z.getArea(Z.getValues(u[f],u[n?0:f+1],null,n&&!h))}this._area=i}return i},isFullySelected:function(){var i=this._segments.length;return this.isSelected()&&i>0&&this._segmentSelection===i*7},setFullySelected:function(i){if(i)this._selectSegments(!0);this.setSelected(i)},setSelection:function i(u){if(!(u&1))this._selectSegments(!1);i.base.call(this,u)},_selectSegments:function(i){var u=this._segments,h=u.length,f=i?7:0;this._segmentSelection=f*h;for(var t=0;t<h;t++)u[t]._selection=f},_updateSelection:function(i,u,h){i._selection=h;var f=this._segmentSelection+=h-u;if(f>0)this.setSelected(!0)},divideAt:function(i){var u=this.getLocationAt(i),h;return u&&(h=u.getCurve().divideAt(u.getCurveOffset()))?h._segment1:null},splitAt:function(i){var u=this.getLocationAt(i),h=u&&u.index,f=u&&u.time,t=0.00000001,n=1-t;if(f>n)h++,f=0;var v=this.getCurves();if(h>=0&&h<v.length){if(f>=t)v[h++].divideAtTime(f);var g=this.removeSegments(h,this._segments.length,!0),w;if(this._closed)this.setClosed(!1),w=this;else w=new N0(m0.NO_INSERT),w.insertAbove(this),w.copyAttributes(this);return w._add(g,0),this.addSegment(g[0]),w}return null},split:function(i,u){var h,f=u===D?i:(h=this.getCurves()[i])&&h.getLocationAtTime(u);return f!=null?this.splitAt(f):null},join:function(i,u){var h=u||0;if(i&&i!==this){var f=i._segments,t=this.getLastSegment(),n=i.getLastSegment();if(!n)return this;if(t&&t._point.isClose(n._point,h))i.reverse();var v=i.getFirstSegment();if(t&&t._point.isClose(v._point,h))t.setHandleOut(v._handleOut),this._add(f.slice(1));else{var g=this.getFirstSegment();if(g&&g._point.isClose(v._point,h))i.reverse();if(n=i.getLastSegment(),g&&g._point.isClose(n._point,h))g.setHandleIn(n._handleIn),this._add(f.slice(0,f.length-1),0);else this._add(f.slice())}if(i._closed)this._add([f[0]]);i.remove()}var w=this.getFirstSegment(),x=this.getLastSegment();if(w!==x&&w._point.isClose(x._point,h))w.setHandleIn(x._handleIn),x.remove(),this.setClosed(!0);return this},reduce:function(i){var u=this.getCurves(),h=i&&i.simplify,f=h?0.0000001:0;for(var t=u.length-1;t>=0;t--){var n=u[t];if(!n.hasHandles()&&(!n.hasLength(f)||h&&n.isCollinear(n.getNext())))n.remove()}return this},reverse:function(){this._segments.reverse();for(var i=0,u=this._segments.length;i<u;i++){var h=this._segments[i],f=h._handleIn;h._handleIn=h._handleOut,h._handleOut=f,h._index=i}this._curves=null,this._changed(9)},flatten:function(i){var u=new N8(this,i||0.25,256,!0),h=u.parts,f=h.length,t=[];for(var n=0;n<f;n++)t.push(new n0(h[n].curve.slice(0,2)));if(!this._closed&&f>0)t.push(new n0(h[f-1].curve.slice(6)));this.setSegments(t)},simplify:function(i){var u=new B5(this).fit(i||2.5);if(u)this.setSegments(u);return!!u},smooth:function(i){var u=this,h=i||{},f=h.type||"asymmetric",t=this._segments,n=t.length,v=this._closed;function g(h0,S0){var s0=h0&&h0.index;if(s0!=null){var C0=h0.path;if(C0&&C0!==u)throw new Error(h0._class+" "+s0+" of "+C0+" is not part of "+u);if(S0&&h0 instanceof Z)s0++}else s0=typeof h0==="number"?h0:S0;return Math.min(s0<0&&v?s0%n:s0<0?s0+n:s0,n-1)}var w=v&&h.from===D&&h.to===D,x=g(h.from,0),y=g(h.to,n-1);if(x>y)if(v)x-=n;else{var j=x;x=y,y=j}if(/^(?:asymmetric|continuous)$/.test(f)){var l=f==="asymmetric",p=Math.min,b=y-x+1,o=b-1,z=w?p(b,4):1,N=z,S=z,d=[];if(!v)N=p(1,x),S=p(1,n-y-1);if(o+=N+S,o<=1)return;for(var r=0,I=x-N;r<=o;r++,I++)d[r]=t[(I<0?I+n:I)%n]._point;var B=d[0]._x+2*d[1]._x,_=d[0]._y+2*d[1]._y,M=2,L=o-1,G=[B],V=[_],R=[M],q=[],E=[];for(var r=1;r<o;r++){var e=r<L,O=e?1:l?1:2,X=e?4:l?2:7,H=e?4:l?3:8,Y=e?2:l?0:1,K=O/M;M=R[r]=X-K,B=G[r]=H*d[r]._x+Y*d[r+1]._x-K*B,_=V[r]=H*d[r]._y+Y*d[r+1]._y-K*_}q[L]=G[L]/R[L],E[L]=V[L]/R[L];for(var r=o-2;r>=0;r--)q[r]=(G[r]-q[r+1])/R[r],E[r]=(V[r]-E[r+1])/R[r];q[o]=(3*d[o]._x-q[L])/2,E[o]=(3*d[o]._y-E[L])/2;for(var r=N,f0=o-S,I=x;r<=f0;r++,I++){var i0=t[I<0?I+n:I],g0=i0._point,Q=q[r]-g0._x,x0=E[r]-g0._y;if(w||r<f0)i0.setHandleOut(Q,x0);if(w||r>N)i0.setHandleIn(-Q,-x0)}}else for(var r=x;r<=y;r++)t[r<0?r+n:r].smooth(h,!w&&r===x,!w&&r===y)},toShape:function(i){if(!this._closed)return null;var u=this._segments,h,f,t,n;function v(l,p){var b=u[l],o=b.getNext(),z=u[p],N=z.getNext();return b._handleOut.isZero()&&o._handleIn.isZero()&&z._handleOut.isZero()&&N._handleIn.isZero()&&o._point.subtract(b._point).isCollinear(N._point.subtract(z._point))}function g(l){var p=u[l],b=p.getPrevious(),o=p.getNext();return b._handleOut.isZero()&&p._handleIn.isZero()&&p._handleOut.isZero()&&o._handleIn.isZero()&&p._point.subtract(b._point).isOrthogonal(o._point.subtract(p._point))}function w(l){var p=u[l],b=p.getNext(),o=p._handleOut,z=b._handleIn,N=0.5522847498307936;if(o.isOrthogonal(z)){var S=p._point,d=b._point,r=new k0(S,o,!0).intersect(new k0(d,z,!0),!0);return r&&v0.isZero(o.getLength()/r.subtract(S).getLength()-N)&&v0.isZero(z.getLength()/r.subtract(d).getLength()-N)}return!1}function x(l,p){return u[l]._point.getDistance(u[p]._point)}if(!this.hasHandles()&&u.length===4&&v(0,2)&&v(1,3)&&g(1))h=K0.Rectangle,f=new W(x(0,3),x(0,1)),n=u[1]._point.add(u[2]._point).divide(2);else if(u.length===8&&w(0)&&w(2)&&w(4)&&w(6)&&v(1,5)&&v(3,7))h=K0.Rectangle,f=new W(x(1,6),x(0,3)),t=f.subtract(new W(x(0,7),x(1,2))).divide(2),n=u[3]._point.add(u[4]._point).divide(2);else if(u.length===4&&w(0)&&w(1)&&w(2)&&w(3)){if(v0.isZero(x(0,2)-x(1,3)))h=K0.Circle,t=x(0,2)/2;else h=K0.Ellipse,t=new W(x(2,0)/2,x(3,1)/2);n=u[1]._point}if(h){var y=this.getPosition(!0),j=new h({center:y,size:f,radius:t,insert:!1});if(j.copyAttributes(this,!0),j._matrix.prepend(this._matrix),j.rotate(n.subtract(y).getAngle()+90),i===D||i)j.insertAbove(this);return j}return null},toPath:"#clone",compare:function i(u){if(!u||u instanceof f6)return i.base.call(this,u);var h=this.getCurves(),f=u.getCurves(),t=h.length,n=f.length;if(!t||!n)return t==n;var v=h[0].getValues(),g=[],w=0,x,y=0,j;for(var l=0;l<n;l++){var z=f[l].getValues();g.push(z);var p=Z.getOverlaps(v,z);if(p){x=!l&&p[0][0]>0?n-1:l,j=p[0][1];break}}var b=Math.abs,o=0.00000001,z=g[x],N;while(v&&z){var p=Z.getOverlaps(v,z);if(p){var S=p[0][0];if(b(S-y)<o){if(y=p[1][0],y===1)v=++w<t?h[w].getValues():null,y=0;var d=p[0][1];if(b(d-j)<o){if(!N)N=[x,d];if(j=p[1][1],j===1){if(++x>=n)x=0;z=g[x]||f[x].getValues(),j=0}if(!v)return N[0]===x&&N[1]===j;continue}}}break}return!1},_hitTestSelf:function(i,u,h,f){var t=this,n=this.getStyle(),v=this._segments,g=v.length,w=this._closed,x=u._tolerancePadding,y=x,j,l,p,b,o,z,N=u.stroke&&n.hasStroke(),S=u.fill&&n.hasFill(),d=u.curves,r=N?n.getStrokeWidth()/2:S&&u.tolerance>0||d?0:null;if(r!==null)if(r>0)j=n.getStrokeJoin(),l=n.getStrokeCap(),p=n.getMiterLimit(),y=y.add(N0._getStrokePadding(r,f));else j=l="round";function I(q,E){return i.subtract(q).divide(E).length<=1}function B(q,E,e){if(!u.selected||E.isSelected()){var O=q._point;if(E!==O)E=E.add(O);if(I(E,y))return new w6(e,t,{segment:q,point:E})}}function _(q,E){return(E||u.segments)&&B(q,q._point,"segment")||!E&&u.handles&&(B(q,q._handleIn,"handle-in")||B(q,q._handleOut,"handle-out"))}function M(q){b.add(q)}function L(q){var E=w||q._index>0&&q._index<g-1;if((E?j:l)==="round")return I(q._point,y);else{if(b=new N0({internal:!0,closed:!0}),E){if(!q.isSmooth())N0._addBevelJoin(q,j,r,p,null,f,M,!0)}else if(l==="square")N0._addSquareCap(q,l,r,null,f,M,!0);if(!b.isEmpty()){var e;return b.contains(i)||(e=b.getNearestLocation(i))&&I(e.getPoint(),x)}}}if(u.ends&&!u.segments&&!w){if(z=_(v[0],!0)||_(v[g-1],!0))return z}else if(u.segments||u.handles){for(var G=0;G<g;G++)if(z=_(v[G]))return z}if(r!==null){if(o=this.getNearestLocation(i),o){var V=o.getTime();if(V===0||V===1&&g>1){if(!L(o.getSegment()))o=null}else if(!I(o.getPoint(),y))o=null}if(!o&&j==="miter"&&g>1)for(var G=0;G<g;G++){var R=v[G];if(i.getDistance(R._point)<=p*r&&L(R)){o=R.getLocation();break}}}return!o&&S&&this._contains(i)||o&&!N&&!d?new w6("fill",this):o?new w6(N?"stroke":"curve",this,{location:o,point:o.getPoint()}):null}},k.each(Z._evaluateMethods,function(i){this[i+"At"]=function(u){var h=this.getLocationAt(u);return h&&h[i]()}},{beans:!1,getLocationOf:function(){var i=A.read(arguments),u=this.getCurves();for(var h=0,f=u.length;h<f;h++){var t=u[h].getLocationOf(i);if(t)return t}return null},getOffsetOf:function(){var i=this.getLocationOf.apply(this,arguments);return i?i.getOffset():null},getLocationAt:function(i){if(typeof i==="number"){var u=this.getCurves(),h=0;for(var f=0,t=u.length;f<t;f++){var n=h,v=u[f];if(h+=v.getLength(),h>i)return v.getLocationAt(i-n)}if(u.length>0&&i<=this.getLength())return new h6(u[u.length-1],1)}else if(i&&i.getPath&&i.getPath()===this)return i;return null},getOffsetsWithTangent:function(){var i=A.read(arguments);if(i.isZero())return[];var u=[],h=0,f=this.getCurves();for(var t=0,n=f.length;t<n;t++){var v=f[t],g=v.getTimesWithTangent(i);for(var w=0,x=g.length;w<x;w++){var y=h+v.getOffsetAtTime(g[w]);if(u.indexOf(y)<0)u.push(y)}h+=v.length}return u}}),new function(){function i(h,f,t,n){if(n<=0)return;var v=n/2,g=n-2,w=v-1,x=new Array(6),y,j;function l(S){var d=x[S],r=x[S+1];if(y!=d||j!=r)h.beginPath(),h.moveTo(y,j),h.lineTo(d,r),h.stroke(),h.beginPath(),h.arc(d,r,v,0,Math.PI*2,!0),h.fill()}for(var p=0,b=f.length;p<b;p++){var o=f[p],z=o._selection;if(o._transformCoordinates(t,x),y=x[0],j=x[1],z&2)l(2);if(z&4)l(4);if(h.fillRect(y-v,j-v,n,n),g>0&&!(z&1)){var N=h.fillStyle;h.fillStyle="#ffffff",h.fillRect(y-w,j-w,g,g),h.fillStyle=N}}}function u(h,f,t){var n=f._segments,v=n.length,g=new Array(6),w=!0,x,y,j,l,p,b,o,z;function N(d){if(t)d._transformCoordinates(t,g),x=g[0],y=g[1];else{var r=d._point;x=r._x,y=r._y}if(w)h.moveTo(x,y),w=!1;else{if(t)p=g[2],b=g[3];else{var I=d._handleIn;p=x+I._x,b=y+I._y}if(p===x&&b===y&&o===j&&z===l)h.lineTo(x,y);else h.bezierCurveTo(o,z,p,b,x,y)}if(j=x,l=y,t)o=g[4],z=g[5];else{var I=d._handleOut;o=j+I._x,z=l+I._y}}for(var S=0;S<v;S++)N(n[S]);if(f._closed&&v>0)N(n[0])}return{_draw:function(h,f,t,n){var v=f.dontStart,g=f.dontFinish||f.clip,w=this.getStyle(),x=w.hasFill(),y=w.hasStroke(),j=w.getDashArray(),l=!P0.support.nativeDash&&y&&j&&j.length;if(!v)h.beginPath();if(x||y&&!l||g){if(u(h,this,n),this._closed)h.closePath()}function p(d){return j[(d%l+l)%l]}if(!g&&(x||y)){if(this._setStyles(h,f,t),x)h.fill(w.getFillRule()),h.shadowColor="rgba(0,0,0,0)";if(y){if(l){if(!v)h.beginPath();var b=new N8(this,0.25,32,!1,n),o=b.length,z=-w.getDashOffset(),N,S=0;while(z>0)z-=p(S--)+p(S--);while(z<o){if(N=z+p(S++),z>0||N>0)b.drawPart(h,Math.max(z,0),Math.max(N,0));z=N+p(S++)}}h.stroke()}}},_drawSelected:function(h,f){h.beginPath(),u(h,this,f),h.stroke(),i(h,this._segments,f,P0.settings.handleSize)}}},new function(){function i(u){var h=u._segments;if(!h.length)throw new Error("Use a moveTo() command first");return h[h.length-1]}return{moveTo:function(){var u=this._segments;if(u.length===1)this.removeSegment(0);if(!u.length)this._add([new n0(A.read(arguments))])},moveBy:function(){throw new Error("moveBy() is unsupported on Path items.")},lineTo:function(){this._add([new n0(A.read(arguments))])},cubicCurveTo:function(){var u=arguments,h=A.read(u),f=A.read(u),t=A.read(u),n=i(this);n.setHandleOut(h.subtract(n._point)),this._add([new n0(t,f.subtract(t))])},quadraticCurveTo:function(){var u=arguments,h=A.read(u),f=A.read(u),t=i(this)._point;this.cubicCurveTo(h.add(t.subtract(h).multiply(0.3333333333333333)),h.add(f.subtract(h).multiply(0.3333333333333333)),f)},curveTo:function(){var u=arguments,h=A.read(u),f=A.read(u),t=k.pick(k.read(u),0.5),n=1-t,v=i(this)._point,g=h.subtract(v.multiply(n*n)).subtract(f.multiply(t*t)).divide(2*t*n);if(g.isNaN())throw new Error("Cannot put a curve through points with parameter = "+t);this.quadraticCurveTo(g,f)},arcTo:function(){var u=arguments,h=Math.abs,f=Math.sqrt,t=i(this),n=t._point,v=A.read(u),b,g=k.peek(u),w=k.pick(g,!0),x,y,j,l;if(typeof w==="boolean")var p=n.add(v).divide(2),b=p.add(p.subtract(n).rotate(w?-90:90));else if(k.remain(u)<=2)b=v,v=A.read(u);else if(!n.equals(v)){var o=W.read(u),z=v0.isZero;if(z(o.width)||z(o.height))return this.lineTo(v);var N=k.read(u),w=!!k.read(u),S=!!k.read(u),p=n.add(v).divide(2),d=n.subtract(p).rotate(-N),r=d.x,I=d.y,B=h(o.width),_=h(o.height),M=B*B,L=_*_,G=r*r,V=I*I,R=f(G/M+V/L);if(R>1)B*=R,_*=R,M=B*B,L=_*_;if(R=(M*L-M*V-L*G)/(M*V+L*G),h(R)<0.000000000001)R=0;if(R<0)throw new Error("Cannot create an arc with the given arguments");if(x=new A(B*I/_,-_*r/B).multiply((S===w?-1:1)*f(R)).rotate(N).add(p),l=new j0().translate(x).rotate(N).scale(B,_),j=l._inverseTransform(n),y=j.getDirectedAngle(l._inverseTransform(v)),!w&&y>0)y-=360;else if(w&&y<0)y+=360}if(b){var q=new k0(n.add(b).divide(2),b.subtract(n).rotate(90),!0),E=new k0(b.add(v).divide(2),v.subtract(b).rotate(90),!0),e=new k0(n,v),O=e.getSide(b);if(x=q.intersect(E,!0),!x){if(!O)return this.lineTo(v);throw new Error("Cannot create an arc with the given arguments")}j=n.subtract(x),y=j.getDirectedAngle(v.subtract(x));var X=e.getSide(x,!0);if(X===0)y=O*h(y);else if(O===X)y+=y<0?360:-360}if(y){var H=0.00001,Y=h(y),K=Y>=360?4:Math.ceil((Y-H)/90),f0=y/K,i0=f0*Math.PI/360,g0=1.3333333333333333*Math.sin(i0)/(1+Math.cos(i0)),Q=[];for(var x0=0;x0<=K;x0++){var d=v,h0=null;if(x0<K)if(h0=j.rotate(90).multiply(g0),l)d=l._transformPoint(j),h0=l._transformPoint(j.add(h0)).subtract(d);else d=x.add(j);if(!x0)t.setHandleOut(h0);else{var S0=j.rotate(-90).multiply(g0);if(l)S0=l._transformPoint(j.add(S0)).subtract(d);Q.push(new n0(d,S0,h0))}j=j.rotate(f0)}this._add(Q)}},lineBy:function(){var u=A.read(arguments),h=i(this)._point;this.lineTo(h.add(u))},curveBy:function(){var u=arguments,h=A.read(u),f=A.read(u),t=k.read(u),n=i(this)._point;this.curveTo(n.add(h),n.add(f),t)},cubicCurveBy:function(){var u=arguments,h=A.read(u),f=A.read(u),t=A.read(u),n=i(this)._point;this.cubicCurveTo(n.add(h),n.add(f),n.add(t))},quadraticCurveBy:function(){var u=arguments,h=A.read(u),f=A.read(u),t=i(this)._point;this.quadraticCurveTo(t.add(h),t.add(f))},arcBy:function(){var u=arguments,h=i(this)._point,f=h.add(A.read(u)),t=k.pick(k.peek(u),!0);if(typeof t==="boolean")this.arcTo(f,t);else this.arcTo(f,h.add(A.read(u)))},closePath:function(u){this.setClosed(!0),this.join(this,u)}}},{_getBounds:function(i,u){var h=u.handle?"getHandleBounds":u.stroke?"getStrokeBounds":"getBounds";return N0[h](this._segments,this._closed,this,i,u)},statics:{getBounds:function(i,u,h,f,t,n){var v=i[0];if(!v)return new u0;var g=new Array(6),w=v._transformCoordinates(f,new Array(6)),x=w.slice(0,2),y=x.slice(),j=new Array(2);function l(o){o._transformCoordinates(f,g);for(var z=0;z<2;z++)Z._addBounds(w[z],w[z+4],g[z+2],g[z],z,n?n[z]:0,x,y,j);var N=w;w=g,g=N}for(var p=1,b=i.length;p<b;p++)l(i[p]);if(u)l(v);return new u0(x[0],x[1],y[0]-x[0],y[1]-x[1])},getStrokeBounds:function(i,u,h,f,t){var n=h.getStyle(),v=n.hasStroke(),g=n.getStrokeWidth(),w=v&&h._getStrokeMatrix(f,t),x=v&&N0._getStrokePadding(g,w),y=N0.getBounds(i,u,h,f,t,x);if(!v)return y;var j=g/2,l=n.getStrokeJoin(),p=n.getStrokeCap(),b=n.getMiterLimit(),o=new u0(new W(x));function z(B){y=y.include(B)}function N(B){y=y.unite(o.setCenter(B._point.transform(f)))}function S(B,_){if(_==="round"||B.isSmooth())N(B);else N0._addBevelJoin(B,_,j,b,f,w,z)}function d(B,_){if(_==="round")N(B);else N0._addSquareCap(B,_,j,f,w,z)}var r=i.length-(u?0:1);if(r>0){for(var I=1;I<r;I++)S(i[I],l);if(u)S(i[0],l);else d(i[0],p),d(i[i.length-1],p)}return y},_getStrokePadding:function(i,u){if(!u)return[i,i];var h=new A(i,0).transform(u),f=new A(0,i).transform(u),t=h.getAngleInRadians(),n=h.getLength(),v=f.getLength(),g=Math.sin(t),w=Math.cos(t),x=Math.tan(t),y=Math.atan2(v*x,n),j=Math.atan2(v,x*n);return[Math.abs(n*Math.cos(y)*w+v*Math.sin(y)*g),Math.abs(v*Math.sin(j)*w+n*Math.cos(j)*g)]},_addBevelJoin:function(i,u,h,f,t,n,v,g){var w=i.getCurve(),x=w.getPrevious(),y=w.getPoint1().transform(t),j=x.getNormalAtTime(1).multiply(h).transform(n),l=w.getNormalAtTime(0).multiply(h).transform(n),p=j.getDirectedAngle(l);if(p<0||p>=180)j=j.negate(),l=l.negate();if(g)v(y);if(v(y.add(j)),u==="miter"){var b=new k0(y.add(j),new A(-j.y,j.x),!0).intersect(new k0(y.add(l),new A(-l.y,l.x),!0),!0);if(b&&y.getDistance(b)<=f*h)v(b)}v(y.add(l))},_addSquareCap:function(i,u,h,f,t,n,v){var g=i._point.transform(f),w=i.getLocation(),x=w.getNormal().multiply(w.getTime()===0?h:-h).transform(t);if(u==="square"){if(v)n(g.subtract(x)),n(g.add(x));g=g.add(x.rotate(-90))}n(g.add(x)),n(g.subtract(x))},getHandleBounds:function(i,u,h,f,t){var n=h.getStyle(),v=t.stroke&&n.hasStroke(),g,w;if(v){var x=h._getStrokeMatrix(f,t),y=n.getStrokeWidth()/2,j=y;if(n.getStrokeJoin()==="miter")j=y*n.getMiterLimit();if(n.getStrokeCap()==="square")j=Math.max(j,y*Math.SQRT2);g=N0._getStrokePadding(y,x),w=N0._getStrokePadding(j,x)}var l=new Array(6),p=Infinity,b=-p,o=p,z=b;for(var N=0,S=i.length;N<S;N++){var d=i[N];d._transformCoordinates(f,l);for(var r=0;r<6;r+=2){var I=!r?w:g,B=I?I[0]:0,_=I?I[1]:0,M=l[r],L=l[r+1],G=M-B,V=M+B,R=L-_,q=L+_;if(G<p)p=G;if(V>b)b=V;if(R<o)o=R;if(q>z)z=q}}return new u0(p,o,b-p,z-o)}}});N0.inject({statics:new function(){var i=0.5522847498307936,u=[new n0([-1,0],[0,i],[0,-i]),new n0([0,-1],[-i,0],[i,0]),new n0([1,0],[0,-i],[0,i]),new n0([0,1],[i,0],[-i,0])];function h(t,n,v){var g=k.getNamed(v),w=new N0(g&&(g.insert==!0?m0.INSERT:g.insert==!1?m0.NO_INSERT:null));return w._add(t),w._closed=n,w.set(g,m0.INSERT)}function f(t,n,v){var g=new Array(4);for(var w=0;w<4;w++){var x=u[w];g[w]=new n0(x._point.multiply(n).add(t),x._handleIn.multiply(n),x._handleOut.multiply(n))}return h(g,!0,v)}return{Line:function(){var t=arguments;return h([new n0(A.readNamed(t,"from")),new n0(A.readNamed(t,"to"))],!1,t)},Circle:function(){var t=arguments,n=A.readNamed(t,"center"),v=k.readNamed(t,"radius");return f(n,new W(v),t)},Rectangle:function(){var t=arguments,n=u0.readNamed(t,"rectangle"),v=W.readNamed(t,"radius",0,{readNull:!0}),g=n.getBottomLeft(!0),w=n.getTopLeft(!0),x=n.getTopRight(!0),y=n.getBottomRight(!0),j;if(!v||v.isZero())j=[new n0(g),new n0(w),new n0(x),new n0(y)];else{v=W.min(v,n.getSize(!0).divide(2));var{width:l,height:p}=v,b=l*i,o=p*i;j=[new n0(g.add(l,0),null,[-b,0]),new n0(g.subtract(0,p),[0,o]),new n0(w.add(0,p),null,[0,-o]),new n0(w.add(l,0),[-b,0],null),new n0(x.subtract(l,0),null,[b,0]),new n0(x.add(0,p),[0,-o],null),new n0(y.subtract(0,p),null,[0,o]),new n0(y.subtract(l,0),[b,0])]}return h(j,!0,t)},RoundRectangle:"#Rectangle",Ellipse:function(){var t=arguments,n=K0._readEllipse(t);return f(n.center,n.radius,t)},Oval:"#Ellipse",Arc:function(){var t=arguments,n=A.readNamed(t,"from"),v=A.readNamed(t,"through"),g=A.readNamed(t,"to"),w=k.getNamed(t),x=new N0(w&&w.insert==!1&&m0.NO_INSERT);return x.moveTo(n),x.arcTo(v,g),x.set(w)},RegularPolygon:function(){var t=arguments,n=A.readNamed(t,"center"),v=k.readNamed(t,"sides"),g=k.readNamed(t,"radius"),w=360/v,x=v%3===0,y=new A(0,x?-g:g),j=x?-1:0.5,l=new Array(v);for(var p=0;p<v;p++)l[p]=new n0(n.add(y.rotate((p+j)*w)));return h(l,!0,t)},Star:function(){var t=arguments,n=A.readNamed(t,"center"),v=k.readNamed(t,"points")*2,g=k.readNamed(t,"radius1"),w=k.readNamed(t,"radius2"),x=360/v,y=new A(0,-1),j=new Array(v);for(var l=0;l<v;l++)j[l]=new n0(n.add(y.rotate(x*l).multiply(l%2?w:g)));return h(j,!0,t)}}}});var f6=I6.extend({_class:"CompoundPath",_serializeFields:{children:[]},beans:!0,initialize:function i(u){if(this._children=[],this._namedChildren={},!this._initialize(u))if(typeof u==="string")this.setPathData(u);else this.addChildren(Array.isArray(u)?u:arguments)},insertChildren:function i(u,h){var f=h,t=f[0];if(t&&typeof t[0]==="number")f=[f];for(var n=h.length-1;n>=0;n--){var v=f[n];if(f===h&&!(v instanceof N0))f=k.slice(f);if(Array.isArray(v))f[n]=new N0({segments:v,insert:!1});else if(v instanceof f6)f.splice.apply(f,[n,1].concat(v.removeChildren())),v.remove()}return i.base.call(this,u,f)},reduce:function i(u){var h=this._children;for(var f=h.length-1;f>=0;f--){var t=h[f].reduce(u);if(t.isEmpty())t.remove()}if(!h.length){var t=new N0(m0.NO_INSERT);return t.copyAttributes(this),t.insertAbove(this),this.remove(),t}return i.base.call(this)},isClosed:function(){var i=this._children;for(var u=0,h=i.length;u<h;u++)if(!i[u]._closed)return!1;return!0},setClosed:function(i){var u=this._children;for(var h=0,f=u.length;h<f;h++)u[h].setClosed(i)},getFirstSegment:function(){var i=this.getFirstChild();return i&&i.getFirstSegment()},getLastSegment:function(){var i=this.getLastChild();return i&&i.getLastSegment()},getCurves:function(){var i=this._children,u=[];for(var h=0,f=i.length;h<f;h++)k.push(u,i[h].getCurves());return u},getFirstCurve:function(){var i=this.getFirstChild();return i&&i.getFirstCurve()},getLastCurve:function(){var i=this.getLastChild();return i&&i.getLastCurve()},getArea:function(){var i=this._children,u=0;for(var h=0,f=i.length;h<f;h++)u+=i[h].getArea();return u},getLength:function(){var i=this._children,u=0;for(var h=0,f=i.length;h<f;h++)u+=i[h].getLength();return u},getPathData:function(i,u){var h=this._children,f=[];for(var t=0,n=h.length;t<n;t++){var v=h[t],g=v._matrix;f.push(v.getPathData(i&&!g.isIdentity()?i.appended(g):i,u))}return f.join("")},_hitTestChildren:function i(u,h,f){return i.base.call(this,u,h.class===N0||h.type==="path"?h:k.set({},h,{fill:!1}),f)},_draw:function(i,u,h,f){var t=this._children;if(!t.length)return;u=u.extend({dontStart:!0,dontFinish:!0}),i.beginPath();for(var n=0,v=t.length;n<v;n++)t[n].draw(i,u,f);if(!u.clip){this._setStyles(i,u,h);var g=this._style;if(g.hasFill())i.fill(g.getFillRule()),i.shadowColor="rgba(0,0,0,0)";if(g.hasStroke())i.stroke()}},_drawSelected:function(i,u,h){var f=this._children;for(var t=0,n=f.length;t<n;t++){var v=f[t],g=v._matrix;if(!h[v._id])v._drawSelected(i,g.isIdentity()?u:u.appended(g))}}},new function(){function i(u,h){var f=u._children;if(h&&!f.length)throw new Error("Use a moveTo() command first");return f[f.length-1]}return k.each(["lineTo","cubicCurveTo","quadraticCurveTo","curveTo","arcTo","lineBy","cubicCurveBy","quadraticCurveBy","curveBy","arcBy"],function(u){this[u]=function(){var h=i(this,!0);h[u].apply(h,arguments)}},{moveTo:function(){var u=i(this),h=u&&u.isEmpty()?u:new N0(m0.NO_INSERT);if(h!==u)this.addChild(h);h.moveTo.apply(h,arguments)},moveBy:function(){var u=i(this,!0),h=u&&u.getLastSegment(),f=A.read(arguments);this.moveTo(h?f.add(h._point):f)},closePath:function(u){i(this,!0).closePath(u)}})},k.each(["reverse","flatten","simplify","smooth"],function(i){this[i]=function(u){var h=this._children,f;for(var t=0,n=h.length;t<n;t++)f=h[t][i](u)||f;return f}},{}));I6.inject(new function(){var{min:i,max:u,abs:h}=Math,f={unite:{"1":!0,"2":!0},intersect:{"2":!0},subtract:{"1":!0},exclude:{"1":!0,"-1":!0}};function t(N){return N._children||[N]}function n(N,S){var d=N.clone(!1).reduce({simplify:!0}).transform(null,!0,!0);if(S){var r=t(d);for(var I=0,B=r.length;I<B;I++){var N=r[I];if(!N._closed&&!N.isEmpty())N.closePath(0.000000000001),N.getFirstSegment().setHandleIn(0,0),N.getLastSegment().setHandleOut(0,0)}d=d.resolveCrossings().reorient(d.getFillRule()==="nonzero",!0)}return d}function v(N,S,d,r,I){var B=new f6(m0.NO_INSERT);if(B.addChildren(N,!0),B=B.reduce({simplify:S}),!(I&&I.insert==!1))B.insertAbove(r&&d.isSibling(r)&&d.getIndex()<r.getIndex()?r:d);return B.copyAttributes(d,!0),B}function g(N){return N.hasOverlap()||N.isCrossing()}function w(N,S,d,r){if(r&&(r.trace==!1||r.stroke)&&/^(subtract|intersect)$/.test(d))return x(N,S,d);var I=n(N,!0),B=S&&N!==S&&n(S,!0),_=f[d];if(_[d]=!0,B&&(_.subtract||_.exclude)^(B.isClockwise()^I.isClockwise()))B.reverse();var M=p(h6.expand(I.getIntersections(B,g))),L=t(I),G=B&&t(B),V=[],R=[],q;function E(h0){for(var S0=0,s0=h0.length;S0<s0;S0++){var C0=h0[S0];k.push(V,C0._segments),k.push(R,C0.getCurves()),C0._overlapsOnly=!0}}function e(h0){var S0=[];for(var s0=0,C0=h0&&h0.length;s0<C0;s0++)S0.push(R[h0[s0]]);return S0}if(M.length){if(E(L),G)E(G);var O=new Array(R.length);for(var X=0,H=R.length;X<H;X++)O[X]=R[X].getValues();var Y=t0.findCurveBoundsCollisions(O,O,0,!0),K={};for(var X=0;X<R.length;X++){var f0=R[X],i0=f0._path._id,g0=K[i0]=K[i0]||{};g0[f0.getIndex()]={hor:e(Y[X].hor),ver:e(Y[X].ver)}}for(var X=0,H=M.length;X<H;X++)o(M[X]._segment,I,B,K,_);for(var X=0,H=V.length;X<H;X++){var Q=V[X],x0=Q._intersection;if(!Q._winding)o(Q,I,B,K,_);if(!(x0&&x0._overlap))Q._path._overlapsOnly=!1}q=z(V,_)}else q=l(G?L.concat(G):L.slice(),function(h0){return!!_[h0]});return v(q,!0,N,S,r)}function x(N,S,d){var r=n(N),I=n(S),B=r.getIntersections(I,g),_=d==="subtract",M=d==="divide",L={},G=[];function V(E){if(!L[E._id]&&(M||I.contains(E.getPointAt(E.getLength()/2))^_))return G.unshift(E),L[E._id]=!0}for(var R=B.length-1;R>=0;R--){var q=B[R].split();if(q){if(V(q))q.getFirstSegment().setHandleIn(0,0);r.getLastSegment().setHandleOut(0,0)}}return V(r),v(G,!1,N,S)}function y(N,S){var d=N;while(d){if(d===S)return;d=d._previous}while(N._next&&N._next!==S)N=N._next;if(!N._next){while(S._previous)S=S._previous;N._next=S,S._previous=N}}function j(N){for(var S=N.length-1;S>=0;S--)N[S].clearHandles()}function l(N,S,d){var r=N&&N.length;if(r){var I=k.each(N,function(Y,K){this[Y._id]={container:null,winding:Y.isClockwise()?1:-1,index:K}},{}),B=N.slice().sort(function(Y,K){return h(K.getArea())-h(Y.getArea())}),_=B[0],M=t0.findItemBoundsCollisions(B,null,v0.GEOMETRIC_EPSILON);if(d==null)d=_.isClockwise();for(var L=0;L<r;L++){var G=B[L],V=I[G._id],R=0,q=M[L];if(q){var E=null;for(var e=q.length-1;e>=0;e--)if(q[e]<L){E=E||G.getInteriorPoint();var O=B[q[e]];if(O.contains(E)){var X=I[O._id];R=X.winding,V.winding+=R,V.container=X.exclude?X.container:O;break}}}if(S(V.winding)===S(R))V.exclude=!0,N[V.index]=null;else{var H=V.container;G.setClockwise(H?!H.isClockwise():d)}}}return N}function p(N,S,d){var r=S&&[],I=0.00000001,B=1-I,_=!1,M=d||[],L=d&&{},G,V,R;function q(S0){return S0._path._id+"."+S0._segment1._index}for(var E=(d&&d.length)-1;E>=0;E--){var e=d[E];if(e._path)L[q(e)]=!0}for(var E=N.length-1;E>=0;E--){var O=N[E],X=O._time,H=X,Y=S&&!S(O),e=O._curve,K;if(e){if(e!==V)_=!e.hasHandles()||L&&L[q(e)],G=[],R=null,V=e;else if(R>=I)X/=R}if(Y){if(G)G.push(O);continue}else if(S)r.unshift(O);if(R=H,X<I)K=e._segment1;else if(X>B)K=e._segment2;else{var f0=e.divideAtTime(X,!0);if(_)M.push(e,f0);K=f0._segment1;for(var i0=G.length-1;i0>=0;i0--){var g0=G[i0];g0._time=(g0._time-X)/(1-X)}}O._setSegment(K);var Q=K._intersection,x0=O._intersection;if(Q){y(Q,x0);var h0=Q;while(h0)y(h0._intersection,Q),h0=h0._next}else K._intersection=x0}if(!d)j(M);return r||N}function b(N,S,d,r,I){var B=Array.isArray(S)?S:S[d?"hor":"ver"],_=d?1:0,M=_^1,L=[N.x,N.y],G=L[_],V=L[M],R=0.000000001,q=0.000001,E=G-R,e=G+R,O=0,X=0,H=0,Y=0,K=!1,f0=!1,i0=1,g0=[],Q,x0;function h0(z0){var E0=z0[M+0],$0=z0[M+6];if(V<i(E0,$0)||V>u(E0,$0))return;var F0=z0[_+0],p6=z0[_+2],M6=z0[_+4],y6=z0[_+6];if(E0===$0){if(F0<e&&y6>E||y6<e&&F0>E)K=!0;return}var r6=V===E0?0:V===$0?1:E>u(F0,p6,M6,y6)||e<i(F0,p6,M6,y6)?1:Z.solveCubic(z0,M,V,g0,0,1)>0?g0[0]:1,i6=r6===0?F0:r6===1?y6:Z.getPoint(z0,r6)[d?"y":"x"],t6=E0>$0?1:-1,E6=Q[M]>Q[M+6]?1:-1,C6=Q[_+6];if(V!==E0){if(i6<E)H+=t6;else if(i6>e)Y+=t6;else K=!0;if(i6>G-q&&i6<G+q)i0/=2}else{if(t6!==E6){if(F0<E)H+=t6;else if(F0>e)Y+=t6}else if(F0!=C6){if(C6<e&&i6>e)Y+=t6,K=!0;else if(C6>E&&i6<E)H+=t6,K=!0}i0/=4}return Q=z0,!I&&i6>E&&i6<e&&Z.getTangent(z0,r6)[d?"x":"y"]===0&&b(N,S,!d,r,!0)}function S0(z0){var E0=z0[M+0],$0=z0[M+2],F0=z0[M+4],p6=z0[M+6];if(V<=u(E0,$0,F0,p6)&&V>=i(E0,$0,F0,p6)){var M6=z0[_+0],y6=z0[_+2],r6=z0[_+4],i6=z0[_+6],t6=E>u(M6,y6,r6,i6)||e<i(M6,y6,r6,i6)?[z0]:Z.getMonoCurves(z0,d),E6;for(var C6=0,D5=t6.length;C6<D5;C6++)if(E6=h0(t6[C6]))return E6}}for(var s0=0,C0=B.length;s0<C0;s0++){var b0=B[s0],l0=b0._path,O0=b0.getValues(),X0;if(!s0||B[s0-1]._path!==l0){if(Q=null,!l0._closed){if(x0=Z.getValues(l0.getLastCurve().getSegment2(),b0.getSegment1(),null,!r),x0[M]!==x0[M+6])Q=x0}if(!Q){Q=O0;var Z0=l0.getLastCurve();while(Z0&&Z0!==b0){var A0=Z0.getValues();if(A0[M]!==A0[M+6]){Q=A0;break}Z0=Z0.getPrevious()}}}if(X0=S0(O0))return X0;if(s0+1===C0||B[s0+1]._path!==l0){if(x0&&(X0=S0(x0)))return X0;if(K&&!H&&!Y)H=Y=l0.isClockwise(r)^d?1:-1;if(O+=H,X+=Y,H=Y=0,K)f0=!0,K=!1;x0=null}}return O=h(O),X=h(X),{winding:u(O,X),windingL:O,windingR:X,quality:i0,onPath:f0}}function o(N,S,d,r,I){var B=[],_=N,M=0,R;do{var L=N.getCurve();if(L){var G=L.getLength();B.push({segment:N,curve:L,length:G}),M+=G}N=N.getNext()}while(N&&!N._intersection&&N!==_);var V=[0.5,0.25,0.75],R={winding:0,quality:-1},q=0.001,E=1-q;for(var e=0;e<V.length&&R.quality<0.5;e++){var G=M*V[e];for(var O=0,X=B.length;O<X;O++){var H=B[O],Y=H.length;if(G<=Y){var L=H.curve,K=L._path,f0=K._parent,i0=f0 instanceof f6?f0:K,g0=v0.clamp(L.getTimeAt(G),q,E),Q=L.getPointAtTime(g0),x0=h(L.getTangentAtTime(g0).y)<Math.SQRT1_2,h0=null;if(I.subtract&&d){var S0=i0===S?d:S,s0=S0._getWinding(Q,x0,!0);if(i0===S&&s0.winding||i0===d&&!s0.winding)if(s0.quality<1)continue;else h0={winding:0,quality:1}}if(h0=h0||b(Q,r[K._id][L.getIndex()],x0,!0),h0.quality>R.quality)R=h0;break}G-=Y}}for(var O=B.length-1;O>=0;O--)B[O].segment._winding=R}function z(N,S){var d=[],r;function I(C0){var b0;return!!(C0&&!C0._visited&&(!S||S[(b0=C0._winding||{}).winding]&&!(S.unite&&b0.winding===2&&b0.windingL&&b0.windingR)))}function B(C0){if(C0){for(var b0=0,l0=r.length;b0<l0;b0++)if(C0===r[b0])return!0}return!1}function _(C0){var b0=C0._segments;for(var l0=0,O0=b0.length;l0<O0;l0++)b0[l0]._visited=!0}function M(C0,b0){var l0=C0._intersection,O0=l0,X0=[];if(b0)r=[C0];function Z0(A0,z0){while(A0&&A0!==z0){var E0=A0._segment,$0=E0&&E0._path;if($0){var F0=E0.getNext()||$0.getFirstSegment(),p6=F0._intersection;if(E0!==C0&&(B(E0)||B(F0)||F0&&(I(E0)&&(I(F0)||p6&&I(p6._segment)))))X0.push(E0);if(b0)r.push(E0)}A0=A0._next}}if(l0){Z0(l0);while(l0&&l0._previous)l0=l0._previous;Z0(l0,O0)}return X0}N.sort(function(C0,b0){var l0=C0._intersection,O0=b0._intersection,X0=!!(l0&&l0._overlap),Z0=!!(O0&&O0._overlap),A0=C0._path,z0=b0._path;return X0^Z0?X0?1:-1:!l0^!O0?l0?1:-1:A0!==z0?A0._id-z0._id:C0._index-b0._index});for(var L=0,G=N.length;L<G;L++){var V=N[L],R=I(V),q=null,E=!1,e=!0,O=[],X,H,Y;if(R&&V._path._overlapsOnly){var K=V._path,f0=V._intersection._segment._path;if(K.compare(f0)){if(K.getArea())d.push(K.clone(!1));_(K),_(f0),R=!1}}while(R){var i0=!q,g0=M(V,i0),Q=g0.shift(),E=!i0&&(B(V)||B(Q)),x0=!E&&Q;if(i0)q=new N0(m0.NO_INSERT),X=null;if(E){if(V.isFirst()||V.isLast())e=V._path._closed;V._visited=!0;break}if(x0&&X)O.push(X),X=null;if(!X){if(x0)g0.push(V);X={start:q._segments.length,crossings:g0,visited:H=[],handleIn:Y}}if(x0)V=Q;if(!I(V)){q.removeSegments(X.start);for(var h0=0,S0=H.length;h0<S0;h0++)H[h0]._visited=!1;H.length=0;do if(V=X&&X.crossings.shift(),!V||!V._path){if(V=null,X=O.pop(),X)H=X.visited,Y=X.handleIn}while(X&&!I(V));if(!V)break}var s0=V.getNext();q.add(new n0(V._point,Y,s0&&V._handleOut)),V._visited=!0,H.push(V),V=s0||V._path.getFirstSegment(),Y=s0&&s0._handleIn}if(E){if(e)q.getFirstSegment().setHandleIn(Y),q.setClosed(e);if(q.getArea()!==0)d.push(q)}}return d}return{_getWinding:function(N,S,d){return b(N,this.getCurves(),S,d)},unite:function(N,S){return w(this,N,"unite",S)},intersect:function(N,S){return w(this,N,"intersect",S)},subtract:function(N,S){return w(this,N,"subtract",S)},exclude:function(N,S){return w(this,N,"exclude",S)},divide:function(N,S){return S&&(S.trace==!1||S.stroke)?x(this,N,"divide"):v([this.subtract(N,S),this.intersect(N,S)],!0,this,N,S)},resolveCrossings:function(){var N=this._children,S=N||[this];function d(X,H){var Y=X&&X._intersection;return Y&&Y._overlap&&Y._path===H}var r=!1,I=!1,B=this.getIntersections(null,function(X){return X.hasOverlap()&&(r=!0)||X.isCrossing()&&(I=!0)}),_=r&&I&&[];if(B=h6.expand(B),r){var M=p(B,function(X){return X.hasOverlap()},_);for(var L=M.length-1;L>=0;L--){var G=M[L],V=G._path,R=G._segment,q=R.getPrevious(),E=R.getNext();if(d(q,V)&&d(E,V)){if(R.remove(),q._handleOut._set(0,0),E._handleIn._set(0,0),q!==R&&!q.getCurve().hasLength())E._handleIn.set(q._handleIn),q.remove()}}}if(I){if(p(B,r&&function(X){var H=X.getCurve(),Y=X.getSegment(),K=X._intersection,f0=K._curve,i0=K._segment;if(H&&f0&&H._path&&f0._path)return!0;if(Y)Y._intersection=null;if(i0)i0._intersection=null},_),_)j(_);S=z(k.each(S,function(X){k.push(this,X._segments)},[]))}var e=S.length,O;if(e>1&&N){if(S!==N)this.setChildren(S);O=this}else if(e===1&&!N){if(S[0]!==this)this.setSegments(S[0].removeSegments());O=this}if(!O)O=new f6(m0.NO_INSERT),O.addChildren(S),O=O.reduce(),O.copyAttributes(this),this.replaceWith(O);return O},reorient:function(N,S){var d=this._children;if(d&&d.length)this.setChildren(l(this.removeChildren(),function(r){return!!(N?r:r&1)},S));else if(S!==D)this.setClockwise(S);return this},getInteriorPoint:function(){var N=this.getBounds(),S=N.getCenter(!0);if(!this.contains(S)){var d=this.getCurves(),r=S.y,I=[],B=[];for(var _=0,M=d.length;_<M;_++){var L=d[_].getValues(),G=L[1],V=L[3],R=L[5],q=L[7];if(r>=i(G,V,R,q)&&r<=u(G,V,R,q)){var E=Z.getMonoCurves(L);for(var e=0,O=E.length;e<O;e++){var X=E[e],H=X[1],Y=X[7];if(H!==Y&&(r>=H&&r<=Y||r>=Y&&r<=H)){var K=r===H?X[0]:r===Y?X[6]:Z.solveCubic(X,1,r,B,0,1)===1?Z.getPoint(X,B[0]).x:(X[0]+X[6])/2;I.push(K)}}}}if(I.length>1)I.sort(function(f0,i0){return f0-i0}),S.x=(I[0]+I[1])/2}return S}}});var N8=k.extend({_class:"PathFlattener",initialize:function(i,u,h,f,t){var n=[],v=[],g=0,w=1/(h||32),x=i._segments,y=x[0],j;function l(z,N){var S=Z.getValues(z,N,t);n.push(S),p(S,z._index,0,1)}function p(z,N,S,d){if(d-S>w&&!(f&&Z.isStraight(z))&&!Z.isFlatEnough(z,u||0.25)){var r=Z.subdivide(z,0.5),I=(S+d)/2;p(r[0],N,S,I),p(r[1],N,I,d)}else{var B=z[6]-z[0],_=z[7]-z[1],M=Math.sqrt(B*B+_*_);if(M>0)g+=M,v.push({offset:g,curve:z,index:N,time:d})}}for(var b=1,o=x.length;b<o;b++)j=x[b],l(y,j),y=j;if(i._closed)l(j||y,x[0]);this.curves=n,this.parts=v,this.length=g,this.index=0},_get:function(i){var u=this.parts,h=u.length,f,t,n=this.index;for(;;)if(t=n,!n||u[--n].offset<i)break;for(;t<h;t++){var v=u[t];if(v.offset>=i){this.index=t;var g=u[t-1],w=g&&g.index===v.index?g.time:0,x=g?g.offset:0;return{index:v.index,time:w+(v.time-w)*(i-x)/(v.offset-x)}}}return{index:u[h-1].index,time:1}},drawPart:function(i,u,h){var f=this._get(u),t=this._get(h);for(var n=f.index,v=t.index;n<=v;n++){var g=Z.getPart(this.curves[n],n===f.index?f.time:0,n===t.index?t.time:1);if(n===f.index)i.moveTo(g[0],g[1]);i.bezierCurveTo.apply(i,g.slice(2))}}},k.each(Z._evaluateMethods,function(i){this[i+"At"]=function(u){var h=this._get(u);return Z[i](this.curves[h.index],h.time)}},{})),B5=k.extend({initialize:function(i){var u=this.points=[],h=i._segments,f=i._closed;for(var t=0,n,v=h.length;t<v;t++){var g=h[t].point;if(!n||!n.equals(g))u.push(n=g.clone())}if(f)u.unshift(u[u.length-1]),u.push(u[1]);this.closed=f},fit:function(i){var u=this.points,h=u.length,f=null;if(h>0){if(f=[new n0(u[0])],h>1){if(this.fitCubic(f,i,0,h-1,u[1].subtract(u[0]),u[h-2].subtract(u[h-1])),this.closed)f.shift(),f.pop()}}return f},fitCubic:function(i,u,h,f,t,n){var v=this.points;if(f-h===1){var g=v[h],w=v[f],x=g.getDistance(w)/3;this.addCurve(i,[g,g.add(t.normalize(x)),w.add(n.normalize(x)),w]);return}var y=this.chordLengthParameterize(h,f),j=Math.max(u,u*u),l,p=!0;for(var b=0;b<=4;b++){var o=this.generateBezier(h,f,y,t,n),z=this.findMaxError(h,f,o,y);if(z.error<u&&p){this.addCurve(i,o);return}if(l=z.index,z.error>=j)break;p=this.reparameterize(h,f,y,o),j=z.error}var N=v[l-1].subtract(v[l+1]);this.fitCubic(i,u,h,l,t,N),this.fitCubic(i,u,l,f,N.negate(),n)},addCurve:function(i,u){var h=i[i.length-1];h.setHandleOut(u[1].subtract(u[0])),i.push(new n0(u[3],u[2].subtract(u[3])))},generateBezier:function(i,u,h,f,t){var n=0.000000000001,v=Math.abs,g=this.points,w=g[i],x=g[u],y=[[0,0],[0,0]],j=[0,0];for(var l=0,p=u-i+1;l<p;l++){var b=h[l],o=1-b,z=3*b*o,N=o*o*o,S=z*o,d=z*b,r=b*b*b,I=f.normalize(S),B=t.normalize(d),_=g[i+l].subtract(w.multiply(N+S)).subtract(x.multiply(d+r));y[0][0]+=I.dot(I),y[0][1]+=I.dot(B),y[1][0]=y[0][1],y[1][1]+=B.dot(B),j[0]+=I.dot(_),j[1]+=B.dot(_)}var M=y[0][0]*y[1][1]-y[1][0]*y[0][1],L,G;if(v(M)>n){var V=y[0][0]*j[1]-y[1][0]*j[0],R=j[0]*y[1][1]-j[1]*y[0][1];L=R/M,G=V/M}else{var q=y[0][0]+y[0][1],E=y[1][0]+y[1][1];L=G=v(q)>n?j[0]/q:v(E)>n?j[1]/E:0}var e=x.getDistance(w),O=n*e,X,H;if(L<O||G<O)L=G=e/3;else{var Y=x.subtract(w);if(X=f.normalize(L),H=t.normalize(G),X.dot(Y)-H.dot(Y)>e*e)L=G=e/3,X=H=null}return[w,w.add(X||f.normalize(L)),x.add(H||t.normalize(G)),x]},reparameterize:function(i,u,h,f){for(var t=i;t<=u;t++)h[t-i]=this.findRoot(f,this.points[t],h[t-i]);for(var t=1,n=h.length;t<n;t++)if(h[t]<=h[t-1])return!1;return!0},findRoot:function(i,u,h){var f=[],t=[];for(var n=0;n<=2;n++)f[n]=i[n+1].subtract(i[n]).multiply(3);for(var n=0;n<=1;n++)t[n]=f[n+1].subtract(f[n]).multiply(2);var v=this.evaluate(3,i,h),g=this.evaluate(2,f,h),w=this.evaluate(1,t,h),x=v.subtract(u),y=g.dot(g)+x.dot(w);return v0.isMachineZero(y)?h:h-x.dot(g)/y},evaluate:function(i,u,h){var f=u.slice();for(var t=1;t<=i;t++)for(var n=0;n<=i-t;n++)f[n]=f[n].multiply(1-h).add(f[n+1].multiply(h));return f[0]},chordLengthParameterize:function(i,u){var h=[0];for(var f=i+1;f<=u;f++)h[f-i]=h[f-i-1]+this.points[f].getDistance(this.points[f-1]);for(var f=1,t=u-i;f<=t;f++)h[f]/=h[t];return h},findMaxError:function(i,u,h,f){var t=Math.floor((u-i+1)/2),n=0;for(var v=i+1;v<u;v++){var g=this.evaluate(3,h,f[v-i]),w=g.subtract(this.points[v]),x=w.x*w.x+w.y*w.y;if(x>=n)n=x,t=v}return{error:n,index:t}}}),a6=m0.extend({_class:"TextItem",_applyMatrix:!1,_canApplyMatrix:!1,_serializeFields:{content:null},_boundsOptions:{stroke:!1,handle:!1},initialize:function i(u){this._content="",this._lines=[];var h=u&&k.isPlainObject(u)&&u.x===D&&u.y===D;this._initialize(h&&u,!h&&A.read(arguments))},_equals:function(i){return this._content===i._content},copyContent:function(i){this.setContent(i._content)},getContent:function(){return this._content},setContent:function(i){this._content=""+i,this._lines=this._content.split(/\r\n|\n|\r/mg),this._changed(521)},isEmpty:function(){return!this._content},getCharacterStyle:"#getStyle",setCharacterStyle:"#setStyle",getParagraphStyle:"#getStyle",setParagraphStyle:"#setStyle"}),z5=a6.extend({_class:"PointText",initialize:function i(){a6.apply(this,arguments)},getPoint:function(){var i=this._matrix.getTranslation();return new J(i.x,i.y,this,"setPoint")},setPoint:function(){var i=A.read(arguments);this.translate(i.subtract(this._matrix.getTranslation()))},_draw:function(i,u,h){if(!this._content)return;this._setStyles(i,u,h);var f=this._lines,t=this._style,n=t.hasFill(),v=t.hasStroke(),g=t.getLeading(),w=i.shadowColor;i.font=t.getFontStyle(),i.textAlign=t.getJustification();for(var x=0,y=f.length;x<y;x++){i.shadowColor=w;var j=f[x];if(n)i.fillText(j,0,0),i.shadowColor="rgba(0,0,0,0)";if(v)i.strokeText(j,0,0);i.translate(0,g)}},_getBounds:function(i,u){var h=this._style,f=this._lines,t=f.length,n=h.getJustification(),v=h.getLeading(),g=this.getView().getTextWidth(h.getFontStyle(),f),w=0;if(n!=="left")w-=g/(n==="center"?2:1);var x=new u0(w,t?-0.75*v:0,g,t*v);return i?i._transformBounds(x,x):x}}),a0=k.extend(new function(){var i={gray:["gray"],rgb:["red","green","blue"],hsb:["hue","saturation","brightness"],hsl:["hue","saturation","lightness"],gradient:["gradient","origin","destination","highlight"]},u={},h={transparent:[0,0,0,0]},f;function t(g){var w=g.match(/^#([\da-f]{2})([\da-f]{2})([\da-f]{2})([\da-f]{2})?$/i)||g.match(/^#([\da-f])([\da-f])([\da-f])([\da-f])?$/i),x="rgb",y;if(w){var j=w[4]?4:3;y=new Array(j);for(var l=0;l<j;l++){var p=w[l+1];y[l]=parseInt(p.length==1?p+p:p,16)/255}}else if(w=g.match(/^(rgb|hsl)a?\((.*)\)$/)){x=w[1],y=w[2].trim().split(/[,\s]+/g);var b=x==="hsl";for(var l=0,o=Math.min(y.length,4);l<o;l++){var z=y[l],p=parseFloat(z);if(b){if(l===0){var N=z.match(/([a-z]*)$/)[1];p*={turn:360,rad:180/Math.PI,grad:0.9}[N]||1}else if(l<3)p/=100}else if(l<3)p/=/%$/.test(z)?100:255;y[l]=p}}else{var S=h[g];if(!S)if(F){if(!f)f=D0.getContext(1,1,{willReadFrequently:!0}),f.globalCompositeOperation="copy";f.fillStyle="rgba(0,0,0,0)",f.fillStyle=g,f.fillRect(0,0,1,1);var d=f.getImageData(0,0,1,1).data;S=h[g]=[d[0]/255,d[1]/255,d[2]/255]}else S=[0,0,0];y=S.slice()}return[x,y]}var n=[[0,3,1],[2,0,1],[1,0,3],[1,2,0],[3,1,0],[0,1,2]],v={"rgb-hsb":function(g,w,x){var y=Math.max(g,w,x),j=Math.min(g,w,x),l=y-j,p=l===0?0:(y==g?(w-x)/l+(w<x?6:0):y==w?(x-g)/l+2:(g-w)/l+4)*60;return[p,y===0?0:l/y,y]},"hsb-rgb":function(g,w,x){g=(g/60%6+6)%6;var j=Math.floor(g),y=g-j,j=n[j],l=[x,x*(1-w),x*(1-w*y),x*(1-w*(1-y))];return[l[j[0]],l[j[1]],l[j[2]]]},"rgb-hsl":function(g,w,x){var y=Math.max(g,w,x),j=Math.min(g,w,x),l=y-j,p=l===0,b=p?0:(y==g?(w-x)/l+(w<x?6:0):y==w?(x-g)/l+2:(g-w)/l+4)*60,o=(y+j)/2,z=p?0:o<0.5?l/(y+j):l/(2-y-j);return[b,z,o]},"hsl-rgb":function(g,w,x){if(g=(g/360%1+1)%1,w===0)return[x,x,x];var y=[g+0.3333333333333333,g,g-0.3333333333333333],j=x<0.5?x*(1+w):x+w-x*w,l=2*x-j,p=[];for(var b=0;b<3;b++){var o=y[b];if(o<0)o+=1;if(o>1)o-=1;p[b]=6*o<1?l+(j-l)*6*o:2*o<1?j:3*o<2?l+(j-l)*(0.6666666666666666-o)*6:l}return p},"rgb-gray":function(g,w,x){return[g*0.2989+w*0.587+x*0.114]},"gray-rgb":function(g){return[g,g,g]},"gray-hsb":function(g){return[0,0,g]},"gray-hsl":function(g){return[0,0,g]},"gradient-rgb":function(){return[]},"rgb-gradient":function(){return[]}};return k.each(i,function(g,w){u[w]=[],k.each(g,function(x,y){var j=k.capitalize(x),l=/^(hue|saturation)$/.test(x),p=u[w][y]=w==="gradient"?x==="gradient"?function(b){var o=this._components[0];if(b=V6.read(Array.isArray(b)?b:arguments,0,{readNull:!0}),o!==b){if(o)o._removeOwner(this);if(b)b._addOwner(this)}return b}:function(){return A.read(arguments,0,{readNull:x==="highlight",clone:!0})}:function(b){return b==null||isNaN(b)?0:+b};this["get"+j]=function(){return this._type===w||l&&/^hs[bl]$/.test(this._type)?this._components[y]:this._convert(w)[y]},this["set"+j]=function(b){if(this._type!==w&&!(l&&/^hs[bl]$/.test(this._type)))this._components=this._convert(w),this._properties=i[w],this._type=w;this._components[y]=p.call(this,b),this._changed()}},this)},{_class:"Color",_readIndex:!0,initialize:function g(w){var x=arguments,y=this.__read,j=0,l,p,b,o;if(Array.isArray(w))x=w,w=x[0];var z=w!=null&&typeof w;if(z==="string"&&w in i)if(l=w,w=x[1],Array.isArray(w))p=w,b=x[2];else{if(y)j=1;x=k.slice(x,1),z=typeof w}if(!p){if(o=z==="number"?x:z==="object"&&w.length!=null?w:null,o){if(!l)l=o.length>=3?"rgb":"gray";var N=i[l].length;if(b=o[N],y)j+=o===arguments?N+(b!=null?1:0):1;if(o.length>N)o=k.slice(o,0,N)}else if(z==="string"){var S=t(w);if(l=S[0],p=S[1],p.length===4)b=p[3],p.length--}else if(z==="object")if(w.constructor===g){if(l=w._type,p=w._components.slice(),b=w._alpha,l==="gradient")for(var d=1,r=p.length;d<r;d++){var I=p[d];if(I)p[d]=I.clone()}}else if(w.constructor===V6)l="gradient",o=x;else{l="hue"in w?"lightness"in w?"hsl":"hsb":("gradient"in w)||("stops"in w)||("radial"in w)?"gradient":("gray"in w)?"gray":"rgb";var B=i[l],_=u[l];this._components=p=[];for(var d=0,r=B.length;d<r;d++){var M=w[B[d]];if(M==null&&!d&&l==="gradient"&&"stops"in w)M={stops:w.stops,radial:w.radial};if(M=_[d].call(this,M),M!=null)p[d]=M}b=w.alpha}if(y&&l)j=1}if(this._type=l||"rgb",!p){this._components=p=[];var _=u[this._type];for(var d=0,r=_.length;d<r;d++){var M=_[d].call(this,o&&o[d]);if(M!=null)p[d]=M}}if(this._components=p,this._properties=i[this._type],this._alpha=b,y)this.__read=j;return this},set:"#initialize",_serialize:function(g,w){var x=this.getComponents();return k.serialize(/^(gray|rgb)$/.test(this._type)?x:[this._type].concat(x),g,!0,w)},_changed:function(){if(this._canvasStyle=null,this._owner)if(this._setter)this._owner[this._setter](this);else this._owner._changed(129)},_convert:function(g){var w;return this._type===g?this._components.slice():(w=v[this._type+"-"+g])?w.apply(this,this._components):v["rgb-"+g].apply(this,v[this._type+"-rgb"].apply(this,this._components))},convert:function(g){return new a0(g,this._convert(g),this._alpha)},getType:function(){return this._type},setType:function(g){this._components=this._convert(g),this._properties=i[g],this._type=g},getComponents:function(){var g=this._components.slice();if(this._alpha!=null)g.push(this._alpha);return g},getAlpha:function(){return this._alpha!=null?this._alpha:1},setAlpha:function(g){this._alpha=g==null?null:Math.min(Math.max(g,0),1),this._changed()},hasAlpha:function(){return this._alpha!=null},equals:function(g){var w=k.isPlainValue(g,!0)?a0.read(arguments):g;return w===this||w&&this._class===w._class&&this._type===w._type&&this.getAlpha()===w.getAlpha()&&k.equals(this._components,w._components)||!1},toString:function(){var g=this._properties,w=[],x=this._type==="gradient",y=p0.instance;for(var j=0,l=g.length;j<l;j++){var p=this._components[j];if(p!=null)w.push(g[j]+": "+(x?p:y.number(p)))}if(this._alpha!=null)w.push("alpha: "+y.number(this._alpha));return"{ "+w.join(", ")+" }"},toCSS:function(g){var w=this._convert("rgb"),x=g||this._alpha==null?1:this._alpha;function y(j){return Math.round((j<0?0:j>1?1:j)*255)}if(w=[y(w[0]),y(w[1]),y(w[2])],x<1)w.push(x<0?0:x);return g?"#"+((1<<24)+(w[0]<<16)+(w[1]<<8)+w[2]).toString(16).slice(1):(w.length==4?"rgba(":"rgb(")+w.join(",")+")"},toCanvasStyle:function(g,w){if(this._canvasStyle)return this._canvasStyle;if(this._type!=="gradient")return this._canvasStyle=this.toCSS();var x=this._components,y=x[0],j=y._stops,l=x[1],p=x[2],b=x[3],o=w&&w.inverted(),z;if(o){if(l=o._transformPoint(l),p=o._transformPoint(p),b)b=o._transformPoint(b)}if(y._radial){var N=p.getDistance(l);if(b){var S=b.subtract(l);if(S.getLength()>N)b=l.add(S.normalize(N-0.1))}var d=b||l;z=g.createRadialGradient(d.x,d.y,0,l.x,l.y,N)}else z=g.createLinearGradient(l.x,l.y,p.x,p.y);for(var r=0,I=j.length;r<I;r++){var B=j[r],_=B._offset;z.addColorStop(_==null?r/(I-1):_,B._color.toCanvasStyle())}return this._canvasStyle=z},transform:function(g){if(this._type==="gradient"){var w=this._components;for(var x=1,y=w.length;x<y;x++){var j=w[x];g._transformPoint(j,j,!0)}this._changed()}},statics:{_types:i,random:function(){var g=Math.random;return new a0(g(),g(),g())},_setOwner:function(g,w,x){if(g){if(g._owner&&w&&g._owner!==w)g=g.clone();if(!g._owner^!w)g._owner=w||null,g._setter=x||null}return g}}})},new function(){var i={add:function(u,h){return u+h},subtract:function(u,h){return u-h},multiply:function(u,h){return u*h},divide:function(u,h){return u/h}};return k.each(i,function(u,h){this[h]=function(f){f=a0.read(arguments);var t=this._type,n=this._components,v=f._convert(t);for(var g=0,w=n.length;g<w;g++)v[g]=u(n[g],v[g]);return new a0(t,v,this._alpha!=null?u(this._alpha,f.getAlpha()):null)}},{})}),V6=k.extend({_class:"Gradient",initialize:function i(u,h){if(this._id=r0.get(),u&&k.isPlainObject(u))this.set(u),u=h=null;if(this._stops==null)this.setStops(u||["white","black"]);if(this._radial==null)this.setRadial(typeof h==="string"&&h==="radial"||h||!1)},_serialize:function(i,u){return u.add(this,function(){return k.serialize([this._stops,this._radial],i,!0,u)})},_changed:function(){for(var i=0,u=this._owners&&this._owners.length;i<u;i++)this._owners[i]._changed()},_addOwner:function(i){if(!this._owners)this._owners=[];this._owners.push(i)},_removeOwner:function(i){var u=this._owners?this._owners.indexOf(i):-1;if(u!=-1){if(this._owners.splice(u,1),!this._owners.length)this._owners=D}},clone:function(){var i=[];for(var u=0,h=this._stops.length;u<h;u++)i[u]=this._stops[u].clone();return new V6(i,this._radial)},getStops:function(){return this._stops},setStops:function(i){if(i.length<2)throw new Error("Gradient stop list needs to contain at least two stops.");var u=this._stops;if(u)for(var h=0,f=u.length;h<f;h++)u[h]._owner=D;u=this._stops=J6.readList(i,0,{clone:!0});for(var h=0,f=u.length;h<f;h++)u[h]._owner=this;this._changed()},getRadial:function(){return this._radial},setRadial:function(i){this._radial=i,this._changed()},equals:function(i){if(i===this)return!0;if(i&&this._class===i._class){var u=this._stops,h=i._stops,f=u.length;if(f===h.length){for(var t=0;t<f;t++)if(!u[t].equals(h[t]))return!1;return!0}}return!1}}),J6=k.extend({_class:"GradientStop",initialize:function i(u,h){var f=u,t=h;if(typeof u==="object"&&h===D){if(Array.isArray(u)&&typeof u[0]!=="number")f=u[0],t=u[1];else if("color"in u||"offset"in u||"rampPoint"in u)f=u.color,t=u.offset||u.rampPoint||0}this.setColor(f),this.setOffset(t)},clone:function(){return new J6(this._color.clone(),this._offset)},_serialize:function(i,u){var h=this._color,f=this._offset;return k.serialize(f==null?[h]:[h,f],i,!0,u)},_changed:function(){if(this._owner)this._owner._changed(129)},getOffset:function(){return this._offset},setOffset:function(i){this._offset=i,this._changed()},getRampPoint:"#getOffset",setRampPoint:"#setOffset",getColor:function(){return this._color},setColor:function(){a0._setOwner(this._color,null),this._color=a0._setOwner(a0.read(arguments,0),this,"setColor"),this._changed()},equals:function(i){return i===this||i&&this._class===i._class&&this._color.equals(i._color)&&this._offset==i._offset||!1}}),Q6=k.extend(new function(){var i={fillColor:null,fillRule:"nonzero",strokeColor:null,strokeWidth:1,strokeCap:"butt",strokeJoin:"miter",strokeScaling:!0,miterLimit:10,dashOffset:0,dashArray:[],shadowColor:null,shadowBlur:0,shadowOffset:new A,selectedColor:null},u=k.set({},i,{fontFamily:"sans-serif",fontWeight:"normal",fontSize:12,leading:null,justification:"left"}),h=k.set({},u,{fillColor:new a0}),f={strokeWidth:193,strokeCap:193,strokeJoin:193,strokeScaling:201,miterLimit:193,fontFamily:9,fontWeight:9,fontSize:9,font:9,leading:9,justification:9},t={beans:!0},n={_class:"Style",beans:!0,initialize:function v(g,w,x){if(this._values={},this._owner=w,this._project=w&&w._project||x||P0.project,this._defaults=!w||w instanceof q0?u:w instanceof a6?h:i,g)this.set(g)}};return k.each(u,function(v,g){var w=/Color$/.test(g),x=g==="shadowOffset",y=k.capitalize(g),j=f[g],l="set"+y,p="get"+y;n[l]=function(b){var o=this._owner,z=o&&o._children,N=z&&z.length>0&&!(o instanceof f6);if(N)for(var S=0,d=z.length;S<d;S++)z[S]._style[l](b);if((g==="selectedColor"||!N)&&g in this._defaults){var r=this._values[g];if(r!==b){if(w){if(r)a0._setOwner(r,null),r._canvasStyle=null;if(b&&b.constructor===a0)b=a0._setOwner(b,o,N&&l)}if(this._values[g]=b,o)o._changed(j||129)}}},n[p]=function(b){var o=this._owner,z=o&&o._children,N=z&&z.length>0&&!(o instanceof f6),S;if(N&&!b)for(var d=0,r=z.length;d<r;d++){var I=z[d]._style[p]();if(!d)S=I;else if(!k.equals(S,I))return D}else if(g in this._defaults){var S=this._values[g];if(S===D){if(S=this._defaults[g],S&&S.clone)S=S.clone()}else{var B=w?a0:x?A:null;if(B&&!(S&&S.constructor===B))this._values[g]=S=B.read([S],0,{readNull:!0,clone:!0})}}if(S&&w)S=a0._setOwner(S,o,N&&l);return S},t[p]=function(b){return this._style[p](b)},t[l]=function(b){this._style[l](b)}}),k.each({Font:"FontFamily",WindingRule:"FillRule"},function(v,g){var w="get"+g,x="set"+g;n[w]=t[w]="#get"+v,n[x]=t[x]="#set"+v}),m0.inject(t),n},{set:function(i){var u=i instanceof Q6,h=u?i._values:i;if(h){for(var f in h)if(f in this._defaults){var t=h[f];this[f]=t&&u&&t.clone?t.clone():t}}},equals:function(i){function u(h,f,t){var n=h._values,v=f._values,g=f._defaults;for(var w in n){var x=n[w],y=v[w];if(!(t&&(w in v))&&!k.equals(x,y===D?g[w]:y))return!1}return!0}return i===this||i&&this._class===i._class&&u(this,i)&&u(i,this,!0)||!1},_dispose:function(){var i=this.getFillColor();if(i)i._canvasStyle=null;if(i=this.getStrokeColor(),i)i._canvasStyle=null;if(i=this.getShadowColor(),i)i._canvasStyle=null},hasFill:function(){var i=this.getFillColor();return!!i&&i.alpha>0},hasStroke:function(){var i=this.getStrokeColor();return!!i&&i.alpha>0&&this.getStrokeWidth()>0},hasShadow:function(){var i=this.getShadowColor();return!!i&&i.alpha>0&&(this.getShadowBlur()>0||!this.getShadowOffset().isZero())},getView:function(){return this._project._view},getFontStyle:function(){var i=this.getFontSize();return this.getFontWeight()+" "+i+(/[a-z]/i.test(i+"")?" ":"px ")+this.getFontFamily()},getFont:"#getFontFamily",setFont:"#setFontFamily",getLeading:function i(){var u=i.base.call(this),h=this.getFontSize();if(/pt|em|%|px/.test(h))h=this.getView().getPixelSize(h);return u!=null?u:h*1.2}}),M0=new function(){function i(u,h,f,t){var n=["","webkit","moz","Moz","ms","o"],v=h[0].toUpperCase()+h.substring(1);for(var g=0;g<6;g++){var w=n[g],x=w?w+v:h;if(x in u){if(f)u[x]=t;else return u[x];break}}}return{getStyles:function(u){var h=u&&u.nodeType!==9?u.ownerDocument:u,f=h&&h.defaultView;return f&&f.getComputedStyle(u,"")},getBounds:function(u,h){var f=u.ownerDocument,t=f.body,n=f.documentElement,v;try{v=u.getBoundingClientRect()}catch(y){v={left:0,top:0,width:0,height:0}}var g=v.left-(n.clientLeft||t.clientLeft||0),w=v.top-(n.clientTop||t.clientTop||0);if(!h){var x=f.defaultView;g+=x.pageXOffset||n.scrollLeft||t.scrollLeft,w+=x.pageYOffset||n.scrollTop||t.scrollTop}return new u0(g,w,v.width,v.height)},getViewportBounds:function(u){var h=u.ownerDocument,f=h.defaultView,t=h.documentElement;return new u0(0,0,f.innerWidth||t.clientWidth,f.innerHeight||t.clientHeight)},getOffset:function(u,h){return M0.getBounds(u,h).getPoint()},getSize:function(u){return M0.getBounds(u,!0).getSize()},isInvisible:function(u){return M0.getSize(u).equals(new W(0,0))},isInView:function(u){return!M0.isInvisible(u)&&M0.getViewportBounds(u).intersects(M0.getBounds(u,!0))},isInserted:function(u){return T.body.contains(u)},getPrefixed:function(u,h){return u&&i(u,h)},setPrefixed:function(u,h,f){if(typeof h==="object")for(var t in h)i(u,t,!0,h[t]);else i(u,h,!0,f)}}},V0={add:function(i,u){if(i)for(var h in u){var f=u[h],t=h.split(/[\s,]+/g);for(var n=0,v=t.length;n<v;n++){var g=t[n],w=i===T&&(g==="touchstart"||g==="touchmove")?{passive:!1}:!1;i.addEventListener(g,f,w)}}},remove:function(i,u){if(i)for(var h in u){var f=u[h],t=h.split(/[\s,]+/g);for(var n=0,v=t.length;n<v;n++)i.removeEventListener(t[n],f,!1)}},getPoint:function(i){var u=i.targetTouches?i.targetTouches.length?i.targetTouches[0]:i.changedTouches[0]:i;return new A(u.pageX||u.clientX+T.documentElement.scrollLeft,u.pageY||u.clientY+T.documentElement.scrollTop)},getTarget:function(i){return i.target||i.srcElement},getRelatedTarget:function(i){return i.relatedTarget||i.toElement},getOffset:function(i,u){return V0.getPoint(i).subtract(M0.getOffset(u||V0.getTarget(i)))}};V0.requestAnimationFrame=new function(){var i=M0.getPrefixed(F,"requestAnimationFrame"),u=!1,h=[],f;function t(){var n=h;h=[];for(var v=0,g=n.length;v<g;v++)n[v]();if(u=i&&h.length,u)i(t)}return function(n){if(h.push(n),i){if(!u)i(t),u=!0}else if(!f)f=setInterval(t,16.666666666666668)}};var L0=k.extend($,{_class:"View",initialize:function i(u,h){function f(j){return h[j]||parseInt(h.getAttribute(j),10)}function t(){var j=M0.getSize(h);return j.isNaN()||j.isZero()?new W(f("width"),f("height")):j}var n;if(F&&h){if(this._id=h.getAttribute("id"),this._id==null)h.setAttribute("id",this._id="paper-view-"+i._id++);V0.add(h,this._viewEvents);var v="none";if(M0.setPrefixed(h.style,{userDrag:v,userSelect:v,touchCallout:v,contentZooming:v,tapHighlightColor:"rgba(0,0,0,0)"}),U.hasAttribute(h,"resize")){var g=this;V0.add(F,this._windowEvents={resize:function(){g.setViewSize(t())}})}if(n=t(),U.hasAttribute(h,"stats")&&typeof Stats!=="undefined"){this._stats=new Stats;var w=this._stats.domElement,x=w.style,y=M0.getOffset(h);x.position="absolute",x.left=y.x+"px",x.top=y.y+"px",T.body.appendChild(w)}}else n=new W(h),h=null;if(this._project=u,this._scope=u._scope,this._element=h,!this._pixelRatio)this._pixelRatio=F&&F.devicePixelRatio||1;if(this._setElementSize(n.width,n.height),this._viewSize=n,i._views.push(this),i._viewsById[this._id]=this,(this._matrix=new j0)._owner=this,!i._focused)i._focused=this;this._frameItems={},this._frameItemCount=0,this._itemEvents={native:{},virtual:{}},this._autoUpdate=!P0.agent.node,this._needsUpdate=!1},remove:function(){if(!this._project)return!1;if(L0._focused===this)L0._focused=null;L0._views.splice(L0._views.indexOf(this),1),delete L0._viewsById[this._id];var i=this._project;if(i._view===this)i._view=null;return V0.remove(this._element,this._viewEvents),V0.remove(F,this._windowEvents),this._element=this._project=null,this.off("frame"),this._animate=!1,this._frameItems={},!0},_events:k.each(m0._itemHandlers.concat(["onResize","onKeyDown","onKeyUp"]),function(i){this[i]={}},{onFrame:{install:function(){this.play()},uninstall:function(){this.pause()}}}),_animate:!1,_time:0,_count:0,getAutoUpdate:function(){return this._autoUpdate},setAutoUpdate:function(i){if(this._autoUpdate=i,i)this.requestUpdate()},update:function(){},draw:function(){this.update()},requestUpdate:function(){if(!this._requested){var i=this;V0.requestAnimationFrame(function(){if(i._requested=!1,i._animate){i.requestUpdate();var u=i._element;if((!M0.getPrefixed(T,"hidden")||U.getAttribute(u,"keepalive")==="true")&&M0.isInView(u))i._handleFrame()}if(i._autoUpdate)i.update()}),this._requested=!0}},play:function(){this._animate=!0,this.requestUpdate()},pause:function(){this._animate=!1},_handleFrame:function(){P0=this._scope;var i=Date.now()/1000,u=this._last?i-this._last:0;if(this._last=i,this.emit("frame",new k({delta:u,time:this._time+=u,count:this._count++})),this._stats)this._stats.update()},_animateItem:function(i,u){var h=this._frameItems;if(u){if(h[i._id]={item:i,time:0,count:0},++this._frameItemCount===1)this.on("frame",this._handleFrameItems)}else if(delete h[i._id],--this._frameItemCount===0)this.off("frame",this._handleFrameItems)},_handleFrameItems:function(i){for(var u in this._frameItems){var h=this._frameItems[u];h.item.emit("frame",new k(i,{time:h.time+=i.delta,count:h.count++}))}},_changed:function(){this._project._changed(4097),this._bounds=this._decomposed=D},getElement:function(){return this._element},getPixelRatio:function(){return this._pixelRatio},getResolution:function(){return this._pixelRatio*72},getViewSize:function(){var i=this._viewSize;return new u6(i.width,i.height,this,"setViewSize")},setViewSize:function(){var i=W.read(arguments),u=i.subtract(this._viewSize);if(u.isZero())return;if(this._setElementSize(i.width,i.height),this._viewSize.set(i),this._changed(),this.emit("resize",{size:i,delta:u}),this._autoUpdate)this.update()},_setElementSize:function(i,u){var h=this._element;if(h){if(h.width!==i)h.width=i;if(h.height!==u)h.height=u}},getBounds:function(){if(!this._bounds)this._bounds=this._matrix.inverted()._transformBounds(new u0(new A,this._viewSize));return this._bounds},getSize:function(){return this.getBounds().getSize()},isVisible:function(){return M0.isInView(this._element)},isInserted:function(){return M0.isInserted(this._element)},getPixelSize:function(i){var u=this._element,h;if(u){var f=u.parentNode,t=T.createElement("div");t.style.fontSize=i,f.appendChild(t),h=parseFloat(M0.getStyles(t).fontSize),f.removeChild(t)}else h=parseFloat(h);return h},getTextWidth:function(i,u){return 0}},k.each(["rotate","scale","shear","skew"],function(i){var u=i==="rotate";this[i]=function(){var h=arguments,f=(u?k:A).read(h),t=A.read(h,0,{readNull:!0});return this.transform(new j0()[i](f,t||this.getCenter(!0)))}},{_decompose:function(){return this._decomposed||(this._decomposed=this._matrix.decompose())},translate:function(){var i=new j0;return this.transform(i.translate.apply(i,arguments))},getCenter:function(){return this.getBounds().getCenter()},setCenter:function(){var i=A.read(arguments);this.translate(this.getCenter().subtract(i))},getZoom:function(){var i=this._decompose().scaling;return(i.x+i.y)/2},setZoom:function(i){this.transform(new j0().scale(i/this.getZoom(),this.getCenter()))},getRotation:function(){return this._decompose().rotation},setRotation:function(i){var u=this.getRotation();if(u!=null&&i!=null)this.rotate(i-u)},getScaling:function(){var i=this._decompose().scaling;return new J(i.x,i.y,this,"setScaling")},setScaling:function(){var i=this.getScaling(),u=A.read(arguments,0,{clone:!0,readNull:!0});if(i&&u)this.scale(u.x/i.x,u.y/i.y)},getMatrix:function(){return this._matrix},setMatrix:function(){var i=this._matrix;i.set.apply(i,arguments)},transform:function(i){this._matrix.append(i)},scrollBy:function(){this.translate(A.read(arguments).negate())}}),{projectToView:function(){return this._matrix._transformPoint(A.read(arguments))},viewToProject:function(){return this._matrix._inverseTransform(A.read(arguments))},getEventPoint:function(i){return this.viewToProject(V0.getOffset(i,this._element))}},{statics:{_views:[],_viewsById:{},_id:0,create:function(i,u){if(T&&typeof u==="string")u=T.getElementById(u);var h=F?k5:L0;return new h(i,u)}}},new function(){if(!F)return;var i,u,h=!1,f=!1;function t(q){var E=V0.getTarget(q);return E.getAttribute&&L0._viewsById[E.getAttribute("id")]}function n(){var q=L0._focused;if(!q||!q.isVisible()){for(var E=0,e=L0._views.length;E<e;E++)if((q=L0._views[E]).isVisible()){L0._focused=u=q;break}}}function v(q,E,e){q._handleMouseEvent("mousemove",E,e)}var g=F.navigator,w,x,y;if(g.pointerEnabled||g.msPointerEnabled)w="pointerdown MSPointerDown",x="pointermove MSPointerMove",y="pointerup pointercancel MSPointerUp MSPointerCancel";else if(w="touchstart",x="touchmove",y="touchend touchcancel",!(("ontouchstart"in F)&&g.userAgent.match(/mobile|tablet|ip(ad|hone|od)|android|silk/i)))w+=" mousedown",x+=" mousemove",y+=" mouseup";var j={},l={mouseout:function(q){var E=L0._focused,e=V0.getRelatedTarget(q);if(E&&(!e||e.nodeName==="HTML")){var O=V0.getOffset(q,E._element),X=O.x,H=Math.abs,Y=H(X),K=1<<25,f0=Y-K;O.x=H(f0)<Y?f0*(X<0?-1:1):X,v(E,q,E.viewToProject(O))}},scroll:n};j[w]=function(q){var E=L0._focused=t(q);if(!h)h=!0,E._handleMouseEvent("mousedown",q)},l[x]=function(q){var E=L0._focused;if(!f){var e=t(q);if(e){if(E!==e){if(E)v(E,q);if(!i)i=E;E=L0._focused=u=e}}else if(u&&u===E){if(i&&!i.isInserted())i=null;E=L0._focused=i,i=null,n()}}if(E)v(E,q)},l[w]=function(){f=!0},l[y]=function(q){var E=L0._focused;if(E&&h)E._handleMouseEvent("mouseup",q);f=h=!1},V0.add(T,l),V0.add(F,{load:n});var p=!1,b=!1,o={doubleclick:"click",mousedrag:"mousemove"},z=!1,N,S,d,r,I,B,_,M,L;function G(q,E,e,O,X,H,Y){var K=!1,f0;function i0(g0,Q){if(g0.responds(Q)){if(!f0)f0=new M5(Q,O,X,E||g0,H?X.subtract(H):null);if(g0.emit(Q,f0)){if(p=!0,f0.prevented)b=!0;if(f0.stopped)return K=!0}}else{var x0=o[Q];if(x0)return i0(g0,x0)}}while(q&&q!==Y){if(i0(q,e))break;q=q._parent}return K}function V(q,E,e,O,X,H){return q._project.removeOn(e),b=p=!1,B&&G(B,null,e,O,X,H)||E&&E!==B&&!E.isDescendant(B)&&G(E,null,e==="mousedrag"?"mousemove":e,O,X,H,B)||G(q,B||E||q,e,O,X,H)}var R={mousedown:{mousedown:1,mousedrag:1,click:1,doubleclick:1},mouseup:{mouseup:1,mousedrag:1,click:1,doubleclick:1},mousemove:{mousedrag:1,mousemove:1,mouseenter:1,mouseleave:1}};return{_viewEvents:j,_handleMouseEvent:function(q,E,e){var O=this._itemEvents,X=O.native[q],H=q==="mousemove",Y=this._scope.tool,K=this;function f0(s0){return O.virtual[s0]||K.responds(s0)||Y&&Y.responds(s0)}if(H&&h&&f0("mousedrag"))q="mousedrag";if(!e)e=this.getEventPoint(E);var i0=this.getBounds().contains(e),g0=X&&i0&&K._project.hitTest(e,{tolerance:0,fill:!0,stroke:!0}),Q=g0&&g0.item||null,x0=!1,h0={};if(h0[q.substr(5)]=!0,X&&Q!==I){if(I)G(I,null,"mouseleave",E,e);if(Q)G(Q,null,"mouseenter",E,e);I=Q}if(z^i0)G(this,null,i0?"mouseenter":"mouseleave",E,e),N=i0?this:null,x0=!0;if((i0||h0.drag)&&!e.equals(d))V(this,Q,H?q:"mousemove",E,e,d),x0=!0;if(z=i0,h0.down&&i0||h0.up&&S){if(V(this,Q,q,E,e,S),h0.down){if(L=Q===_&&Date.now()-M<300,r=_=Q,!b&&Q){var S0=Q;while(S0&&!S0.responds("mousedrag"))S0=S0._parent;if(S0)B=Q}S=e}else if(h0.up){if(!b&&Q===r)M=Date.now(),V(this,Q,L?"doubleclick":"click",E,e,S),L=!1;r=B=null}z=!1,x0=!0}if(d=e,x0&&Y)p=Y._handleMouseEvent(q,E,e,h0)||p;if(E.cancelable!==!1&&(p&&!h0.move||h0.down&&f0("mouseup")))E.preventDefault()},_handleKeyEvent:function(q,E,e,O){var X=this._scope,H=X.tool,Y;function K(f0){if(f0.responds(q))P0=X,f0.emit(q,Y=Y||new _5(q,E,e,O))}if(this.isVisible()){if(K(this),H&&H.responds(q))K(H)}},_countItemEvent:function(q,E){var e=this._itemEvents,O=e.native,X=e.virtual;for(var H in R)O[H]=(O[H]||0)+(R[H][q]||0)*E;X[q]=(X[q]||0)+E},statics:{updateFocus:n,_resetState:function(){h=f=p=z=!1,i=u=N=S=d=r=I=B=_=M=L=null}}}}),k5=L0.extend({_class:"CanvasView",initialize:function i(u,h){if(!(h instanceof F.HTMLCanvasElement)){var f=W.read(arguments,1);if(f.isZero())throw new Error("Cannot create CanvasView with the provided argument: "+k.slice(arguments,1));h=D0.getCanvas(f)}var t=this._context=h.getContext("2d");if(t.save(),this._pixelRatio=1,!/^off|false$/.test(U.getAttribute(h,"hidpi"))){var n=F.devicePixelRatio||1,v=M0.getPrefixed(t,"backingStorePixelRatio")||1;this._pixelRatio=n/v}L0.call(this,u,h),this._needsUpdate=!0},remove:function i(){return this._context.restore(),i.base.call(this)},_setElementSize:function i(u,h){var f=this._pixelRatio;if(i.base.call(this,u*f,h*f),f!==1){var t=this._element,n=this._context;if(!U.hasAttribute(t,"resize")){var v=t.style;v.width=u+"px",v.height=h+"px"}n.restore(),n.save(),n.scale(f,f)}},getContext:function(){return this._context},getPixelSize:function i(u){var h=P0.agent,f;if(h&&h.firefox)f=i.base.call(this,u);else{var t=this._context,n=t.font;t.font=u+" serif",f=parseFloat(t.font),t.font=n}return f},getTextWidth:function(i,u){var h=this._context,f=h.font,t=0;h.font=i;for(var n=0,v=u.length;n<v;n++)t=Math.max(t,h.measureText(u[n]).width);return h.font=f,t},update:function(){if(!this._needsUpdate)return!1;var i=this._project,u=this._context,h=this._viewSize;if(u.clearRect(0,0,h.width+1,h.height+1),i)i.draw(u,this._matrix,this._pixelRatio);return this._needsUpdate=!1,!0}}),A6=k.extend({_class:"Event",initialize:function i(u){this.event=u,this.type=u&&u.type},prevented:!1,stopped:!1,preventDefault:function(){this.prevented=!0,this.event.preventDefault()},stopPropagation:function(){this.stopped=!0,this.event.stopPropagation()},stop:function(){this.stopPropagation(),this.preventDefault()},getTimeStamp:function(){return this.event.timeStamp},getModifiers:function(){return S8.modifiers}}),_5=A6.extend({_class:"KeyEvent",initialize:function i(u,h,f,t){this.type=u,this.event=h,this.key=f,this.character=t},toString:function(){return"{ type: '"+this.type+"', key: '"+this.key+"', character: '"+this.character+"', modifiers: "+this.getModifiers()+" }"}}),S8=new function(){var i={"\t":"tab"," ":"space","\b":"backspace","\x7F":"delete",Spacebar:"space",Del:"delete",Win:"meta",Esc:"escape"},u={tab:"\t",space:" ",enter:"\r"},h={},f={},t,n,v=new k({shift:!1,control:!1,alt:!1,meta:!1,capsLock:!1,space:!1}).inject({option:{get:function(){return this.alt}},command:{get:function(){var x=P0&&P0.agent;return x&&x.mac?this.meta:this.control}}});function g(x){var y=x.key||x.keyIdentifier;return y=/^U\+/.test(y)?String.fromCharCode(parseInt(y.substr(2),16)):/^Arrow[A-Z]/.test(y)?y.substr(5):y==="Unidentified"||y===D?String.fromCharCode(x.keyCode):y,i[y]||(y.length>1?k.hyphenate(y):y.toLowerCase())}function w(x,y,j,l){var p=x?"keydown":"keyup",b=L0._focused,o;if(h[y]=x,x)f[y]=j;else delete f[y];if(y.length>1&&(o=k.camelize(y))in v){v[o]=x;var z=P0&&P0.agent;if(o==="meta"&&z&&z.mac)if(x)t={};else{for(var N in t)if(N in f)w(!1,N,t[N],l);t=null}}else if(x&&t)t[y]=j;if(b)b._handleKeyEvent(x?"keydown":"keyup",l,y,j)}return V0.add(T,{keydown:function(x){var y=g(x),j=P0&&P0.agent;if(y.length>1||j&&(j.chrome&&(x.altKey||j.mac&&x.metaKey||!j.mac&&x.ctrlKey)))w(!0,y,u[y]||(y.length>1?"":y),x);else n=y},keypress:function(x){if(n){var y=g(x),j=x.charCode,l=j>=32?String.fromCharCode(j):y.length>1?"":y;if(y!==n)y=l.toLowerCase();w(!0,y,l,x),n=null}},keyup:function(x){var y=g(x);if(y in f)w(!1,y,f[y],x)}}),V0.add(F,{blur:function(x){for(var y in f)w(!1,y,f[y],x)}}),{modifiers:v,isDown:function(x){return!!h[x]}}},M5=A6.extend({_class:"MouseEvent",initialize:function i(u,h,f,t,n){this.type=u,this.event=h,this.point=f,this.target=t,this.delta=n},toString:function(){return"{ type: '"+this.type+"', point: "+this.point+", target: "+this.target+(this.delta?", delta: "+this.delta:"")+", modifiers: "+this.getModifiers()+" }"}}),L5=A6.extend({_class:"ToolEvent",_item:null,initialize:function i(u,h,f){this.tool=u,this.type=h,this.event=f},_choosePoint:function(i,u){return i?i:u?u.clone():null},getPoint:function(){return this._choosePoint(this._point,this.tool._point)},setPoint:function(i){this._point=i},getLastPoint:function(){return this._choosePoint(this._lastPoint,this.tool._lastPoint)},setLastPoint:function(i){this._lastPoint=i},getDownPoint:function(){return this._choosePoint(this._downPoint,this.tool._downPoint)},setDownPoint:function(i){this._downPoint=i},getMiddlePoint:function(){if(!this._middlePoint&&this.tool._lastPoint)return this.tool._point.add(this.tool._lastPoint).divide(2);return this._middlePoint},setMiddlePoint:function(i){this._middlePoint=i},getDelta:function(){return!this._delta&&this.tool._lastPoint?this.tool._point.subtract(this.tool._lastPoint):this._delta},setDelta:function(i){this._delta=i},getCount:function(){return this.tool[/^mouse(down|up)$/.test(this.type)?"_downCount":"_moveCount"]},setCount:function(i){this.tool[/^mouse(down|up)$/.test(this.type)?"downCount":"count"]=i},getItem:function(){if(!this._item){var i=this.tool._scope.project.hitTest(this.getPoint());if(i){var u=i.item,h=u._parent;while(/^(Group|CompoundPath)$/.test(h._class))u=h,h=h._parent;this._item=u}}return this._item},setItem:function(i){this._item=i},toString:function(){return"{ type: "+this.type+", point: "+this.getPoint()+", count: "+this.getCount()+", modifiers: "+this.getModifiers()+" }"}}),l3=I0.extend({_class:"Tool",_list:"tools",_reference:"tool",_events:["onMouseDown","onMouseUp","onMouseDrag","onMouseMove","onActivate","onDeactivate","onEditOptions","onKeyDown","onKeyUp"],initialize:function i(u){I0.call(this),this._moveCount=-1,this._downCount=-1,this.set(u)},getMinDistance:function(){return this._minDistance},setMinDistance:function(i){if(this._minDistance=i,i!=null&&this._maxDistance!=null&&i>this._maxDistance)this._maxDistance=i},getMaxDistance:function(){return this._maxDistance},setMaxDistance:function(i){if(this._maxDistance=i,this._minDistance!=null&&i!=null&&i<this._minDistance)this._minDistance=i},getFixedDistance:function(){return this._minDistance==this._maxDistance?this._minDistance:null},setFixedDistance:function(i){this._minDistance=this._maxDistance=i},_handleMouseEvent:function(i,u,h,f){if(P0=this._scope,f.drag&&!this.responds(i))i="mousemove";var t=f.move||f.drag,n=this.responds(i),v=this.minDistance,g=this.maxDistance,w=!1,x=this;function y(l,p){var b=h,o=t?x._point:x._downPoint||b;if(t){if(x._moveCount>=0&&b.equals(o))return!1;if(o&&(l!=null||p!=null)){var z=b.subtract(o),N=z.getLength();if(N<(l||0))return!1;if(p)b=o.add(z.normalize(Math.min(N,p)))}x._moveCount++}if(x._point=b,x._lastPoint=o||b,f.down)x._moveCount=-1,x._downPoint=b,x._downCount++;return!0}function j(){if(n)w=x.emit(i,new L5(x,i,u))||w}if(f.down)y(),j();else if(f.up)y(null,g),j();else if(n)while(y(v,g))j();return w}}),c5=k.extend($,{_class:"Tween",statics:{easings:new k({linear:function(i){return i},easeInQuad:function(i){return i*i},easeOutQuad:function(i){return i*(2-i)},easeInOutQuad:function(i){return i<0.5?2*i*i:-1+2*(2-i)*i},easeInCubic:function(i){return i*i*i},easeOutCubic:function(i){return--i*i*i+1},easeInOutCubic:function(i){return i<0.5?4*i*i*i:(i-1)*(2*i-2)*(2*i-2)+1},easeInQuart:function(i){return i*i*i*i},easeOutQuart:function(i){return 1- --i*i*i*i},easeInOutQuart:function(i){return i<0.5?8*i*i*i*i:1-8*--i*i*i*i},easeInQuint:function(i){return i*i*i*i*i},easeOutQuint:function(i){return 1+--i*i*i*i*i},easeInOutQuint:function(i){return i<0.5?16*i*i*i*i*i:1+16*--i*i*i*i*i}})},initialize:function i(u,h,f,t,n,v){this.object=u;var g=typeof n,w=g==="function";this.type=w?g:g==="string"?n:"linear",this.easing=w?n:i.easings[this.type],this.duration=t,this.running=!1,this._then=null,this._startTime=null;var x=h||f;if(this._keys=x?Object.keys(x):[],this._parsedKeys=this._parseKeys(this._keys),this._from=x&&this._getState(h),this._to=x&&this._getState(f),v!==!1)this.start()},then:function(i){return this._then=i,this},start:function(){return this._startTime=null,this.running=!0,this},stop:function(){return this.running=!1,this},update:function(i){if(this.running){if(i>=1)i=1,this.running=!1;var u=this.easing(i),h=this._keys,f=function(y){return typeof y==="function"?y(u,i):y};for(var t=0,n=h&&h.length;t<n;t++){var v=h[t],g=f(this._from[v]),w=f(this._to[v]),x=g&&w&&g.__add&&w.__add?w.__subtract(g).__multiply(u).__add(g):(w-g)*u+g;this._setProperty(this._parsedKeys[v],x)}if(this.responds("update"))this.emit("update",new k({progress:i,factor:u}));if(!this.running&&this._then)this._then(this.object)}return this},_events:{onUpdate:{}},_handleFrame:function(i){var u=this._startTime,h=u?(i-u)/this.duration:0;if(!u)this._startTime=i;this.update(h)},_getState:function(i){var u=this._keys,h={};for(var f=0,t=u.length;f<t;f++){var n=u[f],v=this._parsedKeys[n],g=this._getProperty(v),w;if(i){var x=this._resolveValue(g,i[n]);this._setProperty(v,x),w=this._getProperty(v),w=w&&w.clone?w.clone():w,this._setProperty(v,g)}else w=g&&g.clone?g.clone():g;h[n]=w}return h},_resolveValue:function(i,u){if(u){if(Array.isArray(u)&&u.length===2){var h=u[0];return h&&h.match&&h.match(/^[+\-\*\/]=/)?this._calculate(i,h[0],u[1]):u}else if(typeof u==="string"){var f=u.match(/^[+\-*/]=(.*)/);if(f){var t=JSON.parse(f[1].replace(/(['"])?([a-zA-Z0-9_]+)(['"])?:/g,'"$2": '));return this._calculate(i,u[0],t)}}}return u},_calculate:function(i,u,h){return P0.PaperScript.calculateBinary(i,u,h)},_parseKeys:function(i){var u={};for(var h=0,f=i.length;h<f;h++){var t=i[h],n=t.replace(/\.([^.]*)/g,"/$1").replace(/\[['"]?([^'"\]]*)['"]?\]/g,"/$1");u[t]=n.split("/")}return u},_getProperty:function(i,u){var h=this.object;for(var f=0,t=i.length-(u||0);f<t&&h;f++)h=h[i[f]];return h},_setProperty:function(i,u){var h=this._getProperty(i,1);if(h)h[i[i.length-1]]=u}}),G5={request:function(i){var u=new a.XMLHttpRequest;if(u.open((i.method||"get").toUpperCase(),i.url,k.pick(i.async,!0)),i.mimeType)u.overrideMimeType(i.mimeType);return u.onload=function(){var h=u.status;if(h===0||h===200){if(i.onLoad)i.onLoad.call(u,u.responseText)}else u.onerror()},u.onerror=function(){var h=u.status,f='Could not load "'+i.url+'" (Status: '+h+")";if(i.onError)i.onError(f,h);else throw new Error(f)},u.send(null)}},D0=k.exports.CanvasProvider={canvases:[],getCanvas:function(i,u,h){if(!F)return null;var f,t=!0;if(typeof i==="object")u=i.height,i=i.width;if(this.canvases.length)f=this.canvases.pop();else f=T.createElement("canvas"),t=!1;var n=f.getContext("2d",h||{});if(!n)throw new Error("Canvas "+f+" is unable to provide a 2D context.");if(f.width===i&&f.height===u){if(t)n.clearRect(0,0,i+1,u+1)}else f.width=i,f.height=u;return n.save(),f},getContext:function(i,u,h){var f=this.getCanvas(i,u,h);return f?f.getContext("2d",h||{}):null},release:function(i){var u=i&&i.canvas?i.canvas:i;if(u&&u.getContext)u.getContext("2d").restore(),this.canvases.push(u)}},$6=new function(){var{min:i,max:u,abs:h}=Math,f,t,n,v,g,w,x,y,j,l,p;function b(I,B,_){return 0.2989*I+0.587*B+0.114*_}function o(I,B,_,G){var L=G-b(I,B,_);j=I+L,l=B+L,p=_+L;var G=b(j,l,p),V=i(j,l,p),R=u(j,l,p);if(V<0){var q=G-V;j=G+(j-G)*G/q,l=G+(l-G)*G/q,p=G+(p-G)*G/q}if(R>255){var E=255-G,e=R-G;j=G+(j-G)*E/e,l=G+(l-G)*E/e,p=G+(p-G)*E/e}}function z(I,B,_){return u(I,B,_)-i(I,B,_)}function N(I,B,_,M){var L=[I,B,_],G=u(I,B,_),V=i(I,B,_),R;if(V=V===I?0:V===B?1:2,G=G===I?0:G===B?1:2,R=i(V,G)===0?u(V,G)===1?2:1:0,L[G]>L[V])L[R]=(L[R]-L[V])*M/(L[G]-L[V]),L[G]=M;else L[R]=L[G]=0;L[V]=0,j=L[0],l=L[1],p=L[2]}var S={multiply:function(){j=g*f/255,l=w*t/255,p=x*n/255},screen:function(){j=g+f-g*f/255,l=w+t-w*t/255,p=x+n-x*n/255},overlay:function(){j=g<128?2*g*f/255:255-2*(255-g)*(255-f)/255,l=w<128?2*w*t/255:255-2*(255-w)*(255-t)/255,p=x<128?2*x*n/255:255-2*(255-x)*(255-n)/255},"soft-light":function(){var I=f*g/255;j=I+g*(255-(255-g)*(255-f)/255-I)/255,I=t*w/255,l=I+w*(255-(255-w)*(255-t)/255-I)/255,I=n*x/255,p=I+x*(255-(255-x)*(255-n)/255-I)/255},"hard-light":function(){j=f<128?2*f*g/255:255-2*(255-f)*(255-g)/255,l=t<128?2*t*w/255:255-2*(255-t)*(255-w)/255,p=n<128?2*n*x/255:255-2*(255-n)*(255-x)/255},"color-dodge":function(){j=g===0?0:f===255?255:i(255,255*g/(255-f)),l=w===0?0:t===255?255:i(255,255*w/(255-t)),p=x===0?0:n===255?255:i(255,255*x/(255-n))},"color-burn":function(){j=g===255?255:f===0?0:u(0,255-(255-g)*255/f),l=w===255?255:t===0?0:u(0,255-(255-w)*255/t),p=x===255?255:n===0?0:u(0,255-(255-x)*255/n)},darken:function(){j=g<f?g:f,l=w<t?w:t,p=x<n?x:n},lighten:function(){j=g>f?g:f,l=w>t?w:t,p=x>n?x:n},difference:function(){if(j=g-f,j<0)j=-j;if(l=w-t,l<0)l=-l;if(p=x-n,p<0)p=-p},exclusion:function(){j=g+f*(255-g-g)/255,l=w+t*(255-w-w)/255,p=x+n*(255-x-x)/255},hue:function(){N(f,t,n,z(g,w,x)),o(j,l,p,b(g,w,x))},saturation:function(){N(g,w,x,z(f,t,n)),o(j,l,p,b(g,w,x))},luminosity:function(){o(g,w,x,b(f,t,n))},color:function(){o(f,t,n,b(g,w,x))},add:function(){j=i(g+f,255),l=i(w+t,255),p=i(x+n,255)},subtract:function(){j=u(g-f,0),l=u(w-t,0),p=u(x-n,0)},average:function(){j=(g+f)/2,l=(w+t)/2,p=(x+n)/2},negation:function(){j=255-h(255-f-g),l=255-h(255-t-w),p=255-h(255-n-x)}},d=this.nativeModes=k.each(["source-over","source-in","source-out","source-atop","destination-over","destination-in","destination-out","destination-atop","lighter","darker","copy","xor"],function(I){this[I]=!0},{}),r=D0.getContext(1,1,{willReadFrequently:!0});if(r)k.each(S,function(I,B){var _=B==="darken",M=!1;r.save();try{if(r.fillStyle=_?"#300":"#a00",r.fillRect(0,0,1,1),r.globalCompositeOperation=B,r.globalCompositeOperation===B)r.fillStyle=_?"#a00":"#300",r.fillRect(0,0,1,1),M=r.getImageData(0,0,1,1).data[0]!==_?170:51}catch(L){}r.restore(),d[B]=M}),D0.release(r);this.process=function(I,B,_,M,L){var G=B.canvas,V=I==="normal";if(V||d[I]){if(_.save(),_.setTransform(1,0,0,1,0,0),_.globalAlpha=M,!V)_.globalCompositeOperation=I;_.drawImage(G,L.x,L.y),_.restore()}else{var R=S[I];if(!R)return;var q=_.getImageData(L.x,L.y,G.width,G.height),E=q.data,e=B.getImageData(0,0,G.width,G.height).data;for(var O=0,X=E.length;O<X;O+=4){f=e[O],g=E[O],t=e[O+1],w=E[O+1],n=e[O+2],x=E[O+2],v=e[O+3],y=E[O+3],R();var H=v*M/255,Y=1-H;E[O]=H*j+Y*g,E[O+1]=H*l+Y*w,E[O+2]=H*p+Y*x,E[O+3]=v*M+Y*y}_.putImageData(q,L.x,L.y)}}},c0=new function(){var i="http://www.w3.org/2000/svg",u="http://www.w3.org/2000/xmlns",h="http://www.w3.org/1999/xlink",f={href:h,xlink:u,xmlns:u+"/","xmlns:xlink":u+"/"};function t(g,w,x){return v(T.createElementNS(i,g),w,x)}function n(g,w){var x=f[w],y=x?g.getAttributeNS(x,w):g.getAttribute(w);return y==="null"?null:y}function v(g,w,x){for(var y in w){var j=w[y],l=f[y];if(typeof j==="number"&&x)j=x.number(j);if(l)g.setAttributeNS(l,y,j);else g.setAttribute(y,j)}return g}return{svg:i,xmlns:u,xlink:h,create:t,get:n,set:v}},I8=k.each({fillColor:["fill","color"],fillRule:["fill-rule","string"],strokeColor:["stroke","color"],strokeWidth:["stroke-width","number"],strokeCap:["stroke-linecap","string"],strokeJoin:["stroke-linejoin","string"],strokeScaling:["vector-effect","lookup",{true:"none",false:"non-scaling-stroke"},function(i,u){return!u&&(i instanceof I6||i instanceof K0||i instanceof a6)}],miterLimit:["stroke-miterlimit","number"],dashArray:["stroke-dasharray","array"],dashOffset:["stroke-dashoffset","number"],fontFamily:["font-family","string"],fontWeight:["font-weight","string"],fontSize:["font-size","number"],justification:["text-anchor","lookup",{left:"start",center:"middle",right:"end"}],opacity:["opacity","number"],blendMode:["mix-blend-mode","style"]},function(i,u){var h=k.capitalize(u),f=i[2];this[u]={type:i[1],property:u,attribute:i[0],toSVG:f,fromSVG:f&&k.each(f,function(t,n){this[t]=n},{}),exportFilter:i[3],get:"get"+h,set:"set"+h}},{});new function(){var i;function u(S,d,r){var I=new k,B=S.getTranslation();if(d){var _;if(S.isInvertible())S=S._shiftless(),_=S._inverseTransform(B),B=null;else _=new A;I[r?"cx":"x"]=_.x,I[r?"cy":"y"]=_.y}if(!S.isIdentity()){var M=S.decompose();if(M){var L=[],G=M.rotation,V=M.scaling,R=M.skewing;if(B&&!B.isZero())L.push("translate("+i.point(B)+")");if(G)L.push("rotate("+i.number(G)+")");if(!v0.isZero(V.x-1)||!v0.isZero(V.y-1))L.push("scale("+i.point(V)+")");if(R.x)L.push("skewX("+i.number(R.x)+")");if(R.y)L.push("skewY("+i.number(R.y)+")");I.transform=L.join(" ")}else I.transform="matrix("+S.getValues().join(",")+")"}return I}function h(S,d){var r=u(S._matrix),I=S._children,B=c0.create("g",r,i);for(var _=0,M=I.length;_<M;_++){var L=I[_],G=z(L,d);if(G)if(L.isClipMask()){var V=c0.create("clipPath");V.appendChild(G),b(L,V,"clip"),c0.set(B,{"clip-path":"url(#"+V.id+")"})}else B.appendChild(G)}return B}function f(S,d){var r=u(S._matrix,!0),I=S.getSize(),B=S.getImage();return r.x-=I.width/2,r.y-=I.height/2,r.width=I.width,r.height=I.height,r.href=d.embedImages==!1&&B&&B.src||S.toDataURL(),c0.create("image",r,i)}function t(S,d){var r=d.matchShapes;if(r){var I=S.toShape(!1);if(I)return n(I,d)}var B=S._segments,_=B.length,M,L=u(S._matrix);if(r&&_>=2&&!S.hasHandles())if(_>2){M=S._closed?"polygon":"polyline";var G=[];for(var V=0;V<_;V++)G.push(i.point(B[V]._point));L.points=G.join(" ")}else{M="line";var R=B[0]._point,q=B[1]._point;L.set({x1:R.x,y1:R.y,x2:q.x,y2:q.y})}else M="path",L.d=S.getPathData(null,d.precision);return c0.create(M,L,i)}function n(S){var{_type:d,_radius:r}=S,I=u(S._matrix,!0,d!=="rectangle");if(d==="rectangle"){d="rect";var B=S._size,_=B.width,M=B.height;if(I.x-=_/2,I.y-=M/2,I.width=_,I.height=M,r.isZero())r=null}if(r)if(d==="circle")I.r=r;else I.rx=r.width,I.ry=r.height;return c0.create(d,I,i)}function v(S,d){var r=u(S._matrix),I=S.getPathData(null,d.precision);if(I)r.d=I;return c0.create("path",r,i)}function g(S,d){var r=u(S._matrix,!0),I=S._definition,B=p(I,"symbol"),_=I._item,M=_.getStrokeBounds();if(!B)B=c0.create("symbol",{viewBox:i.rectangle(M)}),B.appendChild(z(_,d)),b(I,B,"symbol");return r.href="#"+B.id,r.x+=M.x,r.y+=M.y,r.width=M.width,r.height=M.height,r.overflow="visible",c0.create("use",r,i)}function w(S){var d=p(S,"color");if(!d){var r=S.getGradient(),I=r._radial,B=S.getOrigin(),_=S.getDestination(),M;if(I){M={cx:B.x,cy:B.y,r:B.getDistance(_)};var L=S.getHighlight();if(L)M.fx=L.x,M.fy=L.y}else M={x1:B.x,y1:B.y,x2:_.x,y2:_.y};M.gradientUnits="userSpaceOnUse",d=c0.create((I?"radial":"linear")+"Gradient",M,i);var G=r._stops;for(var V=0,R=G.length;V<R;V++){var q=G[V],E=q._color,e=E.getAlpha(),O=q._offset;if(M={offset:O==null?V/(R-1):O},E)M["stop-color"]=E.toCSS(!0);if(e<1)M["stop-opacity"]=e;d.appendChild(c0.create("stop",M,i))}b(S,d,"color")}return"url(#"+d.id+")"}function x(S){var d=c0.create("text",u(S._matrix,!0),i);return d.textContent=S._content,d}var y={Group:h,Layer:h,Raster:f,Path:t,Shape:n,CompoundPath:v,SymbolItem:g,PointText:x};function j(S,d,r){var I={},B=!r&&S.getParent(),_=[];if(S._name!=null)I.id=S._name;if(k.each(I8,function(M){var{get:L,type:G}=M,V=S[L]();if(M.exportFilter?M.exportFilter(S,V):!B||!k.equals(B[L](),V)){if(G==="color"&&V!=null){var R=V.getAlpha();if(R<1)I[M.attribute+"-opacity"]=R}if(G==="style")_.push(M.attribute+": "+V);else I[M.attribute]=V==null?"none":G==="color"?V.gradient?w(V,S):V.toCSS(!0):G==="array"?V.join(","):G==="lookup"?M.toSVG[V]:V}}),_.length)I.style=_.join(";");if(I.opacity===1)delete I.opacity;if(!S._visible)I.visibility="hidden";return c0.set(d,I,i)}var l;function p(S,d){if(!l)l={ids:{},svgs:{}};return S&&l.svgs[d+"-"+(S._id||S.__id||(S.__id=r0.get("svg")))]}function b(S,d,r){if(!l)p();var I=l.ids[r]=(l.ids[r]||0)+1;d.id=r+"-"+I,l.svgs[r+"-"+(S._id||S.__id)]=d}function o(S,d){var r=S,I=null;if(l){r=S.nodeName.toLowerCase()==="svg"&&S;for(var B in l.svgs){if(!I){if(!r)r=c0.create("svg"),r.appendChild(S);I=r.insertBefore(c0.create("defs"),r.firstChild)}I.appendChild(l.svgs[B])}l=null}return d.asString?new a.XMLSerializer().serializeToString(r):r}function z(S,d,r){var I=y[S._class],B=I&&I(S,d);if(B){var _=d.onExport;if(_)B=_(S,B,d)||B;var M=JSON.stringify(S._data);if(M&&M!=="{}"&&M!=="null")B.setAttribute("data-paper-data",M)}return B&&j(S,B,r)}function N(S){if(!S)S={};return i=new p0(S.precision),S}m0.inject({exportSVG:function(S){return S=N(S),o(z(this,S,!0),S)}}),v6.inject({exportSVG:function(S){S=N(S);var d=this._children,r=this.getView(),I=k.pick(S.bounds,"view"),B=S.matrix||I==="view"&&r._matrix,_=B&&j0.read([B]),M=I==="view"?new u0([0,0],r.getViewSize()):I==="content"?m0._getBounds(d,_,{stroke:!0}).rect:u0.read([I],0,{readNull:!0}),L={version:"1.1",xmlns:c0.svg,"xmlns:xlink":c0.xlink};if(M){if(L.width=M.width,L.height=M.height,M.x||M.x===0||M.y||M.y===0)L.viewBox=i.rectangle(M)}var G=c0.create("svg",L,i),V=G;if(_&&!_.isIdentity())V=G.appendChild(c0.create("g",u(_),i));for(var R=0,q=d.length;R<q;R++)V.appendChild(z(d[R],S,!0));return o(G,S)}})},new function(){var i={},u;function h(d,r,I,B,_,M){var L=c0.get(d,r)||M,G=L==null?B?null:I?"":0:I?L:parseFloat(L);return/%\s*$/.test(L)?G/100*(_?1:u[/x|^width/.test(r)?"width":"height"]):G}function f(d,r,I,B,_,M,L){return r=h(d,r||"x",!1,B,_,M),I=h(d,I||"y",!1,B,_,L),B&&(r==null||I==null)?null:new A(r,I)}function t(d,r,I,B,_){return r=h(d,r||"width",!1,B,_),I=h(d,I||"height",!1,B,_),B&&(r==null||I==null)?null:new W(r,I)}function n(d,r,I){return d==="none"?null:r==="number"?parseFloat(d):r==="array"?d?d.split(/[\s,]+/g).map(parseFloat):[]:r==="color"?z(d)||d:r==="lookup"?I[d]:d}function v(d,r,I,B){var _=d.childNodes,M=r==="clippath",L=r==="defs",G=new q0,V=G._project,R=V._currentStyle,q=[];if(!M&&!L)G=o(G,d,B),V._currentStyle=G._style.clone();if(B){var E=d.querySelectorAll("defs");for(var e=0,O=E.length;e<O;e++)N(E[e],I,!1)}for(var e=0,O=_.length;e<O;e++){var X=_[e],H;if(X.nodeType===1&&!/^defs$/i.test(X.nodeName)&&(H=N(X,I,!1))&&!(H instanceof d6))q.push(H)}if(G.addChildren(q),M)G=o(G.reduce(),d,B);if(V._currentStyle=R,M||L)G.remove(),G=null;return G}function g(d,r){var I=d.getAttribute("points").match(/[+-]?(?:\d*\.\d+|\d+\.?)(?:[eE][+-]?\d+)?/g),B=[];for(var _=0,M=I.length;_<M;_+=2)B.push(new A(parseFloat(I[_]),parseFloat(I[_+1])));var L=new N0(B);if(r==="polygon")L.closePath();return L}function w(d){return I6.create(d.getAttribute("d"))}function x(d,r){var I=(h(d,"href",!0)||"").substring(1),B=r==="radialgradient",_;if(I){if(_=i[I].getGradient(),_._radial^B)_=_.clone(),_._radial=B}else{var M=d.childNodes,L=[];for(var G=0,V=M.length;G<V;G++){var R=M[G];if(R.nodeType===1)L.push(o(new J6,R))}_=new V6(L,B)}var q,E,e,O=h(d,"gradientUnits",!0)!=="userSpaceOnUse";if(B)q=f(d,"cx","cy",!1,O,"50%","50%"),E=q.add(h(d,"r",!1,!1,O,"50%"),0),e=f(d,"fx","fy",!0,O);else q=f(d,"x1","y1",!1,O,"0%","0%"),E=f(d,"x2","y2",!1,O,"100%","0%");var X=o(new a0(_,q,E,e),d);return X._scaleToBounds=O,null}var y={"#document":function(d,r,I,B){var _=d.childNodes;for(var M=0,L=_.length;M<L;M++){var G=_[M];if(G.nodeType===1)return N(G,I,B)}},g:v,svg:v,clippath:v,polygon:g,polyline:g,path:w,lineargradient:x,radialgradient:x,image:function(d){var r=new _6(h(d,"href",!0));return r.on("load",function(){var I=t(d);this.setSize(I);var B=f(d).add(I.divide(2));this._matrix.append(new j0().translate(B))}),r},symbol:function(d,r,I,B){return new d6(v(d,r,I,B),!0)},defs:v,use:function(d){var r=(h(d,"href",!0)||"").substring(1),I=i[r],B=f(d);return I?I instanceof d6?I.place(B):I.clone().translate(B):null},circle:function(d){return new K0.Circle(f(d,"cx","cy"),h(d,"r"))},ellipse:function(d){return new K0.Ellipse({center:f(d,"cx","cy"),radius:t(d,"rx","ry")})},rect:function(d){return new K0.Rectangle(new u0(f(d),t(d)),t(d,"rx","ry"))},line:function(d){return new N0.Line(f(d,"x1","y1"),f(d,"x2","y2"))},text:function(d){var r=new z5(f(d).add(f(d,"dx","dy")));return r.setContent(d.textContent.trim()||""),r},switch:v};function j(d,r,I,B){if(d.transform){var _=(B.getAttribute(I)||"").split(/\)\s*/g),M=new j0;for(var L=0,G=_.length;L<G;L++){var V=_[L];if(!V)break;var R=V.split(/\(\s*/),q=R[0],E=R[1].split(/[\s,]+/g);for(var e=0,O=E.length;e<O;e++)E[e]=parseFloat(E[e]);switch(q){case"matrix":M.append(new j0(E[0],E[1],E[2],E[3],E[4],E[5]));break;case"rotate":M.rotate(E[0],E[1]||0,E[2]||0);break;case"translate":M.translate(E[0],E[1]||0);break;case"scale":M.scale(E);break;case"skewX":M.skew(E[0],0);break;case"skewY":M.skew(0,E[0]);break}}d.transform(M)}}function l(d,r,I){var B=I==="fill-opacity"?"getFillColor":"getStrokeColor",_=d[B]&&d[B]();if(_)_.setAlpha(parseFloat(r))}var p=k.set(k.each(I8,function(d){this[d.attribute]=function(r,I){if(r[d.set]){if(r[d.set](n(I,d.type,d.fromSVG)),d.type==="color"){var B=r[d.get]();if(B){if(B._scaleToBounds){var _=r.getBounds();B.transform(new j0().translate(_.getPoint()).scale(_.getSize()))}}}}}},{}),{id:function(d,r){if(i[r]=d,d.setName)d.setName(r)},"clip-path":function(d,r){var I=z(r);if(I)if(I=I.clone(),I.setClipMask(!0),d instanceof q0)d.insertChild(0,I);else return new q0(I,d)},gradientTransform:j,transform:j,"fill-opacity":l,"stroke-opacity":l,visibility:function(d,r){if(d.setVisible)d.setVisible(r==="visible")},display:function(d,r){if(d.setVisible)d.setVisible(r!==null)},"stop-color":function(d,r){if(d.setColor)d.setColor(r)},"stop-opacity":function(d,r){if(d._color)d._color.setAlpha(parseFloat(r))},offset:function(d,r){if(d.setOffset){var I=r.match(/(.*)%$/);d.setOffset(I?I[1]/100:parseFloat(r))}},viewBox:function(d,r,I,B,_){var M=new u0(n(r,"array")),L=t(B,null,null,!0),G,V;if(d instanceof q0){var R=L?L.divide(M.getSize()):1,V=new j0().scale(R).translate(M.getPoint().negate());G=d}else if(d instanceof d6){if(L)M.setSize(L);G=d._item}if(G){if(b(B,"overflow",_)!=="visible"){var q=new K0.Rectangle(M);q.setClipMask(!0),G.addChild(q)}if(V)G.transform(V)}}});function b(d,r,I){var B=d.attributes[r],_=B&&B.value;if(!_&&d.style){var M=k.camelize(r);if(_=d.style[M],!_&&I.node[M]!==I.parent[M])_=I.node[M]}return!_?D:_==="none"?null:_}function o(d,r,I){var B=r.parentNode,_={node:M0.getStyles(r)||{},parent:!I&&!/^defs$/i.test(B.tagName)&&M0.getStyles(B)||{}};return k.each(p,function(M,L){var G=b(r,L,_);d=G!==D&&M(d,G,L,r,_)||d}),d}function z(d){var r=d&&d.match(/\((?:["'#]*)([^"')]+)/),I=r&&r[1],B=I&&i[F?I.replace(F.location.href.split("#")[0]+"#",""):I];if(B&&B._scaleToBounds)B=B.clone(),B._scaleToBounds=!0;return B}function N(d,r,I){var B=d.nodeName.toLowerCase(),_=B!=="#document",M=T.body,L,G,V;if(I&&_)u=P0.getView().getSize(),u=t(d,null,null,!0)||u,L=c0.create("svg",{style:"stroke-width: 1px; stroke-miterlimit: 10"}),G=d.parentNode,V=d.nextSibling,L.appendChild(d),M.appendChild(L);var R=P0.settings,q=R.applyMatrix,E=R.insertItems;R.applyMatrix=!1,R.insertItems=!1;var e=y[B],O=e&&e(d,B,r,I)||null;if(R.insertItems=E,R.applyMatrix=q,O){if(_&&!(O instanceof q0))O=o(O,d,I);var X=r.onImport,H=_&&d.getAttribute("data-paper-data");if(X)O=X(d,O,r)||O;if(r.expandShapes&&O instanceof K0)O.remove(),O=O.toPath();if(H)O._data=JSON.parse(H)}if(L){if(M.removeChild(L),G)if(V)G.insertBefore(d,V);else G.appendChild(d)}if(I){if(i={},O&&k.pick(r.applyMatrix,q))O.matrix.apply(!0,!0)}return O}function S(d,r,I){if(!d)return null;r=typeof r==="function"?{onLoad:r}:r||{};var B=P0,_=null;function M(R){try{var q=typeof R==="object"?R:new a.DOMParser().parseFromString(R.trim(),"image/svg+xml");if(!q.nodeName)throw q=null,new Error("Unsupported SVG source: "+d);if(P0=B,_=N(q,r,!0),!r||r.insert!==!1)I._insertItem(D,_);var E=r.onLoad;if(E)E(_,R)}catch(e){L(e)}}function L(R,q){var E=r.onError;if(E)E(R,q);else throw new Error(R)}if(typeof d==="string"&&!/^[\s\S]*</.test(d)){var G=T.getElementById(d);if(G)M(G);else G5.request({url:d,async:!0,onLoad:M,onError:L})}else if(typeof File!=="undefined"&&d instanceof File){var V=new FileReader;return V.onload=function(){M(V.result)},V.onerror=function(){L(V.error)},V.readAsText(d)}else M(d);return _}m0.inject({importSVG:function(d,r){return S(d,r,this)}}),v6.inject({importSVG:function(d,r){return this.activate(),S(d,r,this)}})};var P0=new(U.inject(k.exports,{Base:k,Numerical:v0,Key:S8,DomEvent:V0,DomElement:M0,document:T,window:F,Symbol:d6,PlacedSymbol:K6}));if(P0.agent.node)(()=>({}))(P0);if(typeof define==="function"&&define.amd)define("paper",P0);else if(typeof s==="object"&&s)s.exports=P0;return P0}.call(m,typeof self==="object"?self:null)}),l4=X8(F8(),1),v8=X8(F8(),1),P=new Q0.Generator("JavaScript");P.addReservedWords("break,case,catch,class,const,continue,debugger,default,delete,do,else,export,extends,finally,for,function,if,import,in,instanceof,new,return,super,switch,this,throw,try,typeof,var,void,while,with,yield,enum,implements,interface,let,package,private,protected,public,static,await,null,true,false,arguments,"+Object.getOwnPropertyNames(globalThis).join(","));P.ORDER_ATOMIC=0;P.ORDER_NEW=1.1;P.ORDER_MEMBER=1.2;P.ORDER_FUNCTION_CALL=2;P.ORDER_INCREMENT=3;P.ORDER_DECREMENT=3;P.ORDER_BITWISE_NOT=4.1;P.ORDER_UNARY_PLUS=4.2;P.ORDER_UNARY_NEGATION=4.3;P.ORDER_LOGICAL_NOT=4.4;P.ORDER_TYPEOF=4.5;P.ORDER_VOID=4.6;P.ORDER_DELETE=4.7;P.ORDER_DIVISION=5.1;P.ORDER_MULTIPLICATION=5.2;P.ORDER_MODULUS=5.3;P.ORDER_SUBTRACTION=6.1;P.ORDER_ADDITION=6.2;P.ORDER_BITWISE_SHIFT=7;P.ORDER_RELATIONAL=8;P.ORDER_IN=8;P.ORDER_INSTANCEOF=8;P.ORDER_EQUALITY=9;P.ORDER_BITWISE_AND=10;P.ORDER_BITWISE_XOR=11;P.ORDER_BITWISE_OR=12;P.ORDER_LOGICAL_AND=13;P.ORDER_LOGICAL_OR=14;P.ORDER_CONDITIONAL=15;P.ORDER_ASSIGNMENT=16;P.ORDER_COMMA=17;P.ORDER_NONE=99;P.ORDER_OVERRIDES=[[P.ORDER_FUNCTION_CALL,P.ORDER_MEMBER],[P.ORDER_FUNCTION_CALL,P.ORDER_FUNCTION_CALL],[P.ORDER_MEMBER,P.ORDER_MEMBER],[P.ORDER_MEMBER,P.ORDER_FUNCTION_CALL],[P.ORDER_LOGICAL_NOT,P.ORDER_LOGICAL_NOT],[P.ORDER_MULTIPLICATION,P.ORDER_MULTIPLICATION],[P.ORDER_ADDITION,P.ORDER_ADDITION],[P.ORDER_LOGICAL_AND,P.ORDER_LOGICAL_AND],[P.ORDER_LOGICAL_OR,P.ORDER_LOGICAL_OR]];P.init=function(m){if(P.definitions_=Object.create(null),P.functionNames_=Object.create(null),!P.variableDB_)P.variableDB_=new Q0.Names(P.RESERVED_WORDS_);else P.variableDB_.reset();P.variableDB_.setVariableMap(m.getVariableMap());var s=[],C=m.getAllVariables();for(var a=0;a<C.length;a++){if(C[a].type===Q0.BROADCAST_MESSAGE_VARIABLE_TYPE)continue;const F=P.variableDB_.getName(C[a].getId(),Q0.Variables.NAME_TYPE);if(C[a].type===Q0.LIST_VARIABLE_TYPE)s.push(`let ${F}${Q0.LIST_VARIABLE_TYPE} = [];`);else s.push(`let ${F} = 0;`)}var D=Q0.Variables.allDeveloperVariables(m);for(var a=0;a<D.length;a++){const T=P.variableDB_.getName(D[a],Q0.Names.DEVELOPER_VARIABLE_TYPE);if(C[a].type===Q0.LIST_VARIABLE_TYPE)s.push(`let ${T}List = [];`);else s.push(`let ${T} = 0;`)}if(s.length)P.definitions_.variables=s.join("\n")};P.finish=function(m){var s=[];for(var C in P.definitions_)s.push(P.definitions_[C]);return delete P.definitions_,delete P.functionNames_,P.variableDB_.reset(),s.join("\n\n")+"\n\n\n"+m};P.scrubNakedValue=function(m){return m+";\n"};P.quote_=function(m){return m=m.replace(/\\/g,"\\\\").replace(/\n/g,"\\\n").replace(/'/g,"\\'"),"'"+m+"'"};P.scrub_=function(m,s){var C="";if(!m.outputConnection||!m.outputConnection.targetConnection){var a=m.getCommentText();if(a=Q0.utils.wrap(a,P.COMMENT_WRAP-3),a)if(m.getProcedureDef)C+="/**\n"+P.prefixLines(a+"\n"," * ")+" */\n";else C+=P.prefixLines(a+"\n","// ");for(var D=0;D<m.inputList.length;D++)if(m.inputList[D].type==Q0.INPUT_VALUE){var F=m.inputList[D].connection.targetBlock();if(F){var a=P.allNestedComments(F);if(a)C+=P.prefixLines(a,"// ")}}}if(m.startHat_){const T=m.nextConnection&&m.nextConnection.targetBlock();let k=P.blockToCode(T);if(k)k=P.prefixLines(k,P.INDENT),s=s.replace("/* nextCode */",`\n${k}`);return C+s}if(m.parentBlock_){const T=m.nextConnection&&m.nextConnection.targetBlock(),k=P.blockToCode(T);return C+s+k}return""};P.getAdjusted=function(m,s,C,a,D){var F=C||0,T=D||P.ORDER_NONE;if(m.workspace.options.oneBasedIndex)F--;var k=m.workspace.options.oneBasedIndex?"1":"0";if(F>0)var $=P.valueToCode(m,s,P.ORDER_ADDITION)||k;else if(F<0)var $=P.valueToCode(m,s,P.ORDER_SUBTRACTION)||k;else if(a)var $=P.valueToCode(m,s,P.ORDER_UNARY_NEGATION)||k;else var $=P.valueToCode(m,s,T)||k;if(Q0.isNumber($)){if($=parseFloat($)+F,a)$=-$}else{if(F>0){$=$+" + "+F;var U=P.ORDER_ADDITION}else if(F<0){$=$+" - "+-F;var U=P.ORDER_SUBTRACTION}if(a){if(F)$="-("+$+")";else $="-"+$;var U=P.ORDER_UNARY_NEGATION}if(U=Math.floor(U),T=Math.floor(T),U&&T>=U)$="("+$+")"}return $};P.control_wait=(m)=>{let s="";if(P.STATEMENT_PREFIX)s+=P.injectId(P.STATEMENT_PREFIX,m);const C=P.valueToCode(m,"DURATION",P.ORDER_NONE);return s+=`await runtime.sleep(${C});\n`,s};P.control_repeat=(m)=>{let s="",C,a;if(P.STATEMENT_PREFIX)s+=P.injectId(P.STATEMENT_PREFIX,m);if(C=P.valueToCode(m,"TIMES",P.ORDER_NONE)||"false",a=P.statementToCode(m,"SUBSTACK")||"",P.STATEMENT_SUFFIX)a=P.prefixLines(P.injectId(P.STATEMENT_SUFFIX,m),P.INDENT)+a;return s+=`for (let _ = 0; _ < ${C}; _++) {\n${a}  if (anonymous.aborted) return;\n  await runtime.nextFrame();\n}\n`,s};P.control_forever=(m)=>{let s="",C;if(P.STATEMENT_PREFIX)s+=P.injectId(P.STATEMENT_PREFIX,m);if(C=P.statementToCode(m,"SUBSTACK")||"",P.STATEMENT_SUFFIX)C=P.prefixLines(P.injectId(P.STATEMENT_SUFFIX,m),P.INDENT)+C;return s+=`while (true) {\n${C}  if (anonymous.aborted) return;\n  await runtime.nextFrame();\n}\n`,s};P.control_if=(m)=>{let s="",C,a;if(P.STATEMENT_PREFIX)s+=P.injectId(P.STATEMENT_PREFIX,m);if(a=P.valueToCode(m,"CONDITION",P.ORDER_NONE)||"false",C=P.statementToCode(m,"SUBSTACK")||"",P.STATEMENT_SUFFIX)C=P.prefixLines(P.injectId(P.STATEMENT_SUFFIX,m),P.INDENT)+C;if(s+=`if (${a}) {\n${C}}\n`,m.getInput("SUBSTACK2")){if(C=P.statementToCode(m,"SUBSTACK2")||"",P.STATEMENT_SUFFIX)C=P.prefixLines(P.injectId(P.STATEMENT_SUFFIX,m),P.INDENT)+C;s+=`else {\n${C}}\n`}return s};P.control_if_else=P.control_if;P.control_wait_until=(m)=>{let s="";if(P.STATEMENT_PREFIX)s+=P.injectId(P.STATEMENT_PREFIX,m);const C=P.valueToCode(m,"CONDITION",P.ORDER_NONE)||"false";return s+=`while (!(${C})) {\n  if (anonymous.aborted) return;\n  await runtime.nextFrame();\n}\n`,s};P.control_repeat_until=(m)=>{let s="",C,a;if(P.STATEMENT_PREFIX)s+=P.injectId(P.STATEMENT_PREFIX,m);if(a=P.valueToCode(m,"CONDITION",P.ORDER_NONE)||"false",C=P.statementToCode(m,"SUBSTACK")||"",P.STATEMENT_SUFFIX)C=P.prefixLines(P.injectId(P.STATEMENT_SUFFIX,m),P.INDENT)+C;return s+=`while (!(${a})) {\n${C}  if (anonymous.aborted) return;\n  await runtime.nextFrame();\n}\n`,s};P.control_while=(m)=>{let s="",C,a;if(P.STATEMENT_PREFIX)s+=P.injectId(P.STATEMENT_PREFIX,m);if(a=P.valueToCode(m,"CONDITION",P.ORDER_NONE)||"false",C=P.statementToCode(m,"SUBSTACK")||"",P.STATEMENT_SUFFIX)C=P.prefixLines(P.injectId(P.STATEMENT_SUFFIX,m),P.INDENT)+C;return s+=`while (${a}) {\n${C}  if (anonymous.aborted) return;\n  await runtime.nextFrame();\n}\n`,s};P.control_stop=(m)=>{let s="";if(P.STATEMENT_PREFIX)s+=P.injectId(P.STATEMENT_PREFIX,m);switch(m.getFieldValue("STOP_OPTION")){case"all":s+="runtime.stop();\n";break;case"this script":s+="return;\n";break;case"other scripts in sprite":s+="runtime.abort(anonymous.id);\n";break}return s};P.control_start_as_clone=(m)=>{};P.control_create_clone_of=(m)=>{};P.control_delete_this_clone=(m)=>{};P.data_variable=(m)=>{return[`${P.variableDB_.getName(m.getFieldValue("VARIABLE"),_0.Variables.NAME_TYPE)}`,P.ORDER_CONDITIONAL]};P.data_setvariableto=(m)=>{let s="";if(P.STATEMENT_PREFIX)s+=P.injectId(P.STATEMENT_PREFIX,m);const C=P.variableDB_.getName(m.getFieldValue("VARIABLE"),_0.Variables.NAME_TYPE),a=P.valueToCode(m,"VALUE",P.ORDER_NONE)||0;return s+=`${C} = ${a};\n`,s};P.data_changevariableby=(m)=>{let s="";if(P.STATEMENT_PREFIX)s+=P.injectId(P.STATEMENT_PREFIX,m);const C=P.variableDB_.getName(m.getFieldValue("VARIABLE"),_0.Variables.NAME_TYPE),a=P.valueToCode(m,"VALUE",P.ORDER_NONE)||0;return s+=`${C} = (isNaN(${C}) ? 0 : +${C}) + +(${a});\n`,s};P.data_listcontents=(m)=>{return[P.variableDB_.getName(m.getFieldValue("LIST"),_0.Variables.NAME_TYPE)+_0.LIST_VARIABLE_TYPE,P.ORDER_ATOMIC]};P.data_addtolist=(m)=>{let s="";if(P.STATEMENT_PREFIX)s+=P.injectId(P.STATEMENT_PREFIX,m);const C=P.variableDB_.getName(m.getFieldValue("LIST"),_0.Variables.NAME_TYPE)+_0.LIST_VARIABLE_TYPE,a=P.valueToCode(m,"ITEM",P.ORDER_NONE)||0;return s+=`${C}.push(${a});\n`,s};P.data_deleteoflist=(m)=>{let s="";if(P.STATEMENT_PREFIX)s+=P.injectId(P.STATEMENT_PREFIX,m);const C=P.variableDB_.getName(m.getFieldValue("LIST"),_0.Variables.NAME_TYPE)+_0.LIST_VARIABLE_TYPE,a=(P.valueToCode(m,"INDEX",P.ORDER_NONE)||0)-1;return s+=`${a} > -1 && ${C}.splice(${a}, 1);\n`,s};P.data_deletealloflist=(m)=>{let s="";if(P.STATEMENT_PREFIX)s+=P.injectId(P.STATEMENT_PREFIX,m);const C=P.variableDB_.getName(m.getFieldValue("LIST"),_0.Variables.NAME_TYPE)+_0.LIST_VARIABLE_TYPE;return s+=`${C}.length = 0;\n`,s};P.data_insertatlist=(m)=>{let s="";if(P.STATEMENT_PREFIX)s+=P.injectId(P.STATEMENT_PREFIX,m);const C=P.variableDB_.getName(m.getFieldValue("LIST"),_0.Variables.NAME_TYPE)+_0.LIST_VARIABLE_TYPE,a=(P.valueToCode(m,"INDEX",P.ORDER_NONE)||0)-1,D=P.valueToCode(m,"ITEM",P.ORDER_NONE)||0;return s+=`${a} > -1 && ${C}.splice(${a}, 0, ${D});\n`,s};P.data_replaceitemoflist=(m)=>{let s="";if(P.STATEMENT_PREFIX)s+=P.injectId(P.STATEMENT_PREFIX,m);const C=P.variableDB_.getName(m.getFieldValue("LIST"),_0.Variables.NAME_TYPE)+_0.LIST_VARIABLE_TYPE,a=(P.valueToCode(m,"INDEX",P.ORDER_NONE)||0)-1,D=P.valueToCode(m,"ITEM",P.ORDER_NONE)||0;return s+=`${a} > -1 && ${C}.splice(${a}, 1, ${D});\n`,s};P.data_itemoflist=(m)=>{const s=P.variableDB_.getName(m.getFieldValue("LIST"),_0.Variables.NAME_TYPE)+_0.LIST_VARIABLE_TYPE,C=(P.valueToCode(m,"INDEX",P.ORDER_NONE)||0)-1;return[`${C} > -1 ? ${s}[${C}] : ''`,P.ORDER_CONDITIONAL]};P.data_itemnumoflist=(m)=>{const s=P.variableDB_.getName(m.getFieldValue("LIST"),_0.Variables.NAME_TYPE)+_0.LIST_VARIABLE_TYPE,C=P.valueToCode(m,"ITEM",P.ORDER_NONE)||0;return[`(${s}.indexOf(${C}) + 1)`,P.ORDER_NONE]};P.data_lengthoflist=(m)=>{return[`${P.variableDB_.getName(m.getFieldValue("LIST"),_0.Variables.NAME_TYPE)+_0.LIST_VARIABLE_TYPE}.length`,P.ORDER_MEMBER]};P.data_listcontainsitem=(m)=>{const s=P.variableDB_.getName(m.getFieldValue("LIST"),_0.Variables.NAME_TYPE)+_0.LIST_VARIABLE_TYPE,C=P.valueToCode(m,"ITEM",P.ORDER_NONE)||0;return[`${s}.includes(${C})`,P.ORDER_FUNCTION_CALL]};P.event_whenflagclicked=(m)=>{return"runtime.on('start', async function anonymous() {/* nextCode */});\n"};P.event_whengreaterthan=(m)=>{};P.event_whenbroadcastreceived=(m)=>{return`runtime.on('${P.variableDB_.getName(m.getFieldValue("BROADCAST_OPTION"),T8.Variables.NAME_TYPE)}', async function anonymous(done) {/* nextCode */  done()\n});\n`};P.event_broadcast_menu=(m)=>{return[P.variableDB_.getName(m.getFieldValue("BROADCAST_OPTION"),T8.Variables.NAME_TYPE),P.ORDER_ATOMIC]};P.event_broadcast=(m)=>{let s="";if(P.STATEMENT_PREFIX)s+=P.injectId(P.STATEMENT_PREFIX,m);const C=P.valueToCode(m,"BROADCAST_INPUT",P.ORDER_NONE)||"None";return s+=`runtime.broadcast('${C}')\n`,s};P.event_broadcastandwait=(m)=>{let s="";if(P.STATEMENT_PREFIX)s+=P.injectId(P.STATEMENT_PREFIX,m);const C=P.valueToCode(m,"BROADCAST_INPUT",P.ORDER_NONE)||"None";return s+=`await runtime.broadcast('${C}')\n`,s};P.math_number=(m)=>{let s=parseFloat(m.getFieldValue("NUM")),C;if(s===Infinity)s="Infinity",C=P.ORDER_FUNCTION_CALL;else if(s===(-Infinity))s="-Infinity",C=P.ORDER_UNARY_SIGN;else if(Number.isNaN(s))s="NaN",C=P.ORDER_UNARY_SIGN;else C=s<0?P.ORDER_UNARY_SIGN:P.ORDER_ATOMIC;return[s,C]};P.math_integer=(m)=>{const s=parseInt(m.getFieldValue("NUM")),C=s<0?P.ORDER_UNARY_SIGN:P.ORDER_ATOMIC;return[s,C]};P.math_whole_number=(m)=>{return[Math.abs(parseInt(m.getFieldValue("NUM"))),P.ORDER_ATOMIC]};P.math_positive_number=(m)=>{let s=parseFloat(m.getFieldValue("NUM")),C;if(s===Infinity)s="Infinity",C=P.ORDER_FUNCTION_CALL;else if(s===(-Infinity))s="-Infinity",C=P.ORDER_FUNCTION_CALL;else if(Number.isNaN(s))s="NaN",C=P.ORDER_FUNCTION_CALL;else s=s<0?0:s,C=P.ORDER_ATOMIC;return[s,C]};P.math_angle=(m)=>{let s=parseFloat(m.getFieldValue("NUM")),C;if(s==Infinity)s="Infinity",C=P.ORDER_FUNCTION_CALL;else if(s==(-Infinity))s="-Infinity",C=P.ORDER_UNARY_SIGN;else s=s%360,s=s<0?s+360:s,C=P.ORDER_ATOMIC;return[s,C]};P.operator_add=(m)=>{const s=P.valueToCode(m,"NUM1",P.ORDER_NONE)||0,C=P.valueToCode(m,"NUM2",P.ORDER_NONE)||0;return[`(${s} + ${C})`,P.ORDER_SUBTRACTION]};P.operator_subtract=(m)=>{const s=P.valueToCode(m,"NUM1",P.ORDER_NONE)||0,C=P.valueToCode(m,"NUM2",P.ORDER_NONE)||0;return[`(${s} - ${C})`,P.ORDER_ADDITION]};P.operator_multiply=(m)=>{const s=P.valueToCode(m,"NUM1",P.ORDER_NONE)||0,C=P.valueToCode(m,"NUM2",P.ORDER_NONE)||0;return[`(${s} * ${C})`,P.ORDER_MULTIPLICATION]};P.operator_divide=(m)=>{const s=P.valueToCode(m,"NUM1",P.ORDER_NONE)||0,C=P.valueToCode(m,"NUM2",P.ORDER_NONE)||0;return[`(${s} / ${C})`,P.ORDER_DIVISION]};P.operator_random=(m)=>{const s=P.valueToCode(m,"FROM",P.ORDER_NONE)||0,C=P.valueToCode(m,"TO",P.ORDER_NONE)||0;return[`runtime.random(${s}, ${C})`,P.ORDER_FUNCTION_CALL]};P.operator_gt=(m)=>{const s=P.valueToCode(m,"OPERAND1",P.ORDER_NONE)||0,C=P.valueToCode(m,"OPERAND2",P.ORDER_NONE)||0;return[`(${s} > ${C})`,P.ORDER_RELATIONAL]};P.operator_lt=(m)=>{const s=P.valueToCode(m,"OPERAND1",P.ORDER_NONE)||0,C=P.valueToCode(m,"OPERAND2",P.ORDER_NONE)||0;return[`(${s} < ${C})`,P.ORDER_RELATIONAL]};P.operator_equals=(m)=>{const s=P.valueToCode(m,"OPERAND1",P.ORDER_NONE)||0,C=P.valueToCode(m,"OPERAND2",P.ORDER_NONE)||0;return[`(${s} == ${C})`,P.ORDER_RELATIONAL]};P.operator_and=(m)=>{const s=P.valueToCode(m,"OPERAND1",P.ORDER_NONE)||0,C=P.valueToCode(m,"OPERAND2",P.ORDER_NONE)||0;return[`(${s} && ${C})`,P.ORDER_LOGICAL_AND]};P.operator_or=(m)=>{const s=P.valueToCode(m,"OPERAND1",P.ORDER_NONE)||0,C=P.valueToCode(m,"OPERAND2",P.ORDER_NONE)||0;return[`(${s} || ${C})`,P.ORDER_LOGICAL_OR]};P.operator_not=(m)=>{return[`!(${P.valueToCode(m,"OPERAND",P.ORDER_NONE)||0})`,P.ORDER_LOGICAL_NOT]};P.operator_join=(m)=>{const s=P.valueToCode(m,"STRING1",P.ORDER_NONE)||"",C=P.valueToCode(m,"STRING2",P.ORDER_NONE)||""};P.operator_constter_of=(m)=>{const s=P.valueToCode(m,"LETTER",P.ORDER_NONE)||"",C=P.valueToCode(m,"STRING",P.ORDER_NONE)||""};P.operator_length=(m)=>{const s=P.valueToCode(m,"STRING",P.ORDER_NONE)||""};P.operator_contains=(m)=>{const s=P.valueToCode(m,"STRING1",P.ORDER_NONE)||"",C=P.valueToCode(m,"STRING2",P.ORDER_NONE)||""};P.operator_mod=(m)=>{const s=P.valueToCode(m,"NUM1",P.ORDER_NONE)||0,C=P.valueToCode(m,"NUM2",P.ORDER_NONE)||0;return[`(${s} % ${C})`,P.ORDER_MODULUS]};P.operator_round=(m)=>{return[`Math.round(${P.valueToCode(m,"NUM",P.ORDER_NONE)||0})`,P.ORDER_FUNCTION_CALL]};P.operator_mathop=(m)=>{const s=P.valueToCode(m,"NUM",P.ORDER_NONE)||0,C=m.getFieldValue("OPERATOR");let a="";if(C==="ceiling")a+=`Math.ceil(${s})`;else if(C==="sin"||C==="cos"||C==="tan")a+=`Math.${C}((Math.PI * ${s}) / 180)`;else if(C==="asin"||C==="acos"||C==="atan")a+=`((Math.${C}(${s}) * 180) / Math.PI)`;else if(C==="ln")a+=`(Math.log(${s})`;else if(C==="log")a+=`(Math.log(${s}) / Math.LN10)`;else if(C==="e ^")a+=`Math.exp(${s})`;else if(C==="10 ^")a+=`Math.pow(10, ${s})`;else a+=`Math.${C}(${s})`;return[a,P.ORDER_FUNCTION_CALL]};P.procedures_definition=(m)=>{};P.procedures_call=(m)=>{};P.procedures_prototype=(m)=>{};P.procedures_declaration=(m)=>{};P.argument_reporter_boolean=(m)=>{};P.argument_reporter_string_number=(m)=>{};P.argument_editor_boolean=(m)=>{};P.argument_editor_string_number=(m)=>{};P.sensing_timer=(m)=>{return["runtime.getTimer()",P.ORDER_FUNCTION_CALL]};P.sensing_resettimer=(m)=>{return"runtime.resetTimer()\n"};P.text=(m)=>{return[P.quote_(m.getFieldValue("TEXT")),P.ORDER_ATOMIC]};var b4=new Set([W0.Events.BLOCK_CHANGE,W0.Events.BLOCK_CREATE,W0.Events.BLOCK_DELETE,W0.Events.BLOCK_MOVE,W0.Events.COMMENT_CHANGE,W0.Events.COMMENT_CREATE,W0.Events.COMMENT_DELETE,W0.Events.COMMENT_MOVE,W0.Events.VAR_CREATE,W0.Events.VAR_DELETE,W0.Events.VAR_RENAME]),N4=function(m){console&&console.warn&&console.warn(m)},o0=function(){o0.init.call(this)},O6=function(m){if(typeof m!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof m)},Y8=function(m){return m._maxListeners===void 0?o0.defaultMaxListeners:m._maxListeners},Z8=function(m,s,C,a){var D,F,T;if(O6(C),F=m._events,F===void 0?(F=m._events=Object.create(null),m._eventsCount=0):(F.newListener!==void 0&&(m.emit("newListener",s,C.listener?C.listener:C),F=m._events),T=F[s]),T===void 0)T=F[s]=C,++m._eventsCount;else if(typeof T=="function"?T=F[s]=a?[C,T]:[T,C]:a?T.unshift(C):T.push(C),D=Y8(m),D>0&&T.length>D&&!T.warned){T.warned=!0;var k=new Error("Possible EventEmitter memory leak detected. "+T.length+" "+String(s)+" listeners added. Use emitter.setMaxListeners() to increase limit");k.name="MaxListenersExceededWarning",k.emitter=m,k.type=s,k.count=T.length,N4(k)}return m},S4=function(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)},W8=function(m,s,C){var a={fired:!1,wrapFn:void 0,target:m,type:s,listener:C},D=S4.bind(a);return D.listener=C,a.wrapFn=D,D},K8=function(m,s,C){var a=m._events;if(a===void 0)return[];var D=a[s];return D===void 0?[]:typeof D=="function"?C?[D.listener||D]:[D]:C?o4(D):J8(D,D.length)},U8=function(m){var s=this._events;if(s!==void 0){var C=s[m];if(typeof C=="function")return 1;if(C!==void 0)return C.length}return 0},J8=function(m,s){for(var C=new Array(s),a=0;a<s;++a)C[a]=m[a];return C},I4=function(m,s){for(;s+1<m.length;s++)m[s]=m[s+1];m.pop()},o4=function(m){for(var s=new Array(m.length),C=0;C<s.length;++C)s[C]=m[C].listener||m[C];return s},B6=typeof Reflect=="object"?Reflect:null,R8=B6&&typeof B6.apply=="function"?B6.apply:function(m,s,C){return Function.prototype.apply.call(m,s,C)},R6;B6&&typeof B6.ownKeys=="function"?R6=B6.ownKeys:Object.getOwnPropertySymbols?R6=function(m){return Object.getOwnPropertyNames(m).concat(Object.getOwnPropertySymbols(m))}:R6=function(m){return Object.getOwnPropertyNames(m)};var Q8=Number.isNaN||function(m){return m!==m};o0.EventEmitter=o0;o0.prototype._events=void 0;o0.prototype._eventsCount=0;o0.prototype._maxListeners=void 0;var O8=10;Object.defineProperty(o0,"defaultMaxListeners",{enumerable:!0,get:function(){return O8},set:function(m){if(typeof m!="number"||m<0||Q8(m))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+m+".");O8=m}});o0.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};o0.prototype.setMaxListeners=function(m){if(typeof m!="number"||m<0||Q8(m))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+m+".");return this._maxListeners=m,this};o0.prototype.getMaxListeners=function(){return Y8(this)};o0.prototype.emit=function(m){for(var s=[],C=1;C<arguments.length;C++)s.push(arguments[C]);var a=m==="error",D=this._events;if(D!==void 0)a=a&&D.error===void 0;else if(!a)return!1;if(a){var F;if(s.length>0&&(F=s[0]),F instanceof Error)throw F;var T=new Error("Unhandled error."+(F?" ("+F.message+")":""));throw T.context=F,T}var k=D[m];if(k===void 0)return!1;if(typeof k=="function")R8(k,this,s);else for(var $=k.length,U=J8(k,$),C=0;C<$;++C)R8(U[C],this,s);return!0};o0.prototype.addListener=function(m,s){return Z8(this,m,s,!1)};o0.prototype.on=o0.prototype.addListener;o0.prototype.prependListener=function(m,s){return Z8(this,m,s,!0)};o0.prototype.once=function(m,s){return O6(s),this.on(m,W8(this,m,s)),this};o0.prototype.prependOnceListener=function(m,s){return O6(s),this.prependListener(m,W8(this,m,s)),this};o0.prototype.removeListener=function(m,s){var C,a,D,F,T;if(O6(s),a=this._events,a===void 0)return this;if(C=a[m],C===void 0)return this;if(C===s||C.listener===s)--this._eventsCount===0?this._events=Object.create(null):(delete a[m],a.removeListener&&this.emit("removeListener",m,C.listener||s));else if(typeof C!="function"){for(D=-1,F=C.length-1;F>=0;F--)if(C[F]===s||C[F].listener===s){T=C[F].listener,D=F;break}if(D<0)return this;D===0?C.shift():I4(C,D),C.length===1&&(a[m]=C[0]),a.removeListener!==void 0&&this.emit("removeListener",m,T||s)}return this};o0.prototype.off=o0.prototype.removeListener;o0.prototype.removeAllListeners=function(m){var s,C,a;if(C=this._events,C===void 0)return this;if(C.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):C[m]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete C[m]),this;if(arguments.length===0){var D=Object.keys(C),F;for(a=0;a<D.length;++a)F=D[a],F!=="removeListener"&&this.removeAllListeners(F);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(s=C[m],typeof s=="function")this.removeListener(m,s);else if(s!==void 0)for(a=s.length-1;a>=0;a--)this.removeListener(m,s[a]);return this};o0.prototype.listeners=function(m){return K8(this,m,!0)};o0.prototype.rawListeners=function(m){return K8(this,m,!1)};o0.listenerCount=function(m,s){return typeof m.listenerCount=="function"?m.listenerCount(s):U8.call(m,s)};o0.prototype.listenerCount=U8;o0.prototype.eventNames=function(){return this._eventsCount>0?R6(this._events):[]};var K3=o0.prototype;class X6 extends o0{static DEFAULT_FPS=24;constructor(m,s,C=X6.DEFAULT_FPS){super();this._fps=C,this._spf=1/C,this._running=!1,this._requestStop=s,this._timer=0,this._timers=[],this._idCounter=0,this._eventsGroups={},this.openEventsGroup("global"),new Function("runtime",m)(this),console.log(m)}get running(){return this._running}get timer(){return Date.now()-this._timer}openEventsGroup(m){this._currentGroupName=m,this._eventsGroups[m]=this._eventsGroups[m]||[]}closeEventsGroup(){this._currentGroupName="global"}abort(m){const s=m.split(":")[0],C=[];this._eventsGroups[s].forEach((a)=>{if(a.id===m)C.push(a);else a._aborted=!0}),this._eventsGroups[s]=C}on(m,s){const C=this._currentGroupName;Object.defineProperties(s,{id:{get:()=>s._id},aborted:{get:()=>s._aborted||!this.running}}),super.on(m,(...a)=>{s._id=`${C}:${++this._idCounter}`,s._aborted=!1,this._eventsGroups[C].push(s),s(...a)})}emit(...m){if(this.running)super.emit(...m)}broadcast(m){return new Promise((s)=>{this.emit(m,s)})}start(){this._running=!0,this.emit("beforeStart"),this.on("start",async()=>{while(this.running)this.emit("frame"),await this.nextFrame()}),this._timer=Date.now(),this.emit("start")}async stop(){this._running=!1,await this.nextFrame(),this._timers.forEach(clearTimeout),this._timers.length=0,this._requestStop()}sleep(m){return new Promise((s)=>this._timers.push(setTimeout(s,m*1000)))}nextFrame(){return this.sleep(this._spf)}random(m=1,s=10){return m=Math.ceil(Math.min(m,s)),s=Math.floor(Math.max(m,s)),Math.floor(Math.random()*(s-m+1))+m}resetTimer(){this._timer=Date.now()}}var d0=l4.default;P.motion_attack=(m)=>{let s="";if(P.STATEMENT_PREFIX)s+=P.injectId(P.STATEMENT_PREFIX,m);const C=P.valueToCode(m,"DIRECTION",P.ORDER_NONE)||0,a=P.valueToCode(m,"DISTANCE",P.ORDER_NONE)||100;return s+=`await tank.util.attack(${C}, ${a});\n`,s};P.motion_move=(m)=>{let s="";if(P.STATEMENT_PREFIX)s+=P.injectId(P.STATEMENT_PREFIX,m);const C=P.valueToCode(m,"DIRECTION",P.ORDER_NONE)||0,a=P.valueToCode(m,"SPEED",P.ORDER_NONE)||100;return s+=`tank.util.move(${C}, ${a});\n`,s};P.motion_turnright=(m)=>{let s="";if(P.STATEMENT_PREFIX)s+=P.injectId(P.STATEMENT_PREFIX,m);const C=P.valueToCode(m,"DEGREES",P.ORDER_NONE)||0;return s+=`await tank.util.turnRight(${C});\n`,s};P.motion_turnleft=(m)=>{let s="";if(P.STATEMENT_PREFIX)s+=P.injectId(P.STATEMENT_PREFIX,m);const C=P.valueToCode(m,"DEGREES",P.ORDER_NONE)||0;return s+=`await tank.util.turnLeft(${C});\n`,s};P.motion_pointindirection=(m)=>{let s="";if(P.STATEMENT_PREFIX)s+=P.injectId(P.STATEMENT_PREFIX,m);const C=P.valueToCode(m,"DIRECTION",P.ORDER_NONE)||0;return s+=`await tank.util.setDirection(+${C});\n`,s};P.motion_setspeed=(m)=>{let s="";if(P.STATEMENT_PREFIX)s+=P.injectId(P.STATEMENT_PREFIX,m);const C=P.valueToCode(m,"SPEED",P.ORDER_NONE)||0;return s+=`tank.util.speed = ${C};\n`,s};P.motion_stop=(m)=>{let s="";if(P.STATEMENT_PREFIX)s+=P.injectId(P.STATEMENT_PREFIX,m);return s+="tank.util.speed = 0;\n",s};P.motion_xposition=(m)=>{return["tank.util.x",P.ORDER_ATOMIC]};P.motion_yposition=(m)=>{return["tank.util.y",P.ORDER_ATOMIC]};P.motion_speed=(m)=>{return["tank.util.speed",P.ORDER_ATOMIC]};P.motion_direction=(m)=>{return["tank.util.direction",P.ORDER_ATOMIC]};P.sensing_scanwidth=(m)=>{let s="";if(P.STATEMENT_PREFIX)s+=P.injectId(P.STATEMENT_PREFIX,m);const C=P.valueToCode(m,"WIDTH",P.ORDER_NONE)||5;return s+=`tank.util.scanWidth = ${C};\n`,s};P.sensing_scan=(m)=>{let s="";if(P.STATEMENT_PREFIX)s+=P.injectId(P.STATEMENT_PREFIX,m);const C=P.valueToCode(m,"DIRECTION",P.ORDER_NONE)||0;return s+=`(await tank.util.scan(${C}) !== Infinity)`,[s,P.ORDER_EQUALITY]};P.sensing_scandistance=(m)=>{let s="";if(P.STATEMENT_PREFIX)s+=P.injectId(P.STATEMENT_PREFIX,m);const C=P.valueToCode(m,"DIRECTION",P.ORDER_NONE)||0;return s+=`(await tank.util.scan(${C}))`,[s,P.ORDER_FUNCTION_CALL]};P.sensing_health=(m)=>{let s="";if(P.STATEMENT_PREFIX)s+=P.injectId(P.STATEMENT_PREFIX,m);return s+="tank.util.health",[s,P.ORDER_FUNCTION_CALL]};var z4=()=>`
  <category name="%{BKY_CATEGORY_MOTION}" id="motion" colour="#4C97FF" secondaryColour="#3373CC">
    <block type="motion_attack">
      <value name="DIRECTION">
        <shadow type="math_angle">
          <field name="NUM">90</field>
        </shadow>
      </value>
      <value name="DISTANCE">
        <shadow type="math_number">
          <field name="NUM">200</field>
        </shadow>
      </value>
    </block>
    <block type="motion_move">
      <value name="DIRECTION">
        <shadow type="math_angle">
          <field name="NUM">90</field>
        </shadow>
      </value>
      <value name="SPEED">
        <shadow type="math_number">
          <field name="NUM">100</field>
        </shadow>
      </value>
    </block>
    ${g6}
    <block type="motion_turnright">
      <value name="DEGREES">
        <shadow type="math_number">
          <field name="NUM">15</field>
        </shadow>
      </value>
    </block>
    <block type="motion_turnleft">
      <value name="DEGREES">
        <shadow type="math_number">
          <field name="NUM">15</field>
        </shadow>
      </value>
    </block>
    <block type="motion_pointindirection">
      <value name="DIRECTION">
        <shadow type="math_angle">
          <field name="NUM">90</field>
        </shadow>
      </value>
    </block>
    ${g6}
    <block type="motion_setspeed">
      <value name="SPEED">
        <shadow type="math_number">
          <field name="NUM">50</field>
        </shadow>
      </value>
    </block>
    <block type="motion_stop"/>
    ${g6}
    <block type="motion_speed"/>
    <block type="motion_direction"/>
    ${w8}
  </category>
`,k4=()=>`
  <category name="%{BKY_CATEGORY_SENSING}" id="sensing" colour="#4CBFE6" secondaryColour="#2E8EB8">
    <block type="sensing_scanwidth">
      <value name="WIDTH">
        <shadow type="math_number">
          <field name="NUM">5</field>
        </shadow>
      </value>
    </block>
    <block type="sensing_scan">
      <value name="DIRECTION">
        <shadow type="math_angle">
          <field name="NUM">90</field>
        </shadow>
      </value>
    </block>
    <block type="sensing_scandistance">
      <value name="DIRECTION">
        <shadow type="math_angle">
          <field name="NUM">90</field>
        </shadow>
      </value>
    </block>
    ${g6}
    <block type="sensing_health"/>
    ${g6}
    <block id="timer" type="sensing_timer"/>
    <block type="sensing_resettimer"/>
    ${w8}
  </category>
`,_4=()=>`
  <category name="%{BKY_CATEGORY_OPERATORS}" id="operators" colour="#40BF4A" secondaryColour="#389438">
    <block type="operator_add">
      <value name="NUM1">
        <shadow type="math_number">
          <field name="NUM"/>
        </shadow>
      </value>
      <value name="NUM2">
        <shadow type="math_number">
          <field name="NUM"/>
        </shadow>
      </value>
    </block>
    <block type="operator_subtract">
      <value name="NUM1">
        <shadow type="math_number">
          <field name="NUM"/>
        </shadow>
      </value>
      <value name="NUM2">
        <shadow type="math_number">
          <field name="NUM"/>
        </shadow>
      </value>
    </block>
    <block type="operator_multiply">
      <value name="NUM1">
        <shadow type="math_number">
          <field name="NUM"/>
        </shadow>
      </value>
      <value name="NUM2">
        <shadow type="math_number">
          <field name="NUM"/>
        </shadow>
      </value>
    </block>
    <block type="operator_divide">
      <value name="NUM1">
        <shadow type="math_number">
          <field name="NUM"/>
        </shadow>
      </value>
      <value name="NUM2">
        <shadow type="math_number">
          <field name="NUM"/>
        </shadow>
      </value>
    </block>
    ${g6}
    <block type="operator_random">
      <value name="FROM">
        <shadow type="math_number">
          <field name="NUM">1</field>
        </shadow>
      </value>
      <value name="TO">
        <shadow type="math_number">
          <field name="NUM">10</field>
        </shadow>
      </value>
    </block>
    ${g6}
    <block type="operator_gt">
      <value name="OPERAND1">
        <shadow type="text">
          <field name="TEXT"/>
        </shadow>
      </value>
      <value name="OPERAND2">
        <shadow type="text">
          <field name="TEXT">50</field>
        </shadow>
      </value>
    </block>
    <block type="operator_lt">
      <value name="OPERAND1">
        <shadow type="text">
          <field name="TEXT"/>
        </shadow>
      </value>
      <value name="OPERAND2">
        <shadow type="text">
          <field name="TEXT">50</field>
        </shadow>
      </value>
    </block>
    <block type="operator_equals">
      <value name="OPERAND1">
        <shadow type="text">
          <field name="TEXT"/>
        </shadow>
      </value>
      <value name="OPERAND2">
        <shadow type="text">
          <field name="TEXT">50</field>
        </shadow>
      </value>
    </block>
    ${g6}
    <block type="operator_and"/>
    <block type="operator_or"/>
    <block type="operator_not"/>
    ${g6}
    <block type="operator_mod">
      <value name="NUM1">
        <shadow type="math_number">
          <field name="NUM"/>
        </shadow>
      </value>
      <value name="NUM2">
        <shadow type="math_number">
          <field name="NUM"/>
        </shadow>
      </value>
    </block>
    <block type="operator_round">
      <value name="NUM">
        <shadow type="math_number">
          <field name="NUM"/>
        </shadow>
      </value>
    </block>
    ${g6}
    <block type="operator_mathop">
      <value name="NUM">
        <shadow type="math_number">
          <field name="NUM"/>
        </shadow>
      </value>
    </block>
    ${w8}
  </category>
`;function x8(){return B4([{id:"motion",xml:z4()},{id:"sensing",xml:k4()},{id:"operators",xml:_4()}])}import{jsx as G4} from"preact/jsx-runtime";var c4=q6.Content;function s8(){const{getText:m}=M4(),{fileList:s}=L4(),C=s[0],a={MOTION_ATTACK:m("tankwar.blocks.motion_attack","fire in direction %1 at %2 steps"),MOTION_MOVE:m("tankwar.blocks.motion_move","forward in direction %1 at %2 % speed"),MOTION_SETSPEED:m("tankwar.blocks.motion_setspeed","set speed to %1 %"),MOTION_STOP:m("tankwar.blocks.motion_stop","stop"),MOTION_SPEED:m("tankwar.blocks.motion_speed","speed"),SENSING_SCANWIDTH:m("tankwar.blocks.sensing_scanwidth","set scan width to %1"),SENSING_SCAN:m("tankwar.blocks.sensing_scan","scan for enemy in direction %1?"),SENSING_DISTANCE:m("tankwar.blocks.sensing_distance","measure distance of enemy in direction %1"),SENSING_HEALTH:m("tankwar.blocks.sensing_health","health")},D=x8();return G4(c4,{disableGenerator:!0,disableExtension:!0,messages:a,toolbox:D,xml:C.xml})}import{useState as W6} from"preact/hooks";import{classNames as n3} from"@blockcode/ui";import{useState as l5} from"preact/hooks";import{useEditor as i3} from"@blockcode/core";function z6(m){return new Promise((s)=>{const C=new Image;C.src=m,C.addEventListener("load",()=>s(C))})}var $8="./assets/tank_1-5797dcf7b198a48d.png";var i5="./assets/turret_1-26017ccc46b87689.png";var u5="./assets/tank_2-337708f7538d8787.png";var h5="./assets/turret_2-5c4bb2c458561ace.png";var f5="./assets/tank_3-1d999a2c9dacc246.png";var t5="./assets/turret_3-956bfba650c81c57.png";var n5="./assets/tank_4-f93afcfd2c3d1734.png";var m5="./assets/turret_4-d6c2200ed4ca50b0.png";var g5="./assets/broken-2d9779d033bbcdb5.png";var v5="./assets/bullet-80854a0e7090b0fc.png";var w5="./assets/boom1-65b37ddc26db4cbd.png";var x5="./assets/boom2-82ff355a8e0177ba.png";var s5="./assets/boom3-703bd7bb6580e4d9.png";var Y4=20,Z4=4,W4=40,F6=500,K4=70,U4=400,d8=1000,d5=(m,s)=>Math.sqrt((m.x-s.x)**2+(m.y-s.y)**2),l6=(m)=>isNaN(m)?0:+m,T6=(m,s,C)=>Math.min(Math.max(m,s),C),c6=(m)=>m*Math.PI/180,j6=(m)=>parseInt((m%360+360)%360),p5=(m,s)=>j6(m)===j6(s);class B0{static PLACE={LEFT:{get position(){return new d0.Point(d0.view.center.x-300,d0.view.center.y)},rotation:90},RIGHT:{get position(){return new d0.Point(d0.view.center.x+300,d0.view.center.y)},rotation:-90},LEFT_TOP:{get position(){return new d0.Point(d0.view.center.x-300,d0.view.center.y-300)},rotation:135},RIGHT_TOP:{get position(){return new d0.Point(d0.view.center.x+300,d0.view.center.y-300)},rotation:-135},LEFT_BOTTOM:{get position(){return new d0.Point(d0.view.center.x-300,d0.view.center.y+300)},rotation:45},RIGHT_BOTTOM:{get position(){return new d0.Point(d0.view.center.x+300,d0.view.center.y+300)},rotation:-45}};static STYLE={PLAYER:{tank:$8,turret:i5},ENEMY_A:{tank:u5,turret:h5},ENEMY_B:{tank:f5,turret:t5},ENEMY_C:{tank:n5,turret:m5}};constructor(m,s=B0.STYLE.PLAYER,C=B0.PLACE.LEFT){this.raster=new d0.Raster({name:m,scaling:0.2,source:s.tank,position:C.position,rotation:C.rotation,visible:s===B0.STYLE.PLAYER}),this.turretRaster=new d0.Raster({scaling:0.2,source:s.turret,position:C.position,rotation:C.rotation,visible:s===B0.STYLE.PLAYER}),this.raster.util=this,this.turretRaster.owner=this,this._lastScanDistance=0,this._imageCache={},this._timers=[],this.reset()}sleep(m){return new Promise((s)=>this._timers.push(setTimeout(s,m)))}reset(){if(this._speed=0,this._health=100,this._scanWidth=Z4,this._scanShape)this._scanShape.remove(),this._scanShape=null;if(this._bulletRaster)this._bulletRaster.remove(),this._bulletRaster=null;if(this._boomRaster)this._boomRaster.remove(),this._boomRaster=null;if(this._collideTester)this._collideTester.remove(),this._collideTester=null;clearTimeout(this._turretReady),this._timers.forEach(clearTimeout),this._timers.length=0}bringToFront(){this.raster.bringToFront(),this.turretRaster.bringToFront()}get running(){return this._running}set running(m){if(this.reset(),this._running=m,m){const s=this.raster.scaling.x*this.raster.width-5;this._collideTester=new d0.Path.Rectangle({point:[this.raster.position.x-s/2,this.raster.position.y-5],size:[s,10],applyMatrix:!1})}}get bullseye(){if(!this._bullseye)this._bullseye=Math.min(this.raster.width,this.raster.height)*this.raster.scaling.x/4;return this._bullseye}get enemies(){if(!this._enemies)this._enemies=["red","yellow","green","player"].filter((m)=>m!==this.raster.name).map((m)=>d0.project.activeLayer.children[m]);return this._enemies}set place(m){if(this.running)return;this.raster.position=this.turretRaster.position=m.position,this.raster.rotation=this.turretRaster.rotation=m.rotation,this.hidden=!1}get hidden(){return!this.raster.visible}set hidden(m){this.raster.visible=this.turretRaster.visible=!m}async _turn(m,s){if(!p5(m.rotation,s)){let C=j6(s)-j6(m.rotation);if(C>180)C-=360;if(C<-180)C+=360;await m.tween({rotation:m.rotation+C},d8*(Math.abs(C)/360))}}async attack(m,s){if(!this.running)return;if(this._bulletRaster||this.death)return;m=Math.round(l6(m)),s=l6(s),clearTimeout(this._turretReady),await this._turn(this.turretRaster,m);const C=j6(m),a=c6(90-C);let D=10,F=D*Math.cos(a),T=D*Math.sin(a);if(!this._imageCache.buttet)this._imageCache.buttet=await z6(v5);this._bulletRaster=new d0.Raster({image:this._imageCache.buttet,position:this.raster.position,rotation:this.raster.rotation,scaling:this.raster.scaling}),s=T6(s,K4,U4);const k=s/2,$=D/s/2;while(s>0){if(await this.sleep(15),s<D)F=s*Math.cos(a),T=s*Math.sin(a);if(s-=D,this._bulletRaster.position.x+=F,this._bulletRaster.position.y-=T,this._bulletRaster.scaling.x+=s>k?$:-$,this._bulletRaster.scaling.y=this._bulletRaster.scaling.x,this._bulletRaster.scaling.x<this.raster.scaling.x)this._bulletRaster.scaling=this.raster.scaling}this._boom(this._bulletRaster.position),this._hit(this._bulletRaster,(U)=>{if(d5(U.position,this._bulletRaster.position)<U.util.bullseye)U.util.hurt(10);else U.util.hurt(5)}),this._bulletRaster.remove(),this._bulletRaster=null,this._turretReady=setTimeout(()=>this._turn(this.turretRaster,this.raster.rotation),1000)}async _boom(m){if(!this.running)return;if(!this._imageCache.booms)this._imageCache.booms=[await z6(w5),await z6(x5),await z6(s5)];this._boomRaster=new d0.Raster({image:this._imageCache.booms[0],position:m}),await this.sleep(30),this._boomRaster.image=this._imageCache.booms[1],await this.sleep(50),this._boomRaster.image=this._imageCache.booms[2],await this.sleep(90),this._boomRaster.remove(),this._boomRaster=null}_hit(m,s){if(this.running&&!this.death)this.enemies.forEach((C)=>{if(C.util.death||C.util.hidden)return;if(m.intersects(C)||C.contains(m.position))s(C)})}async move(m,s){if(!this.running)return;if(this.death)return;await this.setDirection(m),this.speed=l6(s)}get colliding(){let m=!1;return this._hit(this._collideTester,()=>m=!0),m}drive(){if(!this.running)return;if(this.speed===0)return;if(this.hidden||this.death)return;let m=this.speed/Y4;const s=c6(90-this.direction),C=this.raster.scaling.y*this.raster.height;this._collideTester.rotation=this.raster.rotation,this._collideTester.position.x=this.raster.position.x+(C/2+5)*Math.cos(s),this._collideTester.position.y=this.raster.position.y-(C/2+5)*Math.sin(s),this._hit(this.raster,(a)=>{if(this.colliding)m=0}),this.raster.position.x+=m*Math.cos(s),this.raster.position.y-=m*Math.sin(s),this.turretRaster.position=this.raster.position}get x(){return this.raster.position.x-d0.view.center.x}get y(){return d0.view.center.y-this.raster.position.y}get speed(){return T6(this._speed,-100,100)}set speed(m){if(!this.running)return;this._speed=T6(m,-100,100)}get speedVelocity(){const m=j6(this.speed<0?180+this.direction:this.direction),s=c6(90-m),C=Math.abs(this.speed);return new d0.Point(C*Math.cos(s),C*Math.sin(s))}get direction(){let m=this.raster.rotation%360;if(m>180)m-=360;if(m<=-180)m+=360;return m}async setDirection(m){if(!this.running)return;m=Math.round(l6(m)),clearTimeout(this._turretReady),this._turn(this.turretRaster,m),await this._turn(this.raster,m)}turnRight(m){let s=this.raster.rotation;return s+=l6(m),this.setDirection(s)}turnLeft(m){return this.turnRight(-l6(m))}hurt(m){if(!this.running)return;if(this._health-=Math.abs(m),this.death)this.hidden=!0,new d0.Raster({source:g5,scaling:this.raster.scaling,position:this.raster.position,rotation:this.raster.rotation}).sendToBack()}get health(){if(this._health<0)return 0;return this._health}get death(){return this.health<=0}get scanWidth(){return this._scanWidth}set scanWidth(m){m=l6(m),this._scanWidth=T6(m,1,W4)}async scan(m){if(!this.running)return Infinity;if(this._scanShape||this.death)return Infinity;if(m=l6(m),!p5(this._lastScanDistance,m)){let I0=j6(m)-j6(this._lastScanDistance);if(I0>180)I0-=360;if(I0<-180)I0+=360;await this.sleep(d8*(Math.abs(I0)/360)),this._lastScanDistance=m}const s=c6(90-(m-this.scanWidth/2)),C=F6*Math.cos(s),a=F6*Math.sin(s),D=new d0.Point(this.raster.position.x+C,this.raster.position.y-a),F=c6(90-(m+this.scanWidth/2)),T=F6*Math.cos(F),k=F6*Math.sin(F),$=new d0.Point(this.raster.position.x+T,this.raster.position.y-k);this._scanShape=new d0.Path({segments:[this.raster.position,D,$],closed:!0,fillColor:{gradient:{stops:[["rgb(255 0 0 0.4)",0],["rgb(255 0 0 0)",0.7]],radial:!0},origin:this.raster.position,destination:D}}),await this.sleep(d8*(this.scanWidth/360));let U=Infinity;return this._hit(this._scanShape,(I0)=>{const t0=d5(this.raster.position,I0.position);if(t0<U)U=t0}),this._scanShape.remove(),this._scanShape=null,U}}class H6 extends X6{get player(){return d0.project.activeLayer.children.player}get redTank(){return d0.project.activeLayer.children.red}get yellowTank(){return d0.project.activeLayer.children.yellow}get greenTank(){return d0.project.activeLayer.children.green}start(){this.player.util.running=!0,this.redTank.util.running=!0,this.yellowTank.util.running=!0,this.greenTank.util.running=!0,super.start()}stop(){super.stop(),this.player.util.running=!1,this.redTank.util.running=!1,this.yellowTank.util.running=!1,this.greenTank.util.running=!1}}var y5=(m="",s=[])=>`
runtime.on('beforeStart', () => {
  runtime.player.util.bringToFront();
});

${s.join("\n")}

((tank) => {
runtime.openEventsGroup('player');
${m}
runtime.closeEventsGroup();
})(runtime.player);

runtime.on('frame', () => {
  runtime.player.util.drive();
  runtime.redTank.util.drive();
  runtime.yellowTank.util.drive();
  runtime.greenTank.util.drive();
});
runtime.start();
`;var G6={};V5(G6,{simple:()=>{{return J4}},senior:()=>{{return $4}},medium:()=>{{return Q4}}});var J4=(m,s)=>`
((tank) => {
  runtime.openEventsGroup('${m}_${s}');

  let _angle_ = 0;

  runtime.on('start', async () => {
    if ((tank.util.y > '0')) {
      await tank.util.move(180, 100);
      while (!((tank.util.y < '10'))) {
        if (!runtime.running) return;
        await runtime.nextFrame();
      }
      tank.util.speed = 0;
    }
    else {
      await tank.util.move(0, 100);
      while (!((tank.util.y > '-10'))) {
        if (!runtime.running) return;
        await runtime.nextFrame();
      }
      tank.util.speed = 0;
    }
    runtime.broadcast('@ai_simple_${m}_${s}_start');
    if ((tank.util.x > '0')) {
      await tank.util.move(270, 70);
      while (!((tank.util.x < '-400'))) {
        if (!runtime.running) return;
        await runtime.nextFrame();
      }
    }
    while (true) {
      tank.util.speed = 0;
      await tank.util.move(90, 70);
      while (!((tank.util.x > '400'))) {
        if (!runtime.running) return;
        await runtime.nextFrame();
      }
      tank.util.speed = 0;
      await tank.util.move(270, 70);
      while (!((tank.util.x < '-400'))) {
        if (!runtime.running) return;
        await runtime.nextFrame();
      }
      if (!runtime.running) return;
      await runtime.nextFrame();
    }
  });

  runtime.on('@ai_simple_${m}_${s}_start', async (done) => {
    while (true) {
      while (!((await tank.util.scan(_angle_) < '400') && (await tank.util.scan(_angle_) > '100'))) {
        _angle_ = (isNaN(_angle_) ? 0 : +_angle_) + +(90);
        if (!runtime.running) return;
        await runtime.nextFrame();
      }
      tank.util.speed = 0;
      await tank.util.attack((_angle_ + 1), (await tank.util.scan(_angle_)));
      tank.util.speed = 50;
      if (!runtime.running) return;
      await runtime.nextFrame();
    }
    done()
  });

  runtime.closeEventsGroup();
})(runtime.${m}Tank);
`,Q4=(m,s)=>`
((tank) => {
  runtime.openEventsGroup('${m}_${s}');

  let _health_ = 0;
  let _angle_ = 0;
  
  runtime.on('start', async function anonymous() {
    _angle_ = runtime.random(1, 360);
    runtime.broadcast('@ai_medium_${m}_${s}_start')
  });
  
  runtime.on('start', async function anonymous() {
    while (true) {
      _health_ = tank.util.health;
      while (!((tank.util.health < _health_))) {
        if (anonymous.aborted) return;
        await runtime.nextFrame();
      }
      runtime.abort(anonymous.id);
      tank.util.move(runtime.random(1, 360), 100);
      await runtime.sleep(1);
      tank.util.speed = 0;
      runtime.broadcast('@ai_medium_${m}_${s}_start')
      if (anonymous.aborted) return;
      await runtime.nextFrame();
    }
  });
  
  runtime.on('@ai_medium_${m}_${s}_start', async function anonymous(done) {
    while (true) {
      while (!((await tank.util.scan(_angle_) !== Infinity))) {
        _angle_ = (isNaN(_angle_) ? 0 : +_angle_) + +(10);
        if (anonymous.aborted) return;
        await runtime.nextFrame();
      }
      while (((await tank.util.scan(_angle_) !== Infinity) && ((await tank.util.scan(_angle_)) > '400'))) {
        tank.util.move(_angle_, 100);
        if (anonymous.aborted) return;
        await runtime.nextFrame();
      }
      tank.util.speed = 0;
      if (((await tank.util.scan(_angle_)) < '400') && ((await tank.util.scan(_angle_)) > '100')) {
        await tank.util.attack((_angle_ + 1), (await tank.util.scan(_angle_)));
      }
      _angle_ = (isNaN(_angle_) ? 0 : +_angle_) + +(-10);
      if (anonymous.aborted) return;
      await runtime.nextFrame();
    }
    done()
  });
  
  runtime.closeEventsGroup();
})(runtime.${m}Tank);
`,$4=(m,s)=>`
((tank) => {
  runtime.openEventsGroup('${m}_${s}');

  let _angle_ = 0;
  let _health_ = 0;
  
  
  runtime.on('start', async function anonymous() {
    if (((tank.util.y < '5') && (tank.util.y > '-5'))) {
      await tank.util.turnLeft(104);
    }
    else {
      await tank.util.turnLeft(180);
    }
    tank.util.speed = 100;
    while (!(((Math.abs(tank.util.x) > '400') && (Math.abs(tank.util.y) > '400')))) {
      if (anonymous.aborted) return;
      await runtime.nextFrame();
    }
    tank.util.speed = 0;
    runtime.broadcast('@ai_senior_${m}_${s}_start')
  });
  
  runtime.on('@ai_senior_${m}_${s}_start', async function anonymous(done) {
    if ((tank.util.x < '0')) {
      if ((tank.util.y < '0')) {
        _angle_ = '45';
      }
      else {
        _angle_ = '135';
      }
    }
    else {
      if ((tank.util.y < '0')) {
        _angle_ = '-45';
      }
      else {
        _angle_ = '-135';
      }
    }
    await tank.util.setDirection(_angle_);
    runtime.broadcast('@ai_senior_${m}_${s}_watch_health');
    _angle_ = (isNaN(_angle_) ? 0 : +_angle_) + +(-60);
    for (let _ = 0; _ < 78; _++) {
      if (((await tank.util.scan(_angle_)) < '400') && ((await tank.util.scan(_angle_)) > '100')) {
        await tank.util.attack((_angle_ + 1), (await tank.util.scan(_angle_)));
        _angle_ = (isNaN(_angle_) ? 0 : +_angle_) + +(-10);
      }
      _angle_ = (isNaN(_angle_) ? 0 : +_angle_) + +(10);
      if (anonymous.aborted) return;
      await runtime.nextFrame();
    }
    runtime.broadcast('@ai_senior_${m}_${s}_next_place');
    done();
  });
  
  runtime.on('@ai_senior_${m}_${s}_next_place', async function anonymous(done) {
    runtime.abort(anonymous.id);
    if ((runtime.random(1, 3) == '1')) {
      await tank.util.turnLeft(45);
    }
    else {
      await tank.util.turnRight(45);
    }
    tank.util.speed = 100;
    await runtime.sleep(1);
    if (((tank.util.direction > '-5') && (tank.util.direction < '5'))) {
      while (!((tank.util.y > '400'))) {
        if (anonymous.aborted) return;
        await runtime.nextFrame();
      }
    }
    else {
      if (((tank.util.direction > '85') && (tank.util.direction < '95'))) {
        while (!((tank.util.x > '400'))) {
          if (anonymous.aborted) return;
          await runtime.nextFrame();
        }
      }
      else {
        if (((tank.util.direction > '-95') && (tank.util.direction < '-85'))) {
          while (!((tank.util.x < '-400'))) {
            if (anonymous.aborted) return;
            await runtime.nextFrame();
          }
        }
        else {
          while (!((tank.util.y < '-400'))) {
            if (anonymous.aborted) return;
            await runtime.nextFrame();
          }
        }
      }
    }
    tank.util.speed = 0;
    runtime.broadcast('@ai_senior_${m}_${s}_start')
    done()
  });
  
  runtime.on('@ai_senior_${m}_${s}_watch_health', async function anonymous(done) {
    _health_ = tank.util.health;
    while (!((tank.util.health < _health_))) {
      if (anonymous.aborted) return;
      await runtime.nextFrame();
    }
    runtime.broadcast('@ai_senior_${m}_${s}_next_place')
    done()
  });
  
  runtime.closeEventsGroup();
})(runtime.${m}Tank);
`;function j5({playing:m,enemies:s,enemiesAI:C,onRequestStop:a,onChangeHealth:D}){const[F,T]=l5(null),[k,$]=l5(!1),{fileList:U,thumb:I0,setThumb:t0}=i3(),p0=U[0];if(F){const r0=d0.project.activeLayer.children;if(m){if(!k){const A=[];if(A.push(G6[C.red]("red",Date.now().toString(36))),s>1)A.push(G6[C.yellow]("yellow",Date.now().toString(36)));if(s>2)A.push(G6[C.green]("green",Date.now().toString(36)));const J=y5(p0.script,A),W=new H6(J,a);W.on("frame",()=>{D({player:r0.player.util.health,red:r0.red.util.health,yellow:r0.yellow.util.health,green:r0.green.util.health})}),$(W)}}else if(k)k.stop(),D({player:100,red:100,yellow:100,green:100}),$(!1);else{if(d0.project.activeLayer.children.forEach((J)=>{if(J.util instanceof B0||J.owner instanceof B0)return;J.remove()}),s===1)r0.red.util.place=B0.PLACE.RIGHT;else r0.red.util.place=B0.PLACE.RIGHT_TOP;if(s>1)r0.yellow.util.place=B0.PLACE.RIGHT_BOTTOM;else r0.yellow.util.hidden=!0;if(s>2)r0.player.util.place=B0.PLACE.LEFT_TOP,r0.green.util.place=B0.PLACE.LEFT_BOTTOM;else r0.player.util.place=B0.PLACE.LEFT,r0.green.util.hidden=!0;const A=F.toDataURL();if(I0!==A)t0(A)}}return u3(H8,{width:"480px",height:"480px",onSetup:(r0)=>{T(r0),d0.view.zoom=0.5,new B0("player",B0.STYLE.PLAYER,B0.PLACE.LEFT),new B0("red",B0.STYLE.ENEMY_A,B0.PLACE.RIGHT),new B0("yellow",B0.STYLE.ENEMY_B,B0.PLACE.RIGHT_BOTTOM),new B0("green",B0.STYLE.ENEMY_C,B0.PLACE.LEFT_BOTTOM)}})}import{jsx as u3} from"preact/jsx-runtime";import{useLocale as t3} from"@blockcode/core";import{classNames as C5} from"@blockcode/ui";function x6(m){const s=globalThis.document,C=s.createElement("style");C.appendChild(s.createTextNode(m)),s.head.append(C)}x6(".NmWGcG_toolbar-wrapper{height:var(--tool-bar-height);padding:var(--space)0;flex-shrink:0;justify-content:space-between;align-items:center;display:flex}.NmWGcG_green-flag,.NmWGcG_stop-all{user-select:none;cursor:pointer;border:0;border-radius:.25rem;width:2rem;height:2rem;padding:.375rem}.NmWGcG_green-flag:hover,.NmWGcG_stop-all:hover{background:var(--motion-light-transparent)}.NmWGcG_green-flag.NmWGcG_actived{background:var(--motion-transparent)}.NmWGcG_stop-all{opacity:.5}.NmWGcG_stop-all.NmWGcG_actived{opacity:1}.NmWGcG_green-flag.NmWGcG_disabled,.NmWGcG_stop-all.NmWGcG_disabled{opacity:.5}.NmWGcG_toolbar-button{width:calc(2rem + 2px);height:calc(2rem + 2px);padding:.375rem!important}.NmWGcG_space{margin-left:.2rem}.NmWGcG_toolbar-buttons-group{display:flex}.NmWGcG_group-button-first{border-top-right-radius:0;border-bottom-right-radius:0}.NmWGcG_group-button{border-left:none;border-radius:0}.NmWGcG_group-button-last{border-left:none;border-top-left-radius:0;border-bottom-left-radius:0}");var N6={disabled:"NmWGcG_disabled",actived:"NmWGcG_actived",space:"NmWGcG_space",toolbarWrapper:"NmWGcG_toolbar-wrapper",stopAll:"NmWGcG_stop-all",groupButtonFirst:"NmWGcG_group-button-first",groupButtonLast:"NmWGcG_group-button-last",greenFlag:"NmWGcG_green-flag",toolbarButtonsGroup:"NmWGcG_toolbar-buttons-group",toolbarButton:"NmWGcG_toolbar-button",groupButton:"NmWGcG_group-button"};var P5="./assets/icon-green-flag-8eb2c7e7b0a15fba.svg";var r5="./assets/icon-stop-all-21d83d10e3dd785f.svg";import{jsx as Y6} from"preact/jsx-runtime";function p8({playing:m,onPlay:s,onStop:C}){const{getText:a}=t3();return Y6("div",{className:N6.toolbarWrapper,children:Y6("div",{className:N6.toolbarButtonsGroup,children:[Y6("img",{className:C5(N6.greenFlag,{[N6.actived]:m}),src:P5,title:a("tankwar.player.greenFlag","Go"),onClick:s}),Y6("img",{className:C5(N6.stopAll,{[N6.actived]:m}),src:r5,title:a("tankwar.player.stopAll","Stop"),onClick:C})]})})}x6(".DBk_Fa_stage-wrapper{position:relative}.DBk_Fa_stage{border:1px solid var(--ui-black-transparent);border-radius:var(--space);background:var(--ui-white);width:482px;height:482px;position:relative;overflow:hidden}");var y8={stageWrapper:"DBk_Fa_stage-wrapper",stage:"DBk_Fa_stage"};import{jsx as Z6} from"preact/jsx-runtime";function l8({playing:m,enemies:s,enemiesAI:C,onChangePlaying:a,onChangeHealth:D}){const F=()=>a(!0),T=()=>a(!1);return Z6("div",{className:y8.stageWrapper,children:[Z6(p8,{playing:m,onPlay:F,onStop:T}),Z6("div",{className:n3(y8.stage),children:Z6(j5,{playing:m,enemies:s,enemiesAI:C,onRequestStop:T,onChangeHealth:D})})]})}import{useLocale as w3,useEditor as x3} from"@blockcode/core";import{classNames as s6,Text as D6,Button as P6,Label as S6,BufferedInput as s3,ComingSoon as d3} from"@blockcode/ui";x6('.aNtQEq_stage-info-wrapper{margin-top:var(--space);background:var(--ui-white);color:var(--text-primary);border-radius:var(--space);border:1px solid var(--ui-black-transparent);padding:1rem}.aNtQEq_row{justify-content:space-between;margin-top:.5rem;display:flex}.aNtQEq_row-primary{margin-top:0}.aNtQEq_group{flex-direction:row;align-items:center;display:inline-flex}.aNtQEq_full-input{flex:1}.aNtQEq_name-input{width:8rem}.aNtQEq_button{min-width:calc(2rem + 2px);height:calc(2rem + 2px);padding:.375rem!important}.aNtQEq_button-icon{margin:auto}.aNtQEq_space{margin-left:.2rem}.aNtQEq_toolbar-button-group{display:flex}.aNtQEq_group-button-first{border-top-right-radius:0;border-bottom-right-radius:0}.aNtQEq_group-button{border-left:none;border-radius:0}.aNtQEq_group-button-last{border-left:none;border-top-left-radius:0;border-bottom-left-radius:0}.aNtQEq_button-text{flex:auto}.aNtQEq_group-button-toggled-on .aNtQEq_button-text{color:#4c97ff}.aNtQEq_tank-image{width:1.65rem}.aNtQEq_health-progress{background:#f5f5f5;border-radius:10px;width:12rem;height:20px}.aNtQEq_health-progress:before{counter-reset:progress var(--percent,0);content:counter(progress)"%\u2002";width:calc(12rem*var(--percent,0)/100);color:var(--ui-white);text-align:right;white-space:nowrap;background:#ff6680;border-radius:10px;height:20px;font-size:12px;line-height:20px;display:block;overflow:hidden}');var w0={buttonIcon:"aNtQEq_button-icon",groupButtonFirst:"aNtQEq_group-button-first",stageInfoWrapper:"aNtQEq_stage-info-wrapper",tankImage:"aNtQEq_tank-image",nameInput:"aNtQEq_name-input",rowPrimary:"aNtQEq_row-primary",fullInput:"aNtQEq_full-input",buttonText:"aNtQEq_button-text",button:"aNtQEq_button",groupButtonToggledOn:"aNtQEq_group-button-toggled-on",group:"aNtQEq_group",healthProgress:"aNtQEq_health-progress",row:"aNtQEq_row",groupButton:"aNtQEq_group-button",toolbarButtonGroup:"aNtQEq_toolbar-button-group",groupButtonLast:"aNtQEq_group-button-last",space:"aNtQEq_space"};var b5="./assets/tank-2-95f1944eace1f71a.png";var N5="./assets/tank-3-fc6d9534c6d7bba5.png";var S5="./assets/tank-4-79e2f163c902d864.png";import{jsx as y0} from"preact/jsx-runtime";var p3=[b5,N5,S5];function j8({playing:m,enemies:s,enemiesAI:C,health:a,onChangeEnemies:D,onChangeEnemyAI:F}){const{getText:T}=w3(),{fileList:k,modifyFile:$}=x3(),U=k[0],I0=(t0,p0)=>{$({[t0]:p0})};return y0("div",{className:w0.stageInfoWrapper,children:[y0("div",{className:s6(w0.row,w0.rowPrimary),children:[y0(S6,{text:T("tankwar.stageInfo.player","Player"),children:y0(s3,{disabled:m,className:w0.nameInput,placeholder:T("tankwar.stageInfo.nickname","Nickname"),onSubmit:(t0)=>I0("name",t0),value:U.name})}),y0(S6,{secondary:!0,className:w0.health,text:T("tankwar.stageInfo.health","Health"),children:y0("div",{className:w0.healthProgress,style:`--percent:${a.player||0}`})})]}),y0("div",{className:w0.row,children:[y0(S6,{secondary:!0,text:T("tankwar.stageInfo.enemies","Enemies"),children:[y0(P6,{disabled:m,className:s6(w0.button,w0.groupButtonFirst,{[w0.groupButtonToggledOn]:s===1}),onClick:()=>D(1),children:y0("div",{className:w0.buttonText,children:"1"})}),y0(P6,{disabled:m,className:s6(w0.button,w0.groupButton,{[w0.groupButtonToggledOn]:s===2}),onClick:()=>D(2),children:y0("div",{className:w0.buttonText,children:"2"})}),y0(P6,{disabled:m,className:s6(w0.button,w0.groupButtonLast,{[w0.groupButtonToggledOn]:s===3}),onClick:()=>D(3),children:y0("div",{className:w0.buttonText,children:"3"})})]}),y0(S6,{secondary:!0,children:[y0(P6,{disabled:m,className:s6(w0.button,w0.groupButtonFirst,{[w0.groupButtonToggledOn]:!0}),onClick:()=>D(1),children:y0("div",{className:w0.buttonText,children:y0(D6,{id:"tankwar.stageInfo.mode.local",defaultMessage:"Local AI"})})}),y0(d3,{placement:"bottom",children:y0(P6,{disabled:m,className:s6(w0.button,w0.groupButtonLast,{[w0.groupButtonToggledOn]:!1}),children:y0("div",{className:w0.buttonText,children:y0(D6,{id:"tankwar.stageInfo.mode.remote",defaultMessage:"Remote Players"})})})})]})]}),["red","yellow","green"].slice(0,s).map((t0,p0)=>y0("div",{className:w0.row,children:[y0(S6,{secondary:!0,children:y0("img",{className:w0.tankImage,src:p3[p0],alt:T(`tankwar.stageInfo.enemy.${t0}`,t0.replace(t0[0],t0[0].toUpperCase())),title:T(`tankwar.stageInfo.enemy.${t0}`,t0.replace(t0[0],t0[0].toUpperCase()))})}),y0(S6,{secondary:!0,children:y0("div",{className:w0.healthProgress,style:`--percent:${a[t0]||0}`})}),y0(S6,{secondary:!0,text:T("tankwar.stageInfo.ai","AI"),children:[y0(P6,{disabled:m,className:s6(w0.button,w0.groupButtonFirst,{[w0.groupButtonToggledOn]:C[t0]==="simple"}),onClick:()=>F(t0,"simple"),children:y0("div",{className:w0.buttonText,children:y0(D6,{id:"tankwar.stageInfo.ai.simple",defaultMessage:"Simple"})})}),y0(P6,{disabled:m,className:s6(w0.button,w0.groupButton,{[w0.groupButtonToggledOn]:C[t0]==="medium"}),onClick:()=>F(t0,"medium"),children:y0("div",{className:w0.buttonText,children:y0(D6,{id:"tankwar.stageInfo.ai.medium",defaultMessage:"Medium"})})}),y0(P6,{disabled:m,className:s6(w0.button,w0.groupButtonLast,{[w0.groupButtonToggledOn]:C[t0]==="senior"}),onClick:()=>F(t0,"senior"),children:y0("div",{className:w0.buttonText,children:y0(D6,{id:"tankwar.stageInfo.ai.senior",defaultMessage:"Senior"})})})]})]},p0))]})}x6(".DWfD8W_sidebar-wrapper{flex-direction:column;height:100%;display:flex}.DWfD8W_stage-wrapper{display:flex}.DWfD8W_selector-wrapper{margin-top:var(--space);flex-direction:row;height:100%;display:flex}");var P8={sidebarWrapper:"DWfD8W_sidebar-wrapper",stageWrapper:"DWfD8W_stage-wrapper",selectorWrapper:"DWfD8W_selector-wrapper"};import{jsx as r8} from"preact/jsx-runtime";function C8(){const[m,s]=W6(!1),[C,a]=W6(2),[D,F]=W6({red:"simple",yellow:"medium",green:"senior"}),[T,k]=W6({player:100,red:100,yellow:100,green:100});return r8("div",{className:P8.sidebarWrapper,children:[r8(l8,{className:P8.stageWrapper,playing:m,enemies:C,enemiesAI:D,onChangePlaying:s,onChangeHealth:k}),r8(j8,{playing:m,enemies:C,enemiesAI:D,health:T,onChangeEnemies:a,onChangeEnemyAI:($,U)=>F({...D,[$]:U})})]})}function b8(){return{fileList:[{id:"player",name:"player"}]}}var I5={"tankwar.player.greenFlag":"Go","tankwar.player.stopAll":"Stop","tankwar.stageInfo.player":"Player","tankwar.stageInfo.nickname":"Nickname","tankwar.stageInfo.enemies":"Enemies","tankwar.stageInfo.health":"Health","tankwar.stageInfo.enemy.red":"Red","tankwar.stageInfo.enemy.yellow":"Yellow","tankwar.stageInfo.enemy.green":"Green","tankwar.stageInfo.mode.local":"Local AI","tankwar.stageInfo.mode.remote":"Remote Players","tankwar.stageInfo.ai":"AI","tankwar.stageInfo.ai.simple":"Simple","tankwar.stageInfo.ai.medium":"Medium","tankwar.stageInfo.ai.senior":"Senior","tankwar.blocks.motion_attack":"fire in direction %1 at %2 steps","tankwar.blocks.motion_move":"forward in direction %1 at %2 % speed","tankwar.blocks.motion_setspeed":"set speed to %1 %","tankwar.blocks.motion_stop":"stop","tankwar.blocks.motion_speed":"speed","tankwar.blocks.sensing_scanwidth":"set scan width to %1","tankwar.blocks.sensing_scan":"scan for enemy in direction %1?","tankwar.blocks.sensing_distance":"measure distance of enemy in direction %1","tankwar.blocks.sensing_health":"health"};var o5={"tankwar.player.greenFlag":"\u8FD0\u884C","tankwar.player.stopAll":"\u505C\u6B62","tankwar.stageInfo.player":"\u73A9\u5BB6","tankwar.stageInfo.nickname":"\u6635\u79F0","tankwar.stageInfo.enemies":"\u654C\u65B9\u6570\u91CF","tankwar.stageInfo.health":"\u751F\u547D\u503C","tankwar.stageInfo.enemy.red":"\u7EA2","tankwar.stageInfo.enemy.yellow":"\u9EC4","tankwar.stageInfo.enemy.green":"\u7EFF","tankwar.stageInfo.mode.local":"\u672C\u673A AI","tankwar.stageInfo.mode.remote":"\u8054\u7F51\u73A9\u5BB6","tankwar.stageInfo.ai":"AI \u7B56\u7565","tankwar.stageInfo.ai.simple":"\u7B80\u5355","tankwar.stageInfo.ai.medium":"\u4E2D\u7B49","tankwar.stageInfo.ai.senior":"\u9AD8\u7EA7","tankwar.blocks.motion_attack":"\u671D\u5411 %1 \u65B9\u5411\u8DDD\u79BB %2 \u6B65\u53D1\u5C04\u70AE\u5F39","tankwar.blocks.motion_move":"\u4EE5 %2 % \u901F\u5EA6\u9762\u5411 %1 \u65B9\u5411\u524D\u8FDB","tankwar.blocks.motion_setspeed":"\u5C06\u901F\u5EA6\u8BBE\u4E3A %1 %","tankwar.blocks.motion_stop":"\u505C\u6B62\u524D\u8FDB","tankwar.blocks.motion_speed":"\u901F\u5EA6","tankwar.blocks.sensing_scanwidth":"\u5C06\u96F7\u8FBE\u626B\u63CF\u5BBD\u5EA6\u8BBE\u4E3A %1","tankwar.blocks.sensing_scan":"\u96F7\u8FBE\u626B\u63CF %1 \u65B9\u5411\u6709\u654C\u4EBA\uFF1F","tankwar.blocks.sensing_distance":"\u96F7\u8FBE\u6D4B\u91CF %1 \u65B9\u5411\u654C\u4EBA\u7684\u8DDD\u79BB","tankwar.blocks.sensing_health":"\u751F\u547D\u503C"};function y3({addLocaleData:m,getText:s,setLayout:C,openStoreLibrary:a,closeStoreLibrary:D,setPrompt:F,setAlert:T,removeAlert:k,openProject:$}){m(E8),m({en:I5,"zh-Hans":o5});const U=()=>{$(Object.assign(b8(s),{selectedIndex:0}))};U(),C({menus:a8({openStoreLibrary:a,closeStoreLibrary:D,newProject:U,setPrompt:F,setAlert:T,removeAlert:k,extendsMenu:[{id:"device",hidden:!0}]}),tabs:[{...q6,Content:s8}],sidebars:[{expand:"right",Content:C8}],pane:!1,tutorials:!0,canEditProjectName:!0})}export{y3 as default};
