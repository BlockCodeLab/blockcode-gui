var c1=Object.create;var{defineProperty:R1,getPrototypeOf:d1,getOwnPropertyNames:l1}=Object;var a1=Object.prototype.hasOwnProperty;var K0=(y,x,j)=>{j=y!=null?c1(d1(y)):{};const c=x||!y||!y.__esModule?R1(j,"default",{value:y,enumerable:!0}):j;for(let U of l1(y))if(!a1.call(c,U))R1(c,U,{get:()=>y[U],enumerable:!0});return c};var u0=(y,x)=>()=>(x||y((x={exports:{}}).exports,x),x.exports);var E1=u0((P0,N0)=>{(function(y,x){if(typeof P0=="object"&&typeof N0=="object")N0.exports=x();else if(typeof define=="function"&&define.amd)define([],x);else{var j=x();for(var c in j)(typeof P0=="object"?P0:y)[c]=j[c]}})(self,()=>(()=>{var y={4567:function(U,g,b){var H=this&&this.__decorate||function(S,f,O,M){var m,A=arguments.length,Z=A<3?f:M===null?M=Object.getOwnPropertyDescriptor(f,O):M;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")Z=Reflect.decorate(S,f,O,M);else for(var F=S.length-1;F>=0;F--)(m=S[F])&&(Z=(A<3?m(Z):A>3?m(f,O,Z):m(f,O))||Z);return A>3&&Z&&Object.defineProperty(f,O,Z),Z},h=this&&this.__param||function(S,f){return function(O,M){f(O,M,S)}};Object.defineProperty(g,"__esModule",{value:!0}),g.AccessibilityManager=void 0;const E=b(9042),D=b(6114),p=b(9924),B=b(844),R=b(5596),v=b(4725),L=b(3656);let C=g.AccessibilityManager=class extends B.Disposable{constructor(S,f){super(),this._terminal=S,this._renderService=f,this._liveRegionLineCount=0,this._charsToConsume=[],this._charsToAnnounce="",this._accessibilityContainer=document.createElement("div"),this._accessibilityContainer.classList.add("xterm-accessibility"),this._rowContainer=document.createElement("div"),this._rowContainer.setAttribute("role","list"),this._rowContainer.classList.add("xterm-accessibility-tree"),this._rowElements=[];for(let O=0;O<this._terminal.rows;O++)this._rowElements[O]=this._createAccessibilityTreeNode(),this._rowContainer.appendChild(this._rowElements[O]);if(this._topBoundaryFocusListener=(O)=>this._handleBoundaryFocus(O,0),this._bottomBoundaryFocusListener=(O)=>this._handleBoundaryFocus(O,1),this._rowElements[0].addEventListener("focus",this._topBoundaryFocusListener),this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._refreshRowsDimensions(),this._accessibilityContainer.appendChild(this._rowContainer),this._liveRegion=document.createElement("div"),this._liveRegion.classList.add("live-region"),this._liveRegion.setAttribute("aria-live","assertive"),this._accessibilityContainer.appendChild(this._liveRegion),this._liveRegionDebouncer=this.register(new p.TimeBasedDebouncer(this._renderRows.bind(this))),!this._terminal.element)throw new Error("Cannot enable accessibility before Terminal.open");this._terminal.element.insertAdjacentElement("afterbegin",this._accessibilityContainer),this.register(this._terminal.onResize((O)=>this._handleResize(O.rows))),this.register(this._terminal.onRender((O)=>this._refreshRows(O.start,O.end))),this.register(this._terminal.onScroll(()=>this._refreshRows())),this.register(this._terminal.onA11yChar((O)=>this._handleChar(O))),this.register(this._terminal.onLineFeed(()=>this._handleChar("\n"))),this.register(this._terminal.onA11yTab((O)=>this._handleTab(O))),this.register(this._terminal.onKey((O)=>this._handleKey(O.key))),this.register(this._terminal.onBlur(()=>this._clearLiveRegion())),this.register(this._renderService.onDimensionsChange(()=>this._refreshRowsDimensions())),this._screenDprMonitor=new R.ScreenDprMonitor(window),this.register(this._screenDprMonitor),this._screenDprMonitor.setListener(()=>this._refreshRowsDimensions()),this.register(L.addDisposableDomListener(window,"resize",()=>this._refreshRowsDimensions())),this._refreshRows(),this.register(B.toDisposable(()=>{this._accessibilityContainer.remove(),this._rowElements.length=0}))}_handleTab(S){for(let f=0;f<S;f++)this._handleChar(" ")}_handleChar(S){this._liveRegionLineCount<21&&(this._charsToConsume.length>0?this._charsToConsume.shift()!==S&&(this._charsToAnnounce+=S):this._charsToAnnounce+=S,S==="\n"&&(this._liveRegionLineCount++,this._liveRegionLineCount===21&&(this._liveRegion.textContent+=E.tooMuchOutput)),D.isMac&&this._liveRegion.textContent&&this._liveRegion.textContent.length>0&&!this._liveRegion.parentNode&&setTimeout(()=>{this._accessibilityContainer.appendChild(this._liveRegion)},0))}_clearLiveRegion(){this._liveRegion.textContent="",this._liveRegionLineCount=0,D.isMac&&this._liveRegion.remove()}_handleKey(S){this._clearLiveRegion(),/\p{Control}/u.test(S)||this._charsToConsume.push(S)}_refreshRows(S,f){this._liveRegionDebouncer.refresh(S,f,this._terminal.rows)}_renderRows(S,f){const O=this._terminal.buffer,M=O.lines.length.toString();for(let m=S;m<=f;m++){const A=O.translateBufferLineToString(O.ydisp+m,!0),Z=(O.ydisp+m+1).toString(),F=this._rowElements[m];F&&(A.length===0?F.innerText="\xA0":F.textContent=A,F.setAttribute("aria-posinset",Z),F.setAttribute("aria-setsize",M))}this._announceCharacters()}_announceCharacters(){this._charsToAnnounce.length!==0&&(this._liveRegion.textContent+=this._charsToAnnounce,this._charsToAnnounce="")}_handleBoundaryFocus(S,f){const O=S.target,M=this._rowElements[f===0?1:this._rowElements.length-2];if(O.getAttribute("aria-posinset")===(f===0?"1":`${this._terminal.buffer.lines.length}`))return;if(S.relatedTarget!==M)return;let m,A;if(f===0?(m=O,A=this._rowElements.pop(),this._rowContainer.removeChild(A)):(m=this._rowElements.shift(),A=O,this._rowContainer.removeChild(m)),m.removeEventListener("focus",this._topBoundaryFocusListener),A.removeEventListener("focus",this._bottomBoundaryFocusListener),f===0){const Z=this._createAccessibilityTreeNode();this._rowElements.unshift(Z),this._rowContainer.insertAdjacentElement("afterbegin",Z)}else{const Z=this._createAccessibilityTreeNode();this._rowElements.push(Z),this._rowContainer.appendChild(Z)}this._rowElements[0].addEventListener("focus",this._topBoundaryFocusListener),this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._terminal.scrollLines(f===0?-1:1),this._rowElements[f===0?1:this._rowElements.length-2].focus(),S.preventDefault(),S.stopImmediatePropagation()}_handleResize(S){this._rowElements[this._rowElements.length-1].removeEventListener("focus",this._bottomBoundaryFocusListener);for(let f=this._rowContainer.children.length;f<this._terminal.rows;f++)this._rowElements[f]=this._createAccessibilityTreeNode(),this._rowContainer.appendChild(this._rowElements[f]);for(;this._rowElements.length>S;)this._rowContainer.removeChild(this._rowElements.pop());this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._refreshRowsDimensions()}_createAccessibilityTreeNode(){const S=document.createElement("div");return S.setAttribute("role","listitem"),S.tabIndex=-1,this._refreshRowDimensions(S),S}_refreshRowsDimensions(){if(this._renderService.dimensions.css.cell.height){this._accessibilityContainer.style.width=`${this._renderService.dimensions.css.canvas.width}px`,this._rowElements.length!==this._terminal.rows&&this._handleResize(this._terminal.rows);for(let S=0;S<this._terminal.rows;S++)this._refreshRowDimensions(this._rowElements[S])}}_refreshRowDimensions(S){S.style.height=`${this._renderService.dimensions.css.cell.height}px`}};g.AccessibilityManager=C=H([h(1,v.IRenderService)],C)},3614:(U,g)=>{function b(D){return D.replace(/\r?\n/g,"\r")}function H(D,p){return p?"[200~"+D+"[201~":D}function h(D,p,B,R){D=H(D=b(D),B.decPrivateModes.bracketedPasteMode&&R.rawOptions.ignoreBracketedPasteMode!==!0),B.triggerDataEvent(D,!0),p.value=""}function E(D,p,B){const R=B.getBoundingClientRect(),v=D.clientX-R.left-10,L=D.clientY-R.top-10;p.style.width="20px",p.style.height="20px",p.style.left=`${v}px`,p.style.top=`${L}px`,p.style.zIndex="1000",p.focus()}Object.defineProperty(g,"__esModule",{value:!0}),g.rightClickHandler=g.moveTextAreaUnderMouseCursor=g.paste=g.handlePasteEvent=g.copyHandler=g.bracketTextForPaste=g.prepareTextForTerminal=void 0,g.prepareTextForTerminal=b,g.bracketTextForPaste=H,g.copyHandler=function(D,p){D.clipboardData&&D.clipboardData.setData("text/plain",p.selectionText),D.preventDefault()},g.handlePasteEvent=function(D,p,B,R){D.stopPropagation(),D.clipboardData&&h(D.clipboardData.getData("text/plain"),p,B,R)},g.paste=h,g.moveTextAreaUnderMouseCursor=E,g.rightClickHandler=function(D,p,B,R,v){E(D,p,B),v&&R.rightClickSelect(D),p.value=R.selectionText,p.select()}},7239:(U,g,b)=>{Object.defineProperty(g,"__esModule",{value:!0}),g.ColorContrastCache=void 0;const H=b(1505);g.ColorContrastCache=class{constructor(){this._color=new H.TwoKeyMap,this._css=new H.TwoKeyMap}setCss(h,E,D){this._css.set(h,E,D)}getCss(h,E){return this._css.get(h,E)}setColor(h,E,D){this._color.set(h,E,D)}getColor(h,E){return this._color.get(h,E)}clear(){this._color.clear(),this._css.clear()}}},3656:(U,g)=>{Object.defineProperty(g,"__esModule",{value:!0}),g.addDisposableDomListener=void 0,g.addDisposableDomListener=function(b,H,h,E){b.addEventListener(H,h,E);let D=!1;return{dispose:()=>{D||(D=!0,b.removeEventListener(H,h,E))}}}},6465:function(U,g,b){var H=this&&this.__decorate||function(v,L,C,S){var f,O=arguments.length,M=O<3?L:S===null?S=Object.getOwnPropertyDescriptor(L,C):S;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")M=Reflect.decorate(v,L,C,S);else for(var m=v.length-1;m>=0;m--)(f=v[m])&&(M=(O<3?f(M):O>3?f(L,C,M):f(L,C))||M);return O>3&&M&&Object.defineProperty(L,C,M),M},h=this&&this.__param||function(v,L){return function(C,S){L(C,S,v)}};Object.defineProperty(g,"__esModule",{value:!0}),g.Linkifier2=void 0;const E=b(3656),D=b(8460),p=b(844),B=b(2585);let R=g.Linkifier2=class extends p.Disposable{get currentLink(){return this._currentLink}constructor(v){super(),this._bufferService=v,this._linkProviders=[],this._linkCacheDisposables=[],this._isMouseOut=!0,this._wasResized=!1,this._activeLine=-1,this._onShowLinkUnderline=this.register(new D.EventEmitter),this.onShowLinkUnderline=this._onShowLinkUnderline.event,this._onHideLinkUnderline=this.register(new D.EventEmitter),this.onHideLinkUnderline=this._onHideLinkUnderline.event,this.register(p.getDisposeArrayDisposable(this._linkCacheDisposables)),this.register(p.toDisposable(()=>{this._lastMouseEvent=void 0})),this.register(this._bufferService.onResize(()=>{this._clearCurrentLink(),this._wasResized=!0}))}registerLinkProvider(v){return this._linkProviders.push(v),{dispose:()=>{const L=this._linkProviders.indexOf(v);L!==-1&&this._linkProviders.splice(L,1)}}}attachToDom(v,L,C){this._element=v,this._mouseService=L,this._renderService=C,this.register(E.addDisposableDomListener(this._element,"mouseleave",()=>{this._isMouseOut=!0,this._clearCurrentLink()})),this.register(E.addDisposableDomListener(this._element,"mousemove",this._handleMouseMove.bind(this))),this.register(E.addDisposableDomListener(this._element,"mousedown",this._handleMouseDown.bind(this))),this.register(E.addDisposableDomListener(this._element,"mouseup",this._handleMouseUp.bind(this)))}_handleMouseMove(v){if(this._lastMouseEvent=v,!this._element||!this._mouseService)return;const L=this._positionFromMouseEvent(v,this._element,this._mouseService);if(!L)return;this._isMouseOut=!1;const C=v.composedPath();for(let S=0;S<C.length;S++){const f=C[S];if(f.classList.contains("xterm"))break;if(f.classList.contains("xterm-hover"))return}this._lastBufferCell&&L.x===this._lastBufferCell.x&&L.y===this._lastBufferCell.y||(this._handleHover(L),this._lastBufferCell=L)}_handleHover(v){if(this._activeLine!==v.y||this._wasResized)return this._clearCurrentLink(),this._askForLink(v,!1),void(this._wasResized=!1);this._currentLink&&this._linkAtPosition(this._currentLink.link,v)||(this._clearCurrentLink(),this._askForLink(v,!0))}_askForLink(v,L){var C,S;this._activeProviderReplies&&L||((C=this._activeProviderReplies)===null||C===void 0||C.forEach((O)=>{O==null||O.forEach((M)=>{M.link.dispose&&M.link.dispose()})}),this._activeProviderReplies=new Map,this._activeLine=v.y);let f=!1;for(let[O,M]of this._linkProviders.entries())L?((S=this._activeProviderReplies)===null||S===void 0?void 0:S.get(O))&&(f=this._checkLinkProviderResult(O,v,f)):M.provideLinks(v.y,(m)=>{var A,Z;if(this._isMouseOut)return;const F=m==null?void 0:m.map((W)=>({link:W}));(A=this._activeProviderReplies)===null||A===void 0||A.set(O,F),f=this._checkLinkProviderResult(O,v,f),((Z=this._activeProviderReplies)===null||Z===void 0?void 0:Z.size)===this._linkProviders.length&&this._removeIntersectingLinks(v.y,this._activeProviderReplies)})}_removeIntersectingLinks(v,L){const C=new Set;for(let S=0;S<L.size;S++){const f=L.get(S);if(f)for(let O=0;O<f.length;O++){const M=f[O],m=M.link.range.start.y<v?0:M.link.range.start.x,A=M.link.range.end.y>v?this._bufferService.cols:M.link.range.end.x;for(let Z=m;Z<=A;Z++){if(C.has(Z)){f.splice(O--,1);break}C.add(Z)}}}}_checkLinkProviderResult(v,L,C){var S;if(!this._activeProviderReplies)return C;const f=this._activeProviderReplies.get(v);let O=!1;for(let M=0;M<v;M++)this._activeProviderReplies.has(M)&&!this._activeProviderReplies.get(M)||(O=!0);if(!O&&f){const M=f.find((m)=>this._linkAtPosition(m.link,L));M&&(C=!0,this._handleNewLink(M))}if(this._activeProviderReplies.size===this._linkProviders.length&&!C)for(let M=0;M<this._activeProviderReplies.size;M++){const m=(S=this._activeProviderReplies.get(M))===null||S===void 0?void 0:S.find((A)=>this._linkAtPosition(A.link,L));if(m){C=!0,this._handleNewLink(m);break}}return C}_handleMouseDown(){this._mouseDownLink=this._currentLink}_handleMouseUp(v){if(!this._element||!this._mouseService||!this._currentLink)return;const L=this._positionFromMouseEvent(v,this._element,this._mouseService);L&&this._mouseDownLink===this._currentLink&&this._linkAtPosition(this._currentLink.link,L)&&this._currentLink.link.activate(v,this._currentLink.link.text)}_clearCurrentLink(v,L){this._element&&this._currentLink&&this._lastMouseEvent&&(!v||!L||this._currentLink.link.range.start.y>=v&&this._currentLink.link.range.end.y<=L)&&(this._linkLeave(this._element,this._currentLink.link,this._lastMouseEvent),this._currentLink=void 0,p.disposeArray(this._linkCacheDisposables))}_handleNewLink(v){if(!this._element||!this._lastMouseEvent||!this._mouseService)return;const L=this._positionFromMouseEvent(this._lastMouseEvent,this._element,this._mouseService);L&&this._linkAtPosition(v.link,L)&&(this._currentLink=v,this._currentLink.state={decorations:{underline:v.link.decorations===void 0||v.link.decorations.underline,pointerCursor:v.link.decorations===void 0||v.link.decorations.pointerCursor},isHovered:!0},this._linkHover(this._element,v.link,this._lastMouseEvent),v.link.decorations={},Object.defineProperties(v.link.decorations,{pointerCursor:{get:()=>{var C,S;return(S=(C=this._currentLink)===null||C===void 0?void 0:C.state)===null||S===void 0?void 0:S.decorations.pointerCursor},set:(C)=>{var S,f;((S=this._currentLink)===null||S===void 0?void 0:S.state)&&this._currentLink.state.decorations.pointerCursor!==C&&(this._currentLink.state.decorations.pointerCursor=C,this._currentLink.state.isHovered&&((f=this._element)===null||f===void 0||f.classList.toggle("xterm-cursor-pointer",C)))}},underline:{get:()=>{var C,S;return(S=(C=this._currentLink)===null||C===void 0?void 0:C.state)===null||S===void 0?void 0:S.decorations.underline},set:(C)=>{var S,f,O;((S=this._currentLink)===null||S===void 0?void 0:S.state)&&((O=(f=this._currentLink)===null||f===void 0?void 0:f.state)===null||O===void 0?void 0:O.decorations.underline)!==C&&(this._currentLink.state.decorations.underline=C,this._currentLink.state.isHovered&&this._fireUnderlineEvent(v.link,C))}}}),this._renderService&&this._linkCacheDisposables.push(this._renderService.onRenderedViewportChange((C)=>{if(!this._currentLink)return;const S=C.start===0?0:C.start+1+this._bufferService.buffer.ydisp,f=this._bufferService.buffer.ydisp+1+C.end;if(this._currentLink.link.range.start.y>=S&&this._currentLink.link.range.end.y<=f&&(this._clearCurrentLink(S,f),this._lastMouseEvent&&this._element)){const O=this._positionFromMouseEvent(this._lastMouseEvent,this._element,this._mouseService);O&&this._askForLink(O,!1)}})))}_linkHover(v,L,C){var S;((S=this._currentLink)===null||S===void 0?void 0:S.state)&&(this._currentLink.state.isHovered=!0,this._currentLink.state.decorations.underline&&this._fireUnderlineEvent(L,!0),this._currentLink.state.decorations.pointerCursor&&v.classList.add("xterm-cursor-pointer")),L.hover&&L.hover(C,L.text)}_fireUnderlineEvent(v,L){const C=v.range,S=this._bufferService.buffer.ydisp,f=this._createLinkUnderlineEvent(C.start.x-1,C.start.y-S-1,C.end.x,C.end.y-S-1,void 0);(L?this._onShowLinkUnderline:this._onHideLinkUnderline).fire(f)}_linkLeave(v,L,C){var S;((S=this._currentLink)===null||S===void 0?void 0:S.state)&&(this._currentLink.state.isHovered=!1,this._currentLink.state.decorations.underline&&this._fireUnderlineEvent(L,!1),this._currentLink.state.decorations.pointerCursor&&v.classList.remove("xterm-cursor-pointer")),L.leave&&L.leave(C,L.text)}_linkAtPosition(v,L){const C=v.range.start.y*this._bufferService.cols+v.range.start.x,S=v.range.end.y*this._bufferService.cols+v.range.end.x,f=L.y*this._bufferService.cols+L.x;return C<=f&&f<=S}_positionFromMouseEvent(v,L,C){const S=C.getCoords(v,L,this._bufferService.cols,this._bufferService.rows);if(S)return{x:S[0],y:S[1]+this._bufferService.buffer.ydisp}}_createLinkUnderlineEvent(v,L,C,S,f){return{x1:v,y1:L,x2:C,y2:S,cols:this._bufferService.cols,fg:f}}};g.Linkifier2=R=H([h(0,B.IBufferService)],R)},9042:(U,g)=>{Object.defineProperty(g,"__esModule",{value:!0}),g.tooMuchOutput=g.promptLabel=void 0,g.promptLabel="Terminal input",g.tooMuchOutput="Too much output to announce, navigate to rows manually to read"},3730:function(U,g,b){var H=this&&this.__decorate||function(R,v,L,C){var S,f=arguments.length,O=f<3?v:C===null?C=Object.getOwnPropertyDescriptor(v,L):C;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")O=Reflect.decorate(R,v,L,C);else for(var M=R.length-1;M>=0;M--)(S=R[M])&&(O=(f<3?S(O):f>3?S(v,L,O):S(v,L))||O);return f>3&&O&&Object.defineProperty(v,L,O),O},h=this&&this.__param||function(R,v){return function(L,C){v(L,C,R)}};Object.defineProperty(g,"__esModule",{value:!0}),g.OscLinkProvider=void 0;const E=b(511),D=b(2585);let p=g.OscLinkProvider=class{constructor(R,v,L){this._bufferService=R,this._optionsService=v,this._oscLinkService=L}provideLinks(R,v){var L;const C=this._bufferService.buffer.lines.get(R-1);if(!C)return void v(void 0);const S=[],f=this._optionsService.rawOptions.linkHandler,O=new E.CellData,M=C.getTrimmedLength();let m=-1,A=-1,Z=!1;for(let F=0;F<M;F++)if(A!==-1||C.hasContent(F)){if(C.loadCell(F,O),O.hasExtendedAttrs()&&O.extended.urlId){if(A===-1){A=F,m=O.extended.urlId;continue}Z=O.extended.urlId!==m}else A!==-1&&(Z=!0);if(Z||A!==-1&&F===M-1){const W=(L=this._oscLinkService.getLinkData(m))===null||L===void 0?void 0:L.uri;if(W){const P={start:{x:A+1,y:R},end:{x:F+(Z||F!==M-1?0:1),y:R}};let k=!1;if(!(f==null?void 0:f.allowNonHttpProtocols))try{const Q=new URL(W);["http:","https:"].includes(Q.protocol)||(k=!0)}catch(Q){k=!0}k||S.push({text:W,range:P,activate:(Q,V)=>f?f.activate(Q,V,P):B(0,V),hover:(Q,V)=>{var K;return(K=f==null?void 0:f.hover)===null||K===void 0?void 0:K.call(f,Q,V,P)},leave:(Q,V)=>{var K;return(K=f==null?void 0:f.leave)===null||K===void 0?void 0:K.call(f,Q,V,P)}})}Z=!1,O.hasExtendedAttrs()&&O.extended.urlId?(A=F,m=O.extended.urlId):(A=-1,m=-1)}}v(S)}};function B(R,v){if(confirm(`Do you want to navigate to ${v}?\n\nWARNING: This link could potentially be dangerous`)){const L=window.open();if(L){try{L.opener=null}catch(C){}L.location.href=v}else console.warn("Opening link blocked as opener could not be cleared")}}g.OscLinkProvider=p=H([h(0,D.IBufferService),h(1,D.IOptionsService),h(2,D.IOscLinkService)],p)},6193:(U,g)=>{Object.defineProperty(g,"__esModule",{value:!0}),g.RenderDebouncer=void 0,g.RenderDebouncer=class{constructor(b,H){this._parentWindow=b,this._renderCallback=H,this._refreshCallbacks=[]}dispose(){this._animationFrame&&(this._parentWindow.cancelAnimationFrame(this._animationFrame),this._animationFrame=void 0)}addRefreshCallback(b){return this._refreshCallbacks.push(b),this._animationFrame||(this._animationFrame=this._parentWindow.requestAnimationFrame(()=>this._innerRefresh())),this._animationFrame}refresh(b,H,h){this._rowCount=h,b=b!==void 0?b:0,H=H!==void 0?H:this._rowCount-1,this._rowStart=this._rowStart!==void 0?Math.min(this._rowStart,b):b,this._rowEnd=this._rowEnd!==void 0?Math.max(this._rowEnd,H):H,this._animationFrame||(this._animationFrame=this._parentWindow.requestAnimationFrame(()=>this._innerRefresh()))}_innerRefresh(){if(this._animationFrame=void 0,this._rowStart===void 0||this._rowEnd===void 0||this._rowCount===void 0)return void this._runRefreshCallbacks();const b=Math.max(this._rowStart,0),H=Math.min(this._rowEnd,this._rowCount-1);this._rowStart=void 0,this._rowEnd=void 0,this._renderCallback(b,H),this._runRefreshCallbacks()}_runRefreshCallbacks(){for(let b of this._refreshCallbacks)b(0);this._refreshCallbacks=[]}}},5596:(U,g,b)=>{Object.defineProperty(g,"__esModule",{value:!0}),g.ScreenDprMonitor=void 0;const H=b(844);class h extends H.Disposable{constructor(E){super(),this._parentWindow=E,this._currentDevicePixelRatio=this._parentWindow.devicePixelRatio,this.register(H.toDisposable(()=>{this.clearListener()}))}setListener(E){this._listener&&this.clearListener(),this._listener=E,this._outerListener=()=>{this._listener&&(this._listener(this._parentWindow.devicePixelRatio,this._currentDevicePixelRatio),this._updateDpr())},this._updateDpr()}_updateDpr(){var E;this._outerListener&&((E=this._resolutionMediaMatchList)===null||E===void 0||E.removeListener(this._outerListener),this._currentDevicePixelRatio=this._parentWindow.devicePixelRatio,this._resolutionMediaMatchList=this._parentWindow.matchMedia(`screen and (resolution: ${this._parentWindow.devicePixelRatio}dppx)`),this._resolutionMediaMatchList.addListener(this._outerListener))}clearListener(){this._resolutionMediaMatchList&&this._listener&&this._outerListener&&(this._resolutionMediaMatchList.removeListener(this._outerListener),this._resolutionMediaMatchList=void 0,this._listener=void 0,this._outerListener=void 0)}}g.ScreenDprMonitor=h},3236:(U,g,b)=>{Object.defineProperty(g,"__esModule",{value:!0}),g.Terminal=void 0;const H=b(3614),h=b(3656),E=b(6465),D=b(9042),p=b(3730),B=b(1680),R=b(3107),v=b(5744),L=b(2950),C=b(1296),S=b(428),f=b(4269),O=b(5114),M=b(8934),m=b(3230),A=b(9312),Z=b(4725),F=b(6731),W=b(8055),P=b(8969),k=b(8460),Q=b(844),V=b(6114),K=b(8437),T=b(2584),Y=b(7399),J=b(5941),_=b(9074),N=b(2585),I=b(5435),$=b(4567),w=typeof window!="undefined"?window.document:null;class d extends P.CoreTerminal{get onFocus(){return this._onFocus.event}get onBlur(){return this._onBlur.event}get onA11yChar(){return this._onA11yCharEmitter.event}get onA11yTab(){return this._onA11yTabEmitter.event}get onWillOpen(){return this._onWillOpen.event}constructor(X={}){super(X),this.browser=V,this._keyDownHandled=!1,this._keyDownSeen=!1,this._keyPressHandled=!1,this._unprocessedDeadKey=!1,this._accessibilityManager=this.register(new Q.MutableDisposable),this._onCursorMove=this.register(new k.EventEmitter),this.onCursorMove=this._onCursorMove.event,this._onKey=this.register(new k.EventEmitter),this.onKey=this._onKey.event,this._onRender=this.register(new k.EventEmitter),this.onRender=this._onRender.event,this._onSelectionChange=this.register(new k.EventEmitter),this.onSelectionChange=this._onSelectionChange.event,this._onTitleChange=this.register(new k.EventEmitter),this.onTitleChange=this._onTitleChange.event,this._onBell=this.register(new k.EventEmitter),this.onBell=this._onBell.event,this._onFocus=this.register(new k.EventEmitter),this._onBlur=this.register(new k.EventEmitter),this._onA11yCharEmitter=this.register(new k.EventEmitter),this._onA11yTabEmitter=this.register(new k.EventEmitter),this._onWillOpen=this.register(new k.EventEmitter),this._setup(),this.linkifier2=this.register(this._instantiationService.createInstance(E.Linkifier2)),this.linkifier2.registerLinkProvider(this._instantiationService.createInstance(p.OscLinkProvider)),this._decorationService=this._instantiationService.createInstance(_.DecorationService),this._instantiationService.setService(N.IDecorationService,this._decorationService),this.register(this._inputHandler.onRequestBell(()=>this._onBell.fire())),this.register(this._inputHandler.onRequestRefreshRows((u,G)=>this.refresh(u,G))),this.register(this._inputHandler.onRequestSendFocus(()=>this._reportFocus())),this.register(this._inputHandler.onRequestReset(()=>this.reset())),this.register(this._inputHandler.onRequestWindowsOptionsReport((u)=>this._reportWindowsOptions(u))),this.register(this._inputHandler.onColor((u)=>this._handleColorEvent(u))),this.register(k.forwardEvent(this._inputHandler.onCursorMove,this._onCursorMove)),this.register(k.forwardEvent(this._inputHandler.onTitleChange,this._onTitleChange)),this.register(k.forwardEvent(this._inputHandler.onA11yChar,this._onA11yCharEmitter)),this.register(k.forwardEvent(this._inputHandler.onA11yTab,this._onA11yTabEmitter)),this.register(this._bufferService.onResize((u)=>this._afterResize(u.cols,u.rows))),this.register(Q.toDisposable(()=>{var u,G;this._customKeyEventHandler=void 0,(G=(u=this.element)===null||u===void 0?void 0:u.parentNode)===null||G===void 0||G.removeChild(this.element)}))}_handleColorEvent(X){if(this._themeService)for(let u of X){let G,z="";switch(u.index){case 256:G="foreground",z="10";break;case 257:G="background",z="11";break;case 258:G="cursor",z="12";break;default:G="ansi",z="4;"+u.index}switch(u.type){case 0:const r=W.color.toColorRGB(G==="ansi"?this._themeService.colors.ansi[u.index]:this._themeService.colors[G]);this.coreService.triggerDataEvent(`${T.C0.ESC}]${z};${J.toRgbString(r)}${T.C1_ESCAPED.ST}`);break;case 1:if(G==="ansi")this._themeService.modifyColors((q)=>q.ansi[u.index]=W.rgba.toColor(...u.color));else{const q=G;this._themeService.modifyColors((g0)=>g0[q]=W.rgba.toColor(...u.color))}break;case 2:this._themeService.restoreColor(u.index)}}}_setup(){super._setup(),this._customKeyEventHandler=void 0}get buffer(){return this.buffers.active}focus(){this.textarea&&this.textarea.focus({preventScroll:!0})}_handleScreenReaderModeOptionChange(X){X?!this._accessibilityManager.value&&this._renderService&&(this._accessibilityManager.value=this._instantiationService.createInstance($.AccessibilityManager,this)):this._accessibilityManager.clear()}_handleTextAreaFocus(X){this.coreService.decPrivateModes.sendFocus&&this.coreService.triggerDataEvent(T.C0.ESC+"[I"),this.updateCursorStyle(X),this.element.classList.add("focus"),this._showCursor(),this._onFocus.fire()}blur(){var X;return(X=this.textarea)===null||X===void 0?void 0:X.blur()}_handleTextAreaBlur(){this.textarea.value="",this.refresh(this.buffer.y,this.buffer.y),this.coreService.decPrivateModes.sendFocus&&this.coreService.triggerDataEvent(T.C0.ESC+"[O"),this.element.classList.remove("focus"),this._onBlur.fire()}_syncTextArea(){if(!this.textarea||!this.buffer.isCursorInViewport||this._compositionHelper.isComposing||!this._renderService)return;const X=this.buffer.ybase+this.buffer.y,u=this.buffer.lines.get(X);if(!u)return;const G=Math.min(this.buffer.x,this.cols-1),z=this._renderService.dimensions.css.cell.height,r=u.getWidth(G),q=this._renderService.dimensions.css.cell.width*r,g0=this.buffer.y*this._renderService.dimensions.css.cell.height,t=G*this._renderService.dimensions.css.cell.width;this.textarea.style.left=t+"px",this.textarea.style.top=g0+"px",this.textarea.style.width=q+"px",this.textarea.style.height=z+"px",this.textarea.style.lineHeight=z+"px",this.textarea.style.zIndex="-5"}_initGlobal(){this._bindKeys(),this.register(h.addDisposableDomListener(this.element,"copy",(u)=>{this.hasSelection()&&H.copyHandler(u,this._selectionService)}));const X=(u)=>H.handlePasteEvent(u,this.textarea,this.coreService,this.optionsService);this.register(h.addDisposableDomListener(this.textarea,"paste",X)),this.register(h.addDisposableDomListener(this.element,"paste",X)),V.isFirefox?this.register(h.addDisposableDomListener(this.element,"mousedown",(u)=>{u.button===2&&H.rightClickHandler(u,this.textarea,this.screenElement,this._selectionService,this.options.rightClickSelectsWord)})):this.register(h.addDisposableDomListener(this.element,"contextmenu",(u)=>{H.rightClickHandler(u,this.textarea,this.screenElement,this._selectionService,this.options.rightClickSelectsWord)})),V.isLinux&&this.register(h.addDisposableDomListener(this.element,"auxclick",(u)=>{u.button===1&&H.moveTextAreaUnderMouseCursor(u,this.textarea,this.screenElement)}))}_bindKeys(){this.register(h.addDisposableDomListener(this.textarea,"keyup",(X)=>this._keyUp(X),!0)),this.register(h.addDisposableDomListener(this.textarea,"keydown",(X)=>this._keyDown(X),!0)),this.register(h.addDisposableDomListener(this.textarea,"keypress",(X)=>this._keyPress(X),!0)),this.register(h.addDisposableDomListener(this.textarea,"compositionstart",()=>this._compositionHelper.compositionstart())),this.register(h.addDisposableDomListener(this.textarea,"compositionupdate",(X)=>this._compositionHelper.compositionupdate(X))),this.register(h.addDisposableDomListener(this.textarea,"compositionend",()=>this._compositionHelper.compositionend())),this.register(h.addDisposableDomListener(this.textarea,"input",(X)=>this._inputEvent(X),!0)),this.register(this.onRender(()=>this._compositionHelper.updateCompositionElements()))}open(X){var u;if(!X)throw new Error("Terminal requires a parent element.");X.isConnected||this._logService.debug("Terminal.open was called on an element that was not attached to the DOM"),this._document=X.ownerDocument,this.element=this._document.createElement("div"),this.element.dir="ltr",this.element.classList.add("terminal"),this.element.classList.add("xterm"),X.appendChild(this.element);const G=w.createDocumentFragment();this._viewportElement=w.createElement("div"),this._viewportElement.classList.add("xterm-viewport"),G.appendChild(this._viewportElement),this._viewportScrollArea=w.createElement("div"),this._viewportScrollArea.classList.add("xterm-scroll-area"),this._viewportElement.appendChild(this._viewportScrollArea),this.screenElement=w.createElement("div"),this.screenElement.classList.add("xterm-screen"),this._helperContainer=w.createElement("div"),this._helperContainer.classList.add("xterm-helpers"),this.screenElement.appendChild(this._helperContainer),G.appendChild(this.screenElement),this.textarea=w.createElement("textarea"),this.textarea.classList.add("xterm-helper-textarea"),this.textarea.setAttribute("aria-label",D.promptLabel),V.isChromeOS||this.textarea.setAttribute("aria-multiline","false"),this.textarea.setAttribute("autocorrect","off"),this.textarea.setAttribute("autocapitalize","off"),this.textarea.setAttribute("spellcheck","false"),this.textarea.tabIndex=0,this._coreBrowserService=this._instantiationService.createInstance(O.CoreBrowserService,this.textarea,(u=this._document.defaultView)!==null&&u!==void 0?u:window),this._instantiationService.setService(Z.ICoreBrowserService,this._coreBrowserService),this.register(h.addDisposableDomListener(this.textarea,"focus",(z)=>this._handleTextAreaFocus(z))),this.register(h.addDisposableDomListener(this.textarea,"blur",()=>this._handleTextAreaBlur())),this._helperContainer.appendChild(this.textarea),this._charSizeService=this._instantiationService.createInstance(S.CharSizeService,this._document,this._helperContainer),this._instantiationService.setService(Z.ICharSizeService,this._charSizeService),this._themeService=this._instantiationService.createInstance(F.ThemeService),this._instantiationService.setService(Z.IThemeService,this._themeService),this._characterJoinerService=this._instantiationService.createInstance(f.CharacterJoinerService),this._instantiationService.setService(Z.ICharacterJoinerService,this._characterJoinerService),this._renderService=this.register(this._instantiationService.createInstance(m.RenderService,this.rows,this.screenElement)),this._instantiationService.setService(Z.IRenderService,this._renderService),this.register(this._renderService.onRenderedViewportChange((z)=>this._onRender.fire(z))),this.onResize((z)=>this._renderService.resize(z.cols,z.rows)),this._compositionView=w.createElement("div"),this._compositionView.classList.add("composition-view"),this._compositionHelper=this._instantiationService.createInstance(L.CompositionHelper,this.textarea,this._compositionView),this._helperContainer.appendChild(this._compositionView),this.element.appendChild(G);try{this._onWillOpen.fire(this.element)}catch(z){}this._renderService.hasRenderer()||this._renderService.setRenderer(this._createRenderer()),this._mouseService=this._instantiationService.createInstance(M.MouseService),this._instantiationService.setService(Z.IMouseService,this._mouseService),this.viewport=this._instantiationService.createInstance(B.Viewport,this._viewportElement,this._viewportScrollArea),this.viewport.onRequestScrollLines((z)=>this.scrollLines(z.amount,z.suppressScrollEvent,1)),this.register(this._inputHandler.onRequestSyncScrollBar(()=>this.viewport.syncScrollArea())),this.register(this.viewport),this.register(this.onCursorMove(()=>{this._renderService.handleCursorMove(),this._syncTextArea()})),this.register(this.onResize(()=>this._renderService.handleResize(this.cols,this.rows))),this.register(this.onBlur(()=>this._renderService.handleBlur())),this.register(this.onFocus(()=>this._renderService.handleFocus())),this.register(this._renderService.onDimensionsChange(()=>this.viewport.syncScrollArea())),this._selectionService=this.register(this._instantiationService.createInstance(A.SelectionService,this.element,this.screenElement,this.linkifier2)),this._instantiationService.setService(Z.ISelectionService,this._selectionService),this.register(this._selectionService.onRequestScrollLines((z)=>this.scrollLines(z.amount,z.suppressScrollEvent))),this.register(this._selectionService.onSelectionChange(()=>this._onSelectionChange.fire())),this.register(this._selectionService.onRequestRedraw((z)=>this._renderService.handleSelectionChanged(z.start,z.end,z.columnSelectMode))),this.register(this._selectionService.onLinuxMouseSelection((z)=>{this.textarea.value=z,this.textarea.focus(),this.textarea.select()})),this.register(this._onScroll.event((z)=>{this.viewport.syncScrollArea(),this._selectionService.refresh()})),this.register(h.addDisposableDomListener(this._viewportElement,"scroll",()=>this._selectionService.refresh())),this.linkifier2.attachToDom(this.screenElement,this._mouseService,this._renderService),this.register(this._instantiationService.createInstance(R.BufferDecorationRenderer,this.screenElement)),this.register(h.addDisposableDomListener(this.element,"mousedown",(z)=>this._selectionService.handleMouseDown(z))),this.coreMouseService.areMouseEventsActive?(this._selectionService.disable(),this.element.classList.add("enable-mouse-events")):this._selectionService.enable(),this.options.screenReaderMode&&(this._accessibilityManager.value=this._instantiationService.createInstance($.AccessibilityManager,this)),this.register(this.optionsService.onSpecificOptionChange("screenReaderMode",(z)=>this._handleScreenReaderModeOptionChange(z))),this.options.overviewRulerWidth&&(this._overviewRulerRenderer=this.register(this._instantiationService.createInstance(v.OverviewRulerRenderer,this._viewportElement,this.screenElement))),this.optionsService.onSpecificOptionChange("overviewRulerWidth",(z)=>{!this._overviewRulerRenderer&&z&&this._viewportElement&&this.screenElement&&(this._overviewRulerRenderer=this.register(this._instantiationService.createInstance(v.OverviewRulerRenderer,this._viewportElement,this.screenElement)))}),this._charSizeService.measure(),this.refresh(0,this.rows-1),this._initGlobal(),this.bindMouse()}_createRenderer(){return this._instantiationService.createInstance(C.DomRenderer,this.element,this.screenElement,this._viewportElement,this.linkifier2)}bindMouse(){const X=this,u=this.element;function G(q){const g0=X._mouseService.getMouseReportCoords(q,X.screenElement);if(!g0)return!1;let t,R0;switch(q.overrideType||q.type){case"mousemove":R0=32,q.buttons===void 0?(t=3,q.button!==void 0&&(t=q.button<3?q.button:3)):t=1&q.buttons?0:4&q.buttons?1:2&q.buttons?2:3;break;case"mouseup":R0=0,t=q.button<3?q.button:3;break;case"mousedown":R0=1,t=q.button<3?q.button:3;break;case"wheel":if(X.viewport.getLinesScrolled(q)===0)return!1;R0=q.deltaY<0?0:1,t=4;break;default:return!1}return!(R0===void 0||t===void 0||t>4)&&X.coreMouseService.triggerMouseEvent({col:g0.col,row:g0.row,x:g0.x,y:g0.y,button:t,action:R0,ctrl:q.ctrlKey,alt:q.altKey,shift:q.shiftKey})}const z={mouseup:null,wheel:null,mousedrag:null,mousemove:null},r={mouseup:(q)=>(G(q),q.buttons||(this._document.removeEventListener("mouseup",z.mouseup),z.mousedrag&&this._document.removeEventListener("mousemove",z.mousedrag)),this.cancel(q)),wheel:(q)=>(G(q),this.cancel(q,!0)),mousedrag:(q)=>{q.buttons&&G(q)},mousemove:(q)=>{q.buttons||G(q)}};this.register(this.coreMouseService.onProtocolChange((q)=>{q?(this.optionsService.rawOptions.logLevel==="debug"&&this._logService.debug("Binding to mouse events:",this.coreMouseService.explainEvents(q)),this.element.classList.add("enable-mouse-events"),this._selectionService.disable()):(this._logService.debug("Unbinding from mouse events."),this.element.classList.remove("enable-mouse-events"),this._selectionService.enable()),8&q?z.mousemove||(u.addEventListener("mousemove",r.mousemove),z.mousemove=r.mousemove):(u.removeEventListener("mousemove",z.mousemove),z.mousemove=null),16&q?z.wheel||(u.addEventListener("wheel",r.wheel,{passive:!1}),z.wheel=r.wheel):(u.removeEventListener("wheel",z.wheel),z.wheel=null),2&q?z.mouseup||(u.addEventListener("mouseup",r.mouseup),z.mouseup=r.mouseup):(this._document.removeEventListener("mouseup",z.mouseup),u.removeEventListener("mouseup",z.mouseup),z.mouseup=null),4&q?z.mousedrag||(z.mousedrag=r.mousedrag):(this._document.removeEventListener("mousemove",z.mousedrag),z.mousedrag=null)})),this.coreMouseService.activeProtocol=this.coreMouseService.activeProtocol,this.register(h.addDisposableDomListener(u,"mousedown",(q)=>{if(q.preventDefault(),this.focus(),this.coreMouseService.areMouseEventsActive&&!this._selectionService.shouldForceSelection(q))return G(q),z.mouseup&&this._document.addEventListener("mouseup",z.mouseup),z.mousedrag&&this._document.addEventListener("mousemove",z.mousedrag),this.cancel(q)})),this.register(h.addDisposableDomListener(u,"wheel",(q)=>{if(!z.wheel){if(!this.buffer.hasScrollback){const g0=this.viewport.getLinesScrolled(q);if(g0===0)return;const t=T.C0.ESC+(this.coreService.decPrivateModes.applicationCursorKeys?"O":"[")+(q.deltaY<0?"A":"B");let R0="";for(let e=0;e<Math.abs(g0);e++)R0+=t;return this.coreService.triggerDataEvent(R0,!0),this.cancel(q,!0)}return this.viewport.handleWheel(q)?this.cancel(q):void 0}},{passive:!1})),this.register(h.addDisposableDomListener(u,"touchstart",(q)=>{if(!this.coreMouseService.areMouseEventsActive)return this.viewport.handleTouchStart(q),this.cancel(q)},{passive:!0})),this.register(h.addDisposableDomListener(u,"touchmove",(q)=>{if(!this.coreMouseService.areMouseEventsActive)return this.viewport.handleTouchMove(q)?void 0:this.cancel(q)},{passive:!1}))}refresh(X,u){var G;(G=this._renderService)===null||G===void 0||G.refreshRows(X,u)}updateCursorStyle(X){var u;((u=this._selectionService)===null||u===void 0?void 0:u.shouldColumnSelect(X))?this.element.classList.add("column-select"):this.element.classList.remove("column-select")}_showCursor(){this.coreService.isCursorInitialized||(this.coreService.isCursorInitialized=!0,this.refresh(this.buffer.y,this.buffer.y))}scrollLines(X,u,G=0){var z;G===1?(super.scrollLines(X,u,G),this.refresh(0,this.rows-1)):(z=this.viewport)===null||z===void 0||z.scrollLines(X)}paste(X){H.paste(X,this.textarea,this.coreService,this.optionsService)}attachCustomKeyEventHandler(X){this._customKeyEventHandler=X}registerLinkProvider(X){return this.linkifier2.registerLinkProvider(X)}registerCharacterJoiner(X){if(!this._characterJoinerService)throw new Error("Terminal must be opened first");const u=this._characterJoinerService.register(X);return this.refresh(0,this.rows-1),u}deregisterCharacterJoiner(X){if(!this._characterJoinerService)throw new Error("Terminal must be opened first");this._characterJoinerService.deregister(X)&&this.refresh(0,this.rows-1)}get markers(){return this.buffer.markers}registerMarker(X){return this.buffer.addMarker(this.buffer.ybase+this.buffer.y+X)}registerDecoration(X){return this._decorationService.registerDecoration(X)}hasSelection(){return!!this._selectionService&&this._selectionService.hasSelection}select(X,u,G){this._selectionService.setSelection(X,u,G)}getSelection(){return this._selectionService?this._selectionService.selectionText:""}getSelectionPosition(){if(this._selectionService&&this._selectionService.hasSelection)return{start:{x:this._selectionService.selectionStart[0],y:this._selectionService.selectionStart[1]},end:{x:this._selectionService.selectionEnd[0],y:this._selectionService.selectionEnd[1]}}}clearSelection(){var X;(X=this._selectionService)===null||X===void 0||X.clearSelection()}selectAll(){var X;(X=this._selectionService)===null||X===void 0||X.selectAll()}selectLines(X,u){var G;(G=this._selectionService)===null||G===void 0||G.selectLines(X,u)}_keyDown(X){if(this._keyDownHandled=!1,this._keyDownSeen=!0,this._customKeyEventHandler&&this._customKeyEventHandler(X)===!1)return!1;const u=this.browser.isMac&&this.options.macOptionIsMeta&&X.altKey;if(!u&&!this._compositionHelper.keydown(X))return this.options.scrollOnUserInput&&this.buffer.ybase!==this.buffer.ydisp&&this.scrollToBottom(),!1;u||X.key!=="Dead"&&X.key!=="AltGraph"||(this._unprocessedDeadKey=!0);const G=Y.evaluateKeyboardEvent(X,this.coreService.decPrivateModes.applicationCursorKeys,this.browser.isMac,this.options.macOptionIsMeta);if(this.updateCursorStyle(X),G.type===3||G.type===2){const z=this.rows-1;return this.scrollLines(G.type===2?-z:z),this.cancel(X,!0)}return G.type===1&&this.selectAll(),!!this._isThirdLevelShift(this.browser,X)||(G.cancel&&this.cancel(X,!0),!G.key||!!(X.key&&!X.ctrlKey&&!X.altKey&&!X.metaKey&&X.key.length===1&&X.key.charCodeAt(0)>=65&&X.key.charCodeAt(0)<=90)||(this._unprocessedDeadKey?(this._unprocessedDeadKey=!1,!0):(G.key!==T.C0.ETX&&G.key!==T.C0.CR||(this.textarea.value=""),this._onKey.fire({key:G.key,domEvent:X}),this._showCursor(),this.coreService.triggerDataEvent(G.key,!0),!this.optionsService.rawOptions.screenReaderMode||X.altKey||X.ctrlKey?this.cancel(X,!0):void(this._keyDownHandled=!0))))}_isThirdLevelShift(X,u){const G=X.isMac&&!this.options.macOptionIsMeta&&u.altKey&&!u.ctrlKey&&!u.metaKey||X.isWindows&&u.altKey&&u.ctrlKey&&!u.metaKey||X.isWindows&&u.getModifierState("AltGraph");return u.type==="keypress"?G:G&&(!u.keyCode||u.keyCode>47)}_keyUp(X){this._keyDownSeen=!1,this._customKeyEventHandler&&this._customKeyEventHandler(X)===!1||(function(u){return u.keyCode===16||u.keyCode===17||u.keyCode===18}(X)||this.focus(),this.updateCursorStyle(X),this._keyPressHandled=!1)}_keyPress(X){let u;if(this._keyPressHandled=!1,this._keyDownHandled)return!1;if(this._customKeyEventHandler&&this._customKeyEventHandler(X)===!1)return!1;if(this.cancel(X),X.charCode)u=X.charCode;else if(X.which===null||X.which===void 0)u=X.keyCode;else{if(X.which===0||X.charCode===0)return!1;u=X.which}return!(!u||(X.altKey||X.ctrlKey||X.metaKey)&&!this._isThirdLevelShift(this.browser,X)||(u=String.fromCharCode(u),this._onKey.fire({key:u,domEvent:X}),this._showCursor(),this.coreService.triggerDataEvent(u,!0),this._keyPressHandled=!0,this._unprocessedDeadKey=!1,0))}_inputEvent(X){if(X.data&&X.inputType==="insertText"&&(!X.composed||!this._keyDownSeen)&&!this.optionsService.rawOptions.screenReaderMode){if(this._keyPressHandled)return!1;this._unprocessedDeadKey=!1;const u=X.data;return this.coreService.triggerDataEvent(u,!0),this.cancel(X),!0}return!1}resize(X,u){X!==this.cols||u!==this.rows?super.resize(X,u):this._charSizeService&&!this._charSizeService.hasValidSize&&this._charSizeService.measure()}_afterResize(X,u){var G,z;(G=this._charSizeService)===null||G===void 0||G.measure(),(z=this.viewport)===null||z===void 0||z.syncScrollArea(!0)}clear(){var X;if(this.buffer.ybase!==0||this.buffer.y!==0){this.buffer.clearAllMarkers(),this.buffer.lines.set(0,this.buffer.lines.get(this.buffer.ybase+this.buffer.y)),this.buffer.lines.length=1,this.buffer.ydisp=0,this.buffer.ybase=0,this.buffer.y=0;for(let u=1;u<this.rows;u++)this.buffer.lines.push(this.buffer.getBlankLine(K.DEFAULT_ATTR_DATA));this._onScroll.fire({position:this.buffer.ydisp,source:0}),(X=this.viewport)===null||X===void 0||X.reset(),this.refresh(0,this.rows-1)}}reset(){var X,u;this.options.rows=this.rows,this.options.cols=this.cols;const G=this._customKeyEventHandler;this._setup(),super.reset(),(X=this._selectionService)===null||X===void 0||X.reset(),this._decorationService.reset(),(u=this.viewport)===null||u===void 0||u.reset(),this._customKeyEventHandler=G,this.refresh(0,this.rows-1)}clearTextureAtlas(){var X;(X=this._renderService)===null||X===void 0||X.clearTextureAtlas()}_reportFocus(){var X;((X=this.element)===null||X===void 0?void 0:X.classList.contains("focus"))?this.coreService.triggerDataEvent(T.C0.ESC+"[I"):this.coreService.triggerDataEvent(T.C0.ESC+"[O")}_reportWindowsOptions(X){if(this._renderService)switch(X){case I.WindowsOptionsReportType.GET_WIN_SIZE_PIXELS:const u=this._renderService.dimensions.css.canvas.width.toFixed(0),G=this._renderService.dimensions.css.canvas.height.toFixed(0);this.coreService.triggerDataEvent(`${T.C0.ESC}[4;${G};${u}t`);break;case I.WindowsOptionsReportType.GET_CELL_SIZE_PIXELS:const z=this._renderService.dimensions.css.cell.width.toFixed(0),r=this._renderService.dimensions.css.cell.height.toFixed(0);this.coreService.triggerDataEvent(`${T.C0.ESC}[6;${r};${z}t`)}}cancel(X,u){if(this.options.cancelEvents||u)return X.preventDefault(),X.stopPropagation(),!1}}g.Terminal=d},9924:(U,g)=>{Object.defineProperty(g,"__esModule",{value:!0}),g.TimeBasedDebouncer=void 0,g.TimeBasedDebouncer=class{constructor(b,H=1000){this._renderCallback=b,this._debounceThresholdMS=H,this._lastRefreshMs=0,this._additionalRefreshRequested=!1}dispose(){this._refreshTimeoutID&&clearTimeout(this._refreshTimeoutID)}refresh(b,H,h){this._rowCount=h,b=b!==void 0?b:0,H=H!==void 0?H:this._rowCount-1,this._rowStart=this._rowStart!==void 0?Math.min(this._rowStart,b):b,this._rowEnd=this._rowEnd!==void 0?Math.max(this._rowEnd,H):H;const E=Date.now();if(E-this._lastRefreshMs>=this._debounceThresholdMS)this._lastRefreshMs=E,this._innerRefresh();else if(!this._additionalRefreshRequested){const D=E-this._lastRefreshMs,p=this._debounceThresholdMS-D;this._additionalRefreshRequested=!0,this._refreshTimeoutID=window.setTimeout(()=>{this._lastRefreshMs=Date.now(),this._innerRefresh(),this._additionalRefreshRequested=!1,this._refreshTimeoutID=void 0},p)}}_innerRefresh(){if(this._rowStart===void 0||this._rowEnd===void 0||this._rowCount===void 0)return;const b=Math.max(this._rowStart,0),H=Math.min(this._rowEnd,this._rowCount-1);this._rowStart=void 0,this._rowEnd=void 0,this._renderCallback(b,H)}}},1680:function(U,g,b){var H=this&&this.__decorate||function(L,C,S,f){var O,M=arguments.length,m=M<3?C:f===null?f=Object.getOwnPropertyDescriptor(C,S):f;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")m=Reflect.decorate(L,C,S,f);else for(var A=L.length-1;A>=0;A--)(O=L[A])&&(m=(M<3?O(m):M>3?O(C,S,m):O(C,S))||m);return M>3&&m&&Object.defineProperty(C,S,m),m},h=this&&this.__param||function(L,C){return function(S,f){C(S,f,L)}};Object.defineProperty(g,"__esModule",{value:!0}),g.Viewport=void 0;const E=b(3656),D=b(4725),p=b(8460),B=b(844),R=b(2585);let v=g.Viewport=class extends B.Disposable{constructor(L,C,S,f,O,M,m,A){super(),this._viewportElement=L,this._scrollArea=C,this._bufferService=S,this._optionsService=f,this._charSizeService=O,this._renderService=M,this._coreBrowserService=m,this.scrollBarWidth=0,this._currentRowHeight=0,this._currentDeviceCellHeight=0,this._lastRecordedBufferLength=0,this._lastRecordedViewportHeight=0,this._lastRecordedBufferHeight=0,this._lastTouchY=0,this._lastScrollTop=0,this._wheelPartialScroll=0,this._refreshAnimationFrame=null,this._ignoreNextScrollEvent=!1,this._smoothScrollState={startTime:0,origin:-1,target:-1},this._onRequestScrollLines=this.register(new p.EventEmitter),this.onRequestScrollLines=this._onRequestScrollLines.event,this.scrollBarWidth=this._viewportElement.offsetWidth-this._scrollArea.offsetWidth||15,this.register(E.addDisposableDomListener(this._viewportElement,"scroll",this._handleScroll.bind(this))),this._activeBuffer=this._bufferService.buffer,this.register(this._bufferService.buffers.onBufferActivate((Z)=>this._activeBuffer=Z.activeBuffer)),this._renderDimensions=this._renderService.dimensions,this.register(this._renderService.onDimensionsChange((Z)=>this._renderDimensions=Z)),this._handleThemeChange(A.colors),this.register(A.onChangeColors((Z)=>this._handleThemeChange(Z))),this.register(this._optionsService.onSpecificOptionChange("scrollback",()=>this.syncScrollArea())),setTimeout(()=>this.syncScrollArea())}_handleThemeChange(L){this._viewportElement.style.backgroundColor=L.background.css}reset(){this._currentRowHeight=0,this._currentDeviceCellHeight=0,this._lastRecordedBufferLength=0,this._lastRecordedViewportHeight=0,this._lastRecordedBufferHeight=0,this._lastTouchY=0,this._lastScrollTop=0,this._coreBrowserService.window.requestAnimationFrame(()=>this.syncScrollArea())}_refresh(L){if(L)return this._innerRefresh(),void(this._refreshAnimationFrame!==null&&this._coreBrowserService.window.cancelAnimationFrame(this._refreshAnimationFrame));this._refreshAnimationFrame===null&&(this._refreshAnimationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>this._innerRefresh()))}_innerRefresh(){if(this._charSizeService.height>0){this._currentRowHeight=this._renderService.dimensions.device.cell.height/this._coreBrowserService.dpr,this._currentDeviceCellHeight=this._renderService.dimensions.device.cell.height,this._lastRecordedViewportHeight=this._viewportElement.offsetHeight;const C=Math.round(this._currentRowHeight*this._lastRecordedBufferLength)+(this._lastRecordedViewportHeight-this._renderService.dimensions.css.canvas.height);this._lastRecordedBufferHeight!==C&&(this._lastRecordedBufferHeight=C,this._scrollArea.style.height=this._lastRecordedBufferHeight+"px")}const L=this._bufferService.buffer.ydisp*this._currentRowHeight;this._viewportElement.scrollTop!==L&&(this._ignoreNextScrollEvent=!0,this._viewportElement.scrollTop=L),this._refreshAnimationFrame=null}syncScrollArea(L=!1){if(this._lastRecordedBufferLength!==this._bufferService.buffer.lines.length)return this._lastRecordedBufferLength=this._bufferService.buffer.lines.length,void this._refresh(L);this._lastRecordedViewportHeight===this._renderService.dimensions.css.canvas.height&&this._lastScrollTop===this._activeBuffer.ydisp*this._currentRowHeight&&this._renderDimensions.device.cell.height===this._currentDeviceCellHeight||this._refresh(L)}_handleScroll(L){if(this._lastScrollTop=this._viewportElement.scrollTop,!this._viewportElement.offsetParent)return;if(this._ignoreNextScrollEvent)return this._ignoreNextScrollEvent=!1,void this._onRequestScrollLines.fire({amount:0,suppressScrollEvent:!0});const C=Math.round(this._lastScrollTop/this._currentRowHeight)-this._bufferService.buffer.ydisp;this._onRequestScrollLines.fire({amount:C,suppressScrollEvent:!0})}_smoothScroll(){if(this._isDisposed||this._smoothScrollState.origin===-1||this._smoothScrollState.target===-1)return;const L=this._smoothScrollPercent();this._viewportElement.scrollTop=this._smoothScrollState.origin+Math.round(L*(this._smoothScrollState.target-this._smoothScrollState.origin)),L<1?this._coreBrowserService.window.requestAnimationFrame(()=>this._smoothScroll()):this._clearSmoothScrollState()}_smoothScrollPercent(){return this._optionsService.rawOptions.smoothScrollDuration&&this._smoothScrollState.startTime?Math.max(Math.min((Date.now()-this._smoothScrollState.startTime)/this._optionsService.rawOptions.smoothScrollDuration,1),0):1}_clearSmoothScrollState(){this._smoothScrollState.startTime=0,this._smoothScrollState.origin=-1,this._smoothScrollState.target=-1}_bubbleScroll(L,C){const S=this._viewportElement.scrollTop+this._lastRecordedViewportHeight;return!(C<0&&this._viewportElement.scrollTop!==0||C>0&&S<this._lastRecordedBufferHeight)||(L.cancelable&&L.preventDefault(),!1)}handleWheel(L){const C=this._getPixelsScrolled(L);return C!==0&&(this._optionsService.rawOptions.smoothScrollDuration?(this._smoothScrollState.startTime=Date.now(),this._smoothScrollPercent()<1?(this._smoothScrollState.origin=this._viewportElement.scrollTop,this._smoothScrollState.target===-1?this._smoothScrollState.target=this._viewportElement.scrollTop+C:this._smoothScrollState.target+=C,this._smoothScrollState.target=Math.max(Math.min(this._smoothScrollState.target,this._viewportElement.scrollHeight),0),this._smoothScroll()):this._clearSmoothScrollState()):this._viewportElement.scrollTop+=C,this._bubbleScroll(L,C))}scrollLines(L){if(L!==0)if(this._optionsService.rawOptions.smoothScrollDuration){const C=L*this._currentRowHeight;this._smoothScrollState.startTime=Date.now(),this._smoothScrollPercent()<1?(this._smoothScrollState.origin=this._viewportElement.scrollTop,this._smoothScrollState.target=this._smoothScrollState.origin+C,this._smoothScrollState.target=Math.max(Math.min(this._smoothScrollState.target,this._viewportElement.scrollHeight),0),this._smoothScroll()):this._clearSmoothScrollState()}else this._onRequestScrollLines.fire({amount:L,suppressScrollEvent:!1})}_getPixelsScrolled(L){if(L.deltaY===0||L.shiftKey)return 0;let C=this._applyScrollModifier(L.deltaY,L);return L.deltaMode===WheelEvent.DOM_DELTA_LINE?C*=this._currentRowHeight:L.deltaMode===WheelEvent.DOM_DELTA_PAGE&&(C*=this._currentRowHeight*this._bufferService.rows),C}getBufferElements(L,C){var S;let f,O="";const M=[],m=C!=null?C:this._bufferService.buffer.lines.length,A=this._bufferService.buffer.lines;for(let Z=L;Z<m;Z++){const F=A.get(Z);if(!F)continue;const W=(S=A.get(Z+1))===null||S===void 0?void 0:S.isWrapped;if(O+=F.translateToString(!W),!W||Z===A.length-1){const P=document.createElement("div");P.textContent=O,M.push(P),O.length>0&&(f=P),O=""}}return{bufferElements:M,cursorElement:f}}getLinesScrolled(L){if(L.deltaY===0||L.shiftKey)return 0;let C=this._applyScrollModifier(L.deltaY,L);return L.deltaMode===WheelEvent.DOM_DELTA_PIXEL?(C/=this._currentRowHeight+0,this._wheelPartialScroll+=C,C=Math.floor(Math.abs(this._wheelPartialScroll))*(this._wheelPartialScroll>0?1:-1),this._wheelPartialScroll%=1):L.deltaMode===WheelEvent.DOM_DELTA_PAGE&&(C*=this._bufferService.rows),C}_applyScrollModifier(L,C){const S=this._optionsService.rawOptions.fastScrollModifier;return S==="alt"&&C.altKey||S==="ctrl"&&C.ctrlKey||S==="shift"&&C.shiftKey?L*this._optionsService.rawOptions.fastScrollSensitivity*this._optionsService.rawOptions.scrollSensitivity:L*this._optionsService.rawOptions.scrollSensitivity}handleTouchStart(L){this._lastTouchY=L.touches[0].pageY}handleTouchMove(L){const C=this._lastTouchY-L.touches[0].pageY;return this._lastTouchY=L.touches[0].pageY,C!==0&&(this._viewportElement.scrollTop+=C,this._bubbleScroll(L,C))}};g.Viewport=v=H([h(2,R.IBufferService),h(3,R.IOptionsService),h(4,D.ICharSizeService),h(5,D.IRenderService),h(6,D.ICoreBrowserService),h(7,D.IThemeService)],v)},3107:function(U,g,b){var H=this&&this.__decorate||function(v,L,C,S){var f,O=arguments.length,M=O<3?L:S===null?S=Object.getOwnPropertyDescriptor(L,C):S;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")M=Reflect.decorate(v,L,C,S);else for(var m=v.length-1;m>=0;m--)(f=v[m])&&(M=(O<3?f(M):O>3?f(L,C,M):f(L,C))||M);return O>3&&M&&Object.defineProperty(L,C,M),M},h=this&&this.__param||function(v,L){return function(C,S){L(C,S,v)}};Object.defineProperty(g,"__esModule",{value:!0}),g.BufferDecorationRenderer=void 0;const E=b(3656),D=b(4725),p=b(844),B=b(2585);let R=g.BufferDecorationRenderer=class extends p.Disposable{constructor(v,L,C,S){super(),this._screenElement=v,this._bufferService=L,this._decorationService=C,this._renderService=S,this._decorationElements=new Map,this._altBufferIsActive=!1,this._dimensionsChanged=!1,this._container=document.createElement("div"),this._container.classList.add("xterm-decoration-container"),this._screenElement.appendChild(this._container),this.register(this._renderService.onRenderedViewportChange(()=>this._doRefreshDecorations())),this.register(this._renderService.onDimensionsChange(()=>{this._dimensionsChanged=!0,this._queueRefresh()})),this.register(E.addDisposableDomListener(window,"resize",()=>this._queueRefresh())),this.register(this._bufferService.buffers.onBufferActivate(()=>{this._altBufferIsActive=this._bufferService.buffer===this._bufferService.buffers.alt})),this.register(this._decorationService.onDecorationRegistered(()=>this._queueRefresh())),this.register(this._decorationService.onDecorationRemoved((f)=>this._removeDecoration(f))),this.register(p.toDisposable(()=>{this._container.remove(),this._decorationElements.clear()}))}_queueRefresh(){this._animationFrame===void 0&&(this._animationFrame=this._renderService.addRefreshCallback(()=>{this._doRefreshDecorations(),this._animationFrame=void 0}))}_doRefreshDecorations(){for(let v of this._decorationService.decorations)this._renderDecoration(v);this._dimensionsChanged=!1}_renderDecoration(v){this._refreshStyle(v),this._dimensionsChanged&&this._refreshXPosition(v)}_createElement(v){var L,C;const S=document.createElement("div");S.classList.add("xterm-decoration"),S.classList.toggle("xterm-decoration-top-layer",((L=v==null?void 0:v.options)===null||L===void 0?void 0:L.layer)==="top"),S.style.width=`${Math.round((v.options.width||1)*this._renderService.dimensions.css.cell.width)}px`,S.style.height=(v.options.height||1)*this._renderService.dimensions.css.cell.height+"px",S.style.top=(v.marker.line-this._bufferService.buffers.active.ydisp)*this._renderService.dimensions.css.cell.height+"px",S.style.lineHeight=`${this._renderService.dimensions.css.cell.height}px`;const f=(C=v.options.x)!==null&&C!==void 0?C:0;return f&&f>this._bufferService.cols&&(S.style.display="none"),this._refreshXPosition(v,S),S}_refreshStyle(v){const L=v.marker.line-this._bufferService.buffers.active.ydisp;if(L<0||L>=this._bufferService.rows)v.element&&(v.element.style.display="none",v.onRenderEmitter.fire(v.element));else{let C=this._decorationElements.get(v);C||(C=this._createElement(v),v.element=C,this._decorationElements.set(v,C),this._container.appendChild(C),v.onDispose(()=>{this._decorationElements.delete(v),C.remove()})),C.style.top=L*this._renderService.dimensions.css.cell.height+"px",C.style.display=this._altBufferIsActive?"none":"block",v.onRenderEmitter.fire(C)}}_refreshXPosition(v,L=v.element){var C;if(!L)return;const S=(C=v.options.x)!==null&&C!==void 0?C:0;(v.options.anchor||"left")==="right"?L.style.right=S?S*this._renderService.dimensions.css.cell.width+"px":"":L.style.left=S?S*this._renderService.dimensions.css.cell.width+"px":""}_removeDecoration(v){var L;(L=this._decorationElements.get(v))===null||L===void 0||L.remove(),this._decorationElements.delete(v),v.dispose()}};g.BufferDecorationRenderer=R=H([h(1,B.IBufferService),h(2,B.IDecorationService),h(3,D.IRenderService)],R)},5871:(U,g)=>{Object.defineProperty(g,"__esModule",{value:!0}),g.ColorZoneStore=void 0,g.ColorZoneStore=class{constructor(){this._zones=[],this._zonePool=[],this._zonePoolIndex=0,this._linePadding={full:0,left:0,center:0,right:0}}get zones(){return this._zonePool.length=Math.min(this._zonePool.length,this._zones.length),this._zones}clear(){this._zones.length=0,this._zonePoolIndex=0}addDecoration(b){if(b.options.overviewRulerOptions){for(let H of this._zones)if(H.color===b.options.overviewRulerOptions.color&&H.position===b.options.overviewRulerOptions.position){if(this._lineIntersectsZone(H,b.marker.line))return;if(this._lineAdjacentToZone(H,b.marker.line,b.options.overviewRulerOptions.position))return void this._addLineToZone(H,b.marker.line)}if(this._zonePoolIndex<this._zonePool.length)return this._zonePool[this._zonePoolIndex].color=b.options.overviewRulerOptions.color,this._zonePool[this._zonePoolIndex].position=b.options.overviewRulerOptions.position,this._zonePool[this._zonePoolIndex].startBufferLine=b.marker.line,this._zonePool[this._zonePoolIndex].endBufferLine=b.marker.line,void this._zones.push(this._zonePool[this._zonePoolIndex++]);this._zones.push({color:b.options.overviewRulerOptions.color,position:b.options.overviewRulerOptions.position,startBufferLine:b.marker.line,endBufferLine:b.marker.line}),this._zonePool.push(this._zones[this._zones.length-1]),this._zonePoolIndex++}}setPadding(b){this._linePadding=b}_lineIntersectsZone(b,H){return H>=b.startBufferLine&&H<=b.endBufferLine}_lineAdjacentToZone(b,H,h){return H>=b.startBufferLine-this._linePadding[h||"full"]&&H<=b.endBufferLine+this._linePadding[h||"full"]}_addLineToZone(b,H){b.startBufferLine=Math.min(b.startBufferLine,H),b.endBufferLine=Math.max(b.endBufferLine,H)}}},5744:function(U,g,b){var H=this&&this.__decorate||function(f,O,M,m){var A,Z=arguments.length,F=Z<3?O:m===null?m=Object.getOwnPropertyDescriptor(O,M):m;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")F=Reflect.decorate(f,O,M,m);else for(var W=f.length-1;W>=0;W--)(A=f[W])&&(F=(Z<3?A(F):Z>3?A(O,M,F):A(O,M))||F);return Z>3&&F&&Object.defineProperty(O,M,F),F},h=this&&this.__param||function(f,O){return function(M,m){O(M,m,f)}};Object.defineProperty(g,"__esModule",{value:!0}),g.OverviewRulerRenderer=void 0;const E=b(5871),D=b(3656),p=b(4725),B=b(844),R=b(2585),v={full:0,left:0,center:0,right:0},L={full:0,left:0,center:0,right:0},C={full:0,left:0,center:0,right:0};let S=g.OverviewRulerRenderer=class extends B.Disposable{get _width(){return this._optionsService.options.overviewRulerWidth||0}constructor(f,O,M,m,A,Z,F){var W;super(),this._viewportElement=f,this._screenElement=O,this._bufferService=M,this._decorationService=m,this._renderService=A,this._optionsService=Z,this._coreBrowseService=F,this._colorZoneStore=new E.ColorZoneStore,this._shouldUpdateDimensions=!0,this._shouldUpdateAnchor=!0,this._lastKnownBufferLength=0,this._canvas=document.createElement("canvas"),this._canvas.classList.add("xterm-decoration-overview-ruler"),this._refreshCanvasDimensions(),(W=this._viewportElement.parentElement)===null||W===void 0||W.insertBefore(this._canvas,this._viewportElement);const P=this._canvas.getContext("2d");if(!P)throw new Error("Ctx cannot be null");this._ctx=P,this._registerDecorationListeners(),this._registerBufferChangeListeners(),this._registerDimensionChangeListeners(),this.register(B.toDisposable(()=>{var k;(k=this._canvas)===null||k===void 0||k.remove()}))}_registerDecorationListeners(){this.register(this._decorationService.onDecorationRegistered(()=>this._queueRefresh(void 0,!0))),this.register(this._decorationService.onDecorationRemoved(()=>this._queueRefresh(void 0,!0)))}_registerBufferChangeListeners(){this.register(this._renderService.onRenderedViewportChange(()=>this._queueRefresh())),this.register(this._bufferService.buffers.onBufferActivate(()=>{this._canvas.style.display=this._bufferService.buffer===this._bufferService.buffers.alt?"none":"block"})),this.register(this._bufferService.onScroll(()=>{this._lastKnownBufferLength!==this._bufferService.buffers.normal.lines.length&&(this._refreshDrawHeightConstants(),this._refreshColorZonePadding())}))}_registerDimensionChangeListeners(){this.register(this._renderService.onRender(()=>{this._containerHeight&&this._containerHeight===this._screenElement.clientHeight||(this._queueRefresh(!0),this._containerHeight=this._screenElement.clientHeight)})),this.register(this._optionsService.onSpecificOptionChange("overviewRulerWidth",()=>this._queueRefresh(!0))),this.register(D.addDisposableDomListener(this._coreBrowseService.window,"resize",()=>this._queueRefresh(!0))),this._queueRefresh(!0)}_refreshDrawConstants(){const f=Math.floor(this._canvas.width/3),O=Math.ceil(this._canvas.width/3);L.full=this._canvas.width,L.left=f,L.center=O,L.right=f,this._refreshDrawHeightConstants(),C.full=0,C.left=0,C.center=L.left,C.right=L.left+L.center}_refreshDrawHeightConstants(){v.full=Math.round(2*this._coreBrowseService.dpr);const f=this._canvas.height/this._bufferService.buffer.lines.length,O=Math.round(Math.max(Math.min(f,12),6)*this._coreBrowseService.dpr);v.left=O,v.center=O,v.right=O}_refreshColorZonePadding(){this._colorZoneStore.setPadding({full:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*v.full),left:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*v.left),center:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*v.center),right:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*v.right)}),this._lastKnownBufferLength=this._bufferService.buffers.normal.lines.length}_refreshCanvasDimensions(){this._canvas.style.width=`${this._width}px`,this._canvas.width=Math.round(this._width*this._coreBrowseService.dpr),this._canvas.style.height=`${this._screenElement.clientHeight}px`,this._canvas.height=Math.round(this._screenElement.clientHeight*this._coreBrowseService.dpr),this._refreshDrawConstants(),this._refreshColorZonePadding()}_refreshDecorations(){this._shouldUpdateDimensions&&this._refreshCanvasDimensions(),this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height),this._colorZoneStore.clear();for(let O of this._decorationService.decorations)this._colorZoneStore.addDecoration(O);this._ctx.lineWidth=1;const f=this._colorZoneStore.zones;for(let O of f)O.position!=="full"&&this._renderColorZone(O);for(let O of f)O.position==="full"&&this._renderColorZone(O);this._shouldUpdateDimensions=!1,this._shouldUpdateAnchor=!1}_renderColorZone(f){this._ctx.fillStyle=f.color,this._ctx.fillRect(C[f.position||"full"],Math.round((this._canvas.height-1)*(f.startBufferLine/this._bufferService.buffers.active.lines.length)-v[f.position||"full"]/2),L[f.position||"full"],Math.round((this._canvas.height-1)*((f.endBufferLine-f.startBufferLine)/this._bufferService.buffers.active.lines.length)+v[f.position||"full"]))}_queueRefresh(f,O){this._shouldUpdateDimensions=f||this._shouldUpdateDimensions,this._shouldUpdateAnchor=O||this._shouldUpdateAnchor,this._animationFrame===void 0&&(this._animationFrame=this._coreBrowseService.window.requestAnimationFrame(()=>{this._refreshDecorations(),this._animationFrame=void 0}))}};g.OverviewRulerRenderer=S=H([h(2,R.IBufferService),h(3,R.IDecorationService),h(4,p.IRenderService),h(5,R.IOptionsService),h(6,p.ICoreBrowserService)],S)},2950:function(U,g,b){var H=this&&this.__decorate||function(R,v,L,C){var S,f=arguments.length,O=f<3?v:C===null?C=Object.getOwnPropertyDescriptor(v,L):C;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")O=Reflect.decorate(R,v,L,C);else for(var M=R.length-1;M>=0;M--)(S=R[M])&&(O=(f<3?S(O):f>3?S(v,L,O):S(v,L))||O);return f>3&&O&&Object.defineProperty(v,L,O),O},h=this&&this.__param||function(R,v){return function(L,C){v(L,C,R)}};Object.defineProperty(g,"__esModule",{value:!0}),g.CompositionHelper=void 0;const E=b(4725),D=b(2585),p=b(2584);let B=g.CompositionHelper=class{get isComposing(){return this._isComposing}constructor(R,v,L,C,S,f){this._textarea=R,this._compositionView=v,this._bufferService=L,this._optionsService=C,this._coreService=S,this._renderService=f,this._isComposing=!1,this._isSendingComposition=!1,this._compositionPosition={start:0,end:0},this._dataAlreadySent=""}compositionstart(){this._isComposing=!0,this._compositionPosition.start=this._textarea.value.length,this._compositionView.textContent="",this._dataAlreadySent="",this._compositionView.classList.add("active")}compositionupdate(R){this._compositionView.textContent=R.data,this.updateCompositionElements(),setTimeout(()=>{this._compositionPosition.end=this._textarea.value.length},0)}compositionend(){this._finalizeComposition(!0)}keydown(R){if(this._isComposing||this._isSendingComposition){if(R.keyCode===229)return!1;if(R.keyCode===16||R.keyCode===17||R.keyCode===18)return!1;this._finalizeComposition(!1)}return R.keyCode!==229||(this._handleAnyTextareaChanges(),!1)}_finalizeComposition(R){if(this._compositionView.classList.remove("active"),this._isComposing=!1,R){const v={start:this._compositionPosition.start,end:this._compositionPosition.end};this._isSendingComposition=!0,setTimeout(()=>{if(this._isSendingComposition){let L;this._isSendingComposition=!1,v.start+=this._dataAlreadySent.length,L=this._isComposing?this._textarea.value.substring(v.start,v.end):this._textarea.value.substring(v.start),L.length>0&&this._coreService.triggerDataEvent(L,!0)}},0)}else{this._isSendingComposition=!1;const v=this._textarea.value.substring(this._compositionPosition.start,this._compositionPosition.end);this._coreService.triggerDataEvent(v,!0)}}_handleAnyTextareaChanges(){const R=this._textarea.value;setTimeout(()=>{if(!this._isComposing){const v=this._textarea.value,L=v.replace(R,"");this._dataAlreadySent=L,v.length>R.length?this._coreService.triggerDataEvent(L,!0):v.length<R.length?this._coreService.triggerDataEvent(`${p.C0.DEL}`,!0):v.length===R.length&&v!==R&&this._coreService.triggerDataEvent(v,!0)}},0)}updateCompositionElements(R){if(this._isComposing){if(this._bufferService.buffer.isCursorInViewport){const v=Math.min(this._bufferService.buffer.x,this._bufferService.cols-1),L=this._renderService.dimensions.css.cell.height,C=this._bufferService.buffer.y*this._renderService.dimensions.css.cell.height,S=v*this._renderService.dimensions.css.cell.width;this._compositionView.style.left=S+"px",this._compositionView.style.top=C+"px",this._compositionView.style.height=L+"px",this._compositionView.style.lineHeight=L+"px",this._compositionView.style.fontFamily=this._optionsService.rawOptions.fontFamily,this._compositionView.style.fontSize=this._optionsService.rawOptions.fontSize+"px";const f=this._compositionView.getBoundingClientRect();this._textarea.style.left=S+"px",this._textarea.style.top=C+"px",this._textarea.style.width=Math.max(f.width,1)+"px",this._textarea.style.height=Math.max(f.height,1)+"px",this._textarea.style.lineHeight=f.height+"px"}R||setTimeout(()=>this.updateCompositionElements(!0),0)}}};g.CompositionHelper=B=H([h(2,D.IBufferService),h(3,D.IOptionsService),h(4,D.ICoreService),h(5,E.IRenderService)],B)},9806:(U,g)=>{function b(H,h,E){const D=E.getBoundingClientRect(),p=H.getComputedStyle(E),B=parseInt(p.getPropertyValue("padding-left")),R=parseInt(p.getPropertyValue("padding-top"));return[h.clientX-D.left-B,h.clientY-D.top-R]}Object.defineProperty(g,"__esModule",{value:!0}),g.getCoords=g.getCoordsRelativeToElement=void 0,g.getCoordsRelativeToElement=b,g.getCoords=function(H,h,E,D,p,B,R,v,L){if(!B)return;const C=b(H,h,E);return C?(C[0]=Math.ceil((C[0]+(L?R/2:0))/R),C[1]=Math.ceil(C[1]/v),C[0]=Math.min(Math.max(C[0],1),D+(L?1:0)),C[1]=Math.min(Math.max(C[1],1),p),C):void 0}},9504:(U,g,b)=>{Object.defineProperty(g,"__esModule",{value:!0}),g.moveToCellSequence=void 0;const H=b(2584);function h(v,L,C,S){const f=v-E(v,C),O=L-E(L,C),M=Math.abs(f-O)-function(m,A,Z){let F=0;const W=m-E(m,Z),P=A-E(A,Z);for(let k=0;k<Math.abs(W-P);k++){const Q=D(m,A)==="A"?-1:1,V=Z.buffer.lines.get(W+Q*k);(V==null?void 0:V.isWrapped)&&F++}return F}(v,L,C);return R(M,B(D(v,L),S))}function E(v,L){let C=0,S=L.buffer.lines.get(v),f=S==null?void 0:S.isWrapped;for(;f&&v>=0&&v<L.rows;)C++,S=L.buffer.lines.get(--v),f=S==null?void 0:S.isWrapped;return C}function D(v,L){return v>L?"A":"B"}function p(v,L,C,S,f,O){let M=v,m=L,A="";for(;M!==C||m!==S;)M+=f?1:-1,f&&M>O.cols-1?(A+=O.buffer.translateBufferLineToString(m,!1,v,M),M=0,v=0,m++):!f&&M<0&&(A+=O.buffer.translateBufferLineToString(m,!1,0,v+1),M=O.cols-1,v=M,m--);return A+O.buffer.translateBufferLineToString(m,!1,v,M)}function B(v,L){const C=L?"O":"[";return H.C0.ESC+C+v}function R(v,L){v=Math.floor(v);let C="";for(let S=0;S<v;S++)C+=L;return C}g.moveToCellSequence=function(v,L,C,S){const f=C.buffer.x,O=C.buffer.y;if(!C.buffer.hasScrollback)return function(A,Z,F,W,P,k){return h(Z,W,P,k).length===0?"":R(p(A,Z,A,Z-E(Z,P),!1,P).length,B("D",k))}(f,O,0,L,C,S)+h(O,L,C,S)+function(A,Z,F,W,P,k){let Q;Q=h(Z,W,P,k).length>0?W-E(W,P):Z;const V=W,K=function(T,Y,J,_,N,I){let $;return $=h(J,_,N,I).length>0?_-E(_,N):Y,T<J&&$<=_||T>=J&&$<_?"C":"D"}(A,Z,F,W,P,k);return R(p(A,Q,F,V,K==="C",P).length,B(K,k))}(f,O,v,L,C,S);let M;if(O===L)return M=f>v?"D":"C",R(Math.abs(f-v),B(M,S));M=O>L?"D":"C";const m=Math.abs(O-L);return R(function(A,Z){return Z.cols-A}(O>L?v:f,C)+(m-1)*C.cols+1+((O>L?f:v)-1),B(M,S))}},1296:function(U,g,b){var H=this&&this.__decorate||function(P,k,Q,V){var K,T=arguments.length,Y=T<3?k:V===null?V=Object.getOwnPropertyDescriptor(k,Q):V;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")Y=Reflect.decorate(P,k,Q,V);else for(var J=P.length-1;J>=0;J--)(K=P[J])&&(Y=(T<3?K(Y):T>3?K(k,Q,Y):K(k,Q))||Y);return T>3&&Y&&Object.defineProperty(k,Q,Y),Y},h=this&&this.__param||function(P,k){return function(Q,V){k(Q,V,P)}};Object.defineProperty(g,"__esModule",{value:!0}),g.DomRenderer=void 0;const E=b(3787),D=b(2550),p=b(2223),B=b(6171),R=b(4725),v=b(8055),L=b(8460),C=b(844),S=b(2585),f="xterm-dom-renderer-owner-",O="xterm-rows",M="xterm-fg-",m="xterm-bg-",A="xterm-focus",Z="xterm-selection";let F=1,W=g.DomRenderer=class extends C.Disposable{constructor(P,k,Q,V,K,T,Y,J,_,N){super(),this._element=P,this._screenElement=k,this._viewportElement=Q,this._linkifier2=V,this._charSizeService=T,this._optionsService=Y,this._bufferService=J,this._coreBrowserService=_,this._themeService=N,this._terminalClass=F++,this._rowElements=[],this.onRequestRedraw=this.register(new L.EventEmitter).event,this._rowContainer=document.createElement("div"),this._rowContainer.classList.add(O),this._rowContainer.style.lineHeight="normal",this._rowContainer.setAttribute("aria-hidden","true"),this._refreshRowElements(this._bufferService.cols,this._bufferService.rows),this._selectionContainer=document.createElement("div"),this._selectionContainer.classList.add(Z),this._selectionContainer.setAttribute("aria-hidden","true"),this.dimensions=B.createRenderDimensions(),this._updateDimensions(),this.register(this._optionsService.onOptionChange(()=>this._handleOptionsChanged())),this.register(this._themeService.onChangeColors((I)=>this._injectCss(I))),this._injectCss(this._themeService.colors),this._rowFactory=K.createInstance(E.DomRendererRowFactory,document),this._element.classList.add(f+this._terminalClass),this._screenElement.appendChild(this._rowContainer),this._screenElement.appendChild(this._selectionContainer),this.register(this._linkifier2.onShowLinkUnderline((I)=>this._handleLinkHover(I))),this.register(this._linkifier2.onHideLinkUnderline((I)=>this._handleLinkLeave(I))),this.register(C.toDisposable(()=>{this._element.classList.remove(f+this._terminalClass),this._rowContainer.remove(),this._selectionContainer.remove(),this._widthCache.dispose(),this._themeStyleElement.remove(),this._dimensionsStyleElement.remove()})),this._widthCache=new D.WidthCache(document),this._widthCache.setFont(this._optionsService.rawOptions.fontFamily,this._optionsService.rawOptions.fontSize,this._optionsService.rawOptions.fontWeight,this._optionsService.rawOptions.fontWeightBold),this._setDefaultSpacing()}_updateDimensions(){const P=this._coreBrowserService.dpr;this.dimensions.device.char.width=this._charSizeService.width*P,this.dimensions.device.char.height=Math.ceil(this._charSizeService.height*P),this.dimensions.device.cell.width=this.dimensions.device.char.width+Math.round(this._optionsService.rawOptions.letterSpacing),this.dimensions.device.cell.height=Math.floor(this.dimensions.device.char.height*this._optionsService.rawOptions.lineHeight),this.dimensions.device.char.left=0,this.dimensions.device.char.top=0,this.dimensions.device.canvas.width=this.dimensions.device.cell.width*this._bufferService.cols,this.dimensions.device.canvas.height=this.dimensions.device.cell.height*this._bufferService.rows,this.dimensions.css.canvas.width=Math.round(this.dimensions.device.canvas.width/P),this.dimensions.css.canvas.height=Math.round(this.dimensions.device.canvas.height/P),this.dimensions.css.cell.width=this.dimensions.css.canvas.width/this._bufferService.cols,this.dimensions.css.cell.height=this.dimensions.css.canvas.height/this._bufferService.rows;for(let Q of this._rowElements)Q.style.width=`${this.dimensions.css.canvas.width}px`,Q.style.height=`${this.dimensions.css.cell.height}px`,Q.style.lineHeight=`${this.dimensions.css.cell.height}px`,Q.style.overflow="hidden";this._dimensionsStyleElement||(this._dimensionsStyleElement=document.createElement("style"),this._screenElement.appendChild(this._dimensionsStyleElement));const k=`${this._terminalSelector} .${O} span { display: inline-block; height: 100%; vertical-align: top;}`;this._dimensionsStyleElement.textContent=k,this._selectionContainer.style.height=this._viewportElement.style.height,this._screenElement.style.width=`${this.dimensions.css.canvas.width}px`,this._screenElement.style.height=`${this.dimensions.css.canvas.height}px`}_injectCss(P){this._themeStyleElement||(this._themeStyleElement=document.createElement("style"),this._screenElement.appendChild(this._themeStyleElement));let k=`${this._terminalSelector} .${O} { color: ${P.foreground.css}; font-family: ${this._optionsService.rawOptions.fontFamily}; font-size: ${this._optionsService.rawOptions.fontSize}px; font-kerning: none; white-space: pre}`;k+=`${this._terminalSelector} .${O} .xterm-dim { color: ${v.color.multiplyOpacity(P.foreground,0.5).css};}`,k+=`${this._terminalSelector} span:not(.xterm-bold) { font-weight: ${this._optionsService.rawOptions.fontWeight};}${this._terminalSelector} span.xterm-bold { font-weight: ${this._optionsService.rawOptions.fontWeightBold};}${this._terminalSelector} span.xterm-italic { font-style: italic;}`,k+="@keyframes blink_box_shadow_"+this._terminalClass+" { 50% {  border-bottom-style: hidden; }}",k+="@keyframes blink_block_"+this._terminalClass+" { 0% {"+`  background-color: ${P.cursor.css};`+`  color: ${P.cursorAccent.css}; } 50% {  background-color: inherit;`+`  color: ${P.cursor.css}; }}`,k+=`${this._terminalSelector} .${O}.${A} .xterm-cursor.xterm-cursor-blink:not(.xterm-cursor-block) { animation: blink_box_shadow_`+this._terminalClass+" 1s step-end infinite;}"+`${this._terminalSelector} .${O}.${A} .xterm-cursor.xterm-cursor-blink.xterm-cursor-block { animation: blink_block_`+this._terminalClass+" 1s step-end infinite;}"+`${this._terminalSelector} .${O} .xterm-cursor.xterm-cursor-block {`+` background-color: ${P.cursor.css};`+` color: ${P.cursorAccent.css};}`+`${this._terminalSelector} .${O} .xterm-cursor.xterm-cursor-outline {`+` outline: 1px solid ${P.cursor.css}; outline-offset: -1px;}`+`${this._terminalSelector} .${O} .xterm-cursor.xterm-cursor-bar {`+` box-shadow: ${this._optionsService.rawOptions.cursorWidth}px 0 0 ${P.cursor.css} inset;}`+`${this._terminalSelector} .${O} .xterm-cursor.xterm-cursor-underline {`+` border-bottom: 1px ${P.cursor.css}; border-bottom-style: solid; height: calc(100% - 1px);}`,k+=`${this._terminalSelector} .${Z} { position: absolute; top: 0; left: 0; z-index: 1; pointer-events: none;}${this._terminalSelector}.focus .${Z} div { position: absolute; background-color: ${P.selectionBackgroundOpaque.css};}${this._terminalSelector} .${Z} div { position: absolute; background-color: ${P.selectionInactiveBackgroundOpaque.css};}`;for(let[Q,V]of P.ansi.entries())k+=`${this._terminalSelector} .${M}${Q} { color: ${V.css}; }${this._terminalSelector} .${M}${Q}.xterm-dim { color: ${v.color.multiplyOpacity(V,0.5).css}; }${this._terminalSelector} .${m}${Q} { background-color: ${V.css}; }`;k+=`${this._terminalSelector} .${M}${p.INVERTED_DEFAULT_COLOR} { color: ${v.color.opaque(P.background).css}; }${this._terminalSelector} .${M}${p.INVERTED_DEFAULT_COLOR}.xterm-dim { color: ${v.color.multiplyOpacity(v.color.opaque(P.background),0.5).css}; }${this._terminalSelector} .${m}${p.INVERTED_DEFAULT_COLOR} { background-color: ${P.foreground.css}; }`,this._themeStyleElement.textContent=k}_setDefaultSpacing(){const P=this.dimensions.css.cell.width-this._widthCache.get("W",!1,!1);this._rowContainer.style.letterSpacing=`${P}px`,this._rowFactory.defaultSpacing=P}handleDevicePixelRatioChange(){this._updateDimensions(),this._widthCache.clear(),this._setDefaultSpacing()}_refreshRowElements(P,k){for(let Q=this._rowElements.length;Q<=k;Q++){const V=document.createElement("div");this._rowContainer.appendChild(V),this._rowElements.push(V)}for(;this._rowElements.length>k;)this._rowContainer.removeChild(this._rowElements.pop())}handleResize(P,k){this._refreshRowElements(P,k),this._updateDimensions()}handleCharSizeChanged(){this._updateDimensions(),this._widthCache.clear(),this._setDefaultSpacing()}handleBlur(){this._rowContainer.classList.remove(A)}handleFocus(){this._rowContainer.classList.add(A),this.renderRows(this._bufferService.buffer.y,this._bufferService.buffer.y)}handleSelectionChanged(P,k,Q){if(this._selectionContainer.replaceChildren(),this._rowFactory.handleSelectionChanged(P,k,Q),this.renderRows(0,this._bufferService.rows-1),!P||!k)return;const V=P[1]-this._bufferService.buffer.ydisp,K=k[1]-this._bufferService.buffer.ydisp,T=Math.max(V,0),Y=Math.min(K,this._bufferService.rows-1);if(T>=this._bufferService.rows||Y<0)return;const J=document.createDocumentFragment();if(Q){const _=P[0]>k[0];J.appendChild(this._createSelectionElement(T,_?k[0]:P[0],_?P[0]:k[0],Y-T+1))}else{const _=V===T?P[0]:0,N=T===K?k[0]:this._bufferService.cols;J.appendChild(this._createSelectionElement(T,_,N));const I=Y-T-1;if(J.appendChild(this._createSelectionElement(T+1,0,this._bufferService.cols,I)),T!==Y){const $=K===Y?k[0]:this._bufferService.cols;J.appendChild(this._createSelectionElement(Y,0,$))}}this._selectionContainer.appendChild(J)}_createSelectionElement(P,k,Q,V=1){const K=document.createElement("div");return K.style.height=V*this.dimensions.css.cell.height+"px",K.style.top=P*this.dimensions.css.cell.height+"px",K.style.left=k*this.dimensions.css.cell.width+"px",K.style.width=this.dimensions.css.cell.width*(Q-k)+"px",K}handleCursorMove(){}_handleOptionsChanged(){this._updateDimensions(),this._injectCss(this._themeService.colors),this._widthCache.setFont(this._optionsService.rawOptions.fontFamily,this._optionsService.rawOptions.fontSize,this._optionsService.rawOptions.fontWeight,this._optionsService.rawOptions.fontWeightBold),this._setDefaultSpacing()}clear(){for(let P of this._rowElements)P.replaceChildren()}renderRows(P,k){const Q=this._bufferService.buffer,V=Q.ybase+Q.y,K=Math.min(Q.x,this._bufferService.cols-1),T=this._optionsService.rawOptions.cursorBlink,Y=this._optionsService.rawOptions.cursorStyle,J=this._optionsService.rawOptions.cursorInactiveStyle;for(let _=P;_<=k;_++){const N=_+Q.ydisp,I=this._rowElements[_],$=Q.lines.get(N);if(!I||!$)break;I.replaceChildren(...this._rowFactory.createRow($,N,N===V,Y,J,K,T,this.dimensions.css.cell.width,this._widthCache,-1,-1))}}get _terminalSelector(){return`.${f}${this._terminalClass}`}_handleLinkHover(P){this._setCellUnderline(P.x1,P.x2,P.y1,P.y2,P.cols,!0)}_handleLinkLeave(P){this._setCellUnderline(P.x1,P.x2,P.y1,P.y2,P.cols,!1)}_setCellUnderline(P,k,Q,V,K,T){Q<0&&(P=0),V<0&&(k=0);const Y=this._bufferService.rows-1;Q=Math.max(Math.min(Q,Y),0),V=Math.max(Math.min(V,Y),0),K=Math.min(K,this._bufferService.cols);const J=this._bufferService.buffer,_=J.ybase+J.y,N=Math.min(J.x,K-1),I=this._optionsService.rawOptions.cursorBlink,$=this._optionsService.rawOptions.cursorStyle,w=this._optionsService.rawOptions.cursorInactiveStyle;for(let d=Q;d<=V;++d){const X=d+J.ydisp,u=this._rowElements[d],G=J.lines.get(X);if(!u||!G)break;u.replaceChildren(...this._rowFactory.createRow(G,X,X===_,$,w,N,I,this.dimensions.css.cell.width,this._widthCache,T?d===Q?P:0:-1,T?(d===V?k:K)-1:-1))}}};g.DomRenderer=W=H([h(4,S.IInstantiationService),h(5,R.ICharSizeService),h(6,S.IOptionsService),h(7,S.IBufferService),h(8,R.ICoreBrowserService),h(9,R.IThemeService)],W)},3787:function(U,g,b){var H=this&&this.__decorate||function(M,m,A,Z){var F,W=arguments.length,P=W<3?m:Z===null?Z=Object.getOwnPropertyDescriptor(m,A):Z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")P=Reflect.decorate(M,m,A,Z);else for(var k=M.length-1;k>=0;k--)(F=M[k])&&(P=(W<3?F(P):W>3?F(m,A,P):F(m,A))||P);return W>3&&P&&Object.defineProperty(m,A,P),P},h=this&&this.__param||function(M,m){return function(A,Z){m(A,Z,M)}};Object.defineProperty(g,"__esModule",{value:!0}),g.DomRendererRowFactory=void 0;const E=b(2223),D=b(643),p=b(511),B=b(2585),R=b(8055),v=b(4725),L=b(4269),C=b(6171),S=b(3734);let f=g.DomRendererRowFactory=class{constructor(M,m,A,Z,F,W,P){this._document=M,this._characterJoinerService=m,this._optionsService=A,this._coreBrowserService=Z,this._coreService=F,this._decorationService=W,this._themeService=P,this._workCell=new p.CellData,this._columnSelectMode=!1,this.defaultSpacing=0}handleSelectionChanged(M,m,A){this._selectionStart=M,this._selectionEnd=m,this._columnSelectMode=A}createRow(M,m,A,Z,F,W,P,k,Q,V,K){const T=[],Y=this._characterJoinerService.getJoinedCharacters(m),J=this._themeService.colors;let _,N=M.getNoBgTrimmedLength();A&&N<W+1&&(N=W+1);let I=0,$="",w=0,d=0,X=0,u=!1,G=0,z=!1,r=0;const q=[],g0=V!==-1&&K!==-1;for(let t=0;t<N;t++){M.loadCell(t,this._workCell);let R0=this._workCell.getWidth();if(R0===0)continue;let e=!1,f0=t,n=this._workCell;if(Y.length>0&&t===Y[0][0]){e=!0;const i=Y.shift();n=new L.JoinedCellData(this._workCell,M.translateToString(!0,i[0],i[1]),i[1]-i[0]),f0=i[1]-1,R0=n.getWidth()}const A0=this._isCellInSelection(t,m),p0=A&&t===W,Z0=g0&&t>=V&&t<=K;let v0=!1;this._decorationService.forEachDecorationAtCell(t,m,void 0,(i)=>{v0=!0});let s=n.getChars()||D.WHITESPACE_CELL_CHAR;if(s===" "&&(n.isUnderline()||n.isOverline())&&(s="\xA0"),r=R0*k-Q.get(s,n.isBold(),n.isItalic()),_){if(I&&(A0&&z||!A0&&!z&&n.bg===w)&&(A0&&z&&J.selectionForeground||n.fg===d)&&n.extended.ext===X&&Z0===u&&r===G&&!p0&&!e&&!v0){$+=s,I++;continue}I&&(_.textContent=$),_=this._document.createElement("span"),I=0,$=""}else _=this._document.createElement("span");if(w=n.bg,d=n.fg,X=n.extended.ext,u=Z0,G=r,z=A0,e&&W>=t&&W<=f0&&(W=t),!this._coreService.isCursorHidden&&p0){if(q.push("xterm-cursor"),this._coreBrowserService.isFocused)P&&q.push("xterm-cursor-blink"),q.push(Z==="bar"?"xterm-cursor-bar":Z==="underline"?"xterm-cursor-underline":"xterm-cursor-block");else if(F)switch(F){case"outline":q.push("xterm-cursor-outline");break;case"block":q.push("xterm-cursor-block");break;case"bar":q.push("xterm-cursor-bar");break;case"underline":q.push("xterm-cursor-underline")}}if(n.isBold()&&q.push("xterm-bold"),n.isItalic()&&q.push("xterm-italic"),n.isDim()&&q.push("xterm-dim"),$=n.isInvisible()?D.WHITESPACE_CELL_CHAR:n.getChars()||D.WHITESPACE_CELL_CHAR,n.isUnderline()&&(q.push(`xterm-underline-${n.extended.underlineStyle}`),$===" "&&($="\xA0"),!n.isUnderlineColorDefault()))if(n.isUnderlineColorRGB())_.style.textDecorationColor=`rgb(${S.AttributeData.toColorRGB(n.getUnderlineColor()).join(",")})`;else{let i=n.getUnderlineColor();this._optionsService.rawOptions.drawBoldTextInBrightColors&&n.isBold()&&i<8&&(i+=8),_.style.textDecorationColor=J.ansi[i].css}n.isOverline()&&(q.push("xterm-overline"),$===" "&&($="\xA0")),n.isStrikethrough()&&q.push("xterm-strikethrough"),Z0&&(_.style.textDecoration="underline");let a=n.getFgColor(),l=n.getFgColorMode(),o=n.getBgColor(),L0=n.getBgColorMode();const b0=!!n.isInverse();if(b0){const i=a;a=o,o=i;const T0=l;l=L0,L0=T0}let h0,H0,E0,S0=!1;switch(this._decorationService.forEachDecorationAtCell(t,m,void 0,(i)=>{i.options.layer!=="top"&&S0||(i.backgroundColorRGB&&(L0=50331648,o=i.backgroundColorRGB.rgba>>8&16777215,h0=i.backgroundColorRGB),i.foregroundColorRGB&&(l=50331648,a=i.foregroundColorRGB.rgba>>8&16777215,H0=i.foregroundColorRGB),S0=i.options.layer==="top")}),!S0&&A0&&(h0=this._coreBrowserService.isFocused?J.selectionBackgroundOpaque:J.selectionInactiveBackgroundOpaque,o=h0.rgba>>8&16777215,L0=50331648,S0=!0,J.selectionForeground&&(l=50331648,a=J.selectionForeground.rgba>>8&16777215,H0=J.selectionForeground)),S0&&q.push("xterm-decoration-top"),L0){case 16777216:case 33554432:E0=J.ansi[o],q.push(`xterm-bg-${o}`);break;case 50331648:E0=R.rgba.toColor(o>>16,o>>8&255,255&o),this._addStyle(_,`background-color:#${O((o>>>0).toString(16),"0",6)}`);break;default:b0?(E0=J.foreground,q.push(`xterm-bg-${E.INVERTED_DEFAULT_COLOR}`)):E0=J.background}switch(h0||n.isDim()&&(h0=R.color.multiplyOpacity(E0,0.5)),l){case 16777216:case 33554432:n.isBold()&&a<8&&this._optionsService.rawOptions.drawBoldTextInBrightColors&&(a+=8),this._applyMinimumContrast(_,E0,J.ansi[a],n,h0,void 0)||q.push(`xterm-fg-${a}`);break;case 50331648:const i=R.rgba.toColor(a>>16&255,a>>8&255,255&a);this._applyMinimumContrast(_,E0,i,n,h0,H0)||this._addStyle(_,`color:#${O(a.toString(16),"0",6)}`);break;default:this._applyMinimumContrast(_,E0,J.foreground,n,h0,void 0)||b0&&q.push(`xterm-fg-${E.INVERTED_DEFAULT_COLOR}`)}q.length&&(_.className=q.join(" "),q.length=0),p0||e||v0?_.textContent=$:I++,r!==this.defaultSpacing&&(_.style.letterSpacing=`${r}px`),T.push(_),t=f0}return _&&I&&(_.textContent=$),T}_applyMinimumContrast(M,m,A,Z,F,W){if(this._optionsService.rawOptions.minimumContrastRatio===1||C.excludeFromContrastRatioDemands(Z.getCode()))return!1;const P=this._getContrastCache(Z);let k;if(F||W||(k=P.getColor(m.rgba,A.rgba)),k===void 0){const Q=this._optionsService.rawOptions.minimumContrastRatio/(Z.isDim()?2:1);k=R.color.ensureContrastRatio(F||m,W||A,Q),P.setColor((F||m).rgba,(W||A).rgba,k!=null?k:null)}return!!k&&(this._addStyle(M,`color:${k.css}`),!0)}_getContrastCache(M){return M.isDim()?this._themeService.colors.halfContrastCache:this._themeService.colors.contrastCache}_addStyle(M,m){M.setAttribute("style",`${M.getAttribute("style")||""}${m};`)}_isCellInSelection(M,m){const A=this._selectionStart,Z=this._selectionEnd;return!(!A||!Z)&&(this._columnSelectMode?A[0]<=Z[0]?M>=A[0]&&m>=A[1]&&M<Z[0]&&m<=Z[1]:M<A[0]&&m>=A[1]&&M>=Z[0]&&m<=Z[1]:m>A[1]&&m<Z[1]||A[1]===Z[1]&&m===A[1]&&M>=A[0]&&M<Z[0]||A[1]<Z[1]&&m===Z[1]&&M<Z[0]||A[1]<Z[1]&&m===A[1]&&M>=A[0])}};function O(M,m,A){for(;M.length<A;)M=m+M;return M}g.DomRendererRowFactory=f=H([h(1,v.ICharacterJoinerService),h(2,B.IOptionsService),h(3,v.ICoreBrowserService),h(4,B.ICoreService),h(5,B.IDecorationService),h(6,v.IThemeService)],f)},2550:(U,g)=>{Object.defineProperty(g,"__esModule",{value:!0}),g.WidthCache=void 0,g.WidthCache=class{constructor(b){this._flat=new Float32Array(256),this._font="",this._fontSize=0,this._weight="normal",this._weightBold="bold",this._measureElements=[],this._container=b.createElement("div"),this._container.style.position="absolute",this._container.style.top="-50000px",this._container.style.width="50000px",this._container.style.whiteSpace="pre",this._container.style.fontKerning="none";const H=b.createElement("span"),h=b.createElement("span");h.style.fontWeight="bold";const E=b.createElement("span");E.style.fontStyle="italic";const D=b.createElement("span");D.style.fontWeight="bold",D.style.fontStyle="italic",this._measureElements=[H,h,E,D],this._container.appendChild(H),this._container.appendChild(h),this._container.appendChild(E),this._container.appendChild(D),b.body.appendChild(this._container),this.clear()}dispose(){this._container.remove(),this._measureElements.length=0,this._holey=void 0}clear(){this._flat.fill(-9999),this._holey=new Map}setFont(b,H,h,E){b===this._font&&H===this._fontSize&&h===this._weight&&E===this._weightBold||(this._font=b,this._fontSize=H,this._weight=h,this._weightBold=E,this._container.style.fontFamily=this._font,this._container.style.fontSize=`${this._fontSize}px`,this._measureElements[0].style.fontWeight=`${h}`,this._measureElements[1].style.fontWeight=`${E}`,this._measureElements[2].style.fontWeight=`${h}`,this._measureElements[3].style.fontWeight=`${E}`,this.clear())}get(b,H,h){let E=0;if(!H&&!h&&b.length===1&&(E=b.charCodeAt(0))<256)return this._flat[E]!==-9999?this._flat[E]:this._flat[E]=this._measure(b,0);let D=b;H&&(D+="B"),h&&(D+="I");let p=this._holey.get(D);if(p===void 0){let B=0;H&&(B|=1),h&&(B|=2),p=this._measure(b,B),this._holey.set(D,p)}return p}_measure(b,H){const h=this._measureElements[H];return h.textContent=b.repeat(32),h.offsetWidth/32}}},2223:(U,g,b)=>{Object.defineProperty(g,"__esModule",{value:!0}),g.TEXT_BASELINE=g.DIM_OPACITY=g.INVERTED_DEFAULT_COLOR=void 0;const H=b(6114);g.INVERTED_DEFAULT_COLOR=257,g.DIM_OPACITY=0.5,g.TEXT_BASELINE=H.isFirefox||H.isLegacyEdge?"bottom":"ideographic"},6171:(U,g)=>{function b(H){return 57508<=H&&H<=57558}Object.defineProperty(g,"__esModule",{value:!0}),g.createRenderDimensions=g.excludeFromContrastRatioDemands=g.isRestrictedPowerlineGlyph=g.isPowerlineGlyph=g.throwIfFalsy=void 0,g.throwIfFalsy=function(H){if(!H)throw new Error("value must not be falsy");return H},g.isPowerlineGlyph=b,g.isRestrictedPowerlineGlyph=function(H){return 57520<=H&&H<=57527},g.excludeFromContrastRatioDemands=function(H){return b(H)||function(h){return 9472<=h&&h<=9631}(H)},g.createRenderDimensions=function(){return{css:{canvas:{width:0,height:0},cell:{width:0,height:0}},device:{canvas:{width:0,height:0},cell:{width:0,height:0},char:{width:0,height:0,left:0,top:0}}}}},456:(U,g)=>{Object.defineProperty(g,"__esModule",{value:!0}),g.SelectionModel=void 0,g.SelectionModel=class{constructor(b){this._bufferService=b,this.isSelectAllActive=!1,this.selectionStartLength=0}clearSelection(){this.selectionStart=void 0,this.selectionEnd=void 0,this.isSelectAllActive=!1,this.selectionStartLength=0}get finalSelectionStart(){return this.isSelectAllActive?[0,0]:this.selectionEnd&&this.selectionStart&&this.areSelectionValuesReversed()?this.selectionEnd:this.selectionStart}get finalSelectionEnd(){if(this.isSelectAllActive)return[this._bufferService.cols,this._bufferService.buffer.ybase+this._bufferService.rows-1];if(this.selectionStart){if(!this.selectionEnd||this.areSelectionValuesReversed()){const b=this.selectionStart[0]+this.selectionStartLength;return b>this._bufferService.cols?b%this._bufferService.cols==0?[this._bufferService.cols,this.selectionStart[1]+Math.floor(b/this._bufferService.cols)-1]:[b%this._bufferService.cols,this.selectionStart[1]+Math.floor(b/this._bufferService.cols)]:[b,this.selectionStart[1]]}if(this.selectionStartLength&&this.selectionEnd[1]===this.selectionStart[1]){const b=this.selectionStart[0]+this.selectionStartLength;return b>this._bufferService.cols?[b%this._bufferService.cols,this.selectionStart[1]+Math.floor(b/this._bufferService.cols)]:[Math.max(b,this.selectionEnd[0]),this.selectionEnd[1]]}return this.selectionEnd}}areSelectionValuesReversed(){const b=this.selectionStart,H=this.selectionEnd;return!(!b||!H)&&(b[1]>H[1]||b[1]===H[1]&&b[0]>H[0])}handleTrim(b){return this.selectionStart&&(this.selectionStart[1]-=b),this.selectionEnd&&(this.selectionEnd[1]-=b),this.selectionEnd&&this.selectionEnd[1]<0?(this.clearSelection(),!0):(this.selectionStart&&this.selectionStart[1]<0&&(this.selectionStart[1]=0),!1)}}},428:function(U,g,b){var H=this&&this.__decorate||function(v,L,C,S){var f,O=arguments.length,M=O<3?L:S===null?S=Object.getOwnPropertyDescriptor(L,C):S;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")M=Reflect.decorate(v,L,C,S);else for(var m=v.length-1;m>=0;m--)(f=v[m])&&(M=(O<3?f(M):O>3?f(L,C,M):f(L,C))||M);return O>3&&M&&Object.defineProperty(L,C,M),M},h=this&&this.__param||function(v,L){return function(C,S){L(C,S,v)}};Object.defineProperty(g,"__esModule",{value:!0}),g.CharSizeService=void 0;const E=b(2585),D=b(8460),p=b(844);let B=g.CharSizeService=class extends p.Disposable{get hasValidSize(){return this.width>0&&this.height>0}constructor(v,L,C){super(),this._optionsService=C,this.width=0,this.height=0,this._onCharSizeChange=this.register(new D.EventEmitter),this.onCharSizeChange=this._onCharSizeChange.event,this._measureStrategy=new R(v,L,this._optionsService),this.register(this._optionsService.onMultipleOptionChange(["fontFamily","fontSize"],()=>this.measure()))}measure(){const v=this._measureStrategy.measure();v.width===this.width&&v.height===this.height||(this.width=v.width,this.height=v.height,this._onCharSizeChange.fire())}};g.CharSizeService=B=H([h(2,E.IOptionsService)],B);class R{constructor(v,L,C){this._document=v,this._parentElement=L,this._optionsService=C,this._result={width:0,height:0},this._measureElement=this._document.createElement("span"),this._measureElement.classList.add("xterm-char-measure-element"),this._measureElement.textContent="W".repeat(32),this._measureElement.setAttribute("aria-hidden","true"),this._measureElement.style.whiteSpace="pre",this._measureElement.style.fontKerning="none",this._parentElement.appendChild(this._measureElement)}measure(){this._measureElement.style.fontFamily=this._optionsService.rawOptions.fontFamily,this._measureElement.style.fontSize=`${this._optionsService.rawOptions.fontSize}px`;const v={height:Number(this._measureElement.offsetHeight),width:Number(this._measureElement.offsetWidth)};return v.width!==0&&v.height!==0&&(this._result.width=v.width/32,this._result.height=Math.ceil(v.height)),this._result}}},4269:function(U,g,b){var H=this&&this.__decorate||function(L,C,S,f){var O,M=arguments.length,m=M<3?C:f===null?f=Object.getOwnPropertyDescriptor(C,S):f;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")m=Reflect.decorate(L,C,S,f);else for(var A=L.length-1;A>=0;A--)(O=L[A])&&(m=(M<3?O(m):M>3?O(C,S,m):O(C,S))||m);return M>3&&m&&Object.defineProperty(C,S,m),m},h=this&&this.__param||function(L,C){return function(S,f){C(S,f,L)}};Object.defineProperty(g,"__esModule",{value:!0}),g.CharacterJoinerService=g.JoinedCellData=void 0;const E=b(3734),D=b(643),p=b(511),B=b(2585);class R extends E.AttributeData{constructor(L,C,S){super(),this.content=0,this.combinedData="",this.fg=L.fg,this.bg=L.bg,this.combinedData=C,this._width=S}isCombined(){return 2097152}getWidth(){return this._width}getChars(){return this.combinedData}getCode(){return 2097151}setFromCharData(L){throw new Error("not implemented")}getAsCharData(){return[this.fg,this.getChars(),this.getWidth(),this.getCode()]}}g.JoinedCellData=R;let v=g.CharacterJoinerService=class L{constructor(C){this._bufferService=C,this._characterJoiners=[],this._nextCharacterJoinerId=0,this._workCell=new p.CellData}register(C){const S={id:this._nextCharacterJoinerId++,handler:C};return this._characterJoiners.push(S),S.id}deregister(C){for(let S=0;S<this._characterJoiners.length;S++)if(this._characterJoiners[S].id===C)return this._characterJoiners.splice(S,1),!0;return!1}getJoinedCharacters(C){if(this._characterJoiners.length===0)return[];const S=this._bufferService.buffer.lines.get(C);if(!S||S.length===0)return[];const f=[],O=S.translateToString(!0);let M=0,m=0,A=0,Z=S.getFg(0),F=S.getBg(0);for(let W=0;W<S.getTrimmedLength();W++)if(S.loadCell(W,this._workCell),this._workCell.getWidth()!==0){if(this._workCell.fg!==Z||this._workCell.bg!==F){if(W-M>1){const P=this._getJoinedRanges(O,A,m,S,M);for(let k=0;k<P.length;k++)f.push(P[k])}M=W,A=m,Z=this._workCell.fg,F=this._workCell.bg}m+=this._workCell.getChars().length||D.WHITESPACE_CELL_CHAR.length}if(this._bufferService.cols-M>1){const W=this._getJoinedRanges(O,A,m,S,M);for(let P=0;P<W.length;P++)f.push(W[P])}return f}_getJoinedRanges(C,S,f,O,M){const m=C.substring(S,f);let A=[];try{A=this._characterJoiners[0].handler(m)}catch(Z){console.error(Z)}for(let Z=1;Z<this._characterJoiners.length;Z++)try{const F=this._characterJoiners[Z].handler(m);for(let W=0;W<F.length;W++)L._mergeRanges(A,F[W])}catch(F){console.error(F)}return this._stringRangesToCellRanges(A,O,M),A}_stringRangesToCellRanges(C,S,f){let O=0,M=!1,m=0,A=C[O];if(A){for(let Z=f;Z<this._bufferService.cols;Z++){const F=S.getWidth(Z),W=S.getString(Z).length||D.WHITESPACE_CELL_CHAR.length;if(F!==0){if(!M&&A[0]<=m&&(A[0]=Z,M=!0),A[1]<=m){if(A[1]=Z,A=C[++O],!A)break;A[0]<=m?(A[0]=Z,M=!0):M=!1}m+=W}}A&&(A[1]=this._bufferService.cols)}}static _mergeRanges(C,S){let f=!1;for(let O=0;O<C.length;O++){const M=C[O];if(f){if(S[1]<=M[0])return C[O-1][1]=S[1],C;if(S[1]<=M[1])return C[O-1][1]=Math.max(S[1],M[1]),C.splice(O,1),C;C.splice(O,1),O--}else{if(S[1]<=M[0])return C.splice(O,0,S),C;if(S[1]<=M[1])return M[0]=Math.min(S[0],M[0]),C;S[0]<M[1]&&(M[0]=Math.min(S[0],M[0]),f=!0)}}return f?C[C.length-1][1]=S[1]:C.push(S),C}};g.CharacterJoinerService=v=H([h(0,B.IBufferService)],v)},5114:(U,g)=>{Object.defineProperty(g,"__esModule",{value:!0}),g.CoreBrowserService=void 0,g.CoreBrowserService=class{constructor(b,H){this._textarea=b,this.window=H,this._isFocused=!1,this._cachedIsFocused=void 0,this._textarea.addEventListener("focus",()=>this._isFocused=!0),this._textarea.addEventListener("blur",()=>this._isFocused=!1)}get dpr(){return this.window.devicePixelRatio}get isFocused(){return this._cachedIsFocused===void 0&&(this._cachedIsFocused=this._isFocused&&this._textarea.ownerDocument.hasFocus(),queueMicrotask(()=>this._cachedIsFocused=void 0)),this._cachedIsFocused}}},8934:function(U,g,b){var H=this&&this.__decorate||function(B,R,v,L){var C,S=arguments.length,f=S<3?R:L===null?L=Object.getOwnPropertyDescriptor(R,v):L;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")f=Reflect.decorate(B,R,v,L);else for(var O=B.length-1;O>=0;O--)(C=B[O])&&(f=(S<3?C(f):S>3?C(R,v,f):C(R,v))||f);return S>3&&f&&Object.defineProperty(R,v,f),f},h=this&&this.__param||function(B,R){return function(v,L){R(v,L,B)}};Object.defineProperty(g,"__esModule",{value:!0}),g.MouseService=void 0;const E=b(4725),D=b(9806);let p=g.MouseService=class{constructor(B,R){this._renderService=B,this._charSizeService=R}getCoords(B,R,v,L,C){return D.getCoords(window,B,R,v,L,this._charSizeService.hasValidSize,this._renderService.dimensions.css.cell.width,this._renderService.dimensions.css.cell.height,C)}getMouseReportCoords(B,R){const v=D.getCoordsRelativeToElement(window,B,R);if(this._charSizeService.hasValidSize)return v[0]=Math.min(Math.max(v[0],0),this._renderService.dimensions.css.canvas.width-1),v[1]=Math.min(Math.max(v[1],0),this._renderService.dimensions.css.canvas.height-1),{col:Math.floor(v[0]/this._renderService.dimensions.css.cell.width),row:Math.floor(v[1]/this._renderService.dimensions.css.cell.height),x:Math.floor(v[0]),y:Math.floor(v[1])}}};g.MouseService=p=H([h(0,E.IRenderService),h(1,E.ICharSizeService)],p)},3230:function(U,g,b){var H=this&&this.__decorate||function(f,O,M,m){var A,Z=arguments.length,F=Z<3?O:m===null?m=Object.getOwnPropertyDescriptor(O,M):m;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")F=Reflect.decorate(f,O,M,m);else for(var W=f.length-1;W>=0;W--)(A=f[W])&&(F=(Z<3?A(F):Z>3?A(O,M,F):A(O,M))||F);return Z>3&&F&&Object.defineProperty(O,M,F),F},h=this&&this.__param||function(f,O){return function(M,m){O(M,m,f)}};Object.defineProperty(g,"__esModule",{value:!0}),g.RenderService=void 0;const E=b(3656),D=b(6193),p=b(5596),B=b(4725),R=b(8460),v=b(844),L=b(7226),C=b(2585);let S=g.RenderService=class extends v.Disposable{get dimensions(){return this._renderer.value.dimensions}constructor(f,O,M,m,A,Z,F,W){if(super(),this._rowCount=f,this._charSizeService=m,this._renderer=this.register(new v.MutableDisposable),this._pausedResizeTask=new L.DebouncedIdleTask,this._isPaused=!1,this._needsFullRefresh=!1,this._isNextRenderRedrawOnly=!0,this._needsSelectionRefresh=!1,this._canvasWidth=0,this._canvasHeight=0,this._selectionState={start:void 0,end:void 0,columnSelectMode:!1},this._onDimensionsChange=this.register(new R.EventEmitter),this.onDimensionsChange=this._onDimensionsChange.event,this._onRenderedViewportChange=this.register(new R.EventEmitter),this.onRenderedViewportChange=this._onRenderedViewportChange.event,this._onRender=this.register(new R.EventEmitter),this.onRender=this._onRender.event,this._onRefreshRequest=this.register(new R.EventEmitter),this.onRefreshRequest=this._onRefreshRequest.event,this._renderDebouncer=new D.RenderDebouncer(F.window,(P,k)=>this._renderRows(P,k)),this.register(this._renderDebouncer),this._screenDprMonitor=new p.ScreenDprMonitor(F.window),this._screenDprMonitor.setListener(()=>this.handleDevicePixelRatioChange()),this.register(this._screenDprMonitor),this.register(Z.onResize(()=>this._fullRefresh())),this.register(Z.buffers.onBufferActivate(()=>{var P;return(P=this._renderer.value)===null||P===void 0?void 0:P.clear()})),this.register(M.onOptionChange(()=>this._handleOptionsChanged())),this.register(this._charSizeService.onCharSizeChange(()=>this.handleCharSizeChanged())),this.register(A.onDecorationRegistered(()=>this._fullRefresh())),this.register(A.onDecorationRemoved(()=>this._fullRefresh())),this.register(M.onMultipleOptionChange(["customGlyphs","drawBoldTextInBrightColors","letterSpacing","lineHeight","fontFamily","fontSize","fontWeight","fontWeightBold","minimumContrastRatio"],()=>{this.clear(),this.handleResize(Z.cols,Z.rows),this._fullRefresh()})),this.register(M.onMultipleOptionChange(["cursorBlink","cursorStyle"],()=>this.refreshRows(Z.buffer.y,Z.buffer.y,!0))),this.register(E.addDisposableDomListener(F.window,"resize",()=>this.handleDevicePixelRatioChange())),this.register(W.onChangeColors(()=>this._fullRefresh())),"IntersectionObserver"in F.window){const P=new F.window.IntersectionObserver((k)=>this._handleIntersectionChange(k[k.length-1]),{threshold:0});P.observe(O),this.register({dispose:()=>P.disconnect()})}}_handleIntersectionChange(f){this._isPaused=f.isIntersecting===void 0?f.intersectionRatio===0:!f.isIntersecting,this._isPaused||this._charSizeService.hasValidSize||this._charSizeService.measure(),!this._isPaused&&this._needsFullRefresh&&(this._pausedResizeTask.flush(),this.refreshRows(0,this._rowCount-1),this._needsFullRefresh=!1)}refreshRows(f,O,M=!1){this._isPaused?this._needsFullRefresh=!0:(M||(this._isNextRenderRedrawOnly=!1),this._renderDebouncer.refresh(f,O,this._rowCount))}_renderRows(f,O){this._renderer.value&&(f=Math.min(f,this._rowCount-1),O=Math.min(O,this._rowCount-1),this._renderer.value.renderRows(f,O),this._needsSelectionRefresh&&(this._renderer.value.handleSelectionChanged(this._selectionState.start,this._selectionState.end,this._selectionState.columnSelectMode),this._needsSelectionRefresh=!1),this._isNextRenderRedrawOnly||this._onRenderedViewportChange.fire({start:f,end:O}),this._onRender.fire({start:f,end:O}),this._isNextRenderRedrawOnly=!0)}resize(f,O){this._rowCount=O,this._fireOnCanvasResize()}_handleOptionsChanged(){this._renderer.value&&(this.refreshRows(0,this._rowCount-1),this._fireOnCanvasResize())}_fireOnCanvasResize(){this._renderer.value&&(this._renderer.value.dimensions.css.canvas.width===this._canvasWidth&&this._renderer.value.dimensions.css.canvas.height===this._canvasHeight||this._onDimensionsChange.fire(this._renderer.value.dimensions))}hasRenderer(){return!!this._renderer.value}setRenderer(f){this._renderer.value=f,this._renderer.value.onRequestRedraw((O)=>this.refreshRows(O.start,O.end,!0)),this._needsSelectionRefresh=!0,this._fullRefresh()}addRefreshCallback(f){return this._renderDebouncer.addRefreshCallback(f)}_fullRefresh(){this._isPaused?this._needsFullRefresh=!0:this.refreshRows(0,this._rowCount-1)}clearTextureAtlas(){var f,O;this._renderer.value&&((O=(f=this._renderer.value).clearTextureAtlas)===null||O===void 0||O.call(f),this._fullRefresh())}handleDevicePixelRatioChange(){this._charSizeService.measure(),this._renderer.value&&(this._renderer.value.handleDevicePixelRatioChange(),this.refreshRows(0,this._rowCount-1))}handleResize(f,O){this._renderer.value&&(this._isPaused?this._pausedResizeTask.set(()=>this._renderer.value.handleResize(f,O)):this._renderer.value.handleResize(f,O),this._fullRefresh())}handleCharSizeChanged(){var f;(f=this._renderer.value)===null||f===void 0||f.handleCharSizeChanged()}handleBlur(){var f;(f=this._renderer.value)===null||f===void 0||f.handleBlur()}handleFocus(){var f;(f=this._renderer.value)===null||f===void 0||f.handleFocus()}handleSelectionChanged(f,O,M){var m;this._selectionState.start=f,this._selectionState.end=O,this._selectionState.columnSelectMode=M,(m=this._renderer.value)===null||m===void 0||m.handleSelectionChanged(f,O,M)}handleCursorMove(){var f;(f=this._renderer.value)===null||f===void 0||f.handleCursorMove()}clear(){var f;(f=this._renderer.value)===null||f===void 0||f.clear()}};g.RenderService=S=H([h(2,C.IOptionsService),h(3,B.ICharSizeService),h(4,C.IDecorationService),h(5,C.IBufferService),h(6,B.ICoreBrowserService),h(7,B.IThemeService)],S)},9312:function(U,g,b){var H=this&&this.__decorate||function(A,Z,F,W){var P,k=arguments.length,Q=k<3?Z:W===null?W=Object.getOwnPropertyDescriptor(Z,F):W;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")Q=Reflect.decorate(A,Z,F,W);else for(var V=A.length-1;V>=0;V--)(P=A[V])&&(Q=(k<3?P(Q):k>3?P(Z,F,Q):P(Z,F))||Q);return k>3&&Q&&Object.defineProperty(Z,F,Q),Q},h=this&&this.__param||function(A,Z){return function(F,W){Z(F,W,A)}};Object.defineProperty(g,"__esModule",{value:!0}),g.SelectionService=void 0;const E=b(9806),D=b(9504),p=b(456),B=b(4725),R=b(8460),v=b(844),L=b(6114),C=b(4841),S=b(511),f=b(2585),O=String.fromCharCode(160),M=new RegExp(O,"g");let m=g.SelectionService=class extends v.Disposable{constructor(A,Z,F,W,P,k,Q,V,K){super(),this._element=A,this._screenElement=Z,this._linkifier=F,this._bufferService=W,this._coreService=P,this._mouseService=k,this._optionsService=Q,this._renderService=V,this._coreBrowserService=K,this._dragScrollAmount=0,this._enabled=!0,this._workCell=new S.CellData,this._mouseDownTimeStamp=0,this._oldHasSelection=!1,this._oldSelectionStart=void 0,this._oldSelectionEnd=void 0,this._onLinuxMouseSelection=this.register(new R.EventEmitter),this.onLinuxMouseSelection=this._onLinuxMouseSelection.event,this._onRedrawRequest=this.register(new R.EventEmitter),this.onRequestRedraw=this._onRedrawRequest.event,this._onSelectionChange=this.register(new R.EventEmitter),this.onSelectionChange=this._onSelectionChange.event,this._onRequestScrollLines=this.register(new R.EventEmitter),this.onRequestScrollLines=this._onRequestScrollLines.event,this._mouseMoveListener=(T)=>this._handleMouseMove(T),this._mouseUpListener=(T)=>this._handleMouseUp(T),this._coreService.onUserInput(()=>{this.hasSelection&&this.clearSelection()}),this._trimListener=this._bufferService.buffer.lines.onTrim((T)=>this._handleTrim(T)),this.register(this._bufferService.buffers.onBufferActivate((T)=>this._handleBufferActivate(T))),this.enable(),this._model=new p.SelectionModel(this._bufferService),this._activeSelectionMode=0,this.register(v.toDisposable(()=>{this._removeMouseDownListeners()}))}reset(){this.clearSelection()}disable(){this.clearSelection(),this._enabled=!1}enable(){this._enabled=!0}get selectionStart(){return this._model.finalSelectionStart}get selectionEnd(){return this._model.finalSelectionEnd}get hasSelection(){const A=this._model.finalSelectionStart,Z=this._model.finalSelectionEnd;return!(!A||!Z||A[0]===Z[0]&&A[1]===Z[1])}get selectionText(){const A=this._model.finalSelectionStart,Z=this._model.finalSelectionEnd;if(!A||!Z)return"";const F=this._bufferService.buffer,W=[];if(this._activeSelectionMode===3){if(A[0]===Z[0])return"";const P=A[0]<Z[0]?A[0]:Z[0],k=A[0]<Z[0]?Z[0]:A[0];for(let Q=A[1];Q<=Z[1];Q++){const V=F.translateBufferLineToString(Q,!0,P,k);W.push(V)}}else{const P=A[1]===Z[1]?Z[0]:void 0;W.push(F.translateBufferLineToString(A[1],!0,A[0],P));for(let k=A[1]+1;k<=Z[1]-1;k++){const Q=F.lines.get(k),V=F.translateBufferLineToString(k,!0);(Q==null?void 0:Q.isWrapped)?W[W.length-1]+=V:W.push(V)}if(A[1]!==Z[1]){const k=F.lines.get(Z[1]),Q=F.translateBufferLineToString(Z[1],!0,0,Z[0]);k&&k.isWrapped?W[W.length-1]+=Q:W.push(Q)}}return W.map((P)=>P.replace(M," ")).join(L.isWindows?"\r\n":"\n")}clearSelection(){this._model.clearSelection(),this._removeMouseDownListeners(),this.refresh(),this._onSelectionChange.fire()}refresh(A){this._refreshAnimationFrame||(this._refreshAnimationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>this._refresh())),L.isLinux&&A&&this.selectionText.length&&this._onLinuxMouseSelection.fire(this.selectionText)}_refresh(){this._refreshAnimationFrame=void 0,this._onRedrawRequest.fire({start:this._model.finalSelectionStart,end:this._model.finalSelectionEnd,columnSelectMode:this._activeSelectionMode===3})}_isClickInSelection(A){const Z=this._getMouseBufferCoords(A),F=this._model.finalSelectionStart,W=this._model.finalSelectionEnd;return!!(F&&W&&Z)&&this._areCoordsInSelection(Z,F,W)}isCellInSelection(A,Z){const F=this._model.finalSelectionStart,W=this._model.finalSelectionEnd;return!(!F||!W)&&this._areCoordsInSelection([A,Z],F,W)}_areCoordsInSelection(A,Z,F){return A[1]>Z[1]&&A[1]<F[1]||Z[1]===F[1]&&A[1]===Z[1]&&A[0]>=Z[0]&&A[0]<F[0]||Z[1]<F[1]&&A[1]===F[1]&&A[0]<F[0]||Z[1]<F[1]&&A[1]===Z[1]&&A[0]>=Z[0]}_selectWordAtCursor(A,Z){var F,W;const P=(W=(F=this._linkifier.currentLink)===null||F===void 0?void 0:F.link)===null||W===void 0?void 0:W.range;if(P)return this._model.selectionStart=[P.start.x-1,P.start.y-1],this._model.selectionStartLength=C.getRangeLength(P,this._bufferService.cols),this._model.selectionEnd=void 0,!0;const k=this._getMouseBufferCoords(A);return!!k&&(this._selectWordAt(k,Z),this._model.selectionEnd=void 0,!0)}selectAll(){this._model.isSelectAllActive=!0,this.refresh(),this._onSelectionChange.fire()}selectLines(A,Z){this._model.clearSelection(),A=Math.max(A,0),Z=Math.min(Z,this._bufferService.buffer.lines.length-1),this._model.selectionStart=[0,A],this._model.selectionEnd=[this._bufferService.cols,Z],this.refresh(),this._onSelectionChange.fire()}_handleTrim(A){this._model.handleTrim(A)&&this.refresh()}_getMouseBufferCoords(A){const Z=this._mouseService.getCoords(A,this._screenElement,this._bufferService.cols,this._bufferService.rows,!0);if(Z)return Z[0]--,Z[1]--,Z[1]+=this._bufferService.buffer.ydisp,Z}_getMouseEventScrollAmount(A){let Z=E.getCoordsRelativeToElement(this._coreBrowserService.window,A,this._screenElement)[1];const F=this._renderService.dimensions.css.canvas.height;return Z>=0&&Z<=F?0:(Z>F&&(Z-=F),Z=Math.min(Math.max(Z,-50),50),Z/=50,Z/Math.abs(Z)+Math.round(14*Z))}shouldForceSelection(A){return L.isMac?A.altKey&&this._optionsService.rawOptions.macOptionClickForcesSelection:A.shiftKey}handleMouseDown(A){if(this._mouseDownTimeStamp=A.timeStamp,(A.button!==2||!this.hasSelection)&&A.button===0){if(!this._enabled){if(!this.shouldForceSelection(A))return;A.stopPropagation()}A.preventDefault(),this._dragScrollAmount=0,this._enabled&&A.shiftKey?this._handleIncrementalClick(A):A.detail===1?this._handleSingleClick(A):A.detail===2?this._handleDoubleClick(A):A.detail===3&&this._handleTripleClick(A),this._addMouseDownListeners(),this.refresh(!0)}}_addMouseDownListeners(){this._screenElement.ownerDocument&&(this._screenElement.ownerDocument.addEventListener("mousemove",this._mouseMoveListener),this._screenElement.ownerDocument.addEventListener("mouseup",this._mouseUpListener)),this._dragScrollIntervalTimer=this._coreBrowserService.window.setInterval(()=>this._dragScroll(),50)}_removeMouseDownListeners(){this._screenElement.ownerDocument&&(this._screenElement.ownerDocument.removeEventListener("mousemove",this._mouseMoveListener),this._screenElement.ownerDocument.removeEventListener("mouseup",this._mouseUpListener)),this._coreBrowserService.window.clearInterval(this._dragScrollIntervalTimer),this._dragScrollIntervalTimer=void 0}_handleIncrementalClick(A){this._model.selectionStart&&(this._model.selectionEnd=this._getMouseBufferCoords(A))}_handleSingleClick(A){if(this._model.selectionStartLength=0,this._model.isSelectAllActive=!1,this._activeSelectionMode=this.shouldColumnSelect(A)?3:0,this._model.selectionStart=this._getMouseBufferCoords(A),!this._model.selectionStart)return;this._model.selectionEnd=void 0;const Z=this._bufferService.buffer.lines.get(this._model.selectionStart[1]);Z&&Z.length!==this._model.selectionStart[0]&&Z.hasWidth(this._model.selectionStart[0])===0&&this._model.selectionStart[0]++}_handleDoubleClick(A){this._selectWordAtCursor(A,!0)&&(this._activeSelectionMode=1)}_handleTripleClick(A){const Z=this._getMouseBufferCoords(A);Z&&(this._activeSelectionMode=2,this._selectLineAt(Z[1]))}shouldColumnSelect(A){return A.altKey&&!(L.isMac&&this._optionsService.rawOptions.macOptionClickForcesSelection)}_handleMouseMove(A){if(A.stopImmediatePropagation(),!this._model.selectionStart)return;const Z=this._model.selectionEnd?[this._model.selectionEnd[0],this._model.selectionEnd[1]]:null;if(this._model.selectionEnd=this._getMouseBufferCoords(A),!this._model.selectionEnd)return void this.refresh(!0);this._activeSelectionMode===2?this._model.selectionEnd[1]<this._model.selectionStart[1]?this._model.selectionEnd[0]=0:this._model.selectionEnd[0]=this._bufferService.cols:this._activeSelectionMode===1&&this._selectToWordAt(this._model.selectionEnd),this._dragScrollAmount=this._getMouseEventScrollAmount(A),this._activeSelectionMode!==3&&(this._dragScrollAmount>0?this._model.selectionEnd[0]=this._bufferService.cols:this._dragScrollAmount<0&&(this._model.selectionEnd[0]=0));const F=this._bufferService.buffer;if(this._model.selectionEnd[1]<F.lines.length){const W=F.lines.get(this._model.selectionEnd[1]);W&&W.hasWidth(this._model.selectionEnd[0])===0&&this._model.selectionEnd[0]++}Z&&Z[0]===this._model.selectionEnd[0]&&Z[1]===this._model.selectionEnd[1]||this.refresh(!0)}_dragScroll(){if(this._model.selectionEnd&&this._model.selectionStart&&this._dragScrollAmount){this._onRequestScrollLines.fire({amount:this._dragScrollAmount,suppressScrollEvent:!1});const A=this._bufferService.buffer;this._dragScrollAmount>0?(this._activeSelectionMode!==3&&(this._model.selectionEnd[0]=this._bufferService.cols),this._model.selectionEnd[1]=Math.min(A.ydisp+this._bufferService.rows,A.lines.length-1)):(this._activeSelectionMode!==3&&(this._model.selectionEnd[0]=0),this._model.selectionEnd[1]=A.ydisp),this.refresh()}}_handleMouseUp(A){const Z=A.timeStamp-this._mouseDownTimeStamp;if(this._removeMouseDownListeners(),this.selectionText.length<=1&&Z<500&&A.altKey&&this._optionsService.rawOptions.altClickMovesCursor){if(this._bufferService.buffer.ybase===this._bufferService.buffer.ydisp){const F=this._mouseService.getCoords(A,this._element,this._bufferService.cols,this._bufferService.rows,!1);if(F&&F[0]!==void 0&&F[1]!==void 0){const W=D.moveToCellSequence(F[0]-1,F[1]-1,this._bufferService,this._coreService.decPrivateModes.applicationCursorKeys);this._coreService.triggerDataEvent(W,!0)}}}else this._fireEventIfSelectionChanged()}_fireEventIfSelectionChanged(){const A=this._model.finalSelectionStart,Z=this._model.finalSelectionEnd,F=!(!A||!Z||A[0]===Z[0]&&A[1]===Z[1]);F?A&&Z&&(this._oldSelectionStart&&this._oldSelectionEnd&&A[0]===this._oldSelectionStart[0]&&A[1]===this._oldSelectionStart[1]&&Z[0]===this._oldSelectionEnd[0]&&Z[1]===this._oldSelectionEnd[1]||this._fireOnSelectionChange(A,Z,F)):this._oldHasSelection&&this._fireOnSelectionChange(A,Z,F)}_fireOnSelectionChange(A,Z,F){this._oldSelectionStart=A,this._oldSelectionEnd=Z,this._oldHasSelection=F,this._onSelectionChange.fire()}_handleBufferActivate(A){this.clearSelection(),this._trimListener.dispose(),this._trimListener=A.activeBuffer.lines.onTrim((Z)=>this._handleTrim(Z))}_convertViewportColToCharacterIndex(A,Z){let F=Z;for(let W=0;Z>=W;W++){const P=A.loadCell(W,this._workCell).getChars().length;this._workCell.getWidth()===0?F--:P>1&&Z!==W&&(F+=P-1)}return F}setSelection(A,Z,F){this._model.clearSelection(),this._removeMouseDownListeners(),this._model.selectionStart=[A,Z],this._model.selectionStartLength=F,this.refresh(),this._fireEventIfSelectionChanged()}rightClickSelect(A){this._isClickInSelection(A)||(this._selectWordAtCursor(A,!1)&&this.refresh(!0),this._fireEventIfSelectionChanged())}_getWordAt(A,Z,F=!0,W=!0){if(A[0]>=this._bufferService.cols)return;const P=this._bufferService.buffer,k=P.lines.get(A[1]);if(!k)return;const Q=P.translateBufferLineToString(A[1],!1);let V=this._convertViewportColToCharacterIndex(k,A[0]),K=V;const T=A[0]-V;let Y=0,J=0,_=0,N=0;if(Q.charAt(V)===" "){for(;V>0&&Q.charAt(V-1)===" ";)V--;for(;K<Q.length&&Q.charAt(K+1)===" ";)K++}else{let w=A[0],d=A[0];k.getWidth(w)===0&&(Y++,w--),k.getWidth(d)===2&&(J++,d++);const X=k.getString(d).length;for(X>1&&(N+=X-1,K+=X-1);w>0&&V>0&&!this._isCharWordSeparator(k.loadCell(w-1,this._workCell));){k.loadCell(w-1,this._workCell);const u=this._workCell.getChars().length;this._workCell.getWidth()===0?(Y++,w--):u>1&&(_+=u-1,V-=u-1),V--,w--}for(;d<k.length&&K+1<Q.length&&!this._isCharWordSeparator(k.loadCell(d+1,this._workCell));){k.loadCell(d+1,this._workCell);const u=this._workCell.getChars().length;this._workCell.getWidth()===2?(J++,d++):u>1&&(N+=u-1,K+=u-1),K++,d++}}K++;let I=V+T-Y+_,$=Math.min(this._bufferService.cols,K-V+Y+J-_-N);if(Z||Q.slice(V,K).trim()!==""){if(F&&I===0&&k.getCodePoint(0)!==32){const w=P.lines.get(A[1]-1);if(w&&k.isWrapped&&w.getCodePoint(this._bufferService.cols-1)!==32){const d=this._getWordAt([this._bufferService.cols-1,A[1]-1],!1,!0,!1);if(d){const X=this._bufferService.cols-d.start;I-=X,$+=X}}}if(W&&I+$===this._bufferService.cols&&k.getCodePoint(this._bufferService.cols-1)!==32){const w=P.lines.get(A[1]+1);if((w==null?void 0:w.isWrapped)&&w.getCodePoint(0)!==32){const d=this._getWordAt([0,A[1]+1],!1,!1,!0);d&&($+=d.length)}}return{start:I,length:$}}}_selectWordAt(A,Z){const F=this._getWordAt(A,Z);if(F){for(;F.start<0;)F.start+=this._bufferService.cols,A[1]--;this._model.selectionStart=[F.start,A[1]],this._model.selectionStartLength=F.length}}_selectToWordAt(A){const Z=this._getWordAt(A,!0);if(Z){let F=A[1];for(;Z.start<0;)Z.start+=this._bufferService.cols,F--;if(!this._model.areSelectionValuesReversed())for(;Z.start+Z.length>this._bufferService.cols;)Z.length-=this._bufferService.cols,F++;this._model.selectionEnd=[this._model.areSelectionValuesReversed()?Z.start:Z.start+Z.length,F]}}_isCharWordSeparator(A){return A.getWidth()!==0&&this._optionsService.rawOptions.wordSeparator.indexOf(A.getChars())>=0}_selectLineAt(A){const Z=this._bufferService.buffer.getWrappedRangeForLine(A),F={start:{x:0,y:Z.first},end:{x:this._bufferService.cols-1,y:Z.last}};this._model.selectionStart=[0,Z.first],this._model.selectionEnd=void 0,this._model.selectionStartLength=C.getRangeLength(F,this._bufferService.cols)}};g.SelectionService=m=H([h(3,f.IBufferService),h(4,f.ICoreService),h(5,B.IMouseService),h(6,f.IOptionsService),h(7,B.IRenderService),h(8,B.ICoreBrowserService)],m)},4725:(U,g,b)=>{Object.defineProperty(g,"__esModule",{value:!0}),g.IThemeService=g.ICharacterJoinerService=g.ISelectionService=g.IRenderService=g.IMouseService=g.ICoreBrowserService=g.ICharSizeService=void 0;const H=b(8343);g.ICharSizeService=H.createDecorator("CharSizeService"),g.ICoreBrowserService=H.createDecorator("CoreBrowserService"),g.IMouseService=H.createDecorator("MouseService"),g.IRenderService=H.createDecorator("RenderService"),g.ISelectionService=H.createDecorator("SelectionService"),g.ICharacterJoinerService=H.createDecorator("CharacterJoinerService"),g.IThemeService=H.createDecorator("ThemeService")},6731:function(U,g,b){var H=this&&this.__decorate||function(m,A,Z,F){var W,P=arguments.length,k=P<3?A:F===null?F=Object.getOwnPropertyDescriptor(A,Z):F;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")k=Reflect.decorate(m,A,Z,F);else for(var Q=m.length-1;Q>=0;Q--)(W=m[Q])&&(k=(P<3?W(k):P>3?W(A,Z,k):W(A,Z))||k);return P>3&&k&&Object.defineProperty(A,Z,k),k},h=this&&this.__param||function(m,A){return function(Z,F){A(Z,F,m)}};Object.defineProperty(g,"__esModule",{value:!0}),g.ThemeService=g.DEFAULT_ANSI_COLORS=void 0;const E=b(7239),D=b(8055),p=b(8460),B=b(844),R=b(2585),v=D.css.toColor("#ffffff"),L=D.css.toColor("#000000"),C=D.css.toColor("#ffffff"),S=D.css.toColor("#000000"),f={css:"rgba(255, 255, 255, 0.3)",rgba:4294967117};g.DEFAULT_ANSI_COLORS=Object.freeze((()=>{const m=[D.css.toColor("#2e3436"),D.css.toColor("#cc0000"),D.css.toColor("#4e9a06"),D.css.toColor("#c4a000"),D.css.toColor("#3465a4"),D.css.toColor("#75507b"),D.css.toColor("#06989a"),D.css.toColor("#d3d7cf"),D.css.toColor("#555753"),D.css.toColor("#ef2929"),D.css.toColor("#8ae234"),D.css.toColor("#fce94f"),D.css.toColor("#729fcf"),D.css.toColor("#ad7fa8"),D.css.toColor("#34e2e2"),D.css.toColor("#eeeeec")],A=[0,95,135,175,215,255];for(let Z=0;Z<216;Z++){const F=A[Z/36%6|0],W=A[Z/6%6|0],P=A[Z%6];m.push({css:D.channels.toCss(F,W,P),rgba:D.channels.toRgba(F,W,P)})}for(let Z=0;Z<24;Z++){const F=8+10*Z;m.push({css:D.channels.toCss(F,F,F),rgba:D.channels.toRgba(F,F,F)})}return m})());let O=g.ThemeService=class extends B.Disposable{get colors(){return this._colors}constructor(m){super(),this._optionsService=m,this._contrastCache=new E.ColorContrastCache,this._halfContrastCache=new E.ColorContrastCache,this._onChangeColors=this.register(new p.EventEmitter),this.onChangeColors=this._onChangeColors.event,this._colors={foreground:v,background:L,cursor:C,cursorAccent:S,selectionForeground:void 0,selectionBackgroundTransparent:f,selectionBackgroundOpaque:D.color.blend(L,f),selectionInactiveBackgroundTransparent:f,selectionInactiveBackgroundOpaque:D.color.blend(L,f),ansi:g.DEFAULT_ANSI_COLORS.slice(),contrastCache:this._contrastCache,halfContrastCache:this._halfContrastCache},this._updateRestoreColors(),this._setTheme(this._optionsService.rawOptions.theme),this.register(this._optionsService.onSpecificOptionChange("minimumContrastRatio",()=>this._contrastCache.clear())),this.register(this._optionsService.onSpecificOptionChange("theme",()=>this._setTheme(this._optionsService.rawOptions.theme)))}_setTheme(m={}){const A=this._colors;if(A.foreground=M(m.foreground,v),A.background=M(m.background,L),A.cursor=M(m.cursor,C),A.cursorAccent=M(m.cursorAccent,S),A.selectionBackgroundTransparent=M(m.selectionBackground,f),A.selectionBackgroundOpaque=D.color.blend(A.background,A.selectionBackgroundTransparent),A.selectionInactiveBackgroundTransparent=M(m.selectionInactiveBackground,A.selectionBackgroundTransparent),A.selectionInactiveBackgroundOpaque=D.color.blend(A.background,A.selectionInactiveBackgroundTransparent),A.selectionForeground=m.selectionForeground?M(m.selectionForeground,D.NULL_COLOR):void 0,A.selectionForeground===D.NULL_COLOR&&(A.selectionForeground=void 0),D.color.isOpaque(A.selectionBackgroundTransparent))A.selectionBackgroundTransparent=D.color.opacity(A.selectionBackgroundTransparent,0.3);if(D.color.isOpaque(A.selectionInactiveBackgroundTransparent))A.selectionInactiveBackgroundTransparent=D.color.opacity(A.selectionInactiveBackgroundTransparent,0.3);if(A.ansi=g.DEFAULT_ANSI_COLORS.slice(),A.ansi[0]=M(m.black,g.DEFAULT_ANSI_COLORS[0]),A.ansi[1]=M(m.red,g.DEFAULT_ANSI_COLORS[1]),A.ansi[2]=M(m.green,g.DEFAULT_ANSI_COLORS[2]),A.ansi[3]=M(m.yellow,g.DEFAULT_ANSI_COLORS[3]),A.ansi[4]=M(m.blue,g.DEFAULT_ANSI_COLORS[4]),A.ansi[5]=M(m.magenta,g.DEFAULT_ANSI_COLORS[5]),A.ansi[6]=M(m.cyan,g.DEFAULT_ANSI_COLORS[6]),A.ansi[7]=M(m.white,g.DEFAULT_ANSI_COLORS[7]),A.ansi[8]=M(m.brightBlack,g.DEFAULT_ANSI_COLORS[8]),A.ansi[9]=M(m.brightRed,g.DEFAULT_ANSI_COLORS[9]),A.ansi[10]=M(m.brightGreen,g.DEFAULT_ANSI_COLORS[10]),A.ansi[11]=M(m.brightYellow,g.DEFAULT_ANSI_COLORS[11]),A.ansi[12]=M(m.brightBlue,g.DEFAULT_ANSI_COLORS[12]),A.ansi[13]=M(m.brightMagenta,g.DEFAULT_ANSI_COLORS[13]),A.ansi[14]=M(m.brightCyan,g.DEFAULT_ANSI_COLORS[14]),A.ansi[15]=M(m.brightWhite,g.DEFAULT_ANSI_COLORS[15]),m.extendedAnsi){const Z=Math.min(A.ansi.length-16,m.extendedAnsi.length);for(let F=0;F<Z;F++)A.ansi[F+16]=M(m.extendedAnsi[F],g.DEFAULT_ANSI_COLORS[F+16])}this._contrastCache.clear(),this._halfContrastCache.clear(),this._updateRestoreColors(),this._onChangeColors.fire(this.colors)}restoreColor(m){this._restoreColor(m),this._onChangeColors.fire(this.colors)}_restoreColor(m){if(m!==void 0)switch(m){case 256:this._colors.foreground=this._restoreColors.foreground;break;case 257:this._colors.background=this._restoreColors.background;break;case 258:this._colors.cursor=this._restoreColors.cursor;break;default:this._colors.ansi[m]=this._restoreColors.ansi[m]}else for(let A=0;A<this._restoreColors.ansi.length;++A)this._colors.ansi[A]=this._restoreColors.ansi[A]}modifyColors(m){m(this._colors),this._onChangeColors.fire(this.colors)}_updateRestoreColors(){this._restoreColors={foreground:this._colors.foreground,background:this._colors.background,cursor:this._colors.cursor,ansi:this._colors.ansi.slice()}}};function M(m,A){if(m!==void 0)try{return D.css.toColor(m)}catch(Z){}return A}g.ThemeService=O=H([h(0,R.IOptionsService)],O)},6349:(U,g,b)=>{Object.defineProperty(g,"__esModule",{value:!0}),g.CircularList=void 0;const H=b(8460),h=b(844);class E extends h.Disposable{constructor(D){super(),this._maxLength=D,this.onDeleteEmitter=this.register(new H.EventEmitter),this.onDelete=this.onDeleteEmitter.event,this.onInsertEmitter=this.register(new H.EventEmitter),this.onInsert=this.onInsertEmitter.event,this.onTrimEmitter=this.register(new H.EventEmitter),this.onTrim=this.onTrimEmitter.event,this._array=new Array(this._maxLength),this._startIndex=0,this._length=0}get maxLength(){return this._maxLength}set maxLength(D){if(this._maxLength===D)return;const p=new Array(D);for(let B=0;B<Math.min(D,this.length);B++)p[B]=this._array[this._getCyclicIndex(B)];this._array=p,this._maxLength=D,this._startIndex=0}get length(){return this._length}set length(D){if(D>this._length)for(let p=this._length;p<D;p++)this._array[p]=void 0;this._length=D}get(D){return this._array[this._getCyclicIndex(D)]}set(D,p){this._array[this._getCyclicIndex(D)]=p}push(D){this._array[this._getCyclicIndex(this._length)]=D,this._length===this._maxLength?(this._startIndex=++this._startIndex%this._maxLength,this.onTrimEmitter.fire(1)):this._length++}recycle(){if(this._length!==this._maxLength)throw new Error("Can only recycle when the buffer is full");return this._startIndex=++this._startIndex%this._maxLength,this.onTrimEmitter.fire(1),this._array[this._getCyclicIndex(this._length-1)]}get isFull(){return this._length===this._maxLength}pop(){return this._array[this._getCyclicIndex(this._length---1)]}splice(D,p,...B){if(p){for(let R=D;R<this._length-p;R++)this._array[this._getCyclicIndex(R)]=this._array[this._getCyclicIndex(R+p)];this._length-=p,this.onDeleteEmitter.fire({index:D,amount:p})}for(let R=this._length-1;R>=D;R--)this._array[this._getCyclicIndex(R+B.length)]=this._array[this._getCyclicIndex(R)];for(let R=0;R<B.length;R++)this._array[this._getCyclicIndex(D+R)]=B[R];if(B.length&&this.onInsertEmitter.fire({index:D,amount:B.length}),this._length+B.length>this._maxLength){const R=this._length+B.length-this._maxLength;this._startIndex+=R,this._length=this._maxLength,this.onTrimEmitter.fire(R)}else this._length+=B.length}trimStart(D){D>this._length&&(D=this._length),this._startIndex+=D,this._length-=D,this.onTrimEmitter.fire(D)}shiftElements(D,p,B){if(!(p<=0)){if(D<0||D>=this._length)throw new Error("start argument out of range");if(D+B<0)throw new Error("Cannot shift elements in list beyond index 0");if(B>0){for(let v=p-1;v>=0;v--)this.set(D+v+B,this.get(D+v));const R=D+p+B-this._length;if(R>0)for(this._length+=R;this._length>this._maxLength;)this._length--,this._startIndex++,this.onTrimEmitter.fire(1)}else for(let R=0;R<p;R++)this.set(D+R+B,this.get(D+R))}}_getCyclicIndex(D){return(this._startIndex+D)%this._maxLength}}g.CircularList=E},1439:(U,g)=>{Object.defineProperty(g,"__esModule",{value:!0}),g.clone=void 0,g.clone=function b(H,h=5){if(typeof H!="object")return H;const E=Array.isArray(H)?[]:{};for(let D in H)E[D]=h<=1?H[D]:H[D]&&b(H[D],h-1);return E}},8055:(U,g,b)=>{Object.defineProperty(g,"__esModule",{value:!0}),g.contrastRatio=g.toPaddedHex=g.rgba=g.rgb=g.css=g.color=g.channels=g.NULL_COLOR=void 0;const H=b(6114);let h=0,E=0,D=0,p=0;var B,R,v,L,C;function S(O){const M=O.toString(16);return M.length<2?"0"+M:M}function f(O,M){return O<M?(M+0.05)/(O+0.05):(O+0.05)/(M+0.05)}g.NULL_COLOR={css:"#00000000",rgba:0},function(O){O.toCss=function(M,m,A,Z){return Z!==void 0?`#${S(M)}${S(m)}${S(A)}${S(Z)}`:`#${S(M)}${S(m)}${S(A)}`},O.toRgba=function(M,m,A,Z=255){return(M<<24|m<<16|A<<8|Z)>>>0}}(B||(g.channels=B={})),function(O){function M(m,A){return p=Math.round(255*A),[h,E,D]=C.toChannels(m.rgba),{css:B.toCss(h,E,D,p),rgba:B.toRgba(h,E,D,p)}}O.blend=function(m,A){if(p=(255&A.rgba)/255,p===1)return{css:A.css,rgba:A.rgba};const Z=A.rgba>>24&255,F=A.rgba>>16&255,W=A.rgba>>8&255,P=m.rgba>>24&255,k=m.rgba>>16&255,Q=m.rgba>>8&255;return h=P+Math.round((Z-P)*p),E=k+Math.round((F-k)*p),D=Q+Math.round((W-Q)*p),{css:B.toCss(h,E,D),rgba:B.toRgba(h,E,D)}},O.isOpaque=function(m){return(255&m.rgba)==255},O.ensureContrastRatio=function(m,A,Z){const F=C.ensureContrastRatio(m.rgba,A.rgba,Z);if(F)return C.toColor(F>>24&255,F>>16&255,F>>8&255)},O.opaque=function(m){const A=(255|m.rgba)>>>0;return[h,E,D]=C.toChannels(A),{css:B.toCss(h,E,D),rgba:A}},O.opacity=M,O.multiplyOpacity=function(m,A){return p=255&m.rgba,M(m,p*A/255)},O.toColorRGB=function(m){return[m.rgba>>24&255,m.rgba>>16&255,m.rgba>>8&255]}}(R||(g.color=R={})),function(O){let M,m;if(!H.isNode){const A=document.createElement("canvas");A.width=1,A.height=1;const Z=A.getContext("2d",{willReadFrequently:!0});Z&&(M=Z,M.globalCompositeOperation="copy",m=M.createLinearGradient(0,0,1,1))}O.toColor=function(A){if(A.match(/#[\da-f]{3,8}/i))switch(A.length){case 4:return h=parseInt(A.slice(1,2).repeat(2),16),E=parseInt(A.slice(2,3).repeat(2),16),D=parseInt(A.slice(3,4).repeat(2),16),C.toColor(h,E,D);case 5:return h=parseInt(A.slice(1,2).repeat(2),16),E=parseInt(A.slice(2,3).repeat(2),16),D=parseInt(A.slice(3,4).repeat(2),16),p=parseInt(A.slice(4,5).repeat(2),16),C.toColor(h,E,D,p);case 7:return{css:A,rgba:(parseInt(A.slice(1),16)<<8|255)>>>0};case 9:return{css:A,rgba:parseInt(A.slice(1),16)>>>0}}const Z=A.match(/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(,\s*(0|1|\d?\.(\d+))\s*)?\)/);if(Z)return h=parseInt(Z[1]),E=parseInt(Z[2]),D=parseInt(Z[3]),p=Math.round(255*(Z[5]===void 0?1:parseFloat(Z[5]))),C.toColor(h,E,D,p);if(!M||!m)throw new Error("css.toColor: Unsupported css format");if(M.fillStyle=m,M.fillStyle=A,typeof M.fillStyle!="string")throw new Error("css.toColor: Unsupported css format");if(M.fillRect(0,0,1,1),[h,E,D,p]=M.getImageData(0,0,1,1).data,p!==255)throw new Error("css.toColor: Unsupported css format");return{rgba:B.toRgba(h,E,D,p),css:A}}}(v||(g.css=v={})),function(O){function M(m,A,Z){const F=m/255,W=A/255,P=Z/255;return 0.2126*(F<=0.03928?F/12.92:Math.pow((F+0.055)/1.055,2.4))+0.7152*(W<=0.03928?W/12.92:Math.pow((W+0.055)/1.055,2.4))+0.0722*(P<=0.03928?P/12.92:Math.pow((P+0.055)/1.055,2.4))}O.relativeLuminance=function(m){return M(m>>16&255,m>>8&255,255&m)},O.relativeLuminance2=M}(L||(g.rgb=L={})),function(O){function M(A,Z,F){const W=A>>24&255,P=A>>16&255,k=A>>8&255;let Q=Z>>24&255,V=Z>>16&255,K=Z>>8&255,T=f(L.relativeLuminance2(Q,V,K),L.relativeLuminance2(W,P,k));for(;T<F&&(Q>0||V>0||K>0);)Q-=Math.max(0,Math.ceil(0.1*Q)),V-=Math.max(0,Math.ceil(0.1*V)),K-=Math.max(0,Math.ceil(0.1*K)),T=f(L.relativeLuminance2(Q,V,K),L.relativeLuminance2(W,P,k));return(Q<<24|V<<16|K<<8|255)>>>0}function m(A,Z,F){const W=A>>24&255,P=A>>16&255,k=A>>8&255;let Q=Z>>24&255,V=Z>>16&255,K=Z>>8&255,T=f(L.relativeLuminance2(Q,V,K),L.relativeLuminance2(W,P,k));for(;T<F&&(Q<255||V<255||K<255);)Q=Math.min(255,Q+Math.ceil(0.1*(255-Q))),V=Math.min(255,V+Math.ceil(0.1*(255-V))),K=Math.min(255,K+Math.ceil(0.1*(255-K))),T=f(L.relativeLuminance2(Q,V,K),L.relativeLuminance2(W,P,k));return(Q<<24|V<<16|K<<8|255)>>>0}O.ensureContrastRatio=function(A,Z,F){const W=L.relativeLuminance(A>>8),P=L.relativeLuminance(Z>>8);if(f(W,P)<F){if(P<W){const V=M(A,Z,F),K=f(W,L.relativeLuminance(V>>8));if(K<F){const T=m(A,Z,F);return K>f(W,L.relativeLuminance(T>>8))?V:T}return V}const k=m(A,Z,F),Q=f(W,L.relativeLuminance(k>>8));if(Q<F){const V=M(A,Z,F);return Q>f(W,L.relativeLuminance(V>>8))?k:V}return k}},O.reduceLuminance=M,O.increaseLuminance=m,O.toChannels=function(A){return[A>>24&255,A>>16&255,A>>8&255,255&A]},O.toColor=function(A,Z,F,W){return{css:B.toCss(A,Z,F,W),rgba:B.toRgba(A,Z,F,W)}}}(C||(g.rgba=C={})),g.toPaddedHex=S,g.contrastRatio=f},8969:(U,g,b)=>{Object.defineProperty(g,"__esModule",{value:!0}),g.CoreTerminal=void 0;const H=b(844),h=b(2585),E=b(4348),D=b(7866),p=b(744),B=b(7302),R=b(6975),v=b(8460),L=b(1753),C=b(1480),S=b(7994),f=b(9282),O=b(5435),M=b(5981),m=b(2660);let A=!1;class Z extends H.Disposable{get onScroll(){return this._onScrollApi||(this._onScrollApi=this.register(new v.EventEmitter),this._onScroll.event((F)=>{var W;(W=this._onScrollApi)===null||W===void 0||W.fire(F.position)})),this._onScrollApi.event}get cols(){return this._bufferService.cols}get rows(){return this._bufferService.rows}get buffers(){return this._bufferService.buffers}get options(){return this.optionsService.options}set options(F){for(let W in F)this.optionsService.options[W]=F[W]}constructor(F){super(),this._windowsWrappingHeuristics=this.register(new H.MutableDisposable),this._onBinary=this.register(new v.EventEmitter),this.onBinary=this._onBinary.event,this._onData=this.register(new v.EventEmitter),this.onData=this._onData.event,this._onLineFeed=this.register(new v.EventEmitter),this.onLineFeed=this._onLineFeed.event,this._onResize=this.register(new v.EventEmitter),this.onResize=this._onResize.event,this._onWriteParsed=this.register(new v.EventEmitter),this.onWriteParsed=this._onWriteParsed.event,this._onScroll=this.register(new v.EventEmitter),this._instantiationService=new E.InstantiationService,this.optionsService=this.register(new B.OptionsService(F)),this._instantiationService.setService(h.IOptionsService,this.optionsService),this._bufferService=this.register(this._instantiationService.createInstance(p.BufferService)),this._instantiationService.setService(h.IBufferService,this._bufferService),this._logService=this.register(this._instantiationService.createInstance(D.LogService)),this._instantiationService.setService(h.ILogService,this._logService),this.coreService=this.register(this._instantiationService.createInstance(R.CoreService)),this._instantiationService.setService(h.ICoreService,this.coreService),this.coreMouseService=this.register(this._instantiationService.createInstance(L.CoreMouseService)),this._instantiationService.setService(h.ICoreMouseService,this.coreMouseService),this.unicodeService=this.register(this._instantiationService.createInstance(C.UnicodeService)),this._instantiationService.setService(h.IUnicodeService,this.unicodeService),this._charsetService=this._instantiationService.createInstance(S.CharsetService),this._instantiationService.setService(h.ICharsetService,this._charsetService),this._oscLinkService=this._instantiationService.createInstance(m.OscLinkService),this._instantiationService.setService(h.IOscLinkService,this._oscLinkService),this._inputHandler=this.register(new O.InputHandler(this._bufferService,this._charsetService,this.coreService,this._logService,this.optionsService,this._oscLinkService,this.coreMouseService,this.unicodeService)),this.register(v.forwardEvent(this._inputHandler.onLineFeed,this._onLineFeed)),this.register(this._inputHandler),this.register(v.forwardEvent(this._bufferService.onResize,this._onResize)),this.register(v.forwardEvent(this.coreService.onData,this._onData)),this.register(v.forwardEvent(this.coreService.onBinary,this._onBinary)),this.register(this.coreService.onRequestScrollToBottom(()=>this.scrollToBottom())),this.register(this.coreService.onUserInput(()=>this._writeBuffer.handleUserInput())),this.register(this.optionsService.onMultipleOptionChange(["windowsMode","windowsPty"],()=>this._handleWindowsPtyOptionChange())),this.register(this._bufferService.onScroll((W)=>{this._onScroll.fire({position:this._bufferService.buffer.ydisp,source:0}),this._inputHandler.markRangeDirty(this._bufferService.buffer.scrollTop,this._bufferService.buffer.scrollBottom)})),this.register(this._inputHandler.onScroll((W)=>{this._onScroll.fire({position:this._bufferService.buffer.ydisp,source:0}),this._inputHandler.markRangeDirty(this._bufferService.buffer.scrollTop,this._bufferService.buffer.scrollBottom)})),this._writeBuffer=this.register(new M.WriteBuffer((W,P)=>this._inputHandler.parse(W,P))),this.register(v.forwardEvent(this._writeBuffer.onWriteParsed,this._onWriteParsed))}write(F,W){this._writeBuffer.write(F,W)}writeSync(F,W){this._logService.logLevel<=h.LogLevelEnum.WARN&&!A&&(this._logService.warn("writeSync is unreliable and will be removed soon."),A=!0),this._writeBuffer.writeSync(F,W)}resize(F,W){isNaN(F)||isNaN(W)||(F=Math.max(F,p.MINIMUM_COLS),W=Math.max(W,p.MINIMUM_ROWS),this._bufferService.resize(F,W))}scroll(F,W=!1){this._bufferService.scroll(F,W)}scrollLines(F,W,P){this._bufferService.scrollLines(F,W,P)}scrollPages(F){this.scrollLines(F*(this.rows-1))}scrollToTop(){this.scrollLines(-this._bufferService.buffer.ydisp)}scrollToBottom(){this.scrollLines(this._bufferService.buffer.ybase-this._bufferService.buffer.ydisp)}scrollToLine(F){const W=F-this._bufferService.buffer.ydisp;W!==0&&this.scrollLines(W)}registerEscHandler(F,W){return this._inputHandler.registerEscHandler(F,W)}registerDcsHandler(F,W){return this._inputHandler.registerDcsHandler(F,W)}registerCsiHandler(F,W){return this._inputHandler.registerCsiHandler(F,W)}registerOscHandler(F,W){return this._inputHandler.registerOscHandler(F,W)}_setup(){this._handleWindowsPtyOptionChange()}reset(){this._inputHandler.reset(),this._bufferService.reset(),this._charsetService.reset(),this.coreService.reset(),this.coreMouseService.reset()}_handleWindowsPtyOptionChange(){let F=!1;const W=this.optionsService.rawOptions.windowsPty;W&&W.buildNumber!==void 0&&W.buildNumber!==void 0?F=W.backend==="conpty"&&W.buildNumber<21376:this.optionsService.rawOptions.windowsMode&&(F=!0),F?this._enableWindowsWrappingHeuristics():this._windowsWrappingHeuristics.clear()}_enableWindowsWrappingHeuristics(){if(!this._windowsWrappingHeuristics.value){const F=[];F.push(this.onLineFeed(f.updateWindowsModeWrappedState.bind(null,this._bufferService))),F.push(this.registerCsiHandler({final:"H"},()=>(f.updateWindowsModeWrappedState(this._bufferService),!1))),this._windowsWrappingHeuristics.value=H.toDisposable(()=>{for(let W of F)W.dispose()})}}}g.CoreTerminal=Z},8460:(U,g)=>{Object.defineProperty(g,"__esModule",{value:!0}),g.forwardEvent=g.EventEmitter=void 0,g.EventEmitter=class{constructor(){this._listeners=[],this._disposed=!1}get event(){return this._event||(this._event=(b)=>(this._listeners.push(b),{dispose:()=>{if(!this._disposed){for(let H=0;H<this._listeners.length;H++)if(this._listeners[H]===b)return void this._listeners.splice(H,1)}}})),this._event}fire(b,H){const h=[];for(let E=0;E<this._listeners.length;E++)h.push(this._listeners[E]);for(let E=0;E<h.length;E++)h[E].call(void 0,b,H)}dispose(){this.clearListeners(),this._disposed=!0}clearListeners(){this._listeners&&(this._listeners.length=0)}},g.forwardEvent=function(b,H){return b((h)=>H.fire(h))}},5435:function(U,g,b){var H=this&&this.__decorate||function(T,Y,J,_){var N,I=arguments.length,$=I<3?Y:_===null?_=Object.getOwnPropertyDescriptor(Y,J):_;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")$=Reflect.decorate(T,Y,J,_);else for(var w=T.length-1;w>=0;w--)(N=T[w])&&($=(I<3?N($):I>3?N(Y,J,$):N(Y,J))||$);return I>3&&$&&Object.defineProperty(Y,J,$),$},h=this&&this.__param||function(T,Y){return function(J,_){Y(J,_,T)}};Object.defineProperty(g,"__esModule",{value:!0}),g.InputHandler=g.WindowsOptionsReportType=void 0;const E=b(2584),D=b(7116),p=b(2015),B=b(844),R=b(482),v=b(8437),L=b(8460),C=b(643),S=b(511),f=b(3734),O=b(2585),M=b(6242),m=b(6351),A=b(5941),Z={"(":0,")":1,"*":2,"+":3,"-":1,".":2},F=131072;function W(T,Y){if(T>24)return Y.setWinLines||!1;switch(T){case 1:return!!Y.restoreWin;case 2:return!!Y.minimizeWin;case 3:return!!Y.setWinPosition;case 4:return!!Y.setWinSizePixels;case 5:return!!Y.raiseWin;case 6:return!!Y.lowerWin;case 7:return!!Y.refreshWin;case 8:return!!Y.setWinSizeChars;case 9:return!!Y.maximizeWin;case 10:return!!Y.fullscreenWin;case 11:return!!Y.getWinState;case 13:return!!Y.getWinPosition;case 14:return!!Y.getWinSizePixels;case 15:return!!Y.getScreenSizePixels;case 16:return!!Y.getCellSizePixels;case 18:return!!Y.getWinSizeChars;case 19:return!!Y.getScreenSizeChars;case 20:return!!Y.getIconTitle;case 21:return!!Y.getWinTitle;case 22:return!!Y.pushTitle;case 23:return!!Y.popTitle;case 24:return!!Y.setWinLines}return!1}var P;(function(T){T[T.GET_WIN_SIZE_PIXELS=0]="GET_WIN_SIZE_PIXELS",T[T.GET_CELL_SIZE_PIXELS=1]="GET_CELL_SIZE_PIXELS"})(P||(g.WindowsOptionsReportType=P={}));let k=0;class Q extends B.Disposable{getAttrData(){return this._curAttrData}constructor(T,Y,J,_,N,I,$,w,d=new p.EscapeSequenceParser){super(),this._bufferService=T,this._charsetService=Y,this._coreService=J,this._logService=_,this._optionsService=N,this._oscLinkService=I,this._coreMouseService=$,this._unicodeService=w,this._parser=d,this._parseBuffer=new Uint32Array(4096),this._stringDecoder=new R.StringToUtf32,this._utf8Decoder=new R.Utf8ToUtf32,this._workCell=new S.CellData,this._windowTitle="",this._iconName="",this._windowTitleStack=[],this._iconNameStack=[],this._curAttrData=v.DEFAULT_ATTR_DATA.clone(),this._eraseAttrDataInternal=v.DEFAULT_ATTR_DATA.clone(),this._onRequestBell=this.register(new L.EventEmitter),this.onRequestBell=this._onRequestBell.event,this._onRequestRefreshRows=this.register(new L.EventEmitter),this.onRequestRefreshRows=this._onRequestRefreshRows.event,this._onRequestReset=this.register(new L.EventEmitter),this.onRequestReset=this._onRequestReset.event,this._onRequestSendFocus=this.register(new L.EventEmitter),this.onRequestSendFocus=this._onRequestSendFocus.event,this._onRequestSyncScrollBar=this.register(new L.EventEmitter),this.onRequestSyncScrollBar=this._onRequestSyncScrollBar.event,this._onRequestWindowsOptionsReport=this.register(new L.EventEmitter),this.onRequestWindowsOptionsReport=this._onRequestWindowsOptionsReport.event,this._onA11yChar=this.register(new L.EventEmitter),this.onA11yChar=this._onA11yChar.event,this._onA11yTab=this.register(new L.EventEmitter),this.onA11yTab=this._onA11yTab.event,this._onCursorMove=this.register(new L.EventEmitter),this.onCursorMove=this._onCursorMove.event,this._onLineFeed=this.register(new L.EventEmitter),this.onLineFeed=this._onLineFeed.event,this._onScroll=this.register(new L.EventEmitter),this.onScroll=this._onScroll.event,this._onTitleChange=this.register(new L.EventEmitter),this.onTitleChange=this._onTitleChange.event,this._onColor=this.register(new L.EventEmitter),this.onColor=this._onColor.event,this._parseStack={paused:!1,cursorStartX:0,cursorStartY:0,decodedLength:0,position:0},this._specialColors=[256,257,258],this.register(this._parser),this._dirtyRowTracker=new V(this._bufferService),this._activeBuffer=this._bufferService.buffer,this.register(this._bufferService.buffers.onBufferActivate((X)=>this._activeBuffer=X.activeBuffer)),this._parser.setCsiHandlerFallback((X,u)=>{this._logService.debug("Unknown CSI code: ",{identifier:this._parser.identToString(X),params:u.toArray()})}),this._parser.setEscHandlerFallback((X)=>{this._logService.debug("Unknown ESC code: ",{identifier:this._parser.identToString(X)})}),this._parser.setExecuteHandlerFallback((X)=>{this._logService.debug("Unknown EXECUTE code: ",{code:X})}),this._parser.setOscHandlerFallback((X,u,G)=>{this._logService.debug("Unknown OSC code: ",{identifier:X,action:u,data:G})}),this._parser.setDcsHandlerFallback((X,u,G)=>{u==="HOOK"&&(G=G.toArray()),this._logService.debug("Unknown DCS code: ",{identifier:this._parser.identToString(X),action:u,payload:G})}),this._parser.setPrintHandler((X,u,G)=>this.print(X,u,G)),this._parser.registerCsiHandler({final:"@"},(X)=>this.insertChars(X)),this._parser.registerCsiHandler({intermediates:" ",final:"@"},(X)=>this.scrollLeft(X)),this._parser.registerCsiHandler({final:"A"},(X)=>this.cursorUp(X)),this._parser.registerCsiHandler({intermediates:" ",final:"A"},(X)=>this.scrollRight(X)),this._parser.registerCsiHandler({final:"B"},(X)=>this.cursorDown(X)),this._parser.registerCsiHandler({final:"C"},(X)=>this.cursorForward(X)),this._parser.registerCsiHandler({final:"D"},(X)=>this.cursorBackward(X)),this._parser.registerCsiHandler({final:"E"},(X)=>this.cursorNextLine(X)),this._parser.registerCsiHandler({final:"F"},(X)=>this.cursorPrecedingLine(X)),this._parser.registerCsiHandler({final:"G"},(X)=>this.cursorCharAbsolute(X)),this._parser.registerCsiHandler({final:"H"},(X)=>this.cursorPosition(X)),this._parser.registerCsiHandler({final:"I"},(X)=>this.cursorForwardTab(X)),this._parser.registerCsiHandler({final:"J"},(X)=>this.eraseInDisplay(X,!1)),this._parser.registerCsiHandler({prefix:"?",final:"J"},(X)=>this.eraseInDisplay(X,!0)),this._parser.registerCsiHandler({final:"K"},(X)=>this.eraseInLine(X,!1)),this._parser.registerCsiHandler({prefix:"?",final:"K"},(X)=>this.eraseInLine(X,!0)),this._parser.registerCsiHandler({final:"L"},(X)=>this.insertLines(X)),this._parser.registerCsiHandler({final:"M"},(X)=>this.deleteLines(X)),this._parser.registerCsiHandler({final:"P"},(X)=>this.deleteChars(X)),this._parser.registerCsiHandler({final:"S"},(X)=>this.scrollUp(X)),this._parser.registerCsiHandler({final:"T"},(X)=>this.scrollDown(X)),this._parser.registerCsiHandler({final:"X"},(X)=>this.eraseChars(X)),this._parser.registerCsiHandler({final:"Z"},(X)=>this.cursorBackwardTab(X)),this._parser.registerCsiHandler({final:"`"},(X)=>this.charPosAbsolute(X)),this._parser.registerCsiHandler({final:"a"},(X)=>this.hPositionRelative(X)),this._parser.registerCsiHandler({final:"b"},(X)=>this.repeatPrecedingCharacter(X)),this._parser.registerCsiHandler({final:"c"},(X)=>this.sendDeviceAttributesPrimary(X)),this._parser.registerCsiHandler({prefix:">",final:"c"},(X)=>this.sendDeviceAttributesSecondary(X)),this._parser.registerCsiHandler({final:"d"},(X)=>this.linePosAbsolute(X)),this._parser.registerCsiHandler({final:"e"},(X)=>this.vPositionRelative(X)),this._parser.registerCsiHandler({final:"f"},(X)=>this.hVPosition(X)),this._parser.registerCsiHandler({final:"g"},(X)=>this.tabClear(X)),this._parser.registerCsiHandler({final:"h"},(X)=>this.setMode(X)),this._parser.registerCsiHandler({prefix:"?",final:"h"},(X)=>this.setModePrivate(X)),this._parser.registerCsiHandler({final:"l"},(X)=>this.resetMode(X)),this._parser.registerCsiHandler({prefix:"?",final:"l"},(X)=>this.resetModePrivate(X)),this._parser.registerCsiHandler({final:"m"},(X)=>this.charAttributes(X)),this._parser.registerCsiHandler({final:"n"},(X)=>this.deviceStatus(X)),this._parser.registerCsiHandler({prefix:"?",final:"n"},(X)=>this.deviceStatusPrivate(X)),this._parser.registerCsiHandler({intermediates:"!",final:"p"},(X)=>this.softReset(X)),this._parser.registerCsiHandler({intermediates:" ",final:"q"},(X)=>this.setCursorStyle(X)),this._parser.registerCsiHandler({final:"r"},(X)=>this.setScrollRegion(X)),this._parser.registerCsiHandler({final:"s"},(X)=>this.saveCursor(X)),this._parser.registerCsiHandler({final:"t"},(X)=>this.windowOptions(X)),this._parser.registerCsiHandler({final:"u"},(X)=>this.restoreCursor(X)),this._parser.registerCsiHandler({intermediates:"'",final:"}"},(X)=>this.insertColumns(X)),this._parser.registerCsiHandler({intermediates:"'",final:"~"},(X)=>this.deleteColumns(X)),this._parser.registerCsiHandler({intermediates:'"',final:"q"},(X)=>this.selectProtected(X)),this._parser.registerCsiHandler({intermediates:"$",final:"p"},(X)=>this.requestMode(X,!0)),this._parser.registerCsiHandler({prefix:"?",intermediates:"$",final:"p"},(X)=>this.requestMode(X,!1)),this._parser.setExecuteHandler(E.C0.BEL,()=>this.bell()),this._parser.setExecuteHandler(E.C0.LF,()=>this.lineFeed()),this._parser.setExecuteHandler(E.C0.VT,()=>this.lineFeed()),this._parser.setExecuteHandler(E.C0.FF,()=>this.lineFeed()),this._parser.setExecuteHandler(E.C0.CR,()=>this.carriageReturn()),this._parser.setExecuteHandler(E.C0.BS,()=>this.backspace()),this._parser.setExecuteHandler(E.C0.HT,()=>this.tab()),this._parser.setExecuteHandler(E.C0.SO,()=>this.shiftOut()),this._parser.setExecuteHandler(E.C0.SI,()=>this.shiftIn()),this._parser.setExecuteHandler(E.C1.IND,()=>this.index()),this._parser.setExecuteHandler(E.C1.NEL,()=>this.nextLine()),this._parser.setExecuteHandler(E.C1.HTS,()=>this.tabSet()),this._parser.registerOscHandler(0,new M.OscHandler((X)=>(this.setTitle(X),this.setIconName(X),!0))),this._parser.registerOscHandler(1,new M.OscHandler((X)=>this.setIconName(X))),this._parser.registerOscHandler(2,new M.OscHandler((X)=>this.setTitle(X))),this._parser.registerOscHandler(4,new M.OscHandler((X)=>this.setOrReportIndexedColor(X))),this._parser.registerOscHandler(8,new M.OscHandler((X)=>this.setHyperlink(X))),this._parser.registerOscHandler(10,new M.OscHandler((X)=>this.setOrReportFgColor(X))),this._parser.registerOscHandler(11,new M.OscHandler((X)=>this.setOrReportBgColor(X))),this._parser.registerOscHandler(12,new M.OscHandler((X)=>this.setOrReportCursorColor(X))),this._parser.registerOscHandler(104,new M.OscHandler((X)=>this.restoreIndexedColor(X))),this._parser.registerOscHandler(110,new M.OscHandler((X)=>this.restoreFgColor(X))),this._parser.registerOscHandler(111,new M.OscHandler((X)=>this.restoreBgColor(X))),this._parser.registerOscHandler(112,new M.OscHandler((X)=>this.restoreCursorColor(X))),this._parser.registerEscHandler({final:"7"},()=>this.saveCursor()),this._parser.registerEscHandler({final:"8"},()=>this.restoreCursor()),this._parser.registerEscHandler({final:"D"},()=>this.index()),this._parser.registerEscHandler({final:"E"},()=>this.nextLine()),this._parser.registerEscHandler({final:"H"},()=>this.tabSet()),this._parser.registerEscHandler({final:"M"},()=>this.reverseIndex()),this._parser.registerEscHandler({final:"="},()=>this.keypadApplicationMode()),this._parser.registerEscHandler({final:">"},()=>this.keypadNumericMode()),this._parser.registerEscHandler({final:"c"},()=>this.fullReset()),this._parser.registerEscHandler({final:"n"},()=>this.setgLevel(2)),this._parser.registerEscHandler({final:"o"},()=>this.setgLevel(3)),this._parser.registerEscHandler({final:"|"},()=>this.setgLevel(3)),this._parser.registerEscHandler({final:"}"},()=>this.setgLevel(2)),this._parser.registerEscHandler({final:"~"},()=>this.setgLevel(1)),this._parser.registerEscHandler({intermediates:"%",final:"@"},()=>this.selectDefaultCharset()),this._parser.registerEscHandler({intermediates:"%",final:"G"},()=>this.selectDefaultCharset());for(let X in D.CHARSETS)this._parser.registerEscHandler({intermediates:"(",final:X},()=>this.selectCharset("("+X)),this._parser.registerEscHandler({intermediates:")",final:X},()=>this.selectCharset(")"+X)),this._parser.registerEscHandler({intermediates:"*",final:X},()=>this.selectCharset("*"+X)),this._parser.registerEscHandler({intermediates:"+",final:X},()=>this.selectCharset("+"+X)),this._parser.registerEscHandler({intermediates:"-",final:X},()=>this.selectCharset("-"+X)),this._parser.registerEscHandler({intermediates:".",final:X},()=>this.selectCharset("."+X)),this._parser.registerEscHandler({intermediates:"/",final:X},()=>this.selectCharset("/"+X));this._parser.registerEscHandler({intermediates:"#",final:"8"},()=>this.screenAlignmentPattern()),this._parser.setErrorHandler((X)=>(this._logService.error("Parsing error: ",X),X)),this._parser.registerDcsHandler({intermediates:"$",final:"q"},new m.DcsHandler((X,u)=>this.requestStatusString(X,u)))}_preserveStack(T,Y,J,_){this._parseStack.paused=!0,this._parseStack.cursorStartX=T,this._parseStack.cursorStartY=Y,this._parseStack.decodedLength=J,this._parseStack.position=_}_logSlowResolvingAsync(T){this._logService.logLevel<=O.LogLevelEnum.WARN&&Promise.race([T,new Promise((Y,J)=>setTimeout(()=>J("#SLOW_TIMEOUT"),5000))]).catch((Y)=>{if(Y!=="#SLOW_TIMEOUT")throw Y;console.warn("async parser handler taking longer than 5000 ms")})}_getCurrentLinkId(){return this._curAttrData.extended.urlId}parse(T,Y){let J,_=this._activeBuffer.x,N=this._activeBuffer.y,I=0;const $=this._parseStack.paused;if($){if(J=this._parser.parse(this._parseBuffer,this._parseStack.decodedLength,Y))return this._logSlowResolvingAsync(J),J;_=this._parseStack.cursorStartX,N=this._parseStack.cursorStartY,this._parseStack.paused=!1,T.length>F&&(I=this._parseStack.position+F)}if(this._logService.logLevel<=O.LogLevelEnum.DEBUG&&this._logService.debug("parsing data"+(typeof T=="string"?` "${T}"`:` "${Array.prototype.map.call(T,(w)=>String.fromCharCode(w)).join("")}"`),typeof T=="string"?T.split("").map((w)=>w.charCodeAt(0)):T),this._parseBuffer.length<T.length&&this._parseBuffer.length<F&&(this._parseBuffer=new Uint32Array(Math.min(T.length,F))),$||this._dirtyRowTracker.clearRange(),T.length>F)for(let w=I;w<T.length;w+=F){const d=w+F<T.length?w+F:T.length,X=typeof T=="string"?this._stringDecoder.decode(T.substring(w,d),this._parseBuffer):this._utf8Decoder.decode(T.subarray(w,d),this._parseBuffer);if(J=this._parser.parse(this._parseBuffer,X))return this._preserveStack(_,N,X,w),this._logSlowResolvingAsync(J),J}else if(!$){const w=typeof T=="string"?this._stringDecoder.decode(T,this._parseBuffer):this._utf8Decoder.decode(T,this._parseBuffer);if(J=this._parser.parse(this._parseBuffer,w))return this._preserveStack(_,N,w,0),this._logSlowResolvingAsync(J),J}this._activeBuffer.x===_&&this._activeBuffer.y===N||this._onCursorMove.fire(),this._onRequestRefreshRows.fire(this._dirtyRowTracker.start,this._dirtyRowTracker.end)}print(T,Y,J){let _,N;const I=this._charsetService.charset,$=this._optionsService.rawOptions.screenReaderMode,w=this._bufferService.cols,d=this._coreService.decPrivateModes.wraparound,X=this._coreService.modes.insertMode,u=this._curAttrData;let G=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._activeBuffer.x&&J-Y>0&&G.getWidth(this._activeBuffer.x-1)===2&&G.setCellFromCodePoint(this._activeBuffer.x-1,0,1,u.fg,u.bg,u.extended);for(let z=Y;z<J;++z){if(_=T[z],N=this._unicodeService.wcwidth(_),_<127&&I){const r=I[String.fromCharCode(_)];r&&(_=r.charCodeAt(0))}if($&&this._onA11yChar.fire(R.stringFromCodePoint(_)),this._getCurrentLinkId()&&this._oscLinkService.addLineToLink(this._getCurrentLinkId(),this._activeBuffer.ybase+this._activeBuffer.y),N||!this._activeBuffer.x){if(this._activeBuffer.x+N-1>=w){if(d){for(;this._activeBuffer.x<w;)G.setCellFromCodePoint(this._activeBuffer.x++,0,1,u.fg,u.bg,u.extended);this._activeBuffer.x=0,this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData(),!0)):(this._activeBuffer.y>=this._bufferService.rows&&(this._activeBuffer.y=this._bufferService.rows-1),this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!0),G=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y)}else if(this._activeBuffer.x=w-1,N===2)continue}if(X&&(G.insertCells(this._activeBuffer.x,N,this._activeBuffer.getNullCell(u),u),G.getWidth(w-1)===2&&G.setCellFromCodePoint(w-1,C.NULL_CELL_CODE,C.NULL_CELL_WIDTH,u.fg,u.bg,u.extended)),G.setCellFromCodePoint(this._activeBuffer.x++,_,N,u.fg,u.bg,u.extended),N>0)for(;--N;)G.setCellFromCodePoint(this._activeBuffer.x++,0,0,u.fg,u.bg,u.extended)}else G.getWidth(this._activeBuffer.x-1)?G.addCodepointToCell(this._activeBuffer.x-1,_):G.addCodepointToCell(this._activeBuffer.x-2,_)}J-Y>0&&(G.loadCell(this._activeBuffer.x-1,this._workCell),this._workCell.getWidth()===2||this._workCell.getCode()>65535?this._parser.precedingCodepoint=0:this._workCell.isCombined()?this._parser.precedingCodepoint=this._workCell.getChars().charCodeAt(0):this._parser.precedingCodepoint=this._workCell.content),this._activeBuffer.x<w&&J-Y>0&&G.getWidth(this._activeBuffer.x)===0&&!G.hasContent(this._activeBuffer.x)&&G.setCellFromCodePoint(this._activeBuffer.x,0,1,u.fg,u.bg,u.extended),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}registerCsiHandler(T,Y){return T.final!=="t"||T.prefix||T.intermediates?this._parser.registerCsiHandler(T,Y):this._parser.registerCsiHandler(T,(J)=>!W(J.params[0],this._optionsService.rawOptions.windowOptions)||Y(J))}registerDcsHandler(T,Y){return this._parser.registerDcsHandler(T,new m.DcsHandler(Y))}registerEscHandler(T,Y){return this._parser.registerEscHandler(T,Y)}registerOscHandler(T,Y){return this._parser.registerOscHandler(T,new M.OscHandler(Y))}bell(){return this._onRequestBell.fire(),!0}lineFeed(){return this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._optionsService.rawOptions.convertEol&&(this._activeBuffer.x=0),this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData())):this._activeBuffer.y>=this._bufferService.rows?this._activeBuffer.y=this._bufferService.rows-1:this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!1,this._activeBuffer.x>=this._bufferService.cols&&this._activeBuffer.x--,this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._onLineFeed.fire(),!0}carriageReturn(){return this._activeBuffer.x=0,!0}backspace(){var T;if(!this._coreService.decPrivateModes.reverseWraparound)return this._restrictCursor(),this._activeBuffer.x>0&&this._activeBuffer.x--,!0;if(this._restrictCursor(this._bufferService.cols),this._activeBuffer.x>0)this._activeBuffer.x--;else if(this._activeBuffer.x===0&&this._activeBuffer.y>this._activeBuffer.scrollTop&&this._activeBuffer.y<=this._activeBuffer.scrollBottom&&((T=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y))===null||T===void 0?void 0:T.isWrapped)){this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!1,this._activeBuffer.y--,this._activeBuffer.x=this._bufferService.cols-1;const Y=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);Y.hasWidth(this._activeBuffer.x)&&!Y.hasContent(this._activeBuffer.x)&&this._activeBuffer.x--}return this._restrictCursor(),!0}tab(){if(this._activeBuffer.x>=this._bufferService.cols)return!0;const T=this._activeBuffer.x;return this._activeBuffer.x=this._activeBuffer.nextStop(),this._optionsService.rawOptions.screenReaderMode&&this._onA11yTab.fire(this._activeBuffer.x-T),!0}shiftOut(){return this._charsetService.setgLevel(1),!0}shiftIn(){return this._charsetService.setgLevel(0),!0}_restrictCursor(T=this._bufferService.cols-1){this._activeBuffer.x=Math.min(T,Math.max(0,this._activeBuffer.x)),this._activeBuffer.y=this._coreService.decPrivateModes.origin?Math.min(this._activeBuffer.scrollBottom,Math.max(this._activeBuffer.scrollTop,this._activeBuffer.y)):Math.min(this._bufferService.rows-1,Math.max(0,this._activeBuffer.y)),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}_setCursor(T,Y){this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._coreService.decPrivateModes.origin?(this._activeBuffer.x=T,this._activeBuffer.y=this._activeBuffer.scrollTop+Y):(this._activeBuffer.x=T,this._activeBuffer.y=Y),this._restrictCursor(),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}_moveCursor(T,Y){this._restrictCursor(),this._setCursor(this._activeBuffer.x+T,this._activeBuffer.y+Y)}cursorUp(T){const Y=this._activeBuffer.y-this._activeBuffer.scrollTop;return Y>=0?this._moveCursor(0,-Math.min(Y,T.params[0]||1)):this._moveCursor(0,-(T.params[0]||1)),!0}cursorDown(T){const Y=this._activeBuffer.scrollBottom-this._activeBuffer.y;return Y>=0?this._moveCursor(0,Math.min(Y,T.params[0]||1)):this._moveCursor(0,T.params[0]||1),!0}cursorForward(T){return this._moveCursor(T.params[0]||1,0),!0}cursorBackward(T){return this._moveCursor(-(T.params[0]||1),0),!0}cursorNextLine(T){return this.cursorDown(T),this._activeBuffer.x=0,!0}cursorPrecedingLine(T){return this.cursorUp(T),this._activeBuffer.x=0,!0}cursorCharAbsolute(T){return this._setCursor((T.params[0]||1)-1,this._activeBuffer.y),!0}cursorPosition(T){return this._setCursor(T.length>=2?(T.params[1]||1)-1:0,(T.params[0]||1)-1),!0}charPosAbsolute(T){return this._setCursor((T.params[0]||1)-1,this._activeBuffer.y),!0}hPositionRelative(T){return this._moveCursor(T.params[0]||1,0),!0}linePosAbsolute(T){return this._setCursor(this._activeBuffer.x,(T.params[0]||1)-1),!0}vPositionRelative(T){return this._moveCursor(0,T.params[0]||1),!0}hVPosition(T){return this.cursorPosition(T),!0}tabClear(T){const Y=T.params[0];return Y===0?delete this._activeBuffer.tabs[this._activeBuffer.x]:Y===3&&(this._activeBuffer.tabs={}),!0}cursorForwardTab(T){if(this._activeBuffer.x>=this._bufferService.cols)return!0;let Y=T.params[0]||1;for(;Y--;)this._activeBuffer.x=this._activeBuffer.nextStop();return!0}cursorBackwardTab(T){if(this._activeBuffer.x>=this._bufferService.cols)return!0;let Y=T.params[0]||1;for(;Y--;)this._activeBuffer.x=this._activeBuffer.prevStop();return!0}selectProtected(T){const Y=T.params[0];return Y===1&&(this._curAttrData.bg|=536870912),Y!==2&&Y!==0||(this._curAttrData.bg&=-536870913),!0}_eraseInBufferLine(T,Y,J,_=!1,N=!1){const I=this._activeBuffer.lines.get(this._activeBuffer.ybase+T);I.replaceCells(Y,J,this._activeBuffer.getNullCell(this._eraseAttrData()),this._eraseAttrData(),N),_&&(I.isWrapped=!1)}_resetBufferLine(T,Y=!1){const J=this._activeBuffer.lines.get(this._activeBuffer.ybase+T);J&&(J.fill(this._activeBuffer.getNullCell(this._eraseAttrData()),Y),this._bufferService.buffer.clearMarkers(this._activeBuffer.ybase+T),J.isWrapped=!1)}eraseInDisplay(T,Y=!1){let J;switch(this._restrictCursor(this._bufferService.cols),T.params[0]){case 0:for(J=this._activeBuffer.y,this._dirtyRowTracker.markDirty(J),this._eraseInBufferLine(J++,this._activeBuffer.x,this._bufferService.cols,this._activeBuffer.x===0,Y);J<this._bufferService.rows;J++)this._resetBufferLine(J,Y);this._dirtyRowTracker.markDirty(J);break;case 1:for(J=this._activeBuffer.y,this._dirtyRowTracker.markDirty(J),this._eraseInBufferLine(J,0,this._activeBuffer.x+1,!0,Y),this._activeBuffer.x+1>=this._bufferService.cols&&(this._activeBuffer.lines.get(J+1).isWrapped=!1);J--;)this._resetBufferLine(J,Y);this._dirtyRowTracker.markDirty(0);break;case 2:for(J=this._bufferService.rows,this._dirtyRowTracker.markDirty(J-1);J--;)this._resetBufferLine(J,Y);this._dirtyRowTracker.markDirty(0);break;case 3:const _=this._activeBuffer.lines.length-this._bufferService.rows;_>0&&(this._activeBuffer.lines.trimStart(_),this._activeBuffer.ybase=Math.max(this._activeBuffer.ybase-_,0),this._activeBuffer.ydisp=Math.max(this._activeBuffer.ydisp-_,0),this._onScroll.fire(0))}return!0}eraseInLine(T,Y=!1){switch(this._restrictCursor(this._bufferService.cols),T.params[0]){case 0:this._eraseInBufferLine(this._activeBuffer.y,this._activeBuffer.x,this._bufferService.cols,this._activeBuffer.x===0,Y);break;case 1:this._eraseInBufferLine(this._activeBuffer.y,0,this._activeBuffer.x+1,!1,Y);break;case 2:this._eraseInBufferLine(this._activeBuffer.y,0,this._bufferService.cols,!0,Y)}return this._dirtyRowTracker.markDirty(this._activeBuffer.y),!0}insertLines(T){this._restrictCursor();let Y=T.params[0]||1;if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const J=this._activeBuffer.ybase+this._activeBuffer.y,_=this._bufferService.rows-1-this._activeBuffer.scrollBottom,N=this._bufferService.rows-1+this._activeBuffer.ybase-_+1;for(;Y--;)this._activeBuffer.lines.splice(N-1,1),this._activeBuffer.lines.splice(J,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.y,this._activeBuffer.scrollBottom),this._activeBuffer.x=0,!0}deleteLines(T){this._restrictCursor();let Y=T.params[0]||1;if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const J=this._activeBuffer.ybase+this._activeBuffer.y;let _;for(_=this._bufferService.rows-1-this._activeBuffer.scrollBottom,_=this._bufferService.rows-1+this._activeBuffer.ybase-_;Y--;)this._activeBuffer.lines.splice(J,1),this._activeBuffer.lines.splice(_,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.y,this._activeBuffer.scrollBottom),this._activeBuffer.x=0,!0}insertChars(T){this._restrictCursor();const Y=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return Y&&(Y.insertCells(this._activeBuffer.x,T.params[0]||1,this._activeBuffer.getNullCell(this._eraseAttrData()),this._eraseAttrData()),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}deleteChars(T){this._restrictCursor();const Y=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return Y&&(Y.deleteCells(this._activeBuffer.x,T.params[0]||1,this._activeBuffer.getNullCell(this._eraseAttrData()),this._eraseAttrData()),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}scrollUp(T){let Y=T.params[0]||1;for(;Y--;)this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollTop,1),this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollBottom,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}scrollDown(T){let Y=T.params[0]||1;for(;Y--;)this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollBottom,1),this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollTop,0,this._activeBuffer.getBlankLine(v.DEFAULT_ATTR_DATA));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}scrollLeft(T){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const Y=T.params[0]||1;for(let J=this._activeBuffer.scrollTop;J<=this._activeBuffer.scrollBottom;++J){const _=this._activeBuffer.lines.get(this._activeBuffer.ybase+J);_.deleteCells(0,Y,this._activeBuffer.getNullCell(this._eraseAttrData()),this._eraseAttrData()),_.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}scrollRight(T){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const Y=T.params[0]||1;for(let J=this._activeBuffer.scrollTop;J<=this._activeBuffer.scrollBottom;++J){const _=this._activeBuffer.lines.get(this._activeBuffer.ybase+J);_.insertCells(0,Y,this._activeBuffer.getNullCell(this._eraseAttrData()),this._eraseAttrData()),_.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}insertColumns(T){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const Y=T.params[0]||1;for(let J=this._activeBuffer.scrollTop;J<=this._activeBuffer.scrollBottom;++J){const _=this._activeBuffer.lines.get(this._activeBuffer.ybase+J);_.insertCells(this._activeBuffer.x,Y,this._activeBuffer.getNullCell(this._eraseAttrData()),this._eraseAttrData()),_.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}deleteColumns(T){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const Y=T.params[0]||1;for(let J=this._activeBuffer.scrollTop;J<=this._activeBuffer.scrollBottom;++J){const _=this._activeBuffer.lines.get(this._activeBuffer.ybase+J);_.deleteCells(this._activeBuffer.x,Y,this._activeBuffer.getNullCell(this._eraseAttrData()),this._eraseAttrData()),_.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}eraseChars(T){this._restrictCursor();const Y=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return Y&&(Y.replaceCells(this._activeBuffer.x,this._activeBuffer.x+(T.params[0]||1),this._activeBuffer.getNullCell(this._eraseAttrData()),this._eraseAttrData()),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}repeatPrecedingCharacter(T){if(!this._parser.precedingCodepoint)return!0;const Y=T.params[0]||1,J=new Uint32Array(Y);for(let _=0;_<Y;++_)J[_]=this._parser.precedingCodepoint;return this.print(J,0,J.length),!0}sendDeviceAttributesPrimary(T){return T.params[0]>0||(this._is("xterm")||this._is("rxvt-unicode")||this._is("screen")?this._coreService.triggerDataEvent(E.C0.ESC+"[?1;2c"):this._is("linux")&&this._coreService.triggerDataEvent(E.C0.ESC+"[?6c")),!0}sendDeviceAttributesSecondary(T){return T.params[0]>0||(this._is("xterm")?this._coreService.triggerDataEvent(E.C0.ESC+"[>0;276;0c"):this._is("rxvt-unicode")?this._coreService.triggerDataEvent(E.C0.ESC+"[>85;95;0c"):this._is("linux")?this._coreService.triggerDataEvent(T.params[0]+"c"):this._is("screen")&&this._coreService.triggerDataEvent(E.C0.ESC+"[>83;40003;0c")),!0}_is(T){return(this._optionsService.rawOptions.termName+"").indexOf(T)===0}setMode(T){for(let Y=0;Y<T.length;Y++)switch(T.params[Y]){case 4:this._coreService.modes.insertMode=!0;break;case 20:this._optionsService.options.convertEol=!0}return!0}setModePrivate(T){for(let Y=0;Y<T.length;Y++)switch(T.params[Y]){case 1:this._coreService.decPrivateModes.applicationCursorKeys=!0;break;case 2:this._charsetService.setgCharset(0,D.DEFAULT_CHARSET),this._charsetService.setgCharset(1,D.DEFAULT_CHARSET),this._charsetService.setgCharset(2,D.DEFAULT_CHARSET),this._charsetService.setgCharset(3,D.DEFAULT_CHARSET);break;case 3:this._optionsService.rawOptions.windowOptions.setWinLines&&(this._bufferService.resize(132,this._bufferService.rows),this._onRequestReset.fire());break;case 6:this._coreService.decPrivateModes.origin=!0,this._setCursor(0,0);break;case 7:this._coreService.decPrivateModes.wraparound=!0;break;case 12:this._optionsService.options.cursorBlink=!0;break;case 45:this._coreService.decPrivateModes.reverseWraparound=!0;break;case 66:this._logService.debug("Serial port requested application keypad."),this._coreService.decPrivateModes.applicationKeypad=!0,this._onRequestSyncScrollBar.fire();break;case 9:this._coreMouseService.activeProtocol="X10";break;case 1000:this._coreMouseService.activeProtocol="VT200";break;case 1002:this._coreMouseService.activeProtocol="DRAG";break;case 1003:this._coreMouseService.activeProtocol="ANY";break;case 1004:this._coreService.decPrivateModes.sendFocus=!0,this._onRequestSendFocus.fire();break;case 1005:this._logService.debug("DECSET 1005 not supported (see #2507)");break;case 1006:this._coreMouseService.activeEncoding="SGR";break;case 1015:this._logService.debug("DECSET 1015 not supported (see #2507)");break;case 1016:this._coreMouseService.activeEncoding="SGR_PIXELS";break;case 25:this._coreService.isCursorHidden=!1;break;case 1048:this.saveCursor();break;case 1049:this.saveCursor();case 47:case 1047:this._bufferService.buffers.activateAltBuffer(this._eraseAttrData()),this._coreService.isCursorInitialized=!0,this._onRequestRefreshRows.fire(0,this._bufferService.rows-1),this._onRequestSyncScrollBar.fire();break;case 2004:this._coreService.decPrivateModes.bracketedPasteMode=!0}return!0}resetMode(T){for(let Y=0;Y<T.length;Y++)switch(T.params[Y]){case 4:this._coreService.modes.insertMode=!1;break;case 20:this._optionsService.options.convertEol=!1}return!0}resetModePrivate(T){for(let Y=0;Y<T.length;Y++)switch(T.params[Y]){case 1:this._coreService.decPrivateModes.applicationCursorKeys=!1;break;case 3:this._optionsService.rawOptions.windowOptions.setWinLines&&(this._bufferService.resize(80,this._bufferService.rows),this._onRequestReset.fire());break;case 6:this._coreService.decPrivateModes.origin=!1,this._setCursor(0,0);break;case 7:this._coreService.decPrivateModes.wraparound=!1;break;case 12:this._optionsService.options.cursorBlink=!1;break;case 45:this._coreService.decPrivateModes.reverseWraparound=!1;break;case 66:this._logService.debug("Switching back to normal keypad."),this._coreService.decPrivateModes.applicationKeypad=!1,this._onRequestSyncScrollBar.fire();break;case 9:case 1000:case 1002:case 1003:this._coreMouseService.activeProtocol="NONE";break;case 1004:this._coreService.decPrivateModes.sendFocus=!1;break;case 1005:this._logService.debug("DECRST 1005 not supported (see #2507)");break;case 1006:case 1016:this._coreMouseService.activeEncoding="DEFAULT";break;case 1015:this._logService.debug("DECRST 1015 not supported (see #2507)");break;case 25:this._coreService.isCursorHidden=!0;break;case 1048:this.restoreCursor();break;case 1049:case 47:case 1047:this._bufferService.buffers.activateNormalBuffer(),T.params[Y]===1049&&this.restoreCursor(),this._coreService.isCursorInitialized=!0,this._onRequestRefreshRows.fire(0,this._bufferService.rows-1),this._onRequestSyncScrollBar.fire();break;case 2004:this._coreService.decPrivateModes.bracketedPasteMode=!1}return!0}requestMode(T,Y){const J=this._coreService.decPrivateModes,{activeProtocol:_,activeEncoding:N}=this._coreMouseService,I=this._coreService,{buffers:$,cols:w}=this._bufferService,{active:d,alt:X}=$,u=this._optionsService.rawOptions,G=(g0)=>g0?1:2,z=T.params[0];return r=z,q=Y?z===2?4:z===4?G(I.modes.insertMode):z===12?3:z===20?G(u.convertEol):0:z===1?G(J.applicationCursorKeys):z===3?u.windowOptions.setWinLines?w===80?2:w===132?1:0:0:z===6?G(J.origin):z===7?G(J.wraparound):z===8?3:z===9?G(_==="X10"):z===12?G(u.cursorBlink):z===25?G(!I.isCursorHidden):z===45?G(J.reverseWraparound):z===66?G(J.applicationKeypad):z===67?4:z===1000?G(_==="VT200"):z===1002?G(_==="DRAG"):z===1003?G(_==="ANY"):z===1004?G(J.sendFocus):z===1005?4:z===1006?G(N==="SGR"):z===1015?4:z===1016?G(N==="SGR_PIXELS"):z===1048?1:z===47||z===1047||z===1049?G(d===X):z===2004?G(J.bracketedPasteMode):0,I.triggerDataEvent(`${E.C0.ESC}[${Y?"":"?"}${r};${q}\$y`),!0;var r,q}_updateAttrColor(T,Y,J,_,N){return Y===2?(T|=50331648,T&=-16777216,T|=f.AttributeData.fromColorRGB([J,_,N])):Y===5&&(T&=-50331904,T|=33554432|255&J),T}_extractColor(T,Y,J){const _=[0,0,-1,0,0,0];let N=0,I=0;do{if(_[I+N]=T.params[Y+I],T.hasSubParams(Y+I)){const $=T.getSubParams(Y+I);let w=0;do _[1]===5&&(N=1),_[I+w+1+N]=$[w];while(++w<$.length&&w+I+1+N<_.length);break}if(_[1]===5&&I+N>=2||_[1]===2&&I+N>=5)break;_[1]&&(N=1)}while(++I+Y<T.length&&I+N<_.length);for(let $=2;$<_.length;++$)_[$]===-1&&(_[$]=0);switch(_[0]){case 38:J.fg=this._updateAttrColor(J.fg,_[1],_[3],_[4],_[5]);break;case 48:J.bg=this._updateAttrColor(J.bg,_[1],_[3],_[4],_[5]);break;case 58:J.extended=J.extended.clone(),J.extended.underlineColor=this._updateAttrColor(J.extended.underlineColor,_[1],_[3],_[4],_[5])}return I}_processUnderline(T,Y){Y.extended=Y.extended.clone(),(!~T||T>5)&&(T=1),Y.extended.underlineStyle=T,Y.fg|=268435456,T===0&&(Y.fg&=-268435457),Y.updateExtended()}_processSGR0(T){T.fg=v.DEFAULT_ATTR_DATA.fg,T.bg=v.DEFAULT_ATTR_DATA.bg,T.extended=T.extended.clone(),T.extended.underlineStyle=0,T.extended.underlineColor&=-67108864,T.updateExtended()}charAttributes(T){if(T.length===1&&T.params[0]===0)return this._processSGR0(this._curAttrData),!0;const Y=T.length;let J;const _=this._curAttrData;for(let N=0;N<Y;N++)J=T.params[N],J>=30&&J<=37?(_.fg&=-50331904,_.fg|=16777216|J-30):J>=40&&J<=47?(_.bg&=-50331904,_.bg|=16777216|J-40):J>=90&&J<=97?(_.fg&=-50331904,_.fg|=16777224|J-90):J>=100&&J<=107?(_.bg&=-50331904,_.bg|=16777224|J-100):J===0?this._processSGR0(_):J===1?_.fg|=134217728:J===3?_.bg|=67108864:J===4?(_.fg|=268435456,this._processUnderline(T.hasSubParams(N)?T.getSubParams(N)[0]:1,_)):J===5?_.fg|=536870912:J===7?_.fg|=67108864:J===8?_.fg|=1073741824:J===9?_.fg|=2147483648:J===2?_.bg|=134217728:J===21?this._processUnderline(2,_):J===22?(_.fg&=-134217729,_.bg&=-134217729):J===23?_.bg&=-67108865:J===24?(_.fg&=-268435457,this._processUnderline(0,_)):J===25?_.fg&=-536870913:J===27?_.fg&=-67108865:J===28?_.fg&=-1073741825:J===29?_.fg&=2147483647:J===39?(_.fg&=-67108864,_.fg|=16777215&v.DEFAULT_ATTR_DATA.fg):J===49?(_.bg&=-67108864,_.bg|=16777215&v.DEFAULT_ATTR_DATA.bg):J===38||J===48||J===58?N+=this._extractColor(T,N,_):J===53?_.bg|=1073741824:J===55?_.bg&=-1073741825:J===59?(_.extended=_.extended.clone(),_.extended.underlineColor=-1,_.updateExtended()):J===100?(_.fg&=-67108864,_.fg|=16777215&v.DEFAULT_ATTR_DATA.fg,_.bg&=-67108864,_.bg|=16777215&v.DEFAULT_ATTR_DATA.bg):this._logService.debug("Unknown SGR attribute: %d.",J);return!0}deviceStatus(T){switch(T.params[0]){case 5:this._coreService.triggerDataEvent(`${E.C0.ESC}[0n`);break;case 6:const Y=this._activeBuffer.y+1,J=this._activeBuffer.x+1;this._coreService.triggerDataEvent(`${E.C0.ESC}[${Y};${J}R`)}return!0}deviceStatusPrivate(T){if(T.params[0]===6){const Y=this._activeBuffer.y+1,J=this._activeBuffer.x+1;this._coreService.triggerDataEvent(`${E.C0.ESC}[?${Y};${J}R`)}return!0}softReset(T){return this._coreService.isCursorHidden=!1,this._onRequestSyncScrollBar.fire(),this._activeBuffer.scrollTop=0,this._activeBuffer.scrollBottom=this._bufferService.rows-1,this._curAttrData=v.DEFAULT_ATTR_DATA.clone(),this._coreService.reset(),this._charsetService.reset(),this._activeBuffer.savedX=0,this._activeBuffer.savedY=this._activeBuffer.ybase,this._activeBuffer.savedCurAttrData.fg=this._curAttrData.fg,this._activeBuffer.savedCurAttrData.bg=this._curAttrData.bg,this._activeBuffer.savedCharset=this._charsetService.charset,this._coreService.decPrivateModes.origin=!1,!0}setCursorStyle(T){const Y=T.params[0]||1;switch(Y){case 1:case 2:this._optionsService.options.cursorStyle="block";break;case 3:case 4:this._optionsService.options.cursorStyle="underline";break;case 5:case 6:this._optionsService.options.cursorStyle="bar"}const J=Y%2==1;return this._optionsService.options.cursorBlink=J,!0}setScrollRegion(T){const Y=T.params[0]||1;let J;return(T.length<2||(J=T.params[1])>this._bufferService.rows||J===0)&&(J=this._bufferService.rows),J>Y&&(this._activeBuffer.scrollTop=Y-1,this._activeBuffer.scrollBottom=J-1,this._setCursor(0,0)),!0}windowOptions(T){if(!W(T.params[0],this._optionsService.rawOptions.windowOptions))return!0;const Y=T.length>1?T.params[1]:0;switch(T.params[0]){case 14:Y!==2&&this._onRequestWindowsOptionsReport.fire(P.GET_WIN_SIZE_PIXELS);break;case 16:this._onRequestWindowsOptionsReport.fire(P.GET_CELL_SIZE_PIXELS);break;case 18:this._bufferService&&this._coreService.triggerDataEvent(`${E.C0.ESC}[8;${this._bufferService.rows};${this._bufferService.cols}t`);break;case 22:Y!==0&&Y!==2||(this._windowTitleStack.push(this._windowTitle),this._windowTitleStack.length>10&&this._windowTitleStack.shift()),Y!==0&&Y!==1||(this._iconNameStack.push(this._iconName),this._iconNameStack.length>10&&this._iconNameStack.shift());break;case 23:Y!==0&&Y!==2||this._windowTitleStack.length&&this.setTitle(this._windowTitleStack.pop()),Y!==0&&Y!==1||this._iconNameStack.length&&this.setIconName(this._iconNameStack.pop())}return!0}saveCursor(T){return this._activeBuffer.savedX=this._activeBuffer.x,this._activeBuffer.savedY=this._activeBuffer.ybase+this._activeBuffer.y,this._activeBuffer.savedCurAttrData.fg=this._curAttrData.fg,this._activeBuffer.savedCurAttrData.bg=this._curAttrData.bg,this._activeBuffer.savedCharset=this._charsetService.charset,!0}restoreCursor(T){return this._activeBuffer.x=this._activeBuffer.savedX||0,this._activeBuffer.y=Math.max(this._activeBuffer.savedY-this._activeBuffer.ybase,0),this._curAttrData.fg=this._activeBuffer.savedCurAttrData.fg,this._curAttrData.bg=this._activeBuffer.savedCurAttrData.bg,this._charsetService.charset=this._savedCharset,this._activeBuffer.savedCharset&&(this._charsetService.charset=this._activeBuffer.savedCharset),this._restrictCursor(),!0}setTitle(T){return this._windowTitle=T,this._onTitleChange.fire(T),!0}setIconName(T){return this._iconName=T,!0}setOrReportIndexedColor(T){const Y=[],J=T.split(";");for(;J.length>1;){const _=J.shift(),N=J.shift();if(/^\d+$/.exec(_)){const I=parseInt(_);if(K(I))if(N==="?")Y.push({type:0,index:I});else{const $=A.parseColor(N);$&&Y.push({type:1,index:I,color:$})}}}return Y.length&&this._onColor.fire(Y),!0}setHyperlink(T){const Y=T.split(";");return!(Y.length<2)&&(Y[1]?this._createHyperlink(Y[0],Y[1]):!Y[0]&&this._finishHyperlink())}_createHyperlink(T,Y){this._getCurrentLinkId()&&this._finishHyperlink();const J=T.split(":");let _;const N=J.findIndex((I)=>I.startsWith("id="));return N!==-1&&(_=J[N].slice(3)||void 0),this._curAttrData.extended=this._curAttrData.extended.clone(),this._curAttrData.extended.urlId=this._oscLinkService.registerLink({id:_,uri:Y}),this._curAttrData.updateExtended(),!0}_finishHyperlink(){return this._curAttrData.extended=this._curAttrData.extended.clone(),this._curAttrData.extended.urlId=0,this._curAttrData.updateExtended(),!0}_setOrReportSpecialColor(T,Y){const J=T.split(";");for(let _=0;_<J.length&&!(Y>=this._specialColors.length);++_,++Y)if(J[_]==="?")this._onColor.fire([{type:0,index:this._specialColors[Y]}]);else{const N=A.parseColor(J[_]);N&&this._onColor.fire([{type:1,index:this._specialColors[Y],color:N}])}return!0}setOrReportFgColor(T){return this._setOrReportSpecialColor(T,0)}setOrReportBgColor(T){return this._setOrReportSpecialColor(T,1)}setOrReportCursorColor(T){return this._setOrReportSpecialColor(T,2)}restoreIndexedColor(T){if(!T)return this._onColor.fire([{type:2}]),!0;const Y=[],J=T.split(";");for(let _=0;_<J.length;++_)if(/^\d+$/.exec(J[_])){const N=parseInt(J[_]);K(N)&&Y.push({type:2,index:N})}return Y.length&&this._onColor.fire(Y),!0}restoreFgColor(T){return this._onColor.fire([{type:2,index:256}]),!0}restoreBgColor(T){return this._onColor.fire([{type:2,index:257}]),!0}restoreCursorColor(T){return this._onColor.fire([{type:2,index:258}]),!0}nextLine(){return this._activeBuffer.x=0,this.index(),!0}keypadApplicationMode(){return this._logService.debug("Serial port requested application keypad."),this._coreService.decPrivateModes.applicationKeypad=!0,this._onRequestSyncScrollBar.fire(),!0}keypadNumericMode(){return this._logService.debug("Switching back to normal keypad."),this._coreService.decPrivateModes.applicationKeypad=!1,this._onRequestSyncScrollBar.fire(),!0}selectDefaultCharset(){return this._charsetService.setgLevel(0),this._charsetService.setgCharset(0,D.DEFAULT_CHARSET),!0}selectCharset(T){return T.length!==2?(this.selectDefaultCharset(),!0):(T[0]==="/"||this._charsetService.setgCharset(Z[T[0]],D.CHARSETS[T[1]]||D.DEFAULT_CHARSET),!0)}index(){return this._restrictCursor(),this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData())):this._activeBuffer.y>=this._bufferService.rows&&(this._activeBuffer.y=this._bufferService.rows-1),this._restrictCursor(),!0}tabSet(){return this._activeBuffer.tabs[this._activeBuffer.x]=!0,!0}reverseIndex(){if(this._restrictCursor(),this._activeBuffer.y===this._activeBuffer.scrollTop){const T=this._activeBuffer.scrollBottom-this._activeBuffer.scrollTop;this._activeBuffer.lines.shiftElements(this._activeBuffer.ybase+this._activeBuffer.y,T,1),this._activeBuffer.lines.set(this._activeBuffer.ybase+this._activeBuffer.y,this._activeBuffer.getBlankLine(this._eraseAttrData())),this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom)}else this._activeBuffer.y--,this._restrictCursor();return!0}fullReset(){return this._parser.reset(),this._onRequestReset.fire(),!0}reset(){this._curAttrData=v.DEFAULT_ATTR_DATA.clone(),this._eraseAttrDataInternal=v.DEFAULT_ATTR_DATA.clone()}_eraseAttrData(){return this._eraseAttrDataInternal.bg&=-67108864,this._eraseAttrDataInternal.bg|=67108863&this._curAttrData.bg,this._eraseAttrDataInternal}setgLevel(T){return this._charsetService.setgLevel(T),!0}screenAlignmentPattern(){const T=new S.CellData;T.content=1<<22|"E".charCodeAt(0),T.fg=this._curAttrData.fg,T.bg=this._curAttrData.bg,this._setCursor(0,0);for(let Y=0;Y<this._bufferService.rows;++Y){const J=this._activeBuffer.ybase+this._activeBuffer.y+Y,_=this._activeBuffer.lines.get(J);_&&(_.fill(T),_.isWrapped=!1)}return this._dirtyRowTracker.markAllDirty(),this._setCursor(0,0),!0}requestStatusString(T,Y){const J=this._bufferService.buffer,_=this._optionsService.rawOptions;return((N)=>(this._coreService.triggerDataEvent(`${E.C0.ESC}${N}${E.C0.ESC}\\`),!0))(T==='"q'?`P1\$r${this._curAttrData.isProtected()?1:0}"q`:T==='"p'?'P1$r61;1"p':T==="r"?`P1\$r${J.scrollTop+1};${J.scrollBottom+1}r`:T==="m"?"P1$r0m":T===" q"?`P1\$r${{block:2,underline:4,bar:6}[_.cursorStyle]-(_.cursorBlink?1:0)} q`:"P0$r")}markRangeDirty(T,Y){this._dirtyRowTracker.markRangeDirty(T,Y)}}g.InputHandler=Q;let V=class{constructor(T){this._bufferService=T,this.clearRange()}clearRange(){this.start=this._bufferService.buffer.y,this.end=this._bufferService.buffer.y}markDirty(T){T<this.start?this.start=T:T>this.end&&(this.end=T)}markRangeDirty(T,Y){T>Y&&(k=T,T=Y,Y=k),T<this.start&&(this.start=T),Y>this.end&&(this.end=Y)}markAllDirty(){this.markRangeDirty(0,this._bufferService.rows-1)}};function K(T){return 0<=T&&T<256}V=H([h(0,O.IBufferService)],V)},844:(U,g)=>{function b(H){for(let h of H)h.dispose();H.length=0}Object.defineProperty(g,"__esModule",{value:!0}),g.getDisposeArrayDisposable=g.disposeArray=g.toDisposable=g.MutableDisposable=g.Disposable=void 0,g.Disposable=class{constructor(){this._disposables=[],this._isDisposed=!1}dispose(){this._isDisposed=!0;for(let H of this._disposables)H.dispose();this._disposables.length=0}register(H){return this._disposables.push(H),H}unregister(H){const h=this._disposables.indexOf(H);h!==-1&&this._disposables.splice(h,1)}},g.MutableDisposable=class{constructor(){this._isDisposed=!1}get value(){return this._isDisposed?void 0:this._value}set value(H){var h;this._isDisposed||H===this._value||((h=this._value)===null||h===void 0||h.dispose(),this._value=H)}clear(){this.value=void 0}dispose(){var H;this._isDisposed=!0,(H=this._value)===null||H===void 0||H.dispose(),this._value=void 0}},g.toDisposable=function(H){return{dispose:H}},g.disposeArray=b,g.getDisposeArrayDisposable=function(H){return{dispose:()=>b(H)}}},1505:(U,g)=>{Object.defineProperty(g,"__esModule",{value:!0}),g.FourKeyMap=g.TwoKeyMap=void 0;class b{constructor(){this._data={}}set(H,h,E){this._data[H]||(this._data[H]={}),this._data[H][h]=E}get(H,h){return this._data[H]?this._data[H][h]:void 0}clear(){this._data={}}}g.TwoKeyMap=b,g.FourKeyMap=class{constructor(){this._data=new b}set(H,h,E,D,p){this._data.get(H,h)||this._data.set(H,h,new b),this._data.get(H,h).set(E,D,p)}get(H,h,E,D){var p;return(p=this._data.get(H,h))===null||p===void 0?void 0:p.get(E,D)}clear(){this._data.clear()}}},6114:(U,g)=>{Object.defineProperty(g,"__esModule",{value:!0}),g.isChromeOS=g.isLinux=g.isWindows=g.isIphone=g.isIpad=g.isMac=g.getSafariVersion=g.isSafari=g.isLegacyEdge=g.isFirefox=g.isNode=void 0,g.isNode=typeof navigator=="undefined";const b=g.isNode?"node":navigator.userAgent,H=g.isNode?"node":navigator.platform;g.isFirefox=b.includes("Firefox"),g.isLegacyEdge=b.includes("Edge"),g.isSafari=/^((?!chrome|android).)*safari/i.test(b),g.getSafariVersion=function(){if(!g.isSafari)return 0;const h=b.match(/Version\/(\d+)/);return h===null||h.length<2?0:parseInt(h[1])},g.isMac=["Macintosh","MacIntel","MacPPC","Mac68K"].includes(H),g.isIpad=H==="iPad",g.isIphone=H==="iPhone",g.isWindows=["Windows","Win16","Win32","WinCE"].includes(H),g.isLinux=H.indexOf("Linux")>=0,g.isChromeOS=/\bCrOS\b/.test(b)},6106:(U,g)=>{Object.defineProperty(g,"__esModule",{value:!0}),g.SortedList=void 0;let b=0;g.SortedList=class{constructor(H){this._getKey=H,this._array=[]}clear(){this._array.length=0}insert(H){this._array.length!==0?(b=this._search(this._getKey(H)),this._array.splice(b,0,H)):this._array.push(H)}delete(H){if(this._array.length===0)return!1;const h=this._getKey(H);if(h===void 0)return!1;if(b=this._search(h),b===-1)return!1;if(this._getKey(this._array[b])!==h)return!1;do if(this._array[b]===H)return this._array.splice(b,1),!0;while(++b<this._array.length&&this._getKey(this._array[b])===h);return!1}*getKeyIterator(H){if(this._array.length!==0&&(b=this._search(H),!(b<0||b>=this._array.length)&&this._getKey(this._array[b])===H))do yield this._array[b];while(++b<this._array.length&&this._getKey(this._array[b])===H)}forEachByKey(H,h){if(this._array.length!==0&&(b=this._search(H),!(b<0||b>=this._array.length)&&this._getKey(this._array[b])===H))do h(this._array[b]);while(++b<this._array.length&&this._getKey(this._array[b])===H)}values(){return[...this._array].values()}_search(H){let h=0,E=this._array.length-1;for(;E>=h;){let D=h+E>>1;const p=this._getKey(this._array[D]);if(p>H)E=D-1;else{if(!(p<H)){for(;D>0&&this._getKey(this._array[D-1])===H;)D--;return D}h=D+1}}return h}}},7226:(U,g,b)=>{Object.defineProperty(g,"__esModule",{value:!0}),g.DebouncedIdleTask=g.IdleTaskQueue=g.PriorityTaskQueue=void 0;const H=b(6114);class h{constructor(){this._tasks=[],this._i=0}enqueue(D){this._tasks.push(D),this._start()}flush(){for(;this._i<this._tasks.length;)this._tasks[this._i]()||this._i++;this.clear()}clear(){this._idleCallback&&(this._cancelCallback(this._idleCallback),this._idleCallback=void 0),this._i=0,this._tasks.length=0}_start(){this._idleCallback||(this._idleCallback=this._requestCallback(this._process.bind(this)))}_process(D){this._idleCallback=void 0;let p=0,B=0,R=D.timeRemaining(),v=0;for(;this._i<this._tasks.length;){if(p=Date.now(),this._tasks[this._i]()||this._i++,p=Math.max(1,Date.now()-p),B=Math.max(p,B),v=D.timeRemaining(),1.5*B>v)return R-p<-20&&console.warn(`task queue exceeded allotted deadline by ${Math.abs(Math.round(R-p))}ms`),void this._start();R=v}this.clear()}}class E extends h{_requestCallback(D){return setTimeout(()=>D(this._createDeadline(16)))}_cancelCallback(D){clearTimeout(D)}_createDeadline(D){const p=Date.now()+D;return{timeRemaining:()=>Math.max(0,p-Date.now())}}}g.PriorityTaskQueue=E,g.IdleTaskQueue=!H.isNode&&"requestIdleCallback"in window?class extends h{_requestCallback(D){return requestIdleCallback(D)}_cancelCallback(D){cancelIdleCallback(D)}}:E,g.DebouncedIdleTask=class{constructor(){this._queue=new g.IdleTaskQueue}set(D){this._queue.clear(),this._queue.enqueue(D)}flush(){this._queue.flush()}}},9282:(U,g,b)=>{Object.defineProperty(g,"__esModule",{value:!0}),g.updateWindowsModeWrappedState=void 0;const H=b(643);g.updateWindowsModeWrappedState=function(h){const E=h.buffer.lines.get(h.buffer.ybase+h.buffer.y-1),D=E==null?void 0:E.get(h.cols-1),p=h.buffer.lines.get(h.buffer.ybase+h.buffer.y);p&&D&&(p.isWrapped=D[H.CHAR_DATA_CODE_INDEX]!==H.NULL_CELL_CODE&&D[H.CHAR_DATA_CODE_INDEX]!==H.WHITESPACE_CELL_CODE)}},3734:(U,g)=>{Object.defineProperty(g,"__esModule",{value:!0}),g.ExtendedAttrs=g.AttributeData=void 0;class b{constructor(){this.fg=0,this.bg=0,this.extended=new H}static toColorRGB(h){return[h>>>16&255,h>>>8&255,255&h]}static fromColorRGB(h){return(255&h[0])<<16|(255&h[1])<<8|255&h[2]}clone(){const h=new b;return h.fg=this.fg,h.bg=this.bg,h.extended=this.extended.clone(),h}isInverse(){return 67108864&this.fg}isBold(){return 134217728&this.fg}isUnderline(){return this.hasExtendedAttrs()&&this.extended.underlineStyle!==0?1:268435456&this.fg}isBlink(){return 536870912&this.fg}isInvisible(){return 1073741824&this.fg}isItalic(){return 67108864&this.bg}isDim(){return 134217728&this.bg}isStrikethrough(){return 2147483648&this.fg}isProtected(){return 536870912&this.bg}isOverline(){return 1073741824&this.bg}getFgColorMode(){return 50331648&this.fg}getBgColorMode(){return 50331648&this.bg}isFgRGB(){return(50331648&this.fg)==50331648}isBgRGB(){return(50331648&this.bg)==50331648}isFgPalette(){return(50331648&this.fg)==16777216||(50331648&this.fg)==33554432}isBgPalette(){return(50331648&this.bg)==16777216||(50331648&this.bg)==33554432}isFgDefault(){return(50331648&this.fg)==0}isBgDefault(){return(50331648&this.bg)==0}isAttributeDefault(){return this.fg===0&&this.bg===0}getFgColor(){switch(50331648&this.fg){case 16777216:case 33554432:return 255&this.fg;case 50331648:return 16777215&this.fg;default:return-1}}getBgColor(){switch(50331648&this.bg){case 16777216:case 33554432:return 255&this.bg;case 50331648:return 16777215&this.bg;default:return-1}}hasExtendedAttrs(){return 268435456&this.bg}updateExtended(){this.extended.isEmpty()?this.bg&=-268435457:this.bg|=268435456}getUnderlineColor(){if(268435456&this.bg&&~this.extended.underlineColor)switch(50331648&this.extended.underlineColor){case 16777216:case 33554432:return 255&this.extended.underlineColor;case 50331648:return 16777215&this.extended.underlineColor;default:return this.getFgColor()}return this.getFgColor()}getUnderlineColorMode(){return 268435456&this.bg&&~this.extended.underlineColor?50331648&this.extended.underlineColor:this.getFgColorMode()}isUnderlineColorRGB(){return 268435456&this.bg&&~this.extended.underlineColor?(50331648&this.extended.underlineColor)==50331648:this.isFgRGB()}isUnderlineColorPalette(){return 268435456&this.bg&&~this.extended.underlineColor?(50331648&this.extended.underlineColor)==16777216||(50331648&this.extended.underlineColor)==33554432:this.isFgPalette()}isUnderlineColorDefault(){return 268435456&this.bg&&~this.extended.underlineColor?(50331648&this.extended.underlineColor)==0:this.isFgDefault()}getUnderlineStyle(){return 268435456&this.fg?268435456&this.bg?this.extended.underlineStyle:1:0}}g.AttributeData=b;class H{get ext(){return this._urlId?-469762049&this._ext|this.underlineStyle<<26:this._ext}set ext(h){this._ext=h}get underlineStyle(){return this._urlId?5:(469762048&this._ext)>>26}set underlineStyle(h){this._ext&=-469762049,this._ext|=h<<26&469762048}get underlineColor(){return 67108863&this._ext}set underlineColor(h){this._ext&=-67108864,this._ext|=67108863&h}get urlId(){return this._urlId}set urlId(h){this._urlId=h}constructor(h=0,E=0){this._ext=0,this._urlId=0,this._ext=h,this._urlId=E}clone(){return new H(this._ext,this._urlId)}isEmpty(){return this.underlineStyle===0&&this._urlId===0}}g.ExtendedAttrs=H},9092:(U,g,b)=>{Object.defineProperty(g,"__esModule",{value:!0}),g.Buffer=g.MAX_BUFFER_SIZE=void 0;const H=b(6349),h=b(7226),E=b(3734),D=b(8437),p=b(4634),B=b(511),R=b(643),v=b(4863),L=b(7116);g.MAX_BUFFER_SIZE=4294967295,g.Buffer=class{constructor(C,S,f){this._hasScrollback=C,this._optionsService=S,this._bufferService=f,this.ydisp=0,this.ybase=0,this.y=0,this.x=0,this.tabs={},this.savedY=0,this.savedX=0,this.savedCurAttrData=D.DEFAULT_ATTR_DATA.clone(),this.savedCharset=L.DEFAULT_CHARSET,this.markers=[],this._nullCell=B.CellData.fromCharData([0,R.NULL_CELL_CHAR,R.NULL_CELL_WIDTH,R.NULL_CELL_CODE]),this._whitespaceCell=B.CellData.fromCharData([0,R.WHITESPACE_CELL_CHAR,R.WHITESPACE_CELL_WIDTH,R.WHITESPACE_CELL_CODE]),this._isClearing=!1,this._memoryCleanupQueue=new h.IdleTaskQueue,this._memoryCleanupPosition=0,this._cols=this._bufferService.cols,this._rows=this._bufferService.rows,this.lines=new H.CircularList(this._getCorrectBufferLength(this._rows)),this.scrollTop=0,this.scrollBottom=this._rows-1,this.setupTabStops()}getNullCell(C){return C?(this._nullCell.fg=C.fg,this._nullCell.bg=C.bg,this._nullCell.extended=C.extended):(this._nullCell.fg=0,this._nullCell.bg=0,this._nullCell.extended=new E.ExtendedAttrs),this._nullCell}getWhitespaceCell(C){return C?(this._whitespaceCell.fg=C.fg,this._whitespaceCell.bg=C.bg,this._whitespaceCell.extended=C.extended):(this._whitespaceCell.fg=0,this._whitespaceCell.bg=0,this._whitespaceCell.extended=new E.ExtendedAttrs),this._whitespaceCell}getBlankLine(C,S){return new D.BufferLine(this._bufferService.cols,this.getNullCell(C),S)}get hasScrollback(){return this._hasScrollback&&this.lines.maxLength>this._rows}get isCursorInViewport(){const C=this.ybase+this.y-this.ydisp;return C>=0&&C<this._rows}_getCorrectBufferLength(C){if(!this._hasScrollback)return C;const S=C+this._optionsService.rawOptions.scrollback;return S>g.MAX_BUFFER_SIZE?g.MAX_BUFFER_SIZE:S}fillViewportRows(C){if(this.lines.length===0){C===void 0&&(C=D.DEFAULT_ATTR_DATA);let S=this._rows;for(;S--;)this.lines.push(this.getBlankLine(C))}}clear(){this.ydisp=0,this.ybase=0,this.y=0,this.x=0,this.lines=new H.CircularList(this._getCorrectBufferLength(this._rows)),this.scrollTop=0,this.scrollBottom=this._rows-1,this.setupTabStops()}resize(C,S){const f=this.getNullCell(D.DEFAULT_ATTR_DATA);let O=0;const M=this._getCorrectBufferLength(S);if(M>this.lines.maxLength&&(this.lines.maxLength=M),this.lines.length>0){if(this._cols<C)for(let A=0;A<this.lines.length;A++)O+=+this.lines.get(A).resize(C,f);let m=0;if(this._rows<S)for(let A=this._rows;A<S;A++)this.lines.length<S+this.ybase&&(this._optionsService.rawOptions.windowsMode||this._optionsService.rawOptions.windowsPty.backend!==void 0||this._optionsService.rawOptions.windowsPty.buildNumber!==void 0?this.lines.push(new D.BufferLine(C,f)):this.ybase>0&&this.lines.length<=this.ybase+this.y+m+1?(this.ybase--,m++,this.ydisp>0&&this.ydisp--):this.lines.push(new D.BufferLine(C,f)));else for(let A=this._rows;A>S;A--)this.lines.length>S+this.ybase&&(this.lines.length>this.ybase+this.y+1?this.lines.pop():(this.ybase++,this.ydisp++));if(M<this.lines.maxLength){const A=this.lines.length-M;A>0&&(this.lines.trimStart(A),this.ybase=Math.max(this.ybase-A,0),this.ydisp=Math.max(this.ydisp-A,0),this.savedY=Math.max(this.savedY-A,0)),this.lines.maxLength=M}this.x=Math.min(this.x,C-1),this.y=Math.min(this.y,S-1),m&&(this.y+=m),this.savedX=Math.min(this.savedX,C-1),this.scrollTop=0}if(this.scrollBottom=S-1,this._isReflowEnabled&&(this._reflow(C,S),this._cols>C))for(let m=0;m<this.lines.length;m++)O+=+this.lines.get(m).resize(C,f);this._cols=C,this._rows=S,this._memoryCleanupQueue.clear(),O>0.1*this.lines.length&&(this._memoryCleanupPosition=0,this._memoryCleanupQueue.enqueue(()=>this._batchedMemoryCleanup()))}_batchedMemoryCleanup(){let C=!0;this._memoryCleanupPosition>=this.lines.length&&(this._memoryCleanupPosition=0,C=!1);let S=0;for(;this._memoryCleanupPosition<this.lines.length;)if(S+=this.lines.get(this._memoryCleanupPosition++).cleanupMemory(),S>100)return!0;return C}get _isReflowEnabled(){const C=this._optionsService.rawOptions.windowsPty;return C&&C.buildNumber?this._hasScrollback&&C.backend==="conpty"&&C.buildNumber>=21376:this._hasScrollback&&!this._optionsService.rawOptions.windowsMode}_reflow(C,S){this._cols!==C&&(C>this._cols?this._reflowLarger(C,S):this._reflowSmaller(C,S))}_reflowLarger(C,S){const f=p.reflowLargerGetLinesToRemove(this.lines,this._cols,C,this.ybase+this.y,this.getNullCell(D.DEFAULT_ATTR_DATA));if(f.length>0){const O=p.reflowLargerCreateNewLayout(this.lines,f);p.reflowLargerApplyNewLayout(this.lines,O.layout),this._reflowLargerAdjustViewport(C,S,O.countRemoved)}}_reflowLargerAdjustViewport(C,S,f){const O=this.getNullCell(D.DEFAULT_ATTR_DATA);let M=f;for(;M-- >0;)this.ybase===0?(this.y>0&&this.y--,this.lines.length<S&&this.lines.push(new D.BufferLine(C,O))):(this.ydisp===this.ybase&&this.ydisp--,this.ybase--);this.savedY=Math.max(this.savedY-f,0)}_reflowSmaller(C,S){const f=this.getNullCell(D.DEFAULT_ATTR_DATA),O=[];let M=0;for(let m=this.lines.length-1;m>=0;m--){let A=this.lines.get(m);if(!A||!A.isWrapped&&A.getTrimmedLength()<=C)continue;const Z=[A];for(;A.isWrapped&&m>0;)A=this.lines.get(--m),Z.unshift(A);const F=this.ybase+this.y;if(F>=m&&F<m+Z.length)continue;const W=Z[Z.length-1].getTrimmedLength(),P=p.reflowSmallerGetNewLineLengths(Z,this._cols,C),k=P.length-Z.length;let Q;Q=this.ybase===0&&this.y!==this.lines.length-1?Math.max(0,this.y-this.lines.maxLength+k):Math.max(0,this.lines.length-this.lines.maxLength+k);const V=[];for(let N=0;N<k;N++){const I=this.getBlankLine(D.DEFAULT_ATTR_DATA,!0);V.push(I)}V.length>0&&(O.push({start:m+Z.length+M,newLines:V}),M+=V.length),Z.push(...V);let K=P.length-1,T=P[K];T===0&&(K--,T=P[K]);let Y=Z.length-k-1,J=W;for(;Y>=0;){const N=Math.min(J,T);if(Z[K]===void 0)break;if(Z[K].copyCellsFrom(Z[Y],J-N,T-N,N,!0),T-=N,T===0&&(K--,T=P[K]),J-=N,J===0){Y--;const I=Math.max(Y,0);J=p.getWrappedLineTrimmedLength(Z,I,this._cols)}}for(let N=0;N<Z.length;N++)P[N]<C&&Z[N].setCell(P[N],f);let _=k-Q;for(;_-- >0;)this.ybase===0?this.y<S-1?(this.y++,this.lines.pop()):(this.ybase++,this.ydisp++):this.ybase<Math.min(this.lines.maxLength,this.lines.length+M)-S&&(this.ybase===this.ydisp&&this.ydisp++,this.ybase++);this.savedY=Math.min(this.savedY+k,this.ybase+S-1)}if(O.length>0){const m=[],A=[];for(let K=0;K<this.lines.length;K++)A.push(this.lines.get(K));const Z=this.lines.length;let F=Z-1,W=0,P=O[W];this.lines.length=Math.min(this.lines.maxLength,this.lines.length+M);let k=0;for(let K=Math.min(this.lines.maxLength-1,Z+M-1);K>=0;K--)if(P&&P.start>F+k){for(let T=P.newLines.length-1;T>=0;T--)this.lines.set(K--,P.newLines[T]);K++,m.push({index:F+1,amount:P.newLines.length}),k+=P.newLines.length,P=O[++W]}else this.lines.set(K,A[F--]);let Q=0;for(let K=m.length-1;K>=0;K--)m[K].index+=Q,this.lines.onInsertEmitter.fire(m[K]),Q+=m[K].amount;const V=Math.max(0,Z+M-this.lines.maxLength);V>0&&this.lines.onTrimEmitter.fire(V)}}translateBufferLineToString(C,S,f=0,O){const M=this.lines.get(C);return M?M.translateToString(S,f,O):""}getWrappedRangeForLine(C){let S=C,f=C;for(;S>0&&this.lines.get(S).isWrapped;)S--;for(;f+1<this.lines.length&&this.lines.get(f+1).isWrapped;)f++;return{first:S,last:f}}setupTabStops(C){for(C!=null?this.tabs[C]||(C=this.prevStop(C)):(this.tabs={},C=0);C<this._cols;C+=this._optionsService.rawOptions.tabStopWidth)this.tabs[C]=!0}prevStop(C){for(C==null&&(C=this.x);!this.tabs[--C]&&C>0;);return C>=this._cols?this._cols-1:C<0?0:C}nextStop(C){for(C==null&&(C=this.x);!this.tabs[++C]&&C<this._cols;);return C>=this._cols?this._cols-1:C<0?0:C}clearMarkers(C){this._isClearing=!0;for(let S=0;S<this.markers.length;S++)this.markers[S].line===C&&(this.markers[S].dispose(),this.markers.splice(S--,1));this._isClearing=!1}clearAllMarkers(){this._isClearing=!0;for(let C=0;C<this.markers.length;C++)this.markers[C].dispose(),this.markers.splice(C--,1);this._isClearing=!1}addMarker(C){const S=new v.Marker(C);return this.markers.push(S),S.register(this.lines.onTrim((f)=>{S.line-=f,S.line<0&&S.dispose()})),S.register(this.lines.onInsert((f)=>{S.line>=f.index&&(S.line+=f.amount)})),S.register(this.lines.onDelete((f)=>{S.line>=f.index&&S.line<f.index+f.amount&&S.dispose(),S.line>f.index&&(S.line-=f.amount)})),S.register(S.onDispose(()=>this._removeMarker(S))),S}_removeMarker(C){this._isClearing||this.markers.splice(this.markers.indexOf(C),1)}}},8437:(U,g,b)=>{Object.defineProperty(g,"__esModule",{value:!0}),g.BufferLine=g.DEFAULT_ATTR_DATA=void 0;const H=b(3734),h=b(511),E=b(643),D=b(482);g.DEFAULT_ATTR_DATA=Object.freeze(new H.AttributeData);let p=0;class B{constructor(R,v,L=!1){this.isWrapped=L,this._combined={},this._extendedAttrs={},this._data=new Uint32Array(3*R);const C=v||h.CellData.fromCharData([0,E.NULL_CELL_CHAR,E.NULL_CELL_WIDTH,E.NULL_CELL_CODE]);for(let S=0;S<R;++S)this.setCell(S,C);this.length=R}get(R){const v=this._data[3*R+0],L=2097151&v;return[this._data[3*R+1],2097152&v?this._combined[R]:L?D.stringFromCodePoint(L):"",v>>22,2097152&v?this._combined[R].charCodeAt(this._combined[R].length-1):L]}set(R,v){this._data[3*R+1]=v[E.CHAR_DATA_ATTR_INDEX],v[E.CHAR_DATA_CHAR_INDEX].length>1?(this._combined[R]=v[1],this._data[3*R+0]=2097152|R|v[E.CHAR_DATA_WIDTH_INDEX]<<22):this._data[3*R+0]=v[E.CHAR_DATA_CHAR_INDEX].charCodeAt(0)|v[E.CHAR_DATA_WIDTH_INDEX]<<22}getWidth(R){return this._data[3*R+0]>>22}hasWidth(R){return 12582912&this._data[3*R+0]}getFg(R){return this._data[3*R+1]}getBg(R){return this._data[3*R+2]}hasContent(R){return 4194303&this._data[3*R+0]}getCodePoint(R){const v=this._data[3*R+0];return 2097152&v?this._combined[R].charCodeAt(this._combined[R].length-1):2097151&v}isCombined(R){return 2097152&this._data[3*R+0]}getString(R){const v=this._data[3*R+0];return 2097152&v?this._combined[R]:2097151&v?D.stringFromCodePoint(2097151&v):""}isProtected(R){return 536870912&this._data[3*R+2]}loadCell(R,v){return p=3*R,v.content=this._data[p+0],v.fg=this._data[p+1],v.bg=this._data[p+2],2097152&v.content&&(v.combinedData=this._combined[R]),268435456&v.bg&&(v.extended=this._extendedAttrs[R]),v}setCell(R,v){2097152&v.content&&(this._combined[R]=v.combinedData),268435456&v.bg&&(this._extendedAttrs[R]=v.extended),this._data[3*R+0]=v.content,this._data[3*R+1]=v.fg,this._data[3*R+2]=v.bg}setCellFromCodePoint(R,v,L,C,S,f){268435456&S&&(this._extendedAttrs[R]=f),this._data[3*R+0]=v|L<<22,this._data[3*R+1]=C,this._data[3*R+2]=S}addCodepointToCell(R,v){let L=this._data[3*R+0];2097152&L?this._combined[R]+=D.stringFromCodePoint(v):(2097151&L?(this._combined[R]=D.stringFromCodePoint(2097151&L)+D.stringFromCodePoint(v),L&=-2097152,L|=2097152):L=v|1<<22,this._data[3*R+0]=L)}insertCells(R,v,L,C){if((R%=this.length)&&this.getWidth(R-1)===2&&this.setCellFromCodePoint(R-1,0,1,(C==null?void 0:C.fg)||0,(C==null?void 0:C.bg)||0,(C==null?void 0:C.extended)||new H.ExtendedAttrs),v<this.length-R){const S=new h.CellData;for(let f=this.length-R-v-1;f>=0;--f)this.setCell(R+v+f,this.loadCell(R+f,S));for(let f=0;f<v;++f)this.setCell(R+f,L)}else for(let S=R;S<this.length;++S)this.setCell(S,L);this.getWidth(this.length-1)===2&&this.setCellFromCodePoint(this.length-1,0,1,(C==null?void 0:C.fg)||0,(C==null?void 0:C.bg)||0,(C==null?void 0:C.extended)||new H.ExtendedAttrs)}deleteCells(R,v,L,C){if(R%=this.length,v<this.length-R){const S=new h.CellData;for(let f=0;f<this.length-R-v;++f)this.setCell(R+f,this.loadCell(R+v+f,S));for(let f=this.length-v;f<this.length;++f)this.setCell(f,L)}else for(let S=R;S<this.length;++S)this.setCell(S,L);R&&this.getWidth(R-1)===2&&this.setCellFromCodePoint(R-1,0,1,(C==null?void 0:C.fg)||0,(C==null?void 0:C.bg)||0,(C==null?void 0:C.extended)||new H.ExtendedAttrs),this.getWidth(R)!==0||this.hasContent(R)||this.setCellFromCodePoint(R,0,1,(C==null?void 0:C.fg)||0,(C==null?void 0:C.bg)||0,(C==null?void 0:C.extended)||new H.ExtendedAttrs)}replaceCells(R,v,L,C,S=!1){if(S)for(R&&this.getWidth(R-1)===2&&!this.isProtected(R-1)&&this.setCellFromCodePoint(R-1,0,1,(C==null?void 0:C.fg)||0,(C==null?void 0:C.bg)||0,(C==null?void 0:C.extended)||new H.ExtendedAttrs),v<this.length&&this.getWidth(v-1)===2&&!this.isProtected(v)&&this.setCellFromCodePoint(v,0,1,(C==null?void 0:C.fg)||0,(C==null?void 0:C.bg)||0,(C==null?void 0:C.extended)||new H.ExtendedAttrs);R<v&&R<this.length;)this.isProtected(R)||this.setCell(R,L),R++;else for(R&&this.getWidth(R-1)===2&&this.setCellFromCodePoint(R-1,0,1,(C==null?void 0:C.fg)||0,(C==null?void 0:C.bg)||0,(C==null?void 0:C.extended)||new H.ExtendedAttrs),v<this.length&&this.getWidth(v-1)===2&&this.setCellFromCodePoint(v,0,1,(C==null?void 0:C.fg)||0,(C==null?void 0:C.bg)||0,(C==null?void 0:C.extended)||new H.ExtendedAttrs);R<v&&R<this.length;)this.setCell(R++,L)}resize(R,v){if(R===this.length)return 4*this._data.length*2<this._data.buffer.byteLength;const L=3*R;if(R>this.length){if(this._data.buffer.byteLength>=4*L)this._data=new Uint32Array(this._data.buffer,0,L);else{const C=new Uint32Array(L);C.set(this._data),this._data=C}for(let C=this.length;C<R;++C)this.setCell(C,v)}else{this._data=this._data.subarray(0,L);const C=Object.keys(this._combined);for(let f=0;f<C.length;f++){const O=parseInt(C[f],10);O>=R&&delete this._combined[O]}const S=Object.keys(this._extendedAttrs);for(let f=0;f<S.length;f++){const O=parseInt(S[f],10);O>=R&&delete this._extendedAttrs[O]}}return this.length=R,4*L*2<this._data.buffer.byteLength}cleanupMemory(){if(4*this._data.length*2<this._data.buffer.byteLength){const R=new Uint32Array(this._data.length);return R.set(this._data),this._data=R,1}return 0}fill(R,v=!1){if(v)for(let L=0;L<this.length;++L)this.isProtected(L)||this.setCell(L,R);else{this._combined={},this._extendedAttrs={};for(let L=0;L<this.length;++L)this.setCell(L,R)}}copyFrom(R){this.length!==R.length?this._data=new Uint32Array(R._data):this._data.set(R._data),this.length=R.length,this._combined={};for(let v in R._combined)this._combined[v]=R._combined[v];this._extendedAttrs={};for(let v in R._extendedAttrs)this._extendedAttrs[v]=R._extendedAttrs[v];this.isWrapped=R.isWrapped}clone(){const R=new B(0);R._data=new Uint32Array(this._data),R.length=this.length;for(let v in this._combined)R._combined[v]=this._combined[v];for(let v in this._extendedAttrs)R._extendedAttrs[v]=this._extendedAttrs[v];return R.isWrapped=this.isWrapped,R}getTrimmedLength(){for(let R=this.length-1;R>=0;--R)if(4194303&this._data[3*R+0])return R+(this._data[3*R+0]>>22);return 0}getNoBgTrimmedLength(){for(let R=this.length-1;R>=0;--R)if(4194303&this._data[3*R+0]||50331648&this._data[3*R+2])return R+(this._data[3*R+0]>>22);return 0}copyCellsFrom(R,v,L,C,S){const f=R._data;if(S)for(let M=C-1;M>=0;M--){for(let m=0;m<3;m++)this._data[3*(L+M)+m]=f[3*(v+M)+m];268435456&f[3*(v+M)+2]&&(this._extendedAttrs[L+M]=R._extendedAttrs[v+M])}else for(let M=0;M<C;M++){for(let m=0;m<3;m++)this._data[3*(L+M)+m]=f[3*(v+M)+m];268435456&f[3*(v+M)+2]&&(this._extendedAttrs[L+M]=R._extendedAttrs[v+M])}const O=Object.keys(R._combined);for(let M=0;M<O.length;M++){const m=parseInt(O[M],10);m>=v&&(this._combined[m-v+L]=R._combined[m])}}translateToString(R=!1,v=0,L=this.length){R&&(L=Math.min(L,this.getTrimmedLength()));let C="";for(;v<L;){const S=this._data[3*v+0],f=2097151&S;C+=2097152&S?this._combined[v]:f?D.stringFromCodePoint(f):E.WHITESPACE_CELL_CHAR,v+=S>>22||1}return C}}g.BufferLine=B},4841:(U,g)=>{Object.defineProperty(g,"__esModule",{value:!0}),g.getRangeLength=void 0,g.getRangeLength=function(b,H){if(b.start.y>b.end.y)throw new Error(`Buffer range end (${b.end.x}, ${b.end.y}) cannot be before start (${b.start.x}, ${b.start.y})`);return H*(b.end.y-b.start.y)+(b.end.x-b.start.x+1)}},4634:(U,g)=>{function b(H,h,E){if(h===H.length-1)return H[h].getTrimmedLength();const D=!H[h].hasContent(E-1)&&H[h].getWidth(E-1)===1,p=H[h+1].getWidth(0)===2;return D&&p?E-1:E}Object.defineProperty(g,"__esModule",{value:!0}),g.getWrappedLineTrimmedLength=g.reflowSmallerGetNewLineLengths=g.reflowLargerApplyNewLayout=g.reflowLargerCreateNewLayout=g.reflowLargerGetLinesToRemove=void 0,g.reflowLargerGetLinesToRemove=function(H,h,E,D,p){const B=[];for(let R=0;R<H.length-1;R++){let v=R,L=H.get(++v);if(!L.isWrapped)continue;const C=[H.get(R)];for(;v<H.length&&L.isWrapped;)C.push(L),L=H.get(++v);if(D>=R&&D<v){R+=C.length-1;continue}let S=0,f=b(C,S,h),O=1,M=0;for(;O<C.length;){const A=b(C,O,h),Z=A-M,F=E-f,W=Math.min(Z,F);C[S].copyCellsFrom(C[O],M,f,W,!1),f+=W,f===E&&(S++,f=0),M+=W,M===A&&(O++,M=0),f===0&&S!==0&&C[S-1].getWidth(E-1)===2&&(C[S].copyCellsFrom(C[S-1],E-1,f++,1,!1),C[S-1].setCell(E-1,p))}C[S].replaceCells(f,E,p);let m=0;for(let A=C.length-1;A>0&&(A>S||C[A].getTrimmedLength()===0);A--)m++;m>0&&(B.push(R+C.length-m),B.push(m)),R+=C.length-1}return B},g.reflowLargerCreateNewLayout=function(H,h){const E=[];let D=0,p=h[D],B=0;for(let R=0;R<H.length;R++)if(p===R){const v=h[++D];H.onDeleteEmitter.fire({index:R-B,amount:v}),R+=v-1,B+=v,p=h[++D]}else E.push(R);return{layout:E,countRemoved:B}},g.reflowLargerApplyNewLayout=function(H,h){const E=[];for(let D=0;D<h.length;D++)E.push(H.get(h[D]));for(let D=0;D<E.length;D++)H.set(D,E[D]);H.length=h.length},g.reflowSmallerGetNewLineLengths=function(H,h,E){const D=[],p=H.map((L,C)=>b(H,C,h)).reduce((L,C)=>L+C);let B=0,R=0,v=0;for(;v<p;){if(p-v<E){D.push(p-v);break}B+=E;const L=b(H,R,h);B>L&&(B-=L,R++);const C=H[R].getWidth(B-1)===2;C&&B--;const S=C?E-1:E;D.push(S),v+=S}return D},g.getWrappedLineTrimmedLength=b},5295:(U,g,b)=>{Object.defineProperty(g,"__esModule",{value:!0}),g.BufferSet=void 0;const H=b(8460),h=b(844),E=b(9092);class D extends h.Disposable{constructor(p,B){super(),this._optionsService=p,this._bufferService=B,this._onBufferActivate=this.register(new H.EventEmitter),this.onBufferActivate=this._onBufferActivate.event,this.reset(),this.register(this._optionsService.onSpecificOptionChange("scrollback",()=>this.resize(this._bufferService.cols,this._bufferService.rows))),this.register(this._optionsService.onSpecificOptionChange("tabStopWidth",()=>this.setupTabStops()))}reset(){this._normal=new E.Buffer(!0,this._optionsService,this._bufferService),this._normal.fillViewportRows(),this._alt=new E.Buffer(!1,this._optionsService,this._bufferService),this._activeBuffer=this._normal,this._onBufferActivate.fire({activeBuffer:this._normal,inactiveBuffer:this._alt}),this.setupTabStops()}get alt(){return this._alt}get active(){return this._activeBuffer}get normal(){return this._normal}activateNormalBuffer(){this._activeBuffer!==this._normal&&(this._normal.x=this._alt.x,this._normal.y=this._alt.y,this._alt.clearAllMarkers(),this._alt.clear(),this._activeBuffer=this._normal,this._onBufferActivate.fire({activeBuffer:this._normal,inactiveBuffer:this._alt}))}activateAltBuffer(p){this._activeBuffer!==this._alt&&(this._alt.fillViewportRows(p),this._alt.x=this._normal.x,this._alt.y=this._normal.y,this._activeBuffer=this._alt,this._onBufferActivate.fire({activeBuffer:this._alt,inactiveBuffer:this._normal}))}resize(p,B){this._normal.resize(p,B),this._alt.resize(p,B),this.setupTabStops(p)}setupTabStops(p){this._normal.setupTabStops(p),this._alt.setupTabStops(p)}}g.BufferSet=D},511:(U,g,b)=>{Object.defineProperty(g,"__esModule",{value:!0}),g.CellData=void 0;const H=b(482),h=b(643),E=b(3734);class D extends E.AttributeData{constructor(){super(...arguments),this.content=0,this.fg=0,this.bg=0,this.extended=new E.ExtendedAttrs,this.combinedData=""}static fromCharData(p){const B=new D;return B.setFromCharData(p),B}isCombined(){return 2097152&this.content}getWidth(){return this.content>>22}getChars(){return 2097152&this.content?this.combinedData:2097151&this.content?H.stringFromCodePoint(2097151&this.content):""}getCode(){return this.isCombined()?this.combinedData.charCodeAt(this.combinedData.length-1):2097151&this.content}setFromCharData(p){this.fg=p[h.CHAR_DATA_ATTR_INDEX],this.bg=0;let B=!1;if(p[h.CHAR_DATA_CHAR_INDEX].length>2)B=!0;else if(p[h.CHAR_DATA_CHAR_INDEX].length===2){const R=p[h.CHAR_DATA_CHAR_INDEX].charCodeAt(0);if(55296<=R&&R<=56319){const v=p[h.CHAR_DATA_CHAR_INDEX].charCodeAt(1);56320<=v&&v<=57343?this.content=1024*(R-55296)+v-56320+65536|p[h.CHAR_DATA_WIDTH_INDEX]<<22:B=!0}else B=!0}else this.content=p[h.CHAR_DATA_CHAR_INDEX].charCodeAt(0)|p[h.CHAR_DATA_WIDTH_INDEX]<<22;B&&(this.combinedData=p[h.CHAR_DATA_CHAR_INDEX],this.content=2097152|p[h.CHAR_DATA_WIDTH_INDEX]<<22)}getAsCharData(){return[this.fg,this.getChars(),this.getWidth(),this.getCode()]}}g.CellData=D},643:(U,g)=>{Object.defineProperty(g,"__esModule",{value:!0}),g.WHITESPACE_CELL_CODE=g.WHITESPACE_CELL_WIDTH=g.WHITESPACE_CELL_CHAR=g.NULL_CELL_CODE=g.NULL_CELL_WIDTH=g.NULL_CELL_CHAR=g.CHAR_DATA_CODE_INDEX=g.CHAR_DATA_WIDTH_INDEX=g.CHAR_DATA_CHAR_INDEX=g.CHAR_DATA_ATTR_INDEX=g.DEFAULT_EXT=g.DEFAULT_ATTR=g.DEFAULT_COLOR=void 0,g.DEFAULT_COLOR=0,g.DEFAULT_ATTR=256|g.DEFAULT_COLOR<<9,g.DEFAULT_EXT=0,g.CHAR_DATA_ATTR_INDEX=0,g.CHAR_DATA_CHAR_INDEX=1,g.CHAR_DATA_WIDTH_INDEX=2,g.CHAR_DATA_CODE_INDEX=3,g.NULL_CELL_CHAR="",g.NULL_CELL_WIDTH=1,g.NULL_CELL_CODE=0,g.WHITESPACE_CELL_CHAR=" ",g.WHITESPACE_CELL_WIDTH=1,g.WHITESPACE_CELL_CODE=32},4863:(U,g,b)=>{Object.defineProperty(g,"__esModule",{value:!0}),g.Marker=void 0;const H=b(8460),h=b(844);class E{get id(){return this._id}constructor(D){this.line=D,this.isDisposed=!1,this._disposables=[],this._id=E._nextId++,this._onDispose=this.register(new H.EventEmitter),this.onDispose=this._onDispose.event}dispose(){this.isDisposed||(this.isDisposed=!0,this.line=-1,this._onDispose.fire(),h.disposeArray(this._disposables),this._disposables.length=0)}register(D){return this._disposables.push(D),D}}g.Marker=E,E._nextId=1},7116:(U,g)=>{Object.defineProperty(g,"__esModule",{value:!0}),g.DEFAULT_CHARSET=g.CHARSETS=void 0,g.CHARSETS={},g.DEFAULT_CHARSET=g.CHARSETS.B,g.CHARSETS[0]={"`":"\u25C6",a:"\u2592",b:"\u2409",c:"\u240C",d:"\u240D",e:"\u240A",f:"\xB0",g:"\xB1",h:"\u2424",i:"\u240B",j:"\u2518",k:"\u2510",l:"\u250C",m:"\u2514",n:"\u253C",o:"\u23BA",p:"\u23BB",q:"\u2500",r:"\u23BC",s:"\u23BD",t:"\u251C",u:"\u2524",v:"\u2534",w:"\u252C",x:"\u2502",y:"\u2264",z:"\u2265","{":"\u03C0","|":"\u2260","}":"\xA3","~":"\xB7"},g.CHARSETS.A={"#":"\xA3"},g.CHARSETS.B=void 0,g.CHARSETS[4]={"#":"\xA3","@":"\xBE","[":"ij","\\":"\xBD","]":"|","{":"\xA8","|":"f","}":"\xBC","~":"\xB4"},g.CHARSETS.C=g.CHARSETS[5]={"[":"\xC4","\\":"\xD6","]":"\xC5","^":"\xDC","`":"\xE9","{":"\xE4","|":"\xF6","}":"\xE5","~":"\xFC"},g.CHARSETS.R={"#":"\xA3","@":"\xE0","[":"\xB0","\\":"\xE7","]":"\xA7","{":"\xE9","|":"\xF9","}":"\xE8","~":"\xA8"},g.CHARSETS.Q={"@":"\xE0","[":"\xE2","\\":"\xE7","]":"\xEA","^":"\xEE","`":"\xF4","{":"\xE9","|":"\xF9","}":"\xE8","~":"\xFB"},g.CHARSETS.K={"@":"\xA7","[":"\xC4","\\":"\xD6","]":"\xDC","{":"\xE4","|":"\xF6","}":"\xFC","~":"\xDF"},g.CHARSETS.Y={"#":"\xA3","@":"\xA7","[":"\xB0","\\":"\xE7","]":"\xE9","`":"\xF9","{":"\xE0","|":"\xF2","}":"\xE8","~":"\xEC"},g.CHARSETS.E=g.CHARSETS[6]={"@":"\xC4","[":"\xC6","\\":"\xD8","]":"\xC5","^":"\xDC","`":"\xE4","{":"\xE6","|":"\xF8","}":"\xE5","~":"\xFC"},g.CHARSETS.Z={"#":"\xA3","@":"\xA7","[":"\xA1","\\":"\xD1","]":"\xBF","{":"\xB0","|":"\xF1","}":"\xE7"},g.CHARSETS.H=g.CHARSETS[7]={"@":"\xC9","[":"\xC4","\\":"\xD6","]":"\xC5","^":"\xDC","`":"\xE9","{":"\xE4","|":"\xF6","}":"\xE5","~":"\xFC"},g.CHARSETS["="]={"#":"\xF9","@":"\xE0","[":"\xE9","\\":"\xE7","]":"\xEA","^":"\xEE",_:"\xE8","`":"\xF4","{":"\xE4","|":"\xF6","}":"\xFC","~":"\xFB"}},2584:(U,g)=>{var b,H,h;Object.defineProperty(g,"__esModule",{value:!0}),g.C1_ESCAPED=g.C1=g.C0=void 0,function(E){E.NUL="\0",E.SOH="",E.STX="",E.ETX="",E.EOT="",E.ENQ="",E.ACK="",E.BEL="",E.BS="\b",E.HT="\t",E.LF="\n",E.VT="\v",E.FF="\f",E.CR="\r",E.SO="",E.SI="",E.DLE="",E.DC1="",E.DC2="",E.DC3="",E.DC4="",E.NAK="",E.SYN="",E.ETB="",E.CAN="",E.EM="",E.SUB="",E.ESC="",E.FS="",E.GS="",E.RS="",E.US="",E.SP=" ",E.DEL=""}(b||(g.C0=b={})),function(E){E.PAD="\x80",E.HOP="\x81",E.BPH="\x82",E.NBH="\x83",E.IND="\x84",E.NEL="\x85",E.SSA="\x86",E.ESA="\x87",E.HTS="\x88",E.HTJ="\x89",E.VTS="\x8A",E.PLD="\x8B",E.PLU="\x8C",E.RI="\x8D",E.SS2="\x8E",E.SS3="\x8F",E.DCS="\x90",E.PU1="\x91",E.PU2="\x92",E.STS="\x93",E.CCH="\x94",E.MW="\x95",E.SPA="\x96",E.EPA="\x97",E.SOS="\x98",E.SGCI="\x99",E.SCI="\x9A",E.CSI="\x9B",E.ST="\x9C",E.OSC="\x9D",E.PM="\x9E",E.APC="\x9F"}(H||(g.C1=H={})),function(E){E.ST=`${b.ESC}\\`}(h||(g.C1_ESCAPED=h={}))},7399:(U,g,b)=>{Object.defineProperty(g,"__esModule",{value:!0}),g.evaluateKeyboardEvent=void 0;const H=b(2584),h={48:["0",")"],49:["1","!"],50:["2","@"],51:["3","#"],52:["4","$"],53:["5","%"],54:["6","^"],55:["7","&"],56:["8","*"],57:["9","("],186:[";",":"],187:["=","+"],188:[",","<"],189:["-","_"],190:[".",">"],191:["/","?"],192:["`","~"],219:["[","{"],220:["\\","|"],221:["]","}"],222:["'",'"']};g.evaluateKeyboardEvent=function(E,D,p,B){const R={type:0,cancel:!1,key:void 0},v=(E.shiftKey?1:0)|(E.altKey?2:0)|(E.ctrlKey?4:0)|(E.metaKey?8:0);switch(E.keyCode){case 0:E.key==="UIKeyInputUpArrow"?R.key=D?H.C0.ESC+"OA":H.C0.ESC+"[A":E.key==="UIKeyInputLeftArrow"?R.key=D?H.C0.ESC+"OD":H.C0.ESC+"[D":E.key==="UIKeyInputRightArrow"?R.key=D?H.C0.ESC+"OC":H.C0.ESC+"[C":E.key==="UIKeyInputDownArrow"&&(R.key=D?H.C0.ESC+"OB":H.C0.ESC+"[B");break;case 8:if(E.altKey){R.key=H.C0.ESC+H.C0.DEL;break}R.key=H.C0.DEL;break;case 9:if(E.shiftKey){R.key=H.C0.ESC+"[Z";break}R.key=H.C0.HT,R.cancel=!0;break;case 13:R.key=E.altKey?H.C0.ESC+H.C0.CR:H.C0.CR,R.cancel=!0;break;case 27:R.key=H.C0.ESC,E.altKey&&(R.key=H.C0.ESC+H.C0.ESC),R.cancel=!0;break;case 37:if(E.metaKey)break;v?(R.key=H.C0.ESC+"[1;"+(v+1)+"D",R.key===H.C0.ESC+"[1;3D"&&(R.key=H.C0.ESC+(p?"b":"[1;5D"))):R.key=D?H.C0.ESC+"OD":H.C0.ESC+"[D";break;case 39:if(E.metaKey)break;v?(R.key=H.C0.ESC+"[1;"+(v+1)+"C",R.key===H.C0.ESC+"[1;3C"&&(R.key=H.C0.ESC+(p?"f":"[1;5C"))):R.key=D?H.C0.ESC+"OC":H.C0.ESC+"[C";break;case 38:if(E.metaKey)break;v?(R.key=H.C0.ESC+"[1;"+(v+1)+"A",p||R.key!==H.C0.ESC+"[1;3A"||(R.key=H.C0.ESC+"[1;5A")):R.key=D?H.C0.ESC+"OA":H.C0.ESC+"[A";break;case 40:if(E.metaKey)break;v?(R.key=H.C0.ESC+"[1;"+(v+1)+"B",p||R.key!==H.C0.ESC+"[1;3B"||(R.key=H.C0.ESC+"[1;5B")):R.key=D?H.C0.ESC+"OB":H.C0.ESC+"[B";break;case 45:E.shiftKey||E.ctrlKey||(R.key=H.C0.ESC+"[2~");break;case 46:R.key=v?H.C0.ESC+"[3;"+(v+1)+"~":H.C0.ESC+"[3~";break;case 36:R.key=v?H.C0.ESC+"[1;"+(v+1)+"H":D?H.C0.ESC+"OH":H.C0.ESC+"[H";break;case 35:R.key=v?H.C0.ESC+"[1;"+(v+1)+"F":D?H.C0.ESC+"OF":H.C0.ESC+"[F";break;case 33:E.shiftKey?R.type=2:E.ctrlKey?R.key=H.C0.ESC+"[5;"+(v+1)+"~":R.key=H.C0.ESC+"[5~";break;case 34:E.shiftKey?R.type=3:E.ctrlKey?R.key=H.C0.ESC+"[6;"+(v+1)+"~":R.key=H.C0.ESC+"[6~";break;case 112:R.key=v?H.C0.ESC+"[1;"+(v+1)+"P":H.C0.ESC+"OP";break;case 113:R.key=v?H.C0.ESC+"[1;"+(v+1)+"Q":H.C0.ESC+"OQ";break;case 114:R.key=v?H.C0.ESC+"[1;"+(v+1)+"R":H.C0.ESC+"OR";break;case 115:R.key=v?H.C0.ESC+"[1;"+(v+1)+"S":H.C0.ESC+"OS";break;case 116:R.key=v?H.C0.ESC+"[15;"+(v+1)+"~":H.C0.ESC+"[15~";break;case 117:R.key=v?H.C0.ESC+"[17;"+(v+1)+"~":H.C0.ESC+"[17~";break;case 118:R.key=v?H.C0.ESC+"[18;"+(v+1)+"~":H.C0.ESC+"[18~";break;case 119:R.key=v?H.C0.ESC+"[19;"+(v+1)+"~":H.C0.ESC+"[19~";break;case 120:R.key=v?H.C0.ESC+"[20;"+(v+1)+"~":H.C0.ESC+"[20~";break;case 121:R.key=v?H.C0.ESC+"[21;"+(v+1)+"~":H.C0.ESC+"[21~";break;case 122:R.key=v?H.C0.ESC+"[23;"+(v+1)+"~":H.C0.ESC+"[23~";break;case 123:R.key=v?H.C0.ESC+"[24;"+(v+1)+"~":H.C0.ESC+"[24~";break;default:if(!E.ctrlKey||E.shiftKey||E.altKey||E.metaKey)if(p&&!B||!E.altKey||E.metaKey)!p||E.altKey||E.ctrlKey||E.shiftKey||!E.metaKey?E.key&&!E.ctrlKey&&!E.altKey&&!E.metaKey&&E.keyCode>=48&&E.key.length===1?R.key=E.key:E.key&&E.ctrlKey&&(E.key==="_"&&(R.key=H.C0.US),E.key==="@"&&(R.key=H.C0.NUL)):E.keyCode===65&&(R.type=1);else{const L=h[E.keyCode],C=L==null?void 0:L[E.shiftKey?1:0];if(C)R.key=H.C0.ESC+C;else if(E.keyCode>=65&&E.keyCode<=90){const S=E.ctrlKey?E.keyCode-64:E.keyCode+32;let f=String.fromCharCode(S);E.shiftKey&&(f=f.toUpperCase()),R.key=H.C0.ESC+f}else if(E.keyCode===32)R.key=H.C0.ESC+(E.ctrlKey?H.C0.NUL:" ");else if(E.key==="Dead"&&E.code.startsWith("Key")){let S=E.code.slice(3,4);E.shiftKey||(S=S.toLowerCase()),R.key=H.C0.ESC+S,R.cancel=!0}}else E.keyCode>=65&&E.keyCode<=90?R.key=String.fromCharCode(E.keyCode-64):E.keyCode===32?R.key=H.C0.NUL:E.keyCode>=51&&E.keyCode<=55?R.key=String.fromCharCode(E.keyCode-51+27):E.keyCode===56?R.key=H.C0.DEL:E.keyCode===219?R.key=H.C0.ESC:E.keyCode===220?R.key=H.C0.FS:E.keyCode===221&&(R.key=H.C0.GS)}return R}},482:(U,g)=>{Object.defineProperty(g,"__esModule",{value:!0}),g.Utf8ToUtf32=g.StringToUtf32=g.utf32ToString=g.stringFromCodePoint=void 0,g.stringFromCodePoint=function(b){return b>65535?(b-=65536,String.fromCharCode(55296+(b>>10))+String.fromCharCode(b%1024+56320)):String.fromCharCode(b)},g.utf32ToString=function(b,H=0,h=b.length){let E="";for(let D=H;D<h;++D){let p=b[D];p>65535?(p-=65536,E+=String.fromCharCode(55296+(p>>10))+String.fromCharCode(p%1024+56320)):E+=String.fromCharCode(p)}return E},g.StringToUtf32=class{constructor(){this._interim=0}clear(){this._interim=0}decode(b,H){const h=b.length;if(!h)return 0;let E=0,D=0;if(this._interim){const p=b.charCodeAt(D++);56320<=p&&p<=57343?H[E++]=1024*(this._interim-55296)+p-56320+65536:(H[E++]=this._interim,H[E++]=p),this._interim=0}for(let p=D;p<h;++p){const B=b.charCodeAt(p);if(55296<=B&&B<=56319){if(++p>=h)return this._interim=B,E;const R=b.charCodeAt(p);56320<=R&&R<=57343?H[E++]=1024*(B-55296)+R-56320+65536:(H[E++]=B,H[E++]=R)}else B!==65279&&(H[E++]=B)}return E}},g.Utf8ToUtf32=class{constructor(){this.interim=new Uint8Array(3)}clear(){this.interim.fill(0)}decode(b,H){const h=b.length;if(!h)return 0;let E,D,p,B,R=0,v=0,L=0;if(this.interim[0]){let f=!1,O=this.interim[0];O&=(224&O)==192?31:(240&O)==224?15:7;let M,m=0;for(;(M=63&this.interim[++m])&&m<4;)O<<=6,O|=M;const A=(224&this.interim[0])==192?2:(240&this.interim[0])==224?3:4,Z=A-m;for(;L<Z;){if(L>=h)return 0;if(M=b[L++],(192&M)!=128){L--,f=!0;break}this.interim[m++]=M,O<<=6,O|=63&M}f||(A===2?O<128?L--:H[R++]=O:A===3?O<2048||O>=55296&&O<=57343||O===65279||(H[R++]=O):O<65536||O>1114111||(H[R++]=O)),this.interim.fill(0)}const C=h-4;let S=L;for(;S<h;){for(;!(!(S<C)||128&(E=b[S])||128&(D=b[S+1])||128&(p=b[S+2])||128&(B=b[S+3]));)H[R++]=E,H[R++]=D,H[R++]=p,H[R++]=B,S+=4;if(E=b[S++],E<128)H[R++]=E;else if((224&E)==192){if(S>=h)return this.interim[0]=E,R;if(D=b[S++],(192&D)!=128){S--;continue}if(v=(31&E)<<6|63&D,v<128){S--;continue}H[R++]=v}else if((240&E)==224){if(S>=h)return this.interim[0]=E,R;if(D=b[S++],(192&D)!=128){S--;continue}if(S>=h)return this.interim[0]=E,this.interim[1]=D,R;if(p=b[S++],(192&p)!=128){S--;continue}if(v=(15&E)<<12|(63&D)<<6|63&p,v<2048||v>=55296&&v<=57343||v===65279)continue;H[R++]=v}else if((248&E)==240){if(S>=h)return this.interim[0]=E,R;if(D=b[S++],(192&D)!=128){S--;continue}if(S>=h)return this.interim[0]=E,this.interim[1]=D,R;if(p=b[S++],(192&p)!=128){S--;continue}if(S>=h)return this.interim[0]=E,this.interim[1]=D,this.interim[2]=p,R;if(B=b[S++],(192&B)!=128){S--;continue}if(v=(7&E)<<18|(63&D)<<12|(63&p)<<6|63&B,v<65536||v>1114111)continue;H[R++]=v}}return R}}},225:(U,g)=>{Object.defineProperty(g,"__esModule",{value:!0}),g.UnicodeV6=void 0;const b=[[768,879],[1155,1158],[1160,1161],[1425,1469],[1471,1471],[1473,1474],[1476,1477],[1479,1479],[1536,1539],[1552,1557],[1611,1630],[1648,1648],[1750,1764],[1767,1768],[1770,1773],[1807,1807],[1809,1809],[1840,1866],[1958,1968],[2027,2035],[2305,2306],[2364,2364],[2369,2376],[2381,2381],[2385,2388],[2402,2403],[2433,2433],[2492,2492],[2497,2500],[2509,2509],[2530,2531],[2561,2562],[2620,2620],[2625,2626],[2631,2632],[2635,2637],[2672,2673],[2689,2690],[2748,2748],[2753,2757],[2759,2760],[2765,2765],[2786,2787],[2817,2817],[2876,2876],[2879,2879],[2881,2883],[2893,2893],[2902,2902],[2946,2946],[3008,3008],[3021,3021],[3134,3136],[3142,3144],[3146,3149],[3157,3158],[3260,3260],[3263,3263],[3270,3270],[3276,3277],[3298,3299],[3393,3395],[3405,3405],[3530,3530],[3538,3540],[3542,3542],[3633,3633],[3636,3642],[3655,3662],[3761,3761],[3764,3769],[3771,3772],[3784,3789],[3864,3865],[3893,3893],[3895,3895],[3897,3897],[3953,3966],[3968,3972],[3974,3975],[3984,3991],[3993,4028],[4038,4038],[4141,4144],[4146,4146],[4150,4151],[4153,4153],[4184,4185],[4448,4607],[4959,4959],[5906,5908],[5938,5940],[5970,5971],[6002,6003],[6068,6069],[6071,6077],[6086,6086],[6089,6099],[6109,6109],[6155,6157],[6313,6313],[6432,6434],[6439,6440],[6450,6450],[6457,6459],[6679,6680],[6912,6915],[6964,6964],[6966,6970],[6972,6972],[6978,6978],[7019,7027],[7616,7626],[7678,7679],[8203,8207],[8234,8238],[8288,8291],[8298,8303],[8400,8431],[12330,12335],[12441,12442],[43014,43014],[43019,43019],[43045,43046],[64286,64286],[65024,65039],[65056,65059],[65279,65279],[65529,65531]],H=[[68097,68099],[68101,68102],[68108,68111],[68152,68154],[68159,68159],[119143,119145],[119155,119170],[119173,119179],[119210,119213],[119362,119364],[917505,917505],[917536,917631],[917760,917999]];let h;g.UnicodeV6=class{constructor(){if(this.version="6",!h){h=new Uint8Array(65536),h.fill(1),h[0]=0,h.fill(0,1,32),h.fill(0,127,160),h.fill(2,4352,4448),h[9001]=2,h[9002]=2,h.fill(2,11904,42192),h[12351]=1,h.fill(2,44032,55204),h.fill(2,63744,64256),h.fill(2,65040,65050),h.fill(2,65072,65136),h.fill(2,65280,65377),h.fill(2,65504,65511);for(let E=0;E<b.length;++E)h.fill(0,b[E][0],b[E][1]+1)}}wcwidth(E){return E<32?0:E<127?1:E<65536?h[E]:function(D,p){let B,R=0,v=p.length-1;if(D<p[0][0]||D>p[v][1])return!1;for(;v>=R;)if(B=R+v>>1,D>p[B][1])R=B+1;else{if(!(D<p[B][0]))return!0;v=B-1}return!1}(E,H)?0:E>=131072&&E<=196605||E>=196608&&E<=262141?2:1}}},5981:(U,g,b)=>{Object.defineProperty(g,"__esModule",{value:!0}),g.WriteBuffer=void 0;const H=b(8460),h=b(844);class E extends h.Disposable{constructor(D){super(),this._action=D,this._writeBuffer=[],this._callbacks=[],this._pendingData=0,this._bufferOffset=0,this._isSyncWriting=!1,this._syncCalls=0,this._didUserInput=!1,this._onWriteParsed=this.register(new H.EventEmitter),this.onWriteParsed=this._onWriteParsed.event}handleUserInput(){this._didUserInput=!0}writeSync(D,p){if(p!==void 0&&this._syncCalls>p)return void(this._syncCalls=0);if(this._pendingData+=D.length,this._writeBuffer.push(D),this._callbacks.push(void 0),this._syncCalls++,this._isSyncWriting)return;let B;for(this._isSyncWriting=!0;B=this._writeBuffer.shift();){this._action(B);const R=this._callbacks.shift();R&&R()}this._pendingData=0,this._bufferOffset=2147483647,this._isSyncWriting=!1,this._syncCalls=0}write(D,p){if(this._pendingData>50000000)throw new Error("write data discarded, use flow control to avoid losing data");if(!this._writeBuffer.length){if(this._bufferOffset=0,this._didUserInput)return this._didUserInput=!1,this._pendingData+=D.length,this._writeBuffer.push(D),this._callbacks.push(p),void this._innerWrite();setTimeout(()=>this._innerWrite())}this._pendingData+=D.length,this._writeBuffer.push(D),this._callbacks.push(p)}_innerWrite(D=0,p=!0){const B=D||Date.now();for(;this._writeBuffer.length>this._bufferOffset;){const R=this._writeBuffer[this._bufferOffset],v=this._action(R,p);if(v){const C=(S)=>Date.now()-B>=12?setTimeout(()=>this._innerWrite(0,S)):this._innerWrite(B,S);return void v.catch((S)=>(queueMicrotask(()=>{throw S}),Promise.resolve(!1))).then(C)}const L=this._callbacks[this._bufferOffset];if(L&&L(),this._bufferOffset++,this._pendingData-=R.length,Date.now()-B>=12)break}this._writeBuffer.length>this._bufferOffset?(this._bufferOffset>50&&(this._writeBuffer=this._writeBuffer.slice(this._bufferOffset),this._callbacks=this._callbacks.slice(this._bufferOffset),this._bufferOffset=0),setTimeout(()=>this._innerWrite())):(this._writeBuffer.length=0,this._callbacks.length=0,this._pendingData=0,this._bufferOffset=0),this._onWriteParsed.fire()}}g.WriteBuffer=E},5941:(U,g)=>{Object.defineProperty(g,"__esModule",{value:!0}),g.toRgbString=g.parseColor=void 0;const b=/^([\da-f])\/([\da-f])\/([\da-f])$|^([\da-f]{2})\/([\da-f]{2})\/([\da-f]{2})$|^([\da-f]{3})\/([\da-f]{3})\/([\da-f]{3})$|^([\da-f]{4})\/([\da-f]{4})\/([\da-f]{4})$/,H=/^[\da-f]+$/;function h(E,D){const p=E.toString(16),B=p.length<2?"0"+p:p;switch(D){case 4:return p[0];case 8:return B;case 12:return(B+B).slice(0,3);default:return B+B}}g.parseColor=function(E){if(!E)return;let D=E.toLowerCase();if(D.indexOf("rgb:")===0){D=D.slice(4);const p=b.exec(D);if(p){const B=p[1]?15:p[4]?255:p[7]?4095:65535;return[Math.round(parseInt(p[1]||p[4]||p[7]||p[10],16)/B*255),Math.round(parseInt(p[2]||p[5]||p[8]||p[11],16)/B*255),Math.round(parseInt(p[3]||p[6]||p[9]||p[12],16)/B*255)]}}else if(D.indexOf("#")===0&&(D=D.slice(1),H.exec(D)&&[3,6,9,12].includes(D.length))){const p=D.length/3,B=[0,0,0];for(let R=0;R<3;++R){const v=parseInt(D.slice(p*R,p*R+p),16);B[R]=p===1?v<<4:p===2?v:p===3?v>>4:v>>8}return B}},g.toRgbString=function(E,D=16){const[p,B,R]=E;return`rgb:${h(p,D)}/${h(B,D)}/${h(R,D)}`}},5770:(U,g)=>{Object.defineProperty(g,"__esModule",{value:!0}),g.PAYLOAD_LIMIT=void 0,g.PAYLOAD_LIMIT=1e7},6351:(U,g,b)=>{Object.defineProperty(g,"__esModule",{value:!0}),g.DcsHandler=g.DcsParser=void 0;const H=b(482),h=b(8742),E=b(5770),D=[];g.DcsParser=class{constructor(){this._handlers=Object.create(null),this._active=D,this._ident=0,this._handlerFb=()=>{},this._stack={paused:!1,loopPosition:0,fallThrough:!1}}dispose(){this._handlers=Object.create(null),this._handlerFb=()=>{},this._active=D}registerHandler(B,R){this._handlers[B]===void 0&&(this._handlers[B]=[]);const v=this._handlers[B];return v.push(R),{dispose:()=>{const L=v.indexOf(R);L!==-1&&v.splice(L,1)}}}clearHandler(B){this._handlers[B]&&delete this._handlers[B]}setHandlerFallback(B){this._handlerFb=B}reset(){if(this._active.length)for(let B=this._stack.paused?this._stack.loopPosition-1:this._active.length-1;B>=0;--B)this._active[B].unhook(!1);this._stack.paused=!1,this._active=D,this._ident=0}hook(B,R){if(this.reset(),this._ident=B,this._active=this._handlers[B]||D,this._active.length)for(let v=this._active.length-1;v>=0;v--)this._active[v].hook(R);else this._handlerFb(this._ident,"HOOK",R)}put(B,R,v){if(this._active.length)for(let L=this._active.length-1;L>=0;L--)this._active[L].put(B,R,v);else this._handlerFb(this._ident,"PUT",H.utf32ToString(B,R,v))}unhook(B,R=!0){if(this._active.length){let v=!1,L=this._active.length-1,C=!1;if(this._stack.paused&&(L=this._stack.loopPosition-1,v=R,C=this._stack.fallThrough,this._stack.paused=!1),!C&&v===!1){for(;L>=0&&(v=this._active[L].unhook(B),v!==!0);L--)if(v instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=L,this._stack.fallThrough=!1,v;L--}for(;L>=0;L--)if(v=this._active[L].unhook(!1),v instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=L,this._stack.fallThrough=!0,v}else this._handlerFb(this._ident,"UNHOOK",B);this._active=D,this._ident=0}};const p=new h.Params;p.addParam(0),g.DcsHandler=class{constructor(B){this._handler=B,this._data="",this._params=p,this._hitLimit=!1}hook(B){this._params=B.length>1||B.params[0]?B.clone():p,this._data="",this._hitLimit=!1}put(B,R,v){this._hitLimit||(this._data+=H.utf32ToString(B,R,v),this._data.length>E.PAYLOAD_LIMIT&&(this._data="",this._hitLimit=!0))}unhook(B){let R=!1;if(this._hitLimit)R=!1;else if(B&&(R=this._handler(this._data,this._params),R instanceof Promise))return R.then((v)=>(this._params=p,this._data="",this._hitLimit=!1,v));return this._params=p,this._data="",this._hitLimit=!1,R}}},2015:(U,g,b)=>{Object.defineProperty(g,"__esModule",{value:!0}),g.EscapeSequenceParser=g.VT500_TRANSITION_TABLE=g.TransitionTable=void 0;const H=b(844),h=b(8742),E=b(6242),D=b(6351);class p{constructor(v){this.table=new Uint8Array(v)}setDefault(v,L){this.table.fill(v<<4|L)}add(v,L,C,S){this.table[L<<8|v]=C<<4|S}addMany(v,L,C,S){for(let f=0;f<v.length;f++)this.table[L<<8|v[f]]=C<<4|S}}g.TransitionTable=p;const B=160;g.VT500_TRANSITION_TABLE=function(){const v=new p(4095),L=Array.apply(null,Array(256)).map((m,A)=>A),C=(m,A)=>L.slice(m,A),S=C(32,127),f=C(0,24);f.push(25),f.push.apply(f,C(28,32));const O=C(0,14);let M;for(M in v.setDefault(1,0),v.addMany(S,0,2,0),O)v.addMany([24,26,153,154],M,3,0),v.addMany(C(128,144),M,3,0),v.addMany(C(144,152),M,3,0),v.add(156,M,0,0),v.add(27,M,11,1),v.add(157,M,4,8),v.addMany([152,158,159],M,0,7),v.add(155,M,11,3),v.add(144,M,11,9);return v.addMany(f,0,3,0),v.addMany(f,1,3,1),v.add(127,1,0,1),v.addMany(f,8,0,8),v.addMany(f,3,3,3),v.add(127,3,0,3),v.addMany(f,4,3,4),v.add(127,4,0,4),v.addMany(f,6,3,6),v.addMany(f,5,3,5),v.add(127,5,0,5),v.addMany(f,2,3,2),v.add(127,2,0,2),v.add(93,1,4,8),v.addMany(S,8,5,8),v.add(127,8,5,8),v.addMany([156,27,24,26,7],8,6,0),v.addMany(C(28,32),8,0,8),v.addMany([88,94,95],1,0,7),v.addMany(S,7,0,7),v.addMany(f,7,0,7),v.add(156,7,0,0),v.add(127,7,0,7),v.add(91,1,11,3),v.addMany(C(64,127),3,7,0),v.addMany(C(48,60),3,8,4),v.addMany([60,61,62,63],3,9,4),v.addMany(C(48,60),4,8,4),v.addMany(C(64,127),4,7,0),v.addMany([60,61,62,63],4,0,6),v.addMany(C(32,64),6,0,6),v.add(127,6,0,6),v.addMany(C(64,127),6,0,0),v.addMany(C(32,48),3,9,5),v.addMany(C(32,48),5,9,5),v.addMany(C(48,64),5,0,6),v.addMany(C(64,127),5,7,0),v.addMany(C(32,48),4,9,5),v.addMany(C(32,48),1,9,2),v.addMany(C(32,48),2,9,2),v.addMany(C(48,127),2,10,0),v.addMany(C(48,80),1,10,0),v.addMany(C(81,88),1,10,0),v.addMany([89,90,92],1,10,0),v.addMany(C(96,127),1,10,0),v.add(80,1,11,9),v.addMany(f,9,0,9),v.add(127,9,0,9),v.addMany(C(28,32),9,0,9),v.addMany(C(32,48),9,9,12),v.addMany(C(48,60),9,8,10),v.addMany([60,61,62,63],9,9,10),v.addMany(f,11,0,11),v.addMany(C(32,128),11,0,11),v.addMany(C(28,32),11,0,11),v.addMany(f,10,0,10),v.add(127,10,0,10),v.addMany(C(28,32),10,0,10),v.addMany(C(48,60),10,8,10),v.addMany([60,61,62,63],10,0,11),v.addMany(C(32,48),10,9,12),v.addMany(f,12,0,12),v.add(127,12,0,12),v.addMany(C(28,32),12,0,12),v.addMany(C(32,48),12,9,12),v.addMany(C(48,64),12,0,11),v.addMany(C(64,127),12,12,13),v.addMany(C(64,127),10,12,13),v.addMany(C(64,127),9,12,13),v.addMany(f,13,13,13),v.addMany(S,13,13,13),v.add(127,13,0,13),v.addMany([27,156,24,26],13,14,0),v.add(B,0,2,0),v.add(B,8,5,8),v.add(B,6,0,6),v.add(B,11,0,11),v.add(B,13,13,13),v}();class R extends H.Disposable{constructor(v=g.VT500_TRANSITION_TABLE){super(),this._transitions=v,this._parseStack={state:0,handlers:[],handlerPos:0,transition:0,chunkPos:0},this.initialState=0,this.currentState=this.initialState,this._params=new h.Params,this._params.addParam(0),this._collect=0,this.precedingCodepoint=0,this._printHandlerFb=(L,C,S)=>{},this._executeHandlerFb=(L)=>{},this._csiHandlerFb=(L,C)=>{},this._escHandlerFb=(L)=>{},this._errorHandlerFb=(L)=>L,this._printHandler=this._printHandlerFb,this._executeHandlers=Object.create(null),this._csiHandlers=Object.create(null),this._escHandlers=Object.create(null),this.register(H.toDisposable(()=>{this._csiHandlers=Object.create(null),this._executeHandlers=Object.create(null),this._escHandlers=Object.create(null)})),this._oscParser=this.register(new E.OscParser),this._dcsParser=this.register(new D.DcsParser),this._errorHandler=this._errorHandlerFb,this.registerEscHandler({final:"\\"},()=>!0)}_identifier(v,L=[64,126]){let C=0;if(v.prefix){if(v.prefix.length>1)throw new Error("only one byte as prefix supported");if(C=v.prefix.charCodeAt(0),C&&60>C||C>63)throw new Error("prefix must be in range 0x3c .. 0x3f")}if(v.intermediates){if(v.intermediates.length>2)throw new Error("only two bytes as intermediates are supported");for(let f=0;f<v.intermediates.length;++f){const O=v.intermediates.charCodeAt(f);if(32>O||O>47)throw new Error("intermediate must be in range 0x20 .. 0x2f");C<<=8,C|=O}}if(v.final.length!==1)throw new Error("final must be a single byte");const S=v.final.charCodeAt(0);if(L[0]>S||S>L[1])throw new Error(`final must be in range ${L[0]} .. ${L[1]}`);return C<<=8,C|=S,C}identToString(v){const L=[];for(;v;)L.push(String.fromCharCode(255&v)),v>>=8;return L.reverse().join("")}setPrintHandler(v){this._printHandler=v}clearPrintHandler(){this._printHandler=this._printHandlerFb}registerEscHandler(v,L){const C=this._identifier(v,[48,126]);this._escHandlers[C]===void 0&&(this._escHandlers[C]=[]);const S=this._escHandlers[C];return S.push(L),{dispose:()=>{const f=S.indexOf(L);f!==-1&&S.splice(f,1)}}}clearEscHandler(v){this._escHandlers[this._identifier(v,[48,126])]&&delete this._escHandlers[this._identifier(v,[48,126])]}setEscHandlerFallback(v){this._escHandlerFb=v}setExecuteHandler(v,L){this._executeHandlers[v.charCodeAt(0)]=L}clearExecuteHandler(v){this._executeHandlers[v.charCodeAt(0)]&&delete this._executeHandlers[v.charCodeAt(0)]}setExecuteHandlerFallback(v){this._executeHandlerFb=v}registerCsiHandler(v,L){const C=this._identifier(v);this._csiHandlers[C]===void 0&&(this._csiHandlers[C]=[]);const S=this._csiHandlers[C];return S.push(L),{dispose:()=>{const f=S.indexOf(L);f!==-1&&S.splice(f,1)}}}clearCsiHandler(v){this._csiHandlers[this._identifier(v)]&&delete this._csiHandlers[this._identifier(v)]}setCsiHandlerFallback(v){this._csiHandlerFb=v}registerDcsHandler(v,L){return this._dcsParser.registerHandler(this._identifier(v),L)}clearDcsHandler(v){this._dcsParser.clearHandler(this._identifier(v))}setDcsHandlerFallback(v){this._dcsParser.setHandlerFallback(v)}registerOscHandler(v,L){return this._oscParser.registerHandler(v,L)}clearOscHandler(v){this._oscParser.clearHandler(v)}setOscHandlerFallback(v){this._oscParser.setHandlerFallback(v)}setErrorHandler(v){this._errorHandler=v}clearErrorHandler(){this._errorHandler=this._errorHandlerFb}reset(){this.currentState=this.initialState,this._oscParser.reset(),this._dcsParser.reset(),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingCodepoint=0,this._parseStack.state!==0&&(this._parseStack.state=2,this._parseStack.handlers=[])}_preserveStack(v,L,C,S,f){this._parseStack.state=v,this._parseStack.handlers=L,this._parseStack.handlerPos=C,this._parseStack.transition=S,this._parseStack.chunkPos=f}parse(v,L,C){let S,f=0,O=0,M=0;if(this._parseStack.state)if(this._parseStack.state===2)this._parseStack.state=0,M=this._parseStack.chunkPos+1;else{if(C===void 0||this._parseStack.state===1)throw this._parseStack.state=1,new Error("improper continuation due to previous async handler, giving up parsing");const m=this._parseStack.handlers;let A=this._parseStack.handlerPos-1;switch(this._parseStack.state){case 3:if(C===!1&&A>-1){for(;A>=0&&(S=m[A](this._params),S!==!0);A--)if(S instanceof Promise)return this._parseStack.handlerPos=A,S}this._parseStack.handlers=[];break;case 4:if(C===!1&&A>-1){for(;A>=0&&(S=m[A](),S!==!0);A--)if(S instanceof Promise)return this._parseStack.handlerPos=A,S}this._parseStack.handlers=[];break;case 6:if(f=v[this._parseStack.chunkPos],S=this._dcsParser.unhook(f!==24&&f!==26,C),S)return S;f===27&&(this._parseStack.transition|=1),this._params.reset(),this._params.addParam(0),this._collect=0;break;case 5:if(f=v[this._parseStack.chunkPos],S=this._oscParser.end(f!==24&&f!==26,C),S)return S;f===27&&(this._parseStack.transition|=1),this._params.reset(),this._params.addParam(0),this._collect=0}this._parseStack.state=0,M=this._parseStack.chunkPos+1,this.precedingCodepoint=0,this.currentState=15&this._parseStack.transition}for(let m=M;m<L;++m){switch(f=v[m],O=this._transitions.table[this.currentState<<8|(f<160?f:B)],O>>4){case 2:for(let P=m+1;;++P){if(P>=L||(f=v[P])<32||f>126&&f<B){this._printHandler(v,m,P),m=P-1;break}if(++P>=L||(f=v[P])<32||f>126&&f<B){this._printHandler(v,m,P),m=P-1;break}if(++P>=L||(f=v[P])<32||f>126&&f<B){this._printHandler(v,m,P),m=P-1;break}if(++P>=L||(f=v[P])<32||f>126&&f<B){this._printHandler(v,m,P),m=P-1;break}}break;case 3:this._executeHandlers[f]?this._executeHandlers[f]():this._executeHandlerFb(f),this.precedingCodepoint=0;break;case 0:break;case 1:if(this._errorHandler({position:m,code:f,currentState:this.currentState,collect:this._collect,params:this._params,abort:!1}).abort)return;break;case 7:const A=this._csiHandlers[this._collect<<8|f];let Z=A?A.length-1:-1;for(;Z>=0&&(S=A[Z](this._params),S!==!0);Z--)if(S instanceof Promise)return this._preserveStack(3,A,Z,O,m),S;Z<0&&this._csiHandlerFb(this._collect<<8|f,this._params),this.precedingCodepoint=0;break;case 8:do switch(f){case 59:this._params.addParam(0);break;case 58:this._params.addSubParam(-1);break;default:this._params.addDigit(f-48)}while(++m<L&&(f=v[m])>47&&f<60);m--;break;case 9:this._collect<<=8,this._collect|=f;break;case 10:const F=this._escHandlers[this._collect<<8|f];let W=F?F.length-1:-1;for(;W>=0&&(S=F[W](),S!==!0);W--)if(S instanceof Promise)return this._preserveStack(4,F,W,O,m),S;W<0&&this._escHandlerFb(this._collect<<8|f),this.precedingCodepoint=0;break;case 11:this._params.reset(),this._params.addParam(0),this._collect=0;break;case 12:this._dcsParser.hook(this._collect<<8|f,this._params);break;case 13:for(let P=m+1;;++P)if(P>=L||(f=v[P])===24||f===26||f===27||f>127&&f<B){this._dcsParser.put(v,m,P),m=P-1;break}break;case 14:if(S=this._dcsParser.unhook(f!==24&&f!==26),S)return this._preserveStack(6,[],0,O,m),S;f===27&&(O|=1),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingCodepoint=0;break;case 4:this._oscParser.start();break;case 5:for(let P=m+1;;P++)if(P>=L||(f=v[P])<32||f>127&&f<B){this._oscParser.put(v,m,P),m=P-1;break}break;case 6:if(S=this._oscParser.end(f!==24&&f!==26),S)return this._preserveStack(5,[],0,O,m),S;f===27&&(O|=1),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingCodepoint=0}this.currentState=15&O}}}g.EscapeSequenceParser=R},6242:(U,g,b)=>{Object.defineProperty(g,"__esModule",{value:!0}),g.OscHandler=g.OscParser=void 0;const H=b(5770),h=b(482),E=[];g.OscParser=class{constructor(){this._state=0,this._active=E,this._id=-1,this._handlers=Object.create(null),this._handlerFb=()=>{},this._stack={paused:!1,loopPosition:0,fallThrough:!1}}registerHandler(D,p){this._handlers[D]===void 0&&(this._handlers[D]=[]);const B=this._handlers[D];return B.push(p),{dispose:()=>{const R=B.indexOf(p);R!==-1&&B.splice(R,1)}}}clearHandler(D){this._handlers[D]&&delete this._handlers[D]}setHandlerFallback(D){this._handlerFb=D}dispose(){this._handlers=Object.create(null),this._handlerFb=()=>{},this._active=E}reset(){if(this._state===2)for(let D=this._stack.paused?this._stack.loopPosition-1:this._active.length-1;D>=0;--D)this._active[D].end(!1);this._stack.paused=!1,this._active=E,this._id=-1,this._state=0}_start(){if(this._active=this._handlers[this._id]||E,this._active.length)for(let D=this._active.length-1;D>=0;D--)this._active[D].start();else this._handlerFb(this._id,"START")}_put(D,p,B){if(this._active.length)for(let R=this._active.length-1;R>=0;R--)this._active[R].put(D,p,B);else this._handlerFb(this._id,"PUT",h.utf32ToString(D,p,B))}start(){this.reset(),this._state=1}put(D,p,B){if(this._state!==3){if(this._state===1)for(;p<B;){const R=D[p++];if(R===59){this._state=2,this._start();break}if(R<48||57<R)return void(this._state=3);this._id===-1&&(this._id=0),this._id=10*this._id+R-48}this._state===2&&B-p>0&&this._put(D,p,B)}}end(D,p=!0){if(this._state!==0){if(this._state!==3)if(this._state===1&&this._start(),this._active.length){let B=!1,R=this._active.length-1,v=!1;if(this._stack.paused&&(R=this._stack.loopPosition-1,B=p,v=this._stack.fallThrough,this._stack.paused=!1),!v&&B===!1){for(;R>=0&&(B=this._active[R].end(D),B!==!0);R--)if(B instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=R,this._stack.fallThrough=!1,B;R--}for(;R>=0;R--)if(B=this._active[R].end(!1),B instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=R,this._stack.fallThrough=!0,B}else this._handlerFb(this._id,"END",D);this._active=E,this._id=-1,this._state=0}}},g.OscHandler=class{constructor(D){this._handler=D,this._data="",this._hitLimit=!1}start(){this._data="",this._hitLimit=!1}put(D,p,B){this._hitLimit||(this._data+=h.utf32ToString(D,p,B),this._data.length>H.PAYLOAD_LIMIT&&(this._data="",this._hitLimit=!0))}end(D){let p=!1;if(this._hitLimit)p=!1;else if(D&&(p=this._handler(this._data),p instanceof Promise))return p.then((B)=>(this._data="",this._hitLimit=!1,B));return this._data="",this._hitLimit=!1,p}}},8742:(U,g)=>{Object.defineProperty(g,"__esModule",{value:!0}),g.Params=void 0;const b=2147483647;class H{static fromArray(h){const E=new H;if(!h.length)return E;for(let D=Array.isArray(h[0])?1:0;D<h.length;++D){const p=h[D];if(Array.isArray(p))for(let B=0;B<p.length;++B)E.addSubParam(p[B]);else E.addParam(p)}return E}constructor(h=32,E=32){if(this.maxLength=h,this.maxSubParamsLength=E,E>256)throw new Error("maxSubParamsLength must not be greater than 256");this.params=new Int32Array(h),this.length=0,this._subParams=new Int32Array(E),this._subParamsLength=0,this._subParamsIdx=new Uint16Array(h),this._rejectDigits=!1,this._rejectSubDigits=!1,this._digitIsSub=!1}clone(){const h=new H(this.maxLength,this.maxSubParamsLength);return h.params.set(this.params),h.length=this.length,h._subParams.set(this._subParams),h._subParamsLength=this._subParamsLength,h._subParamsIdx.set(this._subParamsIdx),h._rejectDigits=this._rejectDigits,h._rejectSubDigits=this._rejectSubDigits,h._digitIsSub=this._digitIsSub,h}toArray(){const h=[];for(let E=0;E<this.length;++E){h.push(this.params[E]);const D=this._subParamsIdx[E]>>8,p=255&this._subParamsIdx[E];p-D>0&&h.push(Array.prototype.slice.call(this._subParams,D,p))}return h}reset(){this.length=0,this._subParamsLength=0,this._rejectDigits=!1,this._rejectSubDigits=!1,this._digitIsSub=!1}addParam(h){if(this._digitIsSub=!1,this.length>=this.maxLength)this._rejectDigits=!0;else{if(h<-1)throw new Error("values lesser than -1 are not allowed");this._subParamsIdx[this.length]=this._subParamsLength<<8|this._subParamsLength,this.params[this.length++]=h>b?b:h}}addSubParam(h){if(this._digitIsSub=!0,this.length)if(this._rejectDigits||this._subParamsLength>=this.maxSubParamsLength)this._rejectSubDigits=!0;else{if(h<-1)throw new Error("values lesser than -1 are not allowed");this._subParams[this._subParamsLength++]=h>b?b:h,this._subParamsIdx[this.length-1]++}}hasSubParams(h){return(255&this._subParamsIdx[h])-(this._subParamsIdx[h]>>8)>0}getSubParams(h){const E=this._subParamsIdx[h]>>8,D=255&this._subParamsIdx[h];return D-E>0?this._subParams.subarray(E,D):null}getSubParamsAll(){const h={};for(let E=0;E<this.length;++E){const D=this._subParamsIdx[E]>>8,p=255&this._subParamsIdx[E];p-D>0&&(h[E]=this._subParams.slice(D,p))}return h}addDigit(h){let E;if(this._rejectDigits||!(E=this._digitIsSub?this._subParamsLength:this.length)||this._digitIsSub&&this._rejectSubDigits)return;const D=this._digitIsSub?this._subParams:this.params,p=D[E-1];D[E-1]=~p?Math.min(10*p+h,b):h}}g.Params=H},5741:(U,g)=>{Object.defineProperty(g,"__esModule",{value:!0}),g.AddonManager=void 0,g.AddonManager=class{constructor(){this._addons=[]}dispose(){for(let b=this._addons.length-1;b>=0;b--)this._addons[b].instance.dispose()}loadAddon(b,H){const h={instance:H,dispose:H.dispose,isDisposed:!1};this._addons.push(h),H.dispose=()=>this._wrappedAddonDispose(h),H.activate(b)}_wrappedAddonDispose(b){if(b.isDisposed)return;let H=-1;for(let h=0;h<this._addons.length;h++)if(this._addons[h]===b){H=h;break}if(H===-1)throw new Error("Could not dispose an addon that has not been loaded");b.isDisposed=!0,b.dispose.apply(b.instance),this._addons.splice(H,1)}}},8771:(U,g,b)=>{Object.defineProperty(g,"__esModule",{value:!0}),g.BufferApiView=void 0;const H=b(3785),h=b(511);g.BufferApiView=class{constructor(E,D){this._buffer=E,this.type=D}init(E){return this._buffer=E,this}get cursorY(){return this._buffer.y}get cursorX(){return this._buffer.x}get viewportY(){return this._buffer.ydisp}get baseY(){return this._buffer.ybase}get length(){return this._buffer.lines.length}getLine(E){const D=this._buffer.lines.get(E);if(D)return new H.BufferLineApiView(D)}getNullCell(){return new h.CellData}}},3785:(U,g,b)=>{Object.defineProperty(g,"__esModule",{value:!0}),g.BufferLineApiView=void 0;const H=b(511);g.BufferLineApiView=class{constructor(h){this._line=h}get isWrapped(){return this._line.isWrapped}get length(){return this._line.length}getCell(h,E){if(!(h<0||h>=this._line.length))return E?(this._line.loadCell(h,E),E):this._line.loadCell(h,new H.CellData)}translateToString(h,E,D){return this._line.translateToString(h,E,D)}}},8285:(U,g,b)=>{Object.defineProperty(g,"__esModule",{value:!0}),g.BufferNamespaceApi=void 0;const H=b(8771),h=b(8460),E=b(844);class D extends E.Disposable{constructor(p){super(),this._core=p,this._onBufferChange=this.register(new h.EventEmitter),this.onBufferChange=this._onBufferChange.event,this._normal=new H.BufferApiView(this._core.buffers.normal,"normal"),this._alternate=new H.BufferApiView(this._core.buffers.alt,"alternate"),this._core.buffers.onBufferActivate(()=>this._onBufferChange.fire(this.active))}get active(){if(this._core.buffers.active===this._core.buffers.normal)return this.normal;if(this._core.buffers.active===this._core.buffers.alt)return this.alternate;throw new Error("Active buffer is neither normal nor alternate")}get normal(){return this._normal.init(this._core.buffers.normal)}get alternate(){return this._alternate.init(this._core.buffers.alt)}}g.BufferNamespaceApi=D},7975:(U,g)=>{Object.defineProperty(g,"__esModule",{value:!0}),g.ParserApi=void 0,g.ParserApi=class{constructor(b){this._core=b}registerCsiHandler(b,H){return this._core.registerCsiHandler(b,(h)=>H(h.toArray()))}addCsiHandler(b,H){return this.registerCsiHandler(b,H)}registerDcsHandler(b,H){return this._core.registerDcsHandler(b,(h,E)=>H(h,E.toArray()))}addDcsHandler(b,H){return this.registerDcsHandler(b,H)}registerEscHandler(b,H){return this._core.registerEscHandler(b,H)}addEscHandler(b,H){return this.registerEscHandler(b,H)}registerOscHandler(b,H){return this._core.registerOscHandler(b,H)}addOscHandler(b,H){return this.registerOscHandler(b,H)}}},7090:(U,g)=>{Object.defineProperty(g,"__esModule",{value:!0}),g.UnicodeApi=void 0,g.UnicodeApi=class{constructor(b){this._core=b}register(b){this._core.unicodeService.register(b)}get versions(){return this._core.unicodeService.versions}get activeVersion(){return this._core.unicodeService.activeVersion}set activeVersion(b){this._core.unicodeService.activeVersion=b}}},744:function(U,g,b){var H=this&&this.__decorate||function(v,L,C,S){var f,O=arguments.length,M=O<3?L:S===null?S=Object.getOwnPropertyDescriptor(L,C):S;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")M=Reflect.decorate(v,L,C,S);else for(var m=v.length-1;m>=0;m--)(f=v[m])&&(M=(O<3?f(M):O>3?f(L,C,M):f(L,C))||M);return O>3&&M&&Object.defineProperty(L,C,M),M},h=this&&this.__param||function(v,L){return function(C,S){L(C,S,v)}};Object.defineProperty(g,"__esModule",{value:!0}),g.BufferService=g.MINIMUM_ROWS=g.MINIMUM_COLS=void 0;const E=b(8460),D=b(844),p=b(5295),B=b(2585);g.MINIMUM_COLS=2,g.MINIMUM_ROWS=1;let R=g.BufferService=class extends D.Disposable{get buffer(){return this.buffers.active}constructor(v){super(),this.isUserScrolling=!1,this._onResize=this.register(new E.EventEmitter),this.onResize=this._onResize.event,this._onScroll=this.register(new E.EventEmitter),this.onScroll=this._onScroll.event,this.cols=Math.max(v.rawOptions.cols||0,g.MINIMUM_COLS),this.rows=Math.max(v.rawOptions.rows||0,g.MINIMUM_ROWS),this.buffers=this.register(new p.BufferSet(v,this))}resize(v,L){this.cols=v,this.rows=L,this.buffers.resize(v,L),this._onResize.fire({cols:v,rows:L})}reset(){this.buffers.reset(),this.isUserScrolling=!1}scroll(v,L=!1){const C=this.buffer;let S;S=this._cachedBlankLine,S&&S.length===this.cols&&S.getFg(0)===v.fg&&S.getBg(0)===v.bg||(S=C.getBlankLine(v,L),this._cachedBlankLine=S),S.isWrapped=L;const f=C.ybase+C.scrollTop,O=C.ybase+C.scrollBottom;if(C.scrollTop===0){const M=C.lines.isFull;O===C.lines.length-1?M?C.lines.recycle().copyFrom(S):C.lines.push(S.clone()):C.lines.splice(O+1,0,S.clone()),M?this.isUserScrolling&&(C.ydisp=Math.max(C.ydisp-1,0)):(C.ybase++,this.isUserScrolling||C.ydisp++)}else{const M=O-f+1;C.lines.shiftElements(f+1,M-1,-1),C.lines.set(O,S.clone())}this.isUserScrolling||(C.ydisp=C.ybase),this._onScroll.fire(C.ydisp)}scrollLines(v,L,C){const S=this.buffer;if(v<0){if(S.ydisp===0)return;this.isUserScrolling=!0}else v+S.ydisp>=S.ybase&&(this.isUserScrolling=!1);const f=S.ydisp;S.ydisp=Math.max(Math.min(S.ydisp+v,S.ybase),0),f!==S.ydisp&&(L||this._onScroll.fire(S.ydisp))}};g.BufferService=R=H([h(0,B.IOptionsService)],R)},7994:(U,g)=>{Object.defineProperty(g,"__esModule",{value:!0}),g.CharsetService=void 0,g.CharsetService=class{constructor(){this.glevel=0,this._charsets=[]}reset(){this.charset=void 0,this._charsets=[],this.glevel=0}setgLevel(b){this.glevel=b,this.charset=this._charsets[b]}setgCharset(b,H){this._charsets[b]=H,this.glevel===b&&(this.charset=H)}}},1753:function(U,g,b){var H=this&&this.__decorate||function(S,f,O,M){var m,A=arguments.length,Z=A<3?f:M===null?M=Object.getOwnPropertyDescriptor(f,O):M;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")Z=Reflect.decorate(S,f,O,M);else for(var F=S.length-1;F>=0;F--)(m=S[F])&&(Z=(A<3?m(Z):A>3?m(f,O,Z):m(f,O))||Z);return A>3&&Z&&Object.defineProperty(f,O,Z),Z},h=this&&this.__param||function(S,f){return function(O,M){f(O,M,S)}};Object.defineProperty(g,"__esModule",{value:!0}),g.CoreMouseService=void 0;const E=b(2585),D=b(8460),p=b(844),B={NONE:{events:0,restrict:()=>!1},X10:{events:1,restrict:(S)=>S.button!==4&&S.action===1&&(S.ctrl=!1,S.alt=!1,S.shift=!1,!0)},VT200:{events:19,restrict:(S)=>S.action!==32},DRAG:{events:23,restrict:(S)=>S.action!==32||S.button!==3},ANY:{events:31,restrict:(S)=>!0}};function R(S,f){let O=(S.ctrl?16:0)|(S.shift?4:0)|(S.alt?8:0);return S.button===4?(O|=64,O|=S.action):(O|=3&S.button,4&S.button&&(O|=64),8&S.button&&(O|=128),S.action===32?O|=32:S.action!==0||f||(O|=3)),O}const v=String.fromCharCode,L={DEFAULT:(S)=>{const f=[R(S,!1)+32,S.col+32,S.row+32];return f[0]>255||f[1]>255||f[2]>255?"":`[M${v(f[0])}${v(f[1])}${v(f[2])}`},SGR:(S)=>{const f=S.action===0&&S.button!==4?"m":"M";return`[<${R(S,!0)};${S.col};${S.row}${f}`},SGR_PIXELS:(S)=>{const f=S.action===0&&S.button!==4?"m":"M";return`[<${R(S,!0)};${S.x};${S.y}${f}`}};let C=g.CoreMouseService=class extends p.Disposable{constructor(S,f){super(),this._bufferService=S,this._coreService=f,this._protocols={},this._encodings={},this._activeProtocol="",this._activeEncoding="",this._lastEvent=null,this._onProtocolChange=this.register(new D.EventEmitter),this.onProtocolChange=this._onProtocolChange.event;for(let O of Object.keys(B))this.addProtocol(O,B[O]);for(let O of Object.keys(L))this.addEncoding(O,L[O]);this.reset()}addProtocol(S,f){this._protocols[S]=f}addEncoding(S,f){this._encodings[S]=f}get activeProtocol(){return this._activeProtocol}get areMouseEventsActive(){return this._protocols[this._activeProtocol].events!==0}set activeProtocol(S){if(!this._protocols[S])throw new Error(`unknown protocol "${S}"`);this._activeProtocol=S,this._onProtocolChange.fire(this._protocols[S].events)}get activeEncoding(){return this._activeEncoding}set activeEncoding(S){if(!this._encodings[S])throw new Error(`unknown encoding "${S}"`);this._activeEncoding=S}reset(){this.activeProtocol="NONE",this.activeEncoding="DEFAULT",this._lastEvent=null}triggerMouseEvent(S){if(S.col<0||S.col>=this._bufferService.cols||S.row<0||S.row>=this._bufferService.rows)return!1;if(S.button===4&&S.action===32)return!1;if(S.button===3&&S.action!==32)return!1;if(S.button!==4&&(S.action===2||S.action===3))return!1;if(S.col++,S.row++,S.action===32&&this._lastEvent&&this._equalEvents(this._lastEvent,S,this._activeEncoding==="SGR_PIXELS"))return!1;if(!this._protocols[this._activeProtocol].restrict(S))return!1;const f=this._encodings[this._activeEncoding](S);return f&&(this._activeEncoding==="DEFAULT"?this._coreService.triggerBinaryEvent(f):this._coreService.triggerDataEvent(f,!0)),this._lastEvent=S,!0}explainEvents(S){return{down:!!(1&S),up:!!(2&S),drag:!!(4&S),move:!!(8&S),wheel:!!(16&S)}}_equalEvents(S,f,O){if(O){if(S.x!==f.x)return!1;if(S.y!==f.y)return!1}else{if(S.col!==f.col)return!1;if(S.row!==f.row)return!1}return S.button===f.button&&S.action===f.action&&S.ctrl===f.ctrl&&S.alt===f.alt&&S.shift===f.shift}};g.CoreMouseService=C=H([h(0,E.IBufferService),h(1,E.ICoreService)],C)},6975:function(U,g,b){var H=this&&this.__decorate||function(C,S,f,O){var M,m=arguments.length,A=m<3?S:O===null?O=Object.getOwnPropertyDescriptor(S,f):O;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")A=Reflect.decorate(C,S,f,O);else for(var Z=C.length-1;Z>=0;Z--)(M=C[Z])&&(A=(m<3?M(A):m>3?M(S,f,A):M(S,f))||A);return m>3&&A&&Object.defineProperty(S,f,A),A},h=this&&this.__param||function(C,S){return function(f,O){S(f,O,C)}};Object.defineProperty(g,"__esModule",{value:!0}),g.CoreService=void 0;const E=b(1439),D=b(8460),p=b(844),B=b(2585),R=Object.freeze({insertMode:!1}),v=Object.freeze({applicationCursorKeys:!1,applicationKeypad:!1,bracketedPasteMode:!1,origin:!1,reverseWraparound:!1,sendFocus:!1,wraparound:!0});let L=g.CoreService=class extends p.Disposable{constructor(C,S,f){super(),this._bufferService=C,this._logService=S,this._optionsService=f,this.isCursorInitialized=!1,this.isCursorHidden=!1,this._onData=this.register(new D.EventEmitter),this.onData=this._onData.event,this._onUserInput=this.register(new D.EventEmitter),this.onUserInput=this._onUserInput.event,this._onBinary=this.register(new D.EventEmitter),this.onBinary=this._onBinary.event,this._onRequestScrollToBottom=this.register(new D.EventEmitter),this.onRequestScrollToBottom=this._onRequestScrollToBottom.event,this.modes=E.clone(R),this.decPrivateModes=E.clone(v)}reset(){this.modes=E.clone(R),this.decPrivateModes=E.clone(v)}triggerDataEvent(C,S=!1){if(this._optionsService.rawOptions.disableStdin)return;const f=this._bufferService.buffer;S&&this._optionsService.rawOptions.scrollOnUserInput&&f.ybase!==f.ydisp&&this._onRequestScrollToBottom.fire(),S&&this._onUserInput.fire(),this._logService.debug(`sending data "${C}"`,()=>C.split("").map((O)=>O.charCodeAt(0))),this._onData.fire(C)}triggerBinaryEvent(C){this._optionsService.rawOptions.disableStdin||(this._logService.debug(`sending binary "${C}"`,()=>C.split("").map((S)=>S.charCodeAt(0))),this._onBinary.fire(C))}};g.CoreService=L=H([h(0,B.IBufferService),h(1,B.ILogService),h(2,B.IOptionsService)],L)},9074:(U,g,b)=>{Object.defineProperty(g,"__esModule",{value:!0}),g.DecorationService=void 0;const H=b(8055),h=b(8460),E=b(844),D=b(6106);let p=0,B=0;class R extends E.Disposable{get decorations(){return this._decorations.values()}constructor(){super(),this._decorations=new D.SortedList((L)=>L==null?void 0:L.marker.line),this._onDecorationRegistered=this.register(new h.EventEmitter),this.onDecorationRegistered=this._onDecorationRegistered.event,this._onDecorationRemoved=this.register(new h.EventEmitter),this.onDecorationRemoved=this._onDecorationRemoved.event,this.register(E.toDisposable(()=>this.reset()))}registerDecoration(L){if(L.marker.isDisposed)return;const C=new v(L);if(C){const S=C.marker.onDispose(()=>C.dispose());C.onDispose(()=>{C&&(this._decorations.delete(C)&&this._onDecorationRemoved.fire(C),S.dispose())}),this._decorations.insert(C),this._onDecorationRegistered.fire(C)}return C}reset(){for(let L of this._decorations.values())L.dispose();this._decorations.clear()}*getDecorationsAtCell(L,C,S){var f,O,M;let m=0,A=0;for(let Z of this._decorations.getKeyIterator(C))m=(f=Z.options.x)!==null&&f!==void 0?f:0,A=m+((O=Z.options.width)!==null&&O!==void 0?O:1),L>=m&&L<A&&(!S||((M=Z.options.layer)!==null&&M!==void 0?M:"bottom")===S)&&(yield Z)}forEachDecorationAtCell(L,C,S,f){this._decorations.forEachByKey(C,(O)=>{var M,m,A;p=(M=O.options.x)!==null&&M!==void 0?M:0,B=p+((m=O.options.width)!==null&&m!==void 0?m:1),L>=p&&L<B&&(!S||((A=O.options.layer)!==null&&A!==void 0?A:"bottom")===S)&&f(O)})}}g.DecorationService=R;class v extends E.Disposable{get isDisposed(){return this._isDisposed}get backgroundColorRGB(){return this._cachedBg===null&&(this.options.backgroundColor?this._cachedBg=H.css.toColor(this.options.backgroundColor):this._cachedBg=void 0),this._cachedBg}get foregroundColorRGB(){return this._cachedFg===null&&(this.options.foregroundColor?this._cachedFg=H.css.toColor(this.options.foregroundColor):this._cachedFg=void 0),this._cachedFg}constructor(L){super(),this.options=L,this.onRenderEmitter=this.register(new h.EventEmitter),this.onRender=this.onRenderEmitter.event,this._onDispose=this.register(new h.EventEmitter),this.onDispose=this._onDispose.event,this._cachedBg=null,this._cachedFg=null,this.marker=L.marker,this.options.overviewRulerOptions&&!this.options.overviewRulerOptions.position&&(this.options.overviewRulerOptions.position="full")}dispose(){this._onDispose.fire(),super.dispose()}}},4348:(U,g,b)=>{Object.defineProperty(g,"__esModule",{value:!0}),g.InstantiationService=g.ServiceCollection=void 0;const H=b(2585),h=b(8343);class E{constructor(...D){this._entries=new Map;for(let[p,B]of D)this.set(p,B)}set(D,p){const B=this._entries.get(D);return this._entries.set(D,p),B}forEach(D){for(let[p,B]of this._entries.entries())D(p,B)}has(D){return this._entries.has(D)}get(D){return this._entries.get(D)}}g.ServiceCollection=E,g.InstantiationService=class{constructor(){this._services=new E,this._services.set(H.IInstantiationService,this)}setService(D,p){this._services.set(D,p)}getService(D){return this._services.get(D)}createInstance(D,...p){const B=h.getServiceDependencies(D).sort((L,C)=>L.index-C.index),R=[];for(let L of B){const C=this._services.get(L.id);if(!C)throw new Error(`[createInstance] ${D.name} depends on UNKNOWN service ${L.id}.`);R.push(C)}const v=B.length>0?B[0].index:p.length;if(p.length!==v)throw new Error(`[createInstance] First service dependency of ${D.name} at position ${v+1} conflicts with ${p.length} static arguments`);return new D(...[...p,...R])}}},7866:function(U,g,b){var H=this&&this.__decorate||function(v,L,C,S){var f,O=arguments.length,M=O<3?L:S===null?S=Object.getOwnPropertyDescriptor(L,C):S;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")M=Reflect.decorate(v,L,C,S);else for(var m=v.length-1;m>=0;m--)(f=v[m])&&(M=(O<3?f(M):O>3?f(L,C,M):f(L,C))||M);return O>3&&M&&Object.defineProperty(L,C,M),M},h=this&&this.__param||function(v,L){return function(C,S){L(C,S,v)}};Object.defineProperty(g,"__esModule",{value:!0}),g.traceCall=g.setTraceLogger=g.LogService=void 0;const E=b(844),D=b(2585),p={trace:D.LogLevelEnum.TRACE,debug:D.LogLevelEnum.DEBUG,info:D.LogLevelEnum.INFO,warn:D.LogLevelEnum.WARN,error:D.LogLevelEnum.ERROR,off:D.LogLevelEnum.OFF};let B,R=g.LogService=class extends E.Disposable{get logLevel(){return this._logLevel}constructor(v){super(),this._optionsService=v,this._logLevel=D.LogLevelEnum.OFF,this._updateLogLevel(),this.register(this._optionsService.onSpecificOptionChange("logLevel",()=>this._updateLogLevel())),B=this}_updateLogLevel(){this._logLevel=p[this._optionsService.rawOptions.logLevel]}_evalLazyOptionalParams(v){for(let L=0;L<v.length;L++)typeof v[L]=="function"&&(v[L]=v[L]())}_log(v,L,C){this._evalLazyOptionalParams(C),v.call(console,(this._optionsService.options.logger?"":"xterm.js: ")+L,...C)}trace(v,...L){var C,S;this._logLevel<=D.LogLevelEnum.TRACE&&this._log((S=(C=this._optionsService.options.logger)===null||C===void 0?void 0:C.trace.bind(this._optionsService.options.logger))!==null&&S!==void 0?S:console.log,v,L)}debug(v,...L){var C,S;this._logLevel<=D.LogLevelEnum.DEBUG&&this._log((S=(C=this._optionsService.options.logger)===null||C===void 0?void 0:C.debug.bind(this._optionsService.options.logger))!==null&&S!==void 0?S:console.log,v,L)}info(v,...L){var C,S;this._logLevel<=D.LogLevelEnum.INFO&&this._log((S=(C=this._optionsService.options.logger)===null||C===void 0?void 0:C.info.bind(this._optionsService.options.logger))!==null&&S!==void 0?S:console.info,v,L)}warn(v,...L){var C,S;this._logLevel<=D.LogLevelEnum.WARN&&this._log((S=(C=this._optionsService.options.logger)===null||C===void 0?void 0:C.warn.bind(this._optionsService.options.logger))!==null&&S!==void 0?S:console.warn,v,L)}error(v,...L){var C,S;this._logLevel<=D.LogLevelEnum.ERROR&&this._log((S=(C=this._optionsService.options.logger)===null||C===void 0?void 0:C.error.bind(this._optionsService.options.logger))!==null&&S!==void 0?S:console.error,v,L)}};g.LogService=R=H([h(0,D.IOptionsService)],R),g.setTraceLogger=function(v){B=v},g.traceCall=function(v,L,C){if(typeof C.value!="function")throw new Error("not supported");const S=C.value;C.value=function(...f){if(B.logLevel!==D.LogLevelEnum.TRACE)return S.apply(this,f);B.trace(`GlyphRenderer#${S.name}(${f.map((M)=>JSON.stringify(M)).join(", ")})`);const O=S.apply(this,f);return B.trace(`GlyphRenderer#${S.name} return`,O),O}}},7302:(U,g,b)=>{Object.defineProperty(g,"__esModule",{value:!0}),g.OptionsService=g.DEFAULT_OPTIONS=void 0;const H=b(8460),h=b(844),E=b(6114);g.DEFAULT_OPTIONS={cols:80,rows:24,cursorBlink:!1,cursorStyle:"block",cursorWidth:1,cursorInactiveStyle:"outline",customGlyphs:!0,drawBoldTextInBrightColors:!0,fastScrollModifier:"alt",fastScrollSensitivity:5,fontFamily:"courier-new, courier, monospace",fontSize:15,fontWeight:"normal",fontWeightBold:"bold",ignoreBracketedPasteMode:!1,lineHeight:1,letterSpacing:0,linkHandler:null,logLevel:"info",logger:null,scrollback:1000,scrollOnUserInput:!0,scrollSensitivity:1,screenReaderMode:!1,smoothScrollDuration:0,macOptionIsMeta:!1,macOptionClickForcesSelection:!1,minimumContrastRatio:1,disableStdin:!1,allowProposedApi:!1,allowTransparency:!1,tabStopWidth:8,theme:{},rightClickSelectsWord:E.isMac,windowOptions:{},windowsMode:!1,windowsPty:{},wordSeparator:" ()[]{}',\"`",altClickMovesCursor:!0,convertEol:!1,termName:"xterm",cancelEvents:!1,overviewRulerWidth:0};const D=["normal","bold","100","200","300","400","500","600","700","800","900"];class p extends h.Disposable{constructor(B){super(),this._onOptionChange=this.register(new H.EventEmitter),this.onOptionChange=this._onOptionChange.event;const R=Object.assign({},g.DEFAULT_OPTIONS);for(let v in B)if(v in R)try{const L=B[v];R[v]=this._sanitizeAndValidateOption(v,L)}catch(L){console.error(L)}this.rawOptions=R,this.options=Object.assign({},R),this._setupOptions()}onSpecificOptionChange(B,R){return this.onOptionChange((v)=>{v===B&&R(this.rawOptions[B])})}onMultipleOptionChange(B,R){return this.onOptionChange((v)=>{B.indexOf(v)!==-1&&R()})}_setupOptions(){const B=(v)=>{if(!(v in g.DEFAULT_OPTIONS))throw new Error(`No option with key "${v}"`);return this.rawOptions[v]},R=(v,L)=>{if(!(v in g.DEFAULT_OPTIONS))throw new Error(`No option with key "${v}"`);L=this._sanitizeAndValidateOption(v,L),this.rawOptions[v]!==L&&(this.rawOptions[v]=L,this._onOptionChange.fire(v))};for(let v in this.rawOptions){const L={get:B.bind(this,v),set:R.bind(this,v)};Object.defineProperty(this.options,v,L)}}_sanitizeAndValidateOption(B,R){switch(B){case"cursorStyle":if(R||(R=g.DEFAULT_OPTIONS[B]),!function(v){return v==="block"||v==="underline"||v==="bar"}(R))throw new Error(`"${R}" is not a valid value for ${B}`);break;case"wordSeparator":R||(R=g.DEFAULT_OPTIONS[B]);break;case"fontWeight":case"fontWeightBold":if(typeof R=="number"&&1<=R&&R<=1000)break;R=D.includes(R)?R:g.DEFAULT_OPTIONS[B];break;case"cursorWidth":R=Math.floor(R);case"lineHeight":case"tabStopWidth":if(R<1)throw new Error(`${B} cannot be less than 1, value: ${R}`);break;case"minimumContrastRatio":R=Math.max(1,Math.min(21,Math.round(10*R)/10));break;case"scrollback":if((R=Math.min(R,4294967295))<0)throw new Error(`${B} cannot be less than 0, value: ${R}`);break;case"fastScrollSensitivity":case"scrollSensitivity":if(R<=0)throw new Error(`${B} cannot be less than or equal to 0, value: ${R}`);break;case"rows":case"cols":if(!R&&R!==0)throw new Error(`${B} must be numeric, value: ${R}`);break;case"windowsPty":R=R!=null?R:{}}return R}}g.OptionsService=p},2660:function(U,g,b){var H=this&&this.__decorate||function(p,B,R,v){var L,C=arguments.length,S=C<3?B:v===null?v=Object.getOwnPropertyDescriptor(B,R):v;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")S=Reflect.decorate(p,B,R,v);else for(var f=p.length-1;f>=0;f--)(L=p[f])&&(S=(C<3?L(S):C>3?L(B,R,S):L(B,R))||S);return C>3&&S&&Object.defineProperty(B,R,S),S},h=this&&this.__param||function(p,B){return function(R,v){B(R,v,p)}};Object.defineProperty(g,"__esModule",{value:!0}),g.OscLinkService=void 0;const E=b(2585);let D=g.OscLinkService=class{constructor(p){this._bufferService=p,this._nextId=1,this._entriesWithId=new Map,this._dataByLinkId=new Map}registerLink(p){const B=this._bufferService.buffer;if(p.id===void 0){const f=B.addMarker(B.ybase+B.y),O={data:p,id:this._nextId++,lines:[f]};return f.onDispose(()=>this._removeMarkerFromLink(O,f)),this._dataByLinkId.set(O.id,O),O.id}const R=p,v=this._getEntryIdKey(R),L=this._entriesWithId.get(v);if(L)return this.addLineToLink(L.id,B.ybase+B.y),L.id;const C=B.addMarker(B.ybase+B.y),S={id:this._nextId++,key:this._getEntryIdKey(R),data:R,lines:[C]};return C.onDispose(()=>this._removeMarkerFromLink(S,C)),this._entriesWithId.set(S.key,S),this._dataByLinkId.set(S.id,S),S.id}addLineToLink(p,B){const R=this._dataByLinkId.get(p);if(R&&R.lines.every((v)=>v.line!==B)){const v=this._bufferService.buffer.addMarker(B);R.lines.push(v),v.onDispose(()=>this._removeMarkerFromLink(R,v))}}getLinkData(p){var B;return(B=this._dataByLinkId.get(p))===null||B===void 0?void 0:B.data}_getEntryIdKey(p){return`${p.id};;${p.uri}`}_removeMarkerFromLink(p,B){const R=p.lines.indexOf(B);R!==-1&&(p.lines.splice(R,1),p.lines.length===0&&(p.data.id!==void 0&&this._entriesWithId.delete(p.key),this._dataByLinkId.delete(p.id)))}};g.OscLinkService=D=H([h(0,E.IBufferService)],D)},8343:(U,g)=>{Object.defineProperty(g,"__esModule",{value:!0}),g.createDecorator=g.getServiceDependencies=g.serviceRegistry=void 0;const b="di$target",H="di$dependencies";g.serviceRegistry=new Map,g.getServiceDependencies=function(h){return h[H]||[]},g.createDecorator=function(h){if(g.serviceRegistry.has(h))return g.serviceRegistry.get(h);const E=function(D,p,B){if(arguments.length!==3)throw new Error("@IServiceName-decorator can only be used to decorate a parameter");(function(R,v,L){v[b]===v?v[H].push({id:R,index:L}):(v[H]=[{id:R,index:L}],v[b]=v)})(E,D,B)};return E.toString=()=>h,g.serviceRegistry.set(h,E),E}},2585:(U,g,b)=>{Object.defineProperty(g,"__esModule",{value:!0}),g.IDecorationService=g.IUnicodeService=g.IOscLinkService=g.IOptionsService=g.ILogService=g.LogLevelEnum=g.IInstantiationService=g.ICharsetService=g.ICoreService=g.ICoreMouseService=g.IBufferService=void 0;const H=b(8343);var h;g.IBufferService=H.createDecorator("BufferService"),g.ICoreMouseService=H.createDecorator("CoreMouseService"),g.ICoreService=H.createDecorator("CoreService"),g.ICharsetService=H.createDecorator("CharsetService"),g.IInstantiationService=H.createDecorator("InstantiationService"),function(E){E[E.TRACE=0]="TRACE",E[E.DEBUG=1]="DEBUG",E[E.INFO=2]="INFO",E[E.WARN=3]="WARN",E[E.ERROR=4]="ERROR",E[E.OFF=5]="OFF"}(h||(g.LogLevelEnum=h={})),g.ILogService=H.createDecorator("LogService"),g.IOptionsService=H.createDecorator("OptionsService"),g.IOscLinkService=H.createDecorator("OscLinkService"),g.IUnicodeService=H.createDecorator("UnicodeService"),g.IDecorationService=H.createDecorator("DecorationService")},1480:(U,g,b)=>{Object.defineProperty(g,"__esModule",{value:!0}),g.UnicodeService=void 0;const H=b(8460),h=b(225);g.UnicodeService=class{constructor(){this._providers=Object.create(null),this._active="",this._onChange=new H.EventEmitter,this.onChange=this._onChange.event;const E=new h.UnicodeV6;this.register(E),this._active=E.version,this._activeProvider=E}dispose(){this._onChange.dispose()}get versions(){return Object.keys(this._providers)}get activeVersion(){return this._active}set activeVersion(E){if(!this._providers[E])throw new Error(`unknown Unicode version "${E}"`);this._active=E,this._activeProvider=this._providers[E],this._onChange.fire(E)}register(E){this._providers[E.version]=E}wcwidth(E){return this._activeProvider.wcwidth(E)}getStringCellWidth(E){let D=0;const p=E.length;for(let B=0;B<p;++B){let R=E.charCodeAt(B);if(55296<=R&&R<=56319){if(++B>=p)return D+this.wcwidth(R);const v=E.charCodeAt(B);56320<=v&&v<=57343?R=1024*(R-55296)+v-56320+65536:D+=this.wcwidth(v)}D+=this.wcwidth(R)}return D}}}},x={};function j(U){var g=x[U];if(g!==void 0)return g.exports;var b=x[U]={exports:{}};return y[U].call(b.exports,b,b.exports,j),b.exports}var c={};return(()=>{var U=c;Object.defineProperty(U,"__esModule",{value:!0}),U.Terminal=void 0;const g=j(9042),b=j(3236),H=j(844),h=j(5741),E=j(8285),D=j(7975),p=j(7090),B=["cols","rows"];class R extends H.Disposable{constructor(v){super(),this._core=this.register(new b.Terminal(v)),this._addonManager=this.register(new h.AddonManager),this._publicOptions=Object.assign({},this._core.options);const L=(S)=>this._core.options[S],C=(S,f)=>{this._checkReadonlyOptions(S),this._core.options[S]=f};for(let S in this._core.options){const f={get:L.bind(this,S),set:C.bind(this,S)};Object.defineProperty(this._publicOptions,S,f)}}_checkReadonlyOptions(v){if(B.includes(v))throw new Error(`Option "${v}" can only be set in the constructor`)}_checkProposedApi(){if(!this._core.optionsService.rawOptions.allowProposedApi)throw new Error("You must set the allowProposedApi option to true to use proposed API")}get onBell(){return this._core.onBell}get onBinary(){return this._core.onBinary}get onCursorMove(){return this._core.onCursorMove}get onData(){return this._core.onData}get onKey(){return this._core.onKey}get onLineFeed(){return this._core.onLineFeed}get onRender(){return this._core.onRender}get onResize(){return this._core.onResize}get onScroll(){return this._core.onScroll}get onSelectionChange(){return this._core.onSelectionChange}get onTitleChange(){return this._core.onTitleChange}get onWriteParsed(){return this._core.onWriteParsed}get element(){return this._core.element}get parser(){return this._parser||(this._parser=new D.ParserApi(this._core)),this._parser}get unicode(){return this._checkProposedApi(),new p.UnicodeApi(this._core)}get textarea(){return this._core.textarea}get rows(){return this._core.rows}get cols(){return this._core.cols}get buffer(){return this._buffer||(this._buffer=this.register(new E.BufferNamespaceApi(this._core))),this._buffer}get markers(){return this._checkProposedApi(),this._core.markers}get modes(){const v=this._core.coreService.decPrivateModes;let L="none";switch(this._core.coreMouseService.activeProtocol){case"X10":L="x10";break;case"VT200":L="vt200";break;case"DRAG":L="drag";break;case"ANY":L="any"}return{applicationCursorKeysMode:v.applicationCursorKeys,applicationKeypadMode:v.applicationKeypad,bracketedPasteMode:v.bracketedPasteMode,insertMode:this._core.coreService.modes.insertMode,mouseTrackingMode:L,originMode:v.origin,reverseWraparoundMode:v.reverseWraparound,sendFocusMode:v.sendFocus,wraparoundMode:v.wraparound}}get options(){return this._publicOptions}set options(v){for(let L in v)this._publicOptions[L]=v[L]}blur(){this._core.blur()}focus(){this._core.focus()}resize(v,L){this._verifyIntegers(v,L),this._core.resize(v,L)}open(v){this._core.open(v)}attachCustomKeyEventHandler(v){this._core.attachCustomKeyEventHandler(v)}registerLinkProvider(v){return this._core.registerLinkProvider(v)}registerCharacterJoiner(v){return this._checkProposedApi(),this._core.registerCharacterJoiner(v)}deregisterCharacterJoiner(v){this._checkProposedApi(),this._core.deregisterCharacterJoiner(v)}registerMarker(v=0){return this._verifyIntegers(v),this._core.registerMarker(v)}registerDecoration(v){var L,C,S;return this._checkProposedApi(),this._verifyPositiveIntegers((L=v.x)!==null&&L!==void 0?L:0,(C=v.width)!==null&&C!==void 0?C:0,(S=v.height)!==null&&S!==void 0?S:0),this._core.registerDecoration(v)}hasSelection(){return this._core.hasSelection()}select(v,L,C){this._verifyIntegers(v,L,C),this._core.select(v,L,C)}getSelection(){return this._core.getSelection()}getSelectionPosition(){return this._core.getSelectionPosition()}clearSelection(){this._core.clearSelection()}selectAll(){this._core.selectAll()}selectLines(v,L){this._verifyIntegers(v,L),this._core.selectLines(v,L)}dispose(){super.dispose()}scrollLines(v){this._verifyIntegers(v),this._core.scrollLines(v)}scrollPages(v){this._verifyIntegers(v),this._core.scrollPages(v)}scrollToTop(){this._core.scrollToTop()}scrollToBottom(){this._core.scrollToBottom()}scrollToLine(v){this._verifyIntegers(v),this._core.scrollToLine(v)}clear(){this._core.clear()}write(v,L){this._core.write(v,L)}writeln(v,L){this._core.write(v),this._core.write("\r\n",L)}paste(v){this._core.paste(v)}refresh(v,L){this._verifyIntegers(v,L),this._core.refresh(v,L)}reset(){this._core.reset()}clearTextureAtlas(){this._core.clearTextureAtlas()}loadAddon(v){this._addonManager.loadAddon(this,v)}static get strings(){return g}_verifyIntegers(...v){for(let L of v)if(L===Infinity||isNaN(L)||L%1!=0)throw new Error("This API only accepts integers")}_verifyPositiveIntegers(...v){for(let L of v)if(L&&(L===Infinity||isNaN(L)||L%1!=0||L<0))throw new Error("This API only accepts positive integers")}}U.Terminal=R})(),c})())});var b1=u0((k0,z0)=>{(function(y,x){typeof k0=="object"&&typeof z0=="object"?z0.exports=x():typeof define=="function"&&define.amd?define([],x):typeof k0=="object"?k0.WebglAddon=x():y.WebglAddon=x()})(self,()=>(()=>{var y={965:function(U,g,b){var H=this&&this.__decorate||function(m,A,Z,F){var W,P=arguments.length,k=P<3?A:F===null?F=Object.getOwnPropertyDescriptor(A,Z):F;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")k=Reflect.decorate(m,A,Z,F);else for(var Q=m.length-1;Q>=0;Q--)(W=m[Q])&&(k=(P<3?W(k):P>3?W(A,Z,k):W(A,Z))||k);return P>3&&k&&Object.defineProperty(A,Z,k),k};Object.defineProperty(g,"__esModule",{value:!0}),g.GlyphRenderer=void 0;const h=b(374),E=b(509),D=b(855),p=b(859),B=b(776),R=b(381),v=11,L=v*Float32Array.BYTES_PER_ELEMENT;let C,S=0,f=0,O=0;class M extends p.Disposable{constructor(m,A,Z){super(),this._terminal=m,this._gl=A,this._dimensions=Z,this._activeBuffer=0,this._vertices={count:0,attributes:new Float32Array(0),attributesBuffers:[new Float32Array(0),new Float32Array(0)]};const F=this._gl;E.TextureAtlas.maxAtlasPages===void 0&&(E.TextureAtlas.maxAtlasPages=Math.min(32,h.throwIfFalsy(F.getParameter(F.MAX_TEXTURE_IMAGE_UNITS))),E.TextureAtlas.maxTextureSize=h.throwIfFalsy(F.getParameter(F.MAX_TEXTURE_SIZE))),this._program=h.throwIfFalsy(R.createProgram(F,"#version 300 es\nlayout (location = 0) in vec2 a_unitquad;\nlayout (location = 1) in vec2 a_cellpos;\nlayout (location = 2) in vec2 a_offset;\nlayout (location = 3) in vec2 a_size;\nlayout (location = 4) in float a_texpage;\nlayout (location = 5) in vec2 a_texcoord;\nlayout (location = 6) in vec2 a_texsize;\n\nuniform mat4 u_projection;\nuniform vec2 u_resolution;\n\nout vec2 v_texcoord;\nflat out int v_texpage;\n\nvoid main() {\n  vec2 zeroToOne = (a_offset / u_resolution) + a_cellpos + (a_unitquad * a_size);\n  gl_Position = u_projection * vec4(zeroToOne, 0.0, 1.0);\n  v_texpage = int(a_texpage);\n  v_texcoord = a_texcoord + a_unitquad * a_texsize;\n}",function(K){let T="";for(let Y=1;Y<K;Y++)T+=` else if (v_texpage == ${Y}) { outColor = texture(u_texture[${Y}], v_texcoord); }`;return`#version 300 es\nprecision lowp float;\n\nin vec2 v_texcoord;\nflat in int v_texpage;\n\nuniform sampler2D u_texture[${K}];\n\nout vec4 outColor;\n\nvoid main() {\n  if (v_texpage == 0) {\n    outColor = texture(u_texture[0], v_texcoord);\n  } ${T}\n}`}(E.TextureAtlas.maxAtlasPages))),this.register(p.toDisposable(()=>F.deleteProgram(this._program))),this._projectionLocation=h.throwIfFalsy(F.getUniformLocation(this._program,"u_projection")),this._resolutionLocation=h.throwIfFalsy(F.getUniformLocation(this._program,"u_resolution")),this._textureLocation=h.throwIfFalsy(F.getUniformLocation(this._program,"u_texture")),this._vertexArrayObject=F.createVertexArray(),F.bindVertexArray(this._vertexArrayObject);const W=new Float32Array([0,0,1,0,0,1,1,1]),P=F.createBuffer();this.register(p.toDisposable(()=>F.deleteBuffer(P))),F.bindBuffer(F.ARRAY_BUFFER,P),F.bufferData(F.ARRAY_BUFFER,W,F.STATIC_DRAW),F.enableVertexAttribArray(0),F.vertexAttribPointer(0,2,this._gl.FLOAT,!1,0,0);const k=new Uint8Array([0,1,2,3]),Q=F.createBuffer();this.register(p.toDisposable(()=>F.deleteBuffer(Q))),F.bindBuffer(F.ELEMENT_ARRAY_BUFFER,Q),F.bufferData(F.ELEMENT_ARRAY_BUFFER,k,F.STATIC_DRAW),this._attributesBuffer=h.throwIfFalsy(F.createBuffer()),this.register(p.toDisposable(()=>F.deleteBuffer(this._attributesBuffer))),F.bindBuffer(F.ARRAY_BUFFER,this._attributesBuffer),F.enableVertexAttribArray(2),F.vertexAttribPointer(2,2,F.FLOAT,!1,L,0),F.vertexAttribDivisor(2,1),F.enableVertexAttribArray(3),F.vertexAttribPointer(3,2,F.FLOAT,!1,L,2*Float32Array.BYTES_PER_ELEMENT),F.vertexAttribDivisor(3,1),F.enableVertexAttribArray(4),F.vertexAttribPointer(4,1,F.FLOAT,!1,L,4*Float32Array.BYTES_PER_ELEMENT),F.vertexAttribDivisor(4,1),F.enableVertexAttribArray(5),F.vertexAttribPointer(5,2,F.FLOAT,!1,L,5*Float32Array.BYTES_PER_ELEMENT),F.vertexAttribDivisor(5,1),F.enableVertexAttribArray(6),F.vertexAttribPointer(6,2,F.FLOAT,!1,L,7*Float32Array.BYTES_PER_ELEMENT),F.vertexAttribDivisor(6,1),F.enableVertexAttribArray(1),F.vertexAttribPointer(1,2,F.FLOAT,!1,L,9*Float32Array.BYTES_PER_ELEMENT),F.vertexAttribDivisor(1,1),F.useProgram(this._program);const V=new Int32Array(E.TextureAtlas.maxAtlasPages);for(let K=0;K<E.TextureAtlas.maxAtlasPages;K++)V[K]=K;F.uniform1iv(this._textureLocation,V),F.uniformMatrix4fv(this._projectionLocation,!1,R.PROJECTION_MATRIX),this._atlasTextures=[];for(let K=0;K<E.TextureAtlas.maxAtlasPages;K++){const T=new R.GLTexture(h.throwIfFalsy(F.createTexture()));this.register(p.toDisposable(()=>F.deleteTexture(T.texture))),F.activeTexture(F.TEXTURE0+K),F.bindTexture(F.TEXTURE_2D,T.texture),F.texParameteri(F.TEXTURE_2D,F.TEXTURE_WRAP_S,F.CLAMP_TO_EDGE),F.texParameteri(F.TEXTURE_2D,F.TEXTURE_WRAP_T,F.CLAMP_TO_EDGE),F.texImage2D(F.TEXTURE_2D,0,F.RGBA,1,1,0,F.RGBA,F.UNSIGNED_BYTE,new Uint8Array([255,0,0,255])),this._atlasTextures[K]=T}F.enable(F.BLEND),F.blendFunc(F.SRC_ALPHA,F.ONE_MINUS_SRC_ALPHA),this.handleResize()}beginFrame(){return!this._atlas||this._atlas.beginFrame()}updateCell(m,A,Z,F,W,P,k,Q){this._updateCell(this._vertices.attributes,m,A,Z,F,W,P,k,Q)}_updateCell(m,A,Z,F,W,P,k,Q,V){S=(Z*this._terminal.cols+A)*v,F!==D.NULL_CELL_CODE&&F!==void 0?this._atlas&&(C=Q&&Q.length>1?this._atlas.getRasterizedGlyphCombinedChar(Q,W,P,k,!1):this._atlas.getRasterizedGlyph(F,W,P,k,!1),f=Math.floor((this._dimensions.device.cell.width-this._dimensions.device.char.width)/2),W!==V&&C.offset.x>f?(O=C.offset.x-f,m[S]=-(C.offset.x-O)+this._dimensions.device.char.left,m[S+1]=-C.offset.y+this._dimensions.device.char.top,m[S+2]=(C.size.x-O)/this._dimensions.device.canvas.width,m[S+3]=C.size.y/this._dimensions.device.canvas.height,m[S+4]=C.texturePage,m[S+5]=C.texturePositionClipSpace.x+O/this._atlas.pages[C.texturePage].canvas.width,m[S+6]=C.texturePositionClipSpace.y,m[S+7]=C.sizeClipSpace.x-O/this._atlas.pages[C.texturePage].canvas.width,m[S+8]=C.sizeClipSpace.y):(m[S]=-C.offset.x+this._dimensions.device.char.left,m[S+1]=-C.offset.y+this._dimensions.device.char.top,m[S+2]=C.size.x/this._dimensions.device.canvas.width,m[S+3]=C.size.y/this._dimensions.device.canvas.height,m[S+4]=C.texturePage,m[S+5]=C.texturePositionClipSpace.x,m[S+6]=C.texturePositionClipSpace.y,m[S+7]=C.sizeClipSpace.x,m[S+8]=C.sizeClipSpace.y)):m.fill(0,S,S+v-1-2)}clear(){const m=this._terminal,A=m.cols*m.rows*v;this._vertices.count!==A?this._vertices.attributes=new Float32Array(A):this._vertices.attributes.fill(0);let Z=0;for(;Z<this._vertices.attributesBuffers.length;Z++)this._vertices.count!==A?this._vertices.attributesBuffers[Z]=new Float32Array(A):this._vertices.attributesBuffers[Z].fill(0);this._vertices.count=A,Z=0;for(let F=0;F<m.rows;F++)for(let W=0;W<m.cols;W++)this._vertices.attributes[Z+9]=W/m.cols,this._vertices.attributes[Z+10]=F/m.rows,Z+=v}handleResize(){const m=this._gl;m.useProgram(this._program),m.viewport(0,0,m.canvas.width,m.canvas.height),m.uniform2f(this._resolutionLocation,m.canvas.width,m.canvas.height),this.clear()}render(m){if(!this._atlas)return;const A=this._gl;A.useProgram(this._program),A.bindVertexArray(this._vertexArrayObject),this._activeBuffer=(this._activeBuffer+1)%2;const Z=this._vertices.attributesBuffers[this._activeBuffer];let F=0;for(let W=0;W<m.lineLengths.length;W++){const P=W*this._terminal.cols*v,k=this._vertices.attributes.subarray(P,P+m.lineLengths[W]*v);Z.set(k,F),F+=k.length}A.bindBuffer(A.ARRAY_BUFFER,this._attributesBuffer),A.bufferData(A.ARRAY_BUFFER,Z.subarray(0,F),A.STREAM_DRAW);for(let W=0;W<this._atlas.pages.length;W++)this._atlas.pages[W].version!==this._atlasTextures[W].version&&this._bindAtlasPageTexture(A,this._atlas,W);A.drawElementsInstanced(A.TRIANGLE_STRIP,4,A.UNSIGNED_BYTE,0,F/v)}setAtlas(m){this._atlas=m;for(let A of this._atlasTextures)A.version=-1}_bindAtlasPageTexture(m,A,Z){m.activeTexture(m.TEXTURE0+Z),m.bindTexture(m.TEXTURE_2D,this._atlasTextures[Z].texture),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,m.CLAMP_TO_EDGE),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,m.CLAMP_TO_EDGE),m.texImage2D(m.TEXTURE_2D,0,m.RGBA,m.RGBA,m.UNSIGNED_BYTE,A.pages[Z].canvas),m.generateMipmap(m.TEXTURE_2D),this._atlasTextures[Z].version=A.pages[Z].version}setDimensions(m){this._dimensions=m}}g.GlyphRenderer=M,H([B.traceCall],M.prototype,"updateCell",null)},742:(U,g,b)=>{Object.defineProperty(g,"__esModule",{value:!0}),g.RectangleRenderer=void 0;const H=b(374),h=b(859),E=b(310),D=b(381),p=8*Float32Array.BYTES_PER_ELEMENT;class B{constructor(){this.attributes=new Float32Array(160),this.count=0}}let R=0,v=0,L=0,C=0,S=0,f=0,O=0;class M extends h.Disposable{constructor(m,A,Z,F){super(),this._terminal=m,this._gl=A,this._dimensions=Z,this._themeService=F,this._vertices=new B,this._verticesCursor=new B;const W=this._gl;this._program=H.throwIfFalsy(D.createProgram(W,"#version 300 es\nlayout (location = 0) in vec2 a_position;\nlayout (location = 1) in vec2 a_size;\nlayout (location = 2) in vec4 a_color;\nlayout (location = 3) in vec2 a_unitquad;\n\nuniform mat4 u_projection;\n\nout vec4 v_color;\n\nvoid main() {\n  vec2 zeroToOne = a_position + (a_unitquad * a_size);\n  gl_Position = u_projection * vec4(zeroToOne, 0.0, 1.0);\n  v_color = a_color;\n}","#version 300 es\nprecision lowp float;\n\nin vec4 v_color;\n\nout vec4 outColor;\n\nvoid main() {\n  outColor = v_color;\n}")),this.register(h.toDisposable(()=>W.deleteProgram(this._program))),this._projectionLocation=H.throwIfFalsy(W.getUniformLocation(this._program,"u_projection")),this._vertexArrayObject=W.createVertexArray(),W.bindVertexArray(this._vertexArrayObject);const P=new Float32Array([0,0,1,0,0,1,1,1]),k=W.createBuffer();this.register(h.toDisposable(()=>W.deleteBuffer(k))),W.bindBuffer(W.ARRAY_BUFFER,k),W.bufferData(W.ARRAY_BUFFER,P,W.STATIC_DRAW),W.enableVertexAttribArray(3),W.vertexAttribPointer(3,2,this._gl.FLOAT,!1,0,0);const Q=new Uint8Array([0,1,2,3]),V=W.createBuffer();this.register(h.toDisposable(()=>W.deleteBuffer(V))),W.bindBuffer(W.ELEMENT_ARRAY_BUFFER,V),W.bufferData(W.ELEMENT_ARRAY_BUFFER,Q,W.STATIC_DRAW),this._attributesBuffer=H.throwIfFalsy(W.createBuffer()),this.register(h.toDisposable(()=>W.deleteBuffer(this._attributesBuffer))),W.bindBuffer(W.ARRAY_BUFFER,this._attributesBuffer),W.enableVertexAttribArray(0),W.vertexAttribPointer(0,2,W.FLOAT,!1,p,0),W.vertexAttribDivisor(0,1),W.enableVertexAttribArray(1),W.vertexAttribPointer(1,2,W.FLOAT,!1,p,2*Float32Array.BYTES_PER_ELEMENT),W.vertexAttribDivisor(1,1),W.enableVertexAttribArray(2),W.vertexAttribPointer(2,4,W.FLOAT,!1,p,4*Float32Array.BYTES_PER_ELEMENT),W.vertexAttribDivisor(2,1),this._updateCachedColors(F.colors),this.register(this._themeService.onChangeColors((K)=>{this._updateCachedColors(K),this._updateViewportRectangle()}))}renderBackgrounds(){this._renderVertices(this._vertices)}renderCursor(){this._renderVertices(this._verticesCursor)}_renderVertices(m){const A=this._gl;A.useProgram(this._program),A.bindVertexArray(this._vertexArrayObject),A.uniformMatrix4fv(this._projectionLocation,!1,D.PROJECTION_MATRIX),A.bindBuffer(A.ARRAY_BUFFER,this._attributesBuffer),A.bufferData(A.ARRAY_BUFFER,m.attributes,A.DYNAMIC_DRAW),A.drawElementsInstanced(this._gl.TRIANGLE_STRIP,4,A.UNSIGNED_BYTE,0,m.count)}handleResize(){this._updateViewportRectangle()}setDimensions(m){this._dimensions=m}_updateCachedColors(m){this._bgFloat=this._colorToFloat32Array(m.background),this._cursorFloat=this._colorToFloat32Array(m.cursor)}_updateViewportRectangle(){this._addRectangleFloat(this._vertices.attributes,0,0,0,this._terminal.cols*this._dimensions.device.cell.width,this._terminal.rows*this._dimensions.device.cell.height,this._bgFloat)}updateBackgrounds(m){const A=this._terminal,Z=this._vertices;let F,W,P,k,Q,V,K,T,Y,J,_,N=1;for(F=0;F<A.rows;F++){for(P=-1,k=0,Q=0,V=!1,W=0;W<A.cols;W++)K=(F*A.cols+W)*E.RENDER_MODEL_INDICIES_PER_CELL,T=m.cells[K+E.RENDER_MODEL_BG_OFFSET],Y=m.cells[K+E.RENDER_MODEL_FG_OFFSET],J=!!(67108864&Y),(T!==k||Y!==Q&&(V||J))&&((k!==0||V&&Q!==0)&&(_=8*N++,this._updateRectangle(Z,_,Q,k,P,W,F)),P=W,k=T,Q=Y,V=J);(k!==0||V&&Q!==0)&&(_=8*N++,this._updateRectangle(Z,_,Q,k,P,A.cols,F))}Z.count=N}updateCursor(m){const A=this._verticesCursor,Z=m.cursor;if(!Z||Z.style==="block")return void(A.count=0);let F,W=0;Z.style!=="bar"&&Z.style!=="outline"||(F=8*W++,this._addRectangleFloat(A.attributes,F,Z.x*this._dimensions.device.cell.width,Z.y*this._dimensions.device.cell.height,Z.style==="bar"?Z.dpr*Z.cursorWidth:Z.dpr,this._dimensions.device.cell.height,this._cursorFloat)),Z.style!=="underline"&&Z.style!=="outline"||(F=8*W++,this._addRectangleFloat(A.attributes,F,Z.x*this._dimensions.device.cell.width,(Z.y+1)*this._dimensions.device.cell.height-Z.dpr,Z.width*this._dimensions.device.cell.width,Z.dpr,this._cursorFloat)),Z.style==="outline"&&(F=8*W++,this._addRectangleFloat(A.attributes,F,Z.x*this._dimensions.device.cell.width,Z.y*this._dimensions.device.cell.height,Z.width*this._dimensions.device.cell.width,Z.dpr,this._cursorFloat),F=8*W++,this._addRectangleFloat(A.attributes,F,(Z.x+Z.width)*this._dimensions.device.cell.width-Z.dpr,Z.y*this._dimensions.device.cell.height,Z.dpr,this._dimensions.device.cell.height,this._cursorFloat)),A.count=W}_updateRectangle(m,A,Z,F,W,P,k){if(67108864&Z)switch(50331648&Z){case 16777216:case 33554432:R=this._themeService.colors.ansi[255&Z].rgba;break;case 50331648:R=(16777215&Z)<<8;break;default:R=this._themeService.colors.foreground.rgba}else switch(50331648&F){case 16777216:case 33554432:R=this._themeService.colors.ansi[255&F].rgba;break;case 50331648:R=(16777215&F)<<8;break;default:R=this._themeService.colors.background.rgba}m.attributes.length<A+4&&(m.attributes=D.expandFloat32Array(m.attributes,this._terminal.rows*this._terminal.cols*8)),v=W*this._dimensions.device.cell.width,L=k*this._dimensions.device.cell.height,C=(R>>24&255)/255,S=(R>>16&255)/255,f=(R>>8&255)/255,O=1,this._addRectangle(m.attributes,A,v,L,(P-W)*this._dimensions.device.cell.width,this._dimensions.device.cell.height,C,S,f,O)}_addRectangle(m,A,Z,F,W,P,k,Q,V,K){m[A]=Z/this._dimensions.device.canvas.width,m[A+1]=F/this._dimensions.device.canvas.height,m[A+2]=W/this._dimensions.device.canvas.width,m[A+3]=P/this._dimensions.device.canvas.height,m[A+4]=k,m[A+5]=Q,m[A+6]=V,m[A+7]=K}_addRectangleFloat(m,A,Z,F,W,P,k){m[A]=Z/this._dimensions.device.canvas.width,m[A+1]=F/this._dimensions.device.canvas.height,m[A+2]=W/this._dimensions.device.canvas.width,m[A+3]=P/this._dimensions.device.canvas.height,m[A+4]=k[0],m[A+5]=k[1],m[A+6]=k[2],m[A+7]=k[3]}_colorToFloat32Array(m){return new Float32Array([(m.rgba>>24&255)/255,(m.rgba>>16&255)/255,(m.rgba>>8&255)/255,(255&m.rgba)/255])}}g.RectangleRenderer=M},310:(U,g,b)=>{Object.defineProperty(g,"__esModule",{value:!0}),g.RenderModel=g.COMBINED_CHAR_BIT_MASK=g.RENDER_MODEL_EXT_OFFSET=g.RENDER_MODEL_FG_OFFSET=g.RENDER_MODEL_BG_OFFSET=g.RENDER_MODEL_INDICIES_PER_CELL=void 0;const H=b(296);g.RENDER_MODEL_INDICIES_PER_CELL=4,g.RENDER_MODEL_BG_OFFSET=1,g.RENDER_MODEL_FG_OFFSET=2,g.RENDER_MODEL_EXT_OFFSET=3,g.COMBINED_CHAR_BIT_MASK=2147483648,g.RenderModel=class{constructor(){this.cells=new Uint32Array(0),this.lineLengths=new Uint32Array(0),this.selection=H.createSelectionRenderModel()}resize(h,E){const D=h*E*g.RENDER_MODEL_INDICIES_PER_CELL;D!==this.cells.length&&(this.cells=new Uint32Array(D),this.lineLengths=new Uint32Array(E))}clear(){this.cells.fill(0,0),this.lineLengths.fill(0,0)}}},666:function(U,g,b){var H=this&&this.__decorate||function(k,Q,V,K){var T,Y=arguments.length,J=Y<3?Q:K===null?K=Object.getOwnPropertyDescriptor(Q,V):K;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")J=Reflect.decorate(k,Q,V,K);else for(var _=k.length-1;_>=0;_--)(T=k[_])&&(J=(Y<3?T(J):Y>3?T(Q,V,J):T(Q,V))||J);return Y>3&&J&&Object.defineProperty(Q,V,J),J};Object.defineProperty(g,"__esModule",{value:!0}),g.JoinedCellData=g.WebglRenderer=void 0;const h=b(820),E=b(274),D=b(627),p=b(457),B=b(56),R=b(374),v=b(345),L=b(859),C=b(147),S=b(782),f=b(855),O=b(776),M=b(965),m=b(742),A=b(310),Z=b(733);class F extends L.Disposable{constructor(k,Q,V,K,T,Y,J,_,N){super(),this._terminal=k,this._characterJoinerService=Q,this._charSizeService=V,this._coreBrowserService=K,this._coreService=T,this._decorationService=Y,this._optionsService=J,this._themeService=_,this._cursorBlinkStateManager=new L.MutableDisposable,this._charAtlasDisposable=this.register(new L.MutableDisposable),this._model=new A.RenderModel,this._workCell=new S.CellData,this._rectangleRenderer=this.register(new L.MutableDisposable),this._glyphRenderer=this.register(new L.MutableDisposable),this._onChangeTextureAtlas=this.register(new v.EventEmitter),this.onChangeTextureAtlas=this._onChangeTextureAtlas.event,this._onAddTextureAtlasCanvas=this.register(new v.EventEmitter),this.onAddTextureAtlasCanvas=this._onAddTextureAtlasCanvas.event,this._onRemoveTextureAtlasCanvas=this.register(new v.EventEmitter),this.onRemoveTextureAtlasCanvas=this._onRemoveTextureAtlasCanvas.event,this._onRequestRedraw=this.register(new v.EventEmitter),this.onRequestRedraw=this._onRequestRedraw.event,this._onContextLoss=this.register(new v.EventEmitter),this.onContextLoss=this._onContextLoss.event,this.register(this._themeService.onChangeColors(()=>this._handleColorChange())),this._cellColorResolver=new E.CellColorResolver(this._terminal,this._model.selection,this._decorationService,this._coreBrowserService,this._themeService),this._core=this._terminal._core,this._renderLayers=[new Z.LinkRenderLayer(this._core.screenElement,2,this._terminal,this._core.linkifier2,this._coreBrowserService,J,this._themeService)],this.dimensions=R.createRenderDimensions(),this._devicePixelRatio=this._coreBrowserService.dpr,this._updateDimensions(),this._updateCursorBlink(),this.register(J.onOptionChange(()=>this._handleOptionsChanged())),this._canvas=document.createElement("canvas");const I={antialias:!1,depth:!1,preserveDrawingBuffer:N};if(this._gl=this._canvas.getContext("webgl2",I),!this._gl)throw new Error("WebGL2 not supported "+this._gl);this.register(h.addDisposableDomListener(this._canvas,"webglcontextlost",($)=>{console.log("webglcontextlost event received"),$.preventDefault(),this._contextRestorationTimeout=setTimeout(()=>{this._contextRestorationTimeout=void 0,console.warn("webgl context not restored; firing onContextLoss"),this._onContextLoss.fire($)},3000)})),this.register(h.addDisposableDomListener(this._canvas,"webglcontextrestored",($)=>{console.warn("webglcontextrestored event received"),clearTimeout(this._contextRestorationTimeout),this._contextRestorationTimeout=void 0,D.removeTerminalFromCache(this._terminal),this._initializeWebGLState(),this._requestRedrawViewport()})),this.register(B.observeDevicePixelDimensions(this._canvas,this._coreBrowserService.window,($,w)=>this._setCanvasDevicePixelDimensions($,w))),this._core.screenElement.appendChild(this._canvas),[this._rectangleRenderer.value,this._glyphRenderer.value]=this._initializeWebGLState(),this._isAttached=this._coreBrowserService.window.document.body.contains(this._core.screenElement),this.register(L.toDisposable(()=>{var $;for(let w of this._renderLayers)w.dispose();($=this._canvas.parentElement)===null||$===void 0||$.removeChild(this._canvas),D.removeTerminalFromCache(this._terminal)}))}get textureAtlas(){var k;return(k=this._charAtlas)===null||k===void 0?void 0:k.pages[0].canvas}_handleColorChange(){this._refreshCharAtlas(),this._clearModel(!0)}handleDevicePixelRatioChange(){this._devicePixelRatio!==this._coreBrowserService.dpr&&(this._devicePixelRatio=this._coreBrowserService.dpr,this.handleResize(this._terminal.cols,this._terminal.rows))}handleResize(k,Q){var V,K,T,Y;this._updateDimensions(),this._model.resize(this._terminal.cols,this._terminal.rows);for(let J of this._renderLayers)J.resize(this._terminal,this.dimensions);this._canvas.width=this.dimensions.device.canvas.width,this._canvas.height=this.dimensions.device.canvas.height,this._canvas.style.width=`${this.dimensions.css.canvas.width}px`,this._canvas.style.height=`${this.dimensions.css.canvas.height}px`,this._core.screenElement.style.width=`${this.dimensions.css.canvas.width}px`,this._core.screenElement.style.height=`${this.dimensions.css.canvas.height}px`,(V=this._rectangleRenderer.value)===null||V===void 0||V.setDimensions(this.dimensions),(K=this._rectangleRenderer.value)===null||K===void 0||K.handleResize(),(T=this._glyphRenderer.value)===null||T===void 0||T.setDimensions(this.dimensions),(Y=this._glyphRenderer.value)===null||Y===void 0||Y.handleResize(),this._refreshCharAtlas(),this._clearModel(!1)}handleCharSizeChanged(){this.handleResize(this._terminal.cols,this._terminal.rows)}handleBlur(){var k;for(let Q of this._renderLayers)Q.handleBlur(this._terminal);(k=this._cursorBlinkStateManager.value)===null||k===void 0||k.pause(),this._requestRedrawViewport()}handleFocus(){var k;for(let Q of this._renderLayers)Q.handleFocus(this._terminal);(k=this._cursorBlinkStateManager.value)===null||k===void 0||k.resume(),this._requestRedrawViewport()}handleSelectionChanged(k,Q,V){for(let K of this._renderLayers)K.handleSelectionChanged(this._terminal,k,Q,V);this._model.selection.update(this._terminal,k,Q,V),this._requestRedrawViewport()}handleCursorMove(){var k;for(let Q of this._renderLayers)Q.handleCursorMove(this._terminal);(k=this._cursorBlinkStateManager.value)===null||k===void 0||k.restartBlinkAnimation()}_handleOptionsChanged(){this._updateDimensions(),this._refreshCharAtlas(),this._updateCursorBlink()}_initializeWebGLState(){return this._rectangleRenderer.value=new m.RectangleRenderer(this._terminal,this._gl,this.dimensions,this._themeService),this._glyphRenderer.value=new M.GlyphRenderer(this._terminal,this._gl,this.dimensions),this.handleCharSizeChanged(),[this._rectangleRenderer.value,this._glyphRenderer.value]}_refreshCharAtlas(){var k;if(this.dimensions.device.char.width<=0&&this.dimensions.device.char.height<=0)return void(this._isAttached=!1);const Q=D.acquireTextureAtlas(this._terminal,this._optionsService.rawOptions,this._themeService.colors,this.dimensions.device.cell.width,this.dimensions.device.cell.height,this.dimensions.device.char.width,this.dimensions.device.char.height,this._coreBrowserService.dpr);this._charAtlas!==Q&&(this._onChangeTextureAtlas.fire(Q.pages[0].canvas),this._charAtlasDisposable.value=L.getDisposeArrayDisposable([v.forwardEvent(Q.onAddTextureAtlasCanvas,this._onAddTextureAtlasCanvas),v.forwardEvent(Q.onRemoveTextureAtlasCanvas,this._onRemoveTextureAtlasCanvas)])),this._charAtlas=Q,this._charAtlas.warmUp(),(k=this._glyphRenderer.value)===null||k===void 0||k.setAtlas(this._charAtlas)}_clearModel(k){var Q;this._model.clear(),k&&((Q=this._glyphRenderer.value)===null||Q===void 0||Q.clear())}clearTextureAtlas(){var k;(k=this._charAtlas)===null||k===void 0||k.clearTexture(),this._clearModel(!0),this._requestRedrawViewport()}clear(){var k;this._clearModel(!0);for(let Q of this._renderLayers)Q.reset(this._terminal);(k=this._cursorBlinkStateManager.value)===null||k===void 0||k.restartBlinkAnimation(),this._updateCursorBlink()}registerCharacterJoiner(k){return-1}deregisterCharacterJoiner(k){return!1}renderRows(k,Q){if(!this._isAttached){if(!(this._coreBrowserService.window.document.body.contains(this._core.screenElement)&&this._charSizeService.width&&this._charSizeService.height))return;this._updateDimensions(),this._refreshCharAtlas(),this._isAttached=!0}for(let V of this._renderLayers)V.handleGridChanged(this._terminal,k,Q);this._glyphRenderer.value&&this._rectangleRenderer.value&&(this._glyphRenderer.value.beginFrame()?(this._clearModel(!0),this._updateModel(0,this._terminal.rows-1)):this._updateModel(k,Q),this._rectangleRenderer.value.renderBackgrounds(),this._glyphRenderer.value.render(this._model),this._cursorBlinkStateManager.value&&!this._cursorBlinkStateManager.value.isCursorVisible||this._rectangleRenderer.value.renderCursor())}_updateCursorBlink(){this._terminal.options.cursorBlink?this._cursorBlinkStateManager.value=new p.CursorBlinkStateManager(()=>{this._requestRedrawCursor()},this._coreBrowserService):this._cursorBlinkStateManager.clear(),this._requestRedrawCursor()}_updateModel(k,Q){const V=this._core;let K,T,Y,J,_,N,I,$,w,d,X,u,G,z=this._workCell;k=P(k,V.rows-1,0),Q=P(Q,V.rows-1,0);const r=this._terminal.buffer.active.baseY+this._terminal.buffer.active.cursorY,q=Math.min(this._terminal.buffer.active.cursorX,V.cols-1);let g0=-1;const t=this._coreService.isCursorInitialized&&!this._coreService.isCursorHidden&&(!this._cursorBlinkStateManager.value||this._cursorBlinkStateManager.value.isCursorVisible);this._model.cursor=void 0;let R0=!1;for(T=k;T<=Q;T++)for(Y=T+V.buffer.ydisp,J=V.buffer.lines.get(Y),this._model.lineLengths[T]=0,_=this._characterJoinerService.getJoinedCharacters(Y),u=0;u<V.cols;u++)if(K=this._cellColorResolver.result.bg,J.loadCell(u,z),u===0&&(K=this._cellColorResolver.result.bg),N=!1,I=u,_.length>0&&u===_[0][0]&&(N=!0,$=_.shift(),z=new W(z,J.translateToString(!0,$[0],$[1]),$[1]-$[0]),I=$[1]-1),w=z.getChars(),d=z.getCode(),X=(T*V.cols+u)*A.RENDER_MODEL_INDICIES_PER_CELL,this._cellColorResolver.resolve(z,u,Y),t&&Y===r&&(u===q&&(this._model.cursor={x:q,y:this._terminal.buffer.active.cursorY,width:z.getWidth(),style:this._coreBrowserService.isFocused?V.options.cursorStyle||"block":V.options.cursorInactiveStyle,cursorWidth:V.options.cursorWidth,dpr:this._devicePixelRatio},g0=q+z.getWidth()-1),u>=q&&u<=g0&&(this._coreBrowserService.isFocused&&(V.options.cursorStyle||"block")==="block"||this._coreBrowserService.isFocused===!1&&V.options.cursorInactiveStyle==="block")&&(this._cellColorResolver.result.fg=50331648|this._themeService.colors.cursorAccent.rgba>>8&16777215,this._cellColorResolver.result.bg=50331648|this._themeService.colors.cursor.rgba>>8&16777215)),d!==f.NULL_CELL_CODE&&(this._model.lineLengths[T]=u+1),(this._model.cells[X]!==d||this._model.cells[X+A.RENDER_MODEL_BG_OFFSET]!==this._cellColorResolver.result.bg||this._model.cells[X+A.RENDER_MODEL_FG_OFFSET]!==this._cellColorResolver.result.fg||this._model.cells[X+A.RENDER_MODEL_EXT_OFFSET]!==this._cellColorResolver.result.ext)&&(R0=!0,w.length>1&&(d|=A.COMBINED_CHAR_BIT_MASK),this._model.cells[X]=d,this._model.cells[X+A.RENDER_MODEL_BG_OFFSET]=this._cellColorResolver.result.bg,this._model.cells[X+A.RENDER_MODEL_FG_OFFSET]=this._cellColorResolver.result.fg,this._model.cells[X+A.RENDER_MODEL_EXT_OFFSET]=this._cellColorResolver.result.ext,this._glyphRenderer.value.updateCell(u,T,d,this._cellColorResolver.result.bg,this._cellColorResolver.result.fg,this._cellColorResolver.result.ext,w,K),N))for(z=this._workCell,u++;u<I;u++)G=(T*V.cols+u)*A.RENDER_MODEL_INDICIES_PER_CELL,this._glyphRenderer.value.updateCell(u,T,f.NULL_CELL_CODE,0,0,0,f.NULL_CELL_CHAR,0),this._model.cells[G]=f.NULL_CELL_CODE,this._model.cells[G+A.RENDER_MODEL_BG_OFFSET]=this._cellColorResolver.result.bg,this._model.cells[G+A.RENDER_MODEL_FG_OFFSET]=this._cellColorResolver.result.fg,this._model.cells[G+A.RENDER_MODEL_EXT_OFFSET]=this._cellColorResolver.result.ext;R0&&this._rectangleRenderer.value.updateBackgrounds(this._model),this._rectangleRenderer.value.updateCursor(this._model)}_updateDimensions(){this._charSizeService.width&&this._charSizeService.height&&(this.dimensions.device.char.width=Math.floor(this._charSizeService.width*this._devicePixelRatio),this.dimensions.device.char.height=Math.ceil(this._charSizeService.height*this._devicePixelRatio),this.dimensions.device.cell.height=Math.floor(this.dimensions.device.char.height*this._optionsService.rawOptions.lineHeight),this.dimensions.device.char.top=this._optionsService.rawOptions.lineHeight===1?0:Math.round((this.dimensions.device.cell.height-this.dimensions.device.char.height)/2),this.dimensions.device.cell.width=this.dimensions.device.char.width+Math.round(this._optionsService.rawOptions.letterSpacing),this.dimensions.device.char.left=Math.floor(this._optionsService.rawOptions.letterSpacing/2),this.dimensions.device.canvas.height=this._terminal.rows*this.dimensions.device.cell.height,this.dimensions.device.canvas.width=this._terminal.cols*this.dimensions.device.cell.width,this.dimensions.css.canvas.height=Math.round(this.dimensions.device.canvas.height/this._devicePixelRatio),this.dimensions.css.canvas.width=Math.round(this.dimensions.device.canvas.width/this._devicePixelRatio),this.dimensions.css.cell.height=this.dimensions.device.cell.height/this._devicePixelRatio,this.dimensions.css.cell.width=this.dimensions.device.cell.width/this._devicePixelRatio)}_setCanvasDevicePixelDimensions(k,Q){this._canvas.width===k&&this._canvas.height===Q||(this._canvas.width=k,this._canvas.height=Q,this._requestRedrawViewport())}_requestRedrawViewport(){this._onRequestRedraw.fire({start:0,end:this._terminal.rows-1})}_requestRedrawCursor(){const k=this._terminal.buffer.active.cursorY;this._onRequestRedraw.fire({start:k,end:k})}}g.WebglRenderer=F,H([O.traceCall],F.prototype,"renderRows",null);class W extends C.AttributeData{constructor(k,Q,V){super(),this.content=0,this.combinedData="",this.fg=k.fg,this.bg=k.bg,this.combinedData=Q,this._width=V}isCombined(){return 2097152}getWidth(){return this._width}getChars(){return this.combinedData}getCode(){return 2097151}setFromCharData(k){throw new Error("not implemented")}getAsCharData(){return[this.fg,this.getChars(),this.getWidth(),this.getCode()]}}function P(k,Q,V=0){return Math.max(Math.min(k,Q),V)}g.JoinedCellData=W},381:(U,g,b)=>{Object.defineProperty(g,"__esModule",{value:!0}),g.GLTexture=g.expandFloat32Array=g.createShader=g.createProgram=g.PROJECTION_MATRIX=void 0;const H=b(374);function h(E,D,p){const B=H.throwIfFalsy(E.createShader(D));if(E.shaderSource(B,p),E.compileShader(B),E.getShaderParameter(B,E.COMPILE_STATUS))return B;console.error(E.getShaderInfoLog(B)),E.deleteShader(B)}g.PROJECTION_MATRIX=new Float32Array([2,0,0,0,0,-2,0,0,0,0,1,0,-1,1,0,1]),g.createProgram=function(E,D,p){const B=H.throwIfFalsy(E.createProgram());if(E.attachShader(B,H.throwIfFalsy(h(E,E.VERTEX_SHADER,D))),E.attachShader(B,H.throwIfFalsy(h(E,E.FRAGMENT_SHADER,p))),E.linkProgram(B),E.getProgramParameter(B,E.LINK_STATUS))return B;console.error(E.getProgramInfoLog(B)),E.deleteProgram(B)},g.createShader=h,g.expandFloat32Array=function(E,D){const p=Math.min(2*E.length,D),B=new Float32Array(p);for(let R=0;R<E.length;R++)B[R]=E[R];return B},g.GLTexture=class{constructor(E){this.texture=E,this.version=-1}}},592:(U,g,b)=>{Object.defineProperty(g,"__esModule",{value:!0}),g.BaseRenderLayer=void 0;const H=b(627),h=b(237),E=b(374),D=b(859);class p extends D.Disposable{constructor(B,R,v,L,C,S,f,O){super(),this._container=R,this._alpha=C,this._coreBrowserService=S,this._optionsService=f,this._themeService=O,this._deviceCharWidth=0,this._deviceCharHeight=0,this._deviceCellWidth=0,this._deviceCellHeight=0,this._deviceCharLeft=0,this._deviceCharTop=0,this._canvas=document.createElement("canvas"),this._canvas.classList.add(`xterm-${v}-layer`),this._canvas.style.zIndex=L.toString(),this._initCanvas(),this._container.appendChild(this._canvas),this.register(this._themeService.onChangeColors((M)=>{this._refreshCharAtlas(B,M),this.reset(B)})),this.register(D.toDisposable(()=>{this._canvas.remove()}))}_initCanvas(){this._ctx=E.throwIfFalsy(this._canvas.getContext("2d",{alpha:this._alpha})),this._alpha||this._clearAll()}handleBlur(B){}handleFocus(B){}handleCursorMove(B){}handleGridChanged(B,R,v){}handleSelectionChanged(B,R,v,L=!1){}_setTransparency(B,R){if(R===this._alpha)return;const v=this._canvas;this._alpha=R,this._canvas=this._canvas.cloneNode(),this._initCanvas(),this._container.replaceChild(this._canvas,v),this._refreshCharAtlas(B,this._themeService.colors),this.handleGridChanged(B,0,B.rows-1)}_refreshCharAtlas(B,R){this._deviceCharWidth<=0&&this._deviceCharHeight<=0||(this._charAtlas=H.acquireTextureAtlas(B,this._optionsService.rawOptions,R,this._deviceCellWidth,this._deviceCellHeight,this._deviceCharWidth,this._deviceCharHeight,this._coreBrowserService.dpr),this._charAtlas.warmUp())}resize(B,R){this._deviceCellWidth=R.device.cell.width,this._deviceCellHeight=R.device.cell.height,this._deviceCharWidth=R.device.char.width,this._deviceCharHeight=R.device.char.height,this._deviceCharLeft=R.device.char.left,this._deviceCharTop=R.device.char.top,this._canvas.width=R.device.canvas.width,this._canvas.height=R.device.canvas.height,this._canvas.style.width=`${R.css.canvas.width}px`,this._canvas.style.height=`${R.css.canvas.height}px`,this._alpha||this._clearAll(),this._refreshCharAtlas(B,this._themeService.colors)}_fillBottomLineAtCells(B,R,v=1){this._ctx.fillRect(B*this._deviceCellWidth,(R+1)*this._deviceCellHeight-this._coreBrowserService.dpr-1,v*this._deviceCellWidth,this._coreBrowserService.dpr)}_clearAll(){this._alpha?this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height):(this._ctx.fillStyle=this._themeService.colors.background.css,this._ctx.fillRect(0,0,this._canvas.width,this._canvas.height))}_clearCells(B,R,v,L){this._alpha?this._ctx.clearRect(B*this._deviceCellWidth,R*this._deviceCellHeight,v*this._deviceCellWidth,L*this._deviceCellHeight):(this._ctx.fillStyle=this._themeService.colors.background.css,this._ctx.fillRect(B*this._deviceCellWidth,R*this._deviceCellHeight,v*this._deviceCellWidth,L*this._deviceCellHeight))}_fillCharTrueColor(B,R,v,L){this._ctx.font=this._getFont(B,!1,!1),this._ctx.textBaseline=h.TEXT_BASELINE,this._clipCell(v,L,R.getWidth()),this._ctx.fillText(R.getChars(),v*this._deviceCellWidth+this._deviceCharLeft,L*this._deviceCellHeight+this._deviceCharTop+this._deviceCharHeight)}_clipCell(B,R,v){this._ctx.beginPath(),this._ctx.rect(B*this._deviceCellWidth,R*this._deviceCellHeight,v*this._deviceCellWidth,this._deviceCellHeight),this._ctx.clip()}_getFont(B,R,v){return`${v?"italic":""} ${R?B.options.fontWeightBold:B.options.fontWeight} ${B.options.fontSize*this._coreBrowserService.dpr}px ${B.options.fontFamily}`}}g.BaseRenderLayer=p},733:(U,g,b)=>{Object.defineProperty(g,"__esModule",{value:!0}),g.LinkRenderLayer=void 0;const H=b(197),h=b(237),E=b(592);class D extends E.BaseRenderLayer{constructor(p,B,R,v,L,C,S){super(R,p,"link",B,!0,L,C,S),this.register(v.onShowLinkUnderline((f)=>this._handleShowLinkUnderline(f))),this.register(v.onHideLinkUnderline((f)=>this._handleHideLinkUnderline(f)))}resize(p,B){super.resize(p,B),this._state=void 0}reset(p){this._clearCurrentLink()}_clearCurrentLink(){if(this._state){this._clearCells(this._state.x1,this._state.y1,this._state.cols-this._state.x1,1);const p=this._state.y2-this._state.y1-1;p>0&&this._clearCells(0,this._state.y1+1,this._state.cols,p),this._clearCells(0,this._state.y2,this._state.x2,1),this._state=void 0}}_handleShowLinkUnderline(p){if(p.fg===h.INVERTED_DEFAULT_COLOR?this._ctx.fillStyle=this._themeService.colors.background.css:p.fg!==void 0&&H.is256Color(p.fg)?this._ctx.fillStyle=this._themeService.colors.ansi[p.fg].css:this._ctx.fillStyle=this._themeService.colors.foreground.css,p.y1===p.y2)this._fillBottomLineAtCells(p.x1,p.y1,p.x2-p.x1);else{this._fillBottomLineAtCells(p.x1,p.y1,p.cols-p.x1);for(let B=p.y1+1;B<p.y2;B++)this._fillBottomLineAtCells(0,B,p.cols);this._fillBottomLineAtCells(0,p.y2,p.x2)}this._state=p}_handleHideLinkUnderline(p){this._clearCurrentLink()}}g.LinkRenderLayer=D},820:(U,g)=>{Object.defineProperty(g,"__esModule",{value:!0}),g.addDisposableDomListener=void 0,g.addDisposableDomListener=function(b,H,h,E){b.addEventListener(H,h,E);let D=!1;return{dispose:()=>{D||(D=!0,b.removeEventListener(H,h,E))}}}},274:(U,g)=>{Object.defineProperty(g,"__esModule",{value:!0}),g.CellColorResolver=void 0;let b,H=0,h=0,E=!1,D=!1,p=!1;g.CellColorResolver=class{constructor(B,R,v,L,C){this._terminal=B,this._selectionRenderModel=R,this._decorationService=v,this._coreBrowserService=L,this._themeService=C,this.result={fg:0,bg:0,ext:0}}resolve(B,R,v){this.result.bg=B.bg,this.result.fg=B.fg,this.result.ext=268435456&B.bg?B.extended.ext:0,h=0,H=0,D=!1,E=!1,p=!1,b=this._themeService.colors,this._decorationService.forEachDecorationAtCell(R,v,"bottom",(L)=>{L.backgroundColorRGB&&(h=L.backgroundColorRGB.rgba>>8&16777215,D=!0),L.foregroundColorRGB&&(H=L.foregroundColorRGB.rgba>>8&16777215,E=!0)}),p=this._selectionRenderModel.isCellSelected(this._terminal,R,v),p&&(h=(this._coreBrowserService.isFocused?b.selectionBackgroundOpaque:b.selectionInactiveBackgroundOpaque).rgba>>8&16777215,D=!0,b.selectionForeground&&(H=b.selectionForeground.rgba>>8&16777215,E=!0)),this._decorationService.forEachDecorationAtCell(R,v,"top",(L)=>{L.backgroundColorRGB&&(h=L.backgroundColorRGB.rgba>>8&16777215,D=!0),L.foregroundColorRGB&&(H=L.foregroundColorRGB.rgba>>8&16777215,E=!0)}),D&&(h=p?-16777216&B.bg&-134217729|h|50331648:-16777216&B.bg|h|50331648),E&&(H=-16777216&B.fg&-67108865|H|50331648),67108864&this.result.fg&&(D&&!E&&(H=(50331648&this.result.bg)==0?-134217728&this.result.fg|16777215&b.background.rgba>>8|50331648:-134217728&this.result.fg|67108863&this.result.bg,E=!0),!D&&E&&(h=(50331648&this.result.fg)==0?-67108864&this.result.bg|16777215&b.foreground.rgba>>8|50331648:-67108864&this.result.bg|67108863&this.result.fg,D=!0)),b=void 0,this.result.bg=D?h:this.result.bg,this.result.fg=E?H:this.result.fg}}},627:(U,g,b)=>{Object.defineProperty(g,"__esModule",{value:!0}),g.removeTerminalFromCache=g.acquireTextureAtlas=void 0;const H=b(509),h=b(197),E=[];g.acquireTextureAtlas=function(D,p,B,R,v,L,C,S){const f=h.generateConfig(R,v,L,C,p,B,S);for(let m=0;m<E.length;m++){const A=E[m],Z=A.ownedBy.indexOf(D);if(Z>=0){if(h.configEquals(A.config,f))return A.atlas;A.ownedBy.length===1?(A.atlas.dispose(),E.splice(m,1)):A.ownedBy.splice(Z,1);break}}for(let m=0;m<E.length;m++){const A=E[m];if(h.configEquals(A.config,f))return A.ownedBy.push(D),A.atlas}const O=D._core,M={atlas:new H.TextureAtlas(document,f,O.unicodeService),config:f,ownedBy:[D]};return E.push(M),M.atlas},g.removeTerminalFromCache=function(D){for(let p=0;p<E.length;p++){const B=E[p].ownedBy.indexOf(D);if(B!==-1){E[p].ownedBy.length===1?(E[p].atlas.dispose(),E.splice(p,1)):E[p].ownedBy.splice(B,1);break}}}},197:(U,g,b)=>{Object.defineProperty(g,"__esModule",{value:!0}),g.is256Color=g.configEquals=g.generateConfig=void 0;const H=b(160);g.generateConfig=function(h,E,D,p,B,R,v){const L={foreground:R.foreground,background:R.background,cursor:H.NULL_COLOR,cursorAccent:H.NULL_COLOR,selectionForeground:H.NULL_COLOR,selectionBackgroundTransparent:H.NULL_COLOR,selectionBackgroundOpaque:H.NULL_COLOR,selectionInactiveBackgroundTransparent:H.NULL_COLOR,selectionInactiveBackgroundOpaque:H.NULL_COLOR,ansi:R.ansi.slice(),contrastCache:R.contrastCache,halfContrastCache:R.halfContrastCache};return{customGlyphs:B.customGlyphs,devicePixelRatio:v,letterSpacing:B.letterSpacing,lineHeight:B.lineHeight,deviceCellWidth:h,deviceCellHeight:E,deviceCharWidth:D,deviceCharHeight:p,fontFamily:B.fontFamily,fontSize:B.fontSize,fontWeight:B.fontWeight,fontWeightBold:B.fontWeightBold,allowTransparency:B.allowTransparency,drawBoldTextInBrightColors:B.drawBoldTextInBrightColors,minimumContrastRatio:B.minimumContrastRatio,colors:L}},g.configEquals=function(h,E){for(let D=0;D<h.colors.ansi.length;D++)if(h.colors.ansi[D].rgba!==E.colors.ansi[D].rgba)return!1;return h.devicePixelRatio===E.devicePixelRatio&&h.customGlyphs===E.customGlyphs&&h.lineHeight===E.lineHeight&&h.letterSpacing===E.letterSpacing&&h.fontFamily===E.fontFamily&&h.fontSize===E.fontSize&&h.fontWeight===E.fontWeight&&h.fontWeightBold===E.fontWeightBold&&h.allowTransparency===E.allowTransparency&&h.deviceCharWidth===E.deviceCharWidth&&h.deviceCharHeight===E.deviceCharHeight&&h.drawBoldTextInBrightColors===E.drawBoldTextInBrightColors&&h.minimumContrastRatio===E.minimumContrastRatio&&h.colors.foreground.rgba===E.colors.foreground.rgba&&h.colors.background.rgba===E.colors.background.rgba},g.is256Color=function(h){return(50331648&h)==16777216||(50331648&h)==33554432}},237:(U,g,b)=>{Object.defineProperty(g,"__esModule",{value:!0}),g.TEXT_BASELINE=g.DIM_OPACITY=g.INVERTED_DEFAULT_COLOR=void 0;const H=b(399);g.INVERTED_DEFAULT_COLOR=257,g.DIM_OPACITY=0.5,g.TEXT_BASELINE=H.isFirefox||H.isLegacyEdge?"bottom":"ideographic"},457:(U,g)=>{Object.defineProperty(g,"__esModule",{value:!0}),g.CursorBlinkStateManager=void 0,g.CursorBlinkStateManager=class{constructor(b,H){this._renderCallback=b,this._coreBrowserService=H,this.isCursorVisible=!0,this._coreBrowserService.isFocused&&this._restartInterval()}get isPaused(){return!(this._blinkStartTimeout||this._blinkInterval)}dispose(){this._blinkInterval&&(this._coreBrowserService.window.clearInterval(this._blinkInterval),this._blinkInterval=void 0),this._blinkStartTimeout&&(this._coreBrowserService.window.clearTimeout(this._blinkStartTimeout),this._blinkStartTimeout=void 0),this._animationFrame&&(this._coreBrowserService.window.cancelAnimationFrame(this._animationFrame),this._animationFrame=void 0)}restartBlinkAnimation(){this.isPaused||(this._animationTimeRestarted=Date.now(),this.isCursorVisible=!0,this._animationFrame||(this._animationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>{this._renderCallback(),this._animationFrame=void 0})))}_restartInterval(b=600){this._blinkInterval&&(this._coreBrowserService.window.clearInterval(this._blinkInterval),this._blinkInterval=void 0),this._blinkStartTimeout=this._coreBrowserService.window.setTimeout(()=>{if(this._animationTimeRestarted){const H=600-(Date.now()-this._animationTimeRestarted);if(this._animationTimeRestarted=void 0,H>0)return void this._restartInterval(H)}this.isCursorVisible=!1,this._animationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>{this._renderCallback(),this._animationFrame=void 0}),this._blinkInterval=this._coreBrowserService.window.setInterval(()=>{if(this._animationTimeRestarted){const H=600-(Date.now()-this._animationTimeRestarted);return this._animationTimeRestarted=void 0,void this._restartInterval(H)}this.isCursorVisible=!this.isCursorVisible,this._animationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>{this._renderCallback(),this._animationFrame=void 0})},600)},b)}pause(){this.isCursorVisible=!0,this._blinkInterval&&(this._coreBrowserService.window.clearInterval(this._blinkInterval),this._blinkInterval=void 0),this._blinkStartTimeout&&(this._coreBrowserService.window.clearTimeout(this._blinkStartTimeout),this._blinkStartTimeout=void 0),this._animationFrame&&(this._coreBrowserService.window.cancelAnimationFrame(this._animationFrame),this._animationFrame=void 0)}resume(){this.pause(),this._animationTimeRestarted=void 0,this._restartInterval(),this.restartBlinkAnimation()}}},860:(U,g,b)=>{Object.defineProperty(g,"__esModule",{value:!0}),g.tryDrawCustomChar=g.powerlineDefinitions=g.boxDrawingDefinitions=g.blockElementDefinitions=void 0;const H=b(374);g.blockElementDefinitions={"\u2580":[{x:0,y:0,w:8,h:4}],"\u2581":[{x:0,y:7,w:8,h:1}],"\u2582":[{x:0,y:6,w:8,h:2}],"\u2583":[{x:0,y:5,w:8,h:3}],"\u2584":[{x:0,y:4,w:8,h:4}],"\u2585":[{x:0,y:3,w:8,h:5}],"\u2586":[{x:0,y:2,w:8,h:6}],"\u2587":[{x:0,y:1,w:8,h:7}],"\u2588":[{x:0,y:0,w:8,h:8}],"\u2589":[{x:0,y:0,w:7,h:8}],"\u258A":[{x:0,y:0,w:6,h:8}],"\u258B":[{x:0,y:0,w:5,h:8}],"\u258C":[{x:0,y:0,w:4,h:8}],"\u258D":[{x:0,y:0,w:3,h:8}],"\u258E":[{x:0,y:0,w:2,h:8}],"\u258F":[{x:0,y:0,w:1,h:8}],"\u2590":[{x:4,y:0,w:4,h:8}],"\u2594":[{x:0,y:0,w:8,h:1}],"\u2595":[{x:7,y:0,w:1,h:8}],"\u2596":[{x:0,y:4,w:4,h:4}],"\u2597":[{x:4,y:4,w:4,h:4}],"\u2598":[{x:0,y:0,w:4,h:4}],"\u2599":[{x:0,y:0,w:4,h:8},{x:0,y:4,w:8,h:4}],"\u259A":[{x:0,y:0,w:4,h:4},{x:4,y:4,w:4,h:4}],"\u259B":[{x:0,y:0,w:4,h:8},{x:4,y:0,w:4,h:4}],"\u259C":[{x:0,y:0,w:8,h:4},{x:4,y:0,w:4,h:8}],"\u259D":[{x:4,y:0,w:4,h:4}],"\u259E":[{x:4,y:0,w:4,h:4},{x:0,y:4,w:4,h:4}],"\u259F":[{x:4,y:0,w:4,h:8},{x:0,y:4,w:8,h:4}],"\uD83E\uDF70":[{x:1,y:0,w:1,h:8}],"\uD83E\uDF71":[{x:2,y:0,w:1,h:8}],"\uD83E\uDF72":[{x:3,y:0,w:1,h:8}],"\uD83E\uDF73":[{x:4,y:0,w:1,h:8}],"\uD83E\uDF74":[{x:5,y:0,w:1,h:8}],"\uD83E\uDF75":[{x:6,y:0,w:1,h:8}],"\uD83E\uDF76":[{x:0,y:1,w:8,h:1}],"\uD83E\uDF77":[{x:0,y:2,w:8,h:1}],"\uD83E\uDF78":[{x:0,y:3,w:8,h:1}],"\uD83E\uDF79":[{x:0,y:4,w:8,h:1}],"\uD83E\uDF7A":[{x:0,y:5,w:8,h:1}],"\uD83E\uDF7B":[{x:0,y:6,w:8,h:1}],"\uD83E\uDF7C":[{x:0,y:0,w:1,h:8},{x:0,y:7,w:8,h:1}],"\uD83E\uDF7D":[{x:0,y:0,w:1,h:8},{x:0,y:0,w:8,h:1}],"\uD83E\uDF7E":[{x:7,y:0,w:1,h:8},{x:0,y:0,w:8,h:1}],"\uD83E\uDF7F":[{x:7,y:0,w:1,h:8},{x:0,y:7,w:8,h:1}],"\uD83E\uDF80":[{x:0,y:0,w:8,h:1},{x:0,y:7,w:8,h:1}],"\uD83E\uDF81":[{x:0,y:0,w:8,h:1},{x:0,y:2,w:8,h:1},{x:0,y:4,w:8,h:1},{x:0,y:7,w:8,h:1}],"\uD83E\uDF82":[{x:0,y:0,w:8,h:2}],"\uD83E\uDF83":[{x:0,y:0,w:8,h:3}],"\uD83E\uDF84":[{x:0,y:0,w:8,h:5}],"\uD83E\uDF85":[{x:0,y:0,w:8,h:6}],"\uD83E\uDF86":[{x:0,y:0,w:8,h:7}],"\uD83E\uDF87":[{x:6,y:0,w:2,h:8}],"\uD83E\uDF88":[{x:5,y:0,w:3,h:8}],"\uD83E\uDF89":[{x:3,y:0,w:5,h:8}],"\uD83E\uDF8A":[{x:2,y:0,w:6,h:8}],"\uD83E\uDF8B":[{x:1,y:0,w:7,h:8}],"\uD83E\uDF95":[{x:0,y:0,w:2,h:2},{x:4,y:0,w:2,h:2},{x:2,y:2,w:2,h:2},{x:6,y:2,w:2,h:2},{x:0,y:4,w:2,h:2},{x:4,y:4,w:2,h:2},{x:2,y:6,w:2,h:2},{x:6,y:6,w:2,h:2}],"\uD83E\uDF96":[{x:2,y:0,w:2,h:2},{x:6,y:0,w:2,h:2},{x:0,y:2,w:2,h:2},{x:4,y:2,w:2,h:2},{x:2,y:4,w:2,h:2},{x:6,y:4,w:2,h:2},{x:0,y:6,w:2,h:2},{x:4,y:6,w:2,h:2}],"\uD83E\uDF97":[{x:0,y:2,w:8,h:2},{x:0,y:6,w:8,h:2}]};const h={"\u2591":[[1,0,0,0],[0,0,0,0],[0,0,1,0],[0,0,0,0]],"\u2592":[[1,0],[0,0],[0,1],[0,0]],"\u2593":[[0,1],[1,1],[1,0],[1,1]]};g.boxDrawingDefinitions={"\u2500":{1:"M0,.5 L1,.5"},"\u2501":{3:"M0,.5 L1,.5"},"\u2502":{1:"M.5,0 L.5,1"},"\u2503":{3:"M.5,0 L.5,1"},"\u250C":{1:"M0.5,1 L.5,.5 L1,.5"},"\u250F":{3:"M0.5,1 L.5,.5 L1,.5"},"\u2510":{1:"M0,.5 L.5,.5 L.5,1"},"\u2513":{3:"M0,.5 L.5,.5 L.5,1"},"\u2514":{1:"M.5,0 L.5,.5 L1,.5"},"\u2517":{3:"M.5,0 L.5,.5 L1,.5"},"\u2518":{1:"M.5,0 L.5,.5 L0,.5"},"\u251B":{3:"M.5,0 L.5,.5 L0,.5"},"\u251C":{1:"M.5,0 L.5,1 M.5,.5 L1,.5"},"\u2523":{3:"M.5,0 L.5,1 M.5,.5 L1,.5"},"\u2524":{1:"M.5,0 L.5,1 M.5,.5 L0,.5"},"\u252B":{3:"M.5,0 L.5,1 M.5,.5 L0,.5"},"\u252C":{1:"M0,.5 L1,.5 M.5,.5 L.5,1"},"\u2533":{3:"M0,.5 L1,.5 M.5,.5 L.5,1"},"\u2534":{1:"M0,.5 L1,.5 M.5,.5 L.5,0"},"\u253B":{3:"M0,.5 L1,.5 M.5,.5 L.5,0"},"\u253C":{1:"M0,.5 L1,.5 M.5,0 L.5,1"},"\u254B":{3:"M0,.5 L1,.5 M.5,0 L.5,1"},"\u2574":{1:"M.5,.5 L0,.5"},"\u2578":{3:"M.5,.5 L0,.5"},"\u2575":{1:"M.5,.5 L.5,0"},"\u2579":{3:"M.5,.5 L.5,0"},"\u2576":{1:"M.5,.5 L1,.5"},"\u257A":{3:"M.5,.5 L1,.5"},"\u2577":{1:"M.5,.5 L.5,1"},"\u257B":{3:"M.5,.5 L.5,1"},"\u2550":{1:(R,v)=>`M0,${0.5-v} L1,${0.5-v} M0,${0.5+v} L1,${0.5+v}`},"\u2551":{1:(R,v)=>`M${0.5-R},0 L${0.5-R},1 M${0.5+R},0 L${0.5+R},1`},"\u2552":{1:(R,v)=>`M.5,1 L.5,${0.5-v} L1,${0.5-v} M.5,${0.5+v} L1,${0.5+v}`},"\u2553":{1:(R,v)=>`M${0.5-R},1 L${0.5-R},.5 L1,.5 M${0.5+R},.5 L${0.5+R},1`},"\u2554":{1:(R,v)=>`M1,${0.5-v} L${0.5-R},${0.5-v} L${0.5-R},1 M1,${0.5+v} L${0.5+R},${0.5+v} L${0.5+R},1`},"\u2555":{1:(R,v)=>`M0,${0.5-v} L.5,${0.5-v} L.5,1 M0,${0.5+v} L.5,${0.5+v}`},"\u2556":{1:(R,v)=>`M${0.5+R},1 L${0.5+R},.5 L0,.5 M${0.5-R},.5 L${0.5-R},1`},"\u2557":{1:(R,v)=>`M0,${0.5+v} L${0.5-R},${0.5+v} L${0.5-R},1 M0,${0.5-v} L${0.5+R},${0.5-v} L${0.5+R},1`},"\u2558":{1:(R,v)=>`M.5,0 L.5,${0.5+v} L1,${0.5+v} M.5,${0.5-v} L1,${0.5-v}`},"\u2559":{1:(R,v)=>`M1,.5 L${0.5-R},.5 L${0.5-R},0 M${0.5+R},.5 L${0.5+R},0`},"\u255A":{1:(R,v)=>`M1,${0.5-v} L${0.5+R},${0.5-v} L${0.5+R},0 M1,${0.5+v} L${0.5-R},${0.5+v} L${0.5-R},0`},"\u255B":{1:(R,v)=>`M0,${0.5+v} L.5,${0.5+v} L.5,0 M0,${0.5-v} L.5,${0.5-v}`},"\u255C":{1:(R,v)=>`M0,.5 L${0.5+R},.5 L${0.5+R},0 M${0.5-R},.5 L${0.5-R},0`},"\u255D":{1:(R,v)=>`M0,${0.5-v} L${0.5-R},${0.5-v} L${0.5-R},0 M0,${0.5+v} L${0.5+R},${0.5+v} L${0.5+R},0`},"\u255E":{1:(R,v)=>`M.5,0 L.5,1 M.5,${0.5-v} L1,${0.5-v} M.5,${0.5+v} L1,${0.5+v}`},"\u255F":{1:(R,v)=>`M${0.5-R},0 L${0.5-R},1 M${0.5+R},0 L${0.5+R},1 M${0.5+R},.5 L1,.5`},"\u2560":{1:(R,v)=>`M${0.5-R},0 L${0.5-R},1 M1,${0.5+v} L${0.5+R},${0.5+v} L${0.5+R},1 M1,${0.5-v} L${0.5+R},${0.5-v} L${0.5+R},0`},"\u2561":{1:(R,v)=>`M.5,0 L.5,1 M0,${0.5-v} L.5,${0.5-v} M0,${0.5+v} L.5,${0.5+v}`},"\u2562":{1:(R,v)=>`M0,.5 L${0.5-R},.5 M${0.5-R},0 L${0.5-R},1 M${0.5+R},0 L${0.5+R},1`},"\u2563":{1:(R,v)=>`M${0.5+R},0 L${0.5+R},1 M0,${0.5+v} L${0.5-R},${0.5+v} L${0.5-R},1 M0,${0.5-v} L${0.5-R},${0.5-v} L${0.5-R},0`},"\u2564":{1:(R,v)=>`M0,${0.5-v} L1,${0.5-v} M0,${0.5+v} L1,${0.5+v} M.5,${0.5+v} L.5,1`},"\u2565":{1:(R,v)=>`M0,.5 L1,.5 M${0.5-R},.5 L${0.5-R},1 M${0.5+R},.5 L${0.5+R},1`},"\u2566":{1:(R,v)=>`M0,${0.5-v} L1,${0.5-v} M0,${0.5+v} L${0.5-R},${0.5+v} L${0.5-R},1 M1,${0.5+v} L${0.5+R},${0.5+v} L${0.5+R},1`},"\u2567":{1:(R,v)=>`M.5,0 L.5,${0.5-v} M0,${0.5-v} L1,${0.5-v} M0,${0.5+v} L1,${0.5+v}`},"\u2568":{1:(R,v)=>`M0,.5 L1,.5 M${0.5-R},.5 L${0.5-R},0 M${0.5+R},.5 L${0.5+R},0`},"\u2569":{1:(R,v)=>`M0,${0.5+v} L1,${0.5+v} M0,${0.5-v} L${0.5-R},${0.5-v} L${0.5-R},0 M1,${0.5-v} L${0.5+R},${0.5-v} L${0.5+R},0`},"\u256A":{1:(R,v)=>`M.5,0 L.5,1 M0,${0.5-v} L1,${0.5-v} M0,${0.5+v} L1,${0.5+v}`},"\u256B":{1:(R,v)=>`M0,.5 L1,.5 M${0.5-R},0 L${0.5-R},1 M${0.5+R},0 L${0.5+R},1`},"\u256C":{1:(R,v)=>`M0,${0.5+v} L${0.5-R},${0.5+v} L${0.5-R},1 M1,${0.5+v} L${0.5+R},${0.5+v} L${0.5+R},1 M0,${0.5-v} L${0.5-R},${0.5-v} L${0.5-R},0 M1,${0.5-v} L${0.5+R},${0.5-v} L${0.5+R},0`},"\u2571":{1:"M1,0 L0,1"},"\u2572":{1:"M0,0 L1,1"},"\u2573":{1:"M1,0 L0,1 M0,0 L1,1"},"\u257C":{1:"M.5,.5 L0,.5",3:"M.5,.5 L1,.5"},"\u257D":{1:"M.5,.5 L.5,0",3:"M.5,.5 L.5,1"},"\u257E":{1:"M.5,.5 L1,.5",3:"M.5,.5 L0,.5"},"\u257F":{1:"M.5,.5 L.5,1",3:"M.5,.5 L.5,0"},"\u250D":{1:"M.5,.5 L.5,1",3:"M.5,.5 L1,.5"},"\u250E":{1:"M.5,.5 L1,.5",3:"M.5,.5 L.5,1"},"\u2511":{1:"M.5,.5 L.5,1",3:"M.5,.5 L0,.5"},"\u2512":{1:"M.5,.5 L0,.5",3:"M.5,.5 L.5,1"},"\u2515":{1:"M.5,.5 L.5,0",3:"M.5,.5 L1,.5"},"\u2516":{1:"M.5,.5 L1,.5",3:"M.5,.5 L.5,0"},"\u2519":{1:"M.5,.5 L.5,0",3:"M.5,.5 L0,.5"},"\u251A":{1:"M.5,.5 L0,.5",3:"M.5,.5 L.5,0"},"\u251D":{1:"M.5,0 L.5,1",3:"M.5,.5 L1,.5"},"\u251E":{1:"M0.5,1 L.5,.5 L1,.5",3:"M.5,.5 L.5,0"},"\u251F":{1:"M.5,0 L.5,.5 L1,.5",3:"M.5,.5 L.5,1"},"\u2520":{1:"M.5,.5 L1,.5",3:"M.5,0 L.5,1"},"\u2521":{1:"M.5,.5 L.5,1",3:"M.5,0 L.5,.5 L1,.5"},"\u2522":{1:"M.5,.5 L.5,0",3:"M0.5,1 L.5,.5 L1,.5"},"\u2525":{1:"M.5,0 L.5,1",3:"M.5,.5 L0,.5"},"\u2526":{1:"M0,.5 L.5,.5 L.5,1",3:"M.5,.5 L.5,0"},"\u2527":{1:"M.5,0 L.5,.5 L0,.5",3:"M.5,.5 L.5,1"},"\u2528":{1:"M.5,.5 L0,.5",3:"M.5,0 L.5,1"},"\u2529":{1:"M.5,.5 L.5,1",3:"M.5,0 L.5,.5 L0,.5"},"\u252A":{1:"M.5,.5 L.5,0",3:"M0,.5 L.5,.5 L.5,1"},"\u252D":{1:"M0.5,1 L.5,.5 L1,.5",3:"M.5,.5 L0,.5"},"\u252E":{1:"M0,.5 L.5,.5 L.5,1",3:"M.5,.5 L1,.5"},"\u252F":{1:"M.5,.5 L.5,1",3:"M0,.5 L1,.5"},"\u2530":{1:"M0,.5 L1,.5",3:"M.5,.5 L.5,1"},"\u2531":{1:"M.5,.5 L1,.5",3:"M0,.5 L.5,.5 L.5,1"},"\u2532":{1:"M.5,.5 L0,.5",3:"M0.5,1 L.5,.5 L1,.5"},"\u2535":{1:"M.5,0 L.5,.5 L1,.5",3:"M.5,.5 L0,.5"},"\u2536":{1:"M.5,0 L.5,.5 L0,.5",3:"M.5,.5 L1,.5"},"\u2537":{1:"M.5,.5 L.5,0",3:"M0,.5 L1,.5"},"\u2538":{1:"M0,.5 L1,.5",3:"M.5,.5 L.5,0"},"\u2539":{1:"M.5,.5 L1,.5",3:"M.5,0 L.5,.5 L0,.5"},"\u253A":{1:"M.5,.5 L0,.5",3:"M.5,0 L.5,.5 L1,.5"},"\u253D":{1:"M.5,0 L.5,1 M.5,.5 L1,.5",3:"M.5,.5 L0,.5"},"\u253E":{1:"M.5,0 L.5,1 M.5,.5 L0,.5",3:"M.5,.5 L1,.5"},"\u253F":{1:"M.5,0 L.5,1",3:"M0,.5 L1,.5"},"\u2540":{1:"M0,.5 L1,.5 M.5,.5 L.5,1",3:"M.5,.5 L.5,0"},"\u2541":{1:"M.5,.5 L.5,0 M0,.5 L1,.5",3:"M.5,.5 L.5,1"},"\u2542":{1:"M0,.5 L1,.5",3:"M.5,0 L.5,1"},"\u2543":{1:"M0.5,1 L.5,.5 L1,.5",3:"M.5,0 L.5,.5 L0,.5"},"\u2544":{1:"M0,.5 L.5,.5 L.5,1",3:"M.5,0 L.5,.5 L1,.5"},"\u2545":{1:"M.5,0 L.5,.5 L1,.5",3:"M0,.5 L.5,.5 L.5,1"},"\u2546":{1:"M.5,0 L.5,.5 L0,.5",3:"M0.5,1 L.5,.5 L1,.5"},"\u2547":{1:"M.5,.5 L.5,1",3:"M.5,.5 L.5,0 M0,.5 L1,.5"},"\u2548":{1:"M.5,.5 L.5,0",3:"M0,.5 L1,.5 M.5,.5 L.5,1"},"\u2549":{1:"M.5,.5 L1,.5",3:"M.5,0 L.5,1 M.5,.5 L0,.5"},"\u254A":{1:"M.5,.5 L0,.5",3:"M.5,0 L.5,1 M.5,.5 L1,.5"},"\u254C":{1:"M.1,.5 L.4,.5 M.6,.5 L.9,.5"},"\u254D":{3:"M.1,.5 L.4,.5 M.6,.5 L.9,.5"},"\u2504":{1:"M.0667,.5 L.2667,.5 M.4,.5 L.6,.5 M.7333,.5 L.9333,.5"},"\u2505":{3:"M.0667,.5 L.2667,.5 M.4,.5 L.6,.5 M.7333,.5 L.9333,.5"},"\u2508":{1:"M.05,.5 L.2,.5 M.3,.5 L.45,.5 M.55,.5 L.7,.5 M.8,.5 L.95,.5"},"\u2509":{3:"M.05,.5 L.2,.5 M.3,.5 L.45,.5 M.55,.5 L.7,.5 M.8,.5 L.95,.5"},"\u254E":{1:"M.5,.1 L.5,.4 M.5,.6 L.5,.9"},"\u254F":{3:"M.5,.1 L.5,.4 M.5,.6 L.5,.9"},"\u2506":{1:"M.5,.0667 L.5,.2667 M.5,.4 L.5,.6 M.5,.7333 L.5,.9333"},"\u2507":{3:"M.5,.0667 L.5,.2667 M.5,.4 L.5,.6 M.5,.7333 L.5,.9333"},"\u250A":{1:"M.5,.05 L.5,.2 M.5,.3 L.5,.45 L.5,.55 M.5,.7 L.5,.95"},"\u250B":{3:"M.5,.05 L.5,.2 M.5,.3 L.5,.45 L.5,.55 M.5,.7 L.5,.95"},"\u256D":{1:(R,v)=>`M.5,1 L.5,${0.5+v/0.15*0.5} C.5,${0.5+v/0.15*0.5},.5,.5,1,.5`},"\u256E":{1:(R,v)=>`M.5,1 L.5,${0.5+v/0.15*0.5} C.5,${0.5+v/0.15*0.5},.5,.5,0,.5`},"\u256F":{1:(R,v)=>`M.5,0 L.5,${0.5-v/0.15*0.5} C.5,${0.5-v/0.15*0.5},.5,.5,0,.5`},"\u2570":{1:(R,v)=>`M.5,0 L.5,${0.5-v/0.15*0.5} C.5,${0.5-v/0.15*0.5},.5,.5,1,.5`}},g.powerlineDefinitions={"\uE0B0":{d:"M0,0 L1,.5 L0,1",type:0,rightPadding:2},"\uE0B1":{d:"M-1,-.5 L1,.5 L-1,1.5",type:1,leftPadding:1,rightPadding:1},"\uE0B2":{d:"M1,0 L0,.5 L1,1",type:0,leftPadding:2},"\uE0B3":{d:"M2,-.5 L0,.5 L2,1.5",type:1,leftPadding:1,rightPadding:1},"\uE0B4":{d:"M0,0 L0,1 C0.552,1,1,0.776,1,.5 C1,0.224,0.552,0,0,0",type:0,rightPadding:1},"\uE0B5":{d:"M.2,1 C.422,1,.8,.826,.78,.5 C.8,.174,0.422,0,.2,0",type:1,rightPadding:1},"\uE0B6":{d:"M1,0 L1,1 C0.448,1,0,0.776,0,.5 C0,0.224,0.448,0,1,0",type:0,leftPadding:1},"\uE0B7":{d:"M.8,1 C0.578,1,0.2,.826,.22,.5 C0.2,0.174,0.578,0,0.8,0",type:1,leftPadding:1},"\uE0B8":{d:"M-.5,-.5 L1.5,1.5 L-.5,1.5",type:0},"\uE0B9":{d:"M-.5,-.5 L1.5,1.5",type:1,leftPadding:1,rightPadding:1},"\uE0BA":{d:"M1.5,-.5 L-.5,1.5 L1.5,1.5",type:0},"\uE0BC":{d:"M1.5,-.5 L-.5,1.5 L-.5,-.5",type:0},"\uE0BD":{d:"M1.5,-.5 L-.5,1.5",type:1,leftPadding:1,rightPadding:1},"\uE0BE":{d:"M-.5,-.5 L1.5,1.5 L1.5,-.5",type:0}},g.powerlineDefinitions["\uE0BB"]=g.powerlineDefinitions["\uE0BD"],g.powerlineDefinitions["\uE0BF"]=g.powerlineDefinitions["\uE0B9"],g.tryDrawCustomChar=function(R,v,L,C,S,f,O,M){const m=g.blockElementDefinitions[v];if(m)return function(W,P,k,Q,V,K){for(let T=0;T<P.length;T++){const Y=P[T],J=V/8,_=K/8;W.fillRect(k+Y.x*J,Q+Y.y*_,Y.w*J,Y.h*_)}}(R,m,L,C,S,f),!0;const A=h[v];if(A)return function(W,P,k,Q,V,K){let T=E.get(P);T||(T=new Map,E.set(P,T));const Y=W.fillStyle;if(typeof Y!="string")throw new Error(`Unexpected fillStyle type "${Y}"`);let J=T.get(Y);if(!J){const _=P[0].length,N=P.length,I=document.createElement("canvas");I.width=_,I.height=N;const $=H.throwIfFalsy(I.getContext("2d")),w=new ImageData(_,N);let d,X,u,G;if(Y.startsWith("#"))d=parseInt(Y.slice(1,3),16),X=parseInt(Y.slice(3,5),16),u=parseInt(Y.slice(5,7),16),G=Y.length>7&&parseInt(Y.slice(7,9),16)||1;else{if(!Y.startsWith("rgba"))throw new Error(`Unexpected fillStyle color format "${Y}" when drawing pattern glyph`);[d,X,u,G]=Y.substring(5,Y.length-1).split(",").map((z)=>parseFloat(z))}for(let z=0;z<N;z++)for(let r=0;r<_;r++)w.data[4*(z*_+r)]=d,w.data[4*(z*_+r)+1]=X,w.data[4*(z*_+r)+2]=u,w.data[4*(z*_+r)+3]=P[z][r]*(255*G);$.putImageData(w,0,0),J=H.throwIfFalsy(W.createPattern(I,null)),T.set(Y,J)}W.fillStyle=J,W.fillRect(k,Q,V,K)}(R,A,L,C,S,f),!0;const Z=g.boxDrawingDefinitions[v];if(Z)return function(W,P,k,Q,V,K,T){W.strokeStyle=W.fillStyle;for(let[Y,J]of Object.entries(P)){let _;W.beginPath(),W.lineWidth=T*Number.parseInt(Y),_=typeof J=="function"?J(0.15,0.15/K*V):J;for(let N of _.split(" ")){const I=N[0],$=p[I];if(!$){console.error(`Could not find drawing instructions for "${I}"`);continue}const w=N.substring(1).split(",");w[0]&&w[1]&&$(W,B(w,V,K,k,Q,!0,T))}W.stroke(),W.closePath()}}(R,Z,L,C,S,f,M),!0;const F=g.powerlineDefinitions[v];return!!F&&(function(W,P,k,Q,V,K,T,Y){var J,_;const N=new Path2D;N.rect(k,Q,V,K),W.clip(N),W.beginPath();const I=T/12;W.lineWidth=Y*I;for(let $ of P.d.split(" ")){const w=$[0],d=p[w];if(!d){console.error(`Could not find drawing instructions for "${w}"`);continue}const X=$.substring(1).split(",");X[0]&&X[1]&&d(W,B(X,V,K,k,Q,!1,Y,((J=P.leftPadding)!==null&&J!==void 0?J:0)*(I/2),((_=P.rightPadding)!==null&&_!==void 0?_:0)*(I/2)))}P.type===1?(W.strokeStyle=W.fillStyle,W.stroke()):W.fill(),W.closePath()}(R,F,L,C,S,f,O,M),!0)};const E=new Map;function D(R,v,L=0){return Math.max(Math.min(R,v),L)}const p={C:(R,v)=>R.bezierCurveTo(v[0],v[1],v[2],v[3],v[4],v[5]),L:(R,v)=>R.lineTo(v[0],v[1]),M:(R,v)=>R.moveTo(v[0],v[1])};function B(R,v,L,C,S,f,O,M=0,m=0){const A=R.map((Z)=>parseFloat(Z)||parseInt(Z));if(A.length<2)throw new Error("Too few arguments for instruction");for(let Z=0;Z<A.length;Z+=2)A[Z]*=v-M*O-m*O,f&&A[Z]!==0&&(A[Z]=D(Math.round(A[Z]+0.5)-0.5,v,0)),A[Z]+=C+M*O;for(let Z=1;Z<A.length;Z+=2)A[Z]*=L,f&&A[Z]!==0&&(A[Z]=D(Math.round(A[Z]+0.5)-0.5,L,0)),A[Z]+=S;return A}},56:(U,g,b)=>{Object.defineProperty(g,"__esModule",{value:!0}),g.observeDevicePixelDimensions=void 0;const H=b(859);g.observeDevicePixelDimensions=function(h,E,D){let p=new E.ResizeObserver((B)=>{const R=B.find((C)=>C.target===h);if(!R)return;if(!("devicePixelContentBoxSize"in R))return p==null||p.disconnect(),void(p=void 0);const v=R.devicePixelContentBoxSize[0].inlineSize,L=R.devicePixelContentBoxSize[0].blockSize;v>0&&L>0&&D(v,L)});try{p.observe(h,{box:["device-pixel-content-box"]})}catch(B){p.disconnect(),p=void 0}return H.toDisposable(()=>p==null?void 0:p.disconnect())}},374:(U,g)=>{function b(H){return 57508<=H&&H<=57558}Object.defineProperty(g,"__esModule",{value:!0}),g.createRenderDimensions=g.excludeFromContrastRatioDemands=g.isRestrictedPowerlineGlyph=g.isPowerlineGlyph=g.throwIfFalsy=void 0,g.throwIfFalsy=function(H){if(!H)throw new Error("value must not be falsy");return H},g.isPowerlineGlyph=b,g.isRestrictedPowerlineGlyph=function(H){return 57520<=H&&H<=57527},g.excludeFromContrastRatioDemands=function(H){return b(H)||function(h){return 9472<=h&&h<=9631}(H)},g.createRenderDimensions=function(){return{css:{canvas:{width:0,height:0},cell:{width:0,height:0}},device:{canvas:{width:0,height:0},cell:{width:0,height:0},char:{width:0,height:0,left:0,top:0}}}}},296:(U,g)=>{Object.defineProperty(g,"__esModule",{value:!0}),g.createSelectionRenderModel=void 0;class b{constructor(){this.clear()}clear(){this.hasSelection=!1,this.columnSelectMode=!1,this.viewportStartRow=0,this.viewportEndRow=0,this.viewportCappedStartRow=0,this.viewportCappedEndRow=0,this.startCol=0,this.endCol=0,this.selectionStart=void 0,this.selectionEnd=void 0}update(H,h,E,D=!1){if(this.selectionStart=h,this.selectionEnd=E,!h||!E||h[0]===E[0]&&h[1]===E[1])return void this.clear();const p=h[1]-H.buffer.active.viewportY,B=E[1]-H.buffer.active.viewportY,R=Math.max(p,0),v=Math.min(B,H.rows-1);R>=H.rows||v<0?this.clear():(this.hasSelection=!0,this.columnSelectMode=D,this.viewportStartRow=p,this.viewportEndRow=B,this.viewportCappedStartRow=R,this.viewportCappedEndRow=v,this.startCol=h[0],this.endCol=E[0])}isCellSelected(H,h,E){return!!this.hasSelection&&(E-=H.buffer.active.viewportY,this.columnSelectMode?this.startCol<=this.endCol?h>=this.startCol&&E>=this.viewportCappedStartRow&&h<this.endCol&&E<=this.viewportCappedEndRow:h<this.startCol&&E>=this.viewportCappedStartRow&&h>=this.endCol&&E<=this.viewportCappedEndRow:E>this.viewportStartRow&&E<this.viewportEndRow||this.viewportStartRow===this.viewportEndRow&&E===this.viewportStartRow&&h>=this.startCol&&h<this.endCol||this.viewportStartRow<this.viewportEndRow&&E===this.viewportEndRow&&h<this.endCol||this.viewportStartRow<this.viewportEndRow&&E===this.viewportStartRow&&h>=this.startCol)}}g.createSelectionRenderModel=function(){return new b}},509:function(U,g,b){var H=this&&this.__decorate||function(F,W,P,k){var Q,V=arguments.length,K=V<3?W:k===null?k=Object.getOwnPropertyDescriptor(W,P):k;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")K=Reflect.decorate(F,W,P,k);else for(var T=F.length-1;T>=0;T--)(Q=F[T])&&(K=(V<3?Q(K):V>3?Q(W,P,K):Q(W,P))||K);return V>3&&K&&Object.defineProperty(W,P,K),K};Object.defineProperty(g,"__esModule",{value:!0}),g.TextureAtlas=void 0;const h=b(237),E=b(860),D=b(374),p=b(160),B=b(345),R=b(485),v=b(385),L=b(147),C=b(855),S=b(776),f={texturePage:0,texturePosition:{x:0,y:0},texturePositionClipSpace:{x:0,y:0},offset:{x:0,y:0},size:{x:0,y:0},sizeClipSpace:{x:0,y:0}};let O;class M{get pages(){return this._pages}constructor(F,W,P){this._document=F,this._config=W,this._unicodeService=P,this._didWarmUp=!1,this._cacheMap=new R.FourKeyMap,this._cacheMapCombined=new R.FourKeyMap,this._pages=[],this._activePages=[],this._workBoundingBox={top:0,left:0,bottom:0,right:0},this._workAttributeData=new L.AttributeData,this._textureSize=512,this._onAddTextureAtlasCanvas=new B.EventEmitter,this.onAddTextureAtlasCanvas=this._onAddTextureAtlasCanvas.event,this._onRemoveTextureAtlasCanvas=new B.EventEmitter,this.onRemoveTextureAtlasCanvas=this._onRemoveTextureAtlasCanvas.event,this._requestClearModel=!1,this._createNewPage(),this._tmpCanvas=Z(F,4*this._config.deviceCellWidth+4,this._config.deviceCellHeight+4),this._tmpCtx=D.throwIfFalsy(this._tmpCanvas.getContext("2d",{alpha:this._config.allowTransparency,willReadFrequently:!0}))}dispose(){for(let F of this.pages)F.canvas.remove();this._onAddTextureAtlasCanvas.dispose()}warmUp(){this._didWarmUp||(this._doWarmUp(),this._didWarmUp=!0)}_doWarmUp(){const F=new v.IdleTaskQueue;for(let W=33;W<126;W++)F.enqueue(()=>{if(!this._cacheMap.get(W,C.DEFAULT_COLOR,C.DEFAULT_COLOR,C.DEFAULT_EXT)){const P=this._drawToCache(W,C.DEFAULT_COLOR,C.DEFAULT_COLOR,C.DEFAULT_EXT);this._cacheMap.set(W,C.DEFAULT_COLOR,C.DEFAULT_COLOR,C.DEFAULT_EXT,P)}})}beginFrame(){return this._requestClearModel}clearTexture(){if(this._pages[0].currentRow.x!==0||this._pages[0].currentRow.y!==0){for(let F of this._pages)F.clear();this._cacheMap.clear(),this._cacheMapCombined.clear(),this._didWarmUp=!1}}_createNewPage(){if(M.maxAtlasPages&&this._pages.length>=Math.max(4,M.maxAtlasPages)){const W=this._pages.filter((Y)=>2*Y.canvas.width<=(M.maxTextureSize||4096)).sort((Y,J)=>J.canvas.width!==Y.canvas.width?J.canvas.width-Y.canvas.width:J.percentageUsed-Y.percentageUsed);let P=-1,k=0;for(let Y=0;Y<W.length;Y++)if(W[Y].canvas.width!==k)P=Y,k=W[Y].canvas.width;else if(Y-P==3)break;const Q=W.slice(P,P+4),V=Q.map((Y)=>Y.glyphs[0].texturePage).sort((Y,J)=>Y>J?1:-1),K=this.pages.length-Q.length,T=this._mergePages(Q,K);T.version++;for(let Y=V.length-1;Y>=0;Y--)this._deletePage(V[Y]);this.pages.push(T),this._requestClearModel=!0,this._onAddTextureAtlasCanvas.fire(T.canvas)}const F=new m(this._document,this._textureSize);return this._pages.push(F),this._activePages.push(F),this._onAddTextureAtlasCanvas.fire(F.canvas),F}_mergePages(F,W){const P=2*F[0].canvas.width,k=new m(this._document,P,F);for(let[Q,V]of F.entries()){const K=Q*V.canvas.width%P,T=Math.floor(Q/2)*V.canvas.height;k.ctx.drawImage(V.canvas,K,T);for(let J of V.glyphs)J.texturePage=W,J.sizeClipSpace.x=J.size.x/P,J.sizeClipSpace.y=J.size.y/P,J.texturePosition.x+=K,J.texturePosition.y+=T,J.texturePositionClipSpace.x=J.texturePosition.x/P,J.texturePositionClipSpace.y=J.texturePosition.y/P;this._onRemoveTextureAtlasCanvas.fire(V.canvas);const Y=this._activePages.indexOf(V);Y!==-1&&this._activePages.splice(Y,1)}return k}_deletePage(F){this._pages.splice(F,1);for(let W=F;W<this._pages.length;W++){const P=this._pages[W];for(let k of P.glyphs)k.texturePage--;P.version++}}getRasterizedGlyphCombinedChar(F,W,P,k,Q){return this._getFromCacheMap(this._cacheMapCombined,F,W,P,k,Q)}getRasterizedGlyph(F,W,P,k,Q){return this._getFromCacheMap(this._cacheMap,F,W,P,k,Q)}_getFromCacheMap(F,W,P,k,Q,V=!1){return O=F.get(W,P,k,Q),O||(O=this._drawToCache(W,P,k,Q,V),F.set(W,P,k,Q,O)),O}_getColorFromAnsiIndex(F){if(F>=this._config.colors.ansi.length)throw new Error("No color found for idx "+F);return this._config.colors.ansi[F]}_getBackgroundColor(F,W,P,k){if(this._config.allowTransparency)return p.NULL_COLOR;let Q;switch(F){case 16777216:case 33554432:Q=this._getColorFromAnsiIndex(W);break;case 50331648:const V=L.AttributeData.toColorRGB(W);Q=p.rgba.toColor(V[0],V[1],V[2]);break;default:Q=P?p.color.opaque(this._config.colors.foreground):this._config.colors.background}return Q}_getForegroundColor(F,W,P,k,Q,V,K,T,Y,J){const _=this._getMinimumContrastColor(F,W,P,k,Q,V,!1,Y,T,J);if(_)return _;let N;switch(Q){case 16777216:case 33554432:this._config.drawBoldTextInBrightColors&&Y&&V<8&&(V+=8),N=this._getColorFromAnsiIndex(V);break;case 50331648:const I=L.AttributeData.toColorRGB(V);N=p.rgba.toColor(I[0],I[1],I[2]);break;default:N=K?this._config.colors.background:this._config.colors.foreground}return this._config.allowTransparency&&(N=p.color.opaque(N)),T&&(N=p.color.multiplyOpacity(N,h.DIM_OPACITY)),N}_resolveBackgroundRgba(F,W,P){switch(F){case 16777216:case 33554432:return this._getColorFromAnsiIndex(W).rgba;case 50331648:return W<<8;default:return P?this._config.colors.foreground.rgba:this._config.colors.background.rgba}}_resolveForegroundRgba(F,W,P,k){switch(F){case 16777216:case 33554432:return this._config.drawBoldTextInBrightColors&&k&&W<8&&(W+=8),this._getColorFromAnsiIndex(W).rgba;case 50331648:return W<<8;default:return P?this._config.colors.background.rgba:this._config.colors.foreground.rgba}}_getMinimumContrastColor(F,W,P,k,Q,V,K,T,Y,J){if(this._config.minimumContrastRatio===1||J)return;const _=this._getContrastCache(Y),N=_.getColor(F,k);if(N!==void 0)return N||void 0;const I=this._resolveBackgroundRgba(W,P,K),$=this._resolveForegroundRgba(Q,V,K,T),w=p.rgba.ensureContrastRatio(I,$,this._config.minimumContrastRatio/(Y?2:1));if(!w)return void _.setColor(F,k,null);const d=p.rgba.toColor(w>>24&255,w>>16&255,w>>8&255);return _.setColor(F,k,d),d}_getContrastCache(F){return F?this._config.colors.halfContrastCache:this._config.colors.contrastCache}_drawToCache(F,W,P,k,Q=!1){const V=typeof F=="number"?String.fromCharCode(F):F,K=Math.min(this._config.deviceCellWidth*Math.max(V.length,2)+4,this._textureSize);this._tmpCanvas.width<K&&(this._tmpCanvas.width=K);const T=Math.min(this._config.deviceCellHeight+8,this._textureSize);if(this._tmpCanvas.height<T&&(this._tmpCanvas.height=T),this._tmpCtx.save(),this._workAttributeData.fg=P,this._workAttributeData.bg=W,this._workAttributeData.extended.ext=k,this._workAttributeData.isInvisible())return f;const Y=!!this._workAttributeData.isBold(),J=!!this._workAttributeData.isInverse(),_=!!this._workAttributeData.isDim(),N=!!this._workAttributeData.isItalic(),I=!!this._workAttributeData.isUnderline(),$=!!this._workAttributeData.isStrikethrough(),w=!!this._workAttributeData.isOverline();let d=this._workAttributeData.getFgColor(),X=this._workAttributeData.getFgColorMode(),u=this._workAttributeData.getBgColor(),G=this._workAttributeData.getBgColorMode();if(J){const l=d;d=u,u=l;const o=X;X=G,G=o}const z=this._getBackgroundColor(G,u,J,_);this._tmpCtx.globalCompositeOperation="copy",this._tmpCtx.fillStyle=z.css,this._tmpCtx.fillRect(0,0,this._tmpCanvas.width,this._tmpCanvas.height),this._tmpCtx.globalCompositeOperation="source-over";const r=Y?this._config.fontWeightBold:this._config.fontWeight,q=N?"italic":"";this._tmpCtx.font=`${q} ${r} ${this._config.fontSize*this._config.devicePixelRatio}px ${this._config.fontFamily}`,this._tmpCtx.textBaseline=h.TEXT_BASELINE;const g0=V.length===1&&D.isPowerlineGlyph(V.charCodeAt(0)),t=V.length===1&&D.isRestrictedPowerlineGlyph(V.charCodeAt(0)),R0=this._getForegroundColor(W,G,u,P,X,d,J,_,Y,D.excludeFromContrastRatioDemands(V.charCodeAt(0)));this._tmpCtx.fillStyle=R0.css;const e=t?0:4;let f0=!1;this._config.customGlyphs!==!1&&(f0=E.tryDrawCustomChar(this._tmpCtx,V,e,e,this._config.deviceCellWidth,this._config.deviceCellHeight,this._config.fontSize,this._config.devicePixelRatio));let n,A0=!g0;if(n=typeof F=="number"?this._unicodeService.wcwidth(F):this._unicodeService.getStringCellWidth(F),I){this._tmpCtx.save();const l=Math.max(1,Math.floor(this._config.fontSize*this._config.devicePixelRatio/15)),o=l%2==1?0.5:0;if(this._tmpCtx.lineWidth=l,this._workAttributeData.isUnderlineColorDefault())this._tmpCtx.strokeStyle=this._tmpCtx.fillStyle;else if(this._workAttributeData.isUnderlineColorRGB())A0=!1,this._tmpCtx.strokeStyle=`rgb(${L.AttributeData.toColorRGB(this._workAttributeData.getUnderlineColor()).join(",")})`;else{A0=!1;let E0=this._workAttributeData.getUnderlineColor();this._config.drawBoldTextInBrightColors&&this._workAttributeData.isBold()&&E0<8&&(E0+=8),this._tmpCtx.strokeStyle=this._getColorFromAnsiIndex(E0).css}this._tmpCtx.beginPath();const L0=e,b0=Math.ceil(e+this._config.deviceCharHeight)-o-(Q?2*l:0),h0=b0+l,H0=b0+2*l;for(let E0=0;E0<n;E0++){this._tmpCtx.save();const S0=L0+E0*this._config.deviceCellWidth,i=L0+(E0+1)*this._config.deviceCellWidth,T0=S0+this._config.deviceCellWidth/2;switch(this._workAttributeData.extended.underlineStyle){case 2:this._tmpCtx.moveTo(S0,b0),this._tmpCtx.lineTo(i,b0),this._tmpCtx.moveTo(S0,H0),this._tmpCtx.lineTo(i,H0);break;case 3:const W0=l<=1?H0:Math.ceil(e+this._config.deviceCharHeight-l/2)-o,Y0=l<=1?b0:Math.ceil(e+this._config.deviceCharHeight+l/2)-o,g1=new Path2D;g1.rect(S0,b0,this._config.deviceCellWidth,H0-b0),this._tmpCtx.clip(g1),this._tmpCtx.moveTo(S0-this._config.deviceCellWidth/2,h0),this._tmpCtx.bezierCurveTo(S0-this._config.deviceCellWidth/2,Y0,S0,Y0,S0,h0),this._tmpCtx.bezierCurveTo(S0,W0,T0,W0,T0,h0),this._tmpCtx.bezierCurveTo(T0,Y0,i,Y0,i,h0),this._tmpCtx.bezierCurveTo(i,W0,i+this._config.deviceCellWidth/2,W0,i+this._config.deviceCellWidth/2,h0);break;case 4:this._tmpCtx.setLineDash([Math.round(l),Math.round(l)]),this._tmpCtx.moveTo(S0,b0),this._tmpCtx.lineTo(i,b0);break;case 5:this._tmpCtx.setLineDash([4*this._config.devicePixelRatio,3*this._config.devicePixelRatio]),this._tmpCtx.moveTo(S0,b0),this._tmpCtx.lineTo(i,b0);break;default:this._tmpCtx.moveTo(S0,b0),this._tmpCtx.lineTo(i,b0)}this._tmpCtx.stroke(),this._tmpCtx.restore()}if(this._tmpCtx.restore(),!f0&&this._config.fontSize>=12&&!this._config.allowTransparency&&V!==" "){this._tmpCtx.save(),this._tmpCtx.textBaseline="alphabetic";const E0=this._tmpCtx.measureText(V);if(this._tmpCtx.restore(),"actualBoundingBoxDescent"in E0&&E0.actualBoundingBoxDescent>0){this._tmpCtx.save();const S0=new Path2D;S0.rect(L0,b0-Math.ceil(l/2),this._config.deviceCellWidth*n,H0-b0+Math.ceil(l/2)),this._tmpCtx.clip(S0),this._tmpCtx.lineWidth=3*this._config.devicePixelRatio,this._tmpCtx.strokeStyle=z.css,this._tmpCtx.strokeText(V,e,e+this._config.deviceCharHeight),this._tmpCtx.restore()}}}if(w){const l=Math.max(1,Math.floor(this._config.fontSize*this._config.devicePixelRatio/15)),o=l%2==1?0.5:0;this._tmpCtx.lineWidth=l,this._tmpCtx.strokeStyle=this._tmpCtx.fillStyle,this._tmpCtx.beginPath(),this._tmpCtx.moveTo(e,e+o),this._tmpCtx.lineTo(e+this._config.deviceCharWidth*n,e+o),this._tmpCtx.stroke()}if(f0||this._tmpCtx.fillText(V,e,e+this._config.deviceCharHeight),V==="_"&&!this._config.allowTransparency){let l=A(this._tmpCtx.getImageData(e,e,this._config.deviceCellWidth,this._config.deviceCellHeight),z,R0,A0);if(l)for(let o=1;o<=5&&(this._tmpCtx.save(),this._tmpCtx.fillStyle=z.css,this._tmpCtx.fillRect(0,0,this._tmpCanvas.width,this._tmpCanvas.height),this._tmpCtx.restore(),this._tmpCtx.fillText(V,e,e+this._config.deviceCharHeight-o),l=A(this._tmpCtx.getImageData(e,e,this._config.deviceCellWidth,this._config.deviceCellHeight),z,R0,A0),l);o++);}if($){const l=Math.max(1,Math.floor(this._config.fontSize*this._config.devicePixelRatio/10)),o=this._tmpCtx.lineWidth%2==1?0.5:0;this._tmpCtx.lineWidth=l,this._tmpCtx.strokeStyle=this._tmpCtx.fillStyle,this._tmpCtx.beginPath(),this._tmpCtx.moveTo(e,e+Math.floor(this._config.deviceCharHeight/2)-o),this._tmpCtx.lineTo(e+this._config.deviceCharWidth*n,e+Math.floor(this._config.deviceCharHeight/2)-o),this._tmpCtx.stroke()}this._tmpCtx.restore();const p0=this._tmpCtx.getImageData(0,0,this._tmpCanvas.width,this._tmpCanvas.height);let Z0;if(Z0=this._config.allowTransparency?function(l){for(let o=0;o<l.data.length;o+=4)if(l.data[o+3]>0)return!1;return!0}(p0):A(p0,z,R0,A0),Z0)return f;const v0=this._findGlyphBoundingBox(p0,this._workBoundingBox,K,t,f0,e);let s,a;for(;;){if(this._activePages.length===0){const l=this._createNewPage();s=l,a=l.currentRow,a.height=v0.size.y;break}s=this._activePages[this._activePages.length-1],a=s.currentRow;for(let l of this._activePages)v0.size.y<=l.currentRow.height&&(s=l,a=l.currentRow);for(let l=this._activePages.length-1;l>=0;l--)for(let o of this._activePages[l].fixedRows)o.height<=a.height&&v0.size.y<=o.height&&(s=this._activePages[l],a=o);if(a.y+v0.size.y>=s.canvas.height||a.height>v0.size.y+2){let l=!1;if(s.currentRow.y+s.currentRow.height+v0.size.y>=s.canvas.height){let o;for(let L0 of this._activePages)if(L0.currentRow.y+L0.currentRow.height+v0.size.y<L0.canvas.height){o=L0;break}if(o)s=o;else if(M.maxAtlasPages&&this._pages.length>=M.maxAtlasPages&&a.y+v0.size.y<=s.canvas.height&&a.height>=v0.size.y&&a.x+v0.size.x<=s.canvas.width)l=!0;else{const L0=this._createNewPage();s=L0,a=L0.currentRow,a.height=v0.size.y,l=!0}}l||(s.currentRow.height>0&&s.fixedRows.push(s.currentRow),a={x:0,y:s.currentRow.y+s.currentRow.height,height:v0.size.y},s.fixedRows.push(a),s.currentRow={x:0,y:a.y+a.height,height:0})}if(a.x+v0.size.x<=s.canvas.width)break;a===s.currentRow?(a.x=0,a.y+=a.height,a.height=0):s.fixedRows.splice(s.fixedRows.indexOf(a),1)}return v0.texturePage=this._pages.indexOf(s),v0.texturePosition.x=a.x,v0.texturePosition.y=a.y,v0.texturePositionClipSpace.x=a.x/s.canvas.width,v0.texturePositionClipSpace.y=a.y/s.canvas.height,v0.sizeClipSpace.x/=s.canvas.width,v0.sizeClipSpace.y/=s.canvas.height,a.height=Math.max(a.height,v0.size.y),a.x+=v0.size.x,s.ctx.putImageData(p0,v0.texturePosition.x-this._workBoundingBox.left,v0.texturePosition.y-this._workBoundingBox.top,this._workBoundingBox.left,this._workBoundingBox.top,v0.size.x,v0.size.y),s.addGlyph(v0),s.version++,v0}_findGlyphBoundingBox(F,W,P,k,Q,V){W.top=0;const K=k?this._config.deviceCellHeight:this._tmpCanvas.height,T=k?this._config.deviceCellWidth:P;let Y=!1;for(let J=0;J<K;J++){for(let _=0;_<T;_++){const N=J*this._tmpCanvas.width*4+4*_+3;if(F.data[N]!==0){W.top=J,Y=!0;break}}if(Y)break}W.left=0,Y=!1;for(let J=0;J<V+T;J++){for(let _=0;_<K;_++){const N=_*this._tmpCanvas.width*4+4*J+3;if(F.data[N]!==0){W.left=J,Y=!0;break}}if(Y)break}W.right=T,Y=!1;for(let J=V+T-1;J>=V;J--){for(let _=0;_<K;_++){const N=_*this._tmpCanvas.width*4+4*J+3;if(F.data[N]!==0){W.right=J,Y=!0;break}}if(Y)break}W.bottom=K,Y=!1;for(let J=K-1;J>=0;J--){for(let _=0;_<T;_++){const N=J*this._tmpCanvas.width*4+4*_+3;if(F.data[N]!==0){W.bottom=J,Y=!0;break}}if(Y)break}return{texturePage:0,texturePosition:{x:0,y:0},texturePositionClipSpace:{x:0,y:0},size:{x:W.right-W.left+1,y:W.bottom-W.top+1},sizeClipSpace:{x:W.right-W.left+1,y:W.bottom-W.top+1},offset:{x:-W.left+V+(k||Q?Math.floor((this._config.deviceCellWidth-this._config.deviceCharWidth)/2):0),y:-W.top+V+(k||Q?this._config.lineHeight===1?0:Math.round((this._config.deviceCellHeight-this._config.deviceCharHeight)/2):0)}}}}g.TextureAtlas=M,H([S.traceCall],M.prototype,"_drawToCache",null);class m{get percentageUsed(){return this._usedPixels/(this.canvas.width*this.canvas.height)}get glyphs(){return this._glyphs}addGlyph(F){this._glyphs.push(F),this._usedPixels+=F.size.x*F.size.y}constructor(F,W,P){if(this._usedPixels=0,this._glyphs=[],this.version=0,this.currentRow={x:0,y:0,height:0},this.fixedRows=[],P)for(let k of P)this._glyphs.push(...k.glyphs),this._usedPixels+=k._usedPixels;this.canvas=Z(F,W,W),this.ctx=D.throwIfFalsy(this.canvas.getContext("2d",{alpha:!0}))}clear(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.currentRow.x=0,this.currentRow.y=0,this.currentRow.height=0,this.fixedRows.length=0,this.version++}}function A(F,W,P,k){const Q=W.rgba>>>24,V=W.rgba>>>16&255,K=W.rgba>>>8&255,T=P.rgba>>>24,Y=P.rgba>>>16&255,J=P.rgba>>>8&255,_=Math.floor((Math.abs(Q-T)+Math.abs(V-Y)+Math.abs(K-J))/12);let N=!0;for(let I=0;I<F.data.length;I+=4)F.data[I]===Q&&F.data[I+1]===V&&F.data[I+2]===K||k&&Math.abs(F.data[I]-Q)+Math.abs(F.data[I+1]-V)+Math.abs(F.data[I+2]-K)<_?F.data[I+3]=0:N=!1;return N}function Z(F,W,P){const k=F.createElement("canvas");return k.width=W,k.height=P,k}},160:(U,g,b)=>{Object.defineProperty(g,"__esModule",{value:!0}),g.contrastRatio=g.toPaddedHex=g.rgba=g.rgb=g.css=g.color=g.channels=g.NULL_COLOR=void 0;const H=b(399);let h=0,E=0,D=0,p=0;var B,R,v,L,C;function S(O){const M=O.toString(16);return M.length<2?"0"+M:M}function f(O,M){return O<M?(M+0.05)/(O+0.05):(O+0.05)/(M+0.05)}g.NULL_COLOR={css:"#00000000",rgba:0},function(O){O.toCss=function(M,m,A,Z){return Z!==void 0?`#${S(M)}${S(m)}${S(A)}${S(Z)}`:`#${S(M)}${S(m)}${S(A)}`},O.toRgba=function(M,m,A,Z=255){return(M<<24|m<<16|A<<8|Z)>>>0}}(B||(g.channels=B={})),function(O){function M(m,A){return p=Math.round(255*A),[h,E,D]=C.toChannels(m.rgba),{css:B.toCss(h,E,D,p),rgba:B.toRgba(h,E,D,p)}}O.blend=function(m,A){if(p=(255&A.rgba)/255,p===1)return{css:A.css,rgba:A.rgba};const Z=A.rgba>>24&255,F=A.rgba>>16&255,W=A.rgba>>8&255,P=m.rgba>>24&255,k=m.rgba>>16&255,Q=m.rgba>>8&255;return h=P+Math.round((Z-P)*p),E=k+Math.round((F-k)*p),D=Q+Math.round((W-Q)*p),{css:B.toCss(h,E,D),rgba:B.toRgba(h,E,D)}},O.isOpaque=function(m){return(255&m.rgba)==255},O.ensureContrastRatio=function(m,A,Z){const F=C.ensureContrastRatio(m.rgba,A.rgba,Z);if(F)return C.toColor(F>>24&255,F>>16&255,F>>8&255)},O.opaque=function(m){const A=(255|m.rgba)>>>0;return[h,E,D]=C.toChannels(A),{css:B.toCss(h,E,D),rgba:A}},O.opacity=M,O.multiplyOpacity=function(m,A){return p=255&m.rgba,M(m,p*A/255)},O.toColorRGB=function(m){return[m.rgba>>24&255,m.rgba>>16&255,m.rgba>>8&255]}}(R||(g.color=R={})),function(O){let M,m;if(!H.isNode){const A=document.createElement("canvas");A.width=1,A.height=1;const Z=A.getContext("2d",{willReadFrequently:!0});Z&&(M=Z,M.globalCompositeOperation="copy",m=M.createLinearGradient(0,0,1,1))}O.toColor=function(A){if(A.match(/#[\da-f]{3,8}/i))switch(A.length){case 4:return h=parseInt(A.slice(1,2).repeat(2),16),E=parseInt(A.slice(2,3).repeat(2),16),D=parseInt(A.slice(3,4).repeat(2),16),C.toColor(h,E,D);case 5:return h=parseInt(A.slice(1,2).repeat(2),16),E=parseInt(A.slice(2,3).repeat(2),16),D=parseInt(A.slice(3,4).repeat(2),16),p=parseInt(A.slice(4,5).repeat(2),16),C.toColor(h,E,D,p);case 7:return{css:A,rgba:(parseInt(A.slice(1),16)<<8|255)>>>0};case 9:return{css:A,rgba:parseInt(A.slice(1),16)>>>0}}const Z=A.match(/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(,\s*(0|1|\d?\.(\d+))\s*)?\)/);if(Z)return h=parseInt(Z[1]),E=parseInt(Z[2]),D=parseInt(Z[3]),p=Math.round(255*(Z[5]===void 0?1:parseFloat(Z[5]))),C.toColor(h,E,D,p);if(!M||!m)throw new Error("css.toColor: Unsupported css format");if(M.fillStyle=m,M.fillStyle=A,typeof M.fillStyle!="string")throw new Error("css.toColor: Unsupported css format");if(M.fillRect(0,0,1,1),[h,E,D,p]=M.getImageData(0,0,1,1).data,p!==255)throw new Error("css.toColor: Unsupported css format");return{rgba:B.toRgba(h,E,D,p),css:A}}}(v||(g.css=v={})),function(O){function M(m,A,Z){const F=m/255,W=A/255,P=Z/255;return 0.2126*(F<=0.03928?F/12.92:Math.pow((F+0.055)/1.055,2.4))+0.7152*(W<=0.03928?W/12.92:Math.pow((W+0.055)/1.055,2.4))+0.0722*(P<=0.03928?P/12.92:Math.pow((P+0.055)/1.055,2.4))}O.relativeLuminance=function(m){return M(m>>16&255,m>>8&255,255&m)},O.relativeLuminance2=M}(L||(g.rgb=L={})),function(O){function M(A,Z,F){const W=A>>24&255,P=A>>16&255,k=A>>8&255;let Q=Z>>24&255,V=Z>>16&255,K=Z>>8&255,T=f(L.relativeLuminance2(Q,V,K),L.relativeLuminance2(W,P,k));for(;T<F&&(Q>0||V>0||K>0);)Q-=Math.max(0,Math.ceil(0.1*Q)),V-=Math.max(0,Math.ceil(0.1*V)),K-=Math.max(0,Math.ceil(0.1*K)),T=f(L.relativeLuminance2(Q,V,K),L.relativeLuminance2(W,P,k));return(Q<<24|V<<16|K<<8|255)>>>0}function m(A,Z,F){const W=A>>24&255,P=A>>16&255,k=A>>8&255;let Q=Z>>24&255,V=Z>>16&255,K=Z>>8&255,T=f(L.relativeLuminance2(Q,V,K),L.relativeLuminance2(W,P,k));for(;T<F&&(Q<255||V<255||K<255);)Q=Math.min(255,Q+Math.ceil(0.1*(255-Q))),V=Math.min(255,V+Math.ceil(0.1*(255-V))),K=Math.min(255,K+Math.ceil(0.1*(255-K))),T=f(L.relativeLuminance2(Q,V,K),L.relativeLuminance2(W,P,k));return(Q<<24|V<<16|K<<8|255)>>>0}O.ensureContrastRatio=function(A,Z,F){const W=L.relativeLuminance(A>>8),P=L.relativeLuminance(Z>>8);if(f(W,P)<F){if(P<W){const V=M(A,Z,F),K=f(W,L.relativeLuminance(V>>8));if(K<F){const T=m(A,Z,F);return K>f(W,L.relativeLuminance(T>>8))?V:T}return V}const k=m(A,Z,F),Q=f(W,L.relativeLuminance(k>>8));if(Q<F){const V=M(A,Z,F);return Q>f(W,L.relativeLuminance(V>>8))?k:V}return k}},O.reduceLuminance=M,O.increaseLuminance=m,O.toChannels=function(A){return[A>>24&255,A>>16&255,A>>8&255,255&A]},O.toColor=function(A,Z,F,W){return{css:B.toCss(A,Z,F,W),rgba:B.toRgba(A,Z,F,W)}}}(C||(g.rgba=C={})),g.toPaddedHex=S,g.contrastRatio=f},345:(U,g)=>{Object.defineProperty(g,"__esModule",{value:!0}),g.forwardEvent=g.EventEmitter=void 0,g.EventEmitter=class{constructor(){this._listeners=[],this._disposed=!1}get event(){return this._event||(this._event=(b)=>(this._listeners.push(b),{dispose:()=>{if(!this._disposed){for(let H=0;H<this._listeners.length;H++)if(this._listeners[H]===b)return void this._listeners.splice(H,1)}}})),this._event}fire(b,H){const h=[];for(let E=0;E<this._listeners.length;E++)h.push(this._listeners[E]);for(let E=0;E<h.length;E++)h[E].call(void 0,b,H)}dispose(){this.clearListeners(),this._disposed=!0}clearListeners(){this._listeners&&(this._listeners.length=0)}},g.forwardEvent=function(b,H){return b((h)=>H.fire(h))}},859:(U,g)=>{function b(H){for(let h of H)h.dispose();H.length=0}Object.defineProperty(g,"__esModule",{value:!0}),g.getDisposeArrayDisposable=g.disposeArray=g.toDisposable=g.MutableDisposable=g.Disposable=void 0,g.Disposable=class{constructor(){this._disposables=[],this._isDisposed=!1}dispose(){this._isDisposed=!0;for(let H of this._disposables)H.dispose();this._disposables.length=0}register(H){return this._disposables.push(H),H}unregister(H){const h=this._disposables.indexOf(H);h!==-1&&this._disposables.splice(h,1)}},g.MutableDisposable=class{constructor(){this._isDisposed=!1}get value(){return this._isDisposed?void 0:this._value}set value(H){var h;this._isDisposed||H===this._value||((h=this._value)===null||h===void 0||h.dispose(),this._value=H)}clear(){this.value=void 0}dispose(){var H;this._isDisposed=!0,(H=this._value)===null||H===void 0||H.dispose(),this._value=void 0}},g.toDisposable=function(H){return{dispose:H}},g.disposeArray=b,g.getDisposeArrayDisposable=function(H){return{dispose:()=>b(H)}}},485:(U,g)=>{Object.defineProperty(g,"__esModule",{value:!0}),g.FourKeyMap=g.TwoKeyMap=void 0;class b{constructor(){this._data={}}set(H,h,E){this._data[H]||(this._data[H]={}),this._data[H][h]=E}get(H,h){return this._data[H]?this._data[H][h]:void 0}clear(){this._data={}}}g.TwoKeyMap=b,g.FourKeyMap=class{constructor(){this._data=new b}set(H,h,E,D,p){this._data.get(H,h)||this._data.set(H,h,new b),this._data.get(H,h).set(E,D,p)}get(H,h,E,D){var p;return(p=this._data.get(H,h))===null||p===void 0?void 0:p.get(E,D)}clear(){this._data.clear()}}},399:(U,g)=>{Object.defineProperty(g,"__esModule",{value:!0}),g.isChromeOS=g.isLinux=g.isWindows=g.isIphone=g.isIpad=g.isMac=g.getSafariVersion=g.isSafari=g.isLegacyEdge=g.isFirefox=g.isNode=void 0,g.isNode=typeof navigator=="undefined";const b=g.isNode?"node":navigator.userAgent,H=g.isNode?"node":navigator.platform;g.isFirefox=b.includes("Firefox"),g.isLegacyEdge=b.includes("Edge"),g.isSafari=/^((?!chrome|android).)*safari/i.test(b),g.getSafariVersion=function(){if(!g.isSafari)return 0;const h=b.match(/Version\/(\d+)/);return h===null||h.length<2?0:parseInt(h[1])},g.isMac=["Macintosh","MacIntel","MacPPC","Mac68K"].includes(H),g.isIpad=H==="iPad",g.isIphone=H==="iPhone",g.isWindows=["Windows","Win16","Win32","WinCE"].includes(H),g.isLinux=H.indexOf("Linux")>=0,g.isChromeOS=/\bCrOS\b/.test(b)},385:(U,g,b)=>{Object.defineProperty(g,"__esModule",{value:!0}),g.DebouncedIdleTask=g.IdleTaskQueue=g.PriorityTaskQueue=void 0;const H=b(399);class h{constructor(){this._tasks=[],this._i=0}enqueue(D){this._tasks.push(D),this._start()}flush(){for(;this._i<this._tasks.length;)this._tasks[this._i]()||this._i++;this.clear()}clear(){this._idleCallback&&(this._cancelCallback(this._idleCallback),this._idleCallback=void 0),this._i=0,this._tasks.length=0}_start(){this._idleCallback||(this._idleCallback=this._requestCallback(this._process.bind(this)))}_process(D){this._idleCallback=void 0;let p=0,B=0,R=D.timeRemaining(),v=0;for(;this._i<this._tasks.length;){if(p=Date.now(),this._tasks[this._i]()||this._i++,p=Math.max(1,Date.now()-p),B=Math.max(p,B),v=D.timeRemaining(),1.5*B>v)return R-p<-20&&console.warn(`task queue exceeded allotted deadline by ${Math.abs(Math.round(R-p))}ms`),void this._start();R=v}this.clear()}}class E extends h{_requestCallback(D){return setTimeout(()=>D(this._createDeadline(16)))}_cancelCallback(D){clearTimeout(D)}_createDeadline(D){const p=Date.now()+D;return{timeRemaining:()=>Math.max(0,p-Date.now())}}}g.PriorityTaskQueue=E,g.IdleTaskQueue=!H.isNode&&"requestIdleCallback"in window?class extends h{_requestCallback(D){return requestIdleCallback(D)}_cancelCallback(D){cancelIdleCallback(D)}}:E,g.DebouncedIdleTask=class{constructor(){this._queue=new g.IdleTaskQueue}set(D){this._queue.clear(),this._queue.enqueue(D)}flush(){this._queue.flush()}}},147:(U,g)=>{Object.defineProperty(g,"__esModule",{value:!0}),g.ExtendedAttrs=g.AttributeData=void 0;class b{constructor(){this.fg=0,this.bg=0,this.extended=new H}static toColorRGB(h){return[h>>>16&255,h>>>8&255,255&h]}static fromColorRGB(h){return(255&h[0])<<16|(255&h[1])<<8|255&h[2]}clone(){const h=new b;return h.fg=this.fg,h.bg=this.bg,h.extended=this.extended.clone(),h}isInverse(){return 67108864&this.fg}isBold(){return 134217728&this.fg}isUnderline(){return this.hasExtendedAttrs()&&this.extended.underlineStyle!==0?1:268435456&this.fg}isBlink(){return 536870912&this.fg}isInvisible(){return 1073741824&this.fg}isItalic(){return 67108864&this.bg}isDim(){return 134217728&this.bg}isStrikethrough(){return 2147483648&this.fg}isProtected(){return 536870912&this.bg}isOverline(){return 1073741824&this.bg}getFgColorMode(){return 50331648&this.fg}getBgColorMode(){return 50331648&this.bg}isFgRGB(){return(50331648&this.fg)==50331648}isBgRGB(){return(50331648&this.bg)==50331648}isFgPalette(){return(50331648&this.fg)==16777216||(50331648&this.fg)==33554432}isBgPalette(){return(50331648&this.bg)==16777216||(50331648&this.bg)==33554432}isFgDefault(){return(50331648&this.fg)==0}isBgDefault(){return(50331648&this.bg)==0}isAttributeDefault(){return this.fg===0&&this.bg===0}getFgColor(){switch(50331648&this.fg){case 16777216:case 33554432:return 255&this.fg;case 50331648:return 16777215&this.fg;default:return-1}}getBgColor(){switch(50331648&this.bg){case 16777216:case 33554432:return 255&this.bg;case 50331648:return 16777215&this.bg;default:return-1}}hasExtendedAttrs(){return 268435456&this.bg}updateExtended(){this.extended.isEmpty()?this.bg&=-268435457:this.bg|=268435456}getUnderlineColor(){if(268435456&this.bg&&~this.extended.underlineColor)switch(50331648&this.extended.underlineColor){case 16777216:case 33554432:return 255&this.extended.underlineColor;case 50331648:return 16777215&this.extended.underlineColor;default:return this.getFgColor()}return this.getFgColor()}getUnderlineColorMode(){return 268435456&this.bg&&~this.extended.underlineColor?50331648&this.extended.underlineColor:this.getFgColorMode()}isUnderlineColorRGB(){return 268435456&this.bg&&~this.extended.underlineColor?(50331648&this.extended.underlineColor)==50331648:this.isFgRGB()}isUnderlineColorPalette(){return 268435456&this.bg&&~this.extended.underlineColor?(50331648&this.extended.underlineColor)==16777216||(50331648&this.extended.underlineColor)==33554432:this.isFgPalette()}isUnderlineColorDefault(){return 268435456&this.bg&&~this.extended.underlineColor?(50331648&this.extended.underlineColor)==0:this.isFgDefault()}getUnderlineStyle(){return 268435456&this.fg?268435456&this.bg?this.extended.underlineStyle:1:0}}g.AttributeData=b;class H{get ext(){return this._urlId?-469762049&this._ext|this.underlineStyle<<26:this._ext}set ext(h){this._ext=h}get underlineStyle(){return this._urlId?5:(469762048&this._ext)>>26}set underlineStyle(h){this._ext&=-469762049,this._ext|=h<<26&469762048}get underlineColor(){return 67108863&this._ext}set underlineColor(h){this._ext&=-67108864,this._ext|=67108863&h}get urlId(){return this._urlId}set urlId(h){this._urlId=h}constructor(h=0,E=0){this._ext=0,this._urlId=0,this._ext=h,this._urlId=E}clone(){return new H(this._ext,this._urlId)}isEmpty(){return this.underlineStyle===0&&this._urlId===0}}g.ExtendedAttrs=H},782:(U,g,b)=>{Object.defineProperty(g,"__esModule",{value:!0}),g.CellData=void 0;const H=b(133),h=b(855),E=b(147);class D extends E.AttributeData{constructor(){super(...arguments),this.content=0,this.fg=0,this.bg=0,this.extended=new E.ExtendedAttrs,this.combinedData=""}static fromCharData(p){const B=new D;return B.setFromCharData(p),B}isCombined(){return 2097152&this.content}getWidth(){return this.content>>22}getChars(){return 2097152&this.content?this.combinedData:2097151&this.content?H.stringFromCodePoint(2097151&this.content):""}getCode(){return this.isCombined()?this.combinedData.charCodeAt(this.combinedData.length-1):2097151&this.content}setFromCharData(p){this.fg=p[h.CHAR_DATA_ATTR_INDEX],this.bg=0;let B=!1;if(p[h.CHAR_DATA_CHAR_INDEX].length>2)B=!0;else if(p[h.CHAR_DATA_CHAR_INDEX].length===2){const R=p[h.CHAR_DATA_CHAR_INDEX].charCodeAt(0);if(55296<=R&&R<=56319){const v=p[h.CHAR_DATA_CHAR_INDEX].charCodeAt(1);56320<=v&&v<=57343?this.content=1024*(R-55296)+v-56320+65536|p[h.CHAR_DATA_WIDTH_INDEX]<<22:B=!0}else B=!0}else this.content=p[h.CHAR_DATA_CHAR_INDEX].charCodeAt(0)|p[h.CHAR_DATA_WIDTH_INDEX]<<22;B&&(this.combinedData=p[h.CHAR_DATA_CHAR_INDEX],this.content=2097152|p[h.CHAR_DATA_WIDTH_INDEX]<<22)}getAsCharData(){return[this.fg,this.getChars(),this.getWidth(),this.getCode()]}}g.CellData=D},855:(U,g)=>{Object.defineProperty(g,"__esModule",{value:!0}),g.WHITESPACE_CELL_CODE=g.WHITESPACE_CELL_WIDTH=g.WHITESPACE_CELL_CHAR=g.NULL_CELL_CODE=g.NULL_CELL_WIDTH=g.NULL_CELL_CHAR=g.CHAR_DATA_CODE_INDEX=g.CHAR_DATA_WIDTH_INDEX=g.CHAR_DATA_CHAR_INDEX=g.CHAR_DATA_ATTR_INDEX=g.DEFAULT_EXT=g.DEFAULT_ATTR=g.DEFAULT_COLOR=void 0,g.DEFAULT_COLOR=0,g.DEFAULT_ATTR=256|g.DEFAULT_COLOR<<9,g.DEFAULT_EXT=0,g.CHAR_DATA_ATTR_INDEX=0,g.CHAR_DATA_CHAR_INDEX=1,g.CHAR_DATA_WIDTH_INDEX=2,g.CHAR_DATA_CODE_INDEX=3,g.NULL_CELL_CHAR="",g.NULL_CELL_WIDTH=1,g.NULL_CELL_CODE=0,g.WHITESPACE_CELL_CHAR=" ",g.WHITESPACE_CELL_WIDTH=1,g.WHITESPACE_CELL_CODE=32},133:(U,g)=>{Object.defineProperty(g,"__esModule",{value:!0}),g.Utf8ToUtf32=g.StringToUtf32=g.utf32ToString=g.stringFromCodePoint=void 0,g.stringFromCodePoint=function(b){return b>65535?(b-=65536,String.fromCharCode(55296+(b>>10))+String.fromCharCode(b%1024+56320)):String.fromCharCode(b)},g.utf32ToString=function(b,H=0,h=b.length){let E="";for(let D=H;D<h;++D){let p=b[D];p>65535?(p-=65536,E+=String.fromCharCode(55296+(p>>10))+String.fromCharCode(p%1024+56320)):E+=String.fromCharCode(p)}return E},g.StringToUtf32=class{constructor(){this._interim=0}clear(){this._interim=0}decode(b,H){const h=b.length;if(!h)return 0;let E=0,D=0;if(this._interim){const p=b.charCodeAt(D++);56320<=p&&p<=57343?H[E++]=1024*(this._interim-55296)+p-56320+65536:(H[E++]=this._interim,H[E++]=p),this._interim=0}for(let p=D;p<h;++p){const B=b.charCodeAt(p);if(55296<=B&&B<=56319){if(++p>=h)return this._interim=B,E;const R=b.charCodeAt(p);56320<=R&&R<=57343?H[E++]=1024*(B-55296)+R-56320+65536:(H[E++]=B,H[E++]=R)}else B!==65279&&(H[E++]=B)}return E}},g.Utf8ToUtf32=class{constructor(){this.interim=new Uint8Array(3)}clear(){this.interim.fill(0)}decode(b,H){const h=b.length;if(!h)return 0;let E,D,p,B,R=0,v=0,L=0;if(this.interim[0]){let f=!1,O=this.interim[0];O&=(224&O)==192?31:(240&O)==224?15:7;let M,m=0;for(;(M=63&this.interim[++m])&&m<4;)O<<=6,O|=M;const A=(224&this.interim[0])==192?2:(240&this.interim[0])==224?3:4,Z=A-m;for(;L<Z;){if(L>=h)return 0;if(M=b[L++],(192&M)!=128){L--,f=!0;break}this.interim[m++]=M,O<<=6,O|=63&M}f||(A===2?O<128?L--:H[R++]=O:A===3?O<2048||O>=55296&&O<=57343||O===65279||(H[R++]=O):O<65536||O>1114111||(H[R++]=O)),this.interim.fill(0)}const C=h-4;let S=L;for(;S<h;){for(;!(!(S<C)||128&(E=b[S])||128&(D=b[S+1])||128&(p=b[S+2])||128&(B=b[S+3]));)H[R++]=E,H[R++]=D,H[R++]=p,H[R++]=B,S+=4;if(E=b[S++],E<128)H[R++]=E;else if((224&E)==192){if(S>=h)return this.interim[0]=E,R;if(D=b[S++],(192&D)!=128){S--;continue}if(v=(31&E)<<6|63&D,v<128){S--;continue}H[R++]=v}else if((240&E)==224){if(S>=h)return this.interim[0]=E,R;if(D=b[S++],(192&D)!=128){S--;continue}if(S>=h)return this.interim[0]=E,this.interim[1]=D,R;if(p=b[S++],(192&p)!=128){S--;continue}if(v=(15&E)<<12|(63&D)<<6|63&p,v<2048||v>=55296&&v<=57343||v===65279)continue;H[R++]=v}else if((248&E)==240){if(S>=h)return this.interim[0]=E,R;if(D=b[S++],(192&D)!=128){S--;continue}if(S>=h)return this.interim[0]=E,this.interim[1]=D,R;if(p=b[S++],(192&p)!=128){S--;continue}if(S>=h)return this.interim[0]=E,this.interim[1]=D,this.interim[2]=p,R;if(B=b[S++],(192&B)!=128){S--;continue}if(v=(7&E)<<18|(63&D)<<12|(63&p)<<6|63&B,v<65536||v>1114111)continue;H[R++]=v}}return R}}},776:function(U,g,b){var H=this&&this.__decorate||function(v,L,C,S){var f,O=arguments.length,M=O<3?L:S===null?S=Object.getOwnPropertyDescriptor(L,C):S;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")M=Reflect.decorate(v,L,C,S);else for(var m=v.length-1;m>=0;m--)(f=v[m])&&(M=(O<3?f(M):O>3?f(L,C,M):f(L,C))||M);return O>3&&M&&Object.defineProperty(L,C,M),M},h=this&&this.__param||function(v,L){return function(C,S){L(C,S,v)}};Object.defineProperty(g,"__esModule",{value:!0}),g.traceCall=g.setTraceLogger=g.LogService=void 0;const E=b(859),D=b(97),p={trace:D.LogLevelEnum.TRACE,debug:D.LogLevelEnum.DEBUG,info:D.LogLevelEnum.INFO,warn:D.LogLevelEnum.WARN,error:D.LogLevelEnum.ERROR,off:D.LogLevelEnum.OFF};let B,R=g.LogService=class extends E.Disposable{get logLevel(){return this._logLevel}constructor(v){super(),this._optionsService=v,this._logLevel=D.LogLevelEnum.OFF,this._updateLogLevel(),this.register(this._optionsService.onSpecificOptionChange("logLevel",()=>this._updateLogLevel())),B=this}_updateLogLevel(){this._logLevel=p[this._optionsService.rawOptions.logLevel]}_evalLazyOptionalParams(v){for(let L=0;L<v.length;L++)typeof v[L]=="function"&&(v[L]=v[L]())}_log(v,L,C){this._evalLazyOptionalParams(C),v.call(console,(this._optionsService.options.logger?"":"xterm.js: ")+L,...C)}trace(v,...L){var C,S;this._logLevel<=D.LogLevelEnum.TRACE&&this._log((S=(C=this._optionsService.options.logger)===null||C===void 0?void 0:C.trace.bind(this._optionsService.options.logger))!==null&&S!==void 0?S:console.log,v,L)}debug(v,...L){var C,S;this._logLevel<=D.LogLevelEnum.DEBUG&&this._log((S=(C=this._optionsService.options.logger)===null||C===void 0?void 0:C.debug.bind(this._optionsService.options.logger))!==null&&S!==void 0?S:console.log,v,L)}info(v,...L){var C,S;this._logLevel<=D.LogLevelEnum.INFO&&this._log((S=(C=this._optionsService.options.logger)===null||C===void 0?void 0:C.info.bind(this._optionsService.options.logger))!==null&&S!==void 0?S:console.info,v,L)}warn(v,...L){var C,S;this._logLevel<=D.LogLevelEnum.WARN&&this._log((S=(C=this._optionsService.options.logger)===null||C===void 0?void 0:C.warn.bind(this._optionsService.options.logger))!==null&&S!==void 0?S:console.warn,v,L)}error(v,...L){var C,S;this._logLevel<=D.LogLevelEnum.ERROR&&this._log((S=(C=this._optionsService.options.logger)===null||C===void 0?void 0:C.error.bind(this._optionsService.options.logger))!==null&&S!==void 0?S:console.error,v,L)}};g.LogService=R=H([h(0,D.IOptionsService)],R),g.setTraceLogger=function(v){B=v},g.traceCall=function(v,L,C){if(typeof C.value!="function")throw new Error("not supported");const S=C.value;C.value=function(...f){if(B.logLevel!==D.LogLevelEnum.TRACE)return S.apply(this,f);B.trace(`GlyphRenderer#${S.name}(${f.map((M)=>JSON.stringify(M)).join(", ")})`);const O=S.apply(this,f);return B.trace(`GlyphRenderer#${S.name} return`,O),O}}},726:(U,g)=>{Object.defineProperty(g,"__esModule",{value:!0}),g.createDecorator=g.getServiceDependencies=g.serviceRegistry=void 0;const b="di$target",H="di$dependencies";g.serviceRegistry=new Map,g.getServiceDependencies=function(h){return h[H]||[]},g.createDecorator=function(h){if(g.serviceRegistry.has(h))return g.serviceRegistry.get(h);const E=function(D,p,B){if(arguments.length!==3)throw new Error("@IServiceName-decorator can only be used to decorate a parameter");(function(R,v,L){v[b]===v?v[H].push({id:R,index:L}):(v[H]=[{id:R,index:L}],v[b]=v)})(E,D,B)};return E.toString=()=>h,g.serviceRegistry.set(h,E),E}},97:(U,g,b)=>{Object.defineProperty(g,"__esModule",{value:!0}),g.IDecorationService=g.IUnicodeService=g.IOscLinkService=g.IOptionsService=g.ILogService=g.LogLevelEnum=g.IInstantiationService=g.ICharsetService=g.ICoreService=g.ICoreMouseService=g.IBufferService=void 0;const H=b(726);var h;g.IBufferService=H.createDecorator("BufferService"),g.ICoreMouseService=H.createDecorator("CoreMouseService"),g.ICoreService=H.createDecorator("CoreService"),g.ICharsetService=H.createDecorator("CharsetService"),g.IInstantiationService=H.createDecorator("InstantiationService"),function(E){E[E.TRACE=0]="TRACE",E[E.DEBUG=1]="DEBUG",E[E.INFO=2]="INFO",E[E.WARN=3]="WARN",E[E.ERROR=4]="ERROR",E[E.OFF=5]="OFF"}(h||(g.LogLevelEnum=h={})),g.ILogService=H.createDecorator("LogService"),g.IOptionsService=H.createDecorator("OptionsService"),g.IOscLinkService=H.createDecorator("OscLinkService"),g.IUnicodeService=H.createDecorator("UnicodeService"),g.IDecorationService=H.createDecorator("DecorationService")}},x={};function j(U){var g=x[U];if(g!==void 0)return g.exports;var b=x[U]={exports:{}};return y[U].call(b.exports,b,b.exports,j),b.exports}var c={};return(()=>{var U=c;Object.defineProperty(U,"__esModule",{value:!0}),U.WebglAddon=void 0;const g=j(345),b=j(859),H=j(399),h=j(666),E=j(776);class D extends b.Disposable{constructor(p){if(H.isSafari&&H.getSafariVersion()<16)throw new Error("Webgl2 is only supported on Safari 16 and above");super(),this._preserveDrawingBuffer=p,this._onChangeTextureAtlas=this.register(new g.EventEmitter),this.onChangeTextureAtlas=this._onChangeTextureAtlas.event,this._onAddTextureAtlasCanvas=this.register(new g.EventEmitter),this.onAddTextureAtlasCanvas=this._onAddTextureAtlasCanvas.event,this._onRemoveTextureAtlasCanvas=this.register(new g.EventEmitter),this.onRemoveTextureAtlasCanvas=this._onRemoveTextureAtlasCanvas.event,this._onContextLoss=this.register(new g.EventEmitter),this.onContextLoss=this._onContextLoss.event}activate(p){const B=p._core;if(!p.element)return void this.register(B.onWillOpen(()=>this.activate(p)));this._terminal=p;const{coreService:R,optionsService:v}=B,L=B,C=L._renderService,S=L._characterJoinerService,f=L._charSizeService,O=L._coreBrowserService,M=L._decorationService,m=L._logService,A=L._themeService;E.setTraceLogger(m),this._renderer=this.register(new h.WebglRenderer(p,S,f,O,R,M,v,A,this._preserveDrawingBuffer)),this.register(g.forwardEvent(this._renderer.onContextLoss,this._onContextLoss)),this.register(g.forwardEvent(this._renderer.onChangeTextureAtlas,this._onChangeTextureAtlas)),this.register(g.forwardEvent(this._renderer.onAddTextureAtlasCanvas,this._onAddTextureAtlasCanvas)),this.register(g.forwardEvent(this._renderer.onRemoveTextureAtlasCanvas,this._onRemoveTextureAtlasCanvas)),C.setRenderer(this._renderer),this.register(b.toDisposable(()=>{const Z=this._terminal._core._renderService;Z.setRenderer(this._terminal._core._createRenderer()),Z.handleResize(p.cols,p.rows)}))}get textureAtlas(){var p;return(p=this._renderer)===null||p===void 0?void 0:p.textureAtlas}clearTextureAtlas(){var p;(p=this._renderer)===null||p===void 0||p.clearTextureAtlas()}}U.WebglAddon=D})(),c})())});var L1=u0((J0,y0)=>{(function(y,x){typeof J0=="object"&&typeof y0=="object"?y0.exports=x():typeof define=="function"&&define.amd?define([],x):typeof J0=="object"?J0.FitAddon=x():y.FitAddon=x()})(self,()=>(()=>{var y={};return(()=>{var x=y;Object.defineProperty(x,"__esModule",{value:!0}),x.FitAddon=void 0,x.FitAddon=class{activate(j){this._terminal=j}dispose(){}fit(){const j=this.proposeDimensions();if(!j||!this._terminal||isNaN(j.cols)||isNaN(j.rows))return;const c=this._terminal._core;this._terminal.rows===j.rows&&this._terminal.cols===j.cols||(c._renderService.clear(),this._terminal.resize(j.cols,j.rows))}proposeDimensions(){if(!this._terminal)return;if(!this._terminal.element||!this._terminal.element.parentElement)return;const j=this._terminal._core,c=j._renderService.dimensions;if(c.css.cell.width===0||c.css.cell.height===0)return;const U=this._terminal.options.scrollback===0?0:j.viewport.scrollBarWidth,g=window.getComputedStyle(this._terminal.element.parentElement),b=parseInt(g.getPropertyValue("height")),H=Math.max(0,parseInt(g.getPropertyValue("width"))),h=window.getComputedStyle(this._terminal.element),E=b-(parseInt(h.getPropertyValue("padding-top"))+parseInt(h.getPropertyValue("padding-bottom"))),D=H-(parseInt(h.getPropertyValue("padding-right"))+parseInt(h.getPropertyValue("padding-left")))-U;return{cols:Math.max(2,Math.floor(D/c.css.cell.width)),rows:Math.max(1,Math.floor(E/c.css.cell.height))}}}})(),y})())});import{Text as e0} from"@blockcode/ui";import{Keys as n2} from"@blockcode/core";import{Text as r2} from"@blockcode/ui";import{jsx as t2} from"preact/jsx-runtime";var s2=/Mac/i.test(navigator.platform||navigator.userAgent);import{useLayout as s1} from"@blockcode/core";import{ContextMenu as i1} from"@blockcode/ui";import{CodeEditor as t1} from"@blockcode/code-editor";import{useLocale as o1} from"@blockcode/core";import{ComingSoon as r1} from"@blockcode/ui";function C0(y){const x=globalThis.document,j=x.createElement("style");j.appendChild(x.createTextNode(y)),x.head.append(j)}C0(".chtJGa_package-list{background:var(--ui-white);border-right:1px solid var(--ui-black-transparent);border-radius:inherit;flex-direction:column;display:flex;position:relative}.chtJGa_list-wrapper{width:60px}.chtJGa_package-button{z-index:var(--z-index-extension-button);background:var(--motion-primary);box-sizing:content-box;border-bottom-left-radius:inherit;height:3.25rem;position:absolute;bottom:-1px;left:-1px;right:-1px}.chtJGa_package-button:before{--fade-out-distance:15px;content:\"\";top:calc(calc(-1*var(--fade-out-distance)));height:var(--fade-out-distance);background:linear-gradient(#0000,#00000026);position:absolute;left:0;right:0}.chtJGa_button{cursor:pointer;background:0 0;border:none;outline:none;width:100%;height:100%}.chtJGa_button-icon{width:1.75rem;height:1.75rem}");var B0={packageButton:"chtJGa_package-button",buttonIcon:"chtJGa_button-icon",button:"chtJGa_button",listWrapper:"chtJGa_list-wrapper",packageList:"chtJGa_package-list"};var S1="./assets/icon-add-package-5a8496eef1cfaf22.svg";import{jsx as O0} from"preact/jsx-runtime";function U0(){const{getText:y}=o1();return O0("div",{className:B0.packageList,children:[O0("div",{className:B0.listWrapper}),O0(r1,{placement:"right",children:O0("div",{className:B0.packageButton,children:O0("button",{className:B0.button,title:y("micropython.packageList.addPackage","Add"),children:O0("img",{className:B0.buttonIcon,src:S1,title:"Add"})})})})]})}C0(".MlHfAq_code-editor-wrapper{flex-direction:row;width:100%;height:100%;display:flex}");var C1={codeEditorWrapper:"MlHfAq_code-editor-wrapper"};import{jsx as X0} from"preact/jsx-runtime";function x0(){const{setSplash:y}=s1(),x=()=>{y(!1)};return X0("div",{className:C1.codeEditorWrapper,children:[X0(U0,{}),X0(i1,{children:X0(t1,{onSetup:x})})]})}import{useRef as v2,useEffect as g2} from"preact/hooks";import{useEditor as R2} from"@blockcode/core";import{classNames as S2} from"@blockcode/ui";var A1=K0(E1(),1),H1=K0(b1(),1),D1=K0(L1(),1);var G0={cursor:"#f8f8f8",foreground:"#f8f8f8",background:"#2d2e2c",selection:"#5da5d5",black:"#1e1e1d",brightblack:"#262625",red:"#ce5c5c",brightred:"#ff7272",green:"#5bcc5b",brightgreen:"#72ff72",yellow:"#cccc5b",brightyellow:"#ffff72",blue:"#5d5dd3",brightblue:"#7279ff",magenta:"#bc5ed1",brightmagenta:"#e572ff",cyan:"#5da5d5",brightcyan:"#72f0ff",white:"#f8f8f8",brightwhite:"#ffffff"};C0(".xterm{cursor:text;-webkit-user-select:none;-ms-user-select:none;user-select:none;position:relative}.xterm.focus,.xterm:focus{outline:none}.xterm .xterm-helpers{z-index:5;position:absolute;top:0}.xterm .xterm-helper-textarea{opacity:0;z-index:-5;white-space:nowrap;resize:none;border:0;width:0;height:0;margin:0;padding:0;position:absolute;top:0;left:-9999em;overflow:hidden}.xterm .composition-view{color:#fff;white-space:nowrap;z-index:1;background:#000;display:none;position:absolute}.xterm .composition-view.active{display:block}.xterm .xterm-viewport{cursor:default;background-color:#000;position:absolute;inset:0;overflow-y:scroll}.xterm .xterm-screen{position:relative}.xterm .xterm-screen canvas{position:absolute;top:0;left:0}.xterm .xterm-scroll-area{visibility:hidden}.xterm-char-measure-element{visibility:hidden;line-height:normal;display:inline-block;position:absolute;top:0;left:-9999em}.xterm.enable-mouse-events{cursor:default}.xterm.xterm-cursor-pointer,.xterm .xterm-cursor-pointer{cursor:pointer}.xterm.column-select.focus{cursor:crosshair}.xterm .xterm-accessibility,.xterm .xterm-message{z-index:10;color:#0000;pointer-events:none;position:absolute;inset:0}.xterm .live-region{width:1px;height:1px;position:absolute;left:-9999px;overflow:hidden}.xterm-dim{opacity:1!important}.xterm-underline-1{text-decoration:underline}.xterm-underline-2{text-decoration:underline double}.xterm-underline-3{text-decoration:underline wavy}.xterm-underline-4{text-decoration:underline dotted}.xterm-underline-5{text-decoration:underline dashed}.xterm-overline{text-decoration:overline}.xterm-overline.xterm-underline-1{text-decoration:underline overline}.xterm-overline.xterm-underline-2{text-decoration:overline double underline}.xterm-overline.xterm-underline-3{text-decoration:overline wavy underline}.xterm-overline.xterm-underline-4{text-decoration:overline dotted underline}.xterm-overline.xterm-underline-5{text-decoration:overline dashed underline}.xterm-strikethrough{text-decoration:line-through}.xterm-screen .xterm-decoration-container .xterm-decoration{z-index:6;position:absolute}.xterm-screen .xterm-decoration-container .xterm-decoration.xterm-decoration-top-layer{z-index:7}.xterm-decoration-overview-ruler{z-index:8;pointer-events:none;position:absolute;top:0;right:0}.xterm-decoration-top{z-index:2;position:relative}");var h1=/Mac/i.test(navigator.platform||navigator.userAgent),e1=/Win/i.test(navigator.platform||navigator.userAgent);function I0(y){const x=new A1.Terminal({convertEol:!0,cursorBlink:!0,cursorInactiveStyle:"none",fontFamily:'"Cascadia Code", Menlo, monospace',fontSize:12,lineHeight:1.2,windowsMode:e1,macOptionIsMeta:h1,macOptionClickForcesSelection:h1,theme:G0});x.open(y),y.style.background=G0.background;const j=new H1.WebglAddon;x.loadAddon(j),j.onContextLoss(()=>j.dispose());const c=new D1.FitAddon;return x.fit=()=>c.fit(),x.loadAddon(c),x.onWriteParsed(()=>x.fit()),x.element.addEventListener("focusin",()=>x.fit()),window.addEventListener("resize",()=>x.fit()),x}C0("._9aME7W_terminal-wrapper{border-radius:inherit;flex:1;padding:2px;display:flex;position:relative;overflow:hidden}._9aME7W_terminal-wrapper .xterm{position:absolute}");var f1={terminalWrapper:"_9aME7W_terminal-wrapper"};import{jsx as C2} from"preact/jsx-runtime";function j0({className:y}){const x=v2(null),{device:j}=R2();if(x.term)if(j){if(x.term.disabled=!1,j.serial.listenerCount("data")===0)j.serial.on("data",(c)=>x.term.write(c)),x.term.onData((c)=>j.writeAndReadUntil(c)),x.term.clear()}else x.term.disabled=!0,x.term._core._onData.clearListeners();return g2(()=>{if(x.current)x.term=I0(x.current),x.term.disabled=!0,x.term.element.addEventListener("focusin",()=>{if(x.term.disabled)x.term.blur()}),x.resizeObserver=new window.ResizeObserver(()=>x.term.fit(!0)),x.resizeObserver.observe(x.current);return()=>{if(x.term)x.resizeObserver.unobserve(x.current),x.term=null}},[x]),C2("div",{className:S2(f1.terminalWrapper,y),ref:x})}import{useLocale as m2,useEditor as F2} from"@blockcode/core";import{classNames as Y1} from"@blockcode/ui";import{useLocale as A2,useEditor as H2} from"@blockcode/core";import{Serial as E2,sleep as q0} from"@blockcode/core";var p1=function(y){return y.replaceAll("\r\n","\n")},m1=function(y){return y.slice(2,-3)},b2="\x01",F1="\x02",w0="\x03",$0="\x04",c0=128;class d0{constructor(){this.serial=null,this._connected=!1,this._encoder=new TextEncoder,this._decoder=new TextDecoder}requestPort(y=[]){return navigator.serial.requestPort({filters:y}).then((x)=>{if(x._serial){this.serial=x._serial,this.serial.on("connect",()=>this._connected=!0),this.serial.on("disconnect",()=>this._connected=!1);return}this.serial=new E2(x),this.serial.on("connect",()=>this._connected=!0),this.serial.on("disconnect",()=>this._connected=!1)})}connect(y={}){return new Promise((x,j)=>{if(this.serial)this.serial.open({baudRate:115200,...y}).then(()=>x()).catch((c)=>{if(c.name==="InvalidStateError")this._connected=!0,x();j(c)});else j(new Error("No device specified"))})}get connected(){return this._connected}disconnect(){return this.serial.close()}get deviceInfo(){return this.serial.getInfo()}readUntil(y,x){return new Promise((j)=>{let c="";const U=async(g)=>{if(g){if(c+=this._decoder.decode(g),x)x(g)}if(c.indexOf(y)!==-1)this.serial.off("data",U),j(c)};this.serial.on("data",U)})}writeAndReadUntil(y,x,j){return new Promise(async(c)=>{if(x)this.readUntil(x,j).then(c);for(let U=0;U<y.length;U+=c0)await this.serial.write(y.slice(U,U+c0)),await q0(10);if(!x)c()})}async getPrompt(){return await q0(150),await this.stop(),await q0(150),await this.writeAndReadUntil(`\r${w0}${F1}`,"\r\n>>>")}async enterRawRepl(){return await this.writeAndReadUntil(b2,"raw REPL; CTRL-B to exit")}async exitRawRepl(){return await this.writeAndReadUntil(F1,"\r\n>>>")}async execRaw(y,x){return await this.writeAndReadUntil(y),await this.writeAndReadUntil($0,`${$0}>`,x)}async execFile(y,x){if(x=x||function(){},y){await this.enterRawRepl();const j=await this.execRaw(y,x);return await this.exitRawRepl(),j}return Promise.reject()}async run(y,x){return x=x||function(){},new Promise(async(j,c)=>{if(this.rejectRun)this.rejectRun(new Error("re-run")),this.rejectRun=null;this.rejectRun=c;try{await this.enterRawRepl();const U=await this.execRaw(y||"#",x);return await this.exitRawRepl(),j(U)}catch(U){c(U),this.rejectRun=null}})}async eval(y){await this.serial.write(y)}async stop(){if(this.rejectRun)this.rejectRun(new Error("pre stop")),this.rejectRun=null;await this.serial.write(w0)}async reset(){if(this.rejectRun)this.rejectRun(new Error("pre reset")),this.rejectRun=null;await this.serial.write(w0),await this.serial.write($0)}async exists(y){y=y||"";let x="";x+="try:\n",x+=`  f = open('${y}', 'r')\n`,x+="  print(1)\n",x+="except OSError:\n",x+="  print(0)\n",await this.enterRawRepl();const j=await this.execRaw(x);return await this.exitRawRepl(),j[2]=="1"}async listdir(y){y=y||"";let x="";x+="import os\n",x+="try:\n",x+=`  print(os.listdir('${y}'))\n`,x+="except OSError:\n",x+="  print([])\n",await this.enterRawRepl();let j=await this.execRaw(x);return await this.exitRawRepl(),j=m1(j),j=j.replace(/'/g,'"'),JSON.parse(j)}async mkdir(y){if(y){await this.enterRawRepl();const x=await this.execRaw(`import os\nos.mkdir('${y}')`);return await this.exitRawRepl(),x}return Promise.reject(new Error("Path to file was not specified"))}async rmdir(y){if(y){let x="";x+="import os\n",x+="try:\n",x+=`  os.rmdir("${y}")\n`,x+="except OSError:\n",x+="  print(0)\n",await this.enterRawRepl();const j=await this.execRaw(x);return await this.exitRawRepl(),j}return Promise.reject(new Error("Path to file was not specified"))}async remove(y){if(y){let x="";x+="import os\n",x+="try:\n",x+=`  os.remove("${y}")\n`,x+="except OSError:\n",x+="  print(0)\n",await this.enterRawRepl();const j=await this.execRaw(x);return this.exitRawRepl(),j}return Promise.reject(new Error("Path to file was not specified"))}async rename(y,x){if(y&&x){await this.enterRawRepl();const j=await this.execRaw(`import os\nos.rename('${y}', '${x}')`);return this.exitRawRepl(),j}return Promise.reject(new Error("Path to file was not specified"))}async cat(y){if(y){await this.enterRawRepl();let x=await this.execRaw(`with open('${y}','r') as f:\n while 1:\n  b=f.read(256)\n  if not b:break\n  print(b,end='')`);return await this.exitRawRepl(),x=m1(x),p1(x)}return Promise.reject(new Error("Path to file was not specified"))}async checkHash(y,x){if(y){let j="";j+="import os\n",j+="import hashlib\n",j+="import binascii\n",j+="hash = hashlib.sha256()\n",j+=`with open('${y}', 'rb') as f:\n`,j+="  while True:\n",j+=`    c = f.read(${c0})\n`,j+="    if not c: break\n",j+="    hash.update(c)\n",j+="print(binascii.hexlify(hash.digest()).decode())\n",await this.enterRawRepl();let c=await this.execRaw(j);return await this.exitRawRepl(),c=c.slice(2,c.indexOf("\n")-1),x===c}return Promise.reject(new Error("Path to file was not specified"))}async put(y,x,j){if(!x){Promise.reject(new Error("Must specify content and destination path"));return}let c;if(typeof y==="string")c=this._encoder.encode(p1(y));else if(y instanceof ArrayBuffer)c=new Uint8Array(y);else if(y instanceof Uint8Array)c=y;else Promise.reject(new Error(`${y} must string, Uint8Array or ArrayBuffer`));if(j=j||function(){},await this.exists(x)){const h=await crypto.subtle.digest("SHA-256",c),E=Array.from(new Uint8Array(h)).map((D)=>D.toString(16).padStart(2,"0")).join("");if(await this.checkHash(x,E)){j(100);return}}const U=Array.from(c).map((h)=>h.toString(16).padStart(2,"0"));let g="";g+=await this.enterRawRepl();let b=x.split("/");if(b.pop(),b.length>0){g+=await this.execRaw("import os");const h=[];b.reduce((E,D)=>{if(D===""||E!==""&&E.at(-1)!=="/")E+="/";if(E+=D,E!=="/")h.push(E);return E},"");for(let E of h)g+=await this.execRaw(`os.mkdir('${E}')`)}g+=await this.execRaw(`f=open('${x}','w')\nw=f.write`);const H=48;for(let h=0;h<U.length;h+=H){let E=`w(bytes([${U.slice(h,h+H).map((D)=>`0x${D}`).join(",")}]))`;g+=await this.execRaw(E),j(parseInt(h/U.length*100))}return g+=await this.execRaw("f.close()"),g+=await this.exitRawRepl(),j(100),g}}var Z1=[{usbVendorId:12346},{usbVendorId:11914}];C0(".bbJK1q_status-icon{cursor:pointer;height:1.25rem}.bbJK1q_status-text{flex:1}");var B1={statusIcon:"bbJK1q_status-icon",statusText:"bbJK1q_status-text"};var O1="./assets/status-not-ready-0f9d57eed7fe9b83.svg";var M1="./assets/status-ready-038751c506ee8838.svg";import{jsx as D2} from"preact/jsx-runtime";function l0(){const{getText:y}=A2(),{device:x,setDevice:j}=H2(),c=x?y("micropython.deviceManager.ready","Ready"):y("micropython.deviceManager.notReady","Not Ready"),U=async()=>{if(x){try{await x.disconnect()}catch(g){console.error(g)}j(null)}else{const g=new d0;try{await g.requestPort(Z1),await g.connect(),await g.stop(),j(g)}catch(H){console.error(H)}const b=()=>setTimeout(async()=>{if(g.connected)b();else j(null)},1000);b()}};return D2("img",{className:B1.statusIcon,src:x?M1:O1,title:c,onClick:U})}C0(".e8OLkq_toolbar-wrapper{height:var(--tool-bar-height);padding:var(--space)0;flex-shrink:0;justify-content:space-between;align-items:center;display:flex}.e8OLkq_run-code,.e8OLkq_stop-all{user-select:none;cursor:pointer;border:0;border-radius:.25rem;width:2rem;height:2rem;padding:.375rem}.e8OLkq_run-code img,.e8OLkq_stop-all img{width:100%;height:100%}.e8OLkq_run-code:hover,.e8OLkq_stop-all:hover{background:var(--motion-light-transparent)}.e8OLkq_run-code.e8OLkq_actived{background:var(--motion-transparent)}.e8OLkq_stop-all{opacity:.5}.e8OLkq_stop-all.e8OLkq_actived{opacity:1}.e8OLkq_run-code.e8OLkq_disabled,.e8OLkq_stop-all.e8OLkq_disabled{cursor:default;opacity:.5}.e8OLkq_run-code.e8OLkq_disabled:hover,.e8OLkq_stop-all.e8OLkq_disabled:hover{background:0 0}.e8OLkq_toolbar-button{width:calc(2rem + 2px);height:calc(2rem + 2px);padding:.375rem!important}.e8OLkq_button-icon{vertical-align:middle;width:100%;height:100%}.e8OLkq_space{margin-left:.2rem}.e8OLkq_toolbar-button-group{display:flex}.e8OLkq_group-button-first{border-top-right-radius:0;border-bottom-right-radius:0}.e8OLkq_group-button{border-left:none;border-radius:0}.e8OLkq_group-button-last{border-left:none;border-top-left-radius:0;border-bottom-left-radius:0}.e8OLkq_group-button-toggled-off{filter:saturate(0)}");var m0={toolbarButton:"e8OLkq_toolbar-button",stopAll:"e8OLkq_stop-all",groupButtonLast:"e8OLkq_group-button-last",disabled:"e8OLkq_disabled",actived:"e8OLkq_actived",toolbarWrapper:"e8OLkq_toolbar-wrapper",space:"e8OLkq_space",toolbarButtonGroup:"e8OLkq_toolbar-button-group",buttonIcon:"e8OLkq_button-icon",groupButtonFirst:"e8OLkq_group-button-first",groupButtonToggledOff:"e8OLkq_group-button-toggled-off",runCode:"e8OLkq_run-code",groupButton:"e8OLkq_group-button"};var T1="./assets/icon-run-code-3ca2e75390db71e4.svg";var W1="./assets/icon-stop-all-9deb61cb903f7a6c.svg";import{jsx as M0} from"preact/jsx-runtime";function a0(){const{getText:y}=m2(),{device:x}=F2(),j=!x;return M0("div",{className:m0.toolbarWrapper,children:[M0("div",{className:m0.toolbarButtonGroup,children:[M0("img",{className:Y1(m0.runCode,{[m0.disabled]:j}),src:T1,title:y("micropython.runCode","Run")}),M0("img",{className:Y1(m0.stopAll,{[m0.disabled]:j}),src:W1,title:y("micropython.stopAll","Stop")})]}),M0("div",{className:m0.toolbarButtonGroup,children:M0(l0,{})})]})}import{useEditor as N2,useLocale as z2,exportFile as y2} from"@blockcode/core";import{IconSelector as G2,ActionButton as I2} from"@blockcode/ui";import{useLocale as Z2,useEditor as B2} from"@blockcode/core";import{classNames as O2,Label as n0,BufferedInput as X1,Input as M2} from"@blockcode/ui";C0(".RuiFna_file-info-wrapper{background:var(--ui-white);color:var(--text-primary);border-top-left-radius:var(--space);border-top-right-radius:var(--space);border-bottom:1px solid var(--ui-black-transparent);padding:.75rem}.RuiFna_row{justify-content:space-between;display:flex}.RuiFna_row-primary{margin-bottom:.5rem}.RuiFna_group{flex-direction:row;align-items:center;display:inline-flex}.RuiFna_filename-input{flex:1}.RuiFna_filesize-input{width:4rem}");var F0={group:"RuiFna_group",rowPrimary:"RuiFna_row-primary",filenameInput:"RuiFna_filename-input",filesizeInput:"RuiFna_filesize-input",row:"RuiFna_row",fileInfoWrapper:"RuiFna_file-info-wrapper"};import{jsx as D0} from"preact/jsx-runtime";var T2=(y)=>{if(y>1048576)return`${(y/1024/1024).toFixed(2)}MB`;if(y>1024)return`${(y/1024).toFixed(2)}KB`;return`${y}B`};function o0(){const{getText:y}=Z2(),{fileList:x,selectedIndex:j,renameFile:c}=B2(),U=j>=0&&x[j],g=j===-1,b=(E)=>c(E),H=U?U.name.slice(0,U.name.lastIndexOf(".")):"",h=U?U.name.slice(U.name.lastIndexOf(".")+1):"";return D0("div",{className:F0.fileInfoWrapper,children:[D0("div",{className:O2(F0.row,F0.rowPrimary),children:[D0(n0,{text:y("micropython.fileInfo.name","File")}),D0(X1,{className:F0.filenameInput,disabled:g,onSubmit:(E)=>b(`${E}.${h}`),value:H})]}),D0("div",{className:F0.row,children:[D0(n0,{secondary:!0,text:y("micropython.fileInfo.type","Type"),children:D0(X1,{small:!0,disabled:g||U.readOnly,onSubmit:(E)=>b(`${H}.${E}`),value:h})}),D0(n0,{secondary:!0,text:y("micropython.fileInfo.size","Size"),children:D0(M2,{small:!0,disabled:!0,className:F0.filesizeInput,value:U?T2(U.buffer?U.buffer.byteLength:U.content.length):""})})]})]})}C0(".vtc49a_file-selector-wrapper{background-color:var(--ui-secondary);border-top-right-radius:var(--space);border-top-left-radius:var(--space);border:1px solid var(--ui-black-transparent);border-bottom:0;flex:1;position:relative}.vtc49a_delete-menu-item:hover{background:var(--error-primary)}.vtc49a_add-button{position:absolute;bottom:.75rem;right:1rem}");var _0={addButton:"vtc49a_add-button",deleteMenuItem:"vtc49a_delete-menu-item",fileSelectorWrapper:"vtc49a_file-selector-wrapper"};var P1="./assets/icon-new-218a55086844ac80.svg";var k1="./assets/icon-file-upload-c23f079a5e6707a2.svg";var J1="./assets/icon-new-code-1967fe45c3b09925.svg";var _1="./assets/icon-new-json-7bb8b4e3758c956d.svg";var Q1="./assets/icon-binary-bd5ff37e4e663e60.svg";var V1="./assets/icon-csv-01ac17dad06788cf.svg";var K1="./assets/icon-ini-30c1f7addc4a45b0.svg";var u1="./assets/icon-json-72188f5285d8a412.svg";var U1="./assets/icon-markdown-070856945802769c.svg";var x1="./assets/icon-micropython-00b80a7b0306f321.svg";var N1="./assets/icon-text-e3fcfa7f9edb7357.svg";var z1="./assets/icon-image-ce19e915bc1158a6.svg";var y1="./assets/icon-svg-b32916bd8eb3bb12.svg";import{jsx as Q0} from"preact/jsx-runtime";var j2=(y)=>{if(y>1048576)return`${(y/1024/1024).toFixed(2)}MB`;if(y>1024)return`${(y/1024).toFixed(2)}KB`;return`${y}B`},q2=(y)=>{if(y.endsWith(".csv"))return V1;if(y.endsWith(".ini"))return K1;if(y.endsWith(".json"))return u1;if(y.endsWith(".md"))return U1;if(y.endsWith(".py"))return x1;if(y.endsWith(".txt"))return N1;if(y.endsWith(".svg"))return y1;if(/$.*\.(png|jpg|jpeg|gif|bmp)$/.test(y))return z1;return Q1};function r0(){const{getText:y}=z2(),{fileList:x,selectedIndex:j,addFile:c,openFile:U,deleteFile:g}=N2(),b=async({target:H})=>{for(let h of H.files)c({name:h.name,.../^(text|image\/svg).*$/i.test(h.type)?{content:await h.text()}:{content:`------------------------------
${y("micropython.fileInfo.title","File Info")}
------------------------------
${y("micropython.fileInfo.name","File")}: ${h.name}
${y("micropython.fileInfo.type","Type")}: ${h.type}
${y("micropython.fileInfo.size","Size")}: ${j2(h.size)}
${y("micropython.fileInfo.modified","Modified")}: ${new Date(h.lastModified).toLocaleString()}`,buffer:await h.arrayBuffer(),readOnly:!0}})};return Q0("div",{className:_0.fileSelectorWrapper,children:[Q0(o0,{}),Q0(G2,{items:x.map((H,h)=>({...H,icon:q2(H.name),order:H.order||h,contextMenu:[[{label:y("micropython.contextMenu.duplicate","duplicate"),onClick:()=>c({...H,name:`${H.name.split(".")[0]}-${x.length+1}.py`})},{label:y("micropython.contextMenu.export","export"),onClick:()=>y2(H.content,H.name)}],[{label:y("micropython.contextMenu.delete","delete"),className:_0.deleteMenuItem,onClick:()=>g(h)}]]})),selectedIndex:j,onSelect:U,onDelete:g}),Q0(I2,{className:_0.addButton,icon:P1,tooltip:y("micropython.actionButton.newCode","Create new Code"),onClick:()=>c({name:`code-${x.length+1}.py`,content:""}),moreButtons:[{icon:k1,tooltip:y("micropython.actionButton.upload","Upload File"),fileAccept:"image/*,audio/*,video/*,text/*",fileMultiple:!0,onFileChange:b},{icon:_1,tooltip:y("micropython.actionButton.newJSON","Create new JSON"),onClick:()=>c({name:`text-${x.length+1}.json`,content:"{\n    \n}"})},{icon:J1,tooltip:y("micropython.actionButton.newCode","Create new Code"),onClick:()=>c({name:`code-${x.length+1}.py`,content:""})}]})]})}C0(".pl4-KG_sidebar-wrapper{flex-direction:column;width:20rem;height:100%;display:flex}.pl4-KG_list-wrapper{flex-direction:row;height:100%;display:flex}");var s0={listWrapper:"pl4-KG_list-wrapper",sidebarWrapper:"pl4-KG_sidebar-wrapper"};import{jsx as V0} from"preact/jsx-runtime";function i0(){return V0("div",{className:s0.sidebarWrapper,children:[V0(a0,{}),V0("div",{className:s0.listWrapper,children:V0(r0,{})})]})}C0("._9Qonrq_pane{height:8rem}");var G1={pane:"_9Qonrq_pane"};import{jsx as w2} from"preact/jsx-runtime";function t0(){return w2("div",{className:G1.pane})}var I1={fileList:[{id:"main",name:"main.py",type:"text/x-python",content:`# hello world!
import machine

print("hello world!")
`},{id:"test",name:"test.py",type:"text/x-python",content:'print("test")'}]};var j1="./assets/icon-code-08d9a776dd0807e8.svg";var q1="./assets/icon-repl-0766a6776154c7b8.svg";var w1={"micropython.menu.file":"File","micropython.menu.newProject":"New","micropython.menu.openProject":"Open","micropython.menu.saveProject":"Save","micropython.menu.uploadProject":"Load from your computer","micropython.menu.downloadProject":"Save to your computer","micropython.menu.edit":"Edit","micropython.menu.undo":"Undo","micropython.menu.redo":"Redo","micropython.runCode":"Run","micropython.stopAll":"Stop","micropython.syncDevice":"Sync","micropython.codeTab":"Code","micropython.replTab":"REPL","micropython.deviceManager.connect":"Connect Hardware...","micropython.deviceManager.notReady":"Not ready","micropython.deviceManager.ready":"Ready","micropython.packageList.title":"Modules","micropython.packageList.addPackage":"Add Package","micropython.fileInfo.title":"File Info","micropython.fileInfo.name":"File","micropython.fileInfo.type":"Type","micropython.fileInfo.size":"Size","micropython.fileInfo.modified":"Modified","micropython.actionButton.newCode":"Create new Code","micropython.actionButton.newJSON":"Create new JSON","micropython.actionButton.upload":"Upload File","micropython.contextMenu.duplicate":"duplicate","micropython.contextMenu.export":"export","micropython.contextMenu.delete":"delete","micropython.recordPane.title":"Record"};var $1={"micropython.menu.file":"\u6587\u4EF6","micropython.menu.newProject":"\u65B0\u4F5C\u54C1","micropython.menu.openProject":"\u6253\u5F00","micropython.menu.saveProject":"\u4FDD\u5B58","micropython.menu.uploadProject":"\u4ECE\u7535\u8111\u4E2D\u6253\u5F00","micropython.menu.downloadProject":"\u4FDD\u5B58\u5230\u7535\u8111","micropython.menu.edit":"\u7F16\u8F91","micropython.menu.undo":"\u64A4\u9500","micropython.menu.redo":"\u6062\u590D","micropython.runCode":"\u8FD0\u884C","micropython.stopAll":"\u505C\u6B62","micropython.syncDevice":"\u540C\u6B65","micropython.codeTab":"\u4EE3\u7801","micropython.replTab":"\u4EA4\u4E92\u6267\u884C","micropython.deviceManager.connect":"\u8FDE\u63A5\u786C\u4EF6...","micropython.deviceManager.notReady":"\u672A\u8FDE\u63A5","micropython.deviceManager.ready":"\u5DF2\u8FDE\u63A5","micropython.packageList.title":"\u6269\u5C55\u5305","micropython.packageList.addPackage":"\u6DFB\u52A0\u6269\u5C55\u5305","micropython.fileInfo.title":"\u6587\u4EF6\u4FE1\u606F","micropython.fileInfo.name":"\u6587\u4EF6","micropython.fileInfo.type":"\u7C7B\u578B","micropython.fileInfo.size":"\u5927\u5C0F","micropython.fileInfo.modified":"\u4FEE\u6539\u65E5\u671F","micropython.actionButton.newCode":"\u521B\u5EFA\u65B0\u4EE3\u7801","micropython.actionButton.newJSON":"\u521B\u5EFA\u65B0 JSON","micropython.actionButton.upload":"\u4E0A\u4F20\u6587\u4EF6","micropython.contextMenu.duplicate":"\u590D\u5236","micropython.contextMenu.export":"\u5BFC\u51FA","micropython.contextMenu.delete":"\u5220\u9664","micropython.recordPane.title":"\u8BB0\u5F55"};import{jsx as v1} from"preact/jsx-runtime";function d2({addLocaleData:y,createLayout:x,openProject:j,project:c}){y({en:w1,"zh-Hans":$1}),((g)=>{j(Object.assign({selectedIndex:0},g||I1))})(c),x({tabs:[{icon:j1,label:v1(e0,{id:"micropython.codeTab",defaultMessage:"Code"}),Content:x0},{icon:q1,label:v1(e0,{id:"micropython.replTab",defaultMessage:"REPL"}),Content:j0}],sidebars:[{expand:"left",Content:i0}],pane:{label:v1(e0,{id:"micropython.recordPane.title",defaultMessage:"Record"}),Content:t0},tutorials:!0,canEditProjectName:!0})}export{d2 as default};
