var V1=Object.create;var{getPrototypeOf:U1,defineProperty:t1,getOwnPropertyNames:W1}=Object;var X1=Object.prototype.hasOwnProperty;var K1=(t,e,o)=>{o=t!=null?V1(U1(t)):{};const i=e||!t||!t.__esModule?t1(o,"default",{value:t,enumerable:!0}):o;for(let n of W1(t))if(!X1.call(i,n))t1(i,n,{get:()=>t[n],enumerable:!0});return i};var Y1=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var e1=Y1((yt)=>{(function(){var t=typeof yt!="undefined"&&yt||typeof define!="undefined"&&{}||this||window;if(typeof define!=="undefined")define("save-svg-as-png",[],function(){return t});t.default=t;var e="http://www.w3.org/2000/xmlns/",o="http://www.w3.org/1999/xhtml",i="http://www.w3.org/2000/svg",n='<?xml version="1.0" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd" [<!ENTITY nbsp "&#160;">]>',u=/url\(["']?(.+?)["']?\)/,c={woff2:"font/woff2",woff:"font/woff",otf:"application/x-font-opentype",ttf:"application/x-font-ttf",eot:"application/vnd.ms-fontobject",sfnt:"application/font-sfnt",svg:"image/svg+xml"},l=function N(r){return r instanceof HTMLElement||r instanceof SVGElement},m=function N(r){if(!l(r))throw new Error("an HTMLElement or SVGElement is required; got "+r)},A=function N(r){return new Promise(function(d,a){if(l(r))d(r);else a(new Error("an HTMLElement or SVGElement is required; got "+r))})},C=function N(r){return r&&r.lastIndexOf("http",0)===0&&r.lastIndexOf(window.location.host)===-1},_=function N(r){var d=Object.keys(c).filter(function(a){return r.indexOf("."+a)>0}).map(function(a){return c[a]});if(d)return d[0];return console.error("Unknown font format for "+r+". Fonts may not be working correctly."),"application/octet-stream"},f=function N(r){var d="",a=new Uint8Array(r);for(var h=0;h<a.byteLength;h++)d+=String.fromCharCode(a[h]);return window.btoa(d)},E=function N(r,d,a){var h=r.viewBox&&r.viewBox.baseVal&&r.viewBox.baseVal[a]||d.getAttribute(a)!==null&&!d.getAttribute(a).match(/%$/)&&parseInt(d.getAttribute(a))||r.getBoundingClientRect()[a]||parseInt(d.style[a])||parseInt(window.getComputedStyle(r).getPropertyValue(a));return typeof h==="undefined"||h===null||isNaN(parseFloat(h))?0:h},p=function N(r,d,a,h){if(r.tagName==="svg")return{width:a||E(r,d,"width"),height:h||E(r,d,"height")};else if(r.getBBox){var w=r.getBBox(),M=w.x,D=w.y,k=w.width,it=w.height;return{width:M+k,height:D+it}}},T=function N(r){return decodeURIComponent(encodeURIComponent(r).replace(/%([0-9A-F]{2})/g,function(d,a){var h=String.fromCharCode("0x"+a);return h==="%"?"%25":h}))},b=function N(r){var d=window.atob(r.split(",")[1]),a=r.split(",")[0].split(":")[1].split(";")[0],h=new ArrayBuffer(d.length),w=new Uint8Array(h);for(var M=0;M<d.length;M++)w[M]=d.charCodeAt(M);return new Blob([h],{type:a})},W=function N(r,d){if(!d)return;try{return r.querySelector(d)||r.parentNode&&r.parentNode.querySelector(d)}catch(a){console.warn('Invalid CSS selector "'+d+'"',a)}},F=function N(r,d){var a=r.cssText.match(u),h=a&&a[1]||"";if(!h||h.match(/^data:/)||h==="about:blank")return;var w=h.startsWith("../")?d+"/../"+h:h.startsWith("./")?d+"/."+h:h;return{text:r.cssText,format:_(w),url:w}},K=function N(r){return Promise.all(Array.from(r.querySelectorAll("image")).map(function(d){var a=d.getAttributeNS("http://www.w3.org/1999/xlink","href")||d.getAttribute("href");if(!a)return Promise.resolve(null);if(C(a))a+=(a.indexOf("?")===-1?"?":"&")+"t="+new Date().valueOf();return new Promise(function(h,w){var M=document.createElement("canvas"),D=new Image;D.crossOrigin="anonymous",D.src=a,D.onerror=function(){return w(new Error("Could not load "+a))},D.onload=function(){M.width=D.width,M.height=D.height,M.getContext("2d").drawImage(D,0,0),d.setAttributeNS("http://www.w3.org/1999/xlink","href",M.toDataURL("image/png")),h(!0)}})}))},I={},H=function N(r){return Promise.all(r.map(function(d){return new Promise(function(a,h){if(I[d.url])return a(I[d.url]);var w=new XMLHttpRequest;w.addEventListener("load",function(){var M=f(w.response),D=d.text.replace(u,'url("data:'+d.format+";base64,"+M+'")')+"\n";I[d.url]=D,a(D)}),w.addEventListener("error",function(M){console.warn("Failed to load font from: "+d.url,M),I[d.url]=null,a(null)}),w.addEventListener("abort",function(M){console.warn("Aborted loading font from: "+d.url,M),a(null)}),w.open("GET",d.url),w.responseType="arraybuffer",w.send()})})).then(function(d){return d.filter(function(a){return a}).join("")})},lt=null,ht=function N(){if(lt)return lt;return lt=Array.from(document.styleSheets).map(function(r){try{return{rules:r.cssRules,href:r.href}}catch(d){return console.warn("Stylesheet could not be loaded: "+r.href,d),{}}})},Rt=function N(r,d){var a=d||{},h=a.selectorRemap,w=a.modifyStyle,M=a.modifyCss,D=a.fonts,k=a.excludeUnusedCss,it=M||function(P,q){var $=h?h(P):P,R=w?w(q):q;return $+"{"+R+"}\n"},G=[],B=typeof D==="undefined",j=D||[];return ht().forEach(function(P){var{rules:q,href:$}=P;if(!q)return;Array.from(q).forEach(function(R){if(typeof R.style!="undefined"){if(W(r,R.selectorText))G.push(it(R.selectorText,R.style.cssText));else if(B&&R.cssText.match(/^@font-face/)){var z=F(R,$);if(z)j.push(z)}else if(!k)G.push(R.cssText)}})}),H(j).then(function(P){return G.join("\n")+P})},Q=function N(){if(!navigator.msSaveOrOpenBlob&&!("download"in document.createElement("a")))return{popup:window.open()}};t.prepareSvg=function(N,r,d){m(N);var a=r||{},h=a.left,w=h===void 0?0:h,M=a.top,D=M===void 0?0:M,k=a.width,it=a.height,G=a.scale,B=G===void 0?1:G,j=a.responsive,P=j===void 0?!1:j,q=a.excludeCss,$=q===void 0?!1:q;return K(N).then(function(){var R=N.cloneNode(!0);R.style.backgroundColor=(r||{}).backgroundColor||N.style.backgroundColor;var z=p(N,R,k,it),x=z.width,tt=z.height;if(N.tagName!=="svg")if(N.getBBox){if(R.getAttribute("transform")!=null)R.setAttribute("transform",R.getAttribute("transform").replace(/translate\(.*?\)/,""));var Dt=document.createElementNS("http://www.w3.org/2000/svg","svg");Dt.appendChild(R),R=Dt}else{console.error("Attempted to render non-SVG element",N);return}if(R.setAttribute("version","1.1"),R.setAttribute("viewBox",[w,D,x,tt].join(" ")),!R.getAttribute("xmlns"))R.setAttributeNS(e,"xmlns",i);if(!R.getAttribute("xmlns:xlink"))R.setAttributeNS(e,"xmlns:xlink","http://www.w3.org/1999/xlink");if(P)R.removeAttribute("width"),R.removeAttribute("height"),R.setAttribute("preserveAspectRatio","xMinYMin meet");else R.setAttribute("width",x*B),R.setAttribute("height",tt*B);if(Array.from(R.querySelectorAll("foreignObject > *")).forEach(function(g){g.setAttributeNS(e,"xmlns",g.tagName==="svg"?i:o)}),$){var Ot=document.createElement("div");Ot.appendChild(R);var O=Ot.innerHTML;if(typeof d==="function")d(O,x,tt);else return{src:O,width:x,height:tt}}else return Rt(N,r).then(function(g){var L=document.createElement("style");L.setAttribute("type","text/css"),L.innerHTML="<![CDATA[\n"+g+"\n]]>";var v=document.createElement("defs");v.appendChild(L),R.insertBefore(v,R.firstChild);var X=document.createElement("div");X.appendChild(R);var et=X.innerHTML.replace(/NS\d+:href/gi,'xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href');if(typeof d==="function")d(et,x,tt);else return{src:et,width:x,height:tt}})})},t.svgAsDataUri=function(N,r,d){return m(N),t.prepareSvg(N,r).then(function(a){var{src:h,width:w,height:M}=a,D="data:image/svg+xml;base64,"+window.btoa(T(n+h));if(typeof d==="function")d(D,w,M);return D})},t.svgAsPngUri=function(N,r,d){m(N);var a=r||{},h=a.encoderType,w=h===void 0?"image/png":h,M=a.encoderOptions,D=M===void 0?0.8:M,k=a.canvg,it=function G(B){var{src:j,width:P,height:q}=B,$=document.createElement("canvas"),R=$.getContext("2d"),z=window.devicePixelRatio||1;if($.width=P*z,$.height=q*z,$.style.width=$.width+"px",$.style.height=$.height+"px",R.setTransform(z,0,0,z,0,0),k)k($,j);else R.drawImage(j,0,0);var x=void 0;try{x=$.toDataURL(w,D)}catch(tt){if(typeof SecurityError!=="undefined"&&tt instanceof SecurityError||tt.name==="SecurityError"){console.error("Rendered SVG images cannot be downloaded in this browser.");return}else throw tt}if(typeof d==="function")d(x,$.width,$.height);return Promise.resolve(x)};if(k)return t.prepareSvg(N,r).then(it);else return t.svgAsDataUri(N,r).then(function(G){return new Promise(function(B,j){var P=new Image;P.onload=function(){return B(it({src:P,width:P.width,height:P.height}))},P.onerror=function(){j("There was an error loading the data URI as an image on the following SVG\n"+window.atob(G.slice(26))+"Open the following link to see browser\'s diagnosis\n"+G)},P.src=G})})},t.download=function(N,r,d){if(navigator.msSaveOrOpenBlob)navigator.msSaveOrOpenBlob(b(r),N);else{var a=document.createElement("a");if("download"in a){a.download=N,a.style.display="none",document.body.appendChild(a);try{var h=b(r),w=URL.createObjectURL(h);a.href=w,a.onclick=function(){return requestAnimationFrame(function(){return URL.revokeObjectURL(w)})}}catch(M){console.error(M),console.warn("Error while getting object URL. Falling back to string URL."),a.href=r}a.click(),document.body.removeChild(a)}else if(d&&d.popup)d.popup.document.title=N,d.popup.location.replace(r)}},t.saveSvg=function(N,r,d){var a=Q();return A(N).then(function(h){return t.svgAsDataUri(h,d||{})}).then(function(h){return t.download(r,h,a)})},t.saveSvgAsPng=function(N,r,d){var a=Q();return A(N).then(function(h){return t.svgAsPngUri(h,d||{})}).then(function(h){return t.download(r,h,a)})}})()});import{Text as xt}from"@blockcode/ui";import{Text as Yt}from"@blockcode/ui";var i1=K1(e1(),1);import{Keys as dt,useLayout as Z1,useEditor as H1}from"@blockcode/core";import{Text as ct,MenuSection as o1,MenuItem as At}from"@blockcode/ui";import{ScratchBlocks as G1}from"@blockcode/blocks-editor";import{jsx as J,jsxs as Vt,Fragment as k1}from"preact/jsx-runtime";var $t=/Mac/i.test(navigator.platform||navigator.userAgent);function Ut({itemClassName:t,onNew:e,onOpen:o,onSave:i,children:n}){const{createAlert:u,createPrompt:c,setStoreLibrary:l}=Z1(),{modified:m,saveNow:A,saveToComputer:C,openFromComputer:_}=H1(),f=(T)=>{if(i)return i(T);return T},E=async()=>{let T,b;const W=G1.getMainWorkspace();if(W){const F=W.getCanvas();if(F)T=await i1.svgAsDataUri(F,{})}return(F)=>{let K=new Set;const I={thumb:T,editor:{},...F,...f(F)};if(I.assetList)I.assetList=I.assetList.filter((H)=>!H.id.startsWith("extensions/"));if(I.fileList)I.fileList=I.fileList.map(({content:H,script:lt,extensions:ht,...Rt})=>{return K=K.union(new Set(ht)),Rt});return I.editor.extensions=Array.from(K),I}},p=(T)=>async()=>{await T(await E()),u({message:J(ct,{id:"blocks.menu.file.saveAlert",defaultMessage:"Saved."})},2000)};return Vt(k1,{children:[Vt(o1,{children:[J(At,{className:t,label:J(ct,{id:"blocks.menu.file.newProject",defaultMessage:"New"}),hotkey:[$t?dt.COMMAND:dt.CONTROL,dt.N],onClick:()=>{if(m)c({title:J(ct,{id:"gui.projects.notSaved",defaultMessage:"Not saved"}),label:J(ct,{id:"gui.projects.replaceProject",defaultMessage:"Replace contents of the current project?"}),onSubmit:e});else e()}}),J(At,{className:t,label:J(ct,{id:"blocks.menu.file.openProject",defaultMessage:"Open"}),hotkey:[$t?dt.COMMAND:dt.CONTROL,dt.O],onClick:()=>l(!0)}),J(At,{className:t,label:J(ct,{id:"blocks.menu.file.saveProject",defaultMessage:"Save"}),hotkey:[$t?dt.COMMAND:dt.CONTROL,dt.S],onClick:p(A)})]}),Vt(o1,{children:[J(At,{className:t,label:J(ct,{id:"blocks.menu.file.uploadProject",defaultMessage:"Load from your computer"}),onClick:()=>_(o)}),J(At,{className:t,label:J(ct,{id:"blocks.menu.file.downloadProject",defaultMessage:"save to your computer"}),onClick:window.electron?async()=>C(await E()):p(C)})]}),n]})}import{useEffect as z1,useState as Wt}from"preact/hooks";import{Keys as mt}from"@blockcode/core";import{Text as n1,MenuSection as J1,MenuItem as a1}from"@blockcode/ui";import{ScratchBlocks as Q1}from"@blockcode/blocks-editor";import{jsx as Lt,jsxs as s1,Fragment as B1}from"preact/jsx-runtime";var r1=/Mac/i.test(navigator.platform||navigator.userAgent);function Xt({itemClassName:t,children:e}){const[o,i]=Wt(!0),[n,u]=Wt(!0),[c,l]=Wt(null),m=Q1.getMainWorkspace();if(m){if(c?.id!==m.id)l(m)}return z1(()=>{if(c)c.addChangeListener(()=>{i(c.undoStack_.length===0),u(c.redoStack_.length===0)}),i(c.undoStack_.length===0),u(c.redoStack_.length===0)},[c]),s1(B1,{children:[s1(J1,{children:[Lt(a1,{disabled:o,className:t,label:Lt(n1,{id:"blocks.menu.edit.undo",defaultMessage:"Undo"}),hotkey:[r1?mt.COMMAND:mt.CONTROL,mt.Z],onClick:async(A)=>{if(A instanceof MouseEvent&&c)c.undo(!1)}}),Lt(a1,{disabled:n,className:t,label:Lt(n1,{id:"blocks.menu.edit.redo",defaultMessage:"Redo"}),hotkey:r1?[mt.SHIFT,mt.COMMAND,mt.Z]:[mt.CONTROL,mt.Y],onClick:async(A)=>{if(A instanceof MouseEvent&&c)c.undo(!0)}})]}),e]})}import{useLayout as j1,useEditor as q1}from"@blockcode/core";import{Text as Nt,Spinner as x1,MenuSection as te,MenuItem as ee}from"@blockcode/ui";import{connectDevice as oe,checkDevice as ie,checkFlashFree as ne,writeFiles as ae,configDevice as re}from"@blockcode/device-pyboard";import{jsx as at,jsxs as de,Fragment as se}from"preact/jsx-runtime";var Et=null;function Kt({itemClassName:t,deviceName:e,deviceFilters:o,onBeforeDownload:i,children:n}){const{createAlert:u,removeAlert:c,createPrompt:l}=j1(),{key:m,name:A,fileList:C,assetList:_}=q1(),f=(T)=>{if(!Et)Et=`download.${Date.now()}`;if(T<100)u({id:Et,icon:at(x1,{level:"success"}),message:at(Nt,{id:"blocks.alert.downloading",defaultMessage:"Downloading...{progress}%",progress:T})});else u({id:Et,icon:null,message:at(Nt,{id:"blocks.alert.downloadCompleted",defaultMessage:"Download completed."})}),setTimeout(E,2000)},E=()=>{c(Et),Et=null},p=(T)=>{if(T==="NotFoundError")return;u({message:T==="NotFoundError"?at(Nt,{id:"blocks.alert.connectionCancel",defaultMessage:"Connection cancel."}):at(Nt,{id:"blocks.alert.connectionError",defaultMessage:"Connection error."})},1000)};return de(se,{children:[at(te,{children:at(ee,{disabled:Et,className:t,label:at(Nt,{id:"blocks.menu.device.download",defaultMessage:"Download program"}),onClick:async()=>{if(Et)return;let T;try{T=await oe(o||[])}catch(F){p(F.name)}if(!T)return;const b=ie(T).catch(()=>{p(),E()}),W=i?i({key:m,name:A},C,_):[].concat(C,_);f(0);try{if(await ne(T,W))await ae(T,W,f),await re(T,{"latest-project":m}),T.hardReset();else l({title:e||at(Nt,{id:"blocks.menu.device.name",defaultMessage:"device"}),label:at(Nt,{id:"blocks.alert.flashOutSpace",defaultMessage:"The flash is running out of space."})}),E()}catch(F){p(F.name),E()}finally{b.cancel()}}})}),n]})}var d1="./assets/icon-file-egaz1kfx.svg";var u1="./assets/icon-edit-jejnm7yb.svg";var l1="./assets/icon-device-3gcajtt2.svg";import{jsx as Ct}from"preact/jsx-runtime";function Zt({deviceName:t,deviceFilters:e,createProject:o,openProject:i,saveProject:n,beforeDownload:u}){return[{icon:d1,label:Ct(Yt,{id:"blocks.menu.file",defaultMessage:"File"}),Menu:({itemClassName:c,children:l})=>Ct(Ut,{itemClassName:c,onNew:o,onOpen:i,onSave:n,children:l})},{icon:u1,label:Ct(Yt,{id:"blocks.menu.edit",defaultMessage:"Edit"}),Menu:({itemClassName:c,children:l})=>Ct(Xt,{itemClassName:c,children:l})},{icon:l1,label:Ct(Yt,{id:"blocks.menu.device",defaultMessage:"Device"}),Menu:({itemClassName:c,children:l})=>Ct(Kt,{deviceName:t,itemClassName:c,deviceFilters:e,onBeforeDownload:u,children:l})}]}var ce=(t)=>{const e="=".repeat((4-t.length%4)%4),o=(t+e).replace(/\-/g,"+").replace(/_/g,"/"),i=window.atob(o),n=new Uint8Array(i.length);for(let u=0;u<i.length;++u)n[u]=i.charCodeAt(u);return n.buffer};var h1=[{id:"blocks/__init__.mpy",content:"TQYAHxQAFl9faW5pdF9fLnB5AA8OYXN5bmNpbwALHGJsb2Nrcy5ydW50aW1lABZERUZBVUxUX0ZQUwCCJQZydW4AFHdoZW5fc3RhcnQAEndoZW5fc3RvcAAgd2hlbl9ncmVhdGVydGhlbgAsd2hlbl9icm9hZGNhc3RyZWNlaXZlZAAOd3JhcHBlcgAOUnVudGltZQAOcnVudGltZQAGZnBzAAxoYW5kbGUACG5hbWUAgkUObWVzc2FnZQCDfAgYAUZIZmsgZCBkIIQHgFEbAhYCgBADKgEbBGkRDTQAFg4RDRMFKgFTMwAWBjIBFggyAhYJMgMWCjIEFgtRYwWBOKkBCAYPgAgSAhQHEg4UBrA2ATYBWVFjgQAZCAgQgAwSDhQIsDYBWVFjgQAZCAkQgBASDhQJsDYBWVFjgRwijAEKERKAFGYAAbCxIAACwrJjAYEwOwwMAwMQgBUSDhQKJQAlAbI2A1lRY3wRCwsTgBtlALAgAAHBsWMBgRgqCgwDEIAcEg4UCyUAsTYCWVFj"},{id:"blocks/runtime.mpy",content:"TQYAH3AAFHJ1bnRpbWUucHkADw5hc3luY2lvAAxyYW5kb20ACG1hdGgACHRpbWUABnN5cwAOUnVudGltZQAMbnVtYmVyAAxlcXVhbHMAFmdldF9mdW5jX2lkAAp7fS57fQCBKRZfX2dsb2JhbHNfXwAvEmlzX251bWJlcgCBFQIuAAItAIIDAxQwMTIzNDU2Nzg5ABphbnlfc3RlcF9kb25lABBzbGVlcF9tcwAIZG9uZQAKU1RBUlQACkZSQU1FABhHUkVBVEVSX1RIRU4AJEJST0FEQ0FTVF9SRUNFSVZFRAAQU0hVVERPV04ADndhaXRpbmcAIwxfdGFza3MADF9zdGVwcwAKX3RpbWUAFF9mcmFtZV9zZWMACl9kYXRhABhfZ3JlYXRlcnRoZW4ACl9waW5zAAhkYXRhAAhwaW5zABpfaXNfc3luY190YXNrABZjcmVhdGVfdGFzawAKe31Ae30AeRRzdGFydF90YXNrABZfc3RhcnRfc3RlcAASbmV4dF90aWNrABRzdG9wX3Rhc2tzAIFVgXEMY2FuY2VsAAZ7fUAAgiMId2hlbgAIZmlyZQAKYWJvcnQAFHdoZW5fZnJhbWUAFHdoZW5fc3RhcnQAEndoZW5fc3RvcAAsd2hlbl9icm9hZGNhc3RyZWNlaXZlZAAKe306e30AEmJyb2FkY2FzdAAgd2hlbl9ncmVhdGVydGhlbgAKe30+e30AJF9mcmFtZV9ncmVhdGVydGhlbgACPgAKVElNRVIAgiUWcmVzZXRfdGltZXIAFG5leHRfZnJhbWUAEmZyYW1lX3NlYwCCLQpfc3RvcAAQd2FpdF9mb3IACnNsZWVwABR0aWNrc19kaWZmABB0aWNrc19tcwAIY2VpbAAKZmxvb3IADnJhbmRpbnQAgTkGbnVtAAphZnVuYwACcwCCL4FXCnN0ZXBzAC01FkRFRkFVTFRfRlBTABBwcm9wZXJ0eQCCKYITCG5hbWUAEnN0ZXBfbmFtZQB7CHN5bmMAGmV4Y2x1ZGVfYWZ1bmMADm1lc3NhZ2UAgkUKZmxvYXQABmZwcwAIbnVtMQAIbnVtMgAGbWluAAZtYXgAGmRlZmF1bHRfdmFsdWUAgSEMbGVuZ3RoAAh2YWwxAAh2YWwyAIUUEB4BJiYmJmZkIIQbhAiJsCaAURsCFgKAURsDFgOAURsEFgSAURsFFgWAURsGFgYyABYKMgEWDzICFhZUMgMQBzQCFgcRBxMIFlIRBxMJFglRYwSBMCEIClOACBALFAywEw0QDlWwEw42AmOJeDkwD1SADCYpIisoJygiKiUnRCQrKCclJ0REElWwNAHAElawNAGA2URCUGOwFBAQETYBgdlEd7CAVRAS2URHsIFRLgJVwLCAVRAR2URCUGOwFBMQERAUNgLAsF9LDMGxEBXd00RCUGNCMlJjQnCwFBAQETYBgNlEY7CAVRAS2URHsIFRLgJVwLBfSwzBsRAV3dNEQlBjQjJSY0JCUGNRY4JQwUAQFleAJyAlKyewX0sXwRICFBeBNgFeUWhZsRQYNgBEQlJjQidCI1FjkSwYcAeIL0MkJCQkRIQJaCBoIGRkQIsThAeIDGRrZGRkZGRrQGRAhAqECWRkYGggZGRkaCBkiQdsIIgHEQ4WWBAHFlmeFloQGRYZEBoWGhAbFhsQHBYcEB0WHTIAFh8RWzIBNAEWJxFbMgI0ARYoMgMWKTIEFipTLABQEB5iMwUWLTIGFi5RKgFTMwcWMDIIFjZTLABQEB5iMwkWNzIKFjgyCxY5MgwWOjINFjsyDhY8UywAUBAeYjMPFj4yEBY/MhEWQTISFkQyExZIMhQWSRFbMhU0ARZHMhYWSjIXFkYyGBYvEVsyGTQBFgUyGhZFgYoqAlMzGxYDEVyAKgFTMxw0ARYIEVwyHTQBFlERXDIeNAEWCVFjH4J4ERQfXYA4JSUkJCUlLACwGCAsALAYIYCwGCJQsBgjLACwGCQsALAYJSwAsBgmUWNQCQgnXYBCsBMkY1AJCChdgEawEyZjgTAaCildXoBJsRIHExncRgaxEgcTGtxjhADLgIBAECpdXlOATC01ECsUDBIKsjQBsTYCxLGwEyDdREewEyCxVUJCKwCwEyCxVrATILFVFCy0srMqAzYBWVFjiBCimIDAQCgtXV4egFEoQiMnLSQqI0kjKSYpJLGwEyDd00RCUWMrAMSwFCmxNgHFsBMgsVVfSx8wA8bHyLiz8smwFC62t7m1NgTKukRHtBQsujYBWUIfskRoEla0NAGA2URGsBQvNgBjEla0NAGB2UREtIBVYxICFCoSFrQ0ATYBY1FjhBDRBBguXV9TYGGAZDAtLCaxsBMh3URHsBMhsVVCQVDFtURKtERHtRQYNgBEVBICFCqys4E1ATYBxbWwEyGxVrVjUWOGYNoBGjBdYoBrIysvQiwqKyuxQ1ywEyEUMTYAX0sQwrATIRQysjYBFDM2AFlCLlFjEDQUDBIKsTQBNgHDsxQ1EBE2AYBVxLATIRQxNgBfSxvCtLLdRFOzst3TRE2wEyEUMrI2ARQzNgBZQiNRY4EYqYCAQAg2XYB3sBQqsYE3AVlRY4E4wYiAwEAKN10egHqwFC2yEB6xgTeCAWOBGKmAgEAIOF2AfbAUMLGBNwFZUWOBSMKAgEAKOV1TgICwFDYSBxMasbKENwNZUWOBSMKAgEAKOl1TgIOwFDYSBxMZsbKENwNZUWOBSMKAgEAKO11TgIawFDYSBxMdsbKENwNZUWOCCMuAgEAMPF1jU4CJsBQ2ED0UDBIHExyxNgKys4Q3A1lRY4Ig0oiAwEAOPl1jHoCMI7AUNxA9FAwSBxMcsTYCsxAesoI3ggJjgxjYhIBAEj9dXmRTgJEpJhBAFAyxsjYCxVCwEyW1VrAUNhA9FAwSBxMbtTYCs7SENwNZUWOFYPlAFkFdgJYoJSsmKioxsBMlFDE2AMGxX0tAwrIUNRBCNgEwAsPEsxBD2URrsBMFEmW0NAHYxbVEWLATJbJVQ1GwFDcQPRQMEgcTG7I2AjYBWbWwEyWyVkK+f1FjhEiiQBZEXWaAoCYpKiYiKoGx97AYI7AUObATQTYBWbAUNxIHExk2AVmwFEU2AFlCU7AUNxIHExo2AVmwFEY2AF5RaFmwE0dDKFFjgSAhCEhdgKkSAhQqsBRJNgA2AVlRY4JImUAOSV2ArCopJrAUNxIHEx02AVmwFEY2AF5RaFmwFDg2AFlQsBgjUWNQCQhHXYCzsBMjY3giCkpdVIC2EgIUS7E2AWN4GQhGXYC5sBRKsBNHNgFjcBkIL12AvBICFBeFNgFjgVAhCAVdgMASBRRMEgUUTTYAsBMiNgIih2j3Y4EIEQhFXYDDEgUUTTYAsBgiUWOCeMuAARADXWdogMYtLRIEFE4SabGyNAI2AcMSBBRPEmqxsjQCNgHEEgMUULO0NgJjgViiAQoIZGuAzhIPsDQBREoSbBJVsDQBNAFjsWOBUCIQUQhtgNIkJCSwgfPCsrHrwrKx5cKysfhjgxgqDglub4DZLjASD7A0AURXEg+xNAFEUBIHFAiwNgESBxQIsTYB2WMSVbA0ARJVsTQB2WM="}].map((t)=>({id:t.id,content:ce(t.content)}));var c1=`code_${Date.now().toString(36)}`,me=`
from blocks import *
import ${c1}
start()
`,m1={assetList:[{id:"main",type:"text/x-python",content:me}],fileList:[{id:c1,type:"text/x-python"}]};import{ScratchBlocks as Y}from"@blockcode/blocks-editor";class gt extends Y.Generator{ORDER_ATOMIC=0;ORDER_COLLECTION=1;ORDER_STRING_CONVERSION=1;ORDER_MEMBER=2.1;ORDER_FUNCTION_CALL=2.2;ORDER_EXPONENTIATION=3;ORDER_UNARY_SIGN=4;ORDER_BITWISE_NOT=4;ORDER_MULTIPLICATIVE=5;ORDER_ADDITIVE=6;ORDER_BITWISE_SHIFT=7;ORDER_BITWISE_AND=8;ORDER_BITWISE_XOR=9;ORDER_BITWISE_OR=10;ORDER_RELATIONAL=11;ORDER_LOGICAL_NOT=12;ORDER_LOGICAL_AND=13;ORDER_LOGICAL_OR=14;ORDER_CONDITIONAL=15;ORDER_LAMBDA=16;ORDER_NONE=99;constructor(){super("Python");this.addReservedWords("False,None,True,and,as,assert,break,class,continue,def,del,elif,else,except,exec,finally,for,from,global,if,import,in,is,lambda,nonlocal,not,or,pass,print,raise,return,try,while,with,yield,NotImplemented,Ellipsis,__debug__,quit,exit,copyright,license,credits,ArithmeticError,AssertionError,AttributeError,BaseException,BlockingIOError,BrokenPipeError,BufferError,BytesWarning,ChildProcessError,ConnectionAbortedError,ConnectionError,ConnectionRefusedError,ConnectionResetError,DeprecationWarning,EOFError,Ellipsis,EnvironmentError,Exception,FileExistsError,FileNotFoundError,FloatingPointError,FutureWarning,GeneratorExit,IOError,ImportError,ImportWarning,IndentationError,IndexError,InterruptedError,IsADirectoryError,KeyError,KeyboardInterrupt,LookupError,MemoryError,ModuleNotFoundError,NameError,NotADirectoryError,NotImplemented,NotImplementedError,OSError,OverflowError,PendingDeprecationWarning,PermissionError,ProcessLookupError,RecursionError,ReferenceError,ResourceWarning,RuntimeError,RuntimeWarning,StandardError,StopAsyncIteration,StopIteration,SyntaxError,SyntaxWarning,SystemError,SystemExit,TabError,TimeoutError,TypeError,UnboundLocalError,UnicodeDecodeError,UnicodeEncodeError,UnicodeError,UnicodeTranslateError,UnicodeWarning,UserWarning,ValueError,Warning,ZeroDivisionError,_,__build_class__,__debug__,__doc__,__import__,__loader__,__name__,__package__,__spec__,abs,all,any,apply,ascii,basestring,bin,bool,buffer,bytearray,bytes,callable,chr,classmethod,cmp,coerce,compile,complex,copyright,credits,delattr,dict,dir,divmod,enumerate,eval,exec,execfile,exit,file,filter,float,format,frozenset,getattr,globals,hasattr,hash,help,hex,id,input,int,intern,isinstance,issubclass,iter,len,license,list,locals,long,map,max,memoryview,min,next,object,oct,open,ord,pow,print,property,quit,range,raw_input,reduce,reload,repr,reversed,round,set,setattr,slice,sorted,staticmethod,str,sum,super,tuple,type,unichr,unicode,vars,xrange,zip,math,random,Number"),this.ORDER_OVERRIDES=[[this.ORDER_FUNCTION_CALL,this.ORDER_MEMBER],[this.ORDER_FUNCTION_CALL,this.ORDER_FUNCTION_CALL],[this.ORDER_MEMBER,this.ORDER_MEMBER],[this.ORDER_MEMBER,this.ORDER_FUNCTION_CALL],[this.ORDER_LOGICAL_NOT,this.ORDER_LOGICAL_NOT],[this.ORDER_LOGICAL_AND,this.ORDER_LOGICAL_AND],[this.ORDER_LOGICAL_OR,this.ORDER_LOGICAL_OR]]}init(t){for(let n in this)if(typeof this[n]==="function"&&!Y.Generator.prototype[n])this[n]=this[n].bind(this);if(this.PASS=this.INDENT+"pass\n",this.definitions_=Object.create(null),this.functionNames_=Object.create(null),!this.variableDB_)this.variableDB_=new Y.Names(this.RESERVED_WORDS_);else this.variableDB_.reset();this.variableDB_.setVariableMap(t.getVariableMap());const e=[],o=t.getAllVariables();for(let n=0;n<o.length;n++){if(o[n].type===Y.BROADCAST_MESSAGE_VARIABLE_TYPE)continue;let u=this.variableDB_.getName(o[n].getId(),Y.Variables.NAME_TYPE),c="0";if(o[n].type===Y.LIST_VARIABLE_TYPE)u=`${u}_${Y.LIST_VARIABLE_TYPE}`,c="[]";e.push(`${u} = ${c}`)}const i=Y.Variables.allDeveloperVariables(t);for(let n=0;n<i.length;n++){let u=this.variableDB_.getName(i[n],Y.Names.DEVELOPER_VARIABLE_TYPE),c="0";if(o[n].type===Y.LIST_VARIABLE_TYPE)u=`${u}_${Y.LIST_VARIABLE_TYPE}`,c="[]";e.push(`${u} = ${c}`)}if(e.length)this.definitions_.variables=e.join("\n")}finish(t){const e=[],o=[];for(let n in this.definitions_){const u=this.definitions_[n];if(u.match(/^(from\s+\S+\s+)?import\s+\S+/))e.push(u);else o.push(u)}return delete this.definitions_,delete this.functionNames_,this.variableDB_.reset(),(e.join("\n")+"\n\n"+o.join("\n\n")).replace(/\n\n+/g,"\n\n").replace(/\n*$/,"\n\n\n")+t}scrubNakedValue(t){return t+"\n"}quote_(t){let e='"';if(t.indexOf('"')!==-1)if(t.indexOf("'")===-1)e="'";else t=t.replace(/"/g,'\\"');return e+t+e}scrub_(t,e){let o="";if(!t.outputConnection?.targetConnection){let i=t.getCommentText();if(i=Y.utils.wrap(i,this.COMMENT_WRAP-3),i)if(t.getProcedureDef)o+='"""'+i+'\n"""\n';else o+=this.prefixLines(i+"\n","# ");for(let n=0;n<t.inputList.length;n++)if(t.inputList[n].type==Y.INPUT_VALUE){const u=t.inputList[n].connection.targetBlock();if(u){const c=this.allNestedComments(u);if(c)o+=this.prefixLines(c,"# ")}}}if(t.startHat_){const i=t.nextConnection&&t.nextConnection.targetBlock();let n=this.blockToCode(i);if(n)n=this.prefixLines(n,this.INDENT),e=e.replace(`\n${this.PASS}`,`\n${n}`);return o+e}if(t.parentBlock_){const i=t.nextConnection&&t.nextConnection.targetBlock(),n=this.blockToCode(i);return o+e+n}}getAdjustedInt(t,e,o,i){let n=o||0;if(t.workspace.options.oneBasedIndex)n--;const u=t.workspace.options.oneBasedIndex?"1":"0",c=n?this.ORDER_ADDITIVE:this.ORDER_NONE;let l=this.valueToCode(t,e,c)||u;if(Y.isNumber(l)){if(l=parseInt(l,10)+n,i)l=-l}else{if(n>0)l="int("+l+" + "+n+")";else if(n<0)l="int("+l+" - "+-n+")";else l="int("+l+")";if(i)l="-"+l}return l}functionToCode(t,e){return`async def ${t}(${e.join(",")}):\n  this_func = ${t}\n${this.PASS}\n`}eventToCode(t,...e){const o=this.variableDB_.getName(t,Y.Variables.NAME_TYPE);if(!this.functionNames_[o])this.functionNames_[o]=0;this.functionNames_[o]+=1;const i=`${t}_${this.functionNames_[o]}`;return this.functionToCode(i,e)}}var s=gt.prototype;var Ee=(t)=>{const e=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;t=t.replace(e,(i,n,u,c)=>n+n+u+u+c+c);const o=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return o?{r:parseInt(o[1],16),g:parseInt(o[2],16),b:parseInt(o[3],16)}:null};s.colour_picker=function(t){const{r:e,g:o,b:i}=Ee(t.getFieldValue("COLOUR"));return[`(${e}, ${o}, ${i})`,this.ORDER_ATOMIC]};var wt="  await runtime.next_frame()\n";s.control_wait=function(t){let e="";if(this.STATEMENT_PREFIX)e+=this.injectId(this.STATEMENT_PREFIX,t);const o=this.valueToCode(t,"DURATION",this.ORDER_NONE)||0;return e+=`await runtime.wait_for(num(${o}))\n`,e};s.control_repeat=function(t){let e="";if(this.STATEMENT_PREFIX)e+=this.injectId(this.STATEMENT_PREFIX,t);let o=this.statementToCode(t,"SUBSTACK")||this.PASS;if(this.STATEMENT_SUFFIX)o=this.prefixLines(this.injectId(this.STATEMENT_SUFFIX,t),this.INDENT)+o;const i=this.valueToCode(t,"TIMES",this.ORDER_NONE)||10;return e+=`for _ in range(num(${i})):\n${o}${wt}`,e};s.control_forever=function(t){let e="";if(this.STATEMENT_PREFIX)e+=this.injectId(this.STATEMENT_PREFIX,t);let o=this.statementToCode(t,"SUBSTACK")||this.PASS;if(this.STATEMENT_SUFFIX)o=this.prefixLines(this.injectId(this.STATEMENT_SUFFIX,t),this.INDENT)+o;return e+=`while True:\n${o}${wt}`,e};s.control_if=function(t){let e="";if(this.STATEMENT_PREFIX)e+=this.injectId(this.STATEMENT_PREFIX,t);let o=this.statementToCode(t,"SUBSTACK")||this.PASS;if(this.STATEMENT_SUFFIX)o=this.prefixLines(this.injectId(this.STATEMENT_SUFFIX,t),this.INDENT)+o;const i=this.valueToCode(t,"CONDITION",this.ORDER_NONE)||"False";if(e+=`if ${i}:\n${o}`,t.getInput("SUBSTACK2")){if(o=this.statementToCode(t,"SUBSTACK2")||this.PASS,this.STATEMENT_SUFFIX)o=this.prefixLines(this.injectId(this.STATEMENT_SUFFIX,t),this.INDENT)+o;e+=`else:\n${o}`}return e};s.control_if_else=s.control_if;s.control_wait_until=function(t){let e="";if(this.STATEMENT_PREFIX)e+=this.injectId(this.STATEMENT_PREFIX,t);const o=this.valueToCode(t,"CONDITION",this.ORDER_NONE)||"False";return e+=`while not ${o}:\n${wt}`,e};s.control_repeat_until=function(t){let e="";if(this.STATEMENT_PREFIX)e+=this.injectId(this.STATEMENT_PREFIX,t);let o=this.statementToCode(t,"SUBSTACK")||this.PASS;if(this.STATEMENT_SUFFIX)o=this.prefixLines(this.injectId(this.STATEMENT_SUFFIX,t),this.INDENT)+o;const i=this.valueToCode(t,"CONDITION",this.ORDER_NONE)||"False";return e+=`while not ${i}:\n${o}${wt}`,e};s.control_while=function(t){let e="";if(this.STATEMENT_PREFIX)e+=this.injectId(this.STATEMENT_PREFIX,t);let o=this.statementToCode(t,"SUBSTACK")||this.PASS;if(this.STATEMENT_SUFFIX)o=this.prefixLines(this.injectId(this.STATEMENT_SUFFIX,t),this.INDENT)+o;const i=this.valueToCode(t,"CONDITION",this.ORDER_NONE)||"False";return e+=`while ${i}:\n${o}${wt}`,e};s.control_stop=function(t){let e="";if(this.STATEMENT_PREFIX)e+=this.injectId(this.STATEMENT_PREFIX,t);switch(t.getFieldValue("STOP_OPTION")){case"all":e+="runtime.stop()\n";break;case"this script":e+="return\n";break;case"other scripts in sprite":e+="runtime.stop_tasks(this_func)\n";break}return e};import{ScratchBlocks as S}from"@blockcode/blocks-editor";s.data_variable=function(t){return[this.variableDB_.getName(t.getFieldValue("VARIABLE"),S.Variables.NAME_TYPE),this.ORDER_ATOMIC]};s.data_setvariableto=function(t){let e="";if(s.STATEMENT_PREFIX)e+=s.injectId(s.STATEMENT_PREFIX,t);const o=this.variableDB_.getName(t.getFieldValue("VARIABLE"),S.Variables.NAME_TYPE),i=this.valueToCode(t,"VALUE",this.ORDER_NONE)||'""';return e+=`${o} = ${i}\n`,e};s.data_changevariableby=function(t){let e="";if(s.STATEMENT_PREFIX)e+=s.injectId(s.STATEMENT_PREFIX,t);const o=this.variableDB_.getName(t.getFieldValue("VARIABLE"),S.Variables.NAME_TYPE),i=this.valueToCode(t,"VALUE",this.ORDER_NONE)||0;return e+=`${o} = num(${o}) + num(${i})\n`,e};s.data_listcontents=function(t){return[this.variableDB_.getName(t.getFieldValue("LIST"),S.Variables.NAME_TYPE)+"_"+S.LIST_VARIABLE_TYPE,this.ORDER_ATOMIC]};s.data_addtolist=function(t){let e="";if(this.STATEMENT_PREFIX)e+=this.injectId(this.STATEMENT_PREFIX,t);const o=this.variableDB_.getName(t.getFieldValue("LIST"),S.Variables.NAME_TYPE)+"_"+S.LIST_VARIABLE_TYPE,i=this.valueToCode(t,"ITEM",this.ORDER_NONE)||'""';return e+=`${o}.append(${i})\n`,e};s.data_deleteoflist=function(t){let e="";if(this.STATEMENT_PREFIX)e+=this.injectId(this.STATEMENT_PREFIX,t);const o=this.variableDB_.getName(t.getFieldValue("LIST"),S.Variables.NAME_TYPE)+"_"+S.LIST_VARIABLE_TYPE,i=this.valueToCode(t,"INDEX",this.ORDER_NONE)||1;return e+=`${o}.remove(runtime.index(${i}, len(${o})))\n`,e};s.data_deletealloflist=function(t){let e="";if(this.STATEMENT_PREFIX)e+=this.injectId(this.STATEMENT_PREFIX,t);const o=this.variableDB_.getName(t.getFieldValue("LIST"),S.Variables.NAME_TYPE)+"_"+S.LIST_VARIABLE_TYPE;return e+=`${o} = []\n`,e};s.data_insertatlist=function(t){let e="";if(this.STATEMENT_PREFIX)e+=this.injectId(this.STATEMENT_PREFIX,t);const o=this.variableDB_.getName(t.getFieldValue("LIST"),S.Variables.NAME_TYPE)+"_"+S.LIST_VARIABLE_TYPE,i=this.valueToCode(t,"INDEX",this.ORDER_NONE)||1,n=this.valueToCode(t,"ITEM",this.ORDER_NONE)||'""';return e+=`${o}.insert(runtime.index(${i}, len(${o})), ${n})\n`,e};s.data_replaceitemoflist=function(t){let e="";if(this.STATEMENT_PREFIX)e+=this.injectId(this.STATEMENT_PREFIX,t);const o=this.variableDB_.getName(t.getFieldValue("LIST"),S.Variables.NAME_TYPE)+"_"+S.LIST_VARIABLE_TYPE,i=this.valueToCode(t,"INDEX",this.ORDER_NONE)||1,n=this.valueToCode(t,"ITEM",this.ORDER_NONE)||'""';return e+=`${o}[runtime.index(${i}, len(${o}))] = ${n}\n`,e};s.data_itemoflist=function(t){const e=this.variableDB_.getName(t.getFieldValue("LIST"),S.Variables.NAME_TYPE)+"_"+S.LIST_VARIABLE_TYPE,o=this.valueToCode(t,"INDEX",this.ORDER_NONE)||1;return[`${e}[runtime.index(${o}, len(${e}))]`,this.ORDER_CONDITIONAL]};s.data_itemnumoflist=function(t){const e=this.variableDB_.getName(t.getFieldValue("LIST"),S.Variables.NAME_TYPE)+"_"+S.LIST_VARIABLE_TYPE,o=this.valueToCode(t,"ITEM",this.ORDER_NONE)||0;return[`(${e}.index(${o}) + 1)`,this.ORDER_NONE]};s.data_lengthoflist=function(t){return[`len(${this.variableDB_.getName(t.getFieldValue("LIST"),S.Variables.NAME_TYPE)+"_"+S.LIST_VARIABLE_TYPE})`,this.ORDER_FUNCTION_CALL]};s.data_listcontainsitem=function(t){const e=this.variableDB_.getName(t.getFieldValue("LIST"),S.Variables.NAME_TYPE)+"_"+S.LIST_VARIABLE_TYPE,o=this.valueToCode(t,"ITEM",this.ORDER_NONE)||0;return[`bool(${e}.count(${o}))`,this.ORDER_FUNCTION_CALL]};import{ScratchBlocks as E1}from"@blockcode/blocks-editor";s.event_whenflagclicked=function(){return`@when_start\n${this.eventToCode("start")}`};s.event_whengreaterthan=function(t){const e=t.getFieldValue("WHENGREATERTHANMENU"),o=this.valueToCode(t,"VALUE",this.ORDER_NONE)||0,i=this.eventToCode("greaterthen");return`@when_greaterthen("${e}", num(${o}))\n${i}`};s.event_whenbroadcastreceived=function(t){const e=this.variableDB_.getName(t.getFieldValue("BROADCAST_OPTION"),E1.Variables.NAME_TYPE),o=this.eventToCode("broadcastreceived");return`@when_broadcastreceived("${e}")\n${o}`};s.event_broadcast_menu=function(t){return[this.variableDB_.getName(t.getFieldValue("BROADCAST_OPTION"),E1.Variables.NAME_TYPE),this.ORDER_ATOMIC]};s.event_broadcast=function(t){return`runtime.broadcast("${this.valueToCode(t,"BROADCAST_INPUT",this.ORDER_NONE)||'"message1"'}")\n`};s.event_broadcastandwait=function(t){return`await runtime.broadcast("${this.valueToCode(t,"BROADCAST_INPUT",this.ORDER_NONE)||'"message1"'}", waiting=True)\n`};s.math_number=function(t){let e=parseFloat(t.getFieldValue("NUM")),o;if(e===1/0)e='float("inf")',o=this.ORDER_FUNCTION_CALL;else if(e===-1/0)e='-float("inf")',o=this.ORDER_UNARY_SIGN;else if(Number.isNaN(e))e='float("nan")',o=this.ORDER_UNARY_SIGN;else o=e<0?this.ORDER_UNARY_SIGN:this.ORDER_ATOMIC;return[e,o]};s.math_integer=function(t){const e=parseInt(t.getFieldValue("NUM")),o=e<0?this.ORDER_UNARY_SIGN:this.ORDER_ATOMIC;return[e,o]};s.math_whole_number=function(t){return[Math.abs(parseInt(t.getFieldValue("NUM"))),this.ORDER_ATOMIC]};s.math_positive_number=function(t){let e=parseFloat(t.getFieldValue("NUM")),o;if(e===1/0)e='float("inf")',o=this.ORDER_FUNCTION_CALL;else if(e===-1/0)e='-float("inf")',o=this.ORDER_FUNCTION_CALL;else if(Number.isNaN(e))e='float("nan")',o=this.ORDER_FUNCTION_CALL;else e=e<0?0:e,o=this.ORDER_ATOMIC;return[e,o]};s.math_angle=function(t){let e=parseFloat(t.getFieldValue("NUM")),o;if(e==1/0)e='float("inf")',o=this.ORDER_FUNCTION_CALL;else if(e==-1/0)e='-float("inf")',o=this.ORDER_UNARY_SIGN;else e=e%360,e=e<0?e+360:e,o=this.ORDER_ATOMIC;return[e,o]};s.operator_add=function(t){const e=this.valueToCode(t,"NUM1",this.ORDER_NONE)||0,o=this.valueToCode(t,"NUM2",this.ORDER_NONE)||0;return[`(num(${e}) + num(${o}))`,this.ORDER_SUBTRACTION]};s.operator_subtract=function(t){const e=this.valueToCode(t,"NUM1",this.ORDER_NONE)||0,o=this.valueToCode(t,"NUM2",this.ORDER_NONE)||0;return[`(num(${e}) - num(${o}))`,this.ORDER_SUBTRACTION]};s.operator_multiply=function(t){const e=this.valueToCode(t,"NUM1",this.ORDER_NONE)||0,o=this.valueToCode(t,"NUM2",this.ORDER_NONE)||0;return[`(num(${e}) * num(${o}))`,this.ORDER_SUBTRACTION]};s.operator_divide=function(t){const e=this.valueToCode(t,"NUM1",this.ORDER_NONE)||0,o=this.valueToCode(t,"NUM2",this.ORDER_NONE)||0;return[`(num(${e}) / num(${o}))`,this.ORDER_SUBTRACTION]};s.operator_random=function(t){const e=this.valueToCode(t,"FROM",this.ORDER_NONE)||0,o=this.valueToCode(t,"TO",this.ORDER_NONE)||0;return[`runtime.random(${e}, ${o})`,this.ORDER_FUNCTION_CALL]};s.operator_gt=function(t){const e=this.valueToCode(t,"OPERAND1",this.ORDER_NONE)||0,o=this.valueToCode(t,"OPERAND2",this.ORDER_NONE)||0;return[`(num(${e}) > num(${o}))`,this.ORDER_RELATIONAL]};s.operator_lt=function(t){const e=this.valueToCode(t,"OPERAND1",this.ORDER_NONE)||0,o=this.valueToCode(t,"OPERAND2",this.ORDER_NONE)||0;return[`(num(${e}) < num(${o}))`,this.ORDER_RELATIONAL]};s.operator_equals=function(t){const e=this.valueToCode(t,"OPERAND1",this.ORDER_NONE)||0,o=this.valueToCode(t,"OPERAND2",this.ORDER_NONE)||0;return[`equals(${e}, ${o})`,this.ORDER_FUNCTION_CALL]};s.operator_and=function(t){const e=this.valueToCode(t,"OPERAND1",this.ORDER_NONE)||"False",o=this.valueToCode(t,"OPERAND2",this.ORDER_NONE)||"False";return[`(${e} and ${o})`,this.ORDER_LOGICAL_AND]};s.operator_or=function(t){const e=this.valueToCode(t,"OPERAND1",this.ORDER_NONE)||"False",o=this.valueToCode(t,"OPERAND2",this.ORDER_NONE)||"False";return[`(${e} or ${o})`,this.ORDER_LOGICAL_OR]};s.operator_not=function(t){return[`(not ${this.valueToCode(t,"OPERAND",this.ORDER_NONE)||"False"})`,this.ORDER_LOGICAL_NOT]};s.operator_join=function(t){const e=this.valueToCode(t,"STRING1",this.ORDER_NONE)||'""',o=this.valueToCode(t,"STRING2",this.ORDER_NONE)||'""';return[`(str(${e}) + str(${o}))`,this.ORDER_ATOMIC]};s.operator_letter_of=function(t){const e=this.valueToCode(t,"LETTER",this.ORDER_NONE)||0;return[`(str(${this.valueToCode(t,"STRING",this.ORDER_NONE)||'""'})[num(${e}) - 1] || "")`,this.ORDER_MEMBER]};s.operator_length=function(t){return[`len(str(${this.valueToCode(t,"STRING",this.ORDER_NONE)||'""'}))`,this.ORDER_FUNCTION_CALL]};s.operator_contains=function(t){const e=this.valueToCode(t,"STRING1",this.ORDER_NONE)||'""',o=this.valueToCode(t,"STRING2",this.ORDER_NONE)||'""';return[`(str(${e}).count(str(${o})) > 0)`,this.ORDER_FUNCTION_CALL]};s.operator_mod=function(t){const e=this.valueToCode(t,"NUM1",this.ORDER_NONE)||0,o=this.valueToCode(t,"NUM2",this.ORDER_NONE)||0;return[`(num(${e}) % num(${o}))`,this.ORDER_MODULUS]};s.operator_round=function(t){return this.definitions_.import_math="import math",[`math.round(num(${this.valueToCode(t,"NUM",this.ORDER_NONE)||0}))`,this.ORDER_FUNCTION_CALL]};s.operator_mathop=function(t){this.definitions_.import_math="import math";const e=this.valueToCode(t,"NUM",this.ORDER_NONE)||0,o=t.getFieldValue("OPERATOR");let i="";if(o==="ceiling")i+=`math.ceil(num(${e}))`;else if(o==="sin"||o==="cos"||o==="tan")i+=`math.${o}(math.radians(num(${e})))`;else if(o==="asin"||o==="acos"||o==="atan")i+=`math.degrees(math.${o}(num(${e})))`;else if(o==="ln")i+=`(math.log(num(${e}))`;else if(o==="log")i+=`(math.log10(num(${e}))`;else if(o==="e ^")i+=`math.exp(num(${e}))`;else if(o==="10 ^")i+=`math.pow(10, num(${e}))`;else i+=`math.${o}(num(${e}))`;return[i,this.ORDER_FUNCTION_CALL]};import{ScratchBlocks as Mt}from"@blockcode/blocks-editor";s.procedures_definition=function(t){const e=t.childBlocks_[0],o=this.variableDB_.getName(e.getProcCode(),Mt.Procedures.NAME_TYPE),i=e.childBlocks_.map((n)=>this.variableDB_.getName(n.getFieldValue("VALUE"),Mt.Variables.NAME_TYPE));return this.functionToCode(o,i)};s.procedures_call=function(t){const e=this.variableDB_.getName(t.getProcCode(),Mt.Procedures.NAME_TYPE),o=t.argumentIds_.map((i)=>this.valueToCode(t,i,this.ORDER_NONE));return`await ${e}(${o.join(",")})\n`};s.argument_reporter_boolean=function(t){return[this.variableDB_.getName(t.getFieldValue("VALUE"),Mt.Variables.NAME_TYPE),this.ORDER_ATOMIC]};s.argument_reporter_string_number=function(t){return[this.variableDB_.getName(t.getFieldValue("VALUE"),Mt.Variables.NAME_TYPE),this.ORDER_ATOMIC]};s.sensing_timer=function(){return["runtime.time",this.ORDER_MEMBER]};s.sensing_resettimer=function(){return"runtime.reset_timer()\n"};s.text=function(t){const e=t.getFieldValue("TEXT");return[e.length===0||isNaN(e)?this.quote_(e):+e,this.ORDER_ATOMIC]};class p1 extends gt{init(t){super.init(t),this.definitions_.import_blocks="from blocks import *"}}var _1=new p1;import{useEffect as We,useState as bt}from"preact/hooks";import{useLocale as Xe,useLayout as Ke,useEditor as D1}from"@blockcode/core";import{classNames as Ye}from"@blockcode/ui";import{BlocksEditor as Ze,ScratchBlocks as U,makeToolboxXML as He}from"@blockcode/blocks-editor";import{ScratchBlocks as Ht,blockSeparator as pe}from"@blockcode/blocks-editor";var _e=1,Ne=2,Te=3,Gt="#0FBD8C",kt="#0DA57A",N1="#0B8E69",rt=(t)=>{if(typeof t!=="string")if(Array.isArray(t))t=String(t);else return t;return t.replace(/[<>&'"]/g,(e)=>{switch(e){case"<":return"&lt;";case">":return"&gt;";case"&":return"&amp;";case"'":return"&apos;";case'"':return"&quot;"}})},T1={number:"math_number",angle:"math_angle",text:"text",string:"text",color:"colour_picker",matrix:"matrix",note:"note"},C1={number:"NUM",angle:"NUM",text:"TEXT",string:"TEXT",matrix:"MATRIX",note:"NOTE"};function zt(t,e,o,i,n){const{id:u}=e,c=i(e.name);let l=`<category name="${rt(c)}" id="${rt(u)}"`;if(l+=` colour="${rt(e.themeColor||Gt)}"`,l+=` secondaryColour="${rt(e.inputColor||kt)}"`,e.connectionConfig)l+=' showStatusButton="true"';if(e.iconURI)l+=` iconURI="${rt(e.iconURI)}"`;return l+=">",e.menus=e.menus||{},e.blocks.filter((m)=>!m.hidden).forEach((m)=>{if(m==="---"){l+=`${pe}`;return}if(m.button){l+=`<button text="${i(m.text)}" callbackKey="${m.button}"></button>`;const E=Ht.getMainWorkspace();if(E){const p=E.getFlyout();if(p){const T=p.getWorkspace();if(T)T.registerButtonCallback(m.button,n(m.onClick))}}return}if(o&&m.useStage===!1)return;if(!o&&m.useSprite===!1)return;const A=`${u}_${m.id}`,C={message0:i(m.text),category:u,outputShape:Te,colour:e.themeColor||Gt,colourSecondary:e.inputColor||kt,colourTertiary:e.otherColor||N1};let _=1;if(e.iconURI)C.message0=`%1 %2 ${C.message0}`,C.args0=[{type:"field_image",src:e.iconURI,width:40,height:40},{type:"field_vertical_separator"}],C.extensions=["scratch_extension"],_+=2;if(m.hat)C.nextStatement=null;else if(m.output){if(m.output==="boolean")C.output="Boolean",C.outputShape=_e;else C.output="String",C.outputShape=Ne;C.checkboxInFlyout=m.monitoring!==!1}else C.previousStatement=null,C.nextStatement=null;let f=`<block type="${rt(A)}">`;if(m.inputs)C.checkboxInFlyout=!1,C.args0=[].concat(C.args0||[],Object.entries(m.inputs).map(([E,p])=>{const T={name:E,type:"input_value"};if(p.menu){let b=p.menu,W=p.name||E,F=p.inputMode||!1,K=p.type||"string",I=p.default||"";if(typeof p.menu==="string")W=p.menu,b=e.menus[W];if(!Array.isArray(b))F=b.inputMode||F,K=b.type||K,I=b.default||I,b=b.items;if(F){if(!e.menus[W])e.menus[W]={inputMode:F,type:K,items:b};if(f+=`<value name="${rt(E)}">`,f+=`<shadow type="${u}_menu_${W}">`,I)f+=`<field name="${W}">${rt(i(I))}</field>`;f+="</shadow></value>"}else if(b)T.type="field_dropdown",T.options=b.map((H)=>{if(Array.isArray(H)){const[lt,ht]=H;return[i(lt),ht]}return H=`${H}`,[H,H]})}else if(p.type==="boolean")T.check="Boolean";else{if(f+=`<value name="${rt(E)}">`,T1[p.type]){if(f+=`<shadow type="${T1[p.type]}">`,p.default&&C1[p.type])f+=`<field name="${C1[p.type]}">${rt(i(p.default))}</field>`;f+="</shadow>"}f+="</value>"}return C.message0=C.message0.replace(`[${E}]`,`%${_++}`),T}));Ht.Blocks[A]={init(){this.jsonInit(C)}};for(let E of t){const p=E.name_.toLowerCase();if(m[p])E[A]=m[p].bind(E);else E[A]=()=>""}f+="</block>",l+=f}),Object.entries(e.menus).forEach(([m,A])=>{if(!A.inputMode)return;const C=`${u}_menu_${m}`,_=A.type==="number"?"output_number":"output_string",f={message0:"%1",args0:[{type:"field_dropdown",name:m,options:A.items.map((E)=>{if(Array.isArray(E)){const[p,T]=E;return[i(p),T]}return E=`${E}`,[E,E]})}],category:u,colour:e.themeColor||Gt,colourSecondary:e.inputColor||kt,colourTertiary:e.otherColor||N1,extensions:[_]};Ht.Blocks[C]={init(){this.jsonInit(f)}};for(let E of t)E[C]=(p)=>{return[p.getFieldValue(m),E.ORDER_ATOMIC]}}),l+="</category>",l}import{useRef as Ce,useEffect as fe,useState as f1}from"preact/hooks";import{classNames as Re,Text as ft,Button as R1,Modal as Oe,BufferedInput as Ae}from"@blockcode/ui";function ut(t){const e=globalThis.document,o=e.createElement("style");o.appendChild(e.createTextNode(t)),e.head.append(o)}ut("._5SVWFW_prompt-modal{width:360px}._5SVWFW_prompt-content{background:var(--ui-white);padding:1.5rem 2.25rem}._5SVWFW_prompt-content input[type=checkbox],._5SVWFW_prompt-content input[type=radio]{margin:3px}._5SVWFW_label{margin:0 0 .75rem;font-weight:500}._5SVWFW_variable-name-text-input{border:1px solid var(--ui-black-transparent);color:var(--text-primary-transparent);border-radius:5px;width:100%;height:3rem;margin-bottom:1.5rem;padding:0 1rem;font-size:.875rem}._5SVWFW_info-message{text-align:center;margin-bottom:1.5rem;font-size:.875rem;font-weight:400}._5SVWFW_options{justify-content:space-between;margin-bottom:1.5rem;font-weight:400;display:flex}._5SVWFW_button-row{text-align:right;font-weight:bolder}._5SVWFW_button{padding:.75rem 1rem;font-size:.85rem;font-weight:600}._5SVWFW_ok-button{background:var(--motion-primary);border:var(--motion-primary);color:var(--ui-white);margin-left:var(--space)}");var nt={variableNameTextInput:"_5SVWFW_variable-name-text-input",options:"_5SVWFW_options",label:"_5SVWFW_label",infoMessage:"_5SVWFW_info-message",promptModal:"_5SVWFW_prompt-modal",promptContent:"_5SVWFW_prompt-content",button:"_5SVWFW_button",okButton:"_5SVWFW_ok-button",buttonRow:"_5SVWFW_button-row"};import{jsx as Z,jsxs as vt}from"preact/jsx-runtime";function Jt({title:t,label:e,defaultValue:o,enableLocalVariable:i,showListMessage:n,showVariableOptions:u,showCloudOption:c,onClose:l,onSubmit:m}){const A=Ce(null),[C,_]=f1(o),[f,E]=f1({scope:"global",isCloud:!1}),p=()=>{m(C,f)},T=(b)=>{if(b.key==="Escape")l();if(b.key==="Enter")m(A.current.base.value,f)};return fe(()=>{if(A.current)A.current.base.focus(),window.addEventListener("keydown",T);return()=>{window.removeEventListener("keydown",T)}},[A]),Z(Oe,{title:t,className:nt.promptModal,onClose:l,children:vt("div",{className:nt.promptContent,children:[Z("div",{className:nt.label,children:e}),Z(Ae,{autoFocus:!0,forceFocus:!0,ref:A,className:nt.variableNameTextInput,defaultValue:C,onSubmit:_}),u&&Z("div",{children:i?vt("div",{className:nt.options,children:[vt("label",{children:[Z("input",{checked:f.scope==="global",name:"variableScopeOption",type:"radio",value:"global",onChange:()=>E({...f,scope:"global"})}),Z(ft,{id:"blocks.dataPrompt.forAllTargets",defaultMessage:"For all targets"})]}),vt("label",{children:[Z("input",{checked:f.scope==="local",name:"variableScopeOption",type:"radio",value:"local",onChange:()=>E({...f,scope:"local"})}),Z(ft,{id:"blocks.dataPrompt.forThisTarget",defaultMessage:"For this target only"})]})]}):Z("div",{className:nt.infoMessage,children:n?Z(ft,{id:"blocks.dataPrompt.listAvailableToAllTargets",defaultMessage:"This list will be available to all targets."}):Z(ft,{id:"blocks.dataPrompt.availableToAllTargets",defaultMessage:"This variable will be available to all targets."})})}),vt("div",{className:nt.buttonRow,children:[Z(R1,{className:nt.button,onClick:l,children:Z(ft,{id:"blocks.prompt.cancel",defaultMessage:"Cancel"})}),Z(R1,{className:Re(nt.button,nt.okButton),onClick:p,children:Z(ft,{id:"blocks.prompt.ok",defaultMessage:"OK"})})]})]})})}import{useRef as ve,useEffect as be,useState as De}from"preact/hooks";import{classNames as Le,Text as pt,Button as w1,Modal as Ie}from"@blockcode/ui";import{ScratchBlocks as It}from"@blockcode/blocks-editor";ut(".ObKnhW_prompt-modal{width:700px;margin:50px auto}.ObKnhW_body{background:var(--ui-white);padding:1.5rem 2.25rem}.ObKnhW_body input[type=checkbox],.ObKnhW_body input[type=radio]{margin:3px}.ObKnhW_workspace{min-height:200px;position:relative}.ObKnhW_workspace .injectionDiv{position:absolute;inset:0}.ObKnhW_workspace .blocklySvg{background-color:var(--ui-primary)}.ObKnhW_options-row{justify-content:space-between;display:flex}.ObKnhW_option-card{border:2px solid var(--ui-black-transparent);border-radius:var(--space);padding:calc(var(--space)*2);text-align:center;cursor:pointer;background:#fff;flex-grow:1;flex-basis:100px;transition:all .2s}.ObKnhW_option-card:hover{border:2px solid var(--motion-primary);box-shadow:0px 0px 0px 4px var(--motion-transparent)}.ObKnhW_option-card+.ObKnhW_option-card{margin-left:1rem}.ObKnhW_option-icon{max-height:48px;margin-bottom:.5rem}.ObKnhW_option-title{font-weight:700}.ObKnhW_radiobox-row{justify-content:space-between;margin:1rem 6rem 1.5rem;font-weight:400;display:flex}.ObKnhW_button-row{text-align:right;margin-top:1rem;font-weight:bolder}.ObKnhW_button-row button{border:1px solid var(--ui-black-transparent);background:#fff;border-radius:.25rem;padding:.75rem 1rem;font-size:.85rem;font-weight:700}.ObKnhW_button-row button.ObKnhW_ok-button{background:var(--motion-primary);border:var(--motion-primary);color:#fff}.ObKnhW_button-row button+button{margin-left:.5rem}");var y={optionIcon:"ObKnhW_option-icon",okButton:"ObKnhW_ok-button",workspace:"ObKnhW_workspace",radioboxRow:"ObKnhW_radiobox-row",buttonRow:"ObKnhW_button-row",optionTitle:"ObKnhW_option-title",body:"ObKnhW_body",promptModal:"ObKnhW_prompt-modal",optionCard:"ObKnhW_option-card",optionsRow:"ObKnhW_options-row"};var O1="./assets/icon-boolean-input-v045mxhp.svg";var A1="./assets/icon-text-input-3m98080h.svg";var g1="./assets/icon-label-a0d2gknc.svg";import{jsx as V,jsxs as Tt}from"preact/jsx-runtime";var Se={zoom:{controls:!1,wheel:!1,startScale:0.9},comments:!1,collapse:!1,scrollbars:!0};function Qt({mutator:t,onClose:e,onSubmit:o}){const i=ve(null),[n,u]=De("command"),c=()=>{},l=()=>{if(i.mutationRoot)i.mutationRoot.addLabelExternal()},m=()=>{if(i.mutationRoot)i.mutationRoot.addBooleanExternal()},A=()=>{if(i.mutationRoot)i.mutationRoot.addStringNumberExternal()},C=()=>{o(i.mutationRoot?.mutationToDom(!0))};return be(()=>{if(i.current){const _=It.Blocks.defaultToolbox;It.Blocks.defaultToolbox=null,i.workspace=It.inject(i.current,Object.assign({},Se,{media:"./assets/blocks-media/"})),It.Blocks.defaultToolbox=_,i.mutationRoot=i.workspace.newBlock("procedures_declaration"),i.mutationRoot.setMovable(!1),i.mutationRoot.setDeletable(!1),i.mutationRoot.contextMenu=!1,i.workspace.addChangeListener(()=>{i.mutationRoot.onChangeFn();const f=i.workspace.getMetrics(),{x:E,y:p}=i.mutationRoot.getRelativeToSurfaceXY(),T=f.viewHeight/2-i.mutationRoot.height/2-p;let b=f.viewWidth/2-i.mutationRoot.width/2-E;if(i.mutationRoot.width>f.viewWidth)b=f.viewWidth-i.mutationRoot.width-E;i.mutationRoot.moveBy(b,T)}),i.mutationRoot.domToMutation(t),i.mutationRoot.initSvg(),i.mutationRoot.render(),setTimeout(()=>{i.mutationRoot.focusLastEditor_()})}return()=>{if(i.workspace)i.workspace.dispose()}},[i]),Tt(Ie,{title:V(pt,{id:"blocks.myBlockPrompt.title",defaultMessage:"Make a Block"}),className:y.promptModal,onClose:e,children:[V("div",{ref:i,className:y.workspace}),Tt("div",{className:y.body,children:[Tt("div",{className:y.optionsRow,children:[Tt("div",{role:"button",className:y.optionCard,onClick:A,children:[V("img",{className:y.optionIcon,src:A1}),V("div",{className:y.optionTitle,children:V(pt,{id:"blocks.myBlockPrompt.addAnInputNumberText",defaultMessage:"Add an input"})}),V("div",{className:y.optionDescription,children:V(pt,{id:"blocks.myBlockPrompt.numberTextType",defaultMessage:"number or text"})})]}),Tt("div",{role:"button",className:y.optionCard,onClick:m,children:[V("img",{className:y.optionIcon,src:O1}),V("div",{className:y.optionTitle,children:V(pt,{id:"blocks.myBlockPrompt.addAnInputBoolean",defaultMessage:"Add an input"})}),V("div",{className:y.optionDescription,children:V(pt,{id:"blocks.myBlockPrompt.booleanType",defaultMessage:"boolean"})})]}),Tt("div",{role:"button",className:y.optionCard,onClick:l,children:[V("img",{className:y.optionIcon,src:g1}),V("div",{className:y.optionTitle,children:V(pt,{id:"blocks.myBlockPrompt.addALabel",defaultMessage:"Add a label"})})]})]}),Tt("div",{className:y.buttonRow,children:[V(w1,{className:y.button,onClick:e,children:V(pt,{id:"blocks.prompt.cancel",defaultMessage:"Cancel"})}),V(w1,{className:Le(y.button,y.okButton),onClick:C,children:V(pt,{id:"blocks.prompt.ok",defaultMessage:"OK"})})]})]})]})}import{useEffect as Fe,useState as v1}from"preact/hooks";import{useLocale as Pe}from"@blockcode/core";import{Library as ye}from"@blockcode/ui";var M1=["brain","broadcast","color-sensor","light","mqtt","nes","pen","request","servo","text","time","translate","wedo2"].map(async(t)=>{const{default:e}=await import(`@blockcode/extension-${t}`);return e.id=t,e});import{jsx as Ve}from"preact/jsx-runtime";var $e=Promise.all(M1);function Bt({onSelect:t,onClose:e,onFilter:o}){const[i,n]=v1([]),[u,c]=v1(!1),{language:l,getText:m}=Pe(),A=(C)=>{const _=C.tags||[];let f=["blocks"];if(o)f=o(_);if(Array.isArray(f))return f.some((E)=>{if(Array.isArray(E))return E.every((p)=>p[0]==="!"?!_.includes(p.slice(1)):_.includes(p));return _.includes(E)});return f};return Fe(()=>{$e.then((C)=>{n(C.filter(A).map((_)=>Object.assign({..._,featured:!0,hidden:_.hidden||window.electron&&(_.preview||_.disabled),disabled:_.disabled||_.preview,onSelect:()=>{t(_.id),e()}},_.translations&&_.translations[l]?{name:_.translations[l].name||_.name,description:_.translations[l].description||_.description,collaborator:_.translations[l].collaborator||_.collaborator}:{}))),c(!1)})},[]),Ve(ye,{filterable:!0,loading:u,items:i,filterPlaceholder:m("gui.library.search","Search"),title:m("blocks.extensions.addExtension","Add Extension"),emptyText:m("blocks.extensions.empty","No extension!"),onClose:e})}ut(".cujmXa_editor-wrapper{border-radius:inherit;width:100%;height:100%;position:relative}.cujmXa_extension-button{z-index:var(--z-index-extension-button);background:var(--motion-primary);border:1px solid var(--motion-primary);box-sizing:content-box;border-bottom-left-radius:inherit;border-top:0;height:3.25rem;position:absolute;bottom:-1px;left:-1px}.cujmXa_extension-button:before{--fade-out-distance:15px;content:\"\";top:calc(calc(-1*var(--fade-out-distance)));height:var(--fade-out-distance);background:linear-gradient(#0000,#00000026);position:absolute;left:0;right:0}.cujmXa_add-button{cursor:pointer;background:0 0;border:none;outline:none;width:100%;height:100%}.cujmXa_add-button img{width:1.75rem;height:1.75rem}");var St={editorWrapper:"cujmXa_editor-wrapper",extensionButton:"cujmXa_extension-button",addButton:"cujmXa_add-button"};var b1="./assets/icon-extension-61vrne2y.svg";import{jsx as _t,jsxs as ze,Fragment as ke}from"preact/jsx-runtime";var ot=new Map,L1=(t)=>typeof t!=="string"&&!t.button,Ge=async(t,e,o,i)=>{if(t){for(let n of t)if(!ot.has(n)){let{default:u}=await import(`@blockcode/extension-${n}/blocks`);if(u.id=n,u.files)for(let c of u.files){const l=`extensions/${n}/${c.name}`,m=await fetch(c.uri).then((A)=>A.text());try{o({...c,id:l,content:m})}catch(A){}}if(e(u.translations),i)i({...u,blocks:u.blocks.filter(L1)});ot.set(n,u)}}};function Ft({toolbox:t,messages:e,generators:o,enableMultiTargets:i,enableLocalVariable:n,disableGenerator:u,disableExtension:c,onChange:l,onExtensionsFilter:m,onLoadExtension:A}){const{addLocaleData:C,getText:_,maybeLocaleText:f}=Xe(),{splash:E,createPrompt:p,createAlert:T,removeAlert:b,setSplash:W}=Ke(),{editor:F,fileList:K,selectedFileId:I,openFile:H,modifyFile:lt,addAsset:ht,setModified:Rt}=D1(),[Q,N]=bt(),[r,d]=bt(!1),[a,h]=bt(!1),[w,M]=bt(!1),[D,k]=bt(!1);e={EVENT_WHENPROGRAMSTART:_("blocks.event.programStart","when program start"),CONTROL_STOP_OTHER:_("blocks.control.stopOther","other scripts"),PROCEDURES_ADD_LABEL:_("blocks.myblock.addLabel"," label text"),PROCEDURES_ADD_BOOLEAN:_("blocks.myblock.addBoolean","boolean"),PROCEDURES_ADD_STRING_NUMBER:_("blocks.myblock.addNumbetText","number or text"),...e||[]},We(()=>{U.prompt=(g,L,v,X,et)=>{const st={callback:v,message:g,defaultValue:L};st.title=X?X:U.Msg.VARIABLE_MODAL_TITLE,st.varType=typeof et==="string"?et:U.SCALAR_VARIABLE_TYPE,st.showVariableOptions=i&&et!==U.BROADCAST_MESSAGE_VARIABLE_TYPE&&st.title!==U.Msg.RENAME_VARIABLE_MODAL_TITLE&&st.title!==U.Msg.RENAME_LIST_MODAL_TITLE,st.showCloudOption=et===U.SCALAR_VARIABLE_TYPE&&this.props.canUseCloud,d(st)},U.FlyoutExtensionCategoryHeader.getExtensionState=(g)=>{if(!ot.has(g))return;const L=ot.get(g),{statusButton:v}=L;if(!v)return U.StatusButtonState.NOT_READY;if(v.storage){if(v.storage.every((X)=>localStorage.getItem(X.id)))return U.StatusButtonState.READY;return U.StatusButtonState.NOT_READY}if(v.onUpdate?.())return U.StatusButtonState.READY;return U.StatusButtonState.NOT_READY};const O=()=>U.refreshStatusButtons(Q);U.statusButtonCallback=(g)=>{if(!ot.has(g))return;const L=ot.get(g),{statusButton:v}=L;if(!v)return;if(v.storage){p({title:L.name,label:v.title,inputMode:v.storage.map((X)=>({name:X.id,placeholder:X.text,defaultValue:localStorage.getItem(X.id)})),body:v.description,onSubmit:(X)=>{Object.entries(X).forEach(([et,st])=>localStorage.setItem(et,st)),O()}});return}v.onClick?.(O)},U.Procedures.externalProcedureDefCallback=(g,L)=>{h({mutator:g,defCallback:L})}},[Q]);let it;if(Q)it=Q.getAllVariables().filter((O)=>{if(O.isLocal)return!1;if(O.type===U.BROADCAST_MESSAGE_VARIABLE_TYPE){if(O.name===U.Msg.DEFAULT_BROADCAST_MESSAGE_NAME)return!1;const g=O.id_.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),L=new RegExp(`<field name="BROADCAST_OPTION" id="${g}"[^>]+>[^<]+</field>`,"g");for(let v of K)if(L.test(v.xml))return!0;return!1}return!0});let G=t||He();const B=I===K[0].id,j=(O)=>O.bind(null,{context:D1(),createPrompt:p,createAlert:T,removeAlert:b});ot.forEach((O)=>{G+=zt(o,O,B,f,j)});const P=(O)=>{let g="\n";if(!u)g=o[0]?.workspaceToCode(O);const L=Array.from(new Set(Object.values(O.blockDB_).filter((v)=>ot.has(v.category_)).map((v)=>v.category_)));return{content:g,extensions:L}},q=(O,g)=>{const{content:L,extensions:v}=P(g);if(lt({xml:O,content:L,extensions:v}),l)l(O,g)},$=(O,g)=>{r.callback(O,[],g),d(!1)},R=(O)=>{if(O&&Q&&a)a.defCallback(O),Q.refreshToolboxSelection_(),Q.toolbox_.scrollToCategoryById("myBlocks");h(!1)},z=()=>{d(!1),h(!1)},x=()=>M(!0),tt=()=>M(!1),Dt=async(O)=>{if(!ot.has(O)){T("importing",{id:O});let{default:g}=await import(`@blockcode/extension-${O}/blocks`);if(g.id=O,g.files)for(let L of g.files){const v=`extensions/${O.replace(/[^a-z\d]/gi,"_")}/${L.name}`,X=await fetch(L.uri).then((et)=>et.text());try{ht({...L,id:v,content:X})}catch(et){}}if(C(g.translations),A)A({...g,blocks:g.blocks.filter(L1)});ot.set(g.id,g),b(O)}setTimeout(()=>{Q.toolbox_.setSelectedCategoryById(O)},50)};if(E){if(E===!0&&D===!1)ot.clear(),k(Ge(F.extensions,C,ht,A).then(()=>{setTimeout(()=>k(!0),50)}));if(Q&&D===!0){const O=E;if(K.length===1||O===I)W(!1),k(!1),setTimeout(()=>Rt(!1),50);else{const g=K.findIndex((X)=>X.id===I)||0,L=K[g],v=K.at(g-1).id;setTimeout(()=>{if(E===!0)W(I),H(v);else if(L.content)H(v)})}}}let Ot=!0;if(F.extensions)Ot=F.extensions.every((O)=>ot.has(O));return _t(ke,{children:ze("div",{className:St.editorWrapper,children:[_t(Ze,{toolbox:G,messages:e,extensionsLoaded:Ot,globalVariables:it,onWorkspaceCreated:N,onChange:q}),c?null:_t("div",{className:Ye("scratchCategoryMenu",St.extensionButton),children:_t("button",{className:St.addButton,title:_("blocks.extensions.addExtension","Add Extension"),onClick:x,children:_t("img",{src:b1,title:"Add Extension"})})}),r&&_t(Jt,{title:r.title,label:r.message,defaultValue:r.defaultValue,enableLocalVariable:n,showListMessage:r.varType===U.LIST_VARIABLE_TYPE,showVariableOptions:r.showVariableOptions,showCloudOption:r.showCloudOption,onClose:z,onSubmit:$}),a&&_t(Qt,{mutator:a.mutator,onClose:z,onSubmit:R}),w&&_t(Bt,{onFilter:m,onSelect:Dt,onClose:tt})]})})}import{useEditor as Je}from"@blockcode/core";ut(".MfXpyq_code-review{background:#fff;width:100%;height:100%;font-size:1rem;overflow:auto}.MfXpyq_code-review pre{margin:calc(var(--space)/2);counter-reset:line}.MfXpyq_code-review pre span{user-select:text;line-height:1.25rem;display:block}.MfXpyq_code-review pre span:before{counter-increment:line;content:counter(line);text-align:right;color:var(--text-primary-transparent);border-right:1px solid #ddd;width:40px;margin-right:.5em;padding:0 .5em;display:inline-block}");var I1={codeReview:"MfXpyq_code-review"};import{jsx as jt}from"preact/jsx-runtime";function qt(){const{fileList:t,selectedFileId:e}=Je(),o=t.find((n)=>n.id===e);let i=[];if(o?.content)i=o.content.split("\n");return jt("div",{className:I1.codeReview,children:jt("pre",{children:i.map((n)=>jt("span",{children:n}))})})}var S1="./assets/icon-blocks-vgmb334q.svg";var F1="./assets/icon-review-th668gym.svg";var P1={"blocks.menu.file":"File","blocks.menu.file.newProject":"New","blocks.menu.file.openProject":"Open","blocks.menu.file.saveProject":"Save","blocks.menu.file.uploadProject":"Load from your computer","blocks.menu.file.downloadProject":"Save to your computer","blocks.menu.file.saveAlert":"Saved.","blocks.menu.edit":"Edit","blocks.menu.edit.undo":"Undo","blocks.menu.edit.redo":"Redo","blocks.menu.device":"Device","blocks.menu.device.name":"device","blocks.menu.device.connect":"Connect to your {name}","blocks.menu.device.disconnect":"Disconnect this {name}","blocks.menu.device.download":"Download program","blocks.menu.device.turnOnAutoDownload":"Turn on Auto Download","blocks.menu.device.turnOffAutoDownload":"Turn off Auto Download","blocks.alert.downloading":"Downloading...{progress}%","blocks.alert.downloadCompleted":"Download completed.","blocks.alert.connectionCancel":"Connection cancel.","blocks.alert.connectionError":"Connection error.","blocks.alert.flashOutSpace":"The flash is running out of space.","blocks.codeTab":"Code","blocks.reviewTab":"Code Review","blocks.monitorPane.title":"Monitor","blocks.downloadToDevice":"Download","blocks.extensions.addExtension":"Add Extension","blocks.extensions.empty":"No extension!","blocks.prompt.ok":"OK","blocks.prompt.cancel":"Cancel","blocks.dataPrompt.forAllTargets":"For all targets","blocks.dataPrompt.forThisTarget":"For this target only","blocks.dataPrompt.availableToAllTargets":"This variable will be available to all targets.","blocks.dataPrompt.listAvailableToAllTargets":"This list will be available to all targets.","blocks.myBlockPrompt.title":"Make a Block","blocks.myBlockPrompt.addAnInputNumberText":"Add an input","blocks.myBlockPrompt.numberTextType":"number or text","blocks.myBlockPrompt.addAnInputBoolean":"Add an input","blocks.myBlockPrompt.booleanType":"boolean","blocks.myBlockPrompt.addALabel":"Add a label","blocks.myBlockPrompt.command":"Command","blocks.myBlockPrompt.reporterNumberText":"Return number or text","blocks.myBlockPrompt.reporterBoolean":"Return boolean","blocks.event.programStart":"when program start","blocks.control.stopOther":"other scripts","blocks.myblock.addLabel":" label text","blocks.myblock.addBoolean":"boolean","blocks.myblock.addNumbetText":"number or text"};var y1={"blocks.menu.file":"\u6587\u4EF6","blocks.menu.file.newProject":"\u65B0\u4F5C\u54C1","blocks.menu.file.openProject":"\u6253\u5F00","blocks.menu.file.saveProject":"\u4FDD\u5B58","blocks.menu.file.uploadProject":"\u4ECE\u7535\u8111\u4E2D\u6253\u5F00","blocks.menu.file.downloadProject":"\u4FDD\u5B58\u5230\u7535\u8111","blocks.menu.file.saveAlert":"\u5DF2\u4FDD\u5B58\u3002","blocks.menu.edit":"\u7F16\u8F91","blocks.menu.edit.undo":"\u64A4\u9500","blocks.menu.edit.redo":"\u6062\u590D","blocks.menu.device":"\u8BBE\u5907","blocks.menu.device.name":"\u8BBE\u5907","blocks.menu.device.connect":"\u8FDE\u63A5{name}","blocks.menu.device.disconnect":"\u65AD\u5F00{name}\u8FDE\u63A5","blocks.menu.device.download":"\u4E0B\u8F7D\u7A0B\u5E8F","blocks.menu.device.turnOnAutoDownload":"\u6253\u5F00\u81EA\u52A8\u4E0B\u8F7D","blocks.menu.device.turnOffAutoDownload":"\u5173\u95ED\u81EA\u52A8\u4E0B\u8F7D","blocks.alert.downloading":"\u6B63\u5728\u4E0B\u8F7D\u2026{progress}%","blocks.alert.downloadCompleted":"\u4E0B\u8F7D\u5B8C\u6210\u3002","blocks.alert.connectionCancel":"\u8FDE\u63A5\u53D6\u6D88\u3002","blocks.alert.connectionError":"\u8FDE\u63A5\u9519\u8BEF\u3002","blocks.alert.flashOutSpace":"\u8BBE\u5907\u7A7A\u95F4\u4E0D\u8DB3\u3002","blocks.codeTab":"\u4EE3\u7801","blocks.reviewTab":"\u4EE3\u7801\u5BA1\u67E5","blocks.monitorPane.title":"\u76D1\u89C6\u5668","blocks.downloadToDevice":"\u4E0B\u8F7D","blocks.extensions.addExtension":"\u6DFB\u52A0\u6269\u5C55","blocks.extensions.empty":"\u6CA1\u6709\u6269\u5C55\uFF01","blocks.prompt.ok":"\u786E\u5B9A","blocks.prompt.cancel":"\u53D6\u6D88","blocks.dataPrompt.forAllTargets":"\u9002\u7528\u4E8E\u5168\u5C40","blocks.dataPrompt.forThisTarget":"\u4EC5\u9002\u7528\u4E8E\u5F53\u524D","blocks.dataPrompt.availableToAllTargets":"\u5168\u5C40\u90FD\u53EF\u4F7F\u7528\u8BE5\u53D8\u91CF\u3002","blocks.dataPrompt.listAvailableToAllTargets":"\u5168\u5C40\u90FD\u53EF\u4F7F\u7528\u8BE5\u5217\u8868\u3002","blocks.myBlockPrompt.title":"\u5236\u4F5C\u65B0\u7684\u79EF\u6728","blocks.myBlockPrompt.addAnInputNumberText":"\u6DFB\u52A0\u8F93\u5165\u9879","blocks.myBlockPrompt.numberTextType":"\u6570\u5B57\u6216\u6587\u672C","blocks.myBlockPrompt.addAnInputBoolean":"\u6DFB\u52A0\u8F93\u5165\u9879","blocks.myBlockPrompt.booleanType":"\u5E03\u5C14\u503C","blocks.myBlockPrompt.addALabel":"\u6DFB\u52A0\u6587\u672C\u6807\u7B7E","blocks.myBlockPrompt.command":"\u65E0\u8FD4\u56DE\u503C","blocks.myBlockPrompt.reporterNumberText":"\u8FD4\u56DE\u6570\u5B57\u6216\u6587\u672C","blocks.myBlockPrompt.reporterBoolean":"\u8FD4\u56DE\u5E03\u5C14\u503C","blocks.event.programStart":"\u5F53\u7A0B\u5E8F\u5F00\u59CB\u8FD0\u884C","blocks.control.stopOther":"\u5176\u4ED6\u811A\u672C","blocks.myblock.addLabel":"\u6587\u672C","blocks.myblock.addBoolean":"\u5E03\u5C14\u503C","blocks.myblock.addNumbetText":"\u6570\u5B57\u6216\u6587\u672C"};var $1={en:P1,"zh-Hans":y1};import{jsx as Pt}from"preact/jsx-runtime";var je={icon:S1,label:Pt(xt,{id:"blocks.codeTab",defaultMessage:"Code"}),Content:Ft},fn={icon:F1,label:Pt(xt,{id:"blocks.reviewTab",defaultMessage:"Code Review"}),Content:qt},Rn={label:Pt(xt,{id:"blocks.monitorPane.title",defaultMessage:"Monitor"}),Content:null},qe=(t,e,o)=>{return[].concat(e,o,h1)};function xe({addLocaleData:t,openProject:e}){t($1);const o=()=>{e(Object.assign(m1))};return o(),{mainMenu:Zt({createProject:o,openProject:e,beforeDownload:qe}),tabs:[{...je,Content:()=>Pt(Ft,{generators:[_1]})}].concat([]),sidebars:[],pane:!1,tutorials:!1,canEditProjectName:!0}}export{fn as reviewTab,Rn as monitorPane,Zt as makeMainMenu,$1 as locales,xe as default,je as codeTab,gt as PythonGenerator};
