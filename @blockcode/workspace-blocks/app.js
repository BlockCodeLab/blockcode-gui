var lt=Object.create;var{defineProperty:W1,getPrototypeOf:Ot,getOwnPropertyNames:At}=Object;var Mt=Object.prototype.hasOwnProperty;var St=(a,u,E)=>{E=a!=null?lt(Ot(a)):{};const i=u||!a||!a.__esModule?W1(E,"default",{value:a,enumerable:!0}):E;for(let o of At(a))if(!Mt.call(i,o))W1(i,o,{get:()=>a[o],enumerable:!0});return i};var gt=(a,u)=>()=>(u||a((u={exports:{}}).exports,u),u.exports);var Y1=gt((f1)=>{(function(){var a=typeof f1!="undefined"&&f1||typeof define!="undefined"&&{}||this||window;if(typeof define!=="undefined")define("save-svg-as-png",[],function(){return a});a.default=a;var u="http://www.w3.org/2000/xmlns/",E="http://www.w3.org/1999/xhtml",i="http://www.w3.org/2000/svg",o='<?xml version="1.0" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd" [<!ENTITY nbsp "&#160;">]>',s=/url\(["']?(.+?)["']?\)/,C={woff2:"font/woff2",woff:"font/woff",otf:"application/x-font-opentype",ttf:"application/x-font-ttf",eot:"application/vnd.ms-fontobject",sfnt:"application/font-sfnt",svg:"image/svg+xml"},_=function r(T){return T instanceof HTMLElement||T instanceof SVGElement},O=function r(T){if(!_(T))throw new Error("an HTMLElement or SVGElement is required; got "+T)},R=function r(T){return new Promise(function(N,d){if(_(T))N(T);else d(new Error("an HTMLElement or SVGElement is required; got "+T))})},$=function r(T){return T&&T.lastIndexOf("http",0)===0&&T.lastIndexOf(window.location.host)===-1},P=function r(T){var N=Object.keys(C).filter(function(d){return T.indexOf("."+d)>0}).map(function(d){return C[d]});if(N)return N[0];return console.error("Unknown font format for "+T+". Fonts may not be working correctly."),"application/octet-stream"},D=function r(T){var N="",d=new Uint8Array(T);for(var m=0;m<d.byteLength;m++)N+=String.fromCharCode(d[m]);return window.btoa(N)},f=function r(T,N,d){var m=T.viewBox&&T.viewBox.baseVal&&T.viewBox.baseVal[d]||N.getAttribute(d)!==null&&!N.getAttribute(d).match(/%$/)&&parseInt(N.getAttribute(d))||T.getBoundingClientRect()[d]||parseInt(N.style[d])||parseInt(window.getComputedStyle(T).getPropertyValue(d));return typeof m==="undefined"||m===null||isNaN(parseFloat(m))?0:m},I=function r(T,N,d,m){if(T.tagName==="svg")return{width:d||f(T,N,"width"),height:m||f(T,N,"height")};else if(T.getBBox){var M=T.getBBox(),S=M.x,L=M.y,Z=M.width,j=M.height;return{width:S+Z,height:L+j}}},n=function r(T){return decodeURIComponent(encodeURIComponent(T).replace(/%([0-9A-F]{2})/g,function(N,d){var m=String.fromCharCode("0x"+d);return m==="%"?"%25":m}))},A=function r(T){var N=window.atob(T.split(",")[1]),d=T.split(",")[0].split(":")[1].split(";")[0],m=new ArrayBuffer(N.length),M=new Uint8Array(m);for(var S=0;S<N.length;S++)M[S]=N.charCodeAt(S);return new Blob([m],{type:d})},w=function r(T,N){if(!N)return;try{return T.querySelector(N)||T.parentNode&&T.parentNode.querySelector(N)}catch(d){console.warn('Invalid CSS selector "'+N+'"',d)}},Q=function r(T,N){var d=T.cssText.match(s),m=d&&d[1]||"";if(!m||m.match(/^data:/)||m==="about:blank")return;var M=m.startsWith("../")?N+"/../"+m:m.startsWith("./")?N+"/."+m:m;return{text:T.cssText,format:P(M),url:M}},F=function r(T){return Promise.all(Array.from(T.querySelectorAll("image")).map(function(N){var d=N.getAttributeNS("http://www.w3.org/1999/xlink","href")||N.getAttribute("href");if(!d)return Promise.resolve(null);if($(d))d+=(d.indexOf("?")===-1?"?":"&")+"t="+(new Date()).valueOf();return new Promise(function(m,M){var S=document.createElement("canvas"),L=new Image;L.crossOrigin="anonymous",L.src=d,L.onerror=function(){return M(new Error("Could not load "+d))},L.onload=function(){S.width=L.width,S.height=L.height,S.getContext("2d").drawImage(L,0,0),N.setAttributeNS("http://www.w3.org/1999/xlink","href",S.toDataURL("image/png")),m(!0)}})}))},W={},u1=function r(T){return Promise.all(T.map(function(N){return new Promise(function(d,m){if(W[N.url])return d(W[N.url]);var M=new XMLHttpRequest;M.addEventListener("load",function(){var S=D(M.response),L=N.text.replace(s,'url("data:'+N.format+";base64,"+S+'")')+"\n";W[N.url]=L,d(L)}),M.addEventListener("error",function(S){console.warn("Failed to load font from: "+N.url,S),W[N.url]=null,d(null)}),M.addEventListener("abort",function(S){console.warn("Aborted loading font from: "+N.url,S),d(null)}),M.open("GET",N.url),M.responseType="arraybuffer",M.send()})})).then(function(N){return N.filter(function(d){return d}).join("")})},C1=null,M1=function r(){if(C1)return C1;return C1=Array.from(document.styleSheets).map(function(T){try{return{rules:T.cssRules,href:T.href}}catch(N){return console.warn("Stylesheet could not be loaded: "+T.href,N),{}}})},S1=function r(T,N){var d=N||{},m=d.selectorRemap,M=d.modifyStyle,S=d.modifyCss,L=d.fonts,Z=d.excludeUnusedCss,j=S||function(v,z){var V=m?m(v):v,l=M?M(z):z;return V+"{"+l+"}\n"},Y=[],B=typeof L==="undefined",K=L||[];return M1().forEach(function(v){var{rules:z,href:V}=v;if(!z)return;Array.from(z).forEach(function(l){if(typeof l.style!="undefined"){if(w(T,l.selectorText))Y.push(j(l.selectorText,l.style.cssText));else if(B&&l.cssText.match(/^@font-face/)){var e=Q(l,V);if(e)K.push(e)}else if(!Z)Y.push(l.cssText)}})}),u1(K).then(function(v){return Y.join("\n")+v})},x=function r(){if(!navigator.msSaveOrOpenBlob&&!("download"in document.createElement("a")))return{popup:window.open()}};a.prepareSvg=function(r,T,N){O(r);var d=T||{},m=d.left,M=m===void 0?0:m,S=d.top,L=S===void 0?0:S,Z=d.width,j=d.height,Y=d.scale,B=Y===void 0?1:Y,K=d.responsive,v=K===void 0?!1:K,z=d.excludeCss,V=z===void 0?!1:z;return F(r).then(function(){var l=r.cloneNode(!0);l.style.backgroundColor=(T||{}).backgroundColor||r.style.backgroundColor;var e=I(r,l,Z,j),g=e.width,p=e.height;if(r.tagName!=="svg")if(r.getBBox){if(l.getAttribute("transform")!=null)l.setAttribute("transform",l.getAttribute("transform").replace(/translate\(.*?\)/,""));var U=document.createElementNS("http://www.w3.org/2000/svg","svg");U.appendChild(l),l=U}else{console.error("Attempted to render non-SVG element",r);return}if(l.setAttribute("version","1.1"),l.setAttribute("viewBox",[M,L,g,p].join(" ")),!l.getAttribute("xmlns"))l.setAttributeNS(u,"xmlns",i);if(!l.getAttribute("xmlns:xlink"))l.setAttributeNS(u,"xmlns:xlink","http://www.w3.org/1999/xlink");if(v)l.removeAttribute("width"),l.removeAttribute("height"),l.setAttribute("preserveAspectRatio","xMinYMin meet");else l.setAttribute("width",g*B),l.setAttribute("height",p*B);if(Array.from(l.querySelectorAll("foreignObject > *")).forEach(function(r1){r1.setAttributeNS(u,"xmlns",r1.tagName==="svg"?i:E)}),V){var y=document.createElement("div");y.appendChild(l);var h=y.innerHTML;if(typeof N==="function")N(h,g,p);else return{src:h,width:g,height:p}}else return S1(r,T).then(function(r1){var g1=document.createElement("style");g1.setAttribute("type","text/css"),g1.innerHTML="<![CDATA[\n"+r1+"\n]]>";var U1=document.createElement("defs");U1.appendChild(g1),l.insertBefore(U1,l.firstChild);var b1=document.createElement("div");b1.appendChild(l);var X1=b1.innerHTML.replace(/NS\d+:href/gi,'xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href');if(typeof N==="function")N(X1,g,p);else return{src:X1,width:g,height:p}})})},a.svgAsDataUri=function(r,T,N){return O(r),a.prepareSvg(r,T).then(function(d){var{src:m,width:M,height:S}=d,L="data:image/svg+xml;base64,"+window.btoa(n(o+m));if(typeof N==="function")N(L,M,S);return L})},a.svgAsPngUri=function(r,T,N){O(r);var d=T||{},m=d.encoderType,M=m===void 0?"image/png":m,S=d.encoderOptions,L=S===void 0?0.8:S,Z=d.canvg,j=function Y(B){var{src:K,width:v,height:z}=B,V=document.createElement("canvas"),l=V.getContext("2d"),e=window.devicePixelRatio||1;if(V.width=v*e,V.height=z*e,V.style.width=V.width+"px",V.style.height=V.height+"px",l.setTransform(e,0,0,e,0,0),Z)Z(V,K);else l.drawImage(K,0,0);var g=void 0;try{g=V.toDataURL(M,L)}catch(p){if(typeof SecurityError!=="undefined"&&p instanceof SecurityError||p.name==="SecurityError"){console.error("Rendered SVG images cannot be downloaded in this browser.");return}else throw p}if(typeof N==="function")N(g,V.width,V.height);return Promise.resolve(g)};if(Z)return a.prepareSvg(r,T).then(j);else return a.svgAsDataUri(r,T).then(function(Y){return new Promise(function(B,K){var v=new Image;v.onload=function(){return B(j({src:v,width:v.width,height:v.height}))},v.onerror=function(){K("There was an error loading the data URI as an image on the following SVG\n"+window.atob(Y.slice(26))+"Open the following link to see browser\'s diagnosis\n"+Y)},v.src=Y})})},a.download=function(r,T,N){if(navigator.msSaveOrOpenBlob)navigator.msSaveOrOpenBlob(A(T),r);else{var d=document.createElement("a");if("download"in d){d.download=r,d.style.display="none",document.body.appendChild(d);try{var m=A(T),M=URL.createObjectURL(m);d.href=M,d.onclick=function(){return requestAnimationFrame(function(){return URL.revokeObjectURL(M)})}}catch(S){console.error(S),console.warn("Error while getting object URL. Falling back to string URL."),d.href=T}d.click(),document.body.removeChild(d)}else if(N&&N.popup)N.popup.document.title=r,N.popup.location.replace(T)}},a.saveSvg=function(r,T,N){var d=x();return R(r).then(function(m){return a.svgAsDataUri(m,N||{})}).then(function(m){return a.download(T,m,d)})},a.saveSvgAsPng=function(r,T,N){var d=x();return R(r).then(function(m){return a.svgAsPngUri(m,N||{})}).then(function(m){return a.download(T,m,d)})}})()});import{Text as rt} from"@blockcode/ui";import{Text as P1} from"@blockcode/ui";var Z1=St(Y1(),1);import{Keys as G,useLayout as ft,useEditor as Dt} from"@blockcode/core";import{Text as T1,MenuSection as H1,MenuItem as m1} from"@blockcode/ui";import{ScratchBlocks as It} from"@blockcode/blocks-editor";import{jsx as J,jsxs as I1,Fragment as Ft} from"preact/jsx-runtime";var D1=/Mac/i.test(navigator.platform||navigator.userAgent);function F1({itemClassName:a,onNew:u,onOpen:E,onSave:i,children:o}){const{createPrompt:s,setStoreLibrary:C}=ft(),{modified:_,saveNow:O,saveToComputer:R,openFromComputer:$}=Dt(),P=async()=>{let D,f;const I=It.getMainWorkspace();if(I)D=await Z1.svgAsDataUri(I.getCanvas(),{}),f=Array.from(new Set(Object.values(I.blockDB_).filter((n)=>["nes","translate","color-sensor","servo","time","pen","brain","request","text","broadcast"].find((A)=>A===n.category_)).map((n)=>n.category_)));return(n)=>{const A={thumb:D,...n,...i?i():{},editor:{...n.editor,extensions:f}};if(A.assetList)A.assetList=A.assetList.filter((w)=>!w.id.startsWith("extensions/"));return A.fileList=A.fileList.map(({content:w,script:Q,...F})=>F),A}};return I1(Ft,{children:[I1(H1,{children:[J(m1,{className:a,label:J(T1,{id:"blocks.menu.file.newProject",defaultMessage:"New"}),hotkey:[D1?G.COMMAND:G.CONTROL,G.N],onClick:()=>{if(_)s({title:J(T1,{id:"gui.projects.notSaved",defaultMessage:"Not saved"}),label:J(T1,{id:"gui.projects.replaceProject",defaultMessage:"Replace contents of the current project?"}),onSubmit:u});else u()}}),J(m1,{className:a,label:J(T1,{id:"blocks.menu.file.openProject",defaultMessage:"Open"}),hotkey:[D1?G.COMMAND:G.CONTROL,G.O],onClick:()=>C(!0)}),J(m1,{className:a,label:J(T1,{id:"blocks.menu.file.saveProject",defaultMessage:"Save"}),hotkey:[D1?G.COMMAND:G.CONTROL,G.S],onClick:async()=>O(await P())})]}),I1(H1,{children:[J(m1,{className:a,label:J(T1,{id:"blocks.menu.file.uploadProject",defaultMessage:"Load from your computer"}),onClick:()=>$(E)}),J(m1,{className:a,label:J(T1,{id:"blocks.menu.file.downloadProject",defaultMessage:"save to your computer"}),onClick:async()=>R(await P())})]}),o]})}import{useEffect as Lt,useState as L1} from"preact/hooks";import{Keys as E1} from"@blockcode/core";import{Text as B1,MenuSection as pt,MenuItem as K1} from"@blockcode/ui";import{ScratchBlocks as ct} from"@blockcode/blocks-editor";import{jsx as n1,jsxs as h1,Fragment as Pt} from"preact/jsx-runtime";var z1=/Mac/i.test(navigator.platform||navigator.userAgent);function p1({itemClassName:a,children:u}){const[E,i]=L1(!0),[o,s]=L1(!0),[C,_]=L1(null),O=ct.getMainWorkspace();if(O){if(C?.id!==O.id)_(O)}return Lt(()=>{if(C)C.addChangeListener(()=>{i(C.undoStack_.length===0),s(C.redoStack_.length===0)}),i(C.undoStack_.length===0),s(C.redoStack_.length===0)},[C]),h1(Pt,{children:[h1(pt,{children:[n1(K1,{disabled:E,className:a,label:n1(B1,{id:"blocks.menu.edit.undo",defaultMessage:"Undo"}),hotkey:[z1?E1.COMMAND:E1.CONTROL,E1.Z],onClick:async(R)=>{if(R instanceof MouseEvent&&C)C.undo(!1)}}),n1(K1,{disabled:o,className:a,label:n1(B1,{id:"blocks.menu.edit.redo",defaultMessage:"Redo"}),hotkey:z1?[E1.SHIFT,E1.COMMAND,E1.Z]:[E1.CONTROL,E1.Y],onClick:async(R)=>{if(R instanceof MouseEvent&&C)C.undo(!0)}})]}),u]})}import{useState as H0} from"preact/hooks";import{useLocale as vt,useLayout as $t,useEditor as wt} from"@blockcode/core";import{Text as d1,Spinner as Vt,MenuSection as Ut,MenuItem as bt} from"@blockcode/ui";import{connectDevice as Xt,disconnectDevice as z0,checkFlash as Wt,writeFiles as Yt,configDevice as Ht,showDownloadScreen as Zt} from"@blockcode/device-pyboard";var J1=[{usbVendorId:12346},{usbVendorId:11914}];import{jsx as a1,jsxs as Kt,Fragment as Bt} from"preact/jsx-runtime";var t1=null;function c1({itemClassName:a,deviceName:u,deviceFilters:E,downloadScreen:i,onDownload:o,children:s}){const{maybeLocaleText:C}=vt(),{createAlert:_,removeAlert:O,createPrompt:R}=$t(),{key:$,name:P,fileList:D,assetList:f,device:I,setDevice:n}=wt(),A=(F)=>{if(!t1)t1=`download.${Date.now()}`;if(F<100)_({id:t1,icon:a1(Vt,{level:"success"}),message:a1(d1,{id:"blocks.alert.downloading",defaultMessage:"Downloading...{progress}%",progress:F})});else _({id:t1,icon:null,message:a1(d1,{id:"blocks.alert.downloadCompleted",defaultMessage:"Download completed."})}),setTimeout(w,1000)},w=()=>{O(t1),t1=null},Q=()=>{_({message:a1(d1,{id:"blocks.alert.connectionError",defaultMessage:"Connection error."})},1000)};if(t1&&!I)Q(),w();return Kt(Bt,{children:[a1(Ut,{children:a1(bt,{disabled:t1,className:a,label:a1(d1,{id:"blocks.menu.device.download",defaultMessage:"Download program"}),onClick:async()=>{if(t1)return;try{const F=I||await Xt(E||J1,n);if(i)await Zt(F,i);let W=o?o(P,D,f):[].concat(f);if(W=W.map((u1)=>({...u1,id:u1.id[0]!=="_"?`proj${$}/${u1.id}`:u1.id})),A(0),await Wt(F,W))await Yt(F,W,A),await Ht(F,{"latest-project":$});else R({title:a1(d1,{id:"blocks.menu.device.name",defaultMessage:"device"}),label:a1(d1,{id:"blocks.alert.flashOutSpace",defaultMessage:"The flash is running out of space."})}),w();F.hardReset()}catch(F){console.log(F),Q(),w()}}})}),s]})}var Q1="./assets/icon-file-1def53419f4ad0ae.svg";var q1="./assets/icon-edit-2b1e47b495524ed2.svg";var j1="./assets/icon-device-c2fafab2eaccf043.svg";import{jsx as N1} from"preact/jsx-runtime";function v1({deviceName:a,deviceFilters:u,createProject:E,openProject:i,saveProject:o,downloadProjectToDevice:s,showDownloadScreen:C}){return[{icon:Q1,label:N1(P1,{id:"blocks.menu.file",defaultMessage:"File"}),Menu:({itemClassName:_,children:O})=>N1(F1,{itemClassName:_,onNew:E,onOpen:i,onSave:o,children:O})},{icon:q1,label:N1(P1,{id:"blocks.menu.edit",defaultMessage:"Edit"}),Menu:({itemClassName:_,children:O})=>N1(p1,{itemClassName:_,children:O})},{icon:j1,label:N1(P1,{id:"blocks.menu.device",defaultMessage:"Device"}),Menu:({itemClassName:_,children:O})=>N1(c1,{deviceName:a,itemClassName:_,deviceFilters:u,downloadScreen:C,onDownload:s,children:O})}]}var k1=`code_${Date.now().toString(36)}`,Qt=`
from popsicle.blocks import *
import ${k1}
run()
`,x1={assetList:[{id:"main",type:"text/x-python",content:Qt}],fileList:[{id:k1,type:"text/x-python"}]};import{ScratchBlocks as H} from"@blockcode/blocks-editor";var t=new H.Generator("Python");t.addReservedWords("False,None,True,and,as,assert,break,class,continue,def,del,elif,else,except,exec,finally,for,from,global,if,import,in,is,lambda,nonlocal,not,or,pass,print,raise,return,try,while,with,yield,NotImplemented,Ellipsis,__debug__,quit,exit,copyright,license,credits,ArithmeticError,AssertionError,AttributeError,BaseException,BlockingIOError,BrokenPipeError,BufferError,BytesWarning,ChildProcessError,ConnectionAbortedError,ConnectionError,ConnectionRefusedError,ConnectionResetError,DeprecationWarning,EOFError,Ellipsis,EnvironmentError,Exception,FileExistsError,FileNotFoundError,FloatingPointError,FutureWarning,GeneratorExit,IOError,ImportError,ImportWarning,IndentationError,IndexError,InterruptedError,IsADirectoryError,KeyError,KeyboardInterrupt,LookupError,MemoryError,ModuleNotFoundError,NameError,NotADirectoryError,NotImplemented,NotImplementedError,OSError,OverflowError,PendingDeprecationWarning,PermissionError,ProcessLookupError,RecursionError,ReferenceError,ResourceWarning,RuntimeError,RuntimeWarning,StandardError,StopAsyncIteration,StopIteration,SyntaxError,SyntaxWarning,SystemError,SystemExit,TabError,TimeoutError,TypeError,UnboundLocalError,UnicodeDecodeError,UnicodeEncodeError,UnicodeError,UnicodeTranslateError,UnicodeWarning,UserWarning,ValueError,Warning,ZeroDivisionError,_,__build_class__,__debug__,__doc__,__import__,__loader__,__name__,__package__,__spec__,abs,all,any,apply,ascii,basestring,bin,bool,buffer,bytearray,bytes,callable,chr,classmethod,cmp,coerce,compile,complex,copyright,credits,delattr,dict,dir,divmod,enumerate,eval,exec,execfile,exit,file,filter,float,format,frozenset,getattr,globals,hasattr,hash,help,hex,id,input,int,intern,isinstance,issubclass,iter,len,license,list,locals,long,map,max,memoryview,min,next,object,oct,open,ord,pow,print,property,quit,range,raw_input,reduce,reload,repr,reversed,round,set,setattr,slice,sorted,staticmethod,str,sum,super,tuple,type,unichr,unicode,vars,xrange,zip");t.ORDER_ATOMIC=0;t.ORDER_COLLECTION=1;t.ORDER_STRING_CONVERSION=1;t.ORDER_MEMBER=2.1;t.ORDER_FUNCTION_CALL=2.2;t.ORDER_EXPONENTIATION=3;t.ORDER_UNARY_SIGN=4;t.ORDER_BITWISE_NOT=4;t.ORDER_MULTIPLICATIVE=5;t.ORDER_ADDITIVE=6;t.ORDER_BITWISE_SHIFT=7;t.ORDER_BITWISE_AND=8;t.ORDER_BITWISE_XOR=9;t.ORDER_BITWISE_OR=10;t.ORDER_RELATIONAL=11;t.ORDER_LOGICAL_NOT=12;t.ORDER_LOGICAL_AND=13;t.ORDER_LOGICAL_OR=14;t.ORDER_CONDITIONAL=15;t.ORDER_LAMBDA=16;t.ORDER_NONE=99;t.ORDER_OVERRIDES=[[t.ORDER_FUNCTION_CALL,t.ORDER_MEMBER],[t.ORDER_FUNCTION_CALL,t.ORDER_FUNCTION_CALL],[t.ORDER_MEMBER,t.ORDER_MEMBER],[t.ORDER_MEMBER,t.ORDER_FUNCTION_CALL],[t.ORDER_LOGICAL_NOT,t.ORDER_LOGICAL_NOT],[t.ORDER_LOGICAL_AND,t.ORDER_LOGICAL_AND],[t.ORDER_LOGICAL_OR,t.ORDER_LOGICAL_OR]];t.init=(a)=>{if(t.PASS=t.INDENT+"pass\n",t.definitions_=Object.create(null),t.functionNames_=Object.create(null),!t.variableDB_)t.variableDB_=new H.Names(t.RESERVED_WORDS_);else t.variableDB_.reset();t.variableDB_.setVariableMap(a.getVariableMap());const u=[],E=a.getAllVariables();for(let o=0;o<E.length;o++){if(E[o].type===H.BROADCAST_MESSAGE_VARIABLE_TYPE)continue;let s=t.variableDB_.getName(E[o].getId(),H.Variables.NAME_TYPE),C="";if(E[o].type===H.LIST_VARIABLE_TYPE)s=`${s}_${H.LIST_VARIABLE_TYPE}`,C="[]";u.push(`${s} = ${C}`)}const i=H.Variables.allDeveloperVariables(a);for(let o=0;o<i.length;o++){let s=t.variableDB_.getName(i[o],H.Names.DEVELOPER_VARIABLE_TYPE),C="";if(E[o].type===H.LIST_VARIABLE_TYPE)s=`${s}_${H.LIST_VARIABLE_TYPE}`,C="[]";u.push(`${s} = ${C}`)}if(u.length)t.definitions_.variables=u.join("\n");t.definitions_.import_blocks="from blocks import *"};t.finish=(a)=>{const u=[],E=[];for(let o in t.definitions_){const s=t.definitions_[o];if(s.match(/^(from\s+\S+\s+)?import\s+\S+/))u.push(s);else E.push(s)}return delete t.definitions_,delete t.functionNames_,t.variableDB_.reset(),(u.join("\n")+"\n\n"+E.join("\n\n")).replace(/\n\n+/g,"\n\n").replace(/\n*$/,"\n\n\n")+a};t.scrubNakedValue=(a)=>{return a+"\n"};t.quote_=(a)=>{let u='"';if(a.indexOf('"')!==-1)if(a.indexOf("'")===-1)u="'";else a=a.replace(/"/g,'\\"');return u+a+u};t.scrub_=(a,u)=>{let E="";if(!a.outputConnection?.targetConnection){let i=a.getCommentText();if(i=H.utils.wrap(i,t.COMMENT_WRAP-3),i)if(a.getProcedureDef)E+='"""'+i+'\n"""\n';else E+=t.prefixLines(i+"\n","# ");for(let o=0;o<a.inputList.length;o++)if(a.inputList[o].type==H.INPUT_VALUE){const s=a.inputList[o].connection.targetBlock();if(s){const C=t.allNestedComments(s);if(C)E+=t.prefixLines(C,"# ")}}}if(a.startHat_){const i=a.nextConnection&&a.nextConnection.targetBlock();let o=t.blockToCode(i);if(o)o=t.prefixLines(o,t.INDENT),u=u.replace(`\n${t.PASS}`,`\n${o}`);return E+u}if(a.parentBlock_){const i=a.nextConnection&&a.nextConnection.targetBlock(),o=t.blockToCode(i);return E+u+o}};t.getAdjustedInt=(a,u,E,i)=>{let o=E||0;if(a.workspace.options.oneBasedIndex)o--;const s=a.workspace.options.oneBasedIndex?"1":"0",C=o?t.ORDER_ADDITIVE:t.ORDER_NONE;let _=t.valueToCode(a,u,C)||s;if(H.isNumber(_)){if(_=parseInt(_,10)+o,i)_=-_}else{if(o>0)_="int("+_+" + "+o+")";else if(o<0)_="int("+_+" - "+-o+")";else _="int("+_+")";if(i)_="-"+_}return _};t.hatToCode=(a="",...u)=>{if(!t.functionNames_[a])t.functionNames_[a]=0;t.functionNames_[a]+=1;const E=`${a}_${t.functionNames_[a]}`;return t.HAT_FUNCTION_PLACEHOLDER=E,`async def ${E}(${u.join(", ")}):\n  this_func = ${E}\n${t.PASS}\n`};var qt=(a)=>{const u=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;a=a.replace(u,(i,o,s,C)=>o+o+s+s+C+C);const E=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(a);return E?{r:parseInt(E[1],16),g:parseInt(E[2],16),b:parseInt(E[3],16)}:null};t.colour_picker=(a)=>{const{r:u,g:E,b:i}=qt(a.getFieldValue("COLOUR"));return[`(${u}, ${E}, ${i})`,t.ORDER_ATOMIC]};var s1="  await runtime.next_frame()\n";t.control_wait=(a)=>{let u="";if(t.STATEMENT_PREFIX)u+=t.injectId(t.STATEMENT_PREFIX,a);const E=t.valueToCode(a,"DURATION",t.ORDER_NONE)||0;return u+=`await runtime.wait_for(num(${E}))\n`,u};t.control_repeat=(a)=>{let u="";if(t.STATEMENT_PREFIX)u+=t.injectId(t.STATEMENT_PREFIX,a);let E=t.statementToCode(a,"SUBSTACK")||t.PASS;if(t.STATEMENT_SUFFIX)E=t.prefixLines(t.injectId(t.STATEMENT_SUFFIX,a),t.INDENT)+E;const i=t.valueToCode(a,"TIMES",t.ORDER_NONE)||10;return u+=`for _ in range(num(${i})):\n${E}${s1}`,u};t.control_forever=(a)=>{let u="";if(t.STATEMENT_PREFIX)u+=t.injectId(t.STATEMENT_PREFIX,a);let E=t.statementToCode(a,"SUBSTACK")||t.PASS;if(t.STATEMENT_SUFFIX)E=t.prefixLines(t.injectId(t.STATEMENT_SUFFIX,a),t.INDENT)+E;return u+=`while True:\n${E}${s1}`,u};t.control_if=(a)=>{let u="";if(t.STATEMENT_PREFIX)u+=t.injectId(t.STATEMENT_PREFIX,a);let E=t.statementToCode(a,"SUBSTACK")||t.PASS;if(t.STATEMENT_SUFFIX)E=t.prefixLines(t.injectId(t.STATEMENT_SUFFIX,a),t.INDENT)+E;const i=t.valueToCode(a,"CONDITION",t.ORDER_NONE)||"False";if(u+=`if ${i}:\n${E}`,a.getInput("SUBSTACK2")){if(E=t.statementToCode(a,"SUBSTACK2")||t.PASS,t.STATEMENT_SUFFIX)E=t.prefixLines(t.injectId(t.STATEMENT_SUFFIX,a),t.INDENT)+E;u+=`else:\n${E}`}return u};t.control_if_else=t.control_if;t.control_wait_until=(a)=>{let u="";if(t.STATEMENT_PREFIX)u+=t.injectId(t.STATEMENT_PREFIX,a);const E=t.valueToCode(a,"CONDITION",t.ORDER_NONE)||"False";return u+=`while not ${E}:\n${s1}`,u};t.control_repeat_until=(a)=>{let u="";if(t.STATEMENT_PREFIX)u+=t.injectId(t.STATEMENT_PREFIX,a);let E=t.statementToCode(a,"SUBSTACK")||t.PASS;if(t.STATEMENT_SUFFIX)E=t.prefixLines(t.injectId(t.STATEMENT_SUFFIX,a),t.INDENT)+E;const i=t.valueToCode(a,"CONDITION",t.ORDER_NONE)||"False";return u+=`while not ${i}:\n${E}${s1}`,u};t.control_while=(a)=>{let u="";if(t.STATEMENT_PREFIX)u+=t.injectId(t.STATEMENT_PREFIX,a);let E=t.statementToCode(a,"SUBSTACK")||t.PASS;if(t.STATEMENT_SUFFIX)E=t.prefixLines(t.injectId(t.STATEMENT_SUFFIX,a),t.INDENT)+E;const i=t.valueToCode(a,"CONDITION",t.ORDER_NONE)||"False";return u+=`while ${i}:\n${E}${s1}`,u};t.control_stop=(a)=>{let u="";if(t.STATEMENT_PREFIX)u+=t.injectId(t.STATEMENT_PREFIX,a);switch(a.getFieldValue("STOP_OPTION")){case"all":u+="runtime.stop()\n";break;case"this script":u+="return\n";break;case"other scripts in sprite":u+="runtime.stop_tasks(this_func)\n";break}return u};import{ScratchBlocks as c} from"@blockcode/blocks-editor";t.data_variable=(a)=>{return[t.variableDB_.getName(a.getFieldValue("VARIABLE"),c.Variables.NAME_TYPE),t.ORDER_ATOMIC]};t.data_setvariableto=(a)=>{let u="";if(javascriptGenerator.STATEMENT_PREFIX)u+=javascriptGenerator.injectId(javascriptGenerator.STATEMENT_PREFIX,a);const E=t.variableDB_.getName(a.getFieldValue("VARIABLE"),c.Variables.NAME_TYPE),i=t.valueToCode(a,"VALUE",t.ORDER_NONE)||'""';return u+=`${E} = ${i}\n`,u};t.data_changevariableby=(a)=>{let u="";if(javascriptGenerator.STATEMENT_PREFIX)u+=javascriptGenerator.injectId(javascriptGenerator.STATEMENT_PREFIX,a);const E=t.variableDB_.getName(a.getFieldValue("VARIABLE"),c.Variables.NAME_TYPE),i=t.valueToCode(a,"VALUE",t.ORDER_NONE)||0;return u+=`${E} = num(${E}) + num(${i})\n`,u};t.data_listcontents=(a)=>{return[t.variableDB_.getName(a.getFieldValue("LIST"),c.Variables.NAME_TYPE)+"_"+c.LIST_VARIABLE_TYPE,t.ORDER_ATOMIC]};t.data_addtolist=(a)=>{let u="";if(t.STATEMENT_PREFIX)u+=t.injectId(t.STATEMENT_PREFIX,a);const E=t.variableDB_.getName(a.getFieldValue("LIST"),c.Variables.NAME_TYPE)+"_"+c.LIST_VARIABLE_TYPE,i=t.valueToCode(a,"ITEM",t.ORDER_NONE)||'""';return u+=`${E}.append(${i})\n`,u};t.data_deleteoflist=(a)=>{let u="";if(t.STATEMENT_PREFIX)u+=t.injectId(t.STATEMENT_PREFIX,a);const E=t.variableDB_.getName(a.getFieldValue("LIST"),c.Variables.NAME_TYPE)+"_"+c.LIST_VARIABLE_TYPE,i=t.valueToCode(a,"INDEX",t.ORDER_NONE)||1;return u+=`${E}.remove(runtime.index(${i}, len(${E})))\n`,u};t.data_deletealloflist=(a)=>{let u="";if(t.STATEMENT_PREFIX)u+=t.injectId(t.STATEMENT_PREFIX,a);const E=t.variableDB_.getName(a.getFieldValue("LIST"),c.Variables.NAME_TYPE)+"_"+c.LIST_VARIABLE_TYPE;return u+=`${E} = []\n`,u};t.data_insertatlist=(a)=>{let u="";if(t.STATEMENT_PREFIX)u+=t.injectId(t.STATEMENT_PREFIX,a);const E=t.variableDB_.getName(a.getFieldValue("LIST"),c.Variables.NAME_TYPE)+"_"+c.LIST_VARIABLE_TYPE,i=t.valueToCode(a,"INDEX",t.ORDER_NONE)||1,o=t.valueToCode(a,"ITEM",t.ORDER_NONE)||'""';return u+=`${E}.insert(runtime.index(${i}, len(${E})), ${o})\n`,u};t.data_replaceitemoflist=(a)=>{let u="";if(t.STATEMENT_PREFIX)u+=t.injectId(t.STATEMENT_PREFIX,a);const E=t.variableDB_.getName(a.getFieldValue("LIST"),c.Variables.NAME_TYPE)+"_"+c.LIST_VARIABLE_TYPE,i=t.valueToCode(a,"INDEX",t.ORDER_NONE)||1,o=t.valueToCode(a,"ITEM",t.ORDER_NONE)||'""';return u+=`${E}[runtime.index(${i}, len(${E}))] = ${o}\n`,u};t.data_itemoflist=(a)=>{const u=t.variableDB_.getName(a.getFieldValue("LIST"),c.Variables.NAME_TYPE)+"_"+c.LIST_VARIABLE_TYPE,E=t.valueToCode(a,"INDEX",t.ORDER_NONE)||1;return[`${u}[runtime.index(${E}, len(${u}))]`,t.ORDER_CONDITIONAL]};t.data_itemnumoflist=(a)=>{const u=t.variableDB_.getName(a.getFieldValue("LIST"),c.Variables.NAME_TYPE)+"_"+c.LIST_VARIABLE_TYPE,E=t.valueToCode(a,"ITEM",t.ORDER_NONE)||0;return[`(${u}.index(${E}) + 1)`,t.ORDER_NONE]};t.data_lengthoflist=(a)=>{return[`len(${t.variableDB_.getName(a.getFieldValue("LIST"),c.Variables.NAME_TYPE)+"_"+c.LIST_VARIABLE_TYPE})`,t.ORDER_FUNCTION_CALL]};t.data_listcontainsitem=(a)=>{const u=t.variableDB_.getName(a.getFieldValue("LIST"),c.Variables.NAME_TYPE)+"_"+c.LIST_VARIABLE_TYPE,E=t.valueToCode(a,"ITEM",t.ORDER_NONE)||0;return[`bool(${u}.count(${E}))`,t.ORDER_FUNCTION_CALL]};import{ScratchBlocks as y1} from"@blockcode/blocks-editor";t.event_whenflagclicked=()=>{return`${t.hatToCode("start")}runtime.when_start(${t.HAT_FUNCTION_PLACEHOLDER})\n`};t.event_whengreaterthan=(a)=>{const u=a.getFieldValue("WHENGREATERTHANMENU"),E=t.valueToCode(a,"VALUE",t.ORDER_NONE)||0;return`${t.hatToCode("greaterthen")}runtime.when_greaterthen("${u}", num(${E}), ${t.HAT_FUNCTION_PLACEHOLDER})\n`};t.event_whenbroadcastreceived=(a)=>{const u=t.variableDB_.getName(a.getFieldValue("BROADCAST_OPTION"),y1.Variables.NAME_TYPE);return`${t.hatToCode("broadcastreceived")}runtime.when_broadcastreceived("${u}", ${t.HAT_FUNCTION_PLACEHOLDER})\n`};t.event_broadcast_menu=(a)=>{return[t.variableDB_.getName(a.getFieldValue("BROADCAST_OPTION"),y1.Variables.NAME_TYPE),t.ORDER_ATOMIC]};t.event_broadcast=(a)=>{return`runtime.broadcast("${t.valueToCode(a,"BROADCAST_INPUT",t.ORDER_NONE)||'"message1"'}")\n`};t.event_broadcastandwait=(a)=>{return`await runtime.broadcast("${t.valueToCode(a,"BROADCAST_INPUT",t.ORDER_NONE)||'"message1"'}", waiting=True)\n`};t.addReservedWords("math,random,Number");t.math_number=(a)=>{let u=parseFloat(a.getFieldValue("NUM")),E;if(u===1/0)u='float("inf")',E=t.ORDER_FUNCTION_CALL;else if(u===-1/0)u='-float("inf")',E=t.ORDER_UNARY_SIGN;else if(Number.isNaN(u))u='float("nan")',E=t.ORDER_UNARY_SIGN;else E=u<0?t.ORDER_UNARY_SIGN:t.ORDER_ATOMIC;return[u,E]};t.math_integer=(a)=>{const u=parseInt(a.getFieldValue("NUM")),E=u<0?t.ORDER_UNARY_SIGN:t.ORDER_ATOMIC;return[u,E]};t.math_whole_number=(a)=>{return[Math.abs(parseInt(a.getFieldValue("NUM"))),t.ORDER_ATOMIC]};t.math_positive_number=(a)=>{let u=parseFloat(a.getFieldValue("NUM")),E;if(u===1/0)u='float("inf")',E=t.ORDER_FUNCTION_CALL;else if(u===-1/0)u='-float("inf")',E=t.ORDER_FUNCTION_CALL;else if(Number.isNaN(u))u='float("nan")',E=t.ORDER_FUNCTION_CALL;else u=u<0?0:u,E=t.ORDER_ATOMIC;return[u,E]};t.math_angle=(a)=>{let u=parseFloat(a.getFieldValue("NUM")),E;if(u==1/0)u='float("inf")',E=t.ORDER_FUNCTION_CALL;else if(u==-1/0)u='-float("inf")',E=t.ORDER_UNARY_SIGN;else u=u%360,u=u<0?u+360:u,E=t.ORDER_ATOMIC;return[u,E]};t.operator_add=(a)=>{const u=t.valueToCode(a,"NUM1",t.ORDER_NONE)||0,E=t.valueToCode(a,"NUM2",t.ORDER_NONE)||0;return[`(num(${u}) + num(${E}))`,t.ORDER_SUBTRACTION]};t.operator_subtract=(a)=>{const u=t.valueToCode(a,"NUM1",t.ORDER_NONE)||0,E=t.valueToCode(a,"NUM2",t.ORDER_NONE)||0;return[`(num(${u}) - num(${E}))`,t.ORDER_SUBTRACTION]};t.operator_multiply=(a)=>{const u=t.valueToCode(a,"NUM1",t.ORDER_NONE)||0,E=t.valueToCode(a,"NUM2",t.ORDER_NONE)||0;return[`(num(${u}) * num(${E}))`,t.ORDER_SUBTRACTION]};t.operator_divide=(a)=>{const u=t.valueToCode(a,"NUM1",t.ORDER_NONE)||0,E=t.valueToCode(a,"NUM2",t.ORDER_NONE)||0;return[`(num(${u}) / num(${E}))`,t.ORDER_SUBTRACTION]};t.operator_random=(a)=>{const u=t.valueToCode(a,"FROM",t.ORDER_NONE)||0,E=t.valueToCode(a,"TO",t.ORDER_NONE)||0;return[`runtime.random(${u}, ${E})`,t.ORDER_FUNCTION_CALL]};t.operator_gt=(a)=>{const u=t.valueToCode(a,"OPERAND1",t.ORDER_NONE)||0,E=t.valueToCode(a,"OPERAND2",t.ORDER_NONE)||0;return[`(num(${u}) > num(${E}))`,t.ORDER_RELATIONAL]};t.operator_lt=(a)=>{const u=t.valueToCode(a,"OPERAND1",t.ORDER_NONE)||0,E=t.valueToCode(a,"OPERAND2",t.ORDER_NONE)||0;return[`(num(${u}) < num(${E}))`,t.ORDER_RELATIONAL]};t.operator_equals=(a)=>{const u=t.valueToCode(a,"OPERAND1",t.ORDER_NONE)||0,E=t.valueToCode(a,"OPERAND2",t.ORDER_NONE)||0;return[`equals(${u}, ${E})`,t.ORDER_FUNCTION_CALL]};t.operator_and=(a)=>{const u=t.valueToCode(a,"OPERAND1",t.ORDER_NONE)||"False",E=t.valueToCode(a,"OPERAND2",t.ORDER_NONE)||"False";return[`(${u} and ${E})`,t.ORDER_LOGICAL_AND]};t.operator_or=(a)=>{const u=t.valueToCode(a,"OPERAND1",t.ORDER_NONE)||"False",E=t.valueToCode(a,"OPERAND2",t.ORDER_NONE)||"False";return[`(${u} or ${E})`,t.ORDER_LOGICAL_OR]};t.operator_not=(a)=>{return[`(not ${t.valueToCode(a,"OPERAND",t.ORDER_NONE)||"False"})`,t.ORDER_LOGICAL_NOT]};t.operator_join=(a)=>{const u=t.valueToCode(a,"STRING1",t.ORDER_NONE)||'""',E=t.valueToCode(a,"STRING2",t.ORDER_NONE)||'""';return[`(str(${u}) + str(${E}))`,t.ORDER_ATOMIC]};t.operator_letter_of=(a)=>{const u=t.valueToCode(a,"LETTER",t.ORDER_NONE)||0;return[`(str(${t.valueToCode(a,"STRING",t.ORDER_NONE)||'""'})[num(${u}) - 1] || "")`,t.ORDER_MEMBER]};t.operator_length=(a)=>{return[`len(str(${t.valueToCode(a,"STRING",t.ORDER_NONE)||'""'}))`,t.ORDER_FUNCTION_CALL]};t.operator_contains=(a)=>{const u=t.valueToCode(a,"STRING1",t.ORDER_NONE)||'""',E=t.valueToCode(a,"STRING2",t.ORDER_NONE)||'""';return[`(str(${u}).count(str(${E})) > 0)`,t.ORDER_FUNCTION_CALL]};t.operator_mod=(a)=>{const u=t.valueToCode(a,"NUM1",t.ORDER_NONE)||0,E=t.valueToCode(a,"NUM2",t.ORDER_NONE)||0;return[`(num(${u}) % num(${E}))`,t.ORDER_MODULUS]};t.operator_round=(a)=>{return t.definitions_.import_math="import math",[`math.round(num(${t.valueToCode(a,"NUM",t.ORDER_NONE)||0}))`,t.ORDER_FUNCTION_CALL]};t.operator_mathop=(a)=>{t.definitions_.import_math="import math";const u=t.valueToCode(a,"NUM",t.ORDER_NONE)||0,E=a.getFieldValue("OPERATOR");let i="";if(E==="ceiling")i+=`math.ceil(num(${u}))`;else if(E==="sin"||E==="cos"||E==="tan")i+=`math.${E}(math.radians(num(${u})))`;else if(E==="asin"||E==="acos"||E==="atan")i+=`math.degrees(math.${E}(num(${u})))`;else if(E==="ln")i+=`(math.log(num(${u}))`;else if(E==="log")i+=`(math.log10(num(${u}))`;else if(E==="e ^")i+=`math.exp(num(${u}))`;else if(E==="10 ^")i+=`math.pow(10, num(${u}))`;else i+=`math.${E}(num(${u}))`;return[i,t.ORDER_FUNCTION_CALL]};t.procedures_definition=(a)=>{};t.procedures_call=(a)=>{};t.procedures_prototype=(a)=>{};t.procedures_declaration=(a)=>{};t.argument_reporter_boolean=(a)=>{};t.argument_reporter_string_number=(a)=>{};t.argument_editor_boolean=(a)=>{};t.argument_editor_string_number=(a)=>{};t.sensing_timer=()=>{return["runtime.time",t.ORDER_MEMBER]};t.sensing_resettimer=()=>{return"runtime.reset_timer()\n"};t.text=(a)=>{const u=a.getFieldValue("TEXT");return[u.length===0||isNaN(u)?t.quote_(u):+u,t.ORDER_ATOMIC]};import{useEffect as R0,useState as O1} from"preact/hooks";import{useLocale as e0,useLayout as r0,useEditor as _t} from"@blockcode/core";import{classNames as n0} from"@blockcode/ui";import{BlocksEditor as l0,ScratchBlocks as X,makeToolboxXML as O0} from"@blockcode/blocks-editor";import{ScratchBlocks as G1,blockSeparator as jt} from"@blockcode/blocks-editor";var kt=1,xt=2,yt=3,tt="#0FBD8C",at="#0DA57A",Gt="#0B8E69",i1=(a)=>{if(typeof a!=="string")if(Array.isArray(a))a=String(a);else return a;return a.replace(/[<>&'"]/g,(u)=>{switch(u){case"<":return"&lt;";case">":return"&gt;";case"&":return"&amp;";case"'":return"&apos;";case'"':return"&quot;"}})},ut={number:"math_number",angle:"math_angle",text:"text",string:"text",color:"colour_picker",matrix:"matrix",note:"note"},Et={number:"NUM",angle:"NUM",text:"TEXT",string:"TEXT",matrix:"MATRIX",note:"NOTE"};function $1(a,u,E,i){const{id:o}=a,s=E(a.name);let C=`<category name="${i1(s)}" id="${i1(o)}"`;if(C+=` colour="${i1(a.themeColor||tt)}"`,C+=` secondaryColour="${i1(a.inputColor||at)}"`,a.connectionConfig)C+=' showStatusButton="true"';if(a.iconURI)C+=` iconURI="${i1(a.iconURI)}"`;return C+=">",a.blocks.forEach((_)=>{if(_==="---"){C+=`${jt}`;return}if(_.button){C+=`<button text="${E(_.text)}" callbackKey="${_.button}"></button>`;const D=G1.getMainWorkspace();if(D){const f=D.getFlyout();if(f){const I=f.getWorkspace();if(I)I.registerButtonCallback(_.button,i(_.onClick))}}return}if(u&&_.useStage===!1)return;if(!u&&_.useSprite===!1)return;const O=`${o}_${_.id.toLowerCase()}`,R={message0:E(_.text),category:o,outputShape:yt,colour:a.themeColor||tt,colourSecondary:a.inputColor||at,colourTertiary:a.otherColor||Gt};let $=1;if(a.iconURI)R.message0=`%1 %2 ${R.message0}`,R.args0=[{type:"field_image",src:a.iconURI,width:40,height:40},{type:"field_vertical_separator"}],R.extensions=["scratch_extension"],$+=2;if(_.hat)R.nextStatement=null;else if(_.output){if(_.output==="boolean")R.output="Boolean",R.outputShape=kt;else R.output="String",R.outputShape=xt;R.checkboxInFlyout=_.monitoring!==!1}else R.previousStatement=null,R.nextStatement=null;let P=`<block type="${i1(O)}">`;if(_.inputs)R.checkboxInFlyout=!1,R.args0=[].concat(R.args0||[],Object.entries(_.inputs).map(([D,f])=>{const I={name:D,type:"input_value"};if(f.menu)I.type="field_dropdown",I.options=f.menu.map(([n,A])=>[E(n),A]);else if(f.type==="boolean")I.check="Boolean";else{if(P+=`<value name="${i1(D)}">`,ut[f.type]){if(P+=`<shadow type="${ut[f.type]}">`,f.default&&Et[f.type])P+=`<field name="${Et[f.type]}">${i1(E(f.default))}</field>`;P+="</shadow>"}P+="</value>"}return R.message0=R.message0.replace(`[${D}]`,`%${$++}`),I}));if(G1.Blocks[O]={init(){this.jsonInit(R)}},_.python)t[O]=_.python.bind(t);else t[O]=()=>"";P+="</block>",C+=P}),C+="</category>",C}import{useRef as t0,useEffect as a0,useState as it} from"preact/hooks";import{classNames as u0,Text as o1,Button as Tt,Modal as E0,BufferedInput as i0} from"@blockcode/ui";function R1(a){const u=globalThis.document,E=u.createElement("style");E.appendChild(u.createTextNode(a)),u.head.append(E)}R1("._5SVWFW_prompt-modal{width:360px}._5SVWFW_prompt-content{background:var(--ui-white);padding:1.5rem 2.25rem}._5SVWFW_prompt-content input[type=checkbox],._5SVWFW_prompt-content input[type=radio]{margin:3px}._5SVWFW_label{margin:0 0 .75rem;font-weight:500}._5SVWFW_variable-name-text-input{border:1px solid var(--ui-black-transparent);color:var(--text-primary-transparent);border-radius:5px;width:100%;height:3rem;margin-bottom:1.5rem;padding:0 1rem;font-size:.875rem}._5SVWFW_info-message{text-align:center;margin-bottom:1.5rem;font-size:.875rem;font-weight:400}._5SVWFW_options{justify-content:space-between;margin-bottom:1.5rem;font-weight:400;display:flex}._5SVWFW_button-row{text-align:right;font-weight:bolder}._5SVWFW_button{padding:.75rem 1rem;font-size:.85rem;font-weight:600}._5SVWFW_ok-button{background:var(--motion-primary);border:var(--motion-primary);color:var(--ui-white);margin-left:var(--space)}");var q={infoMessage:"_5SVWFW_info-message",promptModal:"_5SVWFW_prompt-modal",promptContent:"_5SVWFW_prompt-content",variableNameTextInput:"_5SVWFW_variable-name-text-input",options:"_5SVWFW_options",button:"_5SVWFW_button",okButton:"_5SVWFW_ok-button",buttonRow:"_5SVWFW_button-row",label:"_5SVWFW_label"};import{jsx as b,jsxs as e1} from"preact/jsx-runtime";function w1({title:a,label:u,defaultValue:E,enableLocalVariable:i,showListMessage:o,showVariableOptions:s,showCloudOption:C,onClose:_,onSubmit:O}){const R=t0(null),[$,P]=it(E),[D,f]=it({scope:"global",isCloud:!1}),I=()=>{O($,D)},n=(A)=>{if(A.key==="Escape")_();if(A.key==="Enter")O(R.current.base.value,D)};return a0(()=>{if(R.current)R.current.base.focus(),window.addEventListener("keydown",n);return()=>{window.removeEventListener("keydown",n)}},[R]),b(E0,{title:a,className:q.promptModal,onClose:_,children:e1("div",{className:q.promptContent,children:[b("div",{className:q.label,children:u}),b(i0,{autoFocus:!0,forceFocus:!0,ref:R,className:q.variableNameTextInput,defaultValue:$,onSubmit:P}),s&&b("div",{children:i?e1("div",{className:q.options,children:[e1("label",{children:[b("input",{checked:D.scope==="global",name:"variableScopeOption",type:"radio",value:"global",onChange:()=>f({...D,scope:"global"})}),b(o1,{id:"blocks.dataPrompt.forAllTargets",defaultMessage:"For all targets"})]}),e1("label",{children:[b("input",{checked:D.scope==="local",name:"variableScopeOption",type:"radio",value:"local",onChange:()=>f({...D,scope:"local"})}),b(o1,{id:"blocks.dataPrompt.forThisTarget",defaultMessage:"For this target only"})]})]}):b("div",{className:q.infoMessage,children:o?b(o1,{id:"blocks.dataPrompt.listAvailableToAllTargets",defaultMessage:"This list will be available to all targets."}):b(o1,{id:"blocks.dataPrompt.availableToAllTargets",defaultMessage:"This variable will be available to all targets."})})}),e1("div",{className:q.buttonRow,children:[b(Tt,{className:q.button,onClick:_,children:b(o1,{id:"blocks.dataPrompt.cancel",defaultMessage:"Cancel"})}),b(Tt,{className:u0(q.button,q.okButton),onClick:I,children:b(o1,{id:"blocks.dataPrompt.ok",defaultMessage:"OK"})})]})]})})}import{useEffect as T0,useState as Nt} from"preact/hooks";import{useLocale as d0,useLayout as N0,useEditor as o0} from"@blockcode/core";import{Library as _0} from"@blockcode/ui";var dt=["nes","translate","color-sensor","servo","time","pen","brain","request","text","broadcast"].map(async(a)=>{const{default:u}=await import(`@blockcode/extension-${a}`);return u.id=a,u});import{jsx as m0} from"preact/jsx-runtime";var C0=Promise.all(dt);function V1({deviceId:a,onSelect:u,onClose:E,onFilter:i}){const[o,s]=Nt([]),[C,_]=Nt(!1),{language:O,getText:R}=d0(),{createAlert:$,removeAlert:P}=N0(),{addAsset:D}=o0(),f=(I)=>{const n=I.tags||[];let A=["blocks",["dupont","data"],["3v3","5v"]];if(i)A=i(n);if(Array.isArray(A))return A.every((w)=>{if(Array.isArray(w))return w.some((Q)=>n.includes(Q));return n.includes(w)});return A};return T0(()=>{C0.then((I)=>{s(I.filter(f).map((n)=>Object.assign({...n,featured:!0,disabled:n.disabled||n.preview,onSelect:async()=>{$("importing",{id:n.id});let{default:A}=await import(`@blockcode/extension-${n.id}/blocks`);if(typeof A==="function")A=A(a);if(A.id=n.id,A.files)for(let w of A.files){const Q=`extensions/${n.id.replace(/[^a-z\d]/gi,"_")}/${w.name}`,F=await fetch(w.uri).then((W)=>W.text());D({...w,id:Q,content:F})}u(A),P(n.id),E()}},n.translations&&n.translations[O]?{name:n.translations[O].name||n.name,description:n.translations[O].description||n.description,collaborator:n.translations[O].collaborator||n.collaborator}:{}))),_(!1)})},[]),m0(_0,{filterable:!0,loading:C,items:o,filterPlaceholder:R("gui.library.search","Search"),title:R("blocks.extensions.addExtension","Add Extension"),emptyText:R("blocks.extensions.empty","No extension!"),onClose:E})}R1(".cujmXa_editor-wrapper{border-radius:inherit;width:100%;height:100%;position:relative}.cujmXa_extension-button{z-index:var(--z-index-extension-button);background:var(--motion-primary);border:1px solid var(--motion-primary);box-sizing:content-box;border-bottom-left-radius:inherit;border-top:0;height:3.25rem;position:absolute;bottom:-1px;left:-1px}.cujmXa_extension-button:before{--fade-out-distance:15px;content:\"\";top:calc(calc(-1*var(--fade-out-distance)));height:var(--fade-out-distance);background:linear-gradient(#0000,#00000026);position:absolute;left:0;right:0}.cujmXa_add-button{cursor:pointer;background:0 0;border:none;outline:none;width:100%;height:100%}.cujmXa_add-button img{width:1.75rem;height:1.75rem}.cujmXa_debug-box{z-index:var(--z-index-monitor);border:1px solid var(--ui-tertiary);border-radius:var(--space)var(--space)0 0;opacity:.8;font-size:var(--standard-font-size);background:#fff;border-bottom:0;width:600px;height:300px;position:absolute;bottom:0;left:50vw;overflow:auto;transform:translate(-50%)}.cujmXa_debug-box pre{margin:calc(var(--space)/2)}");var l1={addButton:"cujmXa_add-button",editorWrapper:"cujmXa_editor-wrapper",extensionButton:"cujmXa_extension-button",debugBox:"cujmXa_debug-box"};var ot="./assets/icon-extension-5ec2ee35b87b4126.svg";import{jsx as _1,jsxs as Ct,Fragment as M0} from"preact/jsx-runtime";var k=new Map,mt=(a)=>typeof a!=="string"&&!a.button,A0=async(a,u,E,i,o)=>{if(u){for(let s of u)if(!k.has(s)){let{default:C}=await import(`@blockcode/extension-${s}/blocks`);if(typeof C==="function")C=C(a);if(C.id=s,C.files)for(let _ of C.files){const O=`extensions/${s}/${_.name}`,R=await fetch(_.uri).then(($)=>$.text());i({..._,id:O,content:R})}if(E(C.translations),o)o({...C,blocks:C.blocks.filter(mt)});k.set(s,C)}}};function A1({toolbox:a,messages:u,enableMultiTargets:E,enableLocalVariable:i,disableGenerator:o,disableExtension:s,deviceId:C,onChange:_,onExtensionsFilter:O,onLoadExtension:R}){const{addLocaleData:$,getText:P,maybeLocaleText:D}=e0(),{splash:f,createPrompt:I,createAlert:n,removeAlert:A,setSplash:w}=r0(),{editor:Q,fileList:F,selectedFileId:W,openFile:u1,modifyFile:C1,addAsset:M1,setModified:S1}=_t(),[x,r]=O1(),[T,N]=O1(!1),[d,m]=O1(!1),[M,S]=O1(!1);if(f){if(f===!0&&M===!1)k.clear(),S(A0(C,Q.extensions,$,M1,R).then(()=>setTimeout(()=>S(!0),100)));if(M===!0){let e=!0;if(F.length>1){for(let g=0;g>-F.length;g--)if(!F.at(g).content){e=!1,setTimeout(()=>{const U=(g+F.length)%F.length;u1(F[U].id)},100);break}}if(e)setTimeout(()=>{w(!1),S1(!1),S(!1)},100)}}u={EVENT_WHENPROGRAMSTART:P("blocks.event.programStart","when program start"),CONTROL_STOP_OTHER:P("blocks.control.stopOther","other scripts"),...u||[]},R0(()=>{X.prompt=(e,g,p,U,y)=>{const h={callback:p,message:e,defaultValue:g};h.title=U?U:X.Msg.VARIABLE_MODAL_TITLE,h.varType=typeof y==="string"?y:X.SCALAR_VARIABLE_TYPE,h.showVariableOptions=E&&y!==X.BROADCAST_MESSAGE_VARIABLE_TYPE&&h.title!==X.Msg.RENAME_VARIABLE_MODAL_TITLE&&h.title!==X.Msg.RENAME_LIST_MODAL_TITLE,h.showCloudOption=y===X.SCALAR_VARIABLE_TYPE&&this.props.canUseCloud,N(h)},X.FlyoutExtensionCategoryHeader.getExtensionState=(e)=>{if(k.has(e)){const g=k.get(e);if(g.connectionConfig?.items.every((p)=>localStorage.getItem(`${g.id}.connection.${p.id}`)))return X.StatusButtonState.READY}return X.StatusButtonState.NOT_READY},X.statusButtonCallback=(e)=>{if(!k.has(e))return;const g=k.get(e),{connectionConfig:p}=g;if(!p)return;I({title:g.name,label:p.title,inputMode:p.items.map((U)=>({name:U.id,placeholder:U.text,defaultValue:localStorage.getItem(`${g.id}.connection.${U.id}`)})),content:p.description,onSubmit:(U)=>{if(Object.entries(U).forEach(([y,h])=>{localStorage.setItem(`${g.id}.connection.${y}`,`${h}`)}),x)X.refreshStatusButtons(x)}})}},[x]);let L;if(x)L=x.getAllVariables().filter((e)=>{if(e.isLocal)return!1;if(e.type===X.BROADCAST_MESSAGE_VARIABLE_TYPE){if(e.name===X.Msg.DEFAULT_BROADCAST_MESSAGE_NAME)return!1;const g=e.id_.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),p=new RegExp(`<field name="BROADCAST_OPTION" id="${g}"[^>]+>[^<]+</field>`,"g");for(let U of F)if(p.test(U.xml))return!0;return!1}return!0});let Z=a||O0();const j=W===F[0].id,Y=(e)=>e.bind(null,{context:_t(),createPrompt:I,createAlert:n,removeAlert:A});k.forEach((e)=>{Z+=$1(e,j,D,Y)});const B=(e,g)=>{let p;if(!o)p=t.workspaceToCode(g);if(C1({xml:e,content:p}),_)_(e,g)},K=(e,g)=>{T.callback(e,[],g),N(!1)},v=()=>N(!1),z=()=>m(!0),V=()=>m(!1),l=(e)=>{if(!k.has(e.id)){if($(e.translations),R)R({...e,blocks:e.blocks.filter(mt)});k.set(e.id,e)}setTimeout(()=>{x.toolbox_.setSelectedCategoryById(e.id)},100)};return Ct(M0,{children:[Ct("div",{className:l1.editorWrapper,children:[_1(l0,{toolbox:Z,messages:u,globalVariables:L,onWorkspaceCreated:r,onChange:W!==null?B:null}),s?null:_1("div",{className:n0("scratchCategoryMenu",l1.extensionButton),children:_1("button",{className:l1.addButton,title:P("blocks.extensions.addExtension","Add Extension"),onClick:z,children:_1("img",{src:ot,title:"Add Extension"})})}),T&&_1(w1,{title:T.title,label:T.message,defaultValue:T.defaultValue,enableLocalVariable:i,showListMessage:T.varType===X.LIST_VARIABLE_TYPE,showVariableOptions:T.showVariableOptions,showCloudOption:T.showCloudOption,onClose:v,onSubmit:K}),d&&_1(V1,{deviceId:C,onFilter:O,onSelect:l,onClose:V})]}),!1]})}var st="./assets/icon-blocks-d7e4a3a3eb74d0fb.svg";var Rt={"blocks.menu.file":"File","blocks.menu.file.newProject":"New","blocks.menu.file.openProject":"Open","blocks.menu.file.saveProject":"Save","blocks.menu.file.uploadProject":"Load from your computer","blocks.menu.file.downloadProject":"Save to your computer","blocks.menu.edit":"Edit","blocks.menu.edit.undo":"Undo","blocks.menu.edit.redo":"Redo","blocks.menu.device":"Device","blocks.menu.device.name":"device","blocks.menu.device.connect":"Connect to your {name}","blocks.menu.device.disconnect":"Disconnect this {name}","blocks.menu.device.download":"Download program","blocks.menu.device.turnOnAutoDownload":"Turn on Auto Download","blocks.menu.device.turnOffAutoDownload":"Turn off Auto Download","blocks.alert.downloading":"Downloading...{progress}%","blocks.alert.downloadCompleted":"Download completed.","blocks.alert.connectionError":"Connection error.","blocks.alert.flashOutSpace":"The flash is running out of space.","blocks.codeTab":"Code","blocks.monitorPane.title":"Monitor","blocks.downloadToDevice":"Download","blocks.extensions.addExtension":"Add Extension","blocks.extensions.empty":"No extension!","blocks.dataPrompt.forAllTargets":"For all targets","blocks.dataPrompt.forThisTarget":"For this target only","blocks.dataPrompt.availableToAllTargets":"This variable will be available to all targets.","blocks.dataPrompt.listAvailableToAllTargets":"This list will be available to all targets.","blocks.dataPrompt.cancel":"Cancel","blocks.dataPrompt.ok":"OK","blocks.event.programStart":"when program start","blocks.control.stopOther":"other scripts"};var et={"blocks.menu.file":"\u6587\u4EF6","blocks.menu.file.newProject":"\u65B0\u4F5C\u54C1","blocks.menu.file.openProject":"\u6253\u5F00","blocks.menu.file.saveProject":"\u4FDD\u5B58","blocks.menu.file.uploadProject":"\u4ECE\u7535\u8111\u4E2D\u6253\u5F00","blocks.menu.file.downloadProject":"\u4FDD\u5B58\u5230\u7535\u8111","blocks.menu.edit":"\u7F16\u8F91","blocks.menu.edit.undo":"\u64A4\u9500","blocks.menu.edit.redo":"\u6062\u590D","blocks.menu.device":"\u8BBE\u5907","blocks.menu.device.name":"\u8BBE\u5907","blocks.menu.device.connect":"\u8FDE\u63A5{name}","blocks.menu.device.disconnect":"\u65AD\u5F00{name}\u8FDE\u63A5","blocks.menu.device.download":"\u4E0B\u8F7D\u7A0B\u5E8F","blocks.menu.device.turnOnAutoDownload":"\u6253\u5F00\u81EA\u52A8\u4E0B\u8F7D","blocks.menu.device.turnOffAutoDownload":"\u5173\u95ED\u81EA\u52A8\u4E0B\u8F7D","blocks.alert.downloading":"\u6B63\u5728\u4E0B\u8F7D\u2026{progress}%","blocks.alert.downloadCompleted":"\u4E0B\u8F7D\u5B8C\u6210\u3002","blocks.alert.connectionError":"\u8FDE\u63A5\u9519\u8BEF\u3002","blocks.alert.flashOutSpace":"\u8BBE\u5907\u7A7A\u95F4\u4E0D\u8DB3\u3002","blocks.codeTab":"\u4EE3\u7801","blocks.monitorPane.title":"\u76D1\u89C6\u5668","blocks.downloadToDevice":"\u4E0B\u8F7D","blocks.extensions.addExtension":"\u6DFB\u52A0\u6269\u5C55","blocks.extensions.empty":"\u6CA1\u6709\u6269\u5C55\uFF01","blocks.dataPrompt.forAllTargets":"\u9002\u7528\u4E8E\u5168\u5C40","blocks.dataPrompt.forThisTarget":"\u4EC5\u9002\u7528\u4E8E\u5F53\u524D","blocks.dataPrompt.availableToAllTargets":"\u5168\u5C40\u90FD\u53EF\u4F7F\u7528\u8BE5\u53D8\u91CF\u3002","blocks.dataPrompt.listAvailableToAllTargets":"\u5168\u5C40\u90FD\u53EF\u4F7F\u7528\u8BE5\u5217\u8868\u3002","blocks.dataPrompt.cancel":"\u53D6\u6D88","blocks.dataPrompt.ok":"\u786E\u5B9A","blocks.event.programStart":"\u5F53\u7A0B\u5E8F\u5F00\u59CB\u8FD0\u884C","blocks.control.stopOther":"\u5176\u4ED6\u811A\u672C"};import{jsx as nt} from"preact/jsx-runtime";var g0={en:Rt,"zh-Hans":et},f0={icon:st,label:nt(rt,{id:"blocks.codeTab",defaultMessage:"Code"}),Content:A1},M2={label:nt(rt,{id:"blocks.monitorPane.title",defaultMessage:"Monitor"}),Content:null};function D0({addLocaleData:a,createLayout:u,openProject:E,project:i}){a(g0);const o=(s)=>{s=s??x1,E(Object.assign({selectedFileId:s.fileList[0].id},s))};o(i),u({mainMenu:v1({createProject:o,openProject:E}),tabs:[{...f0,Content:A1}],sidebars:[],pane:!1,tutorials:!0,canEditProjectName:!0})}export{t as pythonGenerator,M2 as monitorPane,v1 as makeMainMenu,g0 as locales,D0 as default,f0 as codeTab};
