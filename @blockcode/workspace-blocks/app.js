var st=Object.create;var{defineProperty:b1,getPrototypeOf:nt,getOwnPropertyNames:lt}=Object;var Ot=Object.prototype.hasOwnProperty;var At=(a,u,E)=>{E=a!=null?st(nt(a)):{};const d=u||!a||!a.__esModule?b1(E,"default",{value:a,enumerable:!0}):E;for(let _ of lt(a))if(!Ot.call(d,_))b1(d,_,{get:()=>a[_],enumerable:!0});return d};var Mt=(a,u)=>()=>(u||a((u={exports:{}}).exports,u),u.exports);var W1=Mt((S1)=>{(function(){var a=typeof S1!="undefined"&&S1||typeof define!="undefined"&&{}||this||window;if(typeof define!=="undefined")define("save-svg-as-png",[],function(){return a});a.default=a;var u="http://www.w3.org/2000/xmlns/",E="http://www.w3.org/1999/xhtml",d="http://www.w3.org/2000/svg",_='<?xml version="1.0" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd" [<!ENTITY nbsp "&#160;">]>',R=/url\(["']?(.+?)["']?\)/,o={woff2:"font/woff2",woff:"font/woff",otf:"application/x-font-opentype",ttf:"application/x-font-ttf",eot:"application/vnd.ms-fontobject",sfnt:"application/font-sfnt",svg:"image/svg+xml"},C=function s(T){return T instanceof HTMLElement||T instanceof SVGElement},S=function s(T){if(!C(T))throw new Error("an HTMLElement or SVGElement is required; got "+T)},r=function s(T){return new Promise(function(i,N){if(C(T))i(T);else N(new Error("an HTMLElement or SVGElement is required; got "+T))})},v=function s(T){return T&&T.lastIndexOf("http",0)===0&&T.lastIndexOf(window.location.host)===-1},F=function s(T){var i=Object.keys(o).filter(function(N){return T.indexOf("."+N)>0}).map(function(N){return o[N]});if(i)return i[0];return console.error("Unknown font format for "+T+". Fonts may not be working correctly."),"application/octet-stream"},g=function s(T){var i="",N=new Uint8Array(T);for(var m=0;m<N.byteLength;m++)i+=String.fromCharCode(N[m]);return window.btoa(i)},I=function s(T,i,N){var m=T.viewBox&&T.viewBox.baseVal&&T.viewBox.baseVal[N]||i.getAttribute(N)!==null&&!i.getAttribute(N).match(/%$/)&&parseInt(i.getAttribute(N))||T.getBoundingClientRect()[N]||parseInt(i.style[N])||parseInt(window.getComputedStyle(T).getPropertyValue(N));return typeof m==="undefined"||m===null||isNaN(parseFloat(m))?0:m},c=function s(T,i,N,m){if(T.tagName==="svg")return{width:N||I(T,i,"width"),height:m||I(T,i,"height")};else if(T.getBBox){var l=T.getBBox(),O=l.x,D=l.y,Z=l.width,j=l.height;return{width:O+Z,height:D+j}}},M=function s(T){return decodeURIComponent(encodeURIComponent(T).replace(/%([0-9A-F]{2})/g,function(i,N){var m=String.fromCharCode("0x"+N);return m==="%"?"%25":m}))},p=function s(T){var i=window.atob(T.split(",")[1]),N=T.split(",")[0].split(":")[1].split(";")[0],m=new ArrayBuffer(i.length),l=new Uint8Array(m);for(var O=0;O<i.length;O++)l[O]=i.charCodeAt(O);return new Blob([m],{type:N})},W=function s(T,i){if(!i)return;try{return T.querySelector(i)||T.parentNode&&T.parentNode.querySelector(i)}catch(N){console.warn('Invalid CSS selector "'+i+'"',N)}},x=function s(T,i){var N=T.cssText.match(R),m=N&&N[1]||"";if(!m||m.match(/^data:/)||m==="about:blank")return;var l=m.startsWith("../")?i+"/../"+m:m.startsWith("./")?i+"/."+m:m;return{text:T.cssText,format:F(l),url:l}},P=function s(T){return Promise.all(Array.from(T.querySelectorAll("image")).map(function(i){var N=i.getAttributeNS("http://www.w3.org/1999/xlink","href")||i.getAttribute("href");if(!N)return Promise.resolve(null);if(v(N))N+=(N.indexOf("?")===-1?"?":"&")+"t="+(new Date()).valueOf();return new Promise(function(m,l){var O=document.createElement("canvas"),D=new Image;D.crossOrigin="anonymous",D.src=N,D.onerror=function(){return l(new Error("Could not load "+N))},D.onload=function(){O.width=D.width,O.height=D.height,O.getContext("2d").drawImage(D,0,0),i.setAttributeNS("http://www.w3.org/1999/xlink","href",O.toDataURL("image/png")),m(!0)}})}))},V={},E1=function s(T){return Promise.all(T.map(function(i){return new Promise(function(N,m){if(V[i.url])return N(V[i.url]);var l=new XMLHttpRequest;l.addEventListener("load",function(){var O=g(l.response),D=i.text.replace(R,'url("data:'+i.format+";base64,"+O+'")')+"\n";V[i.url]=D,N(D)}),l.addEventListener("error",function(O){console.warn("Failed to load font from: "+i.url,O),V[i.url]=null,N(null)}),l.addEventListener("abort",function(O){console.warn("Aborted loading font from: "+i.url,O),N(null)}),l.open("GET",i.url),l.responseType="arraybuffer",l.send()})})).then(function(i){return i.filter(function(N){return N}).join("")})},q=null,O1=function s(){if(q)return q;return q=Array.from(document.styleSheets).map(function(T){try{return{rules:T.cssRules,href:T.href}}catch(i){return console.warn("Stylesheet could not be loaded: "+T.href,i),{}}})},A1=function s(T,i){var N=i||{},m=N.selectorRemap,l=N.modifyStyle,O=N.modifyCss,D=N.fonts,Z=N.excludeUnusedCss,j=O||function($,z){var w=m?m($):$,n=l?l(z):z;return w+"{"+n+"}\n"},Y=[],B=typeof D==="undefined",K=D||[];return O1().forEach(function($){var{rules:z,href:w}=$;if(!z)return;Array.from(z).forEach(function(n){if(typeof n.style!="undefined"){if(W(T,n.selectorText))Y.push(j(n.selectorText,n.style.cssText));else if(B&&n.cssText.match(/^@font-face/)){var e=x(n,w);if(e)K.push(e)}else if(!Z)Y.push(n.cssText)}})}),E1(K).then(function($){return Y.join("\n")+$})},y=function s(){if(!navigator.msSaveOrOpenBlob&&!("download"in document.createElement("a")))return{popup:window.open()}};a.prepareSvg=function(s,T,i){S(s);var N=T||{},m=N.left,l=m===void 0?0:m,O=N.top,D=O===void 0?0:O,Z=N.width,j=N.height,Y=N.scale,B=Y===void 0?1:Y,K=N.responsive,$=K===void 0?!1:K,z=N.excludeCss,w=z===void 0?!1:z;return P(s).then(function(){var n=s.cloneNode(!0);n.style.backgroundColor=(T||{}).backgroundColor||s.style.backgroundColor;var e=c(s,n,Z,j),A=e.width,L=e.height;if(s.tagName!=="svg")if(s.getBBox){if(n.getAttribute("transform")!=null)n.setAttribute("transform",n.getAttribute("transform").replace(/translate\(.*?\)/,""));var U=document.createElementNS("http://www.w3.org/2000/svg","svg");U.appendChild(n),n=U}else{console.error("Attempted to render non-SVG element",s);return}if(n.setAttribute("version","1.1"),n.setAttribute("viewBox",[l,D,A,L].join(" ")),!n.getAttribute("xmlns"))n.setAttributeNS(u,"xmlns",d);if(!n.getAttribute("xmlns:xlink"))n.setAttributeNS(u,"xmlns:xlink","http://www.w3.org/1999/xlink");if($)n.removeAttribute("width"),n.removeAttribute("height"),n.setAttribute("preserveAspectRatio","xMinYMin meet");else n.setAttribute("width",A*B),n.setAttribute("height",L*B);if(Array.from(n.querySelectorAll("foreignObject > *")).forEach(function(r1){r1.setAttributeNS(u,"xmlns",r1.tagName==="svg"?d:E)}),w){var G=document.createElement("div");G.appendChild(n);var h=G.innerHTML;if(typeof i==="function")i(h,A,L);else return{src:h,width:A,height:L}}else return A1(s,T).then(function(r1){var M1=document.createElement("style");M1.setAttribute("type","text/css"),M1.innerHTML="<![CDATA[\n"+r1+"\n]]>";var V1=document.createElement("defs");V1.appendChild(M1),n.insertBefore(V1,n.firstChild);var U1=document.createElement("div");U1.appendChild(n);var X1=U1.innerHTML.replace(/NS\d+:href/gi,'xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href');if(typeof i==="function")i(X1,A,L);else return{src:X1,width:A,height:L}})})},a.svgAsDataUri=function(s,T,i){return S(s),a.prepareSvg(s,T).then(function(N){var{src:m,width:l,height:O}=N,D="data:image/svg+xml;base64,"+window.btoa(M(_+m));if(typeof i==="function")i(D,l,O);return D})},a.svgAsPngUri=function(s,T,i){S(s);var N=T||{},m=N.encoderType,l=m===void 0?"image/png":m,O=N.encoderOptions,D=O===void 0?0.8:O,Z=N.canvg,j=function Y(B){var{src:K,width:$,height:z}=B,w=document.createElement("canvas"),n=w.getContext("2d"),e=window.devicePixelRatio||1;if(w.width=$*e,w.height=z*e,w.style.width=w.width+"px",w.style.height=w.height+"px",n.setTransform(e,0,0,e,0,0),Z)Z(w,K);else n.drawImage(K,0,0);var A=void 0;try{A=w.toDataURL(l,D)}catch(L){if(typeof SecurityError!=="undefined"&&L instanceof SecurityError||L.name==="SecurityError"){console.error("Rendered SVG images cannot be downloaded in this browser.");return}else throw L}if(typeof i==="function")i(A,w.width,w.height);return Promise.resolve(A)};if(Z)return a.prepareSvg(s,T).then(j);else return a.svgAsDataUri(s,T).then(function(Y){return new Promise(function(B,K){var $=new Image;$.onload=function(){return B(j({src:$,width:$.width,height:$.height}))},$.onerror=function(){K("There was an error loading the data URI as an image on the following SVG\n"+window.atob(Y.slice(26))+"Open the following link to see browser\'s diagnosis\n"+Y)},$.src=Y})})},a.download=function(s,T,i){if(navigator.msSaveOrOpenBlob)navigator.msSaveOrOpenBlob(p(T),s);else{var N=document.createElement("a");if("download"in N){N.download=s,N.style.display="none",document.body.appendChild(N);try{var m=p(T),l=URL.createObjectURL(m);N.href=l,N.onclick=function(){return requestAnimationFrame(function(){return URL.revokeObjectURL(l)})}}catch(O){console.error(O),console.warn("Error while getting object URL. Falling back to string URL."),N.href=T}N.click(),document.body.removeChild(N)}else if(i&&i.popup)i.popup.document.title=s,i.popup.location.replace(T)}},a.saveSvg=function(s,T,i){var N=y();return r(s).then(function(m){return a.svgAsDataUri(m,i||{})}).then(function(m){return a.download(T,m,N)})},a.saveSvgAsPng=function(s,T,i){var N=y();return r(s).then(function(m){return a.svgAsPngUri(m,i||{})}).then(function(m){return a.download(T,m,N)})}})()});import{Text as rt} from"@blockcode/ui";import{Text as c1} from"@blockcode/ui";var H1=At(W1(),1);import{Keys as t1,useLayout as St,useEditor as It} from"@blockcode/core";import{Text as d1,MenuSection as Y1,MenuItem as o1} from"@blockcode/ui";import{ScratchBlocks as gt} from"@blockcode/blocks-editor";import{jsx as J,jsxs as g1,Fragment as Ft} from"preact/jsx-runtime";var I1=/Mac/i.test(navigator.platform||navigator.userAgent);function F1({itemClassName:a,onNew:u,onSave:E,children:d}){const{createPrompt:_,setStoreLibrary:R}=St(),{modified:o,saveNow:C}=It();return g1(Ft,{children:[g1(Y1,{children:[J(o1,{className:a,label:J(d1,{id:"blocks.menu.file.newProject",defaultMessage:"New"}),hotkey:[I1?t1.COMMAND:t1.CONTROL,t1.N],onClick:()=>{if(o)_({title:J(d1,{id:"gui.projects.notSaved",defaultMessage:"Not saved"}),label:J(d1,{id:"gui.projects.replaceProject",defaultMessage:"Replace contents of the current project?"}),onSubmit:u});else u()}}),J(o1,{className:a,label:J(d1,{id:"blocks.menu.file.openProject",defaultMessage:"Open"}),hotkey:[I1?t1.COMMAND:t1.CONTROL,t1.O],onClick:()=>R(!0)}),J(o1,{className:a,label:J(d1,{id:"blocks.menu.file.saveProject",defaultMessage:"Save"}),hotkey:[I1?t1.COMMAND:t1.CONTROL,t1.S],onClick:async()=>{let S,r;const v=gt.getMainWorkspace();if(v)S=await H1.svgAsDataUri(v.getCanvas(),{}),r=Array.from(new Set(Object.values(v.blockDB_).filter((F)=>["nes","translate","color-sensor","servo","time","pen","brain","request","text","broadcast"].find((g)=>g===F.category_)).map((F)=>F.category_)));C((F)=>{const g={thumb:S,...F,...E?E():{},editor:{...F.editor,extensions:r}};return g.fileList=g.fileList.map((I)=>({...I,script:void 0,content:void 0})),g})}})]}),g1(Y1,{children:[J(o1,{disabled:!0,className:a,label:J(d1,{id:"blocks.menu.file.uploadProject",defaultMessage:"Load from your computer"})}),J(o1,{disabled:!0,className:a,label:J(d1,{id:"blocks.menu.file.downloadProject",defaultMessage:"save to your computer"})})]}),d]})}import{useEffect as Dt,useState as D1} from"preact/hooks";import{Keys as a1} from"@blockcode/core";import{Text as Z1,MenuSection as Lt,MenuItem as B1} from"@blockcode/ui";import{ScratchBlocks as pt} from"@blockcode/blocks-editor";import{jsx as e1,jsxs as z1,Fragment as ft} from"preact/jsx-runtime";var K1=/Mac/i.test(navigator.platform||navigator.userAgent);function L1({itemClassName:a,children:u}){const[E,d]=D1(!0),[_,R]=D1(!0),[o,C]=D1(null),S=pt.getMainWorkspace();if(S){if(o?.id!==S.id)C(S)}return Dt(()=>{if(o)o.addChangeListener(()=>{d(o.undoStack_.length===0),R(o.redoStack_.length===0)}),d(o.undoStack_.length===0),R(o.redoStack_.length===0)},[o]),z1(ft,{children:[z1(Lt,{children:[e1(B1,{disabled:E,className:a,label:e1(Z1,{id:"blocks.menu.edit.undo",defaultMessage:"Undo"}),hotkey:[K1?a1.COMMAND:a1.CONTROL,a1.Z],onClick:async(r)=>{if(r instanceof MouseEvent&&o)o.undo(!1)}}),e1(B1,{disabled:_,className:a,label:e1(Z1,{id:"blocks.menu.edit.redo",defaultMessage:"Redo"}),hotkey:K1?[a1.SHIFT,a1.COMMAND,a1.Z]:[a1.CONTROL,a1.Y],onClick:async(r)=>{if(r instanceof MouseEvent&&o)o.undo(!0)}})]}),u]})}import{useState as ct} from"preact/hooks";import{useLocale as Pt,useLayout as vt,useEditor as $t} from"@blockcode/core";import{Text as p1,Spinner as wt,MenuSection as Vt,MenuItem as Ut} from"@blockcode/ui";import{connectDevice as Xt,disconnectDevice as Y0,downloadDevice as bt,showDownloadScreen as Wt} from"@blockcode/device-pyboard";var h1=[{usbVendorId:12346},{usbVendorId:11914}];import{jsx as T1,jsxs as Ht,Fragment as Yt} from"preact/jsx-runtime";function f1({itemClassName:a,deviceName:u,deviceFilters:E,downloadScreen:d,onDownload:_,children:R}){const[o,C]=ct(!1),{maybeLocaleText:S}=Pt(),{createAlert:r,removeAlert:v}=vt(),{key:F,name:g,fileList:I,assetList:c,device:M,setDevice:p}=$t(),W=()=>C(!1),x=()=>C(!0),P=(V)=>{if(!P.id)P.id=`download.${Date.now()}`,x();if(V<100)r({id:P.id,icon:T1(wt,{level:"success"}),message:T1(p1,{id:"blocks.alert.downloading",defaultMessage:"Downloading...{progress}%",progress:V})});else r({id:P.id,icon:null,message:T1(p1,{id:"blocks.alert.downloadCompleted",defaultMessage:"Download completed."})}),setTimeout(()=>{v(P.id),W(),delete P.id},1000)};return Ht(Yt,{children:[T1(Vt,{children:T1(Ut,{disabled:o,className:a,label:T1(p1,{id:"blocks.menu.device.download",defaultMessage:"Download program"}),onClick:async()=>{if(P.id)return;try{const V=M||await Xt(E||h1,p);if(d)await Wt(V,d);let E1=_?_(g,I,c):[].concat(c);E1=E1.map((q)=>({...q,id:q.id[0]!=="_"?`proj${F}/${q.id}`:q.id})),bt(V,E1,P)}catch(V){}}})}),R]})}var J1="./assets/icon-file-1def53419f4ad0ae.svg";var Q1="./assets/icon-edit-2b1e47b495524ed2.svg";var q1="./assets/icon-device-c2fafab2eaccf043.svg";import{jsx as N1} from"preact/jsx-runtime";function P1({deviceName:a,deviceFilters:u,createDefaultProject:E,saveCurrentProject:d,downloadProjectToDevice:_,showDownloadScreen:R}){return[{icon:J1,label:N1(c1,{id:"blocks.menu.file",defaultMessage:"File"}),Menu:({itemClassName:o,children:C})=>N1(F1,{itemClassName:o,onNew:E,onSave:d,children:C})},{icon:Q1,label:N1(c1,{id:"blocks.menu.edit",defaultMessage:"Edit"}),Menu:({itemClassName:o,children:C})=>N1(L1,{itemClassName:o,children:C})},{icon:q1,label:N1(c1,{id:"blocks.menu.device",defaultMessage:"Device"}),Menu:({itemClassName:o,children:C})=>N1(f1,{deviceName:a,itemClassName:o,deviceFilters:u,downloadScreen:R,onDownload:_,children:C})}]}var j1={assetList:[{id:"main",type:"text/x-python",content:`
from popsicle.blocks import *
import code1
run()
`}],fileList:[{id:"code1",type:"text/x-python"}]};import{ScratchBlocks as H} from"@blockcode/blocks-editor";var t=new H.Generator("Python");t.addReservedWords("False,None,True,and,as,assert,break,class,continue,def,del,elif,else,except,exec,finally,for,from,global,if,import,in,is,lambda,nonlocal,not,or,pass,print,raise,return,try,while,with,yield,NotImplemented,Ellipsis,__debug__,quit,exit,copyright,license,credits,ArithmeticError,AssertionError,AttributeError,BaseException,BlockingIOError,BrokenPipeError,BufferError,BytesWarning,ChildProcessError,ConnectionAbortedError,ConnectionError,ConnectionRefusedError,ConnectionResetError,DeprecationWarning,EOFError,Ellipsis,EnvironmentError,Exception,FileExistsError,FileNotFoundError,FloatingPointError,FutureWarning,GeneratorExit,IOError,ImportError,ImportWarning,IndentationError,IndexError,InterruptedError,IsADirectoryError,KeyError,KeyboardInterrupt,LookupError,MemoryError,ModuleNotFoundError,NameError,NotADirectoryError,NotImplemented,NotImplementedError,OSError,OverflowError,PendingDeprecationWarning,PermissionError,ProcessLookupError,RecursionError,ReferenceError,ResourceWarning,RuntimeError,RuntimeWarning,StandardError,StopAsyncIteration,StopIteration,SyntaxError,SyntaxWarning,SystemError,SystemExit,TabError,TimeoutError,TypeError,UnboundLocalError,UnicodeDecodeError,UnicodeEncodeError,UnicodeError,UnicodeTranslateError,UnicodeWarning,UserWarning,ValueError,Warning,ZeroDivisionError,_,__build_class__,__debug__,__doc__,__import__,__loader__,__name__,__package__,__spec__,abs,all,any,apply,ascii,basestring,bin,bool,buffer,bytearray,bytes,callable,chr,classmethod,cmp,coerce,compile,complex,copyright,credits,delattr,dict,dir,divmod,enumerate,eval,exec,execfile,exit,file,filter,float,format,frozenset,getattr,globals,hasattr,hash,help,hex,id,input,int,intern,isinstance,issubclass,iter,len,license,list,locals,long,map,max,memoryview,min,next,object,oct,open,ord,pow,print,property,quit,range,raw_input,reduce,reload,repr,reversed,round,set,setattr,slice,sorted,staticmethod,str,sum,super,tuple,type,unichr,unicode,vars,xrange,zip");t.ORDER_ATOMIC=0;t.ORDER_COLLECTION=1;t.ORDER_STRING_CONVERSION=1;t.ORDER_MEMBER=2.1;t.ORDER_FUNCTION_CALL=2.2;t.ORDER_EXPONENTIATION=3;t.ORDER_UNARY_SIGN=4;t.ORDER_BITWISE_NOT=4;t.ORDER_MULTIPLICATIVE=5;t.ORDER_ADDITIVE=6;t.ORDER_BITWISE_SHIFT=7;t.ORDER_BITWISE_AND=8;t.ORDER_BITWISE_XOR=9;t.ORDER_BITWISE_OR=10;t.ORDER_RELATIONAL=11;t.ORDER_LOGICAL_NOT=12;t.ORDER_LOGICAL_AND=13;t.ORDER_LOGICAL_OR=14;t.ORDER_CONDITIONAL=15;t.ORDER_LAMBDA=16;t.ORDER_NONE=99;t.ORDER_OVERRIDES=[[t.ORDER_FUNCTION_CALL,t.ORDER_MEMBER],[t.ORDER_FUNCTION_CALL,t.ORDER_FUNCTION_CALL],[t.ORDER_MEMBER,t.ORDER_MEMBER],[t.ORDER_MEMBER,t.ORDER_FUNCTION_CALL],[t.ORDER_LOGICAL_NOT,t.ORDER_LOGICAL_NOT],[t.ORDER_LOGICAL_AND,t.ORDER_LOGICAL_AND],[t.ORDER_LOGICAL_OR,t.ORDER_LOGICAL_OR]];t.init=(a)=>{if(t.PASS=t.INDENT+"pass\n",t.definitions_=Object.create(null),t.functionNames_=Object.create(null),!t.variableDB_)t.variableDB_=new H.Names(t.RESERVED_WORDS_);else t.variableDB_.reset();t.variableDB_.setVariableMap(a.getVariableMap());const u=[],E=a.getAllVariables();for(let _=0;_<E.length;_++){if(E[_].type===H.BROADCAST_MESSAGE_VARIABLE_TYPE)continue;let R=t.variableDB_.getName(E[_].getId(),H.Variables.NAME_TYPE),o="";if(E[_].type===H.LIST_VARIABLE_TYPE)R=`${R}_${H.LIST_VARIABLE_TYPE}`,o="[]";u.push(`${R} = ${o}`)}const d=H.Variables.allDeveloperVariables(a);for(let _=0;_<d.length;_++){let R=t.variableDB_.getName(d[_],H.Names.DEVELOPER_VARIABLE_TYPE),o="";if(E[_].type===H.LIST_VARIABLE_TYPE)R=`${R}_${H.LIST_VARIABLE_TYPE}`,o="[]";u.push(`${R} = ${o}`)}if(u.length)t.definitions_.variables=u.join("\n");t.definitions_.import_blocks="from blocks import *"};t.finish=(a)=>{const u=[],E=[];for(let _ in t.definitions_){const R=t.definitions_[_];if(R.match(/^(from\s+\S+\s+)?import\s+\S+/))u.push(R);else E.push(R)}return delete t.definitions_,delete t.functionNames_,t.variableDB_.reset(),(u.join("\n")+"\n\n"+E.join("\n\n")).replace(/\n\n+/g,"\n\n").replace(/\n*$/,"\n\n\n")+a};t.scrubNakedValue=(a)=>{return a+"\n"};t.quote_=(a)=>{a=a.replace(/\\/g,"\\\\").replace(/\n/g,"\\\n").replace(/\%/g,"\\%");let u='"';if(a.indexOf('"')!==-1)if(a.indexOf("'")===-1)u="'";else a=a.replace(/"/g,'\\"');return u+a+u};t.scrub_=(a,u)=>{let E="";if(!a.outputConnection?.targetConnection){let d=a.getCommentText();if(d=H.utils.wrap(d,t.COMMENT_WRAP-3),d)if(a.getProcedureDef)E+='"""'+d+'\n"""\n';else E+=t.prefixLines(d+"\n","# ");for(let _=0;_<a.inputList.length;_++)if(a.inputList[_].type==H.INPUT_VALUE){const R=a.inputList[_].connection.targetBlock();if(R){const o=t.allNestedComments(R);if(o)E+=t.prefixLines(o,"# ")}}}if(a.startHat_){const d=a.nextConnection&&a.nextConnection.targetBlock();let _=t.blockToCode(d);if(_)_=t.prefixLines(_,t.INDENT),u=u.replace(`\n${t.PASS}`,`\n${_}`);return E+u}if(a.parentBlock_){const d=a.nextConnection&&a.nextConnection.targetBlock(),_=t.blockToCode(d);return E+u+_}};t.getAdjustedInt=(a,u,E,d)=>{let _=E||0;if(a.workspace.options.oneBasedIndex)_--;const R=a.workspace.options.oneBasedIndex?"1":"0",o=_?t.ORDER_ADDITIVE:t.ORDER_NONE;let C=t.valueToCode(a,u,o)||R;if(H.isNumber(C)){if(C=parseInt(C,10)+_,d)C=-C}else{if(_>0)C="int("+C+" + "+_+")";else if(_<0)C="int("+C+" - "+-_+")";else C="int("+C+")";if(d)C="-"+C}return C};t.hatToCode=(a="",...u)=>{if(!t.functionNames_[a])t.functionNames_[a]=0;t.functionNames_[a]+=1;const E=`${a}_${t.functionNames_[a]}`;return t.HAT_FUNCTION_PLACEHOLDER=E,`async def ${E}(${u.join(", ")}):\n  this_func = ${E}\n${t.PASS}\n`};var zt=(a)=>{const u=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;a=a.replace(u,(d,_,R,o)=>_+_+R+R+o+o);const E=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(a);return E?{r:parseInt(E[1],16),g:parseInt(E[2],16),b:parseInt(E[3],16)}:null};t.colour_picker=(a)=>{const{r:u,g:E,b:d}=zt(a.getFieldValue("COLOUR"));return[`(${u}, ${E}, ${d})`,t.ORDER_ATOMIC]};var C1="  await runtime.next_frame()\n";t.control_wait=(a)=>{let u="";if(t.STATEMENT_PREFIX)u+=t.injectId(t.STATEMENT_PREFIX,a);const E=t.valueToCode(a,"DURATION",t.ORDER_NONE)||0;return u+=`await runtime.wait_for(num(${E}))\n`,u};t.control_repeat=(a)=>{let u="";if(t.STATEMENT_PREFIX)u+=t.injectId(t.STATEMENT_PREFIX,a);let E=t.statementToCode(a,"SUBSTACK")||t.PASS;if(t.STATEMENT_SUFFIX)E=t.prefixLines(t.injectId(t.STATEMENT_SUFFIX,a),t.INDENT)+E;const d=t.valueToCode(a,"TIMES",t.ORDER_NONE)||10;return u+=`for _ in range(num(${d})):\n${E}${C1}`,u};t.control_forever=(a)=>{let u="";if(t.STATEMENT_PREFIX)u+=t.injectId(t.STATEMENT_PREFIX,a);let E=t.statementToCode(a,"SUBSTACK")||t.PASS;if(t.STATEMENT_SUFFIX)E=t.prefixLines(t.injectId(t.STATEMENT_SUFFIX,a),t.INDENT)+E;return u+=`while True:\n${E}${C1}`,u};t.control_if=(a)=>{let u="";if(t.STATEMENT_PREFIX)u+=t.injectId(t.STATEMENT_PREFIX,a);let E=t.statementToCode(a,"SUBSTACK")||t.PASS;if(t.STATEMENT_SUFFIX)E=t.prefixLines(t.injectId(t.STATEMENT_SUFFIX,a),t.INDENT)+E;const d=t.valueToCode(a,"CONDITION",t.ORDER_NONE)||"False";if(u+=`if ${d}:\n${E}`,a.getInput("SUBSTACK2")){if(E=t.statementToCode(a,"SUBSTACK2")||t.PASS,t.STATEMENT_SUFFIX)E=t.prefixLines(t.injectId(t.STATEMENT_SUFFIX,a),t.INDENT)+E;u+=`else:\n${E}`}return u};t.control_if_else=t.control_if;t.control_wait_until=(a)=>{let u="";if(t.STATEMENT_PREFIX)u+=t.injectId(t.STATEMENT_PREFIX,a);const E=t.valueToCode(a,"CONDITION",t.ORDER_NONE)||"False";return u+=`while not ${E}:\n${C1}`,u};t.control_repeat_until=(a)=>{let u="";if(t.STATEMENT_PREFIX)u+=t.injectId(t.STATEMENT_PREFIX,a);let E=t.statementToCode(a,"SUBSTACK")||t.PASS;if(t.STATEMENT_SUFFIX)E=t.prefixLines(t.injectId(t.STATEMENT_SUFFIX,a),t.INDENT)+E;const d=t.valueToCode(a,"CONDITION",t.ORDER_NONE)||"False";return u+=`while not ${d}:\n${E}${C1}`,u};t.control_while=(a)=>{let u="";if(t.STATEMENT_PREFIX)u+=t.injectId(t.STATEMENT_PREFIX,a);let E=t.statementToCode(a,"SUBSTACK")||t.PASS;if(t.STATEMENT_SUFFIX)E=t.prefixLines(t.injectId(t.STATEMENT_SUFFIX,a),t.INDENT)+E;const d=t.valueToCode(a,"CONDITION",t.ORDER_NONE)||"False";return u+=`while ${d}:\n${E}${C1}`,u};t.control_stop=(a)=>{let u="";if(t.STATEMENT_PREFIX)u+=t.injectId(t.STATEMENT_PREFIX,a);switch(a.getFieldValue("STOP_OPTION")){case"all":u+="runtime.stop()\n";break;case"this script":u+="return\n";break;case"other scripts in sprite":u+="runtime.stop_tasks(this_func)\n";break}return u};import{ScratchBlocks as f} from"@blockcode/blocks-editor";t.data_variable=(a)=>{return[t.variableDB_.getName(a.getFieldValue("VARIABLE"),f.Variables.NAME_TYPE),t.ORDER_ATOMIC]};t.data_setvariableto=(a)=>{let u="";if(javascriptGenerator.STATEMENT_PREFIX)u+=javascriptGenerator.injectId(javascriptGenerator.STATEMENT_PREFIX,a);const E=t.variableDB_.getName(a.getFieldValue("VARIABLE"),f.Variables.NAME_TYPE),d=t.valueToCode(a,"VALUE",t.ORDER_NONE)||'""';return u+=`${E} = ${d}\n`,u};t.data_changevariableby=(a)=>{let u="";if(javascriptGenerator.STATEMENT_PREFIX)u+=javascriptGenerator.injectId(javascriptGenerator.STATEMENT_PREFIX,a);const E=t.variableDB_.getName(a.getFieldValue("VARIABLE"),f.Variables.NAME_TYPE),d=t.valueToCode(a,"VALUE",t.ORDER_NONE)||0;return u+=`${E} = num(${E}) + num(${d})\n`,u};t.data_listcontents=(a)=>{return[t.variableDB_.getName(a.getFieldValue("LIST"),f.Variables.NAME_TYPE)+"_"+f.LIST_VARIABLE_TYPE,t.ORDER_ATOMIC]};t.data_addtolist=(a)=>{let u="";if(t.STATEMENT_PREFIX)u+=t.injectId(t.STATEMENT_PREFIX,a);const E=t.variableDB_.getName(a.getFieldValue("LIST"),f.Variables.NAME_TYPE)+"_"+f.LIST_VARIABLE_TYPE,d=t.valueToCode(a,"ITEM",t.ORDER_NONE)||'""';return u+=`${E}.append(${d})\n`,u};t.data_deleteoflist=(a)=>{let u="";if(t.STATEMENT_PREFIX)u+=t.injectId(t.STATEMENT_PREFIX,a);const E=t.variableDB_.getName(a.getFieldValue("LIST"),f.Variables.NAME_TYPE)+"_"+f.LIST_VARIABLE_TYPE,d=t.valueToCode(a,"INDEX",t.ORDER_NONE)||1;return u+=`${E}.remove(runtime.index(${d}, len(${E})))\n`,u};t.data_deletealloflist=(a)=>{let u="";if(t.STATEMENT_PREFIX)u+=t.injectId(t.STATEMENT_PREFIX,a);const E=t.variableDB_.getName(a.getFieldValue("LIST"),f.Variables.NAME_TYPE)+"_"+f.LIST_VARIABLE_TYPE;return u+=`${E} = []\n`,u};t.data_insertatlist=(a)=>{let u="";if(t.STATEMENT_PREFIX)u+=t.injectId(t.STATEMENT_PREFIX,a);const E=t.variableDB_.getName(a.getFieldValue("LIST"),f.Variables.NAME_TYPE)+"_"+f.LIST_VARIABLE_TYPE,d=t.valueToCode(a,"INDEX",t.ORDER_NONE)||1,_=t.valueToCode(a,"ITEM",t.ORDER_NONE)||'""';return u+=`${E}.insert(runtime.index(${d}, len(${E})), ${_})\n`,u};t.data_replaceitemoflist=(a)=>{let u="";if(t.STATEMENT_PREFIX)u+=t.injectId(t.STATEMENT_PREFIX,a);const E=t.variableDB_.getName(a.getFieldValue("LIST"),f.Variables.NAME_TYPE)+"_"+f.LIST_VARIABLE_TYPE,d=t.valueToCode(a,"INDEX",t.ORDER_NONE)||1,_=t.valueToCode(a,"ITEM",t.ORDER_NONE)||'""';return u+=`${E}[runtime.index(${d}, len(${E}))] = ${_}\n`,u};t.data_itemoflist=(a)=>{const u=t.variableDB_.getName(a.getFieldValue("LIST"),f.Variables.NAME_TYPE)+"_"+f.LIST_VARIABLE_TYPE,E=t.valueToCode(a,"INDEX",t.ORDER_NONE)||1;return[`${u}[runtime.index(${E}, len(${u}))]`,t.ORDER_CONDITIONAL]};t.data_itemnumoflist=(a)=>{const u=t.variableDB_.getName(a.getFieldValue("LIST"),f.Variables.NAME_TYPE)+"_"+f.LIST_VARIABLE_TYPE,E=t.valueToCode(a,"ITEM",t.ORDER_NONE)||0;return[`(${u}.index(${E}) + 1)`,t.ORDER_NONE]};t.data_lengthoflist=(a)=>{return[`len(${t.variableDB_.getName(a.getFieldValue("LIST"),f.Variables.NAME_TYPE)+"_"+f.LIST_VARIABLE_TYPE})`,t.ORDER_FUNCTION_CALL]};t.data_listcontainsitem=(a)=>{const u=t.variableDB_.getName(a.getFieldValue("LIST"),f.Variables.NAME_TYPE)+"_"+f.LIST_VARIABLE_TYPE,E=t.valueToCode(a,"ITEM",t.ORDER_NONE)||0;return[`bool(${u}.count(${E}))`,t.ORDER_FUNCTION_CALL]};import{ScratchBlocks as k1} from"@blockcode/blocks-editor";t.event_whenflagclicked=()=>{return`${t.hatToCode("start")}runtime.when_start(${t.HAT_FUNCTION_PLACEHOLDER})\n`};t.event_whengreaterthan=(a)=>{const u=a.getFieldValue("WHENGREATERTHANMENU"),E=t.valueToCode(a,"VALUE",t.ORDER_NONE)||0;return`${t.hatToCode("greaterthen")}runtime.when_greaterthen("${u}", num(${E}), ${t.HAT_FUNCTION_PLACEHOLDER})\n`};t.event_whenbroadcastreceived=(a)=>{const u=t.variableDB_.getName(a.getFieldValue("BROADCAST_OPTION"),k1.Variables.NAME_TYPE);return`${t.hatToCode("broadcastreceived")}runtime.when_broadcastreceived("${u}", ${t.HAT_FUNCTION_PLACEHOLDER})\n`};t.event_broadcast_menu=(a)=>{return[t.variableDB_.getName(a.getFieldValue("BROADCAST_OPTION"),k1.Variables.NAME_TYPE),t.ORDER_ATOMIC]};t.event_broadcast=(a)=>{return`runtime.broadcast("${t.valueToCode(a,"BROADCAST_INPUT",t.ORDER_NONE)||'"message1"'}")\n`};t.event_broadcastandwait=(a)=>{return`await runtime.broadcast("${t.valueToCode(a,"BROADCAST_INPUT",t.ORDER_NONE)||'"message1"'}", waiting=True)\n`};t.addReservedWords("math,random,Number");t.math_number=(a)=>{let u=parseFloat(a.getFieldValue("NUM")),E;if(u===1/0)u='float("inf")',E=t.ORDER_FUNCTION_CALL;else if(u===-1/0)u='-float("inf")',E=t.ORDER_UNARY_SIGN;else if(Number.isNaN(u))u='float("nan")',E=t.ORDER_UNARY_SIGN;else E=u<0?t.ORDER_UNARY_SIGN:t.ORDER_ATOMIC;return[u,E]};t.math_integer=(a)=>{const u=parseInt(a.getFieldValue("NUM")),E=u<0?t.ORDER_UNARY_SIGN:t.ORDER_ATOMIC;return[u,E]};t.math_whole_number=(a)=>{return[Math.abs(parseInt(a.getFieldValue("NUM"))),t.ORDER_ATOMIC]};t.math_positive_number=(a)=>{let u=parseFloat(a.getFieldValue("NUM")),E;if(u===1/0)u='float("inf")',E=t.ORDER_FUNCTION_CALL;else if(u===-1/0)u='-float("inf")',E=t.ORDER_FUNCTION_CALL;else if(Number.isNaN(u))u='float("nan")',E=t.ORDER_FUNCTION_CALL;else u=u<0?0:u,E=t.ORDER_ATOMIC;return[u,E]};t.math_angle=(a)=>{let u=parseFloat(a.getFieldValue("NUM")),E;if(u==1/0)u='float("inf")',E=t.ORDER_FUNCTION_CALL;else if(u==-1/0)u='-float("inf")',E=t.ORDER_UNARY_SIGN;else u=u%360,u=u<0?u+360:u,E=t.ORDER_ATOMIC;return[u,E]};t.operator_add=(a)=>{const u=t.valueToCode(a,"NUM1",t.ORDER_NONE)||0,E=t.valueToCode(a,"NUM2",t.ORDER_NONE)||0;return[`(num(${u}) + num(${E}))`,t.ORDER_SUBTRACTION]};t.operator_subtract=(a)=>{const u=t.valueToCode(a,"NUM1",t.ORDER_NONE)||0,E=t.valueToCode(a,"NUM2",t.ORDER_NONE)||0;return[`(num(${u}) - num(${E}))`,t.ORDER_SUBTRACTION]};t.operator_multiply=(a)=>{const u=t.valueToCode(a,"NUM1",t.ORDER_NONE)||0,E=t.valueToCode(a,"NUM2",t.ORDER_NONE)||0;return[`(num(${u}) * num(${E}))`,t.ORDER_SUBTRACTION]};t.operator_divide=(a)=>{const u=t.valueToCode(a,"NUM1",t.ORDER_NONE)||0,E=t.valueToCode(a,"NUM2",t.ORDER_NONE)||0;return[`(num(${u}) / num(${E}))`,t.ORDER_SUBTRACTION]};t.operator_random=(a)=>{const u=t.valueToCode(a,"FROM",t.ORDER_NONE)||0,E=t.valueToCode(a,"TO",t.ORDER_NONE)||0;return[`runtime.random(${u}, ${E})`,t.ORDER_FUNCTION_CALL]};t.operator_gt=(a)=>{const u=t.valueToCode(a,"OPERAND1",t.ORDER_NONE)||0,E=t.valueToCode(a,"OPERAND2",t.ORDER_NONE)||0;return[`(num(${u}) > num(${E}))`,t.ORDER_RELATIONAL]};t.operator_lt=(a)=>{const u=t.valueToCode(a,"OPERAND1",t.ORDER_NONE)||0,E=t.valueToCode(a,"OPERAND2",t.ORDER_NONE)||0;return[`(num(${u}) < num(${E}))`,t.ORDER_RELATIONAL]};t.operator_equals=(a)=>{const u=t.valueToCode(a,"OPERAND1",t.ORDER_NONE)||0,E=t.valueToCode(a,"OPERAND2",t.ORDER_NONE)||0;return[`(num(${u}) == num(${E}) or str(${u}) == str(${E}))`,t.ORDER_RELATIONAL]};t.operator_and=(a)=>{const u=t.valueToCode(a,"OPERAND1",t.ORDER_NONE)||"False",E=t.valueToCode(a,"OPERAND2",t.ORDER_NONE)||"False";return[`(${u} and ${E})`,t.ORDER_LOGICAL_AND]};t.operator_or=(a)=>{const u=t.valueToCode(a,"OPERAND1",t.ORDER_NONE)||"False",E=t.valueToCode(a,"OPERAND2",t.ORDER_NONE)||"False";return[`(${u} or ${E})`,t.ORDER_LOGICAL_OR]};t.operator_not=(a)=>{return[`(not ${t.valueToCode(a,"OPERAND",t.ORDER_NONE)||"False"})`,t.ORDER_LOGICAL_NOT]};t.operator_join=(a)=>{const u=t.valueToCode(a,"STRING1",t.ORDER_NONE)||'""',E=t.valueToCode(a,"STRING2",t.ORDER_NONE)||'""';return[`(str(${u}) + str(${E}))`,t.ORDER_ATOMIC]};t.operator_letter_of=(a)=>{const u=t.valueToCode(a,"LETTER",t.ORDER_NONE)||0;return[`(str(${t.valueToCode(a,"STRING",t.ORDER_NONE)||'""'})[num(${u}) - 1] || "")`,t.ORDER_MEMBER]};t.operator_length=(a)=>{return[`len(str(${t.valueToCode(a,"STRING",t.ORDER_NONE)||'""'}))`,t.ORDER_FUNCTION_CALL]};t.operator_contains=(a)=>{const u=t.valueToCode(a,"STRING1",t.ORDER_NONE)||'""',E=t.valueToCode(a,"STRING2",t.ORDER_NONE)||'""';return[`(str(${u}).count(str(${E})) > 0)`,t.ORDER_FUNCTION_CALL]};t.operator_mod=(a)=>{const u=t.valueToCode(a,"NUM1",t.ORDER_NONE)||0,E=t.valueToCode(a,"NUM2",t.ORDER_NONE)||0;return[`(num(${u}) % num(${E}))`,t.ORDER_MODULUS]};t.operator_round=(a)=>{return t.definitions_.import_math="import math",[`math.round(num(${t.valueToCode(a,"NUM",t.ORDER_NONE)||0}))`,t.ORDER_FUNCTION_CALL]};t.operator_mathop=(a)=>{t.definitions_.import_math="import math";const u=t.valueToCode(a,"NUM",t.ORDER_NONE)||0,E=a.getFieldValue("OPERATOR");let d="";if(E==="ceiling")d+=`math.ceil(num(${u}))`;else if(E==="sin"||E==="cos"||E==="tan")d+=`math.${E}(math.radians(num(${u})))`;else if(E==="asin"||E==="acos"||E==="atan")d+=`math.degrees(math.${E}(num(${u})))`;else if(E==="ln")d+=`(math.log(num(${u}))`;else if(E==="log")d+=`(math.log10(num(${u}))`;else if(E==="e ^")d+=`math.exp(num(${u}))`;else if(E==="10 ^")d+=`math.pow(10, num(${u}))`;else d+=`math.${E}(num(${u}))`;return[d,t.ORDER_FUNCTION_CALL]};t.procedures_definition=(a)=>{};t.procedures_call=(a)=>{};t.procedures_prototype=(a)=>{};t.procedures_declaration=(a)=>{};t.argument_reporter_boolean=(a)=>{};t.argument_reporter_string_number=(a)=>{};t.argument_editor_boolean=(a)=>{};t.argument_editor_string_number=(a)=>{};t.sensing_timer=()=>{return["runtime.time",t.ORDER_MEMBER]};t.sensing_resettimer=()=>{return"runtime.reset_timer()\n"};t.text=(a)=>{const u=a.getFieldValue("TEXT");return[u.length===0||isNaN(u)?t.quote_(u):+u,t.ORDER_ATOMIC]};import{useEffect as o0,useState as n1} from"preact/hooks";import{useLocale as C0,useLayout as m0,useEditor as it} from"@blockcode/core";import{classNames as R0} from"@blockcode/ui";import{BlocksEditor as r0,ScratchBlocks as b,makeToolboxXML as e0} from"@blockcode/blocks-editor";import{ScratchBlocks as x1,blockSeparator as ht} from"@blockcode/blocks-editor";var Jt=1,Qt=2,qt=3,y1="#0FBD8C",G1="#0DA57A",jt="#0B8E69",u1=(a)=>{if(typeof a!=="string")if(Array.isArray(a))a=String(a);else return a;return a.replace(/[<>&'"]/g,(u)=>{switch(u){case"<":return"&lt;";case">":return"&gt;";case"&":return"&amp;";case"'":return"&apos;";case'"':return"&quot;"}})},tt={number:"math_number",angle:"math_angle",text:"text",string:"text",color:"colour_picker",matrix:"matrix",note:"note"},at={number:"NUM",angle:"NUM",text:"TEXT",string:"TEXT",matrix:"MATRIX",note:"NOTE"};function v1(a,u,E,d){const{id:_}=a,R=E(a.name);let o=`<category name="${u1(R)}" id="${u1(_)}"`;if(o+=` colour="${u1(a.themeColor||y1)}"`,o+=` secondaryColour="${u1(a.inputColor||G1)}"`,a.connectionConfig)o+=' showStatusButton="true"';if(a.iconURI)o+=` iconURI="${u1(a.iconURI)}"`;return o+=">",a.blocks.forEach((C)=>{if(C==="---"){o+=`${ht}`;return}if(C.button){o+=`<button text="${E(C.text)}" callbackKey="${C.button}"></button>`;const g=x1.getMainWorkspace();if(g){const I=g.getFlyout();if(I){const c=I.getWorkspace();if(c)c.registerButtonCallback(C.button,d(C.onClick))}}return}if(u&&C.useStage===!1)return;if(!u&&C.useSprite===!1)return;const S=`${_}_${C.id.toLowerCase()}`,r={message0:E(C.text),category:_,outputShape:qt,colour:a.themeColor||y1,colourSecondary:a.inputColor||G1,colourTertiary:a.otherColor||jt};let v=1;if(a.iconURI)r.message0=`%1 %2 ${r.message0}`,r.args0=[{type:"field_image",src:a.iconURI,width:40,height:40},{type:"field_vertical_separator"}],r.extensions=["scratch_extension"],v+=2;if(C.hat)r.nextStatement=null;else if(C.output){if(C.output==="boolean")r.output="Boolean",r.outputShape=Jt;else r.output="String",r.outputShape=Qt;r.checkboxInFlyout=C.monitoring!==!1}else r.previousStatement=null,r.nextStatement=null;let F=`<block type="${u1(S)}">`;if(C.inputs)r.checkboxInFlyout=!1,r.args0=[].concat(r.args0||[],Object.entries(C.inputs).map(([g,I])=>{const c={name:g,type:"input_value"};if(I.menu)c.type="field_dropdown",c.options=I.menu.map(([M,p])=>[E(M),p]);else if(I.type==="boolean")c.check="Boolean";else{if(F+=`<value name="${u1(g)}">`,tt[I.type]){if(F+=`<shadow type="${tt[I.type]}">`,I.default&&at[I.type])F+=`<field name="${at[I.type]}">${u1(E(I.default))}</field>`;F+="</shadow>"}F+="</value>"}return r.message0=r.message0.replace(`[${g}]`,`%${v++}`),c}));if(x1.Blocks[S]={init(){this.jsonInit(r)}},C.python)t[S]=C.python.bind(t);else t[S]=()=>"";F+="</block>",o+=F}),o+="</category>",o}import{useRef as kt,useEffect as xt,useState as ut} from"preact/hooks";import{classNames as yt,Text as i1,Button as Et,Modal as Gt,BufferedInput as t0} from"@blockcode/ui";function m1(a){const u=globalThis.document,E=u.createElement("style");E.appendChild(u.createTextNode(a)),u.head.append(E)}m1("._5SVWFW_prompt-modal{width:360px}._5SVWFW_prompt-content{background:var(--ui-white);padding:1.5rem 2.25rem}._5SVWFW_prompt-content input[type=checkbox],._5SVWFW_prompt-content input[type=radio]{margin:3px}._5SVWFW_label{margin:0 0 .75rem;font-weight:500}._5SVWFW_variable-name-text-input{border:1px solid var(--ui-black-transparent);color:var(--text-primary-transparent);border-radius:5px;width:100%;height:3rem;margin-bottom:1.5rem;padding:0 1rem;font-size:.875rem}._5SVWFW_info-message{text-align:center;margin-bottom:1.5rem;font-size:.875rem;font-weight:400}._5SVWFW_options{justify-content:space-between;margin-bottom:1.5rem;font-weight:400;display:flex}._5SVWFW_button-row{text-align:right;font-weight:bolder}._5SVWFW_button{padding:.75rem 1rem;font-size:.85rem;font-weight:600}._5SVWFW_ok-button{background:var(--motion-primary);border:var(--motion-primary);color:var(--ui-white);margin-left:var(--space)}");var Q={buttonRow:"_5SVWFW_button-row",label:"_5SVWFW_label",variableNameTextInput:"_5SVWFW_variable-name-text-input",options:"_5SVWFW_options",button:"_5SVWFW_button",promptContent:"_5SVWFW_prompt-content",promptModal:"_5SVWFW_prompt-modal",okButton:"_5SVWFW_ok-button",infoMessage:"_5SVWFW_info-message"};import{jsx as X,jsxs as R1} from"preact/jsx-runtime";function $1({title:a,label:u,defaultValue:E,enableLocalVariable:d,showListMessage:_,showVariableOptions:R,showCloudOption:o,onClose:C,onSubmit:S}){const r=kt(null),[v,F]=ut(E),[g,I]=ut({scope:"global",isCloud:!1}),c=()=>{S(v,g)},M=(p)=>{if(p.key==="Escape")C();if(p.key==="Enter")S(r.current.base.value,g)};return xt(()=>{if(r.current)r.current.base.focus(),window.addEventListener("keydown",M);return()=>{window.removeEventListener("keydown",M)}},[r]),X(Gt,{title:a,className:Q.promptModal,onClose:C,children:R1("div",{className:Q.promptContent,children:[X("div",{className:Q.label,children:u}),X(t0,{autoFocus:!0,forceFocus:!0,ref:r,className:Q.variableNameTextInput,defaultValue:v,onSubmit:F}),R&&X("div",{children:d?R1("div",{className:Q.options,children:[R1("label",{children:[X("input",{checked:g.scope==="global",name:"variableScopeOption",type:"radio",value:"global",onChange:()=>I({...g,scope:"global"})}),X(i1,{id:"blocks.dataPrompt.forAllTargets",defaultMessage:"For all targets"})]}),R1("label",{children:[X("input",{checked:g.scope==="local",name:"variableScopeOption",type:"radio",value:"local",onChange:()=>I({...g,scope:"local"})}),X(i1,{id:"blocks.dataPrompt.forThisTarget",defaultMessage:"For this target only"})]})]}):X("div",{className:Q.infoMessage,children:_?X(i1,{id:"blocks.dataPrompt.listAvailableToAllTargets",defaultMessage:"This list will be available to all targets."}):X(i1,{id:"blocks.dataPrompt.availableToAllTargets",defaultMessage:"This variable will be available to all targets."})})}),R1("div",{className:Q.buttonRow,children:[X(Et,{className:Q.button,onClick:C,children:X(i1,{id:"blocks.dataPrompt.cancel",defaultMessage:"Cancel"})}),X(Et,{className:yt(Q.button,Q.okButton),onClick:c,children:X(i1,{id:"blocks.dataPrompt.ok",defaultMessage:"OK"})})]})]})})}import{useEffect as a0,useState as Tt} from"preact/hooks";import{useLocale as u0,useLayout as E0,useEditor as d0} from"@blockcode/core";import{Library as T0} from"@blockcode/ui";var dt=["nes","translate","color-sensor","servo","time","pen","brain","request","text","broadcast"].map(async(a)=>{const{default:u}=await import(`@blockcode/extension-${a}`);return u.id=a,u});import{jsx as i0} from"preact/jsx-runtime";var N0=Promise.all(dt);function w1({deviceId:a,onSelect:u,onClose:E,onFilter:d}){const[_,R]=Tt([]),[o,C]=Tt(!1),{language:S,getText:r}=u0(),{createAlert:v,removeAlert:F}=E0(),{addAsset:g}=d0(),I=(c)=>{const M=c.tags||[];let p=["blocks",["dupont","data"],["3v3","5v"]];if(d)p=d(M);if(Array.isArray(p))return p.every((W)=>{if(Array.isArray(W))return W.some((x)=>M.includes(x));return M.includes(W)});return p};return a0(()=>{N0.then((c)=>{R(c.filter(I).map((M)=>Object.assign({...M,featured:!0,disabled:M.disabled||M.preview,onSelect:async()=>{v("importing",{id:M.id});let{default:p}=await import(`@blockcode/extension-${M.id}/blocks`);if(typeof p==="function")p=p(a);if(p.id=M.id,p.files)p.files.forEach(async(W)=>{const x=`extensions/${M.id.replace(/[^a-z\d]/gi,"_")}/${W.name}`,P=await fetch(W.uri).then((V)=>V.text());g({...W,id:x,content:P})});u(p),F(M.id),E()}},M.translations&&M.translations[S]?{name:M.translations[S].name||M.name,description:M.translations[S].description||M.description,collaborator:M.translations[S].collaborator||M.collaborator}:{}))),C(!1)})},[]),i0(T0,{filterable:!0,loading:o,items:_,filterPlaceholder:r("gui.library.search","Search"),title:r("blocks.extensions.addExtension","Add Extension"),emptyText:r("blocks.extensions.empty","No extension!"),onClose:E})}m1(".cujmXa_editor-wrapper{border-radius:inherit;width:100%;height:100%;position:relative}.cujmXa_extension-button{z-index:var(--z-index-extension-button);background:var(--motion-primary);border:1px solid var(--motion-primary);box-sizing:content-box;border-bottom-left-radius:inherit;border-top:0;height:3.25rem;position:absolute;bottom:-1px;left:-1px}.cujmXa_extension-button:before{--fade-out-distance:15px;content:\"\";top:calc(calc(-1*var(--fade-out-distance)));height:var(--fade-out-distance);background:linear-gradient(#0000,#00000026);position:absolute;left:0;right:0}.cujmXa_add-button{cursor:pointer;background:0 0;border:none;outline:none;width:100%;height:100%}.cujmXa_add-button img{width:1.75rem;height:1.75rem}.cujmXa_debug-box{z-index:var(--z-index-monitor);border:1px solid var(--ui-tertiary);border-radius:var(--space)var(--space)0 0;opacity:.8;font-size:var(--standard-font-size);background:#fff;border-bottom:0;width:600px;height:300px;position:absolute;bottom:0;left:50vw;overflow:auto;transform:translate(-50%)}.cujmXa_debug-box pre{margin:calc(var(--space)/2)}");var s1={debugBox:"cujmXa_debug-box",addButton:"cujmXa_add-button",extensionButton:"cujmXa_extension-button",editorWrapper:"cujmXa_editor-wrapper"};var Nt="./assets/icon-extension-5ec2ee35b87b4126.svg";import{jsx as _1,jsxs as _t,Fragment as n0} from"preact/jsx-runtime";var k=new Map,ot=(a)=>typeof a!=="string"&&!a.button,s0=async(a,u,E,d,_)=>{if(u){for(let R of u)if(!k.has(R)){let{default:o}=await import(`@blockcode/extension-${R}/blocks`);if(typeof o==="function")o=o(a);if(o.id=R,o.files)o.files.forEach(async(C)=>{const S=`extensions/${R}/${C.name}`,r=await fetch(C.uri).then((v)=>v.text());d({...C,id:S,content:r})});if(E(o.translations),_)_({...o,blocks:o.blocks.filter(ot)});k.set(R,o)}}};function l1({toolbox:a,messages:u,enableMultiTargets:E,enableLocalVariable:d,disableGenerator:_,disableExtension:R,deviceId:o,onChange:C,onExtensionsFilter:S,onLoadExtension:r}){const{addLocaleData:v,getText:F,maybeLocaleText:g}=C0(),{splash:I,createPrompt:c,createAlert:M,removeAlert:p,setSplash:W}=m0(),{editor:x,fileList:P,selectedFileId:V,openFile:E1,modifyFile:q,modifyAsset:O1,setModified:A1}=it(),[y,s]=n1(),[T,i]=n1(!1),[N,m]=n1(!1),[l,O]=n1(!1);if(I){if(I===!0&&l===!1)k.clear(),O(setTimeout(()=>{O(s0(o,x.extensions,v,O1,r).then(()=>O(!0)))},100));if(l===!0){let e=!0;if(P.length>1){for(let A=0;A>-P.length;A--)if(!P.at(A).content){e=!1,setTimeout(()=>{const U=(A+P.length)%P.length;E1(P[U].id)},100);break}}if(e)setTimeout(()=>{W(!1),A1(!1)},100)}}u={EVENT_WHENPROGRAMSTART:F("blocks.event.programStart","when program start"),CONTROL_STOP_OTHER:F("blocks.control.stopOther","other scripts"),...u||[]},o0(()=>{b.prompt=(e,A,L,U,G)=>{const h={callback:L,message:e,defaultValue:A};h.title=U?U:b.Msg.VARIABLE_MODAL_TITLE,h.varType=typeof G==="string"?G:b.SCALAR_VARIABLE_TYPE,h.showVariableOptions=E&&G!==b.BROADCAST_MESSAGE_VARIABLE_TYPE&&h.title!==b.Msg.RENAME_VARIABLE_MODAL_TITLE&&h.title!==b.Msg.RENAME_LIST_MODAL_TITLE,h.showCloudOption=G===b.SCALAR_VARIABLE_TYPE&&this.props.canUseCloud,i(h)},b.FlyoutExtensionCategoryHeader.getExtensionState=(e)=>{if(k.has(e)){const A=k.get(e);if(A.connectionConfig?.items.every((L)=>localStorage.getItem(`${A.id}.connection.${L.id}`)))return b.StatusButtonState.READY}return b.StatusButtonState.NOT_READY},b.statusButtonCallback=(e)=>{if(!k.has(e))return;const A=k.get(e),{connectionConfig:L}=A;if(!L)return;c({title:A.name,label:L.title,inputMode:L.items.map((U)=>({name:U.id,placeholder:U.text,defaultValue:localStorage.getItem(`${A.id}.connection.${U.id}`)})),content:L.description,onSubmit:(U)=>{if(Object.entries(U).forEach(([G,h])=>{localStorage.setItem(`${A.id}.connection.${G}`,`${h}`)}),y)b.refreshStatusButtons(y)}})}},[y]);let D;if(y)D=y.getAllVariables().filter((e)=>{if(e.isLocal)return!1;if(e.type===b.BROADCAST_MESSAGE_VARIABLE_TYPE){if(e.name===b.Msg.DEFAULT_BROADCAST_MESSAGE_NAME)return!1;const A=e.id_.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),L=new RegExp(`<field name="BROADCAST_OPTION" id="${A}"[^>]+>[^<]+</field>`,"g");for(let U of P)if(L.test(U.xml))return!0;return!1}return!0});let Z=a||e0();const j=V===P[0].id,Y=(e)=>e.bind(null,{context:it(),createPrompt:c,createAlert:M,removeAlert:p});k.forEach((e)=>{Z+=v1(e,j,g,Y)});const B=(e,A)=>{let L;if(!_)L=t.workspaceToCode(A);if(q({xml:e,content:L}),C)C(e,A)},K=(e,A)=>{T.callback(e,[],A),i(!1)},$=()=>i(!1),z=()=>m(!0),w=()=>m(!1),n=(e)=>{if(!k.has(e.id)){if(v(e.translations),r)r({...e,blocks:e.blocks.filter(ot)});k.set(e.id,e)}setTimeout(()=>{y.toolbox_.setSelectedCategoryById(e.id)},100)};return _t(n0,{children:[_t("div",{className:s1.editorWrapper,children:[_1(r0,{toolbox:Z,messages:u,globalVariables:D,onWorkspaceCreated:s,onChange:V!==null?B:null}),R?null:_1("div",{className:R0("scratchCategoryMenu",s1.extensionButton),children:_1("button",{className:s1.addButton,title:F("blocks.extensions.addExtension","Add Extension"),onClick:z,children:_1("img",{src:Nt,title:"Add Extension"})})}),T&&_1($1,{title:T.title,label:T.message,defaultValue:T.defaultValue,enableLocalVariable:d,showListMessage:T.varType===b.LIST_VARIABLE_TYPE,showVariableOptions:T.showVariableOptions,showCloudOption:T.showCloudOption,onClose:$,onSubmit:K}),N&&_1(w1,{deviceId:o,onFilter:S,onSelect:n,onClose:w})]}),!1]})}var Ct="./assets/icon-blocks-d7e4a3a3eb74d0fb.svg";var mt={"blocks.menu.file":"File","blocks.menu.file.newProject":"New","blocks.menu.file.openProject":"Open","blocks.menu.file.saveProject":"Save","blocks.menu.file.uploadProject":"Load from your computer","blocks.menu.file.downloadProject":"Save to your computer","blocks.menu.edit":"Edit","blocks.menu.edit.undo":"Undo","blocks.menu.edit.redo":"Redo","blocks.menu.device":"Device","blocks.menu.device.name":"device","blocks.menu.device.connect":"Connect to your {name}","blocks.menu.device.disconnect":"Disconnect this {name}","blocks.menu.device.download":"Download program","blocks.menu.device.turnOnAutoDownload":"Turn on Auto Download","blocks.menu.device.turnOffAutoDownload":"Turn off Auto Download","blocks.alert.downloading":"Downloading...{progress}%","blocks.alert.downloadCompleted":"Download completed.","blocks.codeTab":"Code","blocks.monitorPane.title":"Monitor","blocks.downloadToDevice":"Download","blocks.extensions.addExtension":"Add Extension","blocks.extensions.empty":"No extension!","blocks.dataPrompt.forAllTargets":"For all targets","blocks.dataPrompt.forThisTarget":"For this target only","blocks.dataPrompt.availableToAllTargets":"This variable will be available to all targets.","blocks.dataPrompt.listAvailableToAllTargets":"This list will be available to all targets.","blocks.dataPrompt.cancel":"Cancel","blocks.dataPrompt.ok":"OK","blocks.event.programStart":"when program start","blocks.control.stopOther":"other scripts"};var Rt={"blocks.menu.file":"\u6587\u4EF6","blocks.menu.file.newProject":"\u65B0\u4F5C\u54C1","blocks.menu.file.openProject":"\u6253\u5F00","blocks.menu.file.saveProject":"\u4FDD\u5B58","blocks.menu.file.uploadProject":"\u4ECE\u7535\u8111\u4E2D\u6253\u5F00","blocks.menu.file.downloadProject":"\u4FDD\u5B58\u5230\u7535\u8111","blocks.menu.edit":"\u7F16\u8F91","blocks.menu.edit.undo":"\u64A4\u9500","blocks.menu.edit.redo":"\u6062\u590D","blocks.menu.device":"\u8BBE\u5907","blocks.menu.device.name":"\u8BBE\u5907","blocks.menu.device.connect":"\u8FDE\u63A5{name}","blocks.menu.device.disconnect":"\u65AD\u5F00{name}\u8FDE\u63A5","blocks.menu.device.download":"\u4E0B\u8F7D\u7A0B\u5E8F","blocks.menu.device.turnOnAutoDownload":"\u6253\u5F00\u81EA\u52A8\u4E0B\u8F7D","blocks.menu.device.turnOffAutoDownload":"\u5173\u95ED\u81EA\u52A8\u4E0B\u8F7D","blocks.alert.downloading":"\u6B63\u5728\u4E0B\u8F7D\u2026{progress}%","blocks.alert.downloadCompleted":"\u4E0B\u8F7D\u5B8C\u6210\u3002","blocks.codeTab":"\u4EE3\u7801","blocks.monitorPane.title":"\u76D1\u89C6\u5668","blocks.downloadToDevice":"\u4E0B\u8F7D","blocks.extensions.addExtension":"\u6DFB\u52A0\u6269\u5C55","blocks.extensions.empty":"\u6CA1\u6709\u6269\u5C55\uFF01","blocks.dataPrompt.forAllTargets":"\u9002\u7528\u4E8E\u5168\u5C40","blocks.dataPrompt.forThisTarget":"\u4EC5\u9002\u7528\u4E8E\u5F53\u524D","blocks.dataPrompt.availableToAllTargets":"\u5168\u5C40\u90FD\u53EF\u4F7F\u7528\u8BE5\u53D8\u91CF\u3002","blocks.dataPrompt.listAvailableToAllTargets":"\u5168\u5C40\u90FD\u53EF\u4F7F\u7528\u8BE5\u5217\u8868\u3002","blocks.dataPrompt.cancel":"\u53D6\u6D88","blocks.dataPrompt.ok":"\u786E\u5B9A","blocks.event.programStart":"\u5F53\u7A0B\u5E8F\u5F00\u59CB\u8FD0\u884C","blocks.control.stopOther":"\u5176\u4ED6\u811A\u672C"};import{jsx as et} from"preact/jsx-runtime";var O0={en:mt,"zh-Hans":Rt},A0={icon:Ct,label:et(rt,{id:"blocks.codeTab",defaultMessage:"Code"}),Content:l1},sa={label:et(rt,{id:"blocks.monitorPane.title",defaultMessage:"Monitor"}),Content:null};function M0({addLocaleData:a,createLayout:u,openProject:E,project:d}){a(O0);const _=(R)=>{R=R??j1,E(Object.assign({selectedFileId:R.fileList[0].id},R))};_(d),u({mainMenu:P1({onNew:_}),tabs:[{...A0,Content:l1}],sidebars:[],pane:!1,tutorials:!0,canEditProjectName:!0})}export{t as pythonGenerator,sa as monitorPane,P1 as makeMainMenu,O0 as locales,M0 as default,A0 as codeTab};
