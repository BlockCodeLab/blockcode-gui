var X0=Object.create;var{defineProperty:m1,getPrototypeOf:F0,getOwnPropertyNames:P0}=Object;var M0=Object.prototype.hasOwnProperty;var V0=(Y,Q,z)=>{z=Y!=null?X0(F0(Y)):{};const R=Q||!Y||!Y.__esModule?m1(z,"default",{value:Y,enumerable:!0}):z;for(let J of P0(Y))if(!M0.call(R,J))m1(R,J,{get:()=>Y[J],enumerable:!0});return R};var D0=(Y,Q)=>()=>(Q||Y((Q={exports:{}}).exports,Q),Q.exports);var G1=D0((_1)=>{(function(){var Y=typeof _1!="undefined"&&_1||typeof define!="undefined"&&{}||this||window;if(typeof define!=="undefined")define("save-svg-as-png",[],function(){return Y});Y.default=Y;var Q="http://www.w3.org/2000/xmlns/",z="http://www.w3.org/1999/xhtml",R="http://www.w3.org/2000/svg",J='<?xml version="1.0" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd" [<!ENTITY nbsp "&#160;">]>',$=/url\(["']?(.+?)["']?\)/,K={woff2:"font/woff2",woff:"font/woff",otf:"application/x-font-opentype",ttf:"application/x-font-ttf",eot:"application/vnd.ms-fontobject",sfnt:"application/font-sfnt",svg:"image/svg+xml"},U=function F(W){return W instanceof HTMLElement||W instanceof SVGElement},N=function F(W){if(!U(W))throw new Error("an HTMLElement or SVGElement is required; got "+W)},X=function F(W){return new Promise(function(q,H){if(U(W))q(W);else H(new Error("an HTMLElement or SVGElement is required; got "+W))})},v=function F(W){return W&&W.lastIndexOf("http",0)===0&&W.lastIndexOf(window.location.host)===-1},B=function F(W){var q=Object.keys(K).filter(function(H){return W.indexOf("."+H)>0}).map(function(H){return K[H]});if(q)return q[0];return console.error("Unknown font format for "+W+". Fonts may not be working correctly."),"application/octet-stream"},I=function F(W){var q="",H=new Uint8Array(W);for(var A=0;A<H.byteLength;A++)q+=String.fromCharCode(H[A]);return window.btoa(q)},_=function F(W,q,H){var A=W.viewBox&&W.viewBox.baseVal&&W.viewBox.baseVal[H]||q.getAttribute(H)!==null&&!q.getAttribute(H).match(/%$/)&&parseInt(q.getAttribute(H))||W.getBoundingClientRect()[H]||parseInt(q.style[H])||parseInt(window.getComputedStyle(W).getPropertyValue(H));return typeof A==="undefined"||A===null||isNaN(parseFloat(A))?0:A},C=function F(W,q,H,A){if(W.tagName==="svg")return{width:H||_(W,q,"width"),height:A||_(W,q,"height")};else if(W.getBBox){var V=W.getBBox(),D=V.x,w=V.y,h=V.width,r=V.height;return{width:D+h,height:w+r}}},T=function F(W){return decodeURIComponent(encodeURIComponent(W).replace(/%([0-9A-F]{2})/g,function(q,H){var A=String.fromCharCode("0x"+H);return A==="%"?"%25":A}))},O=function F(W){var q=window.atob(W.split(",")[1]),H=W.split(",")[0].split(":")[1].split(";")[0],A=new ArrayBuffer(q.length),V=new Uint8Array(A);for(var D=0;D<q.length;D++)V[D]=q.charCodeAt(D);return new Blob([A],{type:H})},j=function F(W,q){if(!q)return;try{return W.querySelector(q)||W.parentNode&&W.parentNode.querySelector(q)}catch(H){console.warn('Invalid CSS selector "'+q+'"',H)}},x=function F(W,q){var H=W.cssText.match($),A=H&&H[1]||"";if(!A||A.match(/^data:/)||A==="about:blank")return;var V=A.startsWith("../")?q+"/../"+A:A.startsWith("./")?q+"/."+A:A;return{text:W.cssText,format:B(V),url:V}},a=function F(W){return Promise.all(Array.from(W.querySelectorAll("image")).map(function(q){var H=q.getAttributeNS("http://www.w3.org/1999/xlink","href")||q.getAttribute("href");if(!H)return Promise.resolve(null);if(v(H))H+=(H.indexOf("?")===-1?"?":"&")+"t="+(new Date()).valueOf();return new Promise(function(A,V){var D=document.createElement("canvas"),w=new Image;w.crossOrigin="anonymous",w.src=H,w.onerror=function(){return V(new Error("Could not load "+H))},w.onload=function(){D.width=w.width,D.height=w.height,D.getContext("2d").drawImage(w,0,0),q.setAttributeNS("http://www.w3.org/1999/xlink","href",D.toDataURL("image/png")),A(!0)}})}))},t={},V1=function F(W){return Promise.all(W.map(function(q){return new Promise(function(H,A){if(t[q.url])return H(t[q.url]);var V=new XMLHttpRequest;V.addEventListener("load",function(){var D=I(V.response),w=q.text.replace($,'url("data:'+q.format+";base64,"+D+'")')+"\n";t[q.url]=w,H(w)}),V.addEventListener("error",function(D){console.warn("Failed to load font from: "+q.url,D),t[q.url]=null,H(null)}),V.addEventListener("abort",function(D){console.warn("Aborted loading font from: "+q.url,D),H(null)}),V.open("GET",q.url),V.responseType="arraybuffer",V.send()})})).then(function(q){return q.filter(function(H){return H}).join("")})},K1=null,D1=function F(){if(K1)return K1;return K1=Array.from(document.styleSheets).map(function(W){try{return{rules:W.cssRules,href:W.href}}catch(q){return console.warn("Stylesheet could not be loaded: "+W.href,q),{}}})},E1=function F(W,q){var H=q||{},A=H.selectorRemap,V=H.modifyStyle,D=H.modifyCss,w=H.fonts,h=H.excludeUnusedCss,r=D||function(g,i){var u=A?A(g):g,M=V?V(i):i;return u+"{"+M+"}\n"},k=[],d=typeof w==="undefined",p=w||[];return D1().forEach(function(g){var{rules:i,href:u}=g;if(!i)return;Array.from(i).forEach(function(M){if(typeof M.style!="undefined"){if(j(W,M.selectorText))k.push(r(M.selectorText,M.style.cssText));else if(d&&M.cssText.match(/^@font-face/)){var P=x(M,u);if(P)p.push(P)}else if(!h)k.push(M.cssText)}})}),V1(p).then(function(g){return k.join("\n")+g})},o=function F(){if(!navigator.msSaveOrOpenBlob&&!("download"in document.createElement("a")))return{popup:window.open()}};Y.prepareSvg=function(F,W,q){N(F);var H=W||{},A=H.left,V=A===void 0?0:A,D=H.top,w=D===void 0?0:D,h=H.width,r=H.height,k=H.scale,d=k===void 0?1:k,p=H.responsive,g=p===void 0?!1:p,i=H.excludeCss,u=i===void 0?!1:i;return a(F).then(function(){var M=F.cloneNode(!0);M.style.backgroundColor=(W||{}).backgroundColor||F.style.backgroundColor;var P=C(F,M,h,r),E=P.width,L=P.height;if(F.tagName!=="svg")if(F.getBBox){if(M.getAttribute("transform")!=null)M.setAttribute("transform",M.getAttribute("transform").replace(/translate\(.*?\)/,""));var y=document.createElementNS("http://www.w3.org/2000/svg","svg");y.appendChild(M),M=y}else{console.error("Attempted to render non-SVG element",F);return}if(M.setAttribute("version","1.1"),M.setAttribute("viewBox",[V,w,E,L].join(" ")),!M.getAttribute("xmlns"))M.setAttributeNS(Q,"xmlns",R);if(!M.getAttribute("xmlns:xlink"))M.setAttributeNS(Q,"xmlns:xlink","http://www.w3.org/1999/xlink");if(g)M.removeAttribute("width"),M.removeAttribute("height"),M.setAttribute("preserveAspectRatio","xMinYMin meet");else M.setAttribute("width",E*d),M.setAttribute("height",L*d);if(Array.from(M.querySelectorAll("foreignObject > *")).forEach(function(X1){X1.setAttributeNS(Q,"xmlns",X1.tagName==="svg"?R:z)}),u){var e=document.createElement("div");e.appendChild(M);var s=e.innerHTML;if(typeof q==="function")q(s,E,L);else return{src:s,width:E,height:L}}else return E1(F,W).then(function(X1){var N1=document.createElement("style");N1.setAttribute("type","text/css"),N1.innerHTML="<![CDATA[\n"+X1+"\n]]>";var f1=document.createElement("defs");f1.appendChild(N1),M.insertBefore(f1,M.firstChild);var u1=document.createElement("div");u1.appendChild(M);var x1=u1.innerHTML.replace(/NS\d+:href/gi,'xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href');if(typeof q==="function")q(x1,E,L);else return{src:x1,width:E,height:L}})})},Y.svgAsDataUri=function(F,W,q){return N(F),Y.prepareSvg(F,W).then(function(H){var{src:A,width:V,height:D}=H,w="data:image/svg+xml;base64,"+window.btoa(T(J+A));if(typeof q==="function")q(w,V,D);return w})},Y.svgAsPngUri=function(F,W,q){N(F);var H=W||{},A=H.encoderType,V=A===void 0?"image/png":A,D=H.encoderOptions,w=D===void 0?0.8:D,h=H.canvg,r=function k(d){var{src:p,width:g,height:i}=d,u=document.createElement("canvas"),M=u.getContext("2d"),P=window.devicePixelRatio||1;if(u.width=g*P,u.height=i*P,u.style.width=u.width+"px",u.style.height=u.height+"px",M.setTransform(P,0,0,P,0,0),h)h(u,p);else M.drawImage(p,0,0);var E=void 0;try{E=u.toDataURL(V,w)}catch(L){if(typeof SecurityError!=="undefined"&&L instanceof SecurityError||L.name==="SecurityError"){console.error("Rendered SVG images cannot be downloaded in this browser.");return}else throw L}if(typeof q==="function")q(E,u.width,u.height);return Promise.resolve(E)};if(h)return Y.prepareSvg(F,W).then(r);else return Y.svgAsDataUri(F,W).then(function(k){return new Promise(function(d,p){var g=new Image;g.onload=function(){return d(r({src:g,width:g.width,height:g.height}))},g.onerror=function(){p("There was an error loading the data URI as an image on the following SVG\n"+window.atob(k.slice(26))+"Open the following link to see browser\'s diagnosis\n"+k)},g.src=k})})},Y.download=function(F,W,q){if(navigator.msSaveOrOpenBlob)navigator.msSaveOrOpenBlob(O(W),F);else{var H=document.createElement("a");if("download"in H){H.download=F,H.style.display="none",document.body.appendChild(H);try{var A=O(W),V=URL.createObjectURL(A);H.href=V,H.onclick=function(){return requestAnimationFrame(function(){return URL.revokeObjectURL(V)})}}catch(D){console.error(D),console.warn("Error while getting object URL. Falling back to string URL."),H.href=W}H.click(),document.body.removeChild(H)}else if(q&&q.popup)q.popup.document.title=F,q.popup.location.replace(W)}},Y.saveSvg=function(F,W,q){var H=o();return X(F).then(function(A){return Y.svgAsDataUri(A,q||{})}).then(function(A){return Y.download(W,A,H)})},Y.saveSvgAsPng=function(F,W,q){var H=o();return X(F).then(function(A){return Y.svgAsPngUri(A,q||{})}).then(function(A){return Y.download(W,A,H)})}})()});import{Text as A0} from"@blockcode/ui";import{Text as j1} from"@blockcode/ui";var y1=V0(G1(),1);import{Keys as Z1,useLayout as E0,useEditor as N0} from"@blockcode/core";import{Text as R1,MenuSection as k1,MenuItem as U1} from"@blockcode/ui";import{ScratchBlocks as _0} from"@blockcode/blocks-editor";import{jsx as m,Fragment as T0} from"preact/jsx-runtime";var T1=/Mac/i.test(navigator.platform||navigator.userAgent);function I1({itemClassName:Y,onNew:Q,onSave:z,children:R}){const{createPrompt:J,setStoreLibrary:$}=E0(),{modified:K,saveNow:U}=N0();return m(T0,{children:[m(k1,{children:[m(U1,{className:Y,label:m(R1,{id:"blocks.menu.file.newProject",defaultMessage:"New"}),hotkey:[T1?Z1.COMMAND:Z1.CONTROL,Z1.N],onClick:()=>{if(K)J({title:m(R1,{id:"gui.projects.notSaved",defaultMessage:"Not saved"}),label:m(R1,{id:"gui.projects.replaceProject",defaultMessage:"Replace contents of the current project?"}),onSubmit:Q});else Q()}}),m(U1,{className:Y,label:m(R1,{id:"blocks.menu.file.openProject",defaultMessage:"Open"}),hotkey:[T1?Z1.COMMAND:Z1.CONTROL,Z1.O],onClick:()=>$(!0)}),m(U1,{className:Y,label:m(R1,{id:"blocks.menu.file.saveProject",defaultMessage:"Save"}),hotkey:[T1?Z1.COMMAND:Z1.CONTROL,Z1.S],onClick:async()=>{let N,X;const v=_0.getMainWorkspace();if(v)N=await y1.svgAsDataUri(v.getCanvas(),{}),X=Array.from(new Set(Object.values(v.blockDB_).filter((B)=>["nes","translate","color-sensor","servo","time","pen","brain","request","text","broadcast"].find((I)=>I===B.category_)).map((B)=>B.category_)));U((B)=>{const I={thumb:N,...B,...z?z():{},editor:{...B.editor,extensions:X}};return I.fileList=I.fileList.map((_)=>({..._,script:void 0,content:void 0})),I})}})]}),m(k1,{children:[m(U1,{disabled:!0,className:Y,label:m(R1,{id:"blocks.menu.file.uploadProject",defaultMessage:"Load from your computer"})}),m(U1,{disabled:!0,className:Y,label:m(R1,{id:"blocks.menu.file.downloadProject",defaultMessage:"save to your computer"})})]}),R]})}import{useEffect as I0,useState as B1} from"preact/hooks";import{Keys as Y1} from"@blockcode/core";import{Text as b1,MenuSection as B0,MenuItem as h1} from"@blockcode/ui";import{ScratchBlocks as w0} from"@blockcode/blocks-editor";import{jsx as H1,Fragment as L0} from"preact/jsx-runtime";var d1=/Mac/i.test(navigator.platform||navigator.userAgent);function w1({itemClassName:Y,children:Q}){const[z,R]=B1(!0),[J,$]=B1(!0),[K,U]=B1(null),N=w0.getMainWorkspace();if(N){if(K?.id!==N.id)U(N)}return I0(()=>{if(K)K.addChangeListener(()=>{R(K.undoStack_.length===0),$(K.redoStack_.length===0)}),R(K.undoStack_.length===0),$(K.redoStack_.length===0)},[K]),H1(L0,{children:[H1(B0,{children:[H1(h1,{disabled:z,className:Y,label:H1(b1,{id:"blocks.menu.edit.undo",defaultMessage:"Undo"}),hotkey:[d1?Y1.COMMAND:Y1.CONTROL,Y1.Z],onClick:async(X)=>{if(X instanceof MouseEvent&&K)K.undo(!1)}}),H1(h1,{disabled:J,className:Y,label:H1(b1,{id:"blocks.menu.edit.redo",defaultMessage:"Redo"}),hotkey:d1?[Y1.SHIFT,Y1.COMMAND,Y1.Z]:[Y1.CONTROL,Y1.Y],onClick:async(X)=>{if(X instanceof MouseEvent&&K)K.undo(!0)}})]}),Q]})}import{useState as O0} from"preact/hooks";import{useLocale as j0,useLayout as S0,useEditor as C0} from"@blockcode/core";import{Text as W1,Spinner as v0,MenuSection as g0,MenuItem as p1} from"@blockcode/ui";import{connectDevice as i1,disconnectDevice as f0,downloadDevice as u0,showDownloadScreen as x0} from"@blockcode/device-pyboard";var L1=[{usbVendorId:12346},{usbVendorId:11914}];import{jsx as l,Fragment as m0} from"preact/jsx-runtime";function O1({itemClassName:Y,deviceName:Q,deviceFilters:z,downloadScreen:R,onDownload:J,children:$}){const[K,U]=O0(!1),{maybeLocaleText:N}=j0(),{createAlert:X,removeAlert:v}=S0(),{fileList:B,assetList:I,device:_,setDevice:C}=C0(),T=()=>U(!1),O=()=>U(!0),j=(x)=>{if(!j.id)j.id=`download.${Date.now()}`,O();if(x<100)X({id:j.id,icon:l(v0,{level:"success"}),message:l(W1,{id:"blocks.alert.downloading",defaultMessage:"Downloading...{progress}%",progress:x})});else X({id:j.id,icon:null,message:l(W1,{id:"blocks.alert.downloadCompleted",defaultMessage:"Download completed."})}),setTimeout(()=>{v(j.id),T(),delete j.id},1000)};return l(m0,{children:[l(g0,{children:[l(p1,{className:Y,label:_?l(W1,{id:"blocks.menu.device.disconnect",defaultMessage:"Disconnect this {name}",name:N(Q||l(W1,{id:"blocks.menu.device.name",defaultMessage:"device"}))}):l(W1,{id:"blocks.menu.device.connect",defaultMessage:"Connect your {name}",name:N(Q||l(W1,{id:"blocks.menu.device.name",defaultMessage:"device"}))}),onClick:async()=>{if(_){if(await f0(_,C),j.id)v(j.id),delete j.id}else try{await i1(z||L1,C)}catch(x){}}}),l(p1,{disabled:K,className:Y,label:l(W1,{id:"blocks.menu.device.download",defaultMessage:"Download program"}),onClick:async()=>{if(j.id)return;try{const x=_||await i1(z||L1,C);if(R)await x0(x,R);u0(x,J?await J(B,I):[].concat(I),j)}catch(x){}}})]}),$]})}var s1="./assets/icon-file-1def53419f4ad0ae.svg";var l1="./assets/icon-edit-2b1e47b495524ed2.svg";var c1="./assets/icon-device-c2fafab2eaccf043.svg";import{jsx as q1} from"preact/jsx-runtime";function S1({deviceName:Y,deviceFilters:Q,createDefaultProject:z,saveCurrentProject:R,downloadProjectToDevice:J,showDownloadScreen:$}){return[{icon:s1,label:q1(j1,{id:"blocks.menu.file",defaultMessage:"File"}),Menu:({itemClassName:K,children:U})=>q1(I1,{itemClassName:K,onNew:z,onSave:R,children:U})},{icon:l1,label:q1(j1,{id:"blocks.menu.edit",defaultMessage:"Edit"}),Menu:({itemClassName:K,children:U})=>q1(w1,{itemClassName:K,children:U})},{icon:c1,label:q1(j1,{id:"blocks.menu.device",defaultMessage:"Device"}),Menu:({itemClassName:K,children:U})=>q1(O1,{deviceName:Y,itemClassName:K,deviceFilters:Q,downloadScreen:$,onDownload:J,children:U})}]}var a1={assetList:[{id:"main",type:"text/x-python",content:`
from popsicle.blocks import *
import code1
run()
`}],fileList:[{id:"code1",type:"text/x-python"}]};import{ScratchBlocks as b} from"@blockcode/blocks-editor";var Z=new b.Generator("Python");Z.addReservedWords("False,None,True,and,as,assert,break,class,continue,def,del,elif,else,except,exec,finally,for,from,global,if,import,in,is,lambda,nonlocal,not,or,pass,print,raise,return,try,while,with,yield,NotImplemented,Ellipsis,__debug__,quit,exit,copyright,license,credits,ArithmeticError,AssertionError,AttributeError,BaseException,BlockingIOError,BrokenPipeError,BufferError,BytesWarning,ChildProcessError,ConnectionAbortedError,ConnectionError,ConnectionRefusedError,ConnectionResetError,DeprecationWarning,EOFError,Ellipsis,EnvironmentError,Exception,FileExistsError,FileNotFoundError,FloatingPointError,FutureWarning,GeneratorExit,IOError,ImportError,ImportWarning,IndentationError,IndexError,InterruptedError,IsADirectoryError,KeyError,KeyboardInterrupt,LookupError,MemoryError,ModuleNotFoundError,NameError,NotADirectoryError,NotImplemented,NotImplementedError,OSError,OverflowError,PendingDeprecationWarning,PermissionError,ProcessLookupError,RecursionError,ReferenceError,ResourceWarning,RuntimeError,RuntimeWarning,StandardError,StopAsyncIteration,StopIteration,SyntaxError,SyntaxWarning,SystemError,SystemExit,TabError,TimeoutError,TypeError,UnboundLocalError,UnicodeDecodeError,UnicodeEncodeError,UnicodeError,UnicodeTranslateError,UnicodeWarning,UserWarning,ValueError,Warning,ZeroDivisionError,_,__build_class__,__debug__,__doc__,__import__,__loader__,__name__,__package__,__spec__,abs,all,any,apply,ascii,basestring,bin,bool,buffer,bytearray,bytes,callable,chr,classmethod,cmp,coerce,compile,complex,copyright,credits,delattr,dict,dir,divmod,enumerate,eval,exec,execfile,exit,file,filter,float,format,frozenset,getattr,globals,hasattr,hash,help,hex,id,input,int,intern,isinstance,issubclass,iter,len,license,list,locals,long,map,max,memoryview,min,next,object,oct,open,ord,pow,print,property,quit,range,raw_input,reduce,reload,repr,reversed,round,set,setattr,slice,sorted,staticmethod,str,sum,super,tuple,type,unichr,unicode,vars,xrange,zip");Z.ORDER_ATOMIC=0;Z.ORDER_COLLECTION=1;Z.ORDER_STRING_CONVERSION=1;Z.ORDER_MEMBER=2.1;Z.ORDER_FUNCTION_CALL=2.2;Z.ORDER_EXPONENTIATION=3;Z.ORDER_UNARY_SIGN=4;Z.ORDER_BITWISE_NOT=4;Z.ORDER_MULTIPLICATIVE=5;Z.ORDER_ADDITIVE=6;Z.ORDER_BITWISE_SHIFT=7;Z.ORDER_BITWISE_AND=8;Z.ORDER_BITWISE_XOR=9;Z.ORDER_BITWISE_OR=10;Z.ORDER_RELATIONAL=11;Z.ORDER_LOGICAL_NOT=12;Z.ORDER_LOGICAL_AND=13;Z.ORDER_LOGICAL_OR=14;Z.ORDER_CONDITIONAL=15;Z.ORDER_LAMBDA=16;Z.ORDER_NONE=99;Z.ORDER_OVERRIDES=[[Z.ORDER_FUNCTION_CALL,Z.ORDER_MEMBER],[Z.ORDER_FUNCTION_CALL,Z.ORDER_FUNCTION_CALL],[Z.ORDER_MEMBER,Z.ORDER_MEMBER],[Z.ORDER_MEMBER,Z.ORDER_FUNCTION_CALL],[Z.ORDER_LOGICAL_NOT,Z.ORDER_LOGICAL_NOT],[Z.ORDER_LOGICAL_AND,Z.ORDER_LOGICAL_AND],[Z.ORDER_LOGICAL_OR,Z.ORDER_LOGICAL_OR]];Z.init=(Y)=>{if(Z.PASS=Z.INDENT+"pass\n",Z.definitions_=Object.create(null),Z.functionNames_=Object.create(null),!Z.variableDB_)Z.variableDB_=new b.Names(Z.RESERVED_WORDS_);else Z.variableDB_.reset();Z.variableDB_.setVariableMap(Y.getVariableMap());const Q=[],z=Y.getAllVariables();for(let J=0;J<z.length;J++){if(z[J].type===b.BROADCAST_MESSAGE_VARIABLE_TYPE)continue;let $=Z.variableDB_.getName(z[J].getId(),b.Variables.NAME_TYPE),K="";if(z[J].type===b.LIST_VARIABLE_TYPE)$=`${$}_${b.LIST_VARIABLE_TYPE}`,K="[]";Q.push(`${$} = ${K}`)}const R=b.Variables.allDeveloperVariables(Y);for(let J=0;J<R.length;J++){let $=Z.variableDB_.getName(R[J],b.Names.DEVELOPER_VARIABLE_TYPE),K="";if(z[J].type===b.LIST_VARIABLE_TYPE)$=`${$}_${b.LIST_VARIABLE_TYPE}`,K="[]";Q.push(`${$} = ${K}`)}if(Q.length)Z.definitions_.variables=Q.join("\n");Z.definitions_.import_blocks="from blocks import *"};Z.finish=(Y)=>{const Q=[],z=[];for(let J in Z.definitions_){const $=Z.definitions_[J];if($.match(/^(from\s+\S+\s+)?import\s+\S+/))Q.push($);else z.push($)}return delete Z.definitions_,delete Z.functionNames_,Z.variableDB_.reset(),(Q.join("\n")+"\n\n"+z.join("\n\n")).replace(/\n\n+/g,"\n\n").replace(/\n*$/,"\n\n\n")+Y};Z.scrubNakedValue=(Y)=>{return Y+"\n"};Z.quote_=(Y)=>{Y=Y.replace(/\\/g,"\\\\").replace(/\n/g,"\\\n").replace(/\%/g,"\\%");let Q='"';if(Y.indexOf('"')!==-1)if(Y.indexOf("'")===-1)Q="'";else Y=Y.replace(/"/g,'\\"');return Q+Y+Q};Z.scrub_=(Y,Q)=>{let z="";if(!Y.outputConnection?.targetConnection){let R=Y.getCommentText();if(R=b.utils.wrap(R,Z.COMMENT_WRAP-3),R)if(Y.getProcedureDef)z+='"""'+R+'\n"""\n';else z+=Z.prefixLines(R+"\n","# ");for(let J=0;J<Y.inputList.length;J++)if(Y.inputList[J].type==b.INPUT_VALUE){const $=Y.inputList[J].connection.targetBlock();if($){const K=Z.allNestedComments($);if(K)z+=Z.prefixLines(K,"# ")}}}if(Y.startHat_){const R=Y.nextConnection&&Y.nextConnection.targetBlock();let J=Z.blockToCode(R);if(J)J=Z.prefixLines(J,Z.INDENT),Q=Q.replace(`\n${Z.PASS}`,`\n${J}`);return z+Q}if(Y.parentBlock_){const R=Y.nextConnection&&Y.nextConnection.targetBlock(),J=Z.blockToCode(R);return z+Q+J}};Z.getAdjustedInt=(Y,Q,z,R)=>{let J=z||0;if(Y.workspace.options.oneBasedIndex)J--;const $=Y.workspace.options.oneBasedIndex?"1":"0",K=J?Z.ORDER_ADDITIVE:Z.ORDER_NONE;let U=Z.valueToCode(Y,Q,K)||$;if(b.isNumber(U)){if(U=parseInt(U,10)+J,R)U=-U}else{if(J>0)U="int("+U+" + "+J+")";else if(J<0)U="int("+U+" - "+-J+")";else U="int("+U+")";if(R)U="-"+U}return U};Z.hatToCode=(Y="",...Q)=>{if(!Z.functionNames_[Y])Z.functionNames_[Y]=0;Z.functionNames_[Y]+=1;const z=`${Y}_${Z.functionNames_[Y]}`;return Z.HAT_FUNCTION_PLACEHOLDER=z,`async def ${z}(${Q.join(", ")}):\n  this_func = ${z}\n${Z.PASS}\n`};var b0=(Y)=>{const Q=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;Y=Y.replace(Q,(R,J,$,K)=>J+J+$+$+K+K);const z=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(Y);return z?{r:parseInt(z[1],16),g:parseInt(z[2],16),b:parseInt(z[3],16)}:null};Z.colour_picker=(Y)=>{const{r:Q,g:z,b:R}=b0(Y.getFieldValue("COLOUR"));return[`(${Q}, ${z}, ${R})`,Z.ORDER_ATOMIC]};var A1="  await runtime.next_frame()\n";Z.control_wait=(Y)=>{let Q="";if(Z.STATEMENT_PREFIX)Q+=Z.injectId(Z.STATEMENT_PREFIX,Y);const z=Z.valueToCode(Y,"DURATION",Z.ORDER_NONE)||0;return Q+=`await runtime.wait_for(num(${z}))\n`,Q};Z.control_repeat=(Y)=>{let Q="";if(Z.STATEMENT_PREFIX)Q+=Z.injectId(Z.STATEMENT_PREFIX,Y);let z=Z.statementToCode(Y,"SUBSTACK")||Z.PASS;if(Z.STATEMENT_SUFFIX)z=Z.prefixLines(Z.injectId(Z.STATEMENT_SUFFIX,Y),Z.INDENT)+z;const R=Z.valueToCode(Y,"TIMES",Z.ORDER_NONE)||10;return Q+=`for _ in range(num(${R})):\n${z}${A1}`,Q};Z.control_forever=(Y)=>{let Q="";if(Z.STATEMENT_PREFIX)Q+=Z.injectId(Z.STATEMENT_PREFIX,Y);let z=Z.statementToCode(Y,"SUBSTACK")||Z.PASS;if(Z.STATEMENT_SUFFIX)z=Z.prefixLines(Z.injectId(Z.STATEMENT_SUFFIX,Y),Z.INDENT)+z;return Q+=`while True:\n${z}${A1}`,Q};Z.control_if=(Y)=>{let Q="";if(Z.STATEMENT_PREFIX)Q+=Z.injectId(Z.STATEMENT_PREFIX,Y);let z=Z.statementToCode(Y,"SUBSTACK")||Z.PASS;if(Z.STATEMENT_SUFFIX)z=Z.prefixLines(Z.injectId(Z.STATEMENT_SUFFIX,Y),Z.INDENT)+z;const R=Z.valueToCode(Y,"CONDITION",Z.ORDER_NONE)||"False";if(Q+=`if ${R}:\n${z}`,Y.getInput("SUBSTACK2")){if(z=Z.statementToCode(Y,"SUBSTACK2")||Z.PASS,Z.STATEMENT_SUFFIX)z=Z.prefixLines(Z.injectId(Z.STATEMENT_SUFFIX,Y),Z.INDENT)+z;Q+=`else:\n${z}`}return Q};Z.control_if_else=Z.control_if;Z.control_wait_until=(Y)=>{let Q="";if(Z.STATEMENT_PREFIX)Q+=Z.injectId(Z.STATEMENT_PREFIX,Y);const z=Z.valueToCode(Y,"CONDITION",Z.ORDER_NONE)||"False";return Q+=`while not ${z}:\n${A1}`,Q};Z.control_repeat_until=(Y)=>{let Q="";if(Z.STATEMENT_PREFIX)Q+=Z.injectId(Z.STATEMENT_PREFIX,Y);let z=Z.statementToCode(Y,"SUBSTACK")||Z.PASS;if(Z.STATEMENT_SUFFIX)z=Z.prefixLines(Z.injectId(Z.STATEMENT_SUFFIX,Y),Z.INDENT)+z;const R=Z.valueToCode(Y,"CONDITION",Z.ORDER_NONE)||"False";return Q+=`while not ${R}:\n${z}${A1}`,Q};Z.control_while=(Y)=>{let Q="";if(Z.STATEMENT_PREFIX)Q+=Z.injectId(Z.STATEMENT_PREFIX,Y);let z=Z.statementToCode(Y,"SUBSTACK")||Z.PASS;if(Z.STATEMENT_SUFFIX)z=Z.prefixLines(Z.injectId(Z.STATEMENT_SUFFIX,Y),Z.INDENT)+z;const R=Z.valueToCode(Y,"CONDITION",Z.ORDER_NONE)||"False";return Q+=`while ${R}:\n${z}${A1}`,Q};Z.control_stop=(Y)=>{let Q="";if(Z.STATEMENT_PREFIX)Q+=Z.injectId(Z.STATEMENT_PREFIX,Y);switch(Y.getFieldValue("STOP_OPTION")){case"all":Q+="runtime.stop()\n";break;case"this script":Q+="return\n";break;case"other scripts in sprite":Q+="runtime.stop_tasks(this_func)\n";break}return Q};import{ScratchBlocks as S} from"@blockcode/blocks-editor";Z.data_variable=(Y)=>{return[Z.variableDB_.getName(Y.getFieldValue("VARIABLE"),S.Variables.NAME_TYPE),Z.ORDER_ATOMIC]};Z.data_setvariableto=(Y)=>{let Q="";if(javascriptGenerator.STATEMENT_PREFIX)Q+=javascriptGenerator.injectId(javascriptGenerator.STATEMENT_PREFIX,Y);const z=Z.variableDB_.getName(Y.getFieldValue("VARIABLE"),S.Variables.NAME_TYPE),R=Z.valueToCode(Y,"VALUE",Z.ORDER_NONE)||'""';return Q+=`${z} = ${R}\n`,Q};Z.data_changevariableby=(Y)=>{let Q="";if(javascriptGenerator.STATEMENT_PREFIX)Q+=javascriptGenerator.injectId(javascriptGenerator.STATEMENT_PREFIX,Y);const z=Z.variableDB_.getName(Y.getFieldValue("VARIABLE"),S.Variables.NAME_TYPE),R=Z.valueToCode(Y,"VALUE",Z.ORDER_NONE)||0;return Q+=`${z} = num(${z}) + num(${R})\n`,Q};Z.data_listcontents=(Y)=>{return[Z.variableDB_.getName(Y.getFieldValue("LIST"),S.Variables.NAME_TYPE)+"_"+S.LIST_VARIABLE_TYPE,Z.ORDER_ATOMIC]};Z.data_addtolist=(Y)=>{let Q="";if(Z.STATEMENT_PREFIX)Q+=Z.injectId(Z.STATEMENT_PREFIX,Y);const z=Z.variableDB_.getName(Y.getFieldValue("LIST"),S.Variables.NAME_TYPE)+"_"+S.LIST_VARIABLE_TYPE,R=Z.valueToCode(Y,"ITEM",Z.ORDER_NONE)||'""';return Q+=`${z}.append(${R})\n`,Q};Z.data_deleteoflist=(Y)=>{let Q="";if(Z.STATEMENT_PREFIX)Q+=Z.injectId(Z.STATEMENT_PREFIX,Y);const z=Z.variableDB_.getName(Y.getFieldValue("LIST"),S.Variables.NAME_TYPE)+"_"+S.LIST_VARIABLE_TYPE,R=Z.valueToCode(Y,"INDEX",Z.ORDER_NONE)||1;return Q+=`${z}.remove(runtime.index(${R}, len(${z})))\n`,Q};Z.data_deletealloflist=(Y)=>{let Q="";if(Z.STATEMENT_PREFIX)Q+=Z.injectId(Z.STATEMENT_PREFIX,Y);const z=Z.variableDB_.getName(Y.getFieldValue("LIST"),S.Variables.NAME_TYPE)+"_"+S.LIST_VARIABLE_TYPE;return Q+=`${z} = []\n`,Q};Z.data_insertatlist=(Y)=>{let Q="";if(Z.STATEMENT_PREFIX)Q+=Z.injectId(Z.STATEMENT_PREFIX,Y);const z=Z.variableDB_.getName(Y.getFieldValue("LIST"),S.Variables.NAME_TYPE)+"_"+S.LIST_VARIABLE_TYPE,R=Z.valueToCode(Y,"INDEX",Z.ORDER_NONE)||1,J=Z.valueToCode(Y,"ITEM",Z.ORDER_NONE)||'""';return Q+=`${z}.insert(runtime.index(${R}, len(${z})), ${J})\n`,Q};Z.data_replaceitemoflist=(Y)=>{let Q="";if(Z.STATEMENT_PREFIX)Q+=Z.injectId(Z.STATEMENT_PREFIX,Y);const z=Z.variableDB_.getName(Y.getFieldValue("LIST"),S.Variables.NAME_TYPE)+"_"+S.LIST_VARIABLE_TYPE,R=Z.valueToCode(Y,"INDEX",Z.ORDER_NONE)||1,J=Z.valueToCode(Y,"ITEM",Z.ORDER_NONE)||'""';return Q+=`${z}[runtime.index(${R}, len(${z}))] = ${J}\n`,Q};Z.data_itemoflist=(Y)=>{const Q=Z.variableDB_.getName(Y.getFieldValue("LIST"),S.Variables.NAME_TYPE)+"_"+S.LIST_VARIABLE_TYPE,z=Z.valueToCode(Y,"INDEX",Z.ORDER_NONE)||1;return[`${Q}[runtime.index(${z}, len(${Q}))]`,Z.ORDER_CONDITIONAL]};Z.data_itemnumoflist=(Y)=>{const Q=Z.variableDB_.getName(Y.getFieldValue("LIST"),S.Variables.NAME_TYPE)+"_"+S.LIST_VARIABLE_TYPE,z=Z.valueToCode(Y,"ITEM",Z.ORDER_NONE)||0;return[`(${Q}.index(${z}) + 1)`,Z.ORDER_NONE]};Z.data_lengthoflist=(Y)=>{return[`len(${Z.variableDB_.getName(Y.getFieldValue("LIST"),S.Variables.NAME_TYPE)+"_"+S.LIST_VARIABLE_TYPE})`,Z.ORDER_FUNCTION_CALL]};Z.data_listcontainsitem=(Y)=>{const Q=Z.variableDB_.getName(Y.getFieldValue("LIST"),S.Variables.NAME_TYPE)+"_"+S.LIST_VARIABLE_TYPE,z=Z.valueToCode(Y,"ITEM",Z.ORDER_NONE)||0;return[`bool(${Q}.count(${z}))`,Z.ORDER_FUNCTION_CALL]};import{ScratchBlocks as r1} from"@blockcode/blocks-editor";Z.event_whenflagclicked=()=>{return`${Z.hatToCode("start")}runtime.when_start(${Z.HAT_FUNCTION_PLACEHOLDER})\n`};Z.event_whengreaterthan=(Y)=>{const Q=Y.getFieldValue("WHENGREATERTHANMENU"),z=Z.valueToCode(Y,"VALUE",Z.ORDER_NONE)||0;return`${Z.hatToCode("greaterthen")}runtime.when_greaterthen("${Q}", num(${z}), ${Z.HAT_FUNCTION_PLACEHOLDER})\n`};Z.event_whenbroadcastreceived=(Y)=>{const Q=Z.variableDB_.getName(Y.getFieldValue("BROADCAST_OPTION"),r1.Variables.NAME_TYPE);return`${Z.hatToCode("broadcastreceived")}runtime.when_broadcastreceived("${Q}", ${Z.HAT_FUNCTION_PLACEHOLDER})\n`};Z.event_broadcast_menu=(Y)=>{return[Z.variableDB_.getName(Y.getFieldValue("BROADCAST_OPTION"),r1.Variables.NAME_TYPE),Z.ORDER_ATOMIC]};Z.event_broadcast=(Y)=>{return`runtime.broadcast("${Z.valueToCode(Y,"BROADCAST_INPUT",Z.ORDER_NONE)||'"message1"'}")\n`};Z.event_broadcastandwait=(Y)=>{return`await runtime.broadcast("${Z.valueToCode(Y,"BROADCAST_INPUT",Z.ORDER_NONE)||'"message1"'}")\n`};Z.addReservedWords("math,random,Number");Z.math_number=(Y)=>{let Q=parseFloat(Y.getFieldValue("NUM")),z;if(Q===Infinity)Q='float("inf")',z=Z.ORDER_FUNCTION_CALL;else if(Q===(-Infinity))Q='-float("inf")',z=Z.ORDER_UNARY_SIGN;else if(Number.isNaN(Q))Q='float("nan")',z=Z.ORDER_UNARY_SIGN;else z=Q<0?Z.ORDER_UNARY_SIGN:Z.ORDER_ATOMIC;return[Q,z]};Z.math_integer=(Y)=>{const Q=parseInt(Y.getFieldValue("NUM")),z=Q<0?Z.ORDER_UNARY_SIGN:Z.ORDER_ATOMIC;return[Q,z]};Z.math_whole_number=(Y)=>{return[Math.abs(parseInt(Y.getFieldValue("NUM"))),Z.ORDER_ATOMIC]};Z.math_positive_number=(Y)=>{let Q=parseFloat(Y.getFieldValue("NUM")),z;if(Q===Infinity)Q='float("inf")',z=Z.ORDER_FUNCTION_CALL;else if(Q===(-Infinity))Q='-float("inf")',z=Z.ORDER_FUNCTION_CALL;else if(Number.isNaN(Q))Q='float("nan")',z=Z.ORDER_FUNCTION_CALL;else Q=Q<0?0:Q,z=Z.ORDER_ATOMIC;return[Q,z]};Z.math_angle=(Y)=>{let Q=parseFloat(Y.getFieldValue("NUM")),z;if(Q==Infinity)Q='float("inf")',z=Z.ORDER_FUNCTION_CALL;else if(Q==(-Infinity))Q='-float("inf")',z=Z.ORDER_UNARY_SIGN;else Q=Q%360,Q=Q<0?Q+360:Q,z=Z.ORDER_ATOMIC;return[Q,z]};Z.operator_add=(Y)=>{const Q=Z.valueToCode(Y,"NUM1",Z.ORDER_NONE)||0,z=Z.valueToCode(Y,"NUM2",Z.ORDER_NONE)||0;return[`(num(${Q}) + num(${z}))`,Z.ORDER_SUBTRACTION]};Z.operator_subtract=(Y)=>{const Q=Z.valueToCode(Y,"NUM1",Z.ORDER_NONE)||0,z=Z.valueToCode(Y,"NUM2",Z.ORDER_NONE)||0;return[`(num(${Q}) - num(${z}))`,Z.ORDER_SUBTRACTION]};Z.operator_multiply=(Y)=>{const Q=Z.valueToCode(Y,"NUM1",Z.ORDER_NONE)||0,z=Z.valueToCode(Y,"NUM2",Z.ORDER_NONE)||0;return[`(num(${Q}) * num(${z}))`,Z.ORDER_SUBTRACTION]};Z.operator_divide=(Y)=>{const Q=Z.valueToCode(Y,"NUM1",Z.ORDER_NONE)||0,z=Z.valueToCode(Y,"NUM2",Z.ORDER_NONE)||0;return[`(num(${Q}) / num(${z}))`,Z.ORDER_SUBTRACTION]};Z.operator_random=(Y)=>{const Q=Z.valueToCode(Y,"FROM",Z.ORDER_NONE)||0,z=Z.valueToCode(Y,"TO",Z.ORDER_NONE)||0;return[`runtime.random(${Q}, ${z})`,Z.ORDER_FUNCTION_CALL]};Z.operator_gt=(Y)=>{const Q=Z.valueToCode(Y,"OPERAND1",Z.ORDER_NONE)||0,z=Z.valueToCode(Y,"OPERAND2",Z.ORDER_NONE)||0;return[`(num(${Q}) > num(${z}))`,Z.ORDER_RELATIONAL]};Z.operator_lt=(Y)=>{const Q=Z.valueToCode(Y,"OPERAND1",Z.ORDER_NONE)||0,z=Z.valueToCode(Y,"OPERAND2",Z.ORDER_NONE)||0;return[`(num(${Q}) < num(${z}))`,Z.ORDER_RELATIONAL]};Z.operator_equals=(Y)=>{const Q=Z.valueToCode(Y,"OPERAND1",Z.ORDER_NONE)||0,z=Z.valueToCode(Y,"OPERAND2",Z.ORDER_NONE)||0;return[`(num(${Q}) == num(${z}) or str(${Q}) == str(${z}))`,Z.ORDER_RELATIONAL]};Z.operator_and=(Y)=>{const Q=Z.valueToCode(Y,"OPERAND1",Z.ORDER_NONE)||"False",z=Z.valueToCode(Y,"OPERAND2",Z.ORDER_NONE)||"False";return[`(${Q} and ${z})`,Z.ORDER_LOGICAL_AND]};Z.operator_or=(Y)=>{const Q=Z.valueToCode(Y,"OPERAND1",Z.ORDER_NONE)||"False",z=Z.valueToCode(Y,"OPERAND2",Z.ORDER_NONE)||"False";return[`(${Q} or ${z})`,Z.ORDER_LOGICAL_OR]};Z.operator_not=(Y)=>{return[`(not ${Z.valueToCode(Y,"OPERAND",Z.ORDER_NONE)||"False"})`,Z.ORDER_LOGICAL_NOT]};Z.operator_join=(Y)=>{const Q=Z.valueToCode(Y,"STRING1",Z.ORDER_NONE)||'""',z=Z.valueToCode(Y,"STRING2",Z.ORDER_NONE)||'""';return[`(str(${Q}) + str(${z}))`,Z.ORDER_ATOMIC]};Z.operator_letter_of=(Y)=>{const Q=Z.valueToCode(Y,"LETTER",Z.ORDER_NONE)||0;return[`(str(${Z.valueToCode(Y,"STRING",Z.ORDER_NONE)||'""'})[num(${Q}) - 1] || "")`,Z.ORDER_MEMBER]};Z.operator_length=(Y)=>{return[`len(str(${Z.valueToCode(Y,"STRING",Z.ORDER_NONE)||'""'}))`,Z.ORDER_FUNCTION_CALL]};Z.operator_contains=(Y)=>{const Q=Z.valueToCode(Y,"STRING1",Z.ORDER_NONE)||'""',z=Z.valueToCode(Y,"STRING2",Z.ORDER_NONE)||'""';return[`(str(${Q}).count(str(${z})) > 0)`,Z.ORDER_FUNCTION_CALL]};Z.operator_mod=(Y)=>{const Q=Z.valueToCode(Y,"NUM1",Z.ORDER_NONE)||0,z=Z.valueToCode(Y,"NUM2",Z.ORDER_NONE)||0;return[`(num(${Q}) % num(${z}))`,Z.ORDER_MODULUS]};Z.operator_round=(Y)=>{return Z.definitions_.import_math="import math",[`math.round(num(${Z.valueToCode(Y,"NUM",Z.ORDER_NONE)||0}))`,Z.ORDER_FUNCTION_CALL]};Z.operator_mathop=(Y)=>{Z.definitions_.import_math="import math";const Q=Z.valueToCode(Y,"NUM",Z.ORDER_NONE)||0,z=Y.getFieldValue("OPERATOR");let R="";if(z==="ceiling")R+=`math.ceil(num(${Q}))`;else if(z==="sin"||z==="cos"||z==="tan")R+=`math.${z}(math.radians(num(${Q})))`;else if(z==="asin"||z==="acos"||z==="atan")R+=`math.degrees(math.${z}(num(${Q})))`;else if(z==="ln")R+=`(math.log(num(${Q}))`;else if(z==="log")R+=`(math.log10(num(${Q}))`;else if(z==="e ^")R+=`math.exp(num(${Q}))`;else if(z==="10 ^")R+=`math.pow(10, num(${Q}))`;else R+=`math.${z}(num(${Q}))`;return[R,Z.ORDER_FUNCTION_CALL]};Z.procedures_definition=(Y)=>{};Z.procedures_call=(Y)=>{};Z.procedures_prototype=(Y)=>{};Z.procedures_declaration=(Y)=>{};Z.argument_reporter_boolean=(Y)=>{};Z.argument_reporter_string_number=(Y)=>{};Z.argument_editor_boolean=(Y)=>{};Z.argument_editor_string_number=(Y)=>{};Z.sensing_timer=()=>{return["runtime.time",Z.ORDER_MEMBER]};Z.sensing_resettimer=()=>{return"runtime.reset_timer()\n"};Z.text=(Y)=>{const Q=Y.getFieldValue("TEXT");return[Q.length===0||isNaN(Q)?Z.quote_(Q):+Q,Z.ORDER_ATOMIC]};import{useEffect as W6,useState as P1} from"preact/hooks";import{useLocale as H6,useLayout as q6,useEditor as H0} from"@blockcode/core";import{classNames as J6} from"@blockcode/ui";import{BlocksEditor as K6,ScratchBlocks as G,makeToolboxXML as U6} from"@blockcode/blocks-editor";import{ScratchBlocks as n1,blockSeparator as h0} from"@blockcode/blocks-editor";var d0=1,p0=2,i0=3,t1="#0FBD8C",o1="#0DA57A",s0="#0B8E69",Q1=(Y)=>{if(typeof Y!=="string")if(Array.isArray(Y))Y=String(Y);else return Y;return Y.replace(/[<>&'"]/g,(Q)=>{switch(Q){case"<":return"&lt;";case">":return"&gt;";case"&":return"&amp;";case"'":return"&apos;";case'"':return"&quot;"}})},e1={number:"math_number",angle:"math_angle",text:"text",string:"text",color:"colour_picker",matrix:"matrix",note:"note"},Z0={number:"NUM",angle:"NUM",text:"TEXT",string:"TEXT",matrix:"MATRIX",note:"NOTE"};function C1(Y,Q,z,R){const{id:J}=Y,$=z(Y.name);let K=`<category name="${Q1($)}" id="${Q1(J)}"`;if(K+=` colour="${Q1(Y.themeColor||t1)}"`,K+=` secondaryColour="${Q1(Y.inputColor||o1)}"`,Y.connectionConfig)K+=' showStatusButton="true"';if(Y.iconURI)K+=` iconURI="${Q1(Y.iconURI)}"`;return K+=">",Y.blocks.forEach((U)=>{if(U==="---"){K+=`${h0}`;return}if(U.button){K+=`<button text="${z(U.text)}" callbackKey="${U.button}"></button>`;const I=n1.getMainWorkspace();if(I){const _=I.getFlyout();if(_){const C=_.getWorkspace();if(C)C.registerButtonCallback(U.button,R(U.onClick))}}return}if(Q&&U.useStage===!1)return;if(!Q&&U.useSprite===!1)return;const N=`${J}_${U.id.toLowerCase()}`,X={message0:z(U.text),category:J,outputShape:i0,colour:Y.themeColor||t1,colourSecondary:Y.inputColor||o1,colourTertiary:Y.otherColor||s0};let v=1;if(Y.iconURI)X.message0=`%1 %2 ${X.message0}`,X.args0=[{type:"field_image",src:Y.iconURI,width:40,height:40},{type:"field_vertical_separator"}],X.extensions=["scratch_extension"],v+=2;if(U.hat)X.nextStatement=null;else if(U.output){if(U.output==="boolean")X.output="Boolean",X.outputShape=d0;else X.output="String",X.outputShape=p0;X.checkboxInFlyout=U.monitoring!==!1}else X.previousStatement=null,X.nextStatement=null;let B=`<block type="${Q1(N)}">`;if(U.inputs)X.checkboxInFlyout=!1,X.args0=[].concat(X.args0||[],Object.entries(U.inputs).map(([I,_])=>{const C={name:I,type:"input_value"};if(_.menu)C.type="field_dropdown",C.options=_.menu.map(([T,O])=>[z(T),O]);else if(_.type==="boolean")C.check="Boolean";else{if(B+=`<value name="${Q1(I)}">`,e1[_.type]){if(B+=`<shadow type="${e1[_.type]}">`,_.default&&Z0[_.type])B+=`<field name="${Z0[_.type]}">${Q1(z(_.default))}</field>`;B+="</shadow>"}B+="</value>"}return X.message0=X.message0.replace(`[${I}]`,`%${v++}`),C}));if(n1.Blocks[N]={init(){this.jsonInit(X)}},U.python)Z[N]=U.python.bind(Z);else Z[N]=()=>"";B+="</block>",K+=B}),K+="</category>",K}import{useRef as l0,useEffect as c0,useState as Y0} from"preact/hooks";import{classNames as a0,Text as J1,Button as Q0,Modal as r0,BufferedInput as n0} from"@blockcode/ui";function $1(Y){const Q=globalThis.document,z=Q.createElement("style");z.appendChild(Q.createTextNode(Y)),Q.head.append(z)}$1("._5SVWFW_prompt-modal{width:360px}._5SVWFW_prompt-content{background:var(--ui-white);padding:1.5rem 2.25rem}._5SVWFW_prompt-content input[type=checkbox],._5SVWFW_prompt-content input[type=radio]{margin:3px}._5SVWFW_label{margin:0 0 .75rem;font-weight:500}._5SVWFW_variable-name-text-input{border:1px solid var(--ui-black-transparent);color:var(--text-primary-transparent);border-radius:5px;width:100%;height:3rem;margin-bottom:1.5rem;padding:0 1rem;font-size:.875rem}._5SVWFW_info-message{text-align:center;margin-bottom:1.5rem;font-size:.875rem;font-weight:400}._5SVWFW_options{justify-content:space-between;margin-bottom:1.5rem;font-weight:400;display:flex}._5SVWFW_button-row{text-align:right;font-weight:bolder}._5SVWFW_button{padding:.75rem 1rem;font-size:.85rem;font-weight:600}._5SVWFW_ok-button{background:var(--motion-primary);border:var(--motion-primary);color:var(--ui-white);margin-left:var(--space)}");var c={promptContent:"_5SVWFW_prompt-content",options:"_5SVWFW_options",promptModal:"_5SVWFW_prompt-modal",buttonRow:"_5SVWFW_button-row",infoMessage:"_5SVWFW_info-message",button:"_5SVWFW_button",okButton:"_5SVWFW_ok-button",label:"_5SVWFW_label",variableNameTextInput:"_5SVWFW_variable-name-text-input"};import{jsx as f} from"preact/jsx-runtime";function v1({title:Y,label:Q,defaultValue:z,enableLocalVariable:R,showListMessage:J,showVariableOptions:$,showCloudOption:K,onClose:U,onSubmit:N}){const X=l0(null),[v,B]=Y0(z),[I,_]=Y0({scope:"global",isCloud:!1}),C=()=>{N(v,I)},T=(O)=>{if(O.key==="Escape")U();if(O.key==="Enter")N(X.current.base.value,I)};return c0(()=>{if(X.current)X.current.base.focus(),window.addEventListener("keydown",T);return()=>{window.removeEventListener("keydown",T)}},[X]),f(r0,{title:Y,className:c.promptModal,onClose:U,children:f("div",{className:c.promptContent,children:[f("div",{className:c.label,children:Q}),f(n0,{autoFocus:!0,forceFocus:!0,ref:X,className:c.variableNameTextInput,defaultValue:v,onSubmit:B}),$&&f("div",{children:R?f("div",{className:c.options,children:[f("label",{children:[f("input",{checked:I.scope==="global",name:"variableScopeOption",type:"radio",value:"global",onChange:()=>_({...I,scope:"global"})}),f(J1,{id:"blocks.dataPrompt.forAllTargets",defaultMessage:"For all targets"})]}),f("label",{children:[f("input",{checked:I.scope==="local",name:"variableScopeOption",type:"radio",value:"local",onChange:()=>_({...I,scope:"local"})}),f(J1,{id:"blocks.dataPrompt.forThisTarget",defaultMessage:"For this target only"})]})]}):f("div",{className:c.infoMessage,children:J?f(J1,{id:"blocks.dataPrompt.listAvailableToAllTargets",defaultMessage:"This list will be available to all targets."}):f(J1,{id:"blocks.dataPrompt.availableToAllTargets",defaultMessage:"This variable will be available to all targets."})})}),f("div",{className:c.buttonRow,children:[f(Q0,{className:c.button,onClick:U,children:f(J1,{id:"blocks.dataPrompt.cancel",defaultMessage:"Cancel"})}),f(Q0,{className:a0(c.button,c.okButton),onClick:C,children:f(J1,{id:"blocks.dataPrompt.ok",defaultMessage:"OK"})})]})]})})}import{useEffect as t0,useState as R0} from"preact/hooks";import{useLocale as o0,useLayout as e0,useEditor as Z6} from"@blockcode/core";import{Library as Y6} from"@blockcode/ui";var z0=["nes","translate","color-sensor","servo","time","pen","brain","request","text","broadcast"].map(async(Y)=>{const{default:Q}=await import(`@blockcode/extension-${Y}`);return Q.id=Y,Q});import{jsx as z6} from"preact/jsx-runtime";var Q6=Promise.all(z0);function g1({deviceId:Y,onSelect:Q,onClose:z,onFilter:R}){const[J,$]=R0([]),[K,U]=R0(!1),{language:N,getText:X}=o0(),{createAlert:v,removeAlert:B}=e0(),{addAsset:I}=Z6(),_=(C)=>{const T=C.tags||[];let O=["blocks",["dupont","data"],["3v3","5v"]];if(R)O=R(T);if(Array.isArray(O))return O.every((j)=>{if(Array.isArray(j))return j.some((x)=>T.includes(x));return T.includes(j)});return O};return t0(()=>{Q6.then((C)=>{$(C.filter(_).map((T)=>Object.assign({...T,featured:!0,onSelect:async()=>{v("importing",{id:T.id});let{default:O}=await import(`@blockcode/extension-${T.id}/blocks`);if(typeof O==="function")O=O(Y);if(O.id=T.id,O.files)O.files.forEach(async(j)=>{const x=`extensions/${T.id.replace(/[^a-z\d]/gi,"_")}/${j.name}`,a=await fetch(j.uri).then((t)=>t.text());I({...j,id:x,content:a})});Q(O),B(T.id),z()}},T.translations&&T.translations[N]?{name:T.translations[N].name||T.name,description:T.translations[N].description||T.description,collaborator:T.translations[N].collaborator||T.collaborator}:{}))),U(!1)})},[]),z6(Y6,{filterable:!0,loading:K,items:J,filterPlaceholder:X("gui.library.search","Search"),title:X("blocks.extensions.addExtension","Add Extension"),emptyText:X("blocks.extensions.empty","No extension!"),onClose:z})}$1(".cujmXa_editor-wrapper{border-radius:inherit;width:100%;height:100%;position:relative}.cujmXa_extension-button{z-index:var(--z-index-extension-button);background:var(--motion-primary);border:1px solid var(--motion-primary);box-sizing:content-box;border-bottom-left-radius:inherit;border-top:0;height:3.25rem;position:absolute;bottom:-1px;left:-1px}.cujmXa_extension-button:before{--fade-out-distance:15px;content:\"\";top:calc(calc(-1*var(--fade-out-distance)));height:var(--fade-out-distance);background:linear-gradient(#0000,#00000026);position:absolute;left:0;right:0}.cujmXa_add-button{cursor:pointer;background:0 0;border:none;outline:none;width:100%;height:100%}.cujmXa_add-button img{width:1.75rem;height:1.75rem}.cujmXa_debug-box{z-index:var(--z-index-monitor);border:1px solid var(--ui-tertiary);border-radius:var(--space)var(--space)0 0;opacity:.8;font-size:var(--standard-font-size);background:#fff;border-bottom:0;width:600px;height:300px;position:absolute;bottom:0;left:50vw;overflow:auto;transform:translate(-50%)}.cujmXa_debug-box pre{margin:calc(var(--space)/2)}");var F1={editorWrapper:"cujmXa_editor-wrapper",addButton:"cujmXa_add-button",debugBox:"cujmXa_debug-box",extensionButton:"cujmXa_extension-button"};var W0="./assets/icon-extension-5ec2ee35b87b4126.svg";import{jsx as z1,Fragment as $6} from"preact/jsx-runtime";var n=new Map,q0=(Y)=>typeof Y!=="string"&&!Y.button,A6=async(Y,Q,z,R,J)=>{if(Q){for(let $ of Q)if(!n.has($)){let{default:K}=await import(`@blockcode/extension-${$}/blocks`);if(typeof K==="function")K=K(Y);if(K.id=$,K.files)K.files.forEach(async(U)=>{const N=`extensions/${$}/${U.name}`,X=await fetch(U.uri).then((v)=>v.text());R({...U,id:N,content:X})});if(z(K.translations),J)J({...K,blocks:K.blocks.filter(q0)});n.set($,K)}}};function M1({toolbox:Y,messages:Q,enableMultiTargets:z,enableLocalVariable:R,disableGenerator:J,disableExtension:$,deviceId:K,onChange:U,onExtensionsFilter:N,onLoadExtension:X}){const{addLocaleData:v,getText:B,maybeLocaleText:I}=H6(),{splash:_,createPrompt:C,createAlert:T,removeAlert:O,setSplash:j}=q6(),{editor:x,fileList:a,selectedIndex:t,openFile:V1,modifyFile:K1,modifyAsset:D1,setModified:E1}=H0(),[o,F]=P1(),[W,q]=P1(!1),[H,A]=P1(!1),[V,D]=P1(!1);if(_){if(_===!0&&V===!1)n.clear(),D(setTimeout(()=>{D(A6(K,x.extensions,v,D1,X).then(()=>D(!0)))},100));if(V===!0){let P=!0;if(a.length>1){for(let E=0;E>-a.length;E--)if(!a.at(E).content){P=!1,setTimeout(()=>{V1((E+a.length)%a.length)},100);break}}if(P)setTimeout(()=>{j(!1),E1(!1)},100)}}Q={EVENT_WHENPROGRAMSTART:B("blocks.event.programStart","when program start"),CONTROL_STOP_OTHER:B("blocks.control.stopOther","other scripts"),...Q||[]},W6(()=>{G.prompt=(P,E,L,y,e)=>{const s={callback:L,message:P,defaultValue:E};s.title=y?y:G.Msg.VARIABLE_MODAL_TITLE,s.varType=typeof e==="string"?e:G.SCALAR_VARIABLE_TYPE,s.showVariableOptions=z&&e!==G.BROADCAST_MESSAGE_VARIABLE_TYPE&&s.title!==G.Msg.RENAME_VARIABLE_MODAL_TITLE&&s.title!==G.Msg.RENAME_LIST_MODAL_TITLE,s.showCloudOption=e===G.SCALAR_VARIABLE_TYPE&&this.props.canUseCloud,q(s)},G.FlyoutExtensionCategoryHeader.getExtensionState=(P)=>{if(n.has(P)){const E=n.get(P);if(E.connectionConfig?.items.every((L)=>localStorage.getItem(`${E.id}.connection.${L.id}`)))return G.StatusButtonState.READY}return G.StatusButtonState.NOT_READY},G.statusButtonCallback=(P)=>{if(!n.has(P))return;const E=n.get(P),{connectionConfig:L}=E;if(!L)return;C({title:E.name,label:L.title,inputMode:L.items.map((y)=>({name:y.id,placeholder:y.text,defaultValue:localStorage.getItem(`${E.id}.connection.${y.id}`)})),content:L.description,onSubmit:(y)=>{if(Object.entries(y).forEach(([e,s])=>{localStorage.setItem(`${E.id}.connection.${e}`,`${s}`)}),o)G.refreshStatusButtons(o)}})}},[o]);let w;if(o)w=o.getAllVariables().filter((P)=>{if(P.isLocal)return!1;if(P.type===G.BROADCAST_MESSAGE_VARIABLE_TYPE){if(P.name===G.Msg.DEFAULT_BROADCAST_MESSAGE_NAME)return!1;const E=P.id_.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),L=new RegExp(`<field name="BROADCAST_OPTION" id="${E}"[^>]+>[^<]+</field>`,"g");for(let y of a)if(L.test(y.xml))return!0;return!1}return!0});let h=Y||U6();const r=t===0,k=(P)=>P.bind(null,{context:H0(),createPrompt:C,createAlert:T,removeAlert:O});n.forEach((P)=>{h+=C1(P,r,I,k)});const d=(P,E)=>{let L;if(!J)L=Z.workspaceToCode(E);if(K1({xml:P,content:L}),U)U(P,E)},p=(P,E)=>{W.callback(P,[],E),q(!1)},g=()=>q(!1),i=()=>A(!0),u=()=>A(!1),M=(P)=>{if(!n.has(P.id)){if(v(P.translations),X)X({...P,blocks:P.blocks.filter(q0)});n.set(P.id,P)}setTimeout(()=>{o.toolbox_.setSelectedCategoryById(P.id)},100)};return z1($6,{children:[z1("div",{className:F1.editorWrapper,children:[z1(K6,{toolbox:h,messages:Q,globalVariables:w,onWorkspaceCreated:F,onChange:t!==-1?d:null}),$?null:z1("div",{className:J6("scratchCategoryMenu",F1.extensionButton),children:z1("button",{className:F1.addButton,title:B("blocks.extensions.addExtension","Add Extension"),onClick:i,children:z1("img",{src:W0,title:"Add Extension"})})}),W&&z1(v1,{title:W.title,label:W.message,defaultValue:W.defaultValue,enableLocalVariable:R,showListMessage:W.varType===G.LIST_VARIABLE_TYPE,showVariableOptions:W.showVariableOptions,showCloudOption:W.showCloudOption,onClose:g,onSubmit:p}),H&&z1(g1,{deviceId:K,onFilter:N,onSelect:M,onClose:u})]}),!1]})}var J0="./assets/icon-blocks-d7e4a3a3eb74d0fb.svg";var K0={"blocks.menu.file":"File","blocks.menu.file.newProject":"New","blocks.menu.file.openProject":"Open","blocks.menu.file.saveProject":"Save","blocks.menu.file.uploadProject":"Load from your computer","blocks.menu.file.downloadProject":"Save to your computer","blocks.menu.edit":"Edit","blocks.menu.edit.undo":"Undo","blocks.menu.edit.redo":"Redo","blocks.menu.device":"Device","blocks.menu.device.name":"device","blocks.menu.device.connect":"Connect to your {name}","blocks.menu.device.disconnect":"Disconnect this {name}","blocks.menu.device.download":"Download program","blocks.menu.device.turnOnAutoDownload":"Turn on Auto Download","blocks.menu.device.turnOffAutoDownload":"Turn off Auto Download","blocks.alert.downloading":"Downloading...{progress}%","blocks.alert.downloadCompleted":"Download completed.","blocks.codeTab":"Code","blocks.monitorPane.title":"Monitor","blocks.downloadToDevice":"Download","blocks.extensions.addExtension":"Add Extension","blocks.extensions.empty":"No extension!","blocks.dataPrompt.forAllTargets":"For all targets","blocks.dataPrompt.forThisTarget":"For this target only","blocks.dataPrompt.availableToAllTargets":"This variable will be available to all targets.","blocks.dataPrompt.listAvailableToAllTargets":"This list will be available to all targets.","blocks.dataPrompt.cancel":"Cancel","blocks.dataPrompt.ok":"OK","blocks.event.programStart":"when program start","blocks.control.stopOther":"other scripts"};var U0={"blocks.menu.file":"\u6587\u4EF6","blocks.menu.file.newProject":"\u65B0\u4F5C\u54C1","blocks.menu.file.openProject":"\u6253\u5F00","blocks.menu.file.saveProject":"\u4FDD\u5B58","blocks.menu.file.uploadProject":"\u4ECE\u7535\u8111\u4E2D\u6253\u5F00","blocks.menu.file.downloadProject":"\u4FDD\u5B58\u5230\u7535\u8111","blocks.menu.edit":"\u7F16\u8F91","blocks.menu.edit.undo":"\u64A4\u9500","blocks.menu.edit.redo":"\u6062\u590D","blocks.menu.device":"\u8BBE\u5907","blocks.menu.device.name":"\u8BBE\u5907","blocks.menu.device.connect":"\u8FDE\u63A5{name}","blocks.menu.device.disconnect":"\u65AD\u5F00{name}\u8FDE\u63A5","blocks.menu.device.download":"\u4E0B\u8F7D\u7A0B\u5E8F","blocks.menu.device.turnOnAutoDownload":"\u6253\u5F00\u81EA\u52A8\u4E0B\u8F7D","blocks.menu.device.turnOffAutoDownload":"\u5173\u95ED\u81EA\u52A8\u4E0B\u8F7D","blocks.alert.downloading":"\u6B63\u5728\u4E0B\u8F7D\u2026{progress}%","blocks.alert.downloadCompleted":"\u4E0B\u8F7D\u5B8C\u6210\u3002","blocks.codeTab":"\u4EE3\u7801","blocks.monitorPane.title":"\u76D1\u89C6\u5668","blocks.downloadToDevice":"\u4E0B\u8F7D","blocks.extensions.addExtension":"\u6DFB\u52A0\u6269\u5C55","blocks.extensions.empty":"\u6CA1\u6709\u6269\u5C55\uFF01","blocks.dataPrompt.forAllTargets":"\u9002\u7528\u4E8E\u5168\u5C40","blocks.dataPrompt.forThisTarget":"\u4EC5\u9002\u7528\u4E8E\u5F53\u524D","blocks.dataPrompt.availableToAllTargets":"\u5168\u5C40\u90FD\u53EF\u4F7F\u7528\u8BE5\u53D8\u91CF\u3002","blocks.dataPrompt.listAvailableToAllTargets":"\u5168\u5C40\u90FD\u53EF\u4F7F\u7528\u8BE5\u5217\u8868\u3002","blocks.dataPrompt.cancel":"\u53D6\u6D88","blocks.dataPrompt.ok":"\u786E\u5B9A","blocks.event.programStart":"\u5F53\u7A0B\u5E8F\u5F00\u59CB\u8FD0\u884C","blocks.control.stopOther":"\u5176\u4ED6\u811A\u672C"};import{jsx as $0} from"preact/jsx-runtime";var F6={en:K0,"zh-Hans":U0},P6={icon:J0,label:$0(A0,{id:"blocks.codeTab",defaultMessage:"Code"}),Content:M1},U8={label:$0(A0,{id:"blocks.monitorPane.title",defaultMessage:"Monitor"}),Content:null};function M6({addLocaleData:Y,createLayout:Q,openProject:z,project:R}){Y(F6);const J=($)=>{z(Object.assign({selectedIndex:0},$||a1))};J(R),Q({mainMenu:S1({onNew:J}),tabs:[{...P6,Content:M1}],sidebars:[],pane:!1,tutorials:!0,canEditProjectName:!0})}export{Z as pythonGenerator,U8 as monitorPane,S1 as makeMainMenu,F6 as locales,M6 as default,P6 as codeTab};
