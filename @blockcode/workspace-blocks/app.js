var lt=Object.create;var{defineProperty:b1,getPrototypeOf:nt,getOwnPropertyNames:Ot}=Object;var At=Object.prototype.hasOwnProperty;var Mt=(a,u,E)=>{E=a!=null?lt(nt(a)):{};const T=u||!a||!a.__esModule?b1(E,"default",{value:a,enumerable:!0}):E;for(let o of Ot(a))if(!At.call(T,o))b1(T,o,{get:()=>a[o],enumerable:!0});return T};var St=(a,u)=>()=>(u||a((u={exports:{}}).exports,u),u.exports);var W1=St((S1)=>{(function(){var a=typeof S1!="undefined"&&S1||typeof define!="undefined"&&{}||this||window;if(typeof define!=="undefined")define("save-svg-as-png",[],function(){return a});a.default=a;var u="http://www.w3.org/2000/xmlns/",E="http://www.w3.org/1999/xhtml",T="http://www.w3.org/2000/svg",o='<?xml version="1.0" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd" [<!ENTITY nbsp "&#160;">]>',R=/url\(["']?(.+?)["']?\)/,_={woff2:"font/woff2",woff:"font/woff",otf:"application/x-font-opentype",ttf:"application/x-font-ttf",eot:"application/vnd.ms-fontobject",sfnt:"application/font-sfnt",svg:"image/svg+xml"},C=function s(d){return d instanceof HTMLElement||d instanceof SVGElement},A=function s(d){if(!C(d))throw new Error("an HTMLElement or SVGElement is required; got "+d)},r=function s(d){return new Promise(function(N,i){if(C(d))N(d);else i(new Error("an HTMLElement or SVGElement is required; got "+d))})},w=function s(d){return d&&d.lastIndexOf("http",0)===0&&d.lastIndexOf(window.location.host)===-1},p=function s(d){var N=Object.keys(_).filter(function(i){return d.indexOf("."+i)>0}).map(function(i){return _[i]});if(N)return N[0];return console.error("Unknown font format for "+d+". Fonts may not be working correctly."),"application/octet-stream"},D=function s(d){var N="",i=new Uint8Array(d);for(var m=0;m<i.byteLength;m++)N+=String.fromCharCode(i[m]);return window.btoa(N)},I=function s(d,N,i){var m=d.viewBox&&d.viewBox.baseVal&&d.viewBox.baseVal[i]||N.getAttribute(i)!==null&&!N.getAttribute(i).match(/%$/)&&parseInt(N.getAttribute(i))||d.getBoundingClientRect()[i]||parseInt(N.style[i])||parseInt(window.getComputedStyle(d).getPropertyValue(i));return typeof m==="undefined"||m===null||isNaN(parseFloat(m))?0:m},f=function s(d,N,i,m){if(d.tagName==="svg")return{width:i||I(d,N,"width"),height:m||I(d,N,"height")};else if(d.getBBox){var O=d.getBBox(),S=O.x,F=O.y,B=O.width,k=O.height;return{width:S+B,height:F+k}}},l=function s(d){return decodeURIComponent(encodeURIComponent(d).replace(/%([0-9A-F]{2})/g,function(N,i){var m=String.fromCharCode("0x"+i);return m==="%"?"%25":m}))},M=function s(d){var N=window.atob(d.split(",")[1]),i=d.split(",")[0].split(":")[1].split(";")[0],m=new ArrayBuffer(N.length),O=new Uint8Array(m);for(var S=0;S<N.length;S++)O[S]=N.charCodeAt(S);return new Blob([m],{type:i})},V=function s(d,N){if(!N)return;try{return d.querySelector(N)||d.parentNode&&d.parentNode.querySelector(N)}catch(i){console.warn('Invalid CSS selector "'+N+'"',i)}},j=function s(d,N){var i=d.cssText.match(R),m=i&&i[1]||"";if(!m||m.match(/^data:/)||m==="about:blank")return;var O=m.startsWith("../")?N+"/../"+m:m.startsWith("./")?N+"/."+m:m;return{text:d.cssText,format:p(O),url:O}},c=function s(d){return Promise.all(Array.from(d.querySelectorAll("image")).map(function(N){var i=N.getAttributeNS("http://www.w3.org/1999/xlink","href")||N.getAttribute("href");if(!i)return Promise.resolve(null);if(w(i))i+=(i.indexOf("?")===-1?"?":"&")+"t="+(new Date()).valueOf();return new Promise(function(m,O){var S=document.createElement("canvas"),F=new Image;F.crossOrigin="anonymous",F.src=i,F.onerror=function(){return O(new Error("Could not load "+i))},F.onload=function(){S.width=F.width,S.height=F.height,S.getContext("2d").drawImage(F,0,0),N.setAttributeNS("http://www.w3.org/1999/xlink","href",S.toDataURL("image/png")),m(!0)}})}))},H={},Z=function s(d){return Promise.all(d.map(function(N){return new Promise(function(i,m){if(H[N.url])return i(H[N.url]);var O=new XMLHttpRequest;O.addEventListener("load",function(){var S=D(O.response),F=N.text.replace(R,'url("data:'+N.format+";base64,"+S+'")')+"\n";H[N.url]=F,i(F)}),O.addEventListener("error",function(S){console.warn("Failed to load font from: "+N.url,S),H[N.url]=null,i(null)}),O.addEventListener("abort",function(S){console.warn("Aborted loading font from: "+N.url,S),i(null)}),O.open("GET",N.url),O.responseType="arraybuffer",O.send()})})).then(function(N){return N.filter(function(i){return i}).join("")})},y=null,u1=function s(){if(y)return y;return y=Array.from(document.styleSheets).map(function(d){try{return{rules:d.cssRules,href:d.href}}catch(N){return console.warn("Stylesheet could not be loaded: "+d.href,N),{}}})},A1=function s(d,N){var i=N||{},m=i.selectorRemap,O=i.modifyStyle,S=i.modifyCss,F=i.fonts,B=i.excludeUnusedCss,k=S||function(v,h){var $=m?m(v):v,n=O?O(h):h;return $+"{"+n+"}\n"},W=[],K=typeof F==="undefined",z=F||[];return u1().forEach(function(v){var{rules:h,href:$}=v;if(!h)return;Array.from(h).forEach(function(n){if(typeof n.style!="undefined"){if(V(d,n.selectorText))W.push(k(n.selectorText,n.style.cssText));else if(K&&n.cssText.match(/^@font-face/)){var e=j(n,$);if(e)z.push(e)}else if(!B)W.push(n.cssText)}})}),Z(z).then(function(v){return W.join("\n")+v})},G=function s(){if(!navigator.msSaveOrOpenBlob&&!("download"in document.createElement("a")))return{popup:window.open()}};a.prepareSvg=function(s,d,N){A(s);var i=d||{},m=i.left,O=m===void 0?0:m,S=i.top,F=S===void 0?0:S,B=i.width,k=i.height,W=i.scale,K=W===void 0?1:W,z=i.responsive,v=z===void 0?!1:z,h=i.excludeCss,$=h===void 0?!1:h;return c(s).then(function(){var n=s.cloneNode(!0);n.style.backgroundColor=(d||{}).backgroundColor||s.style.backgroundColor;var e=f(s,n,B,k),g=e.width,L=e.height;if(s.tagName!=="svg")if(s.getBBox){if(n.getAttribute("transform")!=null)n.setAttribute("transform",n.getAttribute("transform").replace(/translate\(.*?\)/,""));var U=document.createElementNS("http://www.w3.org/2000/svg","svg");U.appendChild(n),n=U}else{console.error("Attempted to render non-SVG element",s);return}if(n.setAttribute("version","1.1"),n.setAttribute("viewBox",[O,F,g,L].join(" ")),!n.getAttribute("xmlns"))n.setAttributeNS(u,"xmlns",T);if(!n.getAttribute("xmlns:xlink"))n.setAttributeNS(u,"xmlns:xlink","http://www.w3.org/1999/xlink");if(v)n.removeAttribute("width"),n.removeAttribute("height"),n.setAttribute("preserveAspectRatio","xMinYMin meet");else n.setAttribute("width",g*K),n.setAttribute("height",L*K);if(Array.from(n.querySelectorAll("foreignObject > *")).forEach(function(e1){e1.setAttributeNS(u,"xmlns",e1.tagName==="svg"?T:E)}),$){var t1=document.createElement("div");t1.appendChild(n);var J=t1.innerHTML;if(typeof N==="function")N(J,g,L);else return{src:J,width:g,height:L}}else return A1(s,d).then(function(e1){var M1=document.createElement("style");M1.setAttribute("type","text/css"),M1.innerHTML="<![CDATA[\n"+e1+"\n]]>";var V1=document.createElement("defs");V1.appendChild(M1),n.insertBefore(V1,n.firstChild);var U1=document.createElement("div");U1.appendChild(n);var X1=U1.innerHTML.replace(/NS\d+:href/gi,'xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href');if(typeof N==="function")N(X1,g,L);else return{src:X1,width:g,height:L}})})},a.svgAsDataUri=function(s,d,N){return A(s),a.prepareSvg(s,d).then(function(i){var{src:m,width:O,height:S}=i,F="data:image/svg+xml;base64,"+window.btoa(l(o+m));if(typeof N==="function")N(F,O,S);return F})},a.svgAsPngUri=function(s,d,N){A(s);var i=d||{},m=i.encoderType,O=m===void 0?"image/png":m,S=i.encoderOptions,F=S===void 0?0.8:S,B=i.canvg,k=function W(K){var{src:z,width:v,height:h}=K,$=document.createElement("canvas"),n=$.getContext("2d"),e=window.devicePixelRatio||1;if($.width=v*e,$.height=h*e,$.style.width=$.width+"px",$.style.height=$.height+"px",n.setTransform(e,0,0,e,0,0),B)B($,z);else n.drawImage(z,0,0);var g=void 0;try{g=$.toDataURL(O,F)}catch(L){if(typeof SecurityError!=="undefined"&&L instanceof SecurityError||L.name==="SecurityError"){console.error("Rendered SVG images cannot be downloaded in this browser.");return}else throw L}if(typeof N==="function")N(g,$.width,$.height);return Promise.resolve(g)};if(B)return a.prepareSvg(s,d).then(k);else return a.svgAsDataUri(s,d).then(function(W){return new Promise(function(K,z){var v=new Image;v.onload=function(){return K(k({src:v,width:v.width,height:v.height}))},v.onerror=function(){z("There was an error loading the data URI as an image on the following SVG\n"+window.atob(W.slice(26))+"Open the following link to see browser\'s diagnosis\n"+W)},v.src=W})})},a.download=function(s,d,N){if(navigator.msSaveOrOpenBlob)navigator.msSaveOrOpenBlob(M(d),s);else{var i=document.createElement("a");if("download"in i){i.download=s,i.style.display="none",document.body.appendChild(i);try{var m=M(d),O=URL.createObjectURL(m);i.href=O,i.onclick=function(){return requestAnimationFrame(function(){return URL.revokeObjectURL(O)})}}catch(S){console.error(S),console.warn("Error while getting object URL. Falling back to string URL."),i.href=d}i.click(),document.body.removeChild(i)}else if(N&&N.popup)N.popup.document.title=s,N.popup.location.replace(d)}},a.saveSvg=function(s,d,N){var i=G();return r(s).then(function(m){return a.svgAsDataUri(m,N||{})}).then(function(m){return a.download(d,m,i)})},a.saveSvgAsPng=function(s,d,N){var i=G();return r(s).then(function(m){return a.svgAsPngUri(m,N||{})}).then(function(m){return a.download(d,m,i)})}})()});import{Text as et} from"@blockcode/ui";import{Text as c1} from"@blockcode/ui";var H1=Mt(W1(),1);import{Keys as a1,useLayout as gt,useEditor as It} from"@blockcode/core";import{Text as d1,MenuSection as Y1,MenuItem as C1} from"@blockcode/ui";import{ScratchBlocks as ft} from"@blockcode/blocks-editor";import{jsx as Q,jsxs as I1,Fragment as Ft} from"preact/jsx-runtime";var g1=/Mac/i.test(navigator.platform||navigator.userAgent);function f1({itemClassName:a,onNew:u,onOpen:E,onSave:T,children:o}){const{createPrompt:R,setStoreLibrary:_}=gt(),{modified:C,saveNow:A,saveToComputer:r,openFromComputer:w}=It(),p=async()=>{let D,I;const f=ft.getMainWorkspace();if(f)D=await H1.svgAsDataUri(f.getCanvas(),{}),I=Array.from(new Set(Object.values(f.blockDB_).filter((l)=>["nes","translate","color-sensor","servo","time","pen","brain","request","text","broadcast"].find((M)=>M===l.category_)).map((l)=>l.category_)));return(l)=>{const M={thumb:D,...l,...T?T():{},editor:{...l.editor,extensions:I}};if(M.assetList)M.assetList=M.assetList.filter((V)=>!V.id.startsWith("extensions/"));return M.fileList=M.fileList.map(({content:V,script:j,...c})=>c),M}};return I1(Ft,{children:[I1(Y1,{children:[Q(C1,{className:a,label:Q(d1,{id:"blocks.menu.file.newProject",defaultMessage:"New"}),hotkey:[g1?a1.COMMAND:a1.CONTROL,a1.N],onClick:()=>{if(C)R({title:Q(d1,{id:"gui.projects.notSaved",defaultMessage:"Not saved"}),label:Q(d1,{id:"gui.projects.replaceProject",defaultMessage:"Replace contents of the current project?"}),onSubmit:u});else u()}}),Q(C1,{className:a,label:Q(d1,{id:"blocks.menu.file.openProject",defaultMessage:"Open"}),hotkey:[g1?a1.COMMAND:a1.CONTROL,a1.O],onClick:()=>_(!0)}),Q(C1,{className:a,label:Q(d1,{id:"blocks.menu.file.saveProject",defaultMessage:"Save"}),hotkey:[g1?a1.COMMAND:a1.CONTROL,a1.S],onClick:async()=>A(await p())})]}),I1(Y1,{children:[Q(C1,{className:a,label:Q(d1,{id:"blocks.menu.file.uploadProject",defaultMessage:"Load from your computer"}),onClick:()=>w(E)}),Q(C1,{className:a,label:Q(d1,{id:"blocks.menu.file.downloadProject",defaultMessage:"save to your computer"}),onClick:async()=>r(await p())})]}),o]})}import{useEffect as Lt,useState as F1} from"preact/hooks";import{Keys as E1} from"@blockcode/core";import{Text as Z1,MenuSection as Dt,MenuItem as B1} from"@blockcode/ui";import{ScratchBlocks as pt} from"@blockcode/blocks-editor";import{jsx as s1,jsxs as z1,Fragment as ct} from"preact/jsx-runtime";var K1=/Mac/i.test(navigator.platform||navigator.userAgent);function L1({itemClassName:a,children:u}){const[E,T]=F1(!0),[o,R]=F1(!0),[_,C]=F1(null),A=pt.getMainWorkspace();if(A){if(_?.id!==A.id)C(A)}return Lt(()=>{if(_)_.addChangeListener(()=>{T(_.undoStack_.length===0),R(_.redoStack_.length===0)}),T(_.undoStack_.length===0),R(_.redoStack_.length===0)},[_]),z1(ct,{children:[z1(Dt,{children:[s1(B1,{disabled:E,className:a,label:s1(Z1,{id:"blocks.menu.edit.undo",defaultMessage:"Undo"}),hotkey:[K1?E1.COMMAND:E1.CONTROL,E1.Z],onClick:async(r)=>{if(r instanceof MouseEvent&&_)_.undo(!1)}}),s1(B1,{disabled:o,className:a,label:s1(Z1,{id:"blocks.menu.edit.redo",defaultMessage:"Redo"}),hotkey:K1?[E1.SHIFT,E1.COMMAND,E1.Z]:[E1.CONTROL,E1.Y],onClick:async(r)=>{if(r instanceof MouseEvent&&_)_.undo(!0)}})]}),u]})}import{useState as Pt} from"preact/hooks";import{useLocale as vt,useLayout as $t,useEditor as wt} from"@blockcode/core";import{Text as D1,Spinner as Vt,MenuSection as Ut,MenuItem as Xt} from"@blockcode/ui";import{connectDevice as bt,disconnectDevice as B0,writeFiles as Wt,configDevice as Yt,showDownloadScreen as Ht} from"@blockcode/device-pyboard";var h1=[{usbVendorId:12346},{usbVendorId:11914}];import{jsx as i1,jsxs as Bt,Fragment as Zt} from"preact/jsx-runtime";function p1({itemClassName:a,deviceName:u,deviceFilters:E,downloadScreen:T,onDownload:o,children:R}){const[_,C]=Pt(!1),{maybeLocaleText:A}=vt(),{createAlert:r,removeAlert:w}=$t(),{key:p,name:D,fileList:I,assetList:f,device:l,setDevice:M}=wt(),V=()=>C(!1),j=()=>C(!0),c=(Z)=>{if(!c.id)c.id=`download.${Date.now()}`,j();if(Z<100)r({id:c.id,icon:i1(Vt,{level:"success"}),message:i1(D1,{id:"blocks.alert.downloading",defaultMessage:"Downloading...{progress}%",progress:Z})});else r({id:c.id,icon:null,message:i1(D1,{id:"blocks.alert.downloadCompleted",defaultMessage:"Download completed."})}),setTimeout(H,1000)},H=()=>{w(c.id),V(),delete c.id};return Bt(Zt,{children:[i1(Ut,{children:i1(Xt,{disabled:_,className:a,label:i1(D1,{id:"blocks.menu.device.download",defaultMessage:"Download program"}),onClick:async()=>{if(c.id)return;try{const Z=l||await bt(E||h1,M);if(T)await Ht(Z,T);let y=o?o(D,I,f):[].concat(f);y=y.map((u1)=>({...u1,id:u1.id[0]!=="_"?`proj${p}/${u1.id}`:u1.id})),await Wt(Z,y,c),await Yt(Z,{"latest-project":p}),Z.hardReset()}catch(Z){H()}}})}),R]})}var J1="./assets/icon-file-1def53419f4ad0ae.svg";var Q1="./assets/icon-edit-2b1e47b495524ed2.svg";var q1="./assets/icon-device-c2fafab2eaccf043.svg";import{jsx as N1} from"preact/jsx-runtime";function P1({deviceName:a,deviceFilters:u,createProject:E,openProject:T,saveProject:o,downloadProjectToDevice:R,showDownloadScreen:_}){return[{icon:J1,label:N1(c1,{id:"blocks.menu.file",defaultMessage:"File"}),Menu:({itemClassName:C,children:A})=>N1(f1,{itemClassName:C,onNew:E,onOpen:T,onSave:o,children:A})},{icon:Q1,label:N1(c1,{id:"blocks.menu.edit",defaultMessage:"Edit"}),Menu:({itemClassName:C,children:A})=>N1(L1,{itemClassName:C,children:A})},{icon:q1,label:N1(c1,{id:"blocks.menu.device",defaultMessage:"Device"}),Menu:({itemClassName:C,children:A})=>N1(p1,{deviceName:a,itemClassName:C,deviceFilters:u,downloadScreen:_,onDownload:R,children:A})}]}var j1=`code_${Date.now().toString(36)}`,Jt=`
from popsicle.blocks import *
import ${j1}
run()
`,k1={assetList:[{id:"main",type:"text/x-python",content:Jt}],fileList:[{id:j1,type:"text/x-python"}]};import{ScratchBlocks as Y} from"@blockcode/blocks-editor";var t=new Y.Generator("Python");t.addReservedWords("False,None,True,and,as,assert,break,class,continue,def,del,elif,else,except,exec,finally,for,from,global,if,import,in,is,lambda,nonlocal,not,or,pass,print,raise,return,try,while,with,yield,NotImplemented,Ellipsis,__debug__,quit,exit,copyright,license,credits,ArithmeticError,AssertionError,AttributeError,BaseException,BlockingIOError,BrokenPipeError,BufferError,BytesWarning,ChildProcessError,ConnectionAbortedError,ConnectionError,ConnectionRefusedError,ConnectionResetError,DeprecationWarning,EOFError,Ellipsis,EnvironmentError,Exception,FileExistsError,FileNotFoundError,FloatingPointError,FutureWarning,GeneratorExit,IOError,ImportError,ImportWarning,IndentationError,IndexError,InterruptedError,IsADirectoryError,KeyError,KeyboardInterrupt,LookupError,MemoryError,ModuleNotFoundError,NameError,NotADirectoryError,NotImplemented,NotImplementedError,OSError,OverflowError,PendingDeprecationWarning,PermissionError,ProcessLookupError,RecursionError,ReferenceError,ResourceWarning,RuntimeError,RuntimeWarning,StandardError,StopAsyncIteration,StopIteration,SyntaxError,SyntaxWarning,SystemError,SystemExit,TabError,TimeoutError,TypeError,UnboundLocalError,UnicodeDecodeError,UnicodeEncodeError,UnicodeError,UnicodeTranslateError,UnicodeWarning,UserWarning,ValueError,Warning,ZeroDivisionError,_,__build_class__,__debug__,__doc__,__import__,__loader__,__name__,__package__,__spec__,abs,all,any,apply,ascii,basestring,bin,bool,buffer,bytearray,bytes,callable,chr,classmethod,cmp,coerce,compile,complex,copyright,credits,delattr,dict,dir,divmod,enumerate,eval,exec,execfile,exit,file,filter,float,format,frozenset,getattr,globals,hasattr,hash,help,hex,id,input,int,intern,isinstance,issubclass,iter,len,license,list,locals,long,map,max,memoryview,min,next,object,oct,open,ord,pow,print,property,quit,range,raw_input,reduce,reload,repr,reversed,round,set,setattr,slice,sorted,staticmethod,str,sum,super,tuple,type,unichr,unicode,vars,xrange,zip");t.ORDER_ATOMIC=0;t.ORDER_COLLECTION=1;t.ORDER_STRING_CONVERSION=1;t.ORDER_MEMBER=2.1;t.ORDER_FUNCTION_CALL=2.2;t.ORDER_EXPONENTIATION=3;t.ORDER_UNARY_SIGN=4;t.ORDER_BITWISE_NOT=4;t.ORDER_MULTIPLICATIVE=5;t.ORDER_ADDITIVE=6;t.ORDER_BITWISE_SHIFT=7;t.ORDER_BITWISE_AND=8;t.ORDER_BITWISE_XOR=9;t.ORDER_BITWISE_OR=10;t.ORDER_RELATIONAL=11;t.ORDER_LOGICAL_NOT=12;t.ORDER_LOGICAL_AND=13;t.ORDER_LOGICAL_OR=14;t.ORDER_CONDITIONAL=15;t.ORDER_LAMBDA=16;t.ORDER_NONE=99;t.ORDER_OVERRIDES=[[t.ORDER_FUNCTION_CALL,t.ORDER_MEMBER],[t.ORDER_FUNCTION_CALL,t.ORDER_FUNCTION_CALL],[t.ORDER_MEMBER,t.ORDER_MEMBER],[t.ORDER_MEMBER,t.ORDER_FUNCTION_CALL],[t.ORDER_LOGICAL_NOT,t.ORDER_LOGICAL_NOT],[t.ORDER_LOGICAL_AND,t.ORDER_LOGICAL_AND],[t.ORDER_LOGICAL_OR,t.ORDER_LOGICAL_OR]];t.init=(a)=>{if(t.PASS=t.INDENT+"pass\n",t.definitions_=Object.create(null),t.functionNames_=Object.create(null),!t.variableDB_)t.variableDB_=new Y.Names(t.RESERVED_WORDS_);else t.variableDB_.reset();t.variableDB_.setVariableMap(a.getVariableMap());const u=[],E=a.getAllVariables();for(let o=0;o<E.length;o++){if(E[o].type===Y.BROADCAST_MESSAGE_VARIABLE_TYPE)continue;let R=t.variableDB_.getName(E[o].getId(),Y.Variables.NAME_TYPE),_="";if(E[o].type===Y.LIST_VARIABLE_TYPE)R=`${R}_${Y.LIST_VARIABLE_TYPE}`,_="[]";u.push(`${R} = ${_}`)}const T=Y.Variables.allDeveloperVariables(a);for(let o=0;o<T.length;o++){let R=t.variableDB_.getName(T[o],Y.Names.DEVELOPER_VARIABLE_TYPE),_="";if(E[o].type===Y.LIST_VARIABLE_TYPE)R=`${R}_${Y.LIST_VARIABLE_TYPE}`,_="[]";u.push(`${R} = ${_}`)}if(u.length)t.definitions_.variables=u.join("\n");t.definitions_.import_blocks="from blocks import *"};t.finish=(a)=>{const u=[],E=[];for(let o in t.definitions_){const R=t.definitions_[o];if(R.match(/^(from\s+\S+\s+)?import\s+\S+/))u.push(R);else E.push(R)}return delete t.definitions_,delete t.functionNames_,t.variableDB_.reset(),(u.join("\n")+"\n\n"+E.join("\n\n")).replace(/\n\n+/g,"\n\n").replace(/\n*$/,"\n\n\n")+a};t.scrubNakedValue=(a)=>{return a+"\n"};t.quote_=(a)=>{let u='"';if(a.indexOf('"')!==-1)if(a.indexOf("'")===-1)u="'";else a=a.replace(/"/g,'\\"');return u+a+u};t.scrub_=(a,u)=>{let E="";if(!a.outputConnection?.targetConnection){let T=a.getCommentText();if(T=Y.utils.wrap(T,t.COMMENT_WRAP-3),T)if(a.getProcedureDef)E+='"""'+T+'\n"""\n';else E+=t.prefixLines(T+"\n","# ");for(let o=0;o<a.inputList.length;o++)if(a.inputList[o].type==Y.INPUT_VALUE){const R=a.inputList[o].connection.targetBlock();if(R){const _=t.allNestedComments(R);if(_)E+=t.prefixLines(_,"# ")}}}if(a.startHat_){const T=a.nextConnection&&a.nextConnection.targetBlock();let o=t.blockToCode(T);if(o)o=t.prefixLines(o,t.INDENT),u=u.replace(`\n${t.PASS}`,`\n${o}`);return E+u}if(a.parentBlock_){const T=a.nextConnection&&a.nextConnection.targetBlock(),o=t.blockToCode(T);return E+u+o}};t.getAdjustedInt=(a,u,E,T)=>{let o=E||0;if(a.workspace.options.oneBasedIndex)o--;const R=a.workspace.options.oneBasedIndex?"1":"0",_=o?t.ORDER_ADDITIVE:t.ORDER_NONE;let C=t.valueToCode(a,u,_)||R;if(Y.isNumber(C)){if(C=parseInt(C,10)+o,T)C=-C}else{if(o>0)C="int("+C+" + "+o+")";else if(o<0)C="int("+C+" - "+-o+")";else C="int("+C+")";if(T)C="-"+C}return C};t.hatToCode=(a="",...u)=>{if(!t.functionNames_[a])t.functionNames_[a]=0;t.functionNames_[a]+=1;const E=`${a}_${t.functionNames_[a]}`;return t.HAT_FUNCTION_PLACEHOLDER=E,`async def ${E}(${u.join(", ")}):\n  this_func = ${E}\n${t.PASS}\n`};var Qt=(a)=>{const u=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;a=a.replace(u,(T,o,R,_)=>o+o+R+R+_+_);const E=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(a);return E?{r:parseInt(E[1],16),g:parseInt(E[2],16),b:parseInt(E[3],16)}:null};t.colour_picker=(a)=>{const{r:u,g:E,b:T}=Qt(a.getFieldValue("COLOUR"));return[`(${u}, ${E}, ${T})`,t.ORDER_ATOMIC]};var m1="  await runtime.next_frame()\n";t.control_wait=(a)=>{let u="";if(t.STATEMENT_PREFIX)u+=t.injectId(t.STATEMENT_PREFIX,a);const E=t.valueToCode(a,"DURATION",t.ORDER_NONE)||0;return u+=`await runtime.wait_for(num(${E}))\n`,u};t.control_repeat=(a)=>{let u="";if(t.STATEMENT_PREFIX)u+=t.injectId(t.STATEMENT_PREFIX,a);let E=t.statementToCode(a,"SUBSTACK")||t.PASS;if(t.STATEMENT_SUFFIX)E=t.prefixLines(t.injectId(t.STATEMENT_SUFFIX,a),t.INDENT)+E;const T=t.valueToCode(a,"TIMES",t.ORDER_NONE)||10;return u+=`for _ in range(num(${T})):\n${E}${m1}`,u};t.control_forever=(a)=>{let u="";if(t.STATEMENT_PREFIX)u+=t.injectId(t.STATEMENT_PREFIX,a);let E=t.statementToCode(a,"SUBSTACK")||t.PASS;if(t.STATEMENT_SUFFIX)E=t.prefixLines(t.injectId(t.STATEMENT_SUFFIX,a),t.INDENT)+E;return u+=`while True:\n${E}${m1}`,u};t.control_if=(a)=>{let u="";if(t.STATEMENT_PREFIX)u+=t.injectId(t.STATEMENT_PREFIX,a);let E=t.statementToCode(a,"SUBSTACK")||t.PASS;if(t.STATEMENT_SUFFIX)E=t.prefixLines(t.injectId(t.STATEMENT_SUFFIX,a),t.INDENT)+E;const T=t.valueToCode(a,"CONDITION",t.ORDER_NONE)||"False";if(u+=`if ${T}:\n${E}`,a.getInput("SUBSTACK2")){if(E=t.statementToCode(a,"SUBSTACK2")||t.PASS,t.STATEMENT_SUFFIX)E=t.prefixLines(t.injectId(t.STATEMENT_SUFFIX,a),t.INDENT)+E;u+=`else:\n${E}`}return u};t.control_if_else=t.control_if;t.control_wait_until=(a)=>{let u="";if(t.STATEMENT_PREFIX)u+=t.injectId(t.STATEMENT_PREFIX,a);const E=t.valueToCode(a,"CONDITION",t.ORDER_NONE)||"False";return u+=`while not ${E}:\n${m1}`,u};t.control_repeat_until=(a)=>{let u="";if(t.STATEMENT_PREFIX)u+=t.injectId(t.STATEMENT_PREFIX,a);let E=t.statementToCode(a,"SUBSTACK")||t.PASS;if(t.STATEMENT_SUFFIX)E=t.prefixLines(t.injectId(t.STATEMENT_SUFFIX,a),t.INDENT)+E;const T=t.valueToCode(a,"CONDITION",t.ORDER_NONE)||"False";return u+=`while not ${T}:\n${E}${m1}`,u};t.control_while=(a)=>{let u="";if(t.STATEMENT_PREFIX)u+=t.injectId(t.STATEMENT_PREFIX,a);let E=t.statementToCode(a,"SUBSTACK")||t.PASS;if(t.STATEMENT_SUFFIX)E=t.prefixLines(t.injectId(t.STATEMENT_SUFFIX,a),t.INDENT)+E;const T=t.valueToCode(a,"CONDITION",t.ORDER_NONE)||"False";return u+=`while ${T}:\n${E}${m1}`,u};t.control_stop=(a)=>{let u="";if(t.STATEMENT_PREFIX)u+=t.injectId(t.STATEMENT_PREFIX,a);switch(a.getFieldValue("STOP_OPTION")){case"all":u+="runtime.stop()\n";break;case"this script":u+="return\n";break;case"other scripts in sprite":u+="runtime.stop_tasks(this_func)\n";break}return u};import{ScratchBlocks as P} from"@blockcode/blocks-editor";t.data_variable=(a)=>{return[t.variableDB_.getName(a.getFieldValue("VARIABLE"),P.Variables.NAME_TYPE),t.ORDER_ATOMIC]};t.data_setvariableto=(a)=>{let u="";if(javascriptGenerator.STATEMENT_PREFIX)u+=javascriptGenerator.injectId(javascriptGenerator.STATEMENT_PREFIX,a);const E=t.variableDB_.getName(a.getFieldValue("VARIABLE"),P.Variables.NAME_TYPE),T=t.valueToCode(a,"VALUE",t.ORDER_NONE)||'""';return u+=`${E} = ${T}\n`,u};t.data_changevariableby=(a)=>{let u="";if(javascriptGenerator.STATEMENT_PREFIX)u+=javascriptGenerator.injectId(javascriptGenerator.STATEMENT_PREFIX,a);const E=t.variableDB_.getName(a.getFieldValue("VARIABLE"),P.Variables.NAME_TYPE),T=t.valueToCode(a,"VALUE",t.ORDER_NONE)||0;return u+=`${E} = num(${E}) + num(${T})\n`,u};t.data_listcontents=(a)=>{return[t.variableDB_.getName(a.getFieldValue("LIST"),P.Variables.NAME_TYPE)+"_"+P.LIST_VARIABLE_TYPE,t.ORDER_ATOMIC]};t.data_addtolist=(a)=>{let u="";if(t.STATEMENT_PREFIX)u+=t.injectId(t.STATEMENT_PREFIX,a);const E=t.variableDB_.getName(a.getFieldValue("LIST"),P.Variables.NAME_TYPE)+"_"+P.LIST_VARIABLE_TYPE,T=t.valueToCode(a,"ITEM",t.ORDER_NONE)||'""';return u+=`${E}.append(${T})\n`,u};t.data_deleteoflist=(a)=>{let u="";if(t.STATEMENT_PREFIX)u+=t.injectId(t.STATEMENT_PREFIX,a);const E=t.variableDB_.getName(a.getFieldValue("LIST"),P.Variables.NAME_TYPE)+"_"+P.LIST_VARIABLE_TYPE,T=t.valueToCode(a,"INDEX",t.ORDER_NONE)||1;return u+=`${E}.remove(runtime.index(${T}, len(${E})))\n`,u};t.data_deletealloflist=(a)=>{let u="";if(t.STATEMENT_PREFIX)u+=t.injectId(t.STATEMENT_PREFIX,a);const E=t.variableDB_.getName(a.getFieldValue("LIST"),P.Variables.NAME_TYPE)+"_"+P.LIST_VARIABLE_TYPE;return u+=`${E} = []\n`,u};t.data_insertatlist=(a)=>{let u="";if(t.STATEMENT_PREFIX)u+=t.injectId(t.STATEMENT_PREFIX,a);const E=t.variableDB_.getName(a.getFieldValue("LIST"),P.Variables.NAME_TYPE)+"_"+P.LIST_VARIABLE_TYPE,T=t.valueToCode(a,"INDEX",t.ORDER_NONE)||1,o=t.valueToCode(a,"ITEM",t.ORDER_NONE)||'""';return u+=`${E}.insert(runtime.index(${T}, len(${E})), ${o})\n`,u};t.data_replaceitemoflist=(a)=>{let u="";if(t.STATEMENT_PREFIX)u+=t.injectId(t.STATEMENT_PREFIX,a);const E=t.variableDB_.getName(a.getFieldValue("LIST"),P.Variables.NAME_TYPE)+"_"+P.LIST_VARIABLE_TYPE,T=t.valueToCode(a,"INDEX",t.ORDER_NONE)||1,o=t.valueToCode(a,"ITEM",t.ORDER_NONE)||'""';return u+=`${E}[runtime.index(${T}, len(${E}))] = ${o}\n`,u};t.data_itemoflist=(a)=>{const u=t.variableDB_.getName(a.getFieldValue("LIST"),P.Variables.NAME_TYPE)+"_"+P.LIST_VARIABLE_TYPE,E=t.valueToCode(a,"INDEX",t.ORDER_NONE)||1;return[`${u}[runtime.index(${E}, len(${u}))]`,t.ORDER_CONDITIONAL]};t.data_itemnumoflist=(a)=>{const u=t.variableDB_.getName(a.getFieldValue("LIST"),P.Variables.NAME_TYPE)+"_"+P.LIST_VARIABLE_TYPE,E=t.valueToCode(a,"ITEM",t.ORDER_NONE)||0;return[`(${u}.index(${E}) + 1)`,t.ORDER_NONE]};t.data_lengthoflist=(a)=>{return[`len(${t.variableDB_.getName(a.getFieldValue("LIST"),P.Variables.NAME_TYPE)+"_"+P.LIST_VARIABLE_TYPE})`,t.ORDER_FUNCTION_CALL]};t.data_listcontainsitem=(a)=>{const u=t.variableDB_.getName(a.getFieldValue("LIST"),P.Variables.NAME_TYPE)+"_"+P.LIST_VARIABLE_TYPE,E=t.valueToCode(a,"ITEM",t.ORDER_NONE)||0;return[`bool(${u}.count(${E}))`,t.ORDER_FUNCTION_CALL]};import{ScratchBlocks as x1} from"@blockcode/blocks-editor";t.event_whenflagclicked=()=>{return`${t.hatToCode("start")}runtime.when_start(${t.HAT_FUNCTION_PLACEHOLDER})\n`};t.event_whengreaterthan=(a)=>{const u=a.getFieldValue("WHENGREATERTHANMENU"),E=t.valueToCode(a,"VALUE",t.ORDER_NONE)||0;return`${t.hatToCode("greaterthen")}runtime.when_greaterthen("${u}", num(${E}), ${t.HAT_FUNCTION_PLACEHOLDER})\n`};t.event_whenbroadcastreceived=(a)=>{const u=t.variableDB_.getName(a.getFieldValue("BROADCAST_OPTION"),x1.Variables.NAME_TYPE);return`${t.hatToCode("broadcastreceived")}runtime.when_broadcastreceived("${u}", ${t.HAT_FUNCTION_PLACEHOLDER})\n`};t.event_broadcast_menu=(a)=>{return[t.variableDB_.getName(a.getFieldValue("BROADCAST_OPTION"),x1.Variables.NAME_TYPE),t.ORDER_ATOMIC]};t.event_broadcast=(a)=>{return`runtime.broadcast("${t.valueToCode(a,"BROADCAST_INPUT",t.ORDER_NONE)||'"message1"'}")\n`};t.event_broadcastandwait=(a)=>{return`await runtime.broadcast("${t.valueToCode(a,"BROADCAST_INPUT",t.ORDER_NONE)||'"message1"'}", waiting=True)\n`};t.addReservedWords("math,random,Number");t.math_number=(a)=>{let u=parseFloat(a.getFieldValue("NUM")),E;if(u===1/0)u='float("inf")',E=t.ORDER_FUNCTION_CALL;else if(u===-1/0)u='-float("inf")',E=t.ORDER_UNARY_SIGN;else if(Number.isNaN(u))u='float("nan")',E=t.ORDER_UNARY_SIGN;else E=u<0?t.ORDER_UNARY_SIGN:t.ORDER_ATOMIC;return[u,E]};t.math_integer=(a)=>{const u=parseInt(a.getFieldValue("NUM")),E=u<0?t.ORDER_UNARY_SIGN:t.ORDER_ATOMIC;return[u,E]};t.math_whole_number=(a)=>{return[Math.abs(parseInt(a.getFieldValue("NUM"))),t.ORDER_ATOMIC]};t.math_positive_number=(a)=>{let u=parseFloat(a.getFieldValue("NUM")),E;if(u===1/0)u='float("inf")',E=t.ORDER_FUNCTION_CALL;else if(u===-1/0)u='-float("inf")',E=t.ORDER_FUNCTION_CALL;else if(Number.isNaN(u))u='float("nan")',E=t.ORDER_FUNCTION_CALL;else u=u<0?0:u,E=t.ORDER_ATOMIC;return[u,E]};t.math_angle=(a)=>{let u=parseFloat(a.getFieldValue("NUM")),E;if(u==1/0)u='float("inf")',E=t.ORDER_FUNCTION_CALL;else if(u==-1/0)u='-float("inf")',E=t.ORDER_UNARY_SIGN;else u=u%360,u=u<0?u+360:u,E=t.ORDER_ATOMIC;return[u,E]};t.operator_add=(a)=>{const u=t.valueToCode(a,"NUM1",t.ORDER_NONE)||0,E=t.valueToCode(a,"NUM2",t.ORDER_NONE)||0;return[`(num(${u}) + num(${E}))`,t.ORDER_SUBTRACTION]};t.operator_subtract=(a)=>{const u=t.valueToCode(a,"NUM1",t.ORDER_NONE)||0,E=t.valueToCode(a,"NUM2",t.ORDER_NONE)||0;return[`(num(${u}) - num(${E}))`,t.ORDER_SUBTRACTION]};t.operator_multiply=(a)=>{const u=t.valueToCode(a,"NUM1",t.ORDER_NONE)||0,E=t.valueToCode(a,"NUM2",t.ORDER_NONE)||0;return[`(num(${u}) * num(${E}))`,t.ORDER_SUBTRACTION]};t.operator_divide=(a)=>{const u=t.valueToCode(a,"NUM1",t.ORDER_NONE)||0,E=t.valueToCode(a,"NUM2",t.ORDER_NONE)||0;return[`(num(${u}) / num(${E}))`,t.ORDER_SUBTRACTION]};t.operator_random=(a)=>{const u=t.valueToCode(a,"FROM",t.ORDER_NONE)||0,E=t.valueToCode(a,"TO",t.ORDER_NONE)||0;return[`runtime.random(${u}, ${E})`,t.ORDER_FUNCTION_CALL]};t.operator_gt=(a)=>{const u=t.valueToCode(a,"OPERAND1",t.ORDER_NONE)||0,E=t.valueToCode(a,"OPERAND2",t.ORDER_NONE)||0;return[`(num(${u}) > num(${E}))`,t.ORDER_RELATIONAL]};t.operator_lt=(a)=>{const u=t.valueToCode(a,"OPERAND1",t.ORDER_NONE)||0,E=t.valueToCode(a,"OPERAND2",t.ORDER_NONE)||0;return[`(num(${u}) < num(${E}))`,t.ORDER_RELATIONAL]};t.operator_equals=(a)=>{const u=t.valueToCode(a,"OPERAND1",t.ORDER_NONE)||0,E=t.valueToCode(a,"OPERAND2",t.ORDER_NONE)||0;return[`equals(${u}, ${E})`,t.ORDER_FUNCTION_CALL]};t.operator_and=(a)=>{const u=t.valueToCode(a,"OPERAND1",t.ORDER_NONE)||"False",E=t.valueToCode(a,"OPERAND2",t.ORDER_NONE)||"False";return[`(${u} and ${E})`,t.ORDER_LOGICAL_AND]};t.operator_or=(a)=>{const u=t.valueToCode(a,"OPERAND1",t.ORDER_NONE)||"False",E=t.valueToCode(a,"OPERAND2",t.ORDER_NONE)||"False";return[`(${u} or ${E})`,t.ORDER_LOGICAL_OR]};t.operator_not=(a)=>{return[`(not ${t.valueToCode(a,"OPERAND",t.ORDER_NONE)||"False"})`,t.ORDER_LOGICAL_NOT]};t.operator_join=(a)=>{const u=t.valueToCode(a,"STRING1",t.ORDER_NONE)||'""',E=t.valueToCode(a,"STRING2",t.ORDER_NONE)||'""';return[`(str(${u}) + str(${E}))`,t.ORDER_ATOMIC]};t.operator_letter_of=(a)=>{const u=t.valueToCode(a,"LETTER",t.ORDER_NONE)||0;return[`(str(${t.valueToCode(a,"STRING",t.ORDER_NONE)||'""'})[num(${u}) - 1] || "")`,t.ORDER_MEMBER]};t.operator_length=(a)=>{return[`len(str(${t.valueToCode(a,"STRING",t.ORDER_NONE)||'""'}))`,t.ORDER_FUNCTION_CALL]};t.operator_contains=(a)=>{const u=t.valueToCode(a,"STRING1",t.ORDER_NONE)||'""',E=t.valueToCode(a,"STRING2",t.ORDER_NONE)||'""';return[`(str(${u}).count(str(${E})) > 0)`,t.ORDER_FUNCTION_CALL]};t.operator_mod=(a)=>{const u=t.valueToCode(a,"NUM1",t.ORDER_NONE)||0,E=t.valueToCode(a,"NUM2",t.ORDER_NONE)||0;return[`(num(${u}) % num(${E}))`,t.ORDER_MODULUS]};t.operator_round=(a)=>{return t.definitions_.import_math="import math",[`math.round(num(${t.valueToCode(a,"NUM",t.ORDER_NONE)||0}))`,t.ORDER_FUNCTION_CALL]};t.operator_mathop=(a)=>{t.definitions_.import_math="import math";const u=t.valueToCode(a,"NUM",t.ORDER_NONE)||0,E=a.getFieldValue("OPERATOR");let T="";if(E==="ceiling")T+=`math.ceil(num(${u}))`;else if(E==="sin"||E==="cos"||E==="tan")T+=`math.${E}(math.radians(num(${u})))`;else if(E==="asin"||E==="acos"||E==="atan")T+=`math.degrees(math.${E}(num(${u})))`;else if(E==="ln")T+=`(math.log(num(${u}))`;else if(E==="log")T+=`(math.log10(num(${u}))`;else if(E==="e ^")T+=`math.exp(num(${u}))`;else if(E==="10 ^")T+=`math.pow(10, num(${u}))`;else T+=`math.${E}(num(${u}))`;return[T,t.ORDER_FUNCTION_CALL]};t.procedures_definition=(a)=>{};t.procedures_call=(a)=>{};t.procedures_prototype=(a)=>{};t.procedures_declaration=(a)=>{};t.argument_reporter_boolean=(a)=>{};t.argument_reporter_string_number=(a)=>{};t.argument_editor_boolean=(a)=>{};t.argument_editor_string_number=(a)=>{};t.sensing_timer=()=>{return["runtime.time",t.ORDER_MEMBER]};t.sensing_resettimer=()=>{return"runtime.reset_timer()\n"};t.text=(a)=>{const u=a.getFieldValue("TEXT");return[u.length===0||isNaN(u)?t.quote_(u):+u,t.ORDER_ATOMIC]};import{useEffect as R0,useState as n1} from"preact/hooks";import{useLocale as r0,useLayout as e0,useEditor as ot} from"@blockcode/core";import{classNames as s0} from"@blockcode/ui";import{BlocksEditor as l0,ScratchBlocks as b,makeToolboxXML as n0} from"@blockcode/blocks-editor";import{ScratchBlocks as y1,blockSeparator as qt} from"@blockcode/blocks-editor";var jt=1,kt=2,xt=3,G1="#0FBD8C",tt="#0DA57A",yt="#0B8E69",T1=(a)=>{if(typeof a!=="string")if(Array.isArray(a))a=String(a);else return a;return a.replace(/[<>&'"]/g,(u)=>{switch(u){case"<":return"&lt;";case">":return"&gt;";case"&":return"&amp;";case"'":return"&apos;";case'"':return"&quot;"}})},at={number:"math_number",angle:"math_angle",text:"text",string:"text",color:"colour_picker",matrix:"matrix",note:"note"},ut={number:"NUM",angle:"NUM",text:"TEXT",string:"TEXT",matrix:"MATRIX",note:"NOTE"};function v1(a,u,E,T){const{id:o}=a,R=E(a.name);let _=`<category name="${T1(R)}" id="${T1(o)}"`;if(_+=` colour="${T1(a.themeColor||G1)}"`,_+=` secondaryColour="${T1(a.inputColor||tt)}"`,a.connectionConfig)_+=' showStatusButton="true"';if(a.iconURI)_+=` iconURI="${T1(a.iconURI)}"`;return _+=">",a.blocks.forEach((C)=>{if(C==="---"){_+=`${qt}`;return}if(C.button){_+=`<button text="${E(C.text)}" callbackKey="${C.button}"></button>`;const D=y1.getMainWorkspace();if(D){const I=D.getFlyout();if(I){const f=I.getWorkspace();if(f)f.registerButtonCallback(C.button,T(C.onClick))}}return}if(u&&C.useStage===!1)return;if(!u&&C.useSprite===!1)return;const A=`${o}_${C.id.toLowerCase()}`,r={message0:E(C.text),category:o,outputShape:xt,colour:a.themeColor||G1,colourSecondary:a.inputColor||tt,colourTertiary:a.otherColor||yt};let w=1;if(a.iconURI)r.message0=`%1 %2 ${r.message0}`,r.args0=[{type:"field_image",src:a.iconURI,width:40,height:40},{type:"field_vertical_separator"}],r.extensions=["scratch_extension"],w+=2;if(C.hat)r.nextStatement=null;else if(C.output){if(C.output==="boolean")r.output="Boolean",r.outputShape=jt;else r.output="String",r.outputShape=kt;r.checkboxInFlyout=C.monitoring!==!1}else r.previousStatement=null,r.nextStatement=null;let p=`<block type="${T1(A)}">`;if(C.inputs)r.checkboxInFlyout=!1,r.args0=[].concat(r.args0||[],Object.entries(C.inputs).map(([D,I])=>{const f={name:D,type:"input_value"};if(I.menu)f.type="field_dropdown",f.options=I.menu.map(([l,M])=>[E(l),M]);else if(I.type==="boolean")f.check="Boolean";else{if(p+=`<value name="${T1(D)}">`,at[I.type]){if(p+=`<shadow type="${at[I.type]}">`,I.default&&ut[I.type])p+=`<field name="${ut[I.type]}">${T1(E(I.default))}</field>`;p+="</shadow>"}p+="</value>"}return r.message0=r.message0.replace(`[${D}]`,`%${w++}`),f}));if(y1.Blocks[A]={init(){this.jsonInit(r)}},C.python)t[A]=C.python.bind(t);else t[A]=()=>"";p+="</block>",_+=p}),_+="</category>",_}import{useRef as Gt,useEffect as t0,useState as Et} from"preact/hooks";import{classNames as a0,Text as o1,Button as Tt,Modal as u0,BufferedInput as E0} from"@blockcode/ui";function R1(a){const u=globalThis.document,E=u.createElement("style");E.appendChild(u.createTextNode(a)),u.head.append(E)}R1("._5SVWFW_prompt-modal{width:360px}._5SVWFW_prompt-content{background:var(--ui-white);padding:1.5rem 2.25rem}._5SVWFW_prompt-content input[type=checkbox],._5SVWFW_prompt-content input[type=radio]{margin:3px}._5SVWFW_label{margin:0 0 .75rem;font-weight:500}._5SVWFW_variable-name-text-input{border:1px solid var(--ui-black-transparent);color:var(--text-primary-transparent);border-radius:5px;width:100%;height:3rem;margin-bottom:1.5rem;padding:0 1rem;font-size:.875rem}._5SVWFW_info-message{text-align:center;margin-bottom:1.5rem;font-size:.875rem;font-weight:400}._5SVWFW_options{justify-content:space-between;margin-bottom:1.5rem;font-weight:400;display:flex}._5SVWFW_button-row{text-align:right;font-weight:bolder}._5SVWFW_button{padding:.75rem 1rem;font-size:.85rem;font-weight:600}._5SVWFW_ok-button{background:var(--motion-primary);border:var(--motion-primary);color:var(--ui-white);margin-left:var(--space)}");var q={promptContent:"_5SVWFW_prompt-content",button:"_5SVWFW_button",infoMessage:"_5SVWFW_info-message",options:"_5SVWFW_options",okButton:"_5SVWFW_ok-button",buttonRow:"_5SVWFW_button-row",variableNameTextInput:"_5SVWFW_variable-name-text-input",label:"_5SVWFW_label",promptModal:"_5SVWFW_prompt-modal"};import{jsx as X,jsxs as r1} from"preact/jsx-runtime";function $1({title:a,label:u,defaultValue:E,enableLocalVariable:T,showListMessage:o,showVariableOptions:R,showCloudOption:_,onClose:C,onSubmit:A}){const r=Gt(null),[w,p]=Et(E),[D,I]=Et({scope:"global",isCloud:!1}),f=()=>{A(w,D)},l=(M)=>{if(M.key==="Escape")C();if(M.key==="Enter")A(r.current.base.value,D)};return t0(()=>{if(r.current)r.current.base.focus(),window.addEventListener("keydown",l);return()=>{window.removeEventListener("keydown",l)}},[r]),X(u0,{title:a,className:q.promptModal,onClose:C,children:r1("div",{className:q.promptContent,children:[X("div",{className:q.label,children:u}),X(E0,{autoFocus:!0,forceFocus:!0,ref:r,className:q.variableNameTextInput,defaultValue:w,onSubmit:p}),R&&X("div",{children:T?r1("div",{className:q.options,children:[r1("label",{children:[X("input",{checked:D.scope==="global",name:"variableScopeOption",type:"radio",value:"global",onChange:()=>I({...D,scope:"global"})}),X(o1,{id:"blocks.dataPrompt.forAllTargets",defaultMessage:"For all targets"})]}),r1("label",{children:[X("input",{checked:D.scope==="local",name:"variableScopeOption",type:"radio",value:"local",onChange:()=>I({...D,scope:"local"})}),X(o1,{id:"blocks.dataPrompt.forThisTarget",defaultMessage:"For this target only"})]})]}):X("div",{className:q.infoMessage,children:o?X(o1,{id:"blocks.dataPrompt.listAvailableToAllTargets",defaultMessage:"This list will be available to all targets."}):X(o1,{id:"blocks.dataPrompt.availableToAllTargets",defaultMessage:"This variable will be available to all targets."})})}),r1("div",{className:q.buttonRow,children:[X(Tt,{className:q.button,onClick:C,children:X(o1,{id:"blocks.dataPrompt.cancel",defaultMessage:"Cancel"})}),X(Tt,{className:a0(q.button,q.okButton),onClick:f,children:X(o1,{id:"blocks.dataPrompt.ok",defaultMessage:"OK"})})]})]})})}import{useEffect as T0,useState as it} from"preact/hooks";import{useLocale as d0,useLayout as i0,useEditor as N0} from"@blockcode/core";import{Library as o0} from"@blockcode/ui";var dt=["nes","translate","color-sensor","servo","time","pen","brain","request","text","broadcast"].map(async(a)=>{const{default:u}=await import(`@blockcode/extension-${a}`);return u.id=a,u});import{jsx as C0} from"preact/jsx-runtime";var _0=Promise.all(dt);function w1({deviceId:a,onSelect:u,onClose:E,onFilter:T}){const[o,R]=it([]),[_,C]=it(!1),{language:A,getText:r}=d0(),{createAlert:w,removeAlert:p}=i0(),{addAsset:D}=N0(),I=(f)=>{const l=f.tags||[];let M=["blocks",["dupont","data"],["3v3","5v"]];if(T)M=T(l);if(Array.isArray(M))return M.every((V)=>{if(Array.isArray(V))return V.some((j)=>l.includes(j));return l.includes(V)});return M};return T0(()=>{_0.then((f)=>{R(f.filter(I).map((l)=>Object.assign({...l,featured:!0,disabled:l.disabled||l.preview,onSelect:async()=>{w("importing",{id:l.id});let{default:M}=await import(`@blockcode/extension-${l.id}/blocks`);if(typeof M==="function")M=M(a);if(M.id=l.id,M.files)for(let V of M.files){const j=`extensions/${l.id.replace(/[^a-z\d]/gi,"_")}/${V.name}`,c=await fetch(V.uri).then((H)=>H.text());D({...V,id:j,content:c})}u(M),p(l.id),E()}},l.translations&&l.translations[A]?{name:l.translations[A].name||l.name,description:l.translations[A].description||l.description,collaborator:l.translations[A].collaborator||l.collaborator}:{}))),C(!1)})},[]),C0(o0,{filterable:!0,loading:_,items:o,filterPlaceholder:r("gui.library.search","Search"),title:r("blocks.extensions.addExtension","Add Extension"),emptyText:r("blocks.extensions.empty","No extension!"),onClose:E})}R1(".cujmXa_editor-wrapper{border-radius:inherit;width:100%;height:100%;position:relative}.cujmXa_extension-button{z-index:var(--z-index-extension-button);background:var(--motion-primary);border:1px solid var(--motion-primary);box-sizing:content-box;border-bottom-left-radius:inherit;border-top:0;height:3.25rem;position:absolute;bottom:-1px;left:-1px}.cujmXa_extension-button:before{--fade-out-distance:15px;content:\"\";top:calc(calc(-1*var(--fade-out-distance)));height:var(--fade-out-distance);background:linear-gradient(#0000,#00000026);position:absolute;left:0;right:0}.cujmXa_add-button{cursor:pointer;background:0 0;border:none;outline:none;width:100%;height:100%}.cujmXa_add-button img{width:1.75rem;height:1.75rem}.cujmXa_debug-box{z-index:var(--z-index-monitor);border:1px solid var(--ui-tertiary);border-radius:var(--space)var(--space)0 0;opacity:.8;font-size:var(--standard-font-size);background:#fff;border-bottom:0;width:600px;height:300px;position:absolute;bottom:0;left:50vw;overflow:auto;transform:translate(-50%)}.cujmXa_debug-box pre{margin:calc(var(--space)/2)}");var l1={addButton:"cujmXa_add-button",editorWrapper:"cujmXa_editor-wrapper",debugBox:"cujmXa_debug-box",extensionButton:"cujmXa_extension-button"};var Nt="./assets/icon-extension-5ec2ee35b87b4126.svg";import{jsx as _1,jsxs as _t,Fragment as A0} from"preact/jsx-runtime";var x=new Map,Ct=(a)=>typeof a!=="string"&&!a.button,O0=async(a,u,E,T,o)=>{if(u){for(let R of u)if(!x.has(R)){let{default:_}=await import(`@blockcode/extension-${R}/blocks`);if(typeof _==="function")_=_(a);if(_.id=R,_.files)for(let C of _.files){const A=`extensions/${R}/${C.name}`,r=await fetch(C.uri).then((w)=>w.text());T({...C,id:A,content:r})}if(E(_.translations),o)o({..._,blocks:_.blocks.filter(Ct)});x.set(R,_)}}};function O1({toolbox:a,messages:u,enableMultiTargets:E,enableLocalVariable:T,disableGenerator:o,disableExtension:R,deviceId:_,onChange:C,onExtensionsFilter:A,onLoadExtension:r}){const{addLocaleData:w,getText:p,maybeLocaleText:D}=r0(),{splash:I,createPrompt:f,createAlert:l,removeAlert:M,setSplash:V}=e0(),{editor:j,fileList:c,selectedFileId:H,openFile:Z,modifyFile:y,addAsset:u1,setModified:A1}=ot(),[G,s]=n1(),[d,N]=n1(!1),[i,m]=n1(!1),[O,S]=n1(!1);if(I){if(I===!0&&O===!1)x.clear(),S(O0(_,j.extensions,w,u1,r).then(()=>setTimeout(()=>S(!0),100)));if(O===!0){let e=!0;if(c.length>1){for(let g=0;g>-c.length;g--)if(!c.at(g).content){e=!1,setTimeout(()=>{const U=(g+c.length)%c.length;Z(c[U].id)},100);break}}if(e)setTimeout(()=>{V(!1),A1(!1),S(!1)},100)}}u={EVENT_WHENPROGRAMSTART:p("blocks.event.programStart","when program start"),CONTROL_STOP_OTHER:p("blocks.control.stopOther","other scripts"),...u||[]},R0(()=>{b.prompt=(e,g,L,U,t1)=>{const J={callback:L,message:e,defaultValue:g};J.title=U?U:b.Msg.VARIABLE_MODAL_TITLE,J.varType=typeof t1==="string"?t1:b.SCALAR_VARIABLE_TYPE,J.showVariableOptions=E&&t1!==b.BROADCAST_MESSAGE_VARIABLE_TYPE&&J.title!==b.Msg.RENAME_VARIABLE_MODAL_TITLE&&J.title!==b.Msg.RENAME_LIST_MODAL_TITLE,J.showCloudOption=t1===b.SCALAR_VARIABLE_TYPE&&this.props.canUseCloud,N(J)},b.FlyoutExtensionCategoryHeader.getExtensionState=(e)=>{if(x.has(e)){const g=x.get(e);if(g.connectionConfig?.items.every((L)=>localStorage.getItem(`${g.id}.connection.${L.id}`)))return b.StatusButtonState.READY}return b.StatusButtonState.NOT_READY},b.statusButtonCallback=(e)=>{if(!x.has(e))return;const g=x.get(e),{connectionConfig:L}=g;if(!L)return;f({title:g.name,label:L.title,inputMode:L.items.map((U)=>({name:U.id,placeholder:U.text,defaultValue:localStorage.getItem(`${g.id}.connection.${U.id}`)})),content:L.description,onSubmit:(U)=>{if(Object.entries(U).forEach(([t1,J])=>{localStorage.setItem(`${g.id}.connection.${t1}`,`${J}`)}),G)b.refreshStatusButtons(G)}})}},[G]);let F;if(G)F=G.getAllVariables().filter((e)=>{if(e.isLocal)return!1;if(e.type===b.BROADCAST_MESSAGE_VARIABLE_TYPE){if(e.name===b.Msg.DEFAULT_BROADCAST_MESSAGE_NAME)return!1;const g=e.id_.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),L=new RegExp(`<field name="BROADCAST_OPTION" id="${g}"[^>]+>[^<]+</field>`,"g");for(let U of c)if(L.test(U.xml))return!0;return!1}return!0});let B=a||n0();const k=H===c[0].id,W=(e)=>e.bind(null,{context:ot(),createPrompt:f,createAlert:l,removeAlert:M});x.forEach((e)=>{B+=v1(e,k,D,W)});const K=(e,g)=>{let L;if(!o)L=t.workspaceToCode(g);if(y({xml:e,content:L}),C)C(e,g)},z=(e,g)=>{d.callback(e,[],g),N(!1)},v=()=>N(!1),h=()=>m(!0),$=()=>m(!1),n=(e)=>{if(!x.has(e.id)){if(w(e.translations),r)r({...e,blocks:e.blocks.filter(Ct)});x.set(e.id,e)}setTimeout(()=>{G.toolbox_.setSelectedCategoryById(e.id)},100)};return _t(A0,{children:[_t("div",{className:l1.editorWrapper,children:[_1(l0,{toolbox:B,messages:u,globalVariables:F,onWorkspaceCreated:s,onChange:H!==null?K:null}),R?null:_1("div",{className:s0("scratchCategoryMenu",l1.extensionButton),children:_1("button",{className:l1.addButton,title:p("blocks.extensions.addExtension","Add Extension"),onClick:h,children:_1("img",{src:Nt,title:"Add Extension"})})}),d&&_1($1,{title:d.title,label:d.message,defaultValue:d.defaultValue,enableLocalVariable:T,showListMessage:d.varType===b.LIST_VARIABLE_TYPE,showVariableOptions:d.showVariableOptions,showCloudOption:d.showCloudOption,onClose:v,onSubmit:z}),i&&_1(w1,{deviceId:_,onFilter:A,onSelect:n,onClose:$})]}),!1]})}var mt="./assets/icon-blocks-d7e4a3a3eb74d0fb.svg";var Rt={"blocks.menu.file":"File","blocks.menu.file.newProject":"New","blocks.menu.file.openProject":"Open","blocks.menu.file.saveProject":"Save","blocks.menu.file.uploadProject":"Load from your computer","blocks.menu.file.downloadProject":"Save to your computer","blocks.menu.edit":"Edit","blocks.menu.edit.undo":"Undo","blocks.menu.edit.redo":"Redo","blocks.menu.device":"Device","blocks.menu.device.name":"device","blocks.menu.device.connect":"Connect to your {name}","blocks.menu.device.disconnect":"Disconnect this {name}","blocks.menu.device.download":"Download program","blocks.menu.device.turnOnAutoDownload":"Turn on Auto Download","blocks.menu.device.turnOffAutoDownload":"Turn off Auto Download","blocks.alert.downloading":"Downloading...{progress}%","blocks.alert.downloadCompleted":"Download completed.","blocks.codeTab":"Code","blocks.monitorPane.title":"Monitor","blocks.downloadToDevice":"Download","blocks.extensions.addExtension":"Add Extension","blocks.extensions.empty":"No extension!","blocks.dataPrompt.forAllTargets":"For all targets","blocks.dataPrompt.forThisTarget":"For this target only","blocks.dataPrompt.availableToAllTargets":"This variable will be available to all targets.","blocks.dataPrompt.listAvailableToAllTargets":"This list will be available to all targets.","blocks.dataPrompt.cancel":"Cancel","blocks.dataPrompt.ok":"OK","blocks.event.programStart":"when program start","blocks.control.stopOther":"other scripts"};var rt={"blocks.menu.file":"\u6587\u4EF6","blocks.menu.file.newProject":"\u65B0\u4F5C\u54C1","blocks.menu.file.openProject":"\u6253\u5F00","blocks.menu.file.saveProject":"\u4FDD\u5B58","blocks.menu.file.uploadProject":"\u4ECE\u7535\u8111\u4E2D\u6253\u5F00","blocks.menu.file.downloadProject":"\u4FDD\u5B58\u5230\u7535\u8111","blocks.menu.edit":"\u7F16\u8F91","blocks.menu.edit.undo":"\u64A4\u9500","blocks.menu.edit.redo":"\u6062\u590D","blocks.menu.device":"\u8BBE\u5907","blocks.menu.device.name":"\u8BBE\u5907","blocks.menu.device.connect":"\u8FDE\u63A5{name}","blocks.menu.device.disconnect":"\u65AD\u5F00{name}\u8FDE\u63A5","blocks.menu.device.download":"\u4E0B\u8F7D\u7A0B\u5E8F","blocks.menu.device.turnOnAutoDownload":"\u6253\u5F00\u81EA\u52A8\u4E0B\u8F7D","blocks.menu.device.turnOffAutoDownload":"\u5173\u95ED\u81EA\u52A8\u4E0B\u8F7D","blocks.alert.downloading":"\u6B63\u5728\u4E0B\u8F7D\u2026{progress}%","blocks.alert.downloadCompleted":"\u4E0B\u8F7D\u5B8C\u6210\u3002","blocks.codeTab":"\u4EE3\u7801","blocks.monitorPane.title":"\u76D1\u89C6\u5668","blocks.downloadToDevice":"\u4E0B\u8F7D","blocks.extensions.addExtension":"\u6DFB\u52A0\u6269\u5C55","blocks.extensions.empty":"\u6CA1\u6709\u6269\u5C55\uFF01","blocks.dataPrompt.forAllTargets":"\u9002\u7528\u4E8E\u5168\u5C40","blocks.dataPrompt.forThisTarget":"\u4EC5\u9002\u7528\u4E8E\u5F53\u524D","blocks.dataPrompt.availableToAllTargets":"\u5168\u5C40\u90FD\u53EF\u4F7F\u7528\u8BE5\u53D8\u91CF\u3002","blocks.dataPrompt.listAvailableToAllTargets":"\u5168\u5C40\u90FD\u53EF\u4F7F\u7528\u8BE5\u5217\u8868\u3002","blocks.dataPrompt.cancel":"\u53D6\u6D88","blocks.dataPrompt.ok":"\u786E\u5B9A","blocks.event.programStart":"\u5F53\u7A0B\u5E8F\u5F00\u59CB\u8FD0\u884C","blocks.control.stopOther":"\u5176\u4ED6\u811A\u672C"};import{jsx as st} from"preact/jsx-runtime";var S0={en:Rt,"zh-Hans":rt},g0={icon:mt,label:st(et,{id:"blocks.codeTab",defaultMessage:"Code"}),Content:O1},Oa={label:st(et,{id:"blocks.monitorPane.title",defaultMessage:"Monitor"}),Content:null};function I0({addLocaleData:a,createLayout:u,openProject:E,project:T}){a(S0);const o=(R)=>{R=R??k1,E(Object.assign({selectedFileId:R.fileList[0].id},R))};o(T),u({mainMenu:P1({createProject:o,openProject:E}),tabs:[{...g0,Content:O1}],sidebars:[],pane:!1,tutorials:!0,canEditProjectName:!0})}export{t as pythonGenerator,Oa as monitorPane,P1 as makeMainMenu,S0 as locales,I0 as default,g0 as codeTab};
