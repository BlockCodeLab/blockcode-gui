import{Text as s,Spinner as w}from"@blockcode/ui";import{connectDevice as D,checkDevice as h,writeFiles as k,configDevice as I}from"@blockcode/device-pyboard";var u={en:{"extension.nes.name":"NES emulator","extension.nes.download":"Download ROM to Arcade"},"zh-Hans":{"extension.nes.name":"NES \u6A21\u62DF\u5668","extension.nes.download":"\u4E0B\u8F7D ROM \u5230\u6E38\u620F\u673A"}};var g="./assets/icon-jj2v9ggp.png";import{jsx as i}from"preact/jsx-runtime";var Z=[{usbVendorId:12346}],n=(o,e,c)=>{if(!n.id)n.id=`download.${Date.now()}`;if(c<100)o({id:n.id,icon:i(w,{level:"success"}),message:i(s,{id:"blocks.alert.downloading",defaultMessage:"Downloading...{progress}%",progress:c})});else o({id:n.id,icon:null,message:i(s,{id:"blocks.alert.downloadCompleted",defaultMessage:"Download completed."})}),setTimeout(()=>{f(e)},1000)},f=(o)=>{o(n.id),delete n.id},r=(o,e)=>{if(e==="NotFoundError")return;o({message:e==="NotFoundError"?i(s,{id:"blocks.alert.connectionCancel",defaultMessage:"Connection cancel."}):i(s,{id:"blocks.alert.connectionError",defaultMessage:"Connection error."})},1000)},N={iconURI:g,name:i(s,{id:"extension.nes.name",defaultMessage:"Broadcast"}),blocks:[{button:"DOWNLOAD_ROM",text:i(s,{id:"extension.nes.download",defaultMessage:"Download ROM to Arcade"}),async onClick({context:o,createAlert:e,removeAlert:c}){if(n.id)return;let a;try{a=await D(Z)}catch(d){r(e,d)}if(!a)return;const m=h(a).catch(()=>{r(e),f(c)}),l=document.createElement("input");l.type="file",l.accept=".nes",l.multiple=!0,l.click(),l.addEventListener("change",async({target:d})=>{const p=[];let M="";for(let t of d.files)p.push({id:`nes/${t.name}`,content:await t.arrayBuffer()}),M=t.name;try{await k(a,p,(t)=>n(e,c,t)),await I(a,{"latest-game":M}),a.hardReset()}catch(t){r(e,t),f(c)}finally{m.cancel()}})}}],translations:u};export{N as default};
