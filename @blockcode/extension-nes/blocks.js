import{Text as s,Spinner as w}from"@blockcode/ui";import{connectDevice as D,disconnectDevice as h,checkDevice as k,writeFiles as I,configDevice as b}from"@blockcode/device-pyboard";var M={en:{"extension.nes.name":"NES emulator","extension.nes.download":"Download ROM to Arcade"},"zh-Hans":{"extension.nes.name":"NES \u6A21\u62DF\u5668","extension.nes.download":"\u4E0B\u8F7D ROM \u5230\u6E38\u620F\u673A"}};var m="./assets/icon-jj2v9ggp.png";import{jsx as i}from"preact/jsx-runtime";var Z=[{usbVendorId:12346,usbProductId:32769}],o=(t,e,a)=>{if(!o.id)o.id=`download.${Date.now()}`;if(a<100)t({id:o.id,icon:i(w,{level:"success"}),message:i(s,{id:"blocks.alert.downloading",defaultMessage:"Downloading...{progress}%",progress:a})});else t({id:o.id,icon:null,message:i(s,{id:"blocks.alert.downloadCompleted",defaultMessage:"Download completed."})}),setTimeout(()=>{f(e)},1000)},f=(t)=>{t(o.id),delete o.id},r=(t,e)=>{if(e==="NotFoundError")return;t({message:e==="NotFoundError"?i(s,{id:"blocks.alert.connectionCancel",defaultMessage:"Connection cancel."}):i(s,{id:"blocks.alert.connectionError",defaultMessage:"Connection error."})},1000)},n,R={iconURI:m,name:i(s,{id:"extension.nes.name",defaultMessage:"Broadcast"}),blocks:[{button:"DOWNLOAD_ROM",text:i(s,{id:"extension.nes.download",defaultMessage:"Download ROM to Arcade"}),async onClick({context:t,createAlert:e,removeAlert:a}){if(o.id)return;h(n);try{n=await D(Z)}catch(d){r(e,d.name),n=null}if(!n)return;const g=k(n).catch(()=>{r(e),f(a)}),l=document.createElement("input");l.type="file",l.accept=".nes",l.multiple=!0,l.click(),l.addEventListener("change",async({target:d})=>{const u=[];let p="";for(let c of d.files)u.push({id:`nes/${c.name}`,content:await c.arrayBuffer()}),p=c.name;try{await I(n,u,(c)=>o(e,a,c)),await b(n,{"latest-game":p}),n.hardReset()}catch(c){r(e,c.name),f(a)}finally{g.cancel()}})}}],translations:M};export{R as default};
