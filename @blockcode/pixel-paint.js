import{useState as I5} from"preact/hooks";import{useEditor as b5} from"@blockcode/core";import{useState as W0} from"preact/hooks";import{useLocale as F5,useEditor as G5} from"@blockcode/core";import{IconSelector as J5,ActionButton as Y5} from"@blockcode/ui";class V{static get DrawWidth(){return 320}static get DrawHeight(){return 240}static from(F){const G=F>>2,J=Math.floor(G/320),$=G-J*320;return new V($,J)}constructor(F,G){this.setXY(F,G)}get x(){return this._x}set x(F){this._x=F,this._index=this.x+this.y*320<<2}get y(){return this._y}set y(F){this._y=F,this._index=this.x+this.y*320<<2}get index(){return this._index}get valid(){return this.x>=0&&this.x<320&&this.y>=0&&this.y<240}get invalid(){return!this.valid}get topPoint(){return new V(this.x,this.y-1)}get leftPoint(){return new V(this.x-1,this.y)}get rightPoint(){return new V(this.x+1,this.y)}get bottomPoint(){return new V(this.x,this.y+1)}get topLeftPoint(){return new V(this.x-1,this.y-1)}get topRightPoint(){return new V(this.x+1,this.y-1)}get bottomLeftPoint(){return new V(this.x-1,this.y+1)}get bottomRightPoint(){return new V(this.x+1,this.y+1)}setXY(F,G){return this._x=F,this._y=G,this._index=this.x+this.y*320<<2,this}equals(F){return this.x==F.x&&this.y==F.y}}function w0(F){return new Promise(async(G)=>{const J=new FileReader;J.readAsDataURL(F),J.addEventListener("load",()=>{const $=new Image;$.src=J.result,$.addEventListener("load",()=>{if($.width>V.DrawWidth||$.height>V.DrawHeight){const X=$.width/V.DrawWidth,W=$.height/V.DrawHeight;let Q=V.DrawWidth,E=V.DrawHeight;if(X>W)E=$.height/X;else Q=$.width/W;const z=document.createElement("canvas");z.width=Q,z.height=E,z.getContext("2d").drawImage($,0,0,Q,E),$.src=z.toDataURL(F.type)}$.dataset.url=$.src,G($)})})})}function M0(F){return new Promise(async(G)=>{const J=new Image;J.src=typeof F==="string"?F:`data:${F.type};base64,${F.data}`,J.addEventListener("load",()=>{J.dataset.url=J.src,G(J)})})}function A0(F){return new Promise(async(G)=>{const J=new Image;J.src=F,J.addEventListener("load",()=>{const $=document.createElement("canvas");$.width=J.width,$.height=J.height,$.getContext("2d").drawImage(J,0,0,J.width,J.height),J.dataset.url=$.toDataURL("image/png"),G(J)})})}function o(F=32){const G=[];for(let J=0;J<F;J++)G[J]="0123456789abcdefghijklmnopqrstuvwxyz".charAt(Math.random()*"0123456789abcdefghijklmnopqrstuvwxyz".length);return G.join("")}function p(F){const G=globalThis.document,J=G.createElement("style");J.appendChild(G.createTextNode(F)),G.head.append(J)}p(".iX7Jnq_selector-wrapper{background:var(--ui-secondary);width:150px;position:relative}.iX7Jnq_selector-items-wrapper{width:150px;min-height:100%;padding-bottom:100px}.iX7Jnq_selector-item{width:5rem;height:5rem;margin:.5rem auto}.iX7Jnq_delete-menu-item:hover{background:var(--error-primary)}.iX7Jnq_add-button-wrapper{background:linear-gradient(transparent,var(--ui-secondary));width:100%;height:100px;display:flex;position:absolute;bottom:0;left:0;right:0}.iX7Jnq_add-button{margin:.75rem auto}");var e={addButton:"iX7Jnq_add-button",selectorItem:"iX7Jnq_selector-item",selectorWrapper:"iX7Jnq_selector-wrapper",selectorItemsWrapper:"iX7Jnq_selector-items-wrapper",deleteMenuItem:"iX7Jnq_delete-menu-item",addButtonWrapper:"iX7Jnq_add-button-wrapper"};var _0="./assets/icon-sprite-d18dd1c39449bd1f.svg";var v0="./assets/icon-backdrop-b2bc77fff077fbb7.svg";var B0="./assets/icon-surprise-8aa9e285645a254d.svg";var k0="./assets/icon-search-da6ddbb0d3689046.svg";var P0="./assets/icon-paint-8a2941791fc8f1c0.svg";var S0="./assets/icon-file-upload-8698118c8522bf00.svg";import{jsx as F0} from"preact/jsx-runtime";function X0({mode:F,imageList:G,imageIndex:J,onSelect:$,onShowAlert:X,onHideAlert:W,onSetupLibrary:Q}){const[E,z]=W0(!1),[w,B]=W0(!1),[k,h]=W0(!1),{getText:P}=F5(),{addAsset:u,deleteAsset:m,modifyFile:b}=G5(),M=G.map((Y)=>Y.id),{ImagesLibrary:c,BackdropsLibrary:f,CostumesLibrary:y}=Q(),D=()=>{if(F==="costume"){z(!1),B(!0),h(!1);return}if(F==="backdrop"){z(!1),B(!1),h(!0);return}z(!0),B(!1),h(!1)},H=()=>{z(!1),B(!1),h(!1)},C=async(Y)=>{const U=o();X("importing",{id:U});const A=await A0(`./assets/${Y.id}.png`);u({...Y,id:U,type:"image/png",data:A.dataset.url.slice("data:image/png;base64,".length),width:A.width,height:A.height}),M.push(U),W(U),b({assets:M,frame:M.length-1})},x=()=>{if(F==="costume"){C(y.surprise());return}if(F==="backdrop"){C(f.surprise());return}C(c.surprise())},T=(Y,U,A)=>{if(F==="costume")return U;if(F==="backdrop")return A;return Y},l=(Y)=>`data:${Y.type};base64,${Y.data}`,d=(Y)=>{b({frame:Y}),$(M[Y])},Z=()=>{const Y=document.createElement("input");Y.type="file",Y.accept="image/*",Y.multiple=!0,Y.click(),Y.addEventListener("change",async(U)=>{const A=o();X("importing",{id:A});for(let L of U.target.files){const r=o(),Z0=L.name.slice(0,L.name.lastIndexOf(".")),Y0=await w0(L);u({id:r,type:L.type,name:Z0,data:Y0.dataset.url.slice(`data:${L.type};base64,`.length),width:Y0.width,height:Y0.height,centerX:Math.floor(Y0.width/2),centerY:Math.floor(Y0.height/2)}),M.push(r)}W(A),b({assets:M,frame:M.length-1})})},q=()=>{const Y=o();u({id:Y,type:"image/png",name:P(`pixelPaint.painter.${F}`,F),data:"iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAAtJREFUGFdjYAACAAAFAAGq1chRAAAAAElFTkSuQmCC",width:1,height:1,centerX:1,centerY:1}),M.push(Y),b({assets:M,frame:M.length-1})},K=(Y)=>{m(M[Y]),M.splice(Y,1),b({assets:M,frame:J===0?0:Y>J?J:J-1})},O=(Y)=>{const U=G[Y],A=o();u({...U,id:A}),M.push(A),b({assets:M,frame:M.length-1})};return F0("div",{className:e.selectorWrapper,children:[F0(J5,{displayOrder:!0,id:"paint-selector",className:e.selectorItemsWrapper,items:G.map((Y,U)=>({...Y,details:`${Y.width}\xD7${Y.height}`,icon:l(Y),order:U,className:e.selectorItem,contextMenu:[[{label:P("pixelPaint.contextMenu.duplicate","duplicate"),onClick:()=>O(U)},{label:P("pixelPaint.contextMenu.export","export"),disabled:!0}],[{label:P("pixelPaint.contextMenu.delete","delete"),className:e.deleteMenuItem,disabled:G.length<=1,onClick:()=>K(U)}]]})),selectedIndex:J,onSelect:d,onDelete:G.length>1&&K}),F0("div",{className:e.addButtonWrapper,children:F0(Y5,{tooltipPlacement:"right",className:e.addButton,icon:F==="costume"?_0:v0,tooltip:T(P("pixelPaint.actionButton.image","Choose a Image"),P("pixelPaint.actionButton.costume","Choose a Costume"),P("pixelPaint.actionButton.backdrop","Choose a Backdrop")),onClick:D,moreButtons:[{icon:S0,tooltip:T(P("pixelPaint.actionButton.upload","Upload Image"),P("pixelPaint.actionButton.uploadCostume","Upload Costume"),P("pixelPaint.actionButton.uploadBackdrop","Upload Backdrop")),onClick:Z},{icon:B0,tooltip:P("pixelPaint.actionButton.surprise","Surprise"),onClick:x},{icon:P0,tooltip:P("pixelPaint.actionButton.paint","Paint"),onClick:q},{icon:k0,tooltip:T(P("pixelPaint.actionButton.image","Choose a Image"),P("pixelPaint.actionButton.costume","Choose a Costume"),P("pixelPaint.actionButton.backdrop","Choose a Backdrop")),onClick:D}]})}),E&&c&&F0(c,{onClose:H,onSelect:C}),w&&y&&F0(y,{onClose:H,onSelect:C}),k&&f&&F0(f,{onClose:H,onSelect:C})]})}import{useEffect as D5,useState as s} from"preact/hooks";import{useLocale as f5,useEditor as L5} from"@blockcode/core";import{classNames as g,Label as z0,BufferedInput as C5,Input as d0,Button as J0} from"@blockcode/ui";class j{static decimalToHex(F){if(F<0)F+=16777216;let G=Number(F).toString(16);return G=`#${"000000".substr(0,6-G.length)}${G}`,G}static decimalToRgb(F){const G=F>>24&255,J=F>>16&255,$=F>>8&255,X=F&255;return{r:J,g:$,b:X,a:G>0?G:255}}static hexToRgb(F){const G=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;F=F.replace(G,($,X,W,Q)=>X+X+W+W+Q+Q);const J=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(F);return J?{r:parseInt(J[1],16),g:parseInt(J[2],16),b:parseInt(J[3],16)}:null}static rgbToHex(F){return j.decimalToHex(j.rgbToDecimal(F))}static rgbToDecimal(F){return(F.r<<16)+(F.g<<8)+F.b}static hexToDecimal(F){return j.rgbToDecimal(j.hexToRgb(F))}static hsvToRgb(F){let G=F.h%360;if(G<0)G+=360;const J=Math.max(0,Math.min(F.s,1)),$=Math.max(0,Math.min(F.v,1)),X=Math.floor(G/60),W=G/60-X,Q=$*(1-J),E=$*(1-J*W),z=$*(1-J*(1-W));let w,B,k;switch(X){default:case 0:w=$,B=z,k=Q;break;case 1:w=E,B=$,k=Q;break;case 2:w=Q,B=$,k=z;break;case 3:w=Q,B=E,k=$;break;case 4:w=z,B=Q,k=$;break;case 5:w=$,B=Q,k=E;break}return{r:Math.floor(w*255),g:Math.floor(B*255),b:Math.floor(k*255)}}static rgbToHsv(F){const G=F.r/255,J=F.g/255,$=F.b/255,X=Math.min(Math.min(G,J),$),W=Math.max(Math.max(G,J),$);let Q=0,E=0;if(X!==W){const z=G===X?J-$:J===X?$-G:G-J;Q=((G===X?3:J===X?5:1)-z/(W-X))*60%360,E=(W-X)/W}return{h:Q,s:E,v:W}}static mixRgb(F,G,J){if(J<=0)return F;if(J>=1)return G;const $=1-J;return{r:$*F.r+J*G.r,g:$*F.g+J*G.g,b:$*F.b+J*G.b}}constructor(F,G=!1){if(this._clear=G,this._color=F,typeof F==="number")this._type="decimal";else if(typeof F==="string"&&F[0]==="#")this._type="hex";else if(Array.isArray(F)){const[J,$,X]=F;if($<=1&&X<=1)this._type="hsv",this._color={h:J,s:$,v:X};else this._type="rgb",this._color={r:J,g:$,b:X};this._clear=G||F[3]===0}else if(typeof F.r==="number")this._type="rgb";else if(typeof F.h==="number")this._type="hsv"}get clear(){return this._clear}get rgb(){if(this._type==="rgb")return this._color;if(this._type==="decimal")return j.decimalToRgb(this._color);if(this._type==="hsv")return j.hsvToRgb(this._color);if(this._type==="hex")return j.hexToRgb(this._color)}get hsv(){if(this._type==="hsv")return this._color;if(this._type==="decimal")return j.rgbToHsv(j.decimalToRgb(this._color));if(this._type==="rgb")return j.rgbToHsv(this._color);if(this._type==="hex")return j.rgbToHsv(j.hexToRgb(this._color))}get hex(){if(this._type==="hex")return this._color;if(this._type==="decimal")return j.decimalToHex(this._color);if(this._type==="rgb")return j.rgbToHex(this._color);if(this._type==="hsv")return j.rgbToHex(j.hsvToRgb(this._color))}get decimal(){if(this._type==="decimal")this._color;if(this._type==="rgb")return j.rgbToDecimal(this._color);if(this._type==="hsv")return j.rgbToDecimal(j.hsvToRgb(this._color));if(this._type==="hex")return j.hexToDecimal(this._color)}toRGBColor(){if(this._type==="rgb")return this;return new j(this.rgb,this.clear)}toHSVColor(){if(this._type==="hsv")return this;return new j(this.hsv,this.clear)}toHEXColor(){if(this._type==="hex")return this;return new j(this.hex,this.clear)}toDecimalColor(){if(this._type==="decimal")return this;return new j(this.decimal,this.clear)}equals(F){return this.rgb.r===F.rgb.r&&this.rgb.g===F.rgb.g&&this.rgb.b===F.rgb.b&&this.clear===F.clear}notEquals(F){return!this.equals(F)}}function O0(F){const G=Z5(F),J=$5(F,G),$=q5(F,G,J),X=K5(F,G,J,$),W={top:G||0,left:$||0,right:X||0,bottom:J||0};return W.width=W.right-W.left+1,W.height=W.bottom-W.top+1,W}var Z5=(F)=>{let G;for(let J=0;J<F.height;J++){G=J*F.width;for(let $=0;$<F.width;$++){if(F.data[(G<<2)+3]!==0)return J;G++}}},$5=(F,G)=>{let J;for(let $=F.height-1;$>=G;$--){J=$*F.width;for(let X=0;X<F.width;X++){if(F.data[(J<<2)+3]!==0)return $;J++}}},q5=(F,G,J)=>{let $;for(let X=0;X<F.width;X++)for(let W=G;W<=J;W++)if($=W*F.width+X,F.data[($<<2)+3]!==0)return X},K5=(F,G,J,$)=>{let X;for(let W=F.width-1;W>=$;W--)for(let Q=G;Q<=J;Q++)if(X=Q*F.width+W,F.data[(X<<2)+3]!==0)return W};function h0(F){const{top:G,left:J,width:$,height:X}=O0(F),W=Math.floor(F.width/2-J),Q=Math.floor(F.height/2-G),E=document.createElement("canvas");E.width=$,E.height=X,E.getContext("2d").putImageData(F,-J,-G,J,G,$,X);const[w,B]=E.toDataURL().slice(5).split(";base64,");return{type:w,data:B,width:$,height:X,centerX:W,centerY:Q}}import{classNames as G0,Text as E0,Tooltip as W5} from"@blockcode/ui";p(".XVx2ga_color-picker-wrapper{margin-right:var(--space);cursor:pointer;width:3rem;height:2rem;display:flex}.XVx2ga_color-swatch{border:1px solid var(--ui-black-transparent);border-top-left-radius:var(--form-radius);border-bottom-left-radius:var(--form-radius);flex-shrink:0;flex-basis:2rem;height:100%;display:flex;position:relative}.XVx2ga_color-swatch-outline:after{content:\"\";background:var(--ui-white);border:1px solid var(--ui-black-transparent);z-index:1;width:.75rem;height:.75rem;position:absolute;top:.5rem;left:.5rem}.XVx2ga_picker-arrow{user-select:none;border:1px solid var(--ui-black-transparent);border-top-right-radius:var(--form-radius);border-bottom-right-radius:var(--form-radius);border-left:0;flex-shrink:0;flex-basis:1rem;justify-content:center;align-items:center;height:100%;font-size:.75rem;display:flex}.XVx2ga_color-tooltip{background:var(--ui-white);color:var(--text-primary);padding:calc(var(--space)/2)}.XVx2ga_tooltip-item{margin:8px}.XVx2ga_tooltip-item-label{font-weight:700}.XVx2ga_tooltip-item-readout{margin-left:10px}.XVx2ga_tooltip-item-slider{border-radius:11px;outline:none;width:150px;height:22px;margin-bottom:20px;position:relative}.XVx2ga_tooltip-item-slider-handler{background-color:var(--ui-white);box-shadow:0 0 0 4px var(--ui-black-transparent);touch-action:none;border-radius:100%;width:26px;height:26px;margin-top:-2px;position:absolute;left:100px}.XVx2ga_tooltip-item-toolbar{justify-content:space-between;display:flex}.XVx2ga_tooltip-item-toolbar-button{border:1px solid var(--ui-black-transparent);border-radius:var(--form-radius);cursor:pointer;width:calc(1.5rem + 2px);height:calc(1.5rem + 2px)}.XVx2ga_tooltip-item-toolbar-button.XVx2ga_selected{border:1px solid #855cd6;box-shadow:0 0 0 3px #855cd659}.XVx2ga_button-icon{width:1.5rem;height:1.5rem}");var _={tooltipItemToolbar:"XVx2ga_tooltip-item-toolbar",selected:"XVx2ga_selected",colorSwatchOutline:"XVx2ga_color-swatch-outline",buttonIcon:"XVx2ga_button-icon",colorTooltip:"XVx2ga_color-tooltip",tooltipItemToolbarButton:"XVx2ga_tooltip-item-toolbar-button",tooltipItemReadout:"XVx2ga_tooltip-item-readout",colorPickerWrapper:"XVx2ga_color-picker-wrapper",colorSwatch:"XVx2ga_color-swatch",pickerArrow:"XVx2ga_picker-arrow",tooltipItemSlider:"XVx2ga_tooltip-item-slider",tooltipItem:"XVx2ga_tooltip-item",tooltipItemLabel:"XVx2ga_tooltip-item-label",tooltipItemSliderHandler:"XVx2ga_tooltip-item-slider-handler"};var D0="./assets/icon-picker-84c34a6f34788fe2.svg";var U0="./assets/icon-clear-ad3d0ac9d8fa6cb0.svg";import{jsx as v,Fragment as O5} from"preact/jsx-runtime";var X5=[0,0,324,288,252,216,180,144,108,72,36,0,0],n=124;function $0({picking:F,color:G,outline:J,onChange:$,onPickColor:X}){const W=G.hsv.h,Q=G.hsv.s,E=G.hsv.v,z=(H,C,x,T)=>new j({h:H,s:C,v:x},T),w=(H)=>$(z(Math.round(H*360),Q,E)),B=(H)=>$(z(W,H,E)),k=(H)=>$(z(W,Q,H)),h=()=>$(z(W,Q,E,!0)),P=(H,C)=>{H.stopPropagation();const x=H.target,T=x.offsetLeft,l=H.clientX,d=(q)=>{q.preventDefault();let K=q.clientX-l+T;if(K>=n)K=n;if(K<=0)K=0;x.style.left=`${K}px`,C(K/n)},Z=()=>{document.removeEventListener("mousemove",d),document.removeEventListener("mouseup",Z)};document.addEventListener("mousemove",d),document.addEventListener("mouseup",Z)},u=(H)=>P(H,w),m=(H)=>P(H,B),b=(H)=>P(H,k),M=(H,C)=>{const x=H.target.children[0];let T=H.offsetX-13;if(T>=n)T=n;if(T<=0)T=0;x.style.left=`${T}px`,C(T/n)},c=(H)=>M(H,w),f=(H)=>M(H,B),y=(H)=>M(H,k),D=X5.map((H)=>z(H,Q,E).hex);return v(W5,{clickable:!0,placement:"bottom",className:_.colorTooltip,onHide:()=>X(!1),content:v(O5,{children:[v("div",{className:_.tooltipItem,children:[v("span",{className:_.tooltipItemLabel,children:v(E0,{id:"pixelPaint.colorPicker.color",defaultMessage:"Color"})}),v("span",{className:_.tooltipItemReadout,children:Math.round(W/360*100)})]}),v("div",{className:G0(_.tooltipItem,_.tooltipItemSlider),style:{background:`linear-gradient(to left, ${D[0]} 0px, ${D[1]} 13px, ${D[2]}, ${D[3]}, ${D[4]}, ${D[5]}, ${D[6]}, ${D[7]}, ${D[8]}, ${D[9]}, ${D[10]}, ${D[11]} 137px, ${D[12]} 100%)`},onClick:c,children:v("div",{className:_.tooltipItemSliderHandler,style:{left:`${Math.round(W/360*n)}px`},onMouseDown:u,onClick:(H)=>H.stopPropagation()})}),v("div",{className:_.tooltipItem,children:[v("span",{className:_.tooltipItemLabel,children:v(E0,{id:"pixelPaint.colorPicker.saturation",defaultMessage:"Saturation"})}),v("span",{className:_.tooltipItemReadout,children:Math.round(Q*100)})]}),v("div",{className:G0(_.tooltipItem,_.tooltipItemSlider),style:{background:`linear-gradient(to right, ${z(W,0,E).hex} 0px, ${z(W,1,E).hex} 100%)`},onClick:f,children:v("div",{className:_.tooltipItemSliderHandler,style:{left:`${Math.round(Q*n)}px`},onMouseDown:m,onClick:(H)=>H.stopPropagation()})}),v("div",{className:_.tooltipItem,children:[v("span",{className:_.tooltipItemLabel,children:v(E0,{id:"pixelPaint.colorPicker.brightness",defaultMessage:"Brightness"})}),v("span",{className:_.tooltipItemReadout,children:Math.round(E*100)})]}),v("div",{className:G0(_.tooltipItem,_.tooltipItemSlider),style:{background:`linear-gradient(to right, ${z(W,Q,0).hex} 0px, ${z(W,Q,1).hex} 100%)`},onClick:y,children:v("div",{className:_.tooltipItemSliderHandler,style:{left:`${Math.round(E*n)}px`},onMouseDown:b,onClick:(H)=>H.stopPropagation()})}),v("div",{className:G0(_.tooltipItem,_.tooltipItemToolbar),children:[v("div",{className:G0(_.tooltipItemToolbarButton,{[_.selected]:G.clear}),onClick:h,children:v("img",{src:U0,className:_.buttonIcon})}),v("div",{className:G0(_.tooltipItemToolbarButton,{[_.selected]:F}),onClick:X,children:v("img",{src:D0,className:_.buttonIcon})})]})]}),children:v("div",{className:_.colorPickerWrapper,children:[v("div",{className:G0(_.colorSwatch,{[_.colorSwatchOutline]:J}),style:{background:G.clear?"var(--ui-white)":z(W,Q,E).hex},children:G.clear&&v("img",{src:U0})}),v("div",{className:_.pickerArrow,children:"\u25BE"})]})})}import{useLocale as M5} from"@blockcode/core";import{classNames as i,Button as a} from"@blockcode/ui";p(".OKvKKW_tool-box-wrapper{flex-flow:wrap;place-content:flex-start space-between;width:7rem;display:flex}.OKvKKW_tool-button{margin:calc(var(--space)/2);border-radius:calc(var(--space)/2);padding:calc(var(--space)/2);user-select:none;background:0 0;border:none;outline:none;transition:all .2s;display:inline-block}.OKvKKW_tool-button.OKvKKW_selected{background:var(--motion-primary)}.OKvKKW_tool-icon{vertical-align:middle;width:2rem;height:2rem}.OKvKKW_tool-button.OKvKKW_selected .OKvKKW_tool-icon{filter:brightness(0)invert()}");var S={selected:"OKvKKW_selected",toolBoxWrapper:"OKvKKW_tool-box-wrapper",toolIcon:"OKvKKW_tool-icon",toolButton:"OKvKKW_tool-button"};var q0="./assets/icon-pen-feefe485db8ab4fb.svg";var K0="./assets/icon-eraser-d74093113b7d2e66.svg";var f0="./assets/icon-fill-88af433e88f940a7.svg";var L0="./assets/icon-text-506c9e59be31058e.svg";var C0="./assets/icon-line-5ccd8ec9d6c1c618.svg";var T0="./assets/icon-rectangle-b3097e20fe790a9e.svg";var I0="./assets/icon-circle-5328f8d4320e955e.svg";var b0="./assets/icon-select-70c5ba0720e0d0e7.svg";import{jsx as I} from"preact/jsx-runtime";function H0({selectedTool:F,onSelect:G}){const{getText:J}=M5();return I("div",{className:S.toolBoxWrapper,children:[I(a,{className:i(S.toolButton,{[S.selected]:F==="pen"}),onClick:()=>G("pen"),children:I("img",{src:q0,className:S.toolIcon,title:J("pixelPaint.painter.pen","Pen")})}),I(a,{className:i(S.toolButton,{[S.selected]:F==="eraser"}),onClick:()=>G("eraser"),children:I("img",{src:K0,className:S.toolIcon,title:J("pixelPaint.painter.eraser","Eraser")})}),I(a,{className:i(S.toolButton,{[S.selected]:F==="fill"}),onClick:()=>G("fill"),children:I("img",{src:f0,className:S.toolIcon,title:J("pixelPaint.painter.fill","Fill")})}),I(a,{disabled:!0,className:i(S.toolButton,{[S.selected]:F==="text"}),onClick:()=>G("text"),children:I("img",{src:L0,className:S.toolIcon,title:J("pixelPaint.painter.text","Text")})}),I(a,{disabled:!0,className:i(S.toolButton,{[S.selected]:F==="line"}),onClick:()=>G("line"),children:I("img",{src:C0,className:S.toolIcon,title:J("pixelPaint.painter.line","Line")})}),I(a,{disabled:!0,className:i(S.toolButton,{[S.selected]:F==="rectangle"}),onClick:()=>G("rectangle"),children:I("img",{src:T0,className:S.toolIcon,title:J("pixelPaint.painter.rectangle","Rectangle")})}),I(a,{disabled:!0,className:i(S.toolButton,{[S.selected]:F==="circle"}),onClick:()=>G("circle"),children:I("img",{src:I0,className:S.toolIcon,title:J("pixelPaint.painter.circle","Circle")})}),I(a,{disabled:!0,className:i(S.toolButton,{[S.selected]:F==="select"}),onClick:()=>G("select"),children:I("img",{src:b0,className:S.toolIcon,title:J("pixelPaint.painter.select","Select")})})]})}import{useRef as _5,useEffect as u0,useState as v5} from"preact/hooks";import{classNames as x0} from"@blockcode/ui";p(".k7sJxq_draw-box{background:var(--ui-secondary);width:100%;height:100%;display:flex;position:absolute;top:0;left:0;overflow:auto}.k7sJxq_draw-canvas-wrapper{margin:auto;position:relative}.k7sJxq_draw-canvas{image-rendering:pixelated;background:url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+CjwhLS0gQ3JlYXRlZCB3aXRoIFZlY3Rvcm5hdG9yIChodHRwOi8vdmVjdG9ybmF0b3IuaW8vKSAtLT4KPHN2ZyBoZWlnaHQ9IjMwIiB3aWR0aD0iMzAiIHN0cm9rZS1taXRlcmxpbWl0PSIxMCIgc3R5bGU9ImZpbGwtcnVsZTpub256ZXJvO2NsaXAtcnVsZTpldmVub2RkO3N0cm9rZS1saW5lY2FwOnJvdW5kO3N0cm9rZS1saW5lam9pbjpyb3VuZDsiIHZlcnNpb249IjEuMSIgdmlld0JveD0iMCAwIDQwIDQwIiB4bWw6c3BhY2U9InByZXNlcnZlIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIj4KPGRlZnMvPgo8Zz4KPHBhdGggZD0iTTAgMEw0MCAwTDQwIDQwTDAgNDBMMCAwWiIgZmlsbD0iI2ZmZmZmZiIgZmlsbC1ydWxlPSJub256ZXJvIiBvcGFjaXR5PSIxIiBzdHJva2U9Im5vbmUiLz4KPHBhdGggZD0iTTAgMEwyMCAwTDIwIDIwTDAgMjBMMCAwWiIgZmlsbD0iI2VhZjBmOCIgZmlsbC1ydWxlPSJub256ZXJvIiBvcGFjaXR5PSIxIiBzdHJva2U9Im5vbmUiLz4KPHBhdGggZD0iTTIwIDIwTDQwIDIwTDQwIDQwTDIwIDQwTDIwIDIwWiIgZmlsbD0iI2VhZjBmOCIgZmlsbC1ydWxlPSJub256ZXJvIiBvcGFjaXR5PSIxIiBzdHJva2U9Im5vbmUiLz4KPC9nPgo8L3N2Zz4K);width:320px;height:240px}.k7sJxq_draw-canvas.k7sJxq_center{cursor:crosshair}.k7sJxq_draw-canvas.k7sJxq_picker{cursor:url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+Cjxzdmcgd2lkdGg9IjIwcHgiIGhlaWdodD0iMjBweCIgdmlld0JveD0iMCAwIDIwIDIwIiB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiPgogICAgPCEtLSBHZW5lcmF0b3I6IFNrZXRjaCA0My4yICgzOTA2OSkgLSBodHRwOi8vd3d3LmJvaGVtaWFuY29kaW5nLmNvbS9za2V0Y2ggLS0+CiAgICA8dGl0bGU+ZXllLWRyb3BwZXI8L3RpdGxlPgogICAgPGRlc2M+Q3JlYXRlZCB3aXRoIFNrZXRjaC48L2Rlc2M+CiAgICA8ZGVmcz48L2RlZnM+CiAgICA8ZyBpZD0iUGFnZS0xIiBzdHJva2U9Im5vbmUiIHN0cm9rZS13aWR0aD0iMSIgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIj4KICAgICAgICA8ZyBpZD0iZXllLWRyb3BwZXIiIGZpbGw9IiM1NzVFNzUiPgogICAgICAgICAgICA8cGF0aCBkPSJNOS4xNTMzNDYwNSwxMi40ODI0OTYyIEM5LjAzMzk0MDQ0LDEyLjYxODg3MzcgOC44ODA0MTg5NSwxMi43MDQxMDk2IDguNjA3NDkxODYsMTIuNzcyMjk4MyBDNy45MDgxMTYxOCwxMi45MjU3MjMgNy4yNDI4NTYzOSwxMy41NTY0Njg4IDcuMDM4MTYxMDcsMTQuMjU1NDAzMyBDNi45Njk5MjkzLDE0LjQ3NzAxNjcgNi43NDgxNzYwMywxNC43MTU2NzczIDYuNTA5MzY0ODMsMTQuODM1MDA3NiBMNC43MzUzMzg3MSwxNS42NzAzMTk2IEM0LjY1MDA0OSwxNS43MDQ0MTQgNC41ODE4MTcyMiwxNS43MjE0NjEyIDQuNTQ3NzAxMzQsMTUuNzIxNDYxMiBMNC4yNzQ3NzQyNCwxNS40NjU3NTM0IEM0LjI3NDc3NDI0LDE1LjQ0ODcwNjIgNC4yNzQ3NzQyNCwxNS4zODA1MTc1IDQuMzI1OTQ4MDcsMTUuMjYxMTg3MiBMNS4xNjE3ODczLDEzLjQ3MTIzMjkgQzUuMjY0MTM0OTYsMTMuMjQ5NjE5NSA1LjUwMjk0NjE3LDEzLjAyODAwNjEgNS43NDE3NTczNywxMi45NTk4MTc0IEM2LjQ0MTEzMzA1LDEyLjczODIwNCA3LjA3MjI3Njk2LDEyLjA5MDQxMSA3LjI1OTkxNDMzLDExLjIzODA1MTggQzcuMjk0MDMwMjIsMTEuMTAxNjc0MyA3LjM3OTMxOTk0LDEwLjk2NTI5NjggNy40OTg3MjU1NCwxMC44Mjg5MTkzIEwxMS40MzkxMTA1LDYuOTA4MDY2OTcgTDEzLjA5MzczMSw4LjU2MTY0Mzg0IEw5LjE1MzM0NjA1LDEyLjQ4MjQ5NjIgWiBNMTYuNjA3NjY3Myw1LjI4ODU4NDQ3IEMxNi44NjM1MzY1LDUuMDMyODc2NzEgMTcsNC42NzQ4ODU4NCAxNyw0LjMzMzk0MjE2IEMxNywzLjk5Mjk5ODQ4IDE2Ljg2MzUzNjUsMy42NTIwNTQ3OSAxNi42MDc2NjczLDMuMzk2MzQ3MDMgQzE2LjA3ODg3MTEsMi44Njc4ODQzMiAxNS4yNDMwMzE4LDIuODY3ODg0MzIgMTQuNzE0MjM1NiwzLjM5NjM0NzAzIEwxMy4yMzAxOTQ1LDQuODc5NDUyMDUgTDEzLjA1OTYxNTEsNC43MDg5ODAyMSBMMTIuNTEzNzYwOSw0LjE2MzQ3MDMyIEMxMi4xNzI2MDIsMy44MjI1MjY2NCAxMS42MDk2ODk5LDMuODIyNTI2NjQgMTEuMjY4NTMxLDQuMTYzNDcwMzIgTDEwLjYwMzI3MTIsNC44MTEyNjMzMiBDMTAuMjc5MTcwMyw1LjE1MjIwNyAxMC4yNjIxMTI0LDUuNjQ2NTc1MzQgMTAuNTUyMDk3NCw1Ljk4NzUxOTAzIEw2LjU5NDY1NDU0LDkuOTI1NDE4NTcgQzYuMzA0NjY5NTEsMTAuMjMyMjY3OSA2LjA5OTk3NDE4LDEwLjU5MDI1ODggNS45ODA1Njg1OCwxMS4xMDE2NzQzIEM1LjkyOTM5NDc1LDExLjM1NzM4MiA1LjYzOTQwOTcxLDExLjY0NzE4NDIgNS4zNjY0ODI2MiwxMS43MzI0MjAxIEM0LjgwMzU3MDQ5LDExLjkwMjg5MTkgNC4yNTc3MTYzLDEyLjM4MDIxMzEgNC4wMDE4NDcxNSwxMi45NDI3NzAyIEwzLjE2NjAwNzkyLDE0LjcxNTY3NzMgQzIuODkzMDgwODMsMTUuMzEyMzI4OCAyLjk2MTMxMjYsMTUuOTI2MDI3NCAzLjMzNjU4NzM2LDE2LjMxODExMjYgTDMuNjc3NzQ2MjMsMTYuNjU5MDU2MyBDMy44OTk0OTk0OSwxNi44ODA2Njk3IDQuMjA2NTQyNDcsMTcgNC41NDc3MDEzNCwxNyBDNC43Njk0NTQ2LDE3IDUuMDI1MzIzNzUsMTYuOTMxODExMyA1LjI2NDEzNDk2LDE2LjgyOTUyODIgTDcuMDU1MjE5MDEsMTUuOTk0MjE2MSBDNy42MTgxMzExNCwxNS43MjE0NjEyIDguMDk1NzUzNTYsMTUuMTkyOTk4NSA4LjI2NjMzMjk5LDE0LjYzMDQ0MTQgQzguMzM0NTY0NzcsMTQuMzU3Njg2NSA4LjY0MTYwNzc1LDE0LjA2Nzg4NDMgOS4wNTA5OTgzOSwxMy45ODI2NDg0IEM5LjQwOTIxNTIsMTMuODk3NDEyNSA5Ljc2NzQzMjAxLDEzLjY5Mjg0NjMgMTAuMDU3NDE3LDEzLjM4NTk5NyBMMTQuMDE0ODU5OSw5LjQ0ODA5NzQxIEMxNC4zNTYwMTg4LDkuNzM3ODk5NTQgMTQuODY3NzU3MSw5LjcwMzgwNTE4IDE1LjE3NDgwMDEsOS4zNzk5MDg2OCBMMTUuODQwMDU5OSw4LjczMjExNTY4IEMxNi4xODEyMTg3LDguMzkxMTcxOTkgMTYuMTgxMjE4Nyw3LjgyODYxNDkyIDE1Ljg0MDA1OTksNy40ODc2NzEyMyBMMTUuMjYwMDg5OCw2LjkwODA2Njk3IEwxNS4xMjM2MjYyLDYuNzcxNjg5NSBMMTYuNjA3NjY3Myw1LjI4ODU4NDQ3IFoiIGlkPSJleWUtZHJvcHBlci1pY29uIj48L3BhdGg+CiAgICAgICAgPC9nPgogICAgPC9nPgo8L3N2Zz4=) 4 15,crosshair}.k7sJxq_center-icon{pointer-events:none;filter:opacity(.5);position:absolute;top:0;left:0;transform:translate(-50%,-50%)}.k7sJxq_center-icon.k7sJxq_hidden{display:none}");var t={drawCanvas:"k7sJxq_draw-canvas",drawCanvasWrapper:"k7sJxq_draw-canvas-wrapper",drawBox:"k7sJxq_draw-box",center:"k7sJxq_center",centerIcon:"k7sJxq_center-icon",hidden:"k7sJxq_hidden",picker:"k7sJxq_picker"};var Q0="./assets/icon-center-efd037807b3d5feb.svg";import{jsx as V0} from"preact/jsx-runtime";function R0({image:F,selectedTool:G,zoom:J,undoList:$,onChange:X,onChangeColor:W}){const Q=_5(),[E,z]=v5(),w=G.fillColor||new j([0,0,0]),B=G.outlineColor||new j([0,0,0]);let k,h;const P=()=>{h=E.getImageData(0,0,V.DrawWidth,V.DrawHeight)},u=(Z=0,q=0)=>{E.clearRect(0,0,V.DrawWidth,V.DrawHeight),E.putImageData(h,Z,q)},m=()=>{X(h),h=null},b=()=>{let Z=new OffscreenCanvas(V.DrawWidth,V.DrawHeight),q=Z.getContext("2d",{willReadFrequently:!0});q.imageSmoothingEnabled=!1,q.putImageData($.at(-1),0,0),h=q.getImageData(0,0,V.DrawWidth,V.DrawHeight),q=null,Z=null},M=(Z,q)=>{if(Z.invalid)return;const K=Z.index;h.data[K+0]=q.r,h.data[K+1]=q.g,h.data[K+2]=q.b,h.data[K+3]=q.a===0?0:255},c=(Z,q,K,O)=>{M(new V(Z.x-q,Z.y+K),O),M(new V(Z.x+q,Z.y+K),O),M(new V(Z.x+q,Z.y-K),O),M(new V(Z.x-q,Z.y-K),O),M(new V(Z.x-K,Z.y+q),O),M(new V(Z.x+K,Z.y+q),O),M(new V(Z.x+K,Z.y-q),O),M(new V(Z.x-K,Z.y-q),O)},f=(Z,q,K)=>{const O=Math.abs(q.x-Z.x),Y=Math.abs(q.y-Z.y),U=Z.x<q.x?1:-1,A=Z.y<q.y?1:-1,L=new V(Z.x,Z.y);let r=O-Y;while(!0){if(M(L,K),L.x===q.x&&L.y===q.y)break;const Z0=2*r;if(Z0>-Y)r-=Y,L.x+=U;if(Z0<O)r+=O,L.y+=A}},y=(Z,q,K)=>{let O=Z.x,Y=q.x,U=Z.y,A=q.y;if(K.outline){const L=new V(Y,U),r=new V(O,A);f(Z,L,K.outline),f(q,r,K.outline),f(L,q,K.outline),f(r,Z,K.outline),O+=1,Y-=1,U+=1,A-=1}if(K.fill)for(let L=U;L<=A;L++)f(new V(O,L),new V(Y,L),K.fill)},D=(Z,q,K)=>{let O=0,Y=q,U=3-2*q;while(O<=Y){if(K.fill)for(let A=O;A<=Y;A++)c(Z,O,A,K.fill);if(K.outline)c(Z,O,Y,K.outline);if(U<0)U=U+4*O+6;else U=U+4*(O-Y),Y--;O++}},H=(Z)=>{if(Z.invalid)return;const q={clear:w.clear,fill:w.rgb,outline:!1};if(q.clear||G.type==="eraser"){if(q.fill.a=0,!k)q.fill={r:255,g:255,b:255},q.outline={r:138,g:187,b:255}}if(G.penSize===1)M(Z,!k&&(q.clear||G.type==="eraser")?q.outline:q.fill);else if(G.penSize===3)y(new V(Z.x-1,Z.y-1),new V(Z.x+1,Z.y+1),q);else if(G.penSize<5){const K=G.penSize/2;y(new V(Z.x-K,Z.y-K),new V(Z.x+K-1,Z.y+K-1),q)}else D(Z,Math.floor((G.penSize-1)/2),q)},C=(Z)=>{if(Z.invalid)return;const q=new j(Array.from(h.data.slice(Z.index,Z.index+3))),K=[],O=(Y)=>{if(Y.invalid)return;if(!K.includes(Y.index)){const U=new j(Array.from(h.data.slice(Y.index,Y.index+3)));if(U.equals(q)&&U.notEquals(w))K.push(Y.index)}};O(Z);while(K.length>0){const Y=K.shift();h.data[Y+0]=w.rgb.r,h.data[Y+1]=w.rgb.g,h.data[Y+2]=w.rgb.b,h.data[Y+3]=w.clear?0:255,Z=V.from(Y),O(Z.topPoint),O(Z.leftPoint),O(Z.rightPoint),O(Z.bottomPoint)}},x=(Z)=>{if(Z.preventDefault(),!Q.current)return;k=!0;const q=Q.current.getBoundingClientRect();let K=Z.clientX-q.left,O=Z.clientY-q.top;if(K=Math.floor(V.DrawWidth*K/Q.current.clientWidth),O=Math.floor(V.DrawHeight*O/Q.current.clientHeight),G.type==="pen"||G.type==="eraser"||G.type==="fill"){const U=new V(K,O);if(P(),G.type==="pen"||G.type==="eraser")H(U);else if(G.type==="fill")C(U);u()}else if(G.type.startsWith("picker-"))Z.stopPropagation();else if(G.type.startsWith("center")){const U=V.DrawWidth/2-K,A=V.DrawHeight/2-O;u(U,A),P()}const Y=()=>{if(k)k=!1,m();document.removeEventListener("mouseup",Y)};document.addEventListener("mouseup",Y)},T=(Z)=>{if(Z.preventDefault(),!Q.current)return;if(G.type==="center")return;const q=Q.current.getBoundingClientRect();let K=Z.clientX-q.left,O=Z.clientY-q.top;if(K=Math.floor(V.DrawWidth*K/Q.current.clientWidth),O=Math.floor(V.DrawHeight*O/Q.current.clientHeight),G.type==="pen"||G.type==="eraser"){const Y=new V(K,O);if(!k)b();else P();if(G.type==="pen"||G.type==="eraser")H(Y);u()}else if(G.type.startsWith("picker-"));},l=(Z)=>{if(Z.preventDefault(),k=!1,G.type==="center"){m();return}const q=Q.current.getBoundingClientRect();let K=Z.clientX-q.left,O=Z.clientY-q.top;if(K=Math.floor(V.DrawWidth*K/Q.current.clientWidth),O=Math.floor(V.DrawHeight*O/Q.current.clientHeight),G.type.startsWith("picker-")){const[Y,U,A,L]=E.getImageData(K,O,1,1).data;if(L===0){if(G.type==="picker-fill")W(new j(w.hsv,!0));if(G.type==="picker-outline")W(new j(B.hsv,!0))}else W(new j({r:Y,g:U,b:A}).toHSVColor());return}if(m(),G.type==="eraser")b(),H(new V(K,O)),u()},d=(Z)=>{if(Z.preventDefault(),!k)b(),u()};if(u0(()=>{if(Q.current){const Z=Q.current.getContext("2d",{willReadFrequently:!0});Z.imageSmoothingEnabled=!1,z(Z)}return()=>{}},[Q]),u0(()=>{if(Q.current){const Z=Q.current.parentElement.parentElement;let q=(Q.current.clientWidth-Z.clientWidth)/2,K=(Q.current.clientHeight-Z.clientHeight)/2;if(J>2){const Y=Z.clientWidth/2;if(q=(Z.scrollLeft+Y)/Z.dataset.scrollWidth*Q.current.clientWidth-Y,J>4){const U=Z.clientHeight/2;K=(Z.scrollTop+U)/Z.dataset.scrollHeight*Q.current.clientHeight-U}}Z.dataset.scrollWidth=Q.current.clientWidth,Z.dataset.scrollHeight=Q.current.clientHeight,Z.scroll({top:K>0?K:0,left:q>0?q:0});const O=Q.current.nextSibling;O.style.top=`${J*V.DrawHeight/2}px`,O.style.left=`${J*V.DrawWidth/2}px`}return()=>{}},[J]),E&&$.length===0)if(F)M0(F).then((Z)=>{const q=V.DrawWidth/2-F.centerX,K=V.DrawHeight/2-F.centerY;E.clearRect(0,0,V.DrawWidth,V.DrawHeight),E.drawImage(Z,q,K),P(),m()});else P(),m();if(E&&$.length>0)b(),u();return V0("div",{className:t.drawBox,children:V0("div",{className:t.drawCanvasWrapper,children:[V0("canvas",{ref:Q,className:x0(t.drawCanvas,{[t.center]:G.type==="center",[t.picker]:G.type.startsWith("picker-")}),width:V.DrawWidth,height:V.DrawHeight,style:{width:V.DrawWidth*J,height:V.DrawHeight*J},onMouseDown:x,onMouseMove:T,onMouseUp:l,onMouseLeave:d}),V0("img",{src:Q0,className:x0(t.centerIcon,{[t.hidden]:G.type!=="center"})})]})})}p(".sJoaoG_painter-wrapper{padding:calc(var(--space)*1.5);border-left:1px solid var(--ui-black-transparent);color:var(--text-primary);flex-direction:column;flex:1;display:flex}.sJoaoG_row{min-height:3rem;margin-bottom:.5rem;display:flex}.sJoaoG_row-fill{padding-top:calc(var(--space)*2.5);border-top:1px dashed var(--ui-black-transparent);flex-direction:row;flex:1}.sJoaoG_row-right{margin-right:var(--space);justify-content:right}.sJoaoG_row:last-child{min-height:unset;margin-bottom:0}.sJoaoG_group{margin-right:calc(var(--space)*1.5);flex-direction:row;align-items:center;display:inline-flex}.sJoaoG_disabled{opacity:.3;pointer-events:none}.sJoaoG_dashed-border{border-right:1px dashed var(--ui-black-transparent);padding-right:var(--space)}.sJoaoG_name-input{width:8rem}.sJoaoG_large-input{width:4rem}.sJoaoG_tool-icon{margin-right:var(--space);width:2rem;height:2rem}.sJoaoG_label-image{vertical-align:middle;margin-right:calc(var(--space)/2)}.sJoaoG_button{width:calc(2rem + 2px);height:calc(2rem + 2px);padding:.375rem!important}.sJoaoG_button-icon{margin:auto}.sJoaoG_group-button{border-left:none;border-radius:0}.sJoaoG_group-button-first{border-top-right-radius:0;border-bottom-right-radius:0}.sJoaoG_group-button-last{border-left:none;border-top-left-radius:0;border-bottom-left-radius:0}.sJoaoG_group-button-toggled-off{filter:saturate(0)}.sJoaoG_label-button{border:0;font-weight:400}.sJoaoG_label-button.sJoaoG_selected{background:var(--motion-primary);color:var(--ui-white)}.sJoaoG_label-button.sJoaoG_selected .sJoaoG_button-icon{filter:brightness(0)invert()}.sJoaoG_draw-box-wrapper{margin:0 var(--space);border:1px solid var(--ui-black-transparent);border-radius:calc(var(--space)/2);flex:1;position:relative;overflow:hidden}");var R={toolIcon:"sJoaoG_tool-icon",groupButtonFirst:"sJoaoG_group-button-first",nameInput:"sJoaoG_name-input",rowFill:"sJoaoG_row-fill",groupButtonToggledOff:"sJoaoG_group-button-toggled-off",disabled:"sJoaoG_disabled",painterWrapper:"sJoaoG_painter-wrapper",selected:"sJoaoG_selected",drawBoxWrapper:"sJoaoG_draw-box-wrapper",button:"sJoaoG_button",labelButton:"sJoaoG_label-button",buttonIcon:"sJoaoG_button-icon",largeInput:"sJoaoG_large-input",labelImage:"sJoaoG_label-image",group:"sJoaoG_group",groupButton:"sJoaoG_group-button",groupButtonLast:"sJoaoG_group-button-last",dashedBorder:"sJoaoG_dashed-border",row:"sJoaoG_row",rowRight:"sJoaoG_row-right"};var y0="./assets/icon-undo-92fd565bdcf5e457.svg";var p0="./assets/icon-redo-68a33bfc57bb7814.svg";var m0="./assets/icon-zoom-in-de37432ea621c379.svg";var c0="./assets/icon-zoom-out-4c68fd9c343d89de.svg";var g0="./assets/icon-zoom-reset-7cf90555286e353d.svg";import{jsx as N,Fragment as T5} from"preact/jsx-runtime";function j0({mode:F,imageList:G,imageIndex:J}){const{getText:$}=f5(),{modifyAsset:X}=L5(),[W,Q]=s(1),[E,z]=s("draw"),[w,B]=s("pen"),[k,h]=s(10),[P,u]=s(2),[m,b]=s(new j([260,0.6,1])),[M,c]=s(new j([0,1,0])),[f,y]=s([]),[D,H]=s([]),C=G[J],x=C&&C.id,T=!x,l=(Y,U,A)=>{if(F==="costume")return U;if(F==="backdrop")return A;return Y},d=(Y)=>{if(Y.id=x,Y.data){const U=h0(Y.data);Y.type=U.type,Y.data=U.data,Y.width=U.width,Y.height=U.height,Y.centerX=U.centerX,Y.centerY=U.centerY}X(Y)},Z=(Y,U)=>{const A={};if(Y==="name")A.name=U;if(Y==="data"){if(A.data=U,f.length>20)f.splice(1,1);if(y(f.concat(A.data)),H([]),f.length===0)return}if(d(A),E!=="draw")z("draw")},q=(Y)=>{if(E==="picker-fill")b(Y);if(E==="picker-outline")c(Y)},K=()=>{const Y=f.pop();y(f),H(D.concat(Y)),d({data:f.at(-1)})},O=()=>{const Y=D.pop();y(f.concat(Y)),H(D),d({data:Y})};return D5(()=>{return y([]),H([]),z("draw"),()=>{}},[x]),N("div",{className:R.painterWrapper,children:[N("div",{className:R.row,children:[N("div",{className:R.group,children:N(z0,{text:l($("pixelPaint.painter.image","Image"),$("pixelPaint.painter.costume","Costume"),$("pixelPaint.painter.backdrop","Backdrop")),children:N(C5,{disabled:T,className:R.nameInput,placeholder:$("pixelPaint.painter.name","name"),onSubmit:(Y)=>Z("name",Y),value:C?C.name:l($("pixelPaint.painter.image","Image"),$("pixelPaint.painter.costume","Costume"),$("pixelPaint.painter.backdrop","Backdrop"))})})}),N("div",{className:R.group,children:[N(J0,{disabled:f.length<=1,className:g(R.button,R.groupButtonFirst,{[R.groupButtonToggledOff]:T}),onClick:K,children:N("img",{src:y0,className:R.buttonIcon,title:$("pixelPaint.painter.undo","Undo")})}),N(J0,{disabled:D.length===0,className:g(R.button,R.groupButtonLast,{[R.groupButtonToggledOff]:T}),onClick:O,children:N("img",{src:p0,className:R.buttonIcon,title:$("pixelPaint.painter.redo","Redo")})})]}),N("div",{className:R.group,children:F==="costume"&&N(J0,{vertical:!0,className:g(R.labelButton,{[R.selected]:E==="center"}),onClick:()=>z(E!=="center"?"center":"draw"),children:[N("img",{src:Q0,className:R.buttonIcon,title:$("pixelPaint.painter.center","Center")}),N("span",{children:$("pixelPaint.painter.center","Center")})]})})]}),N("div",{className:R.row,children:[N("div",{className:R.group,children:N(z0,{text:$("pixelPaint.painter.fill","Fill"),children:N($0,{picking:E.startsWith("picker-"),color:m,onChange:b,onPickColor:(Y)=>z(Y===!1?"draw":"picker-fill")})})}),N("div",{className:g(R.group,R.dashedBorder),children:[N(z0,{className:g({[R.disabled]:!0}),text:$("pixelPaint.painter.outline","Outline"),children:N($0,{outline:!0,picking:E.startsWith("picker-"),color:M,onChange:c,onPickColor:(Y)=>z(Y===!1?"draw":"picker-outline")})}),N(d0,{small:!0,type:"number",min:0,max:100,step:1,className:g(R.largeInput,{[R.disabled]:!0}),value:P,onChange:(Y)=>u(Y.target.valueAsNumber)})]}),N("div",{className:R.group,children:w==="pen"||w==="eraser"?N(T5,{children:[N("img",{src:w==="pen"?q0:K0,className:R.toolIcon}),N(d0,{small:!0,type:"number",min:1,max:100,step:1,className:R.largeInput,value:k,onChange:(Y)=>h(Y.target.valueAsNumber)})]}):null})]}),N("div",{className:g(R.row,R.rowFill),children:[N(H0,{selectedTool:w,onSelect:B}),N("div",{className:R.drawBoxWrapper,children:N(R0,{image:C,zoom:W,selectedTool:{fillColor:m,outlineColor:M,penSize:k,outlineSize:P,type:E==="draw"?w:E},undoList:f,onChange:(Y)=>Z("data",Y),onChangeColor:q})})]}),N("div",{className:g(R.row,R.rowRight),children:[N(J0,{className:g(R.button,R.groupButtonFirst),onClick:()=>W-1>0&&Q(W-1),children:N("img",{src:c0,className:R.buttonIcon})}),N(J0,{className:g(R.button,R.groupButton),onClick:()=>Q(1),children:N("img",{src:g0,className:R.buttonIcon})}),N(J0,{className:g(R.button,R.groupButtonLast),onClick:()=>W+1<20&&Q(W+1),children:N("img",{src:m0,className:R.buttonIcon})})]})]})}p(".W9TdWW_pixel-paint-wrapper{background:var(--ui-white);border-radius:inherit;flex-grow:1;display:flex}");var r0={pixelPaintWrapper:"W9TdWW_pixel-paint-wrapper"};function u5({onShowAlert:F,onHideAlert:G,onSetupLibrary:J}){const[$,X]=I5(),{fileList:W,assetList:Q,selectedIndex:E}=b5();let z=Q.filter((k)=>/^image\//.test(k.type)),w="image";const B=W[E];if(B&&B.assets&&B.frame!=null){if(z=z.filter((k)=>B.assets.includes(k.id)),w=E===0?"backdrop":"costume",$!==B.frame)X(B.frame)}return N0("div",{className:r0.pixelPaintWrapper,children:[N0(X0,{mode:w,imageList:z,imageIndex:$,onSelect:X,onShowAlert:F,onHideAlert:G,onSetupLibrary:J}),N0(j0,{mode:w,imageIndex:$,imageList:z})]})}import{jsx as N0} from"preact/jsx-runtime";var n0={"pixelPaint.contextMenu.duplicate":"duplicate","pixelPaint.contextMenu.export":"export","pixelPaint.contextMenu.delete":"delete","pixelPaint.actionButton.upload":"Upload Image","pixelPaint.actionButton.uploadCostume":"Upload Costume","pixelPaint.actionButton.uploadBackdrop":"Upload Backdrop","pixelPaint.actionButton.surprise":"Surprise","pixelPaint.actionButton.paint":"Paint","pixelPaint.actionButton.image":"Choose a Image","pixelPaint.actionButton.costume":"Choose a Costume","pixelPaint.actionButton.backdrop":"Choose a Backdrop","pixelPaint.painter.image":"Image","pixelPaint.painter.costume":"Costume","pixelPaint.painter.backdrop":"Backdrop","pixelPaint.painter.name":"name","pixelPaint.painter.undo":"Undo","pixelPaint.painter.redo":"Redo","pixelPaint.painter.pen":"Pen","pixelPaint.painter.eraser":"Eraser","pixelPaint.painter.fill":"Fill","pixelPaint.painter.text":"Text","pixelPaint.painter.line":"Line","pixelPaint.painter.rectangle":"Rectangle","pixelPaint.painter.circle":"Circle","pixelPaint.painter.select":"Select","pixelPaint.painter.center":"Center","pixelPaint.painter.outline":"Outline","pixelPaint.colorPicker.color":"Color","pixelPaint.colorPicker.saturation":"Saturation","pixelPaint.colorPicker.brightness":"Brightness"};var s0={"pixelPaint.contextMenu.duplicate":"\u590D\u5236","pixelPaint.contextMenu.export":"\u5BFC\u51FA","pixelPaint.contextMenu.delete":"\u5220\u9664","pixelPaint.actionButton.upload":"\u4E0A\u4F20\u56FE\u7247","pixelPaint.actionButton.uploadCostume":"\u4E0A\u4F20\u9020\u578B","pixelPaint.actionButton.uploadBackdrop":"\u4E0A\u4F20\u80CC\u666F","pixelPaint.actionButton.surprise":"\u968F\u673A","pixelPaint.actionButton.paint":"\u7ED8\u5236","pixelPaint.actionButton.image":"\u9009\u62E9\u4E00\u4E2A\u56FE\u7247","pixelPaint.actionButton.costume":"\u9009\u62E9\u4E00\u4E2A\u9020\u578B","pixelPaint.actionButton.backdrop":"\u9009\u62E9\u4E00\u4E2A\u80CC\u666F","pixelPaint.painter.image":"\u56FE\u7247","pixelPaint.painter.costume":"\u9020\u578B","pixelPaint.painter.backdrop":"\u80CC\u666F","pixelPaint.painter.name":"\u540D\u5B57","pixelPaint.painter.undo":"\u64A4\u9500","pixelPaint.painter.redo":"\u91CD\u505A","pixelPaint.painter.pen":"\u753B\u7B14","pixelPaint.painter.eraser":"\u6A61\u76AE\u64E6","pixelPaint.painter.fill":"\u586B\u5145","pixelPaint.painter.text":"\u6587\u672C","pixelPaint.painter.line":"\u7EBF\u6BB5","pixelPaint.painter.rectangle":"\u77E9\u5F62","pixelPaint.painter.circle":"\u5706\u5F62","pixelPaint.painter.select":"\u9009\u62E9","pixelPaint.painter.center":"\u4E2D\u5FC3","pixelPaint.painter.outline":"\u8F6E\u5ED3","pixelPaint.colorPicker.color":"\u989C\u8272","pixelPaint.colorPicker.saturation":"\u9971\u548C\u5EA6","pixelPaint.colorPicker.brightness":"\u4EAE\u5EA6"};var s3={en:n0,"zh-Hans":s0};export{s3 as locales,u5 as PixelPaint};
