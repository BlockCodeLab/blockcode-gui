import{useEditor as T5} from"@blockcode/core";import{useState as N0} from"preact/hooks";import{useLocale as e0,useLayout as F5,useEditor as O5} from"@blockcode/core";import{IconSelector as G5,ActionButton as Z5} from"@blockcode/ui";class Q{static get DrawWidth(){return 320}static get DrawHeight(){return 240}static from(F){const O=F>>2,G=Math.floor(O/320),q=O-G*320;return new Q(q,G)}constructor(F,O){this.setXY(F,O)}get x(){return this._x}set x(F){this._x=F,this._index=this.x+this.y*320<<2}get y(){return this._y}set y(F){this._y=F,this._index=this.x+this.y*320<<2}get index(){return this._index}get valid(){return this.x>=0&&this.x<320&&this.y>=0&&this.y<240}get invalid(){return!this.valid}get topPoint(){return new Q(this.x,this.y-1)}get leftPoint(){return new Q(this.x-1,this.y)}get rightPoint(){return new Q(this.x+1,this.y)}get bottomPoint(){return new Q(this.x,this.y+1)}get topLeftPoint(){return new Q(this.x-1,this.y-1)}get topRightPoint(){return new Q(this.x+1,this.y-1)}get bottomLeftPoint(){return new Q(this.x-1,this.y+1)}get bottomRightPoint(){return new Q(this.x+1,this.y+1)}setXY(F,O){return this._x=F,this._y=O,this._index=this.x+this.y*320<<2,this}equals(F){return this.x==F.x&&this.y==F.y}}function R0(F){return new Promise(async(O)=>{const G=new FileReader;G.readAsDataURL(F),G.addEventListener("load",()=>{const q=new Image;q.src=G.result,q.addEventListener("load",()=>{if(q.width>Q.DrawWidth||q.height>Q.DrawHeight){const V=q.width/Q.DrawWidth,W=q.height/Q.DrawHeight;let $=Q.DrawWidth,H=Q.DrawHeight;if(V>W)H=q.height/V;else $=q.width/W;const j=document.createElement("canvas");j.width=$,j.height=H,j.getContext("2d").drawImage(q,0,0,$,H),q.src=j.toDataURL(F.type)}else q.dataset.url=q.src,O(q)})})})}function j0(F){return new Promise(async(O)=>{const G=new Image;G.src=`data:${F.type};base64,${F.data}`,G.addEventListener("load",()=>{G.dataset.url=G.src,O(G)})})}function z0(F){return new Promise(async(O)=>{const G=new Image;G.src=F,G.addEventListener("load",()=>{const q=document.createElement("canvas");q.width=G.width,q.height=G.height,q.getContext("2d").drawImage(G,0,0,G.width,G.height),G.dataset.url=q.toDataURL("image/png"),O(G)})})}function e(F=32){const O=[];for(let G=0;G<F;G++)O[G]="0123456789abcdefghijklmnopqrstuvwxyz".charAt(Math.random()*"0123456789abcdefghijklmnopqrstuvwxyz".length);return O.join("")}function m(F){const O=globalThis.document,G=O.createElement("style");G.appendChild(O.createTextNode(F)),O.head.append(G)}m(".K-gn7q_selector-wrapper{background:var(--ui-secondary);width:150px;position:relative}.K-gn7q_selector-items-wrapper{width:150px;min-height:100%;padding-bottom:100px}.K-gn7q_selector-item{width:5rem;height:5rem;margin:.5rem auto}.K-gn7q_delete-menu-item:hover{background:var(--error-primary)}.K-gn7q_add-button-wrapper{background:linear-gradient(transparent,var(--ui-secondary));width:100%;height:100px;display:flex;position:absolute;bottom:0;left:0;right:0}.K-gn7q_add-button{margin:.75rem auto}");var F0={selectorItem:"K-gn7q_selector-item",deleteMenuItem:"K-gn7q_delete-menu-item",addButtonWrapper:"K-gn7q_add-button-wrapper",selectorWrapper:"K-gn7q_selector-wrapper",addButton:"K-gn7q_add-button",selectorItemsWrapper:"K-gn7q_selector-items-wrapper"};var A0="./assets/icon-sprite-d18dd1c39449bd1f.svg";var w0="./assets/icon-backdrop-b2bc77fff077fbb7.svg";var _0="./assets/icon-surprise-8aa9e285645a254d.svg";var k0="./assets/icon-search-da6ddbb0d3689046.svg";var v0="./assets/icon-paint-8a2941791fc8f1c0.svg";var B0="./assets/icon-file-upload-8698118c8522bf00.svg";import{jsx as O0} from"preact/jsx-runtime";function Q0({mode:F,imageList:O,imageIndex:G,onSetupLibrary:q}){const[V,W]=N0(!1),[$,H]=N0(!1),[j,A]=N0(!1),{getText:z}=e0(),{createAlert:P,removeAlert:L}=F5(),{addAsset:b,deleteAsset:p,modifyFile:u}=O5(),B=O.map((K)=>K.id),{ImagesLibrary:D,BackdropsLibrary:c,CostumesLibrary:x}=q(),f=()=>{if(F==="costume"){W(!1),H(!0),A(!1);return}if(F==="backdrop"){W(!1),H(!1),A(!0);return}W(!0),H(!1),A(!1)},h=()=>{W(!1),H(!1),A(!1)},M=async(K)=>{const X=e();P("importing",{id:X});const J=await z0(`./assets/${K.id}.png`);b({...K,id:X,type:"image/png",data:J.dataset.url.slice("data:image/png;base64,".length),width:J.width,height:J.height}),B.push(X),L(X),u({assets:B,frame:B.length-1})},y=()=>{if(F==="costume"){M(x.surprise());return}if(F==="backdrop"){M(c.surprise());return}M(D.surprise())},I=(K,X,J)=>{if(F==="costume")return X;if(F==="backdrop")return J;return K},C=(K)=>`data:${K.type};base64,${K.data}`,d=(K)=>{u({frame:K})},r=()=>{const K=document.createElement("input");K.type="file",K.accept="image/*",K.multiple=!0,K.click(),K.addEventListener("change",async(X)=>{const J=e();P("importing",{id:J});for(let _ of X.target.files){const S=e(),s=_.name.slice(0,_.name.lastIndexOf(".")),i=await R0(_);b({id:S,type:_.type,name:s,data:i.dataset.url.slice(`data:${_.type};base64,`.length),width:i.width,height:i.height,centerX:Math.floor(i.width/2),centerY:Math.floor(i.height/2)}),B.push(S)}L(J),u({assets:B,frame:B.length-1})})},Z=()=>{const K=e();b({id:K,type:"image/png",name:z(`pixelPaint.painter.${F}`,F),data:"iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAAtJREFUGFdjYAACAAAFAAGq1chRAAAAAElFTkSuQmCC",width:1,height:1,centerX:1,centerY:1}),B.push(K),u({assets:B,frame:B.length-1})},Y=(K)=>{p(B[K]),B.splice(K,1),u({assets:B,frame:G===0?0:K>G?G:G-1})},N=(K)=>{const X=O[K],J=e();b({...X,id:J}),B.push(J),u({assets:B,frame:B.length-1})};return O0("div",{className:F0.selectorWrapper,children:[O0(G5,{displayOrder:!0,id:"paint-selector",className:F0.selectorItemsWrapper,items:O.map((K,X)=>({...K,details:`${K.width}\xD7${K.height}`,icon:C(K),order:X,className:F0.selectorItem,contextMenu:[[{label:z("pixelPaint.contextMenu.duplicate","duplicate"),onClick:()=>N(X)},{label:z("pixelPaint.contextMenu.export","export"),disabled:!0}],[{label:z("pixelPaint.contextMenu.delete","delete"),className:F0.deleteMenuItem,disabled:O.length<=1,onClick:()=>Y(X)}]]})),selectedIndex:G,onSelect:d,onDelete:O.length>1&&Y}),O0("div",{className:F0.addButtonWrapper,children:O0(Z5,{tooltipPlacement:"right",className:F0.addButton,icon:F==="costume"?A0:w0,tooltip:I(z("pixelPaint.actionButton.image","Choose a Image"),z("pixelPaint.actionButton.costume","Choose a Costume"),z("pixelPaint.actionButton.backdrop","Choose a Backdrop")),onClick:f,moreButtons:[{icon:B0,tooltip:I(z("pixelPaint.actionButton.upload","Upload Image"),z("pixelPaint.actionButton.uploadCostume","Upload Costume"),z("pixelPaint.actionButton.uploadBackdrop","Upload Backdrop")),onClick:r},{icon:_0,tooltip:z("pixelPaint.actionButton.surprise","Surprise"),onClick:y},{icon:v0,tooltip:z("pixelPaint.actionButton.paint","Paint"),onClick:Z},{icon:k0,tooltip:I(z("pixelPaint.actionButton.image","Choose a Image"),z("pixelPaint.actionButton.costume","Choose a Costume"),z("pixelPaint.actionButton.backdrop","Choose a Backdrop")),onClick:f}]})}),V&&D&&O0(D,{onClose:h,onSelect:M}),$&&x&&O0(x,{onClose:h,onSelect:M}),j&&c&&O0(c,{onClose:h,onSelect:M})]})}import{useEffect as L5,useState as l} from"preact/hooks";import{useLocale as D5,useEditor as f5} from"@blockcode/core";import{classNames as g,Label as H0,BufferedInput as I5,Input as g0,Button as Z0} from"@blockcode/ui";class E{static decimalToHex(F){if(F<0)F+=16777216;let O=Number(F).toString(16);return O=`#${"000000".substr(0,6-O.length)}${O}`,O}static decimalToRgb(F){const O=F>>24&255,G=F>>16&255,q=F>>8&255,V=F&255;return{r:G,g:q,b:V,a:O>0?O:255}}static hexToRgb(F){const O=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;F=F.replace(O,(q,V,W,$)=>V+V+W+W+$+$);const G=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(F);return G?{r:parseInt(G[1],16),g:parseInt(G[2],16),b:parseInt(G[3],16)}:null}static rgbToHex(F){return E.decimalToHex(E.rgbToDecimal(F))}static rgbToDecimal(F){return(F.r<<16)+(F.g<<8)+F.b}static hexToDecimal(F){return E.rgbToDecimal(E.hexToRgb(F))}static hsvToRgb(F){let O=F.h%360;if(O<0)O+=360;const G=Math.max(0,Math.min(F.s,1)),q=Math.max(0,Math.min(F.v,1)),V=Math.floor(O/60),W=O/60-V,$=q*(1-G),H=q*(1-G*W),j=q*(1-G*(1-W));let A,z,P;switch(V){default:case 0:A=q,z=j,P=$;break;case 1:A=H,z=q,P=$;break;case 2:A=$,z=q,P=j;break;case 3:A=$,z=H,P=q;break;case 4:A=j,z=$,P=q;break;case 5:A=q,z=$,P=H;break}return{r:Math.floor(A*255),g:Math.floor(z*255),b:Math.floor(P*255)}}static rgbToHsv(F){const O=F.r/255,G=F.g/255,q=F.b/255,V=Math.min(Math.min(O,G),q),W=Math.max(Math.max(O,G),q);let $=0,H=0;if(V!==W){const j=O===V?G-q:G===V?q-O:O-G;$=((O===V?3:G===V?5:1)-j/(W-V))*60%360,H=(W-V)/W}return{h:$,s:H,v:W}}static mixRgb(F,O,G){if(G<=0)return F;if(G>=1)return O;const q=1-G;return{r:q*F.r+G*O.r,g:q*F.g+G*O.g,b:q*F.b+G*O.b}}constructor(F,O=!1){if(this._clear=O,this._color=F,typeof F==="number")this._type="decimal";else if(typeof F==="string"&&F[0]==="#")this._type="hex";else if(Array.isArray(F)){const[G,q,V]=F;if(q<=1&&V<=1)this._type="hsv",this._color={h:G,s:q,v:V};else this._type="rgb",this._color={r:G,g:q,b:V};this._clear=O||F[3]===0}else if(typeof F.r==="number")this._type="rgb";else if(typeof F.h==="number")this._type="hsv"}get clear(){return this._clear}get rgb(){if(this._type==="rgb")return this._color;if(this._type==="decimal")return E.decimalToRgb(this._color);if(this._type==="hsv")return E.hsvToRgb(this._color);if(this._type==="hex")return E.hexToRgb(this._color)}get hsv(){if(this._type==="hsv")return this._color;if(this._type==="decimal")return E.rgbToHsv(E.decimalToRgb(this._color));if(this._type==="rgb")return E.rgbToHsv(this._color);if(this._type==="hex")return E.rgbToHsv(E.hexToRgb(this._color))}get hex(){if(this._type==="hex")return this._color;if(this._type==="decimal")return E.decimalToHex(this._color);if(this._type==="rgb")return E.rgbToHex(this._color);if(this._type==="hsv")return E.rgbToHex(E.hsvToRgb(this._color))}get decimal(){if(this._type==="decimal")this._color;if(this._type==="rgb")return E.rgbToDecimal(this._color);if(this._type==="hsv")return E.rgbToDecimal(E.hsvToRgb(this._color));if(this._type==="hex")return E.hexToDecimal(this._color)}toRGBColor(){if(this._type==="rgb")return this;return new E(this.rgb,this.clear)}toHSVColor(){if(this._type==="hsv")return this;return new E(this.hsv,this.clear)}toHEXColor(){if(this._type==="hex")return this;return new E(this.hex,this.clear)}toDecimalColor(){if(this._type==="decimal")return this;return new E(this.decimal,this.clear)}equals(F){return this.rgb.r===F.rgb.r&&this.rgb.g===F.rgb.g&&this.rgb.b===F.rgb.b&&this.clear===F.clear}notEquals(F){return!this.equals(F)}}function S0(F){const O=q5(F),G=K5(F,O),q=$5(F,O,G),V=Y5(F,O,G,q),W={top:O||0,left:q||0,right:V||0,bottom:G||0};return W.width=W.right-W.left+1,W.height=W.bottom-W.top+1,W}var q5=(F)=>{let O;for(let G=0;G<F.height;G++){O=G*F.width;for(let q=0;q<F.width;q++){if(F.data[(O<<2)+3]!==0)return G;O++}}},K5=(F,O)=>{let G;for(let q=F.height-1;q>=O;q--){G=q*F.width;for(let V=0;V<F.width;V++){if(F.data[(G<<2)+3]!==0)return q;G++}}},$5=(F,O,G)=>{let q;for(let V=0;V<F.width;V++)for(let W=O;W<=G;W++)if(q=W*F.width+V,F.data[(q<<2)+3]!==0)return V},Y5=(F,O,G,q)=>{let V;for(let W=F.width-1;W>=q;W--)for(let $=O;$<=G;$++)if(V=$*F.width+W,F.data[(V<<2)+3]!==0)return W};function P0(F){const{top:O,left:G,width:q,height:V}=S0(F),W=Math.floor(F.width/2-G),$=Math.floor(F.height/2-O),H=document.createElement("canvas");H.width=q,H.height=V,H.getContext("2d").putImageData(F,-G,-O,G,O,q,V);const[A,z]=H.toDataURL().slice(5).split(";base64,");return{type:A,data:z,width:q,height:V,centerX:W,centerY:$}}import{classNames as G0,Text as V0,Tooltip as Q5} from"@blockcode/ui";m("._Y2YyW_color-picker-wrapper{margin-right:var(--space);cursor:pointer;width:3rem;height:2rem;display:flex}._Y2YyW_color-swatch{border:1px solid var(--ui-black-transparent);border-top-left-radius:var(--form-radius);border-bottom-left-radius:var(--form-radius);flex-shrink:0;flex-basis:2rem;height:100%;display:flex;position:relative}._Y2YyW_color-swatch-outline:after{content:\"\";background:var(--ui-white);border:1px solid var(--ui-black-transparent);z-index:1;width:.75rem;height:.75rem;position:absolute;top:.5rem;left:.5rem}._Y2YyW_picker-arrow{user-select:none;border:1px solid var(--ui-black-transparent);border-top-right-radius:var(--form-radius);border-bottom-right-radius:var(--form-radius);border-left:0;flex-shrink:0;flex-basis:1rem;justify-content:center;align-items:center;height:100%;font-size:.75rem;display:flex}._Y2YyW_color-tooltip{background:var(--ui-white);color:var(--text-primary);padding:calc(var(--space)/2)}._Y2YyW_tooltip-item{margin:8px}._Y2YyW_tooltip-item-label{font-weight:700}._Y2YyW_tooltip-item-readout{margin-left:10px}._Y2YyW_tooltip-item-slider{border-radius:11px;outline:none;width:150px;height:22px;margin-bottom:20px;position:relative}._Y2YyW_tooltip-item-slider-handler{background-color:var(--ui-white);box-shadow:0 0 0 4px var(--ui-black-transparent);touch-action:none;border-radius:100%;width:26px;height:26px;margin-top:-2px;position:absolute;left:100px}._Y2YyW_tooltip-item-toolbar{justify-content:space-between;display:flex}._Y2YyW_tooltip-item-toolbar-button{border:1px solid var(--ui-black-transparent);border-radius:var(--form-radius);cursor:pointer;width:calc(1.5rem + 2px);height:calc(1.5rem + 2px)}._Y2YyW_tooltip-item-toolbar-button._Y2YyW_selected{border:1px solid #855cd6;box-shadow:0 0 0 3px #855cd659}._Y2YyW_button-icon{width:1.5rem;height:1.5rem}");var w={colorPickerWrapper:"_Y2YyW_color-picker-wrapper",pickerArrow:"_Y2YyW_picker-arrow",colorSwatchOutline:"_Y2YyW_color-swatch-outline",tooltipItemSliderHandler:"_Y2YyW_tooltip-item-slider-handler",tooltipItemToolbarButton:"_Y2YyW_tooltip-item-toolbar-button",tooltipItemReadout:"_Y2YyW_tooltip-item-readout",tooltipItemLabel:"_Y2YyW_tooltip-item-label",colorSwatch:"_Y2YyW_color-swatch",colorTooltip:"_Y2YyW_color-tooltip",tooltipItemToolbar:"_Y2YyW_tooltip-item-toolbar",tooltipItemSlider:"_Y2YyW_tooltip-item-slider",tooltipItem:"_Y2YyW_tooltip-item",selected:"_Y2YyW_selected",buttonIcon:"_Y2YyW_button-icon"};var h0="./assets/icon-picker-84c34a6f34788fe2.svg";var W0="./assets/icon-clear-ad3d0ac9d8fa6cb0.svg";import{jsx as k,Fragment as V5} from"preact/jsx-runtime";var W5=[0,0,324,288,252,216,180,144,108,72,36,0,0],n=124;function q0({picking:F,color:O,outline:G,onChange:q,onPickColor:V}){const W=O.hsv.h,$=O.hsv.s,H=O.hsv.v,j=(M,y,I,C)=>new E({h:M,s:y,v:I},C),A=(M)=>q(j(Math.round(M*360),$,H)),z=(M)=>q(j(W,M,H)),P=(M)=>q(j(W,$,M)),L=()=>q(j(W,$,H,!0)),b=(M,y)=>{M.stopPropagation();const I=M.target,C=I.offsetLeft,d=M.clientX,r=(Y)=>{Y.preventDefault();let N=Y.clientX-d+C;if(N>=n)N=n;if(N<=0)N=0;I.style.left=`${N}px`,y(N/n)},Z=()=>{document.removeEventListener("mousemove",r),document.removeEventListener("mouseup",Z)};document.addEventListener("mousemove",r),document.addEventListener("mouseup",Z)},p=(M)=>b(M,A),u=(M)=>b(M,z),B=(M)=>b(M,P),D=(M,y)=>{const I=M.target.children[0];let C=M.offsetX-13;if(C>=n)C=n;if(C<=0)C=0;I.style.left=`${C}px`,y(C/n)},c=(M)=>D(M,A),x=(M)=>D(M,z),f=(M)=>D(M,P),h=W5.map((M)=>j(M,$,H).hex);return k(Q5,{clickable:!0,placement:"bottom",className:w.colorTooltip,onHide:()=>V(!1),content:k(V5,{children:[k("div",{className:w.tooltipItem,children:[k("span",{className:w.tooltipItemLabel,children:k(V0,{id:"pixelPaint.colorPicker.color",defaultMessage:"Color"})}),k("span",{className:w.tooltipItemReadout,children:Math.round(W/360*100)})]}),k("div",{className:G0(w.tooltipItem,w.tooltipItemSlider),style:{background:`linear-gradient(to left, ${h[0]} 0px, ${h[1]} 13px, ${h[2]}, ${h[3]}, ${h[4]}, ${h[5]}, ${h[6]}, ${h[7]}, ${h[8]}, ${h[9]}, ${h[10]}, ${h[11]} 137px, ${h[12]} 100%)`},onClick:c,children:k("div",{className:w.tooltipItemSliderHandler,style:{left:`${Math.round(W/360*n)}px`},onMouseDown:p,onClick:(M)=>M.stopPropagation()})}),k("div",{className:w.tooltipItem,children:[k("span",{className:w.tooltipItemLabel,children:k(V0,{id:"pixelPaint.colorPicker.saturation",defaultMessage:"Saturation"})}),k("span",{className:w.tooltipItemReadout,children:Math.round($*100)})]}),k("div",{className:G0(w.tooltipItem,w.tooltipItemSlider),style:{background:`linear-gradient(to right, ${j(W,0,H).hex} 0px, ${j(W,1,H).hex} 100%)`},onClick:x,children:k("div",{className:w.tooltipItemSliderHandler,style:{left:`${Math.round($*n)}px`},onMouseDown:u,onClick:(M)=>M.stopPropagation()})}),k("div",{className:w.tooltipItem,children:[k("span",{className:w.tooltipItemLabel,children:k(V0,{id:"pixelPaint.colorPicker.brightness",defaultMessage:"Brightness"})}),k("span",{className:w.tooltipItemReadout,children:Math.round(H*100)})]}),k("div",{className:G0(w.tooltipItem,w.tooltipItemSlider),style:{background:`linear-gradient(to right, ${j(W,$,0).hex} 0px, ${j(W,$,1).hex} 100%)`},onClick:f,children:k("div",{className:w.tooltipItemSliderHandler,style:{left:`${Math.round(H*n)}px`},onMouseDown:B,onClick:(M)=>M.stopPropagation()})}),k("div",{className:G0(w.tooltipItem,w.tooltipItemToolbar),children:[k("div",{className:G0(w.tooltipItemToolbarButton,{[w.selected]:O.clear}),onClick:L,children:k("img",{src:W0,className:w.buttonIcon})}),k("div",{className:G0(w.tooltipItemToolbarButton,{[w.selected]:F}),onClick:V,children:k("img",{src:h0,className:w.buttonIcon})})]})]}),children:k("div",{className:w.colorPickerWrapper,children:[k("div",{className:G0(w.colorSwatch,{[w.colorSwatchOutline]:G}),style:{background:O.clear?"var(--ui-white)":j(W,$,H).hex},children:O.clear&&k("img",{src:W0})}),k("div",{className:w.pickerArrow,children:"\u25BE"})]})})}import{useLocale as A5} from"@blockcode/core";import{classNames as a,Button as t} from"@blockcode/ui";m(".zaEMxq_tool-box-wrapper{flex-flow:wrap;place-content:flex-start space-between;width:7rem;display:flex}.zaEMxq_tool-button{margin:calc(var(--space)/2);border-radius:calc(var(--space)/2);padding:calc(var(--space)/2);user-select:none;background:0 0;border:none;outline:none;transition:all .2s;display:inline-block}.zaEMxq_tool-button.zaEMxq_selected{background:var(--motion-primary)}.zaEMxq_tool-icon{vertical-align:middle;width:2rem;height:2rem}.zaEMxq_tool-button.zaEMxq_selected .zaEMxq_tool-icon{filter:brightness(0)invert()}");var v={toolIcon:"zaEMxq_tool-icon",selected:"zaEMxq_selected",toolBoxWrapper:"zaEMxq_tool-box-wrapper",toolButton:"zaEMxq_tool-button"};var K0="./assets/icon-pen-feefe485db8ab4fb.svg";var $0="./assets/icon-eraser-d74093113b7d2e66.svg";var L0="./assets/icon-fill-88af433e88f940a7.svg";var D0="./assets/icon-text-506c9e59be31058e.svg";var f0="./assets/icon-line-5ccd8ec9d6c1c618.svg";var I0="./assets/icon-rectangle-b3097e20fe790a9e.svg";var C0="./assets/icon-circle-5328f8d4320e955e.svg";var T0="./assets/icon-select-70c5ba0720e0d0e7.svg";import{jsx as T} from"preact/jsx-runtime";function X0({selectedTool:F,onSelect:O}){const{getText:G}=A5();return T("div",{className:v.toolBoxWrapper,children:[T(t,{className:a(v.toolButton,{[v.selected]:F==="pen"}),onClick:()=>O("pen"),children:T("img",{src:K0,className:v.toolIcon,title:G("pixelPaint.painter.pen","Pen")})}),T(t,{className:a(v.toolButton,{[v.selected]:F==="eraser"}),onClick:()=>O("eraser"),children:T("img",{src:$0,className:v.toolIcon,title:G("pixelPaint.painter.eraser","Eraser")})}),T(t,{className:a(v.toolButton,{[v.selected]:F==="fill"}),onClick:()=>O("fill"),children:T("img",{src:L0,className:v.toolIcon,title:G("pixelPaint.painter.fill","Fill")})}),T(t,{disabled:!0,className:a(v.toolButton,{[v.selected]:F==="text"}),onClick:()=>O("text"),children:T("img",{src:D0,className:v.toolIcon,title:G("pixelPaint.painter.text","Text")})}),T(t,{disabled:!0,className:a(v.toolButton,{[v.selected]:F==="line"}),onClick:()=>O("line"),children:T("img",{src:f0,className:v.toolIcon,title:G("pixelPaint.painter.line","Line")})}),T(t,{disabled:!0,className:a(v.toolButton,{[v.selected]:F==="rectangle"}),onClick:()=>O("rectangle"),children:T("img",{src:I0,className:v.toolIcon,title:G("pixelPaint.painter.rectangle","Rectangle")})}),T(t,{disabled:!0,className:a(v.toolButton,{[v.selected]:F==="circle"}),onClick:()=>O("circle"),children:T("img",{src:C0,className:v.toolIcon,title:G("pixelPaint.painter.circle","Circle")})}),T(t,{disabled:!0,className:a(v.toolButton,{[v.selected]:F==="select"}),onClick:()=>O("select"),children:T("img",{src:T0,className:v.toolIcon,title:G("pixelPaint.painter.select","Select")})})]})}import{useRef as _5,useEffect as b0,useState as k5} from"preact/hooks";import{classNames as u0} from"@blockcode/ui";m("._1X3Adq_draw-box{background:var(--ui-secondary);width:100%;height:100%;display:flex;position:absolute;top:0;left:0;overflow:auto}._1X3Adq_draw-canvas-wrapper{margin:auto;position:relative}._1X3Adq_draw-canvas{image-rendering:pixelated;background:url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+CjwhLS0gQ3JlYXRlZCB3aXRoIFZlY3Rvcm5hdG9yIChodHRwOi8vdmVjdG9ybmF0b3IuaW8vKSAtLT4KPHN2ZyBoZWlnaHQ9IjMwIiB3aWR0aD0iMzAiIHN0cm9rZS1taXRlcmxpbWl0PSIxMCIgc3R5bGU9ImZpbGwtcnVsZTpub256ZXJvO2NsaXAtcnVsZTpldmVub2RkO3N0cm9rZS1saW5lY2FwOnJvdW5kO3N0cm9rZS1saW5lam9pbjpyb3VuZDsiIHZlcnNpb249IjEuMSIgdmlld0JveD0iMCAwIDQwIDQwIiB4bWw6c3BhY2U9InByZXNlcnZlIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIj4KPGRlZnMvPgo8Zz4KPHBhdGggZD0iTTAgMEw0MCAwTDQwIDQwTDAgNDBMMCAwWiIgZmlsbD0iI2ZmZmZmZiIgZmlsbC1ydWxlPSJub256ZXJvIiBvcGFjaXR5PSIxIiBzdHJva2U9Im5vbmUiLz4KPHBhdGggZD0iTTAgMEwyMCAwTDIwIDIwTDAgMjBMMCAwWiIgZmlsbD0iI2VhZjBmOCIgZmlsbC1ydWxlPSJub256ZXJvIiBvcGFjaXR5PSIxIiBzdHJva2U9Im5vbmUiLz4KPHBhdGggZD0iTTIwIDIwTDQwIDIwTDQwIDQwTDIwIDQwTDIwIDIwWiIgZmlsbD0iI2VhZjBmOCIgZmlsbC1ydWxlPSJub256ZXJvIiBvcGFjaXR5PSIxIiBzdHJva2U9Im5vbmUiLz4KPC9nPgo8L3N2Zz4K);width:320px;height:240px}._1X3Adq_draw-canvas._1X3Adq_center{cursor:crosshair}._1X3Adq_draw-canvas._1X3Adq_picker{cursor:url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+Cjxzdmcgd2lkdGg9IjIwcHgiIGhlaWdodD0iMjBweCIgdmlld0JveD0iMCAwIDIwIDIwIiB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiPgogICAgPCEtLSBHZW5lcmF0b3I6IFNrZXRjaCA0My4yICgzOTA2OSkgLSBodHRwOi8vd3d3LmJvaGVtaWFuY29kaW5nLmNvbS9za2V0Y2ggLS0+CiAgICA8dGl0bGU+ZXllLWRyb3BwZXI8L3RpdGxlPgogICAgPGRlc2M+Q3JlYXRlZCB3aXRoIFNrZXRjaC48L2Rlc2M+CiAgICA8ZGVmcz48L2RlZnM+CiAgICA8ZyBpZD0iUGFnZS0xIiBzdHJva2U9Im5vbmUiIHN0cm9rZS13aWR0aD0iMSIgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIj4KICAgICAgICA8ZyBpZD0iZXllLWRyb3BwZXIiIGZpbGw9IiM1NzVFNzUiPgogICAgICAgICAgICA8cGF0aCBkPSJNOS4xNTMzNDYwNSwxMi40ODI0OTYyIEM5LjAzMzk0MDQ0LDEyLjYxODg3MzcgOC44ODA0MTg5NSwxMi43MDQxMDk2IDguNjA3NDkxODYsMTIuNzcyMjk4MyBDNy45MDgxMTYxOCwxMi45MjU3MjMgNy4yNDI4NTYzOSwxMy41NTY0Njg4IDcuMDM4MTYxMDcsMTQuMjU1NDAzMyBDNi45Njk5MjkzLDE0LjQ3NzAxNjcgNi43NDgxNzYwMywxNC43MTU2NzczIDYuNTA5MzY0ODMsMTQuODM1MDA3NiBMNC43MzUzMzg3MSwxNS42NzAzMTk2IEM0LjY1MDA0OSwxNS43MDQ0MTQgNC41ODE4MTcyMiwxNS43MjE0NjEyIDQuNTQ3NzAxMzQsMTUuNzIxNDYxMiBMNC4yNzQ3NzQyNCwxNS40NjU3NTM0IEM0LjI3NDc3NDI0LDE1LjQ0ODcwNjIgNC4yNzQ3NzQyNCwxNS4zODA1MTc1IDQuMzI1OTQ4MDcsMTUuMjYxMTg3MiBMNS4xNjE3ODczLDEzLjQ3MTIzMjkgQzUuMjY0MTM0OTYsMTMuMjQ5NjE5NSA1LjUwMjk0NjE3LDEzLjAyODAwNjEgNS43NDE3NTczNywxMi45NTk4MTc0IEM2LjQ0MTEzMzA1LDEyLjczODIwNCA3LjA3MjI3Njk2LDEyLjA5MDQxMSA3LjI1OTkxNDMzLDExLjIzODA1MTggQzcuMjk0MDMwMjIsMTEuMTAxNjc0MyA3LjM3OTMxOTk0LDEwLjk2NTI5NjggNy40OTg3MjU1NCwxMC44Mjg5MTkzIEwxMS40MzkxMTA1LDYuOTA4MDY2OTcgTDEzLjA5MzczMSw4LjU2MTY0Mzg0IEw5LjE1MzM0NjA1LDEyLjQ4MjQ5NjIgWiBNMTYuNjA3NjY3Myw1LjI4ODU4NDQ3IEMxNi44NjM1MzY1LDUuMDMyODc2NzEgMTcsNC42NzQ4ODU4NCAxNyw0LjMzMzk0MjE2IEMxNywzLjk5Mjk5ODQ4IDE2Ljg2MzUzNjUsMy42NTIwNTQ3OSAxNi42MDc2NjczLDMuMzk2MzQ3MDMgQzE2LjA3ODg3MTEsMi44Njc4ODQzMiAxNS4yNDMwMzE4LDIuODY3ODg0MzIgMTQuNzE0MjM1NiwzLjM5NjM0NzAzIEwxMy4yMzAxOTQ1LDQuODc5NDUyMDUgTDEzLjA1OTYxNTEsNC43MDg5ODAyMSBMMTIuNTEzNzYwOSw0LjE2MzQ3MDMyIEMxMi4xNzI2MDIsMy44MjI1MjY2NCAxMS42MDk2ODk5LDMuODIyNTI2NjQgMTEuMjY4NTMxLDQuMTYzNDcwMzIgTDEwLjYwMzI3MTIsNC44MTEyNjMzMiBDMTAuMjc5MTcwMyw1LjE1MjIwNyAxMC4yNjIxMTI0LDUuNjQ2NTc1MzQgMTAuNTUyMDk3NCw1Ljk4NzUxOTAzIEw2LjU5NDY1NDU0LDkuOTI1NDE4NTcgQzYuMzA0NjY5NTEsMTAuMjMyMjY3OSA2LjA5OTk3NDE4LDEwLjU5MDI1ODggNS45ODA1Njg1OCwxMS4xMDE2NzQzIEM1LjkyOTM5NDc1LDExLjM1NzM4MiA1LjYzOTQwOTcxLDExLjY0NzE4NDIgNS4zNjY0ODI2MiwxMS43MzI0MjAxIEM0LjgwMzU3MDQ5LDExLjkwMjg5MTkgNC4yNTc3MTYzLDEyLjM4MDIxMzEgNC4wMDE4NDcxNSwxMi45NDI3NzAyIEwzLjE2NjAwNzkyLDE0LjcxNTY3NzMgQzIuODkzMDgwODMsMTUuMzEyMzI4OCAyLjk2MTMxMjYsMTUuOTI2MDI3NCAzLjMzNjU4NzM2LDE2LjMxODExMjYgTDMuNjc3NzQ2MjMsMTYuNjU5MDU2MyBDMy44OTk0OTk0OSwxNi44ODA2Njk3IDQuMjA2NTQyNDcsMTcgNC41NDc3MDEzNCwxNyBDNC43Njk0NTQ2LDE3IDUuMDI1MzIzNzUsMTYuOTMxODExMyA1LjI2NDEzNDk2LDE2LjgyOTUyODIgTDcuMDU1MjE5MDEsMTUuOTk0MjE2MSBDNy42MTgxMzExNCwxNS43MjE0NjEyIDguMDk1NzUzNTYsMTUuMTkyOTk4NSA4LjI2NjMzMjk5LDE0LjYzMDQ0MTQgQzguMzM0NTY0NzcsMTQuMzU3Njg2NSA4LjY0MTYwNzc1LDE0LjA2Nzg4NDMgOS4wNTA5OTgzOSwxMy45ODI2NDg0IEM5LjQwOTIxNTIsMTMuODk3NDEyNSA5Ljc2NzQzMjAxLDEzLjY5Mjg0NjMgMTAuMDU3NDE3LDEzLjM4NTk5NyBMMTQuMDE0ODU5OSw5LjQ0ODA5NzQxIEMxNC4zNTYwMTg4LDkuNzM3ODk5NTQgMTQuODY3NzU3MSw5LjcwMzgwNTE4IDE1LjE3NDgwMDEsOS4zNzk5MDg2OCBMMTUuODQwMDU5OSw4LjczMjExNTY4IEMxNi4xODEyMTg3LDguMzkxMTcxOTkgMTYuMTgxMjE4Nyw3LjgyODYxNDkyIDE1Ljg0MDA1OTksNy40ODc2NzEyMyBMMTUuMjYwMDg5OCw2LjkwODA2Njk3IEwxNS4xMjM2MjYyLDYuNzcxNjg5NSBMMTYuNjA3NjY3Myw1LjI4ODU4NDQ3IFoiIGlkPSJleWUtZHJvcHBlci1pY29uIj48L3BhdGg+CiAgICAgICAgPC9nPgogICAgPC9nPgo8L3N2Zz4=) 4 15,crosshair}._1X3Adq_center-icon{pointer-events:none;filter:opacity(.5);position:absolute;top:0;left:0;transform:translate(-50%,-50%)}._1X3Adq_center-icon._1X3Adq_hidden{display:none}");var o={drawBox:"_1X3Adq_draw-box",drawCanvas:"_1X3Adq_draw-canvas",centerIcon:"_1X3Adq_center-icon",hidden:"_1X3Adq_hidden",picker:"_1X3Adq_picker",drawCanvasWrapper:"_1X3Adq_draw-canvas-wrapper",center:"_1X3Adq_center"};var Y0="./assets/icon-center-efd037807b3d5feb.svg";import{jsx as J0} from"preact/jsx-runtime";function M0({image:F,selectedTool:O,zoom:G,undoList:q,onChange:V,onChangeColor:W}){const $=_5(),[H,j]=k5(),A=O.fillColor||new E([0,0,0]),z=O.outlineColor||new E([0,0,0]);let P,L;const b=()=>{L=H.getImageData(0,0,Q.DrawWidth,Q.DrawHeight)},p=(Z=0,Y=0)=>{H.clearRect(0,0,Q.DrawWidth,Q.DrawHeight),H.putImageData(L,Z,Y)},u=()=>{V(L),L=null},B=()=>{let Z=new OffscreenCanvas(Q.DrawWidth,Q.DrawHeight),Y=Z.getContext("2d",{willReadFrequently:!0});Y.imageSmoothingEnabled=!1,Y.putImageData(q.at(-1),0,0),L=Y.getImageData(0,0,Q.DrawWidth,Q.DrawHeight),Y=null,Z=null},D=(Z,Y)=>{if(Z.invalid)return;const N=Z.index;L.data[N+0]=Y.r,L.data[N+1]=Y.g,L.data[N+2]=Y.b,L.data[N+3]=Y.a===0?0:255},c=(Z,Y,N,K)=>{D(new Q(Z.x-Y,Z.y+N),K),D(new Q(Z.x+Y,Z.y+N),K),D(new Q(Z.x+Y,Z.y-N),K),D(new Q(Z.x-Y,Z.y-N),K),D(new Q(Z.x-N,Z.y+Y),K),D(new Q(Z.x+N,Z.y+Y),K),D(new Q(Z.x+N,Z.y-Y),K),D(new Q(Z.x-N,Z.y-Y),K)},x=(Z,Y,N)=>{const K=Math.abs(Y.x-Z.x),X=Math.abs(Y.y-Z.y),J=Z.x<Y.x?1:-1,_=Z.y<Y.y?1:-1,S=new Q(Z.x,Z.y);let s=K-X;while(!0){if(D(S,N),S.x===Y.x&&S.y===Y.y)break;const i=2*s;if(i>-X)s-=X,S.x+=J;if(i<K)s+=K,S.y+=_}},f=(Z,Y,N)=>{let K=Z.x,X=Y.x,J=Z.y,_=Y.y;if(N.outline){const S=new Q(X,J),s=new Q(K,_);x(Z,S,N.outline),x(Y,s,N.outline),x(S,Y,N.outline),x(s,Z,N.outline),K+=1,X-=1,J+=1,_-=1}if(N.fill)for(let S=J;S<=_;S++)x(new Q(K,S),new Q(X,S),N.fill)},h=(Z,Y,N)=>{let K=0,X=Y,J=3-2*Y;while(K<=X){if(N.fill)for(let _=K;_<=X;_++)c(Z,K,_,N.fill);if(N.outline)c(Z,K,X,N.outline);if(J<0)J=J+4*K+6;else J=J+4*(K-X),X--;K++}},M=(Z)=>{if(Z.invalid)return;const Y={clear:A.clear,fill:A.rgb,outline:!1};if(Y.clear||O.type==="eraser"){if(Y.fill.a=0,!P)Y.fill={r:255,g:255,b:255},Y.outline={r:138,g:187,b:255}}if(O.penSize===1)D(Z,!P&&(Y.clear||O.type==="eraser")?Y.outline:Y.fill);else if(O.penSize===3)f(new Q(Z.x-1,Z.y-1),new Q(Z.x+1,Z.y+1),Y);else if(O.penSize<5){const N=O.penSize/2;f(new Q(Z.x-N,Z.y-N),new Q(Z.x+N-1,Z.y+N-1),Y)}else h(Z,Math.floor((O.penSize-1)/2),Y)},y=(Z)=>{if(Z.invalid)return;const Y=new E(Array.from(L.data.slice(Z.index,Z.index+4))),N=[],K=(X)=>{if(X.invalid)return;if(!N.includes(X.index)){const J=new E(Array.from(L.data.slice(X.index,X.index+4)));if(J.equals(Y)&&J.notEquals(A))N.push(X.index)}};K(Z);while(N.length>0){const X=N.shift();L.data[X+0]=A.rgb.r,L.data[X+1]=A.rgb.g,L.data[X+2]=A.rgb.b,L.data[X+3]=A.clear?0:255,Z=Q.from(X),K(Z.topPoint),K(Z.leftPoint),K(Z.rightPoint),K(Z.bottomPoint)}},I=(Z)=>{if(Z.preventDefault(),!$.current)return;P=!0;const Y=$.current.getBoundingClientRect();let N=Z.clientX-Y.left,K=Z.clientY-Y.top;if(N=Math.floor(Q.DrawWidth*N/$.current.clientWidth),K=Math.floor(Q.DrawHeight*K/$.current.clientHeight),O.type==="pen"||O.type==="eraser"||O.type==="fill"){const J=new Q(N,K);if(b(),O.type==="pen"||O.type==="eraser")M(J);else if(O.type==="fill")y(J);p()}else if(O.type.startsWith("picker-"))Z.stopPropagation();else if(O.type.startsWith("center")){const J=Q.DrawWidth/2-N,_=Q.DrawHeight/2-K;p(J,_),b()}const X=()=>{if(P)P=!1,u();document.removeEventListener("mouseup",X)};document.addEventListener("mouseup",X)},C=(Z)=>{if(Z.preventDefault(),!$.current)return;if(O.type==="center")return;const Y=$.current.getBoundingClientRect();let N=Z.clientX-Y.left,K=Z.clientY-Y.top;if(N=Math.floor(Q.DrawWidth*N/$.current.clientWidth),K=Math.floor(Q.DrawHeight*K/$.current.clientHeight),O.type==="pen"||O.type==="eraser"){const X=new Q(N,K);if(!P)B();else b();if(O.type==="pen"||O.type==="eraser")M(X);p()}else if(O.type.startsWith("picker-"));},d=(Z)=>{if(Z.preventDefault(),P=!1,O.type==="center"){u();return}const Y=$.current.getBoundingClientRect();let N=Z.clientX-Y.left,K=Z.clientY-Y.top;if(N=Math.floor(Q.DrawWidth*N/$.current.clientWidth),K=Math.floor(Q.DrawHeight*K/$.current.clientHeight),O.type.startsWith("picker-")){const[X,J,_,S]=H.getImageData(N,K,1,1).data;if(S===0){if(O.type==="picker-fill")W(new E(A.hsv,!0));if(O.type==="picker-outline")W(new E(z.hsv,!0))}else W(new E({r:X,g:J,b:_}).toHSVColor());return}if(u(),O.type==="eraser")B(),M(new Q(N,K)),p()},r=(Z)=>{if(Z.preventDefault(),!P)B(),p()};if(b0(()=>{if($.current){const Z=$.current.getContext("2d",{willReadFrequently:!0});Z.imageSmoothingEnabled=!1,j(Z)}return()=>{}},[$]),b0(()=>{if($.current){const Z=$.current.parentElement.parentElement;let Y=($.current.clientWidth-Z.clientWidth)/2,N=($.current.clientHeight-Z.clientHeight)/2;if(G>2){const X=Z.clientWidth/2;if(Y=(Z.scrollLeft+X)/Z.dataset.scrollWidth*$.current.clientWidth-X,G>4){const J=Z.clientHeight/2;N=(Z.scrollTop+J)/Z.dataset.scrollHeight*$.current.clientHeight-J}}Z.dataset.scrollWidth=$.current.clientWidth,Z.dataset.scrollHeight=$.current.clientHeight,Z.scroll({top:N>0?N:0,left:Y>0?Y:0});const K=$.current.nextSibling;K.style.top=`${G*Q.DrawHeight/2}px`,K.style.left=`${G*Q.DrawWidth/2}px`}return()=>{}},[G]),H&&q.length===0)if(F)j0(F).then((Z)=>{const Y=Q.DrawWidth/2-F.centerX,N=Q.DrawHeight/2-F.centerY;H.clearRect(0,0,Q.DrawWidth,Q.DrawHeight),H.drawImage(Z,Y,N),b(),u()});else b(),u();if(H&&q.length>0)B(),p();return J0("div",{className:o.drawBox,children:J0("div",{className:o.drawCanvasWrapper,children:[J0("canvas",{ref:$,className:u0(o.drawCanvas,{[o.center]:O.type==="center",[o.picker]:O.type.startsWith("picker-")}),width:Q.DrawWidth,height:Q.DrawHeight,style:{width:Q.DrawWidth*G,height:Q.DrawHeight*G},onMouseDown:I,onMouseMove:C,onMouseUp:d,onMouseLeave:r}),J0("img",{src:Y0,className:u0(o.centerIcon,{[o.hidden]:O.type!=="center"})})]})})}m(".KOzPOa_painter-wrapper{padding:calc(var(--space)*1.5);border-left:1px solid var(--ui-black-transparent);color:var(--text-primary);flex-direction:column;flex:1;display:flex}.KOzPOa_row{min-height:3rem;margin-bottom:.5rem;display:flex}.KOzPOa_row-fill{padding-top:calc(var(--space)*2.5);border-top:1px dashed var(--ui-black-transparent);flex-direction:row;flex:1}.KOzPOa_row-right{margin-right:var(--space);justify-content:right}.KOzPOa_row:last-child{min-height:unset;margin-bottom:0}.KOzPOa_group{margin-right:calc(var(--space)*1.5);flex-direction:row;align-items:center;display:inline-flex}.KOzPOa_disabled{opacity:.3;pointer-events:none}.KOzPOa_dashed-border{border-right:1px dashed var(--ui-black-transparent);padding-right:var(--space)}.KOzPOa_name-input{width:8rem}.KOzPOa_large-input{width:4rem}.KOzPOa_tool-icon{margin-right:var(--space);width:2rem;height:2rem}.KOzPOa_label-image{vertical-align:middle;margin-right:calc(var(--space)/2)}.KOzPOa_button{width:calc(2rem + 2px);height:calc(2rem + 2px);padding:.375rem}.KOzPOa_button-icon{width:1.5rem;margin:auto}.KOzPOa_group-button{border-left:none;border-radius:0}.KOzPOa_group-button-first{border-top-right-radius:0;border-bottom-right-radius:0}.KOzPOa_group-button-last{border-left:none;border-top-left-radius:0;border-bottom-left-radius:0}.KOzPOa_group-button-toggled-off{filter:saturate(0)}.KOzPOa_label-button{border:0;font-weight:400}.KOzPOa_label-button.KOzPOa_selected{background:var(--motion-primary);color:var(--ui-white)}.KOzPOa_label-button.KOzPOa_selected .KOzPOa_button-icon{filter:brightness(0)invert()}.KOzPOa_draw-box-wrapper{margin:0 var(--space);border:1px solid var(--ui-black-transparent);border-radius:calc(var(--space)/2);flex:1;position:relative;overflow:hidden}");var U={rowFill:"KOzPOa_row-fill",disabled:"KOzPOa_disabled",groupButtonLast:"KOzPOa_group-button-last",dashedBorder:"KOzPOa_dashed-border",groupButtonToggledOff:"KOzPOa_group-button-toggled-off",rowRight:"KOzPOa_row-right",largeInput:"KOzPOa_large-input",painterWrapper:"KOzPOa_painter-wrapper",nameInput:"KOzPOa_name-input",buttonIcon:"KOzPOa_button-icon",selected:"KOzPOa_selected",labelButton:"KOzPOa_label-button",row:"KOzPOa_row",labelImage:"KOzPOa_label-image",groupButton:"KOzPOa_group-button",group:"KOzPOa_group",toolIcon:"KOzPOa_tool-icon",groupButtonFirst:"KOzPOa_group-button-first",button:"KOzPOa_button",drawBoxWrapper:"KOzPOa_draw-box-wrapper"};var x0="./assets/icon-undo-92fd565bdcf5e457.svg";var y0="./assets/icon-redo-68a33bfc57bb7814.svg";var p0="./assets/icon-zoom-in-de37432ea621c379.svg";var m0="./assets/icon-zoom-out-4c68fd9c343d89de.svg";var c0="./assets/icon-zoom-reset-7cf90555286e353d.svg";import{jsx as R,Fragment as C5} from"preact/jsx-runtime";function U0({mode:F,imageList:O,imageIndex:G}){const{getText:q,maybeLocaleText:V}=D5(),{modifyAsset:W}=f5(),[$,H]=l(1),[j,A]=l("draw"),[z,P]=l("pen"),[L,b]=l(10),[p,u]=l(2),[B,D]=l(new E([260,0.6,1])),[c,x]=l(new E([0,1,0])),[f,h]=l([]),[M,y]=l([]),I=O[G],C=I&&I.id,d=!C,r=(J,_,S)=>{if(F==="costume")return _;if(F==="backdrop")return S;return J},Z=(J)=>{if(J.id=C,J.data){const _=P0(J.data);J.type=_.type,J.data=_.data,J.width=_.width,J.height=_.height,J.centerX=_.centerX,J.centerY=_.centerY}W(J)},Y=(J,_)=>{const S={};if(J==="name")S.name=_;if(J==="data"){if(S.data=_,f.length>20)f.splice(1,1);if(h(f.concat(S.data)),y([]),f.length===0)return}if(Z(S),j!=="draw")A("draw")},N=(J)=>{if(j==="picker-fill")D(J);if(j==="picker-outline")x(J)},K=()=>{const J=f.pop();h(f),y(M.concat(J)),Z({data:f.at(-1)})},X=()=>{const J=M.pop();h(f.concat(J)),y(M),Z({data:J})};return L5(()=>{return h([]),y([]),A("draw"),()=>{}},[C]),R("div",{className:U.painterWrapper,children:[R("div",{className:U.row,children:[R("div",{className:U.group,children:R(H0,{text:r(q("pixelPaint.painter.image","Image"),q("pixelPaint.painter.costume","Costume"),q("pixelPaint.painter.backdrop","Backdrop")),children:R(I5,{disabled:d,className:U.nameInput,placeholder:q("pixelPaint.painter.name","name"),onSubmit:(J)=>Y("name",J),value:I?V(I.name):r(q("pixelPaint.painter.image","Image"),q("pixelPaint.painter.costume","Costume"),q("pixelPaint.painter.backdrop","Backdrop"))})})}),R("div",{className:U.group,children:[R(Z0,{disabled:f.length<=1,className:g(U.button,U.groupButtonFirst,{[U.groupButtonToggledOff]:d}),onClick:K,children:R("img",{src:x0,className:U.buttonIcon,title:q("pixelPaint.painter.undo","Undo")})}),R(Z0,{disabled:M.length===0,className:g(U.button,U.groupButtonLast,{[U.groupButtonToggledOff]:d}),onClick:X,children:R("img",{src:y0,className:U.buttonIcon,title:q("pixelPaint.painter.redo","Redo")})})]}),R("div",{className:U.group,children:F==="costume"&&R(Z0,{vertical:!0,className:g(U.labelButton,{[U.selected]:j==="center"}),onClick:()=>A(j!=="center"?"center":"draw"),children:[R("img",{src:Y0,className:U.buttonIcon,title:q("pixelPaint.painter.center","Center")}),R("span",{children:q("pixelPaint.painter.center","Center")})]})})]}),R("div",{className:U.row,children:[R("div",{className:U.group,children:R(H0,{text:q("pixelPaint.painter.fill","Fill"),children:R(q0,{picking:j.startsWith("picker-"),color:B,onChange:D,onPickColor:(J)=>A(J===!1?"draw":"picker-fill")})})}),R("div",{className:g(U.group,U.dashedBorder),children:[R(H0,{className:g({[U.disabled]:!0}),text:q("pixelPaint.painter.outline","Outline"),children:R(q0,{outline:!0,picking:j.startsWith("picker-"),color:c,onChange:x,onPickColor:(J)=>A(J===!1?"draw":"picker-outline")})}),R(g0,{small:!0,type:"number",min:0,max:100,step:1,className:g(U.largeInput,{[U.disabled]:!0}),value:p,onChange:(J)=>u(J.target.valueAsNumber)})]}),R("div",{className:U.group,children:z==="pen"||z==="eraser"?R(C5,{children:[R("img",{src:z==="pen"?K0:$0,className:U.toolIcon}),R(g0,{small:!0,type:"number",min:1,max:100,step:1,className:U.largeInput,value:L,onChange:(J)=>b(J.target.valueAsNumber)})]}):null})]}),R("div",{className:g(U.row,U.rowFill),children:[R(X0,{selectedTool:z,onSelect:P}),R("div",{className:U.drawBoxWrapper,children:R(M0,{image:I,zoom:$,selectedTool:{fillColor:B,outlineColor:c,penSize:L,outlineSize:p,type:j==="draw"?z:j},undoList:f,onChange:(J)=>Y("data",J),onChangeColor:N})})]}),R("div",{className:g(U.row,U.rowRight),children:[R(Z0,{className:g(U.button,U.groupButtonFirst),onClick:()=>$-1>0&&H($-1),children:R("img",{src:m0,className:U.buttonIcon})}),R(Z0,{className:g(U.button,U.groupButton),onClick:()=>H(1),children:R("img",{src:c0,className:U.buttonIcon})}),R(Z0,{className:g(U.button,U.groupButtonLast),onClick:()=>$+1<20&&H($+1),children:R("img",{src:p0,className:U.buttonIcon})})]})]})}m(".gJa9lW_pixel-paint-wrapper{background:var(--ui-white);border-radius:inherit;flex-grow:1;display:flex}");var d0={pixelPaintWrapper:"gJa9lW_pixel-paint-wrapper"};function b5({onSetupLibrary:F}){const{fileList:O,assetList:G,selectedIndex:q}=T5();let V=G.filter((H)=>/^image\//.test(H.type)),W="image";const $=O[q];if($&&$.assets&&$.frame!=null)V=V.filter((H)=>$.assets.includes(H.id)),W=q===0?"backdrop":"costume";return E0("div",{className:d0.pixelPaintWrapper,children:[E0(Q0,{mode:W,imageList:V,imageIndex:$.frame,onSetupLibrary:F}),E0(U0,{mode:W,imageIndex:$.frame,imageList:V})]})}import{jsx as E0} from"preact/jsx-runtime";var r0={"pixelPaint.contextMenu.duplicate":"duplicate","pixelPaint.contextMenu.export":"export","pixelPaint.contextMenu.delete":"delete","pixelPaint.actionButton.upload":"Upload Image","pixelPaint.actionButton.uploadCostume":"Upload Costume","pixelPaint.actionButton.uploadBackdrop":"Upload Backdrop","pixelPaint.actionButton.surprise":"Surprise","pixelPaint.actionButton.paint":"Paint","pixelPaint.actionButton.image":"Choose a Image","pixelPaint.actionButton.costume":"Choose a Costume","pixelPaint.actionButton.backdrop":"Choose a Backdrop","pixelPaint.painter.image":"Image","pixelPaint.painter.costume":"Costume","pixelPaint.painter.backdrop":"Backdrop","pixelPaint.painter.name":"name","pixelPaint.painter.undo":"Undo","pixelPaint.painter.redo":"Redo","pixelPaint.painter.pen":"Pen","pixelPaint.painter.eraser":"Eraser","pixelPaint.painter.fill":"Fill","pixelPaint.painter.text":"Text","pixelPaint.painter.line":"Line","pixelPaint.painter.rectangle":"Rectangle","pixelPaint.painter.circle":"Circle","pixelPaint.painter.select":"Select","pixelPaint.painter.center":"Center","pixelPaint.painter.outline":"Outline","pixelPaint.colorPicker.color":"Color","pixelPaint.colorPicker.saturation":"Saturation","pixelPaint.colorPicker.brightness":"Brightness"};var n0={"pixelPaint.contextMenu.duplicate":"\u590D\u5236","pixelPaint.contextMenu.export":"\u5BFC\u51FA","pixelPaint.contextMenu.delete":"\u5220\u9664","pixelPaint.actionButton.upload":"\u4E0A\u4F20\u56FE\u7247","pixelPaint.actionButton.uploadCostume":"\u4E0A\u4F20\u9020\u578B","pixelPaint.actionButton.uploadBackdrop":"\u4E0A\u4F20\u80CC\u666F","pixelPaint.actionButton.surprise":"\u968F\u673A","pixelPaint.actionButton.paint":"\u7ED8\u5236","pixelPaint.actionButton.image":"\u9009\u62E9\u4E00\u4E2A\u56FE\u7247","pixelPaint.actionButton.costume":"\u9009\u62E9\u4E00\u4E2A\u9020\u578B","pixelPaint.actionButton.backdrop":"\u9009\u62E9\u4E00\u4E2A\u80CC\u666F","pixelPaint.painter.image":"\u56FE\u7247","pixelPaint.painter.costume":"\u9020\u578B","pixelPaint.painter.backdrop":"\u80CC\u666F","pixelPaint.painter.name":"\u540D\u5B57","pixelPaint.painter.undo":"\u64A4\u9500","pixelPaint.painter.redo":"\u91CD\u505A","pixelPaint.painter.pen":"\u753B\u7B14","pixelPaint.painter.eraser":"\u6A61\u76AE\u64E6","pixelPaint.painter.fill":"\u586B\u5145","pixelPaint.painter.text":"\u6587\u672C","pixelPaint.painter.line":"\u7EBF\u6BB5","pixelPaint.painter.rectangle":"\u77E9\u5F62","pixelPaint.painter.circle":"\u5706\u5F62","pixelPaint.painter.select":"\u9009\u62E9","pixelPaint.painter.center":"\u4E2D\u5FC3","pixelPaint.painter.outline":"\u8F6E\u5ED3","pixelPaint.colorPicker.color":"\u989C\u8272","pixelPaint.colorPicker.saturation":"\u9971\u548C\u5EA6","pixelPaint.colorPicker.brightness":"\u4EAE\u5EA6"};var d7={en:r0,"zh-Hans":n0};export{d7 as locales,b5 as PixelPaint};
