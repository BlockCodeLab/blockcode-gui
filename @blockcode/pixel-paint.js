import{useEditor as K5}from"@blockcode/core";import{useState as h1}from"preact/hooks";import{useLocale as s5,useLayout as o5,useEditor as c5}from"@blockcode/core";import{IconSelector as d5,ActionButton as p5}from"@blockcode/ui";class c{static get DrawWidth(){return 320}static get DrawHeight(){return 240}static from(t){const e=t>>2,i=Math.floor(e/320),n=e-i*320;return new c(n,i)}constructor(t,e){this.setXY(t,e)}get x(){return this._x}set x(t){this._x=t,this._index=this.x+this.y*320<<2}get y(){return this._y}set y(t){this._y=t,this._index=this.x+this.y*320<<2}get index(){return this._index}get valid(){return this.x>=0&&this.x<320&&this.y>=0&&this.y<240}get invalid(){return!this.valid}get topPoint(){return new c(this.x,this.y-1)}get leftPoint(){return new c(this.x-1,this.y)}get rightPoint(){return new c(this.x+1,this.y)}get bottomPoint(){return new c(this.x,this.y+1)}get topLeftPoint(){return new c(this.x-1,this.y-1)}get topRightPoint(){return new c(this.x+1,this.y-1)}get bottomLeftPoint(){return new c(this.x-1,this.y+1)}get bottomRightPoint(){return new c(this.x+1,this.y+1)}setXY(t,e){return this._x=t,this._y=e,this._index=this.x+this.y*320<<2,this}equals(t){return this.x==t.x&&this.y==t.y}}function N1(t){return new Promise(async(e)=>{const i=new FileReader;i.readAsDataURL(t),i.addEventListener("load",()=>{const n=new Image;n.src=i.result,n.addEventListener("load",()=>{if(n.dataset.data){e(n);return}let{width:p,height:d}=n;if(n.width>c.DrawWidth||n.height>c.DrawHeight){p=c.DrawWidth,d=c.DrawHeight;const v=n.width/c.DrawWidth,x=n.height/c.DrawHeight;if(v>x)d=n.height/v;else p=n.width/x}const s=document.createElement("canvas");s.width=p,s.height=d,s.getContext("2d").drawImage(n,0,0,p,d);const m=s.toDataURL("image/png");if(m===t5){e(null);return}n.dataset.data=m.slice(v1),n.src=m})})})}function f1(t){return new Promise(async(e)=>{const i=new Image;let n="image/png";if(typeof t==="string")i.src=t;else n=t.type,i.src=`data:${n};base64,${t.data}`;i.addEventListener("load",()=>{i.dataset.data=i.src.slice(`data:${n};base64,`.length),e(i)})})}function I1(t){return new Promise(async(e)=>{const i=new Image;i.src=t,i.addEventListener("load",()=>{const n=document.createElement("canvas");n.width=i.width,n.height=i.height,n.getContext("2d").drawImage(i,0,0,i.width,i.height);const d=n.toDataURL("image/png");i.dataset.data=d.slice(v1),e(i)})})}var v1="data:image/png;base64,".length,t5="data:,";function e1(t=32){const e=[];for(let i=0;i<t;i++)e[i]="0123456789abcdefghijklmnopqrstuvwxyz".charAt(Math.random()*"0123456789abcdefghijklmnopqrstuvwxyz".length);return e.join("")}function W(t){const e=globalThis.document,i=e.createElement("style");i.appendChild(e.createTextNode(t)),e.head.append(i)}W(".K-gn7q_selector-wrapper{background:var(--ui-secondary);width:150px;position:relative}.K-gn7q_selector-items-wrapper{width:150px;min-height:100%;padding-bottom:100px}.K-gn7q_selector-item{width:5rem;height:5rem;margin:.5rem auto}.K-gn7q_delete-menu-item:hover{background:var(--error-primary)}.K-gn7q_add-button-wrapper{background:linear-gradient(transparent,var(--ui-secondary));width:100%;height:100px;display:flex;position:absolute;bottom:0;left:0;right:0}.K-gn7q_add-button{margin:.75rem auto}");var i1={selectorWrapper:"K-gn7q_selector-wrapper",addButton:"K-gn7q_add-button",selectorItemsWrapper:"K-gn7q_selector-items-wrapper",addButtonWrapper:"K-gn7q_add-button-wrapper",selectorItem:"K-gn7q_selector-item",deleteMenuItem:"K-gn7q_delete-menu-item"};var A1="./assets/icon-sprite-zx9m3hdh.svg";var D1="./assets/icon-backdrop-qvqgzqwj.svg";var O1="./assets/icon-surprise-d5t4529a.svg";var z1="./assets/icon-search-6g8kgvdt.svg";var b1="./assets/icon-paint-0h8zs19a.svg";var _1="./assets/icon-file-upload-0z25chr6.svg";import{jsx as a1,jsxs as h5}from"preact/jsx-runtime";function w1({mode:t,imageList:e,imageIndex:i,onSetupLibrary:n}){const[p,d]=h1(!1),[s,g]=h1(!1),[m,v]=h1(!1),{getText:x}=s5(),{createAlert:A,removeAlert:G}=o5(),{addAsset:_,deleteAsset:z,modifyFile:B}=c5(),f=e.map((l)=>l.id),{ImagesLibrary:S,BackdropsLibrary:F,CostumesLibrary:j}=n(),P=()=>{if(t==="costume"){d(!1),g(!0),v(!1);return}if(t==="backdrop"){d(!1),g(!1),v(!0);return}d(!0),g(!1),v(!1)},N=()=>{d(!1),g(!1),v(!1)},h=async({tags:l,...o})=>{const a=e1();A("importing",{id:a});const w=await I1(`./assets/${o.id}.png`);_({...o,id:a,type:"image/png",data:w.dataset.data,width:w.width,height:w.height}),f.push(a),G(a),B({assets:f,frame:f.length-1})},T=()=>{if(t==="costume"){h(j.surprise());return}if(t==="backdrop"){h(F.surprise());return}h(S.surprise())},b=(l,o,a)=>{if(t==="costume")return o;if(t==="backdrop")return a;return l},E=(l)=>`data:${l.type};base64,${l.data}`,R=(l)=>{B({frame:l})},H=()=>{const l=document.createElement("input");l.type="file",l.accept="image/*",l.multiple=!0,l.click(),l.addEventListener("change",async({target:o})=>{const a=e1();A("importing",{id:a});for(let w of o.files){const k=e1(),y=w.name.slice(0,w.name.lastIndexOf("."));let D=await N1(w);if(!D)A({message:x("pixelPaint.actionButton.uploadError",'Upload "{file}" failed.',{file:w.name})},2000),D={dataset:{data:"iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAAtJREFUGFdjYAACAAAFAAGq1chRAAAAAElFTkSuQmCC"},width:1,height:1};_({id:k,type:"image/png",name:y,data:D.dataset.data,width:D.width,height:D.height,centerX:Math.floor(D.width/2),centerY:Math.floor(D.height/2)}),f.push(k)}G(a),B({assets:f,frame:f.length-1})})},Z=()=>{const l=e1();_({id:l,type:"image/png",name:x(`pixelPaint.painter.${t}`,t),data:"iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAAtJREFUGFdjYAACAAAFAAGq1chRAAAAAElFTkSuQmCC",width:1,height:1,centerX:1,centerY:1}),f.push(l),B({assets:f,frame:f.length-1})},Q=(l)=>{z(f[l]),f.splice(l,1),B({assets:f,frame:i===0?0:l>i?i:i-1})},r=(l)=>{const o=e[l],a=e1();_({...o,id:a}),f.push(a),B({assets:f,frame:f.length-1})};return h5("div",{className:i1.selectorWrapper,children:[a1(d5,{displayOrder:!0,id:"paint-selector",className:i1.selectorItemsWrapper,items:e.map((l,o)=>({...l,details:`${l.width}\xD7${l.height}`,icon:E(l),order:o,className:i1.selectorItem,contextMenu:[[{label:x("pixelPaint.contextMenu.duplicate","duplicate"),onClick:()=>r(o)},{label:x("pixelPaint.contextMenu.export","export"),disabled:!0}],[{label:x("pixelPaint.contextMenu.delete","delete"),className:i1.deleteMenuItem,disabled:e.length<=1,onClick:()=>Q(o)}]]})),selectedIndex:i,onSelect:R,onDelete:e.length>1&&Q}),a1("div",{className:i1.addButtonWrapper,children:a1(p5,{tooltipPlacement:"right",className:i1.addButton,icon:t==="costume"?A1:D1,tooltip:b(x("pixelPaint.actionButton.image","Choose a Image"),x("pixelPaint.actionButton.costume","Choose a Costume"),x("pixelPaint.actionButton.backdrop","Choose a Backdrop")),onClick:P,moreButtons:[{icon:_1,tooltip:b(x("pixelPaint.actionButton.upload","Upload Image"),x("pixelPaint.actionButton.uploadCostume","Upload Costume"),x("pixelPaint.actionButton.uploadBackdrop","Upload Backdrop")),onClick:H},{icon:O1,tooltip:x("pixelPaint.actionButton.surprise","Surprise"),onClick:T},{icon:b1,tooltip:x("pixelPaint.actionButton.paint","Paint"),onClick:Z},{icon:z1,tooltip:b(x("pixelPaint.actionButton.image","Choose a Image"),x("pixelPaint.actionButton.costume","Choose a Costume"),x("pixelPaint.actionButton.backdrop","Choose a Backdrop")),onClick:P}]})}),p&&S&&a1(S,{onClose:N,onSelect:h}),s&&j&&a1(j,{onClose:N,onSelect:h}),m&&F&&a1(F,{onClose:N,onSelect:h})]})}import{useEffect as W5,useState as q}from"preact/hooks";import{useLocale as U5,useEditor as Z5}from"@blockcode/core";import{classNames as U,Text as Q5,Label as C1,BufferedInput as k1,Button as n1}from"@blockcode/ui";class M{static decimalToHex(t){if(t<0)t+=16777216;let e=Number(t).toString(16);return e=`#${"000000".substr(0,6-e.length)}${e}`,e}static decimalToRgb(t){const e=t>>24&255,i=t>>16&255,n=t>>8&255,p=t&255;return{r:i,g:n,b:p,a:e>0?e:255}}static hexToRgb(t){const e=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;t=t.replace(e,(n,p,d,s)=>p+p+d+d+s+s);const i=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return i?{r:parseInt(i[1],16),g:parseInt(i[2],16),b:parseInt(i[3],16)}:null}static rgbToHex(t){return M.decimalToHex(M.rgbToDecimal(t))}static rgbToDecimal(t){return(t.r<<16)+(t.g<<8)+t.b}static hexToDecimal(t){return M.rgbToDecimal(M.hexToRgb(t))}static hsvToRgb(t){let e=t.h%360;if(e<0)e+=360;const i=Math.max(0,Math.min(t.s,1)),n=Math.max(0,Math.min(t.v,1)),p=Math.floor(e/60),d=e/60-p,s=n*(1-i),g=n*(1-i*d),m=n*(1-i*(1-d));let v,x,A;switch(p){default:case 0:v=n,x=m,A=s;break;case 1:v=g,x=n,A=s;break;case 2:v=s,x=n,A=m;break;case 3:v=s,x=g,A=n;break;case 4:v=m,x=s,A=n;break;case 5:v=n,x=s,A=g;break}return{r:Math.floor(v*255),g:Math.floor(x*255),b:Math.floor(A*255)}}static rgbToHsv(t){const e=t.r/255,i=t.g/255,n=t.b/255,p=Math.min(Math.min(e,i),n),d=Math.max(Math.max(e,i),n);let s=0,g=0;if(p!==d){const m=e===p?i-n:i===p?n-e:e-i;s=((e===p?3:i===p?5:1)-m/(d-p))*60%360,g=(d-p)/d}return{h:s,s:g,v:d}}static mixRgb(t,e,i){if(i<=0)return t;if(i>=1)return e;const n=1-i;return{r:n*t.r+i*e.r,g:n*t.g+i*e.g,b:n*t.b+i*e.b}}constructor(t,e=!1){if(this._clear=e,this._color=t,typeof t==="number")this._type="decimal";else if(typeof t==="string"&&t[0]==="#")this._type="hex";else if(Array.isArray(t)){const[i,n,p]=t;if(n<=1&&p<=1)this._type="hsv",this._color={h:i,s:n,v:p};else this._type="rgb",this._color={r:i,g:n,b:p};this._clear=e||t[3]===0}else if(typeof t.r==="number")this._type="rgb";else if(typeof t.h==="number")this._type="hsv"}get clear(){return this._clear}get rgb(){if(this._type==="rgb")return this._color;if(this._type==="decimal")return M.decimalToRgb(this._color);if(this._type==="hsv")return M.hsvToRgb(this._color);if(this._type==="hex")return M.hexToRgb(this._color)}get hsv(){if(this._type==="hsv")return this._color;if(this._type==="decimal")return M.rgbToHsv(M.decimalToRgb(this._color));if(this._type==="rgb")return M.rgbToHsv(this._color);if(this._type==="hex")return M.rgbToHsv(M.hexToRgb(this._color))}get hex(){if(this._type==="hex")return this._color;if(this._type==="decimal")return M.decimalToHex(this._color);if(this._type==="rgb")return M.rgbToHex(this._color);if(this._type==="hsv")return M.rgbToHex(M.hsvToRgb(this._color))}get decimal(){if(this._type==="decimal")this._color;if(this._type==="rgb")return M.rgbToDecimal(this._color);if(this._type==="hsv")return M.rgbToDecimal(M.hsvToRgb(this._color));if(this._type==="hex")return M.hexToDecimal(this._color)}toRGBColor(){if(this._type==="rgb")return this;return new M(this.rgb,this.clear)}toHSVColor(){if(this._type==="hsv")return this;return new M(this.hsv,this.clear)}toHEXColor(){if(this._type==="hex")return this;return new M(this.hex,this.clear)}toDecimalColor(){if(this._type==="decimal")return this;return new M(this.decimal,this.clear)}equals(t){return this.rgb.r===t.rgb.r&&this.rgb.g===t.rgb.g&&this.rgb.b===t.rgb.b&&this.clear===t.clear}notEquals(t){return!this.equals(t)}}function j1(t){const e=w5(t),i=g5(t,e),n=u5(t,e,i),p=x5(t,e,i,n),d={top:e||0,left:n||0,right:p||0,bottom:i||0};return d.width=d.right-d.left+1,d.height=d.bottom-d.top+1,d}var w5=(t)=>{let e;for(let i=0;i<t.height;i++){e=i*t.width;for(let n=0;n<t.width;n++){if(t.data[(e<<2)+3]!==0)return i;e++}}},g5=(t,e)=>{let i;for(let n=t.height-1;n>=e;n--){i=n*t.width;for(let p=0;p<t.width;p++){if(t.data[(i<<2)+3]!==0)return n;i++}}},u5=(t,e,i)=>{let n;for(let p=0;p<t.width;p++)for(let d=e;d<=i;d++)if(n=d*t.width+p,t.data[(n<<2)+3]!==0)return p},x5=(t,e,i,n)=>{let p;for(let d=t.width-1;d>=n;d--)for(let s=e;s<=i;s++)if(p=s*t.width+d,t.data[(p<<2)+3]!==0)return d};function P1(t){const{top:e,left:i,width:n,height:p}=j1(t),d=Math.floor(t.width/2-i),s=Math.floor(t.height/2-e),g=document.createElement("canvas");g.width=n,g.height=p,g.getContext("2d").putImageData(t,-i,-e,i,e,n,p);const[v,x]=g.toDataURL().slice(5).split(";base64,");return{type:v,data:x,width:n,height:p,centerX:d,centerY:s}}import{classNames as r1,Text as u1,Tooltip as C5}from"@blockcode/ui";W("._Y2YyW_color-picker-wrapper{margin-right:var(--space);cursor:pointer;width:3rem;height:2rem;display:flex}._Y2YyW_color-swatch{border:1px solid var(--ui-black-transparent);border-top-left-radius:var(--form-radius);border-bottom-left-radius:var(--form-radius);flex-shrink:0;flex-basis:2rem;height:100%;display:flex;position:relative}._Y2YyW_color-swatch-outline:after{content:\"\";background:var(--ui-white);border:1px solid var(--ui-black-transparent);z-index:1;width:.75rem;height:.75rem;position:absolute;top:.5rem;left:.5rem}._Y2YyW_picker-arrow{user-select:none;border:1px solid var(--ui-black-transparent);border-top-right-radius:var(--form-radius);border-bottom-right-radius:var(--form-radius);border-left:0;flex-shrink:0;flex-basis:1rem;justify-content:center;align-items:center;height:100%;font-size:.75rem;display:flex}._Y2YyW_color-tooltip{background:var(--ui-white);color:var(--text-primary);padding:calc(var(--space)/2)}._Y2YyW_tooltip-item{margin:8px}._Y2YyW_tooltip-item-label{font-weight:700}._Y2YyW_tooltip-item-readout{margin-left:10px}._Y2YyW_tooltip-item-slider{border-radius:11px;outline:none;width:150px;height:22px;margin-bottom:20px;position:relative}._Y2YyW_tooltip-item-slider-handler{background-color:var(--ui-white);box-shadow:0 0 0 4px var(--ui-black-transparent);touch-action:none;border-radius:100%;width:26px;height:26px;margin-top:-2px;position:absolute;left:100px}._Y2YyW_tooltip-item-toolbar{justify-content:space-between;display:flex}._Y2YyW_tooltip-item-toolbar-button{border:1px solid var(--ui-black-transparent);border-radius:var(--form-radius);cursor:pointer;width:calc(1.5rem + 2px);height:calc(1.5rem + 2px)}._Y2YyW_tooltip-item-toolbar-button._Y2YyW_selected{border:1px solid #855cd6;box-shadow:0 0 0 3px #855cd659}._Y2YyW_button-icon{width:1.5rem;height:1.5rem}");var C={tooltipItem:"_Y2YyW_tooltip-item",tooltipItemSliderHandler:"_Y2YyW_tooltip-item-slider-handler",tooltipItemToolbar:"_Y2YyW_tooltip-item-toolbar",pickerArrow:"_Y2YyW_picker-arrow",tooltipItemLabel:"_Y2YyW_tooltip-item-label",colorTooltip:"_Y2YyW_color-tooltip",colorSwatch:"_Y2YyW_color-swatch",tooltipItemSlider:"_Y2YyW_tooltip-item-slider",tooltipItemToolbarButton:"_Y2YyW_tooltip-item-toolbar-button",selected:"_Y2YyW_selected",buttonIcon:"_Y2YyW_button-icon",colorPickerWrapper:"_Y2YyW_color-picker-wrapper",colorSwatchOutline:"_Y2YyW_color-swatch-outline",tooltipItemReadout:"_Y2YyW_tooltip-item-readout"};var E1="./assets/icon-picker-2frmfa34.svg";var g1="./assets/icon-clear-gctr9axd.svg";import{jsx as O,jsxs as l1,Fragment as L5}from"preact/jsx-runtime";var k5=[0,0,324,288,252,216,180,144,108,72,36,0,0],X=124;function o1({picking:t,color:e,outline:i,onChange:n,onPickColor:p}){const d=e.hsv.h,s=e.hsv.s,g=e.hsv.v,m=(h,T,b,E)=>new M({h,s:T,v:b},E),v=(h)=>n(m(Math.round(h*360),s,g)),x=(h)=>n(m(d,h,g)),A=(h)=>n(m(d,s,h)),G=()=>n(m(d,s,g,!0)),_=(h,T)=>{h.stopPropagation();const b=h.target,E=b.offsetLeft,R=h.clientX,H=(Q)=>{Q.preventDefault();let r=Q.clientX-R+E;if(r>=X)r=X;if(r<=0)r=0;b.style.left=`${r}px`,T(r/X)},Z=()=>{document.removeEventListener("mousemove",H),document.removeEventListener("mouseup",Z)};document.addEventListener("mousemove",H),document.addEventListener("mouseup",Z)},z=(h)=>_(h,v),B=(h)=>_(h,x),f=(h)=>_(h,A),S=(h,T)=>{const b=h.target.children[0];let E=h.offsetX-13;if(E>=X)E=X;if(E<=0)E=0;b.style.left=`${E}px`,T(E/X)},F=(h)=>S(h,v),j=(h)=>S(h,x),P=(h)=>S(h,A),N=k5.map((h)=>m(h,s,g).hex);return O(C5,{clickable:!0,placement:"bottom",className:C.colorTooltip,onHide:()=>p(!1),content:l1(L5,{children:[l1("div",{className:C.tooltipItem,children:[O("span",{className:C.tooltipItemLabel,children:O(u1,{id:"pixelPaint.colorPicker.color",defaultMessage:"Color"})}),O("span",{className:C.tooltipItemReadout,children:Math.round(d/360*100)})]}),O("div",{className:r1(C.tooltipItem,C.tooltipItemSlider),style:{background:`linear-gradient(to left, ${N[0]} 0px, ${N[1]} 13px, ${N[2]}, ${N[3]}, ${N[4]}, ${N[5]}, ${N[6]}, ${N[7]}, ${N[8]}, ${N[9]}, ${N[10]}, ${N[11]} 137px, ${N[12]} 100%)`},onClick:F,children:O("div",{className:C.tooltipItemSliderHandler,style:{left:`${Math.round(d/360*X)}px`},onMouseDown:z,onClick:(h)=>h.stopPropagation()})}),l1("div",{className:C.tooltipItem,children:[O("span",{className:C.tooltipItemLabel,children:O(u1,{id:"pixelPaint.colorPicker.saturation",defaultMessage:"Saturation"})}),O("span",{className:C.tooltipItemReadout,children:Math.round(s*100)})]}),O("div",{className:r1(C.tooltipItem,C.tooltipItemSlider),style:{background:`linear-gradient(to right, ${m(d,0,g).hex} 0px, ${m(d,1,g).hex} 100%)`},onClick:j,children:O("div",{className:C.tooltipItemSliderHandler,style:{left:`${Math.round(s*X)}px`},onMouseDown:B,onClick:(h)=>h.stopPropagation()})}),l1("div",{className:C.tooltipItem,children:[O("span",{className:C.tooltipItemLabel,children:O(u1,{id:"pixelPaint.colorPicker.brightness",defaultMessage:"Brightness"})}),O("span",{className:C.tooltipItemReadout,children:Math.round(g*100)})]}),O("div",{className:r1(C.tooltipItem,C.tooltipItemSlider),style:{background:`linear-gradient(to right, ${m(d,s,0).hex} 0px, ${m(d,s,1).hex} 100%)`},onClick:P,children:O("div",{className:C.tooltipItemSliderHandler,style:{left:`${Math.round(g*X)}px`},onMouseDown:f,onClick:(h)=>h.stopPropagation()})}),l1("div",{className:r1(C.tooltipItem,C.tooltipItemToolbar),children:[O("div",{className:r1(C.tooltipItemToolbarButton,{[C.selected]:e.clear}),onClick:G,children:O("img",{src:g1,className:C.buttonIcon})}),O("div",{className:r1(C.tooltipItemToolbarButton,{[C.selected]:t}),onClick:p,children:O("img",{src:E1,className:C.buttonIcon})})]})]}),children:l1("div",{className:C.colorPickerWrapper,children:[O("div",{className:r1(C.colorSwatch,{[C.colorSwatchOutline]:i}),style:{background:e.clear?"var(--ui-white)":m(d,s,g).hex},children:e.clear&&O("img",{src:g1})}),O("div",{className:C.pickerArrow,children:"\u25BE"})]})})}import{useLocale as b5}from"@blockcode/core";import{classNames as $,Button as V}from"@blockcode/ui";W(".zaEMxq_tool-box-wrapper{flex-flow:wrap;place-content:flex-start space-between;width:7rem;display:flex}.zaEMxq_tool-button{margin:calc(var(--space)/2);border-radius:calc(var(--space)/2);padding:calc(var(--space)/2);user-select:none;background:0 0;border:none;outline:none;transition:all .2s;display:inline-block}.zaEMxq_tool-button.zaEMxq_selected{background:var(--motion-primary)}.zaEMxq_tool-icon{vertical-align:middle;width:2rem;height:2rem}.zaEMxq_tool-button.zaEMxq_selected .zaEMxq_tool-icon{filter:brightness(0)invert()}");var I={toolButton:"zaEMxq_tool-button",selected:"zaEMxq_selected",toolIcon:"zaEMxq_tool-icon",toolBoxWrapper:"zaEMxq_tool-box-wrapper"};var c1="./assets/icon-pen-vmav54fy.svg";var d1="./assets/icon-eraser-6exvhk0q.svg";var y1="./assets/icon-fill-70s8y3f8.svg";var B1="./assets/icon-text-e5hysycg.svg";var S1="./assets/icon-line-r61p9edw.svg";var Y1="./assets/icon-rectangle-yasy0y9k.svg";var T1="./assets/icon-circle-ynejmr8k.svg";var F1="./assets/icon-select-7g007t5g.svg";import{jsx as Y,jsxs as W1,Fragment as _5}from"preact/jsx-runtime";function x1({selectedTool:t,onSelect:e}){const{getText:i}=b5();return W1("div",{className:I.toolBoxWrapper,children:[Y(V,{className:$(I.toolButton,{[I.selected]:t==="pen"}),onClick:()=>e("pen"),children:Y("img",{src:c1,className:I.toolIcon,title:i("pixelPaint.painter.pen","Pen")})}),Y(V,{className:$(I.toolButton,{[I.selected]:t==="eraser"}),onClick:()=>e("eraser"),children:Y("img",{src:d1,className:I.toolIcon,title:i("pixelPaint.painter.eraser","Eraser")})}),Y(V,{className:$(I.toolButton,{[I.selected]:t==="fill"}),onClick:()=>e("fill"),children:Y("img",{src:y1,className:I.toolIcon,title:i("pixelPaint.painter.fill","Fill")})}),W1(_5,{children:[Y(V,{disabled:!0,className:$(I.toolButton,{[I.selected]:t==="text"}),onClick:()=>e("text"),children:Y("img",{src:B1,className:I.toolIcon,title:i("pixelPaint.painter.text","Text")})}),Y(V,{disabled:!0,className:$(I.toolButton,{[I.selected]:t==="line"}),onClick:()=>e("line"),children:Y("img",{src:S1,className:I.toolIcon,title:i("pixelPaint.painter.line","Line")})}),Y(V,{disabled:!0,className:$(I.toolButton,{[I.selected]:t==="rectangle"}),onClick:()=>e("rectangle"),children:Y("img",{src:Y1,className:I.toolIcon,title:i("pixelPaint.painter.rectangle","Rectangle")})}),Y(V,{disabled:!0,className:$(I.toolButton,{[I.selected]:t==="circle"}),onClick:()=>e("circle"),children:Y("img",{src:T1,className:I.toolIcon,title:i("pixelPaint.painter.circle","Circle")})}),Y(V,{disabled:!0,className:$(I.toolButton,{[I.selected]:t==="select"}),onClick:()=>e("select"),children:Y("img",{src:F1,className:I.toolIcon,title:i("pixelPaint.painter.select","Select")})})]})]})}import{useRef as P5,useEffect as U1,useState as E5}from"preact/hooks";import{classNames as Z1}from"@blockcode/ui";W("._1X3Adq_draw-box{background:var(--ui-secondary);width:100%;height:100%;display:flex;position:absolute;top:0;left:0;overflow:auto}._1X3Adq_draw-canvas-wrapper{margin:auto;position:relative}._1X3Adq_draw-canvas{image-rendering:pixelated;background:url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+CjwhLS0gQ3JlYXRlZCB3aXRoIFZlY3Rvcm5hdG9yIChodHRwOi8vdmVjdG9ybmF0b3IuaW8vKSAtLT4KPHN2ZyBoZWlnaHQ9IjMwIiB3aWR0aD0iMzAiIHN0cm9rZS1taXRlcmxpbWl0PSIxMCIgc3R5bGU9ImZpbGwtcnVsZTpub256ZXJvO2NsaXAtcnVsZTpldmVub2RkO3N0cm9rZS1saW5lY2FwOnJvdW5kO3N0cm9rZS1saW5lam9pbjpyb3VuZDsiIHZlcnNpb249IjEuMSIgdmlld0JveD0iMCAwIDQwIDQwIiB4bWw6c3BhY2U9InByZXNlcnZlIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIj4KPGRlZnMvPgo8Zz4KPHBhdGggZD0iTTAgMEw0MCAwTDQwIDQwTDAgNDBMMCAwWiIgZmlsbD0iI2ZmZmZmZiIgZmlsbC1ydWxlPSJub256ZXJvIiBvcGFjaXR5PSIxIiBzdHJva2U9Im5vbmUiLz4KPHBhdGggZD0iTTAgMEwyMCAwTDIwIDIwTDAgMjBMMCAwWiIgZmlsbD0iI2VhZjBmOCIgZmlsbC1ydWxlPSJub256ZXJvIiBvcGFjaXR5PSIxIiBzdHJva2U9Im5vbmUiLz4KPHBhdGggZD0iTTIwIDIwTDQwIDIwTDQwIDQwTDIwIDQwTDIwIDIwWiIgZmlsbD0iI2VhZjBmOCIgZmlsbC1ydWxlPSJub256ZXJvIiBvcGFjaXR5PSIxIiBzdHJva2U9Im5vbmUiLz4KPC9nPgo8L3N2Zz4K);width:320px;height:240px}._1X3Adq_draw-canvas._1X3Adq_center{cursor:crosshair}._1X3Adq_draw-canvas._1X3Adq_picker{cursor:url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+Cjxzdmcgd2lkdGg9IjIwcHgiIGhlaWdodD0iMjBweCIgdmlld0JveD0iMCAwIDIwIDIwIiB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiPgogICAgPCEtLSBHZW5lcmF0b3I6IFNrZXRjaCA0My4yICgzOTA2OSkgLSBodHRwOi8vd3d3LmJvaGVtaWFuY29kaW5nLmNvbS9za2V0Y2ggLS0+CiAgICA8dGl0bGU+ZXllLWRyb3BwZXI8L3RpdGxlPgogICAgPGRlc2M+Q3JlYXRlZCB3aXRoIFNrZXRjaC48L2Rlc2M+CiAgICA8ZGVmcz48L2RlZnM+CiAgICA8ZyBpZD0iUGFnZS0xIiBzdHJva2U9Im5vbmUiIHN0cm9rZS13aWR0aD0iMSIgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIj4KICAgICAgICA8ZyBpZD0iZXllLWRyb3BwZXIiIGZpbGw9IiM1NzVFNzUiPgogICAgICAgICAgICA8cGF0aCBkPSJNOS4xNTMzNDYwNSwxMi40ODI0OTYyIEM5LjAzMzk0MDQ0LDEyLjYxODg3MzcgOC44ODA0MTg5NSwxMi43MDQxMDk2IDguNjA3NDkxODYsMTIuNzcyMjk4MyBDNy45MDgxMTYxOCwxMi45MjU3MjMgNy4yNDI4NTYzOSwxMy41NTY0Njg4IDcuMDM4MTYxMDcsMTQuMjU1NDAzMyBDNi45Njk5MjkzLDE0LjQ3NzAxNjcgNi43NDgxNzYwMywxNC43MTU2NzczIDYuNTA5MzY0ODMsMTQuODM1MDA3NiBMNC43MzUzMzg3MSwxNS42NzAzMTk2IEM0LjY1MDA0OSwxNS43MDQ0MTQgNC41ODE4MTcyMiwxNS43MjE0NjEyIDQuNTQ3NzAxMzQsMTUuNzIxNDYxMiBMNC4yNzQ3NzQyNCwxNS40NjU3NTM0IEM0LjI3NDc3NDI0LDE1LjQ0ODcwNjIgNC4yNzQ3NzQyNCwxNS4zODA1MTc1IDQuMzI1OTQ4MDcsMTUuMjYxMTg3MiBMNS4xNjE3ODczLDEzLjQ3MTIzMjkgQzUuMjY0MTM0OTYsMTMuMjQ5NjE5NSA1LjUwMjk0NjE3LDEzLjAyODAwNjEgNS43NDE3NTczNywxMi45NTk4MTc0IEM2LjQ0MTEzMzA1LDEyLjczODIwNCA3LjA3MjI3Njk2LDEyLjA5MDQxMSA3LjI1OTkxNDMzLDExLjIzODA1MTggQzcuMjk0MDMwMjIsMTEuMTAxNjc0MyA3LjM3OTMxOTk0LDEwLjk2NTI5NjggNy40OTg3MjU1NCwxMC44Mjg5MTkzIEwxMS40MzkxMTA1LDYuOTA4MDY2OTcgTDEzLjA5MzczMSw4LjU2MTY0Mzg0IEw5LjE1MzM0NjA1LDEyLjQ4MjQ5NjIgWiBNMTYuNjA3NjY3Myw1LjI4ODU4NDQ3IEMxNi44NjM1MzY1LDUuMDMyODc2NzEgMTcsNC42NzQ4ODU4NCAxNyw0LjMzMzk0MjE2IEMxNywzLjk5Mjk5ODQ4IDE2Ljg2MzUzNjUsMy42NTIwNTQ3OSAxNi42MDc2NjczLDMuMzk2MzQ3MDMgQzE2LjA3ODg3MTEsMi44Njc4ODQzMiAxNS4yNDMwMzE4LDIuODY3ODg0MzIgMTQuNzE0MjM1NiwzLjM5NjM0NzAzIEwxMy4yMzAxOTQ1LDQuODc5NDUyMDUgTDEzLjA1OTYxNTEsNC43MDg5ODAyMSBMMTIuNTEzNzYwOSw0LjE2MzQ3MDMyIEMxMi4xNzI2MDIsMy44MjI1MjY2NCAxMS42MDk2ODk5LDMuODIyNTI2NjQgMTEuMjY4NTMxLDQuMTYzNDcwMzIgTDEwLjYwMzI3MTIsNC44MTEyNjMzMiBDMTAuMjc5MTcwMyw1LjE1MjIwNyAxMC4yNjIxMTI0LDUuNjQ2NTc1MzQgMTAuNTUyMDk3NCw1Ljk4NzUxOTAzIEw2LjU5NDY1NDU0LDkuOTI1NDE4NTcgQzYuMzA0NjY5NTEsMTAuMjMyMjY3OSA2LjA5OTk3NDE4LDEwLjU5MDI1ODggNS45ODA1Njg1OCwxMS4xMDE2NzQzIEM1LjkyOTM5NDc1LDExLjM1NzM4MiA1LjYzOTQwOTcxLDExLjY0NzE4NDIgNS4zNjY0ODI2MiwxMS43MzI0MjAxIEM0LjgwMzU3MDQ5LDExLjkwMjg5MTkgNC4yNTc3MTYzLDEyLjM4MDIxMzEgNC4wMDE4NDcxNSwxMi45NDI3NzAyIEwzLjE2NjAwNzkyLDE0LjcxNTY3NzMgQzIuODkzMDgwODMsMTUuMzEyMzI4OCAyLjk2MTMxMjYsMTUuOTI2MDI3NCAzLjMzNjU4NzM2LDE2LjMxODExMjYgTDMuNjc3NzQ2MjMsMTYuNjU5MDU2MyBDMy44OTk0OTk0OSwxNi44ODA2Njk3IDQuMjA2NTQyNDcsMTcgNC41NDc3MDEzNCwxNyBDNC43Njk0NTQ2LDE3IDUuMDI1MzIzNzUsMTYuOTMxODExMyA1LjI2NDEzNDk2LDE2LjgyOTUyODIgTDcuMDU1MjE5MDEsMTUuOTk0MjE2MSBDNy42MTgxMzExNCwxNS43MjE0NjEyIDguMDk1NzUzNTYsMTUuMTkyOTk4NSA4LjI2NjMzMjk5LDE0LjYzMDQ0MTQgQzguMzM0NTY0NzcsMTQuMzU3Njg2NSA4LjY0MTYwNzc1LDE0LjA2Nzg4NDMgOS4wNTA5OTgzOSwxMy45ODI2NDg0IEM5LjQwOTIxNTIsMTMuODk3NDEyNSA5Ljc2NzQzMjAxLDEzLjY5Mjg0NjMgMTAuMDU3NDE3LDEzLjM4NTk5NyBMMTQuMDE0ODU5OSw5LjQ0ODA5NzQxIEMxNC4zNTYwMTg4LDkuNzM3ODk5NTQgMTQuODY3NzU3MSw5LjcwMzgwNTE4IDE1LjE3NDgwMDEsOS4zNzk5MDg2OCBMMTUuODQwMDU5OSw4LjczMjExNTY4IEMxNi4xODEyMTg3LDguMzkxMTcxOTkgMTYuMTgxMjE4Nyw3LjgyODYxNDkyIDE1Ljg0MDA1OTksNy40ODc2NzEyMyBMMTUuMjYwMDg5OCw2LjkwODA2Njk3IEwxNS4xMjM2MjYyLDYuNzcxNjg5NSBMMTYuNjA3NjY3Myw1LjI4ODU4NDQ3IFoiIGlkPSJleWUtZHJvcHBlci1pY29uIj48L3BhdGg+CiAgICAgICAgPC9nPgogICAgPC9nPgo8L3N2Zz4=) 4 15,crosshair}._1X3Adq_center-icon{pointer-events:none;filter:opacity(.5);position:absolute;top:0;left:0;transform:translate(-50%,-50%)}._1X3Adq_center-icon._1X3Adq_hidden{display:none}");var t1={picker:"_1X3Adq_picker",hidden:"_1X3Adq_hidden",drawBox:"_1X3Adq_draw-box",center:"_1X3Adq_center",drawCanvasWrapper:"_1X3Adq_draw-canvas-wrapper",centerIcon:"_1X3Adq_center-icon",drawCanvas:"_1X3Adq_draw-canvas"};var p1="./assets/icon-center-bzxv0qgf.svg";import{jsx as M1,jsxs as y5}from"preact/jsx-runtime";function m1({image:t,selectedTool:e,zoom:i,undoList:n,onChange:p,onChangeColor:d}){const s=P5(),[g,m]=E5(),v=(c.DrawWidth-t.width)/2+t.centerX,x=(c.DrawHeight-t.height)/2+t.centerY,A=e.fillColor||new M([0,0,0]),G=e.outlineColor||new M([0,0,0]);let _,z;const B=()=>{z=g.getImageData(0,0,c.DrawWidth,c.DrawHeight)},f=(r=0,l=0)=>{g.clearRect(0,0,c.DrawWidth,c.DrawHeight),g.putImageData(z,r,l)},S=()=>{p({data:z}),z=null},F=()=>{let r=new OffscreenCanvas(c.DrawWidth,c.DrawHeight),l=r.getContext("2d",{willReadFrequently:!0});l.imageSmoothingEnabled=!1,l.putImageData(n.at(-1),0,0),z=l.getImageData(0,0,c.DrawWidth,c.DrawHeight),l=null,r=null},j=(r,l)=>{if(r.invalid)return;const o=r.index;z.data[o+0]=l.r,z.data[o+1]=l.g,z.data[o+2]=l.b,z.data[o+3]=l.a===0?0:255},P=(r,l,o,a)=>{j(new c(r.x-l,r.y+o),a),j(new c(r.x+l,r.y+o),a),j(new c(r.x+l,r.y-o),a),j(new c(r.x-l,r.y-o),a),j(new c(r.x-o,r.y+l),a),j(new c(r.x+o,r.y+l),a),j(new c(r.x+o,r.y-l),a),j(new c(r.x-o,r.y-l),a)},N=(r,l,o)=>{const a=Math.abs(l.x-r.x),w=Math.abs(l.y-r.y),k=r.x<l.x?1:-1,y=r.y<l.y?1:-1,D=new c(r.x,r.y);let J=a-w;while(!0){if(j(D,o),D.x===l.x&&D.y===l.y)break;const s1=2*J;if(s1>-w)J-=w,D.x+=k;if(s1<a)J+=a,D.y+=y}},h=(r,l,o)=>{let a=r.x,w=l.x,k=r.y,y=l.y;if(o.outline){const D=new c(w,k),J=new c(a,y);N(r,D,o.outline),N(l,J,o.outline),N(D,l,o.outline),N(J,r,o.outline),a+=1,w-=1,k+=1,y-=1}if(o.fill)for(let D=k;D<=y;D++)N(new c(a,D),new c(w,D),o.fill)},T=(r,l,o)=>{let a=0,w=l,k=3-2*l;while(a<=w){if(o.fill)for(let y=a;y<=w;y++)P(r,a,y,o.fill);if(o.outline)P(r,a,w,o.outline);if(k<0)k=k+4*a+6;else k=k+4*(a-w),w--;a++}},b=(r)=>{if(r.invalid)return;const l={clear:A.clear,fill:A.rgb,outline:!1};if(l.clear||e.type==="eraser"){if(l.fill.a=0,!_)l.fill={r:255,g:255,b:255},l.outline={r:138,g:187,b:255}}if(e.penSize===1)j(r,!_&&(l.clear||e.type==="eraser")?l.outline:l.fill);else if(e.penSize===3)h(new c(r.x-1,r.y-1),new c(r.x+1,r.y+1),l);else if(e.penSize<5){const o=e.penSize/2;h(new c(r.x-o,r.y-o),new c(r.x+o-1,r.y+o-1),l)}else T(r,Math.floor((e.penSize-1)/2),l)},E=(r)=>{if(r.invalid)return;const l=new M(Array.from(z.data.slice(r.index,r.index+4))),o=[],a=(w)=>{if(w.invalid)return;if(!o.includes(w.index)){const k=new M(Array.from(z.data.slice(w.index,w.index+4)));if(k.equals(l)&&k.notEquals(A))o.push(w.index)}};a(r);while(o.length>0){const w=o.shift();z.data[w+0]=A.rgb.r,z.data[w+1]=A.rgb.g,z.data[w+2]=A.rgb.b,z.data[w+3]=A.clear?0:255,r=c.from(w),a(r.topPoint),a(r.leftPoint),a(r.rightPoint),a(r.bottomPoint)}},R=(r)=>{if(r.preventDefault(),!s.current)return;_=!0;const l=s.current.getBoundingClientRect();let o=r.clientX-l.left,a=r.clientY-l.top;if(o=Math.floor(c.DrawWidth*o/s.current.clientWidth),a=Math.floor(c.DrawHeight*a/s.current.clientHeight),e.type==="pen"||e.type==="eraser"||e.type==="fill"){const k=new c(o,a);if(B(),e.type==="pen"||e.type==="eraser")b(k);else if(e.type==="fill")E(k);f()}else if(e.type.startsWith("picker-"))r.stopPropagation();else if(e.type.startsWith("center")){const k=c.DrawWidth/2-o,y=c.DrawHeight/2-a;f(k,y),B()}const w=()=>{if(_)_=!1,S();document.removeEventListener("mouseup",w)};document.addEventListener("mouseup",w)},H=(r)=>{if(r.preventDefault(),!s.current)return;if(e.type==="center")return;const l=s.current.getBoundingClientRect();let o=r.clientX-l.left,a=r.clientY-l.top;if(o=Math.floor(c.DrawWidth*o/s.current.clientWidth),a=Math.floor(c.DrawHeight*a/s.current.clientHeight),e.type==="pen"||e.type==="eraser"){const w=new c(o,a);if(!_)F();else B();b(w),f()}else if(e.type.startsWith("picker-"));},Z=(r)=>{if(r.preventDefault(),_=!1,e.type==="center"){S();return}const l=s.current.getBoundingClientRect();let o=r.clientX-l.left,a=r.clientY-l.top;if(o=Math.floor(c.DrawWidth*o/s.current.clientWidth),a=Math.floor(c.DrawHeight*a/s.current.clientHeight),e.type.startsWith("picker-")){const[w,k,y,D]=g.getImageData(o,a,1,1).data;if(D===0){if(e.type==="picker-fill")d(new M(A.hsv,!0));if(e.type==="picker-outline")d(new M(G.hsv,!0))}else d(new M({r:w,g:k,b:y}).toHSVColor());return}if(S(),e.type==="eraser")F(),b(new c(o,a)),f()},Q=(r)=>{if(r.preventDefault(),!_)F(),f()};if(U1(()=>{if(s.current){const r=s.current.getContext("2d",{willReadFrequently:!0});r.imageSmoothingEnabled=!1,m(r)}},[s]),U1(()=>{if(s.current){const r=s.current.parentElement.parentElement;let l=(s.current.clientWidth-r.clientWidth)/2,o=(s.current.clientHeight-r.clientHeight)/2;if(i>2){const w=r.clientWidth/2;if(l=(r.scrollLeft+w)/r.dataset.scrollWidth*s.current.clientWidth-w,i>4){const k=r.clientHeight/2;o=(r.scrollTop+k)/r.dataset.scrollHeight*s.current.clientHeight-k}}r.dataset.scrollWidth=s.current.clientWidth,r.dataset.scrollHeight=s.current.clientHeight,r.scroll({top:o>0?o:0,left:l>0?l:0});const a=s.current.nextSibling;a.style.top=`${i*c.DrawHeight/2}px`,a.style.left=`${i*c.DrawWidth/2}px`}},[i]),g&&n.length===0)if(t)f1(t).then((r)=>{const l=c.DrawWidth/2-t.centerX,o=c.DrawHeight/2-t.centerY;g.clearRect(0,0,c.DrawWidth,c.DrawHeight),g.drawImage(r,l,o),B(),S()});else B(),S();if(g&&n.length>0)F(),f();return M1("div",{className:t1.drawBox,children:y5("div",{className:t1.drawCanvasWrapper,children:[M1("canvas",{ref:s,className:Z1(t1.drawCanvas,{[t1.center]:e.type==="center",[t1.picker]:e.type.startsWith("picker-")}),width:c.DrawWidth,height:c.DrawHeight,style:{width:c.DrawWidth*i,height:c.DrawHeight*i},onMouseDown:R,onMouseMove:H,onMouseUp:Z,onMouseLeave:Q}),M1("img",{src:p1,className:Z1(t1.centerIcon,{[t1.hidden]:e.type!=="center"})})]})})}W(".KOzPOa_painter-wrapper{padding:calc(var(--space)*1.5);border-left:1px solid var(--ui-black-transparent);color:var(--text-primary);flex-direction:column;flex:1;display:flex}.KOzPOa_row{min-height:3rem;margin-bottom:.5rem;display:flex}.KOzPOa_row-fill{padding-top:calc(var(--space)*2.5);border-top:1px dashed var(--ui-black-transparent);flex-direction:row;flex:1}.KOzPOa_row-bottom{margin-right:var(--space);margin-left:calc(7em + var(--space));justify-content:space-between}.KOzPOa_row:last-child{min-height:unset;margin-bottom:0}.KOzPOa_tool-group{margin-right:calc(var(--space)*1.5);flex-direction:row;align-items:center;display:inline-flex}.KOzPOa_disabled{opacity:.3;pointer-events:none}.KOzPOa_dashed-border{border-right:1px dashed var(--ui-black-transparent);padding-right:var(--space)}.KOzPOa_name-input{width:8rem}.KOzPOa_large-input{width:4rem}.KOzPOa_tool-icon{margin-right:var(--space);width:2rem;height:2rem}.KOzPOa_label-image{vertical-align:middle;margin-right:calc(var(--space)/2)}.KOzPOa_button{width:calc(2rem + 2px);height:calc(2rem + 2px);padding:.375rem}.KOzPOa_text-button{height:calc(2rem + 2px);padding:.375rem}.KOzPOa_button-icon{width:1.5rem;margin:auto}.KOzPOa_simple-group{display:inline-flex}.KOzPOa_group-button{border-left:none;border-radius:0}.KOzPOa_group-button-first{border-top-right-radius:0;border-bottom-right-radius:0}.KOzPOa_group-button-last{border-left:none;border-top-left-radius:0;border-bottom-left-radius:0}.KOzPOa_group-button-toggled-off{filter:saturate(0)}.KOzPOa_label-button{border:0;font-weight:400}.KOzPOa_label-button.KOzPOa_selected{background:var(--motion-primary);color:var(--ui-white)}.KOzPOa_label-button.KOzPOa_selected .KOzPOa_button-icon{filter:brightness(0)invert()}.KOzPOa_draw-box-wrapper{margin:0 var(--space);border:1px solid var(--ui-black-transparent);border-radius:calc(var(--space)/2);flex:1;position:relative;overflow:hidden}");var u={rowBottom:"KOzPOa_row-bottom",textButton:"KOzPOa_text-button",labelButton:"KOzPOa_label-button",toolIcon:"KOzPOa_tool-icon",groupButtonFirst:"KOzPOa_group-button-first",drawBoxWrapper:"KOzPOa_draw-box-wrapper",nameInput:"KOzPOa_name-input",buttonIcon:"KOzPOa_button-icon",toolGroup:"KOzPOa_tool-group",groupButtonToggledOff:"KOzPOa_group-button-toggled-off",largeInput:"KOzPOa_large-input",dashedBorder:"KOzPOa_dashed-border",painterWrapper:"KOzPOa_painter-wrapper",rowFill:"KOzPOa_row-fill",simpleGroup:"KOzPOa_simple-group",groupButton:"KOzPOa_group-button",groupButtonLast:"KOzPOa_group-button-last",disabled:"KOzPOa_disabled",button:"KOzPOa_button",row:"KOzPOa_row",selected:"KOzPOa_selected",labelImage:"KOzPOa_label-image"};var Q1="./assets/icon-undo-q4nwvpxj.svg";var K1="./assets/icon-redo-mrvqwv38.svg";var G1="./assets/icon-zoom-in-s316e3qy.svg";var R1="./assets/icon-zoom-out-y9xmwx8c.svg";var H1="./assets/icon-zoom-reset-xne8n5sw.svg";import{jsx as L,jsxs as K}from"preact/jsx-runtime";var X1=(t,e=0,i=1/0)=>{return Math.min(Math.max(e,t),i)};function L1({mode:t,imageList:e,imageIndex:i}){const{getText:n,maybeLocaleText:p}=U5(),{modifyAsset:d}=Z5(),[s,g]=q(1),[m,v]=q("draw"),[x,A]=q("pen"),[G,_]=q(10),[z,B]=q(2),[f,S]=q(new M([260,0.6,1])),[F,j]=q(new M([0,1,0])),[P,N]=q([]),[h,T]=q([]),b=e[i],E=b&&b.id,R=!E,H=(a,w,k)=>{if(t==="costume")return w;if(t==="backdrop")return k;return a},Z=(a)=>{if(a.id=E,a.data){const{type:w,data:k,width:y,height:D,centerX:J,centerY:s1}=P1(a.data);a.type=w,a.data=k,a.width=y,a.height=D,a.centerX=J,a.centerY=s1}d(a)},Q=(a)=>{if(a.data){if(P.length>20)P.splice(1,1);if(N(P.concat(a.data)),T([]),P.length===0)return}if(Z(a),m!=="draw")v("draw")},r=(a)=>{if(m==="picker-fill")S(a);if(m==="picker-outline")j(a)},l=()=>{const a=P.pop();N(P),T(h.concat(a)),Z({data:P.at(-1)})},o=()=>{const a=h.pop();N(P.concat(a)),T(h),Z({data:a})};return W5(()=>{return N([]),T([]),v("draw"),()=>{}},[E]),K("div",{className:u.painterWrapper,children:[K("div",{className:u.row,children:[L("div",{className:u.toolGroup,children:L(C1,{text:H(n("pixelPaint.painter.image","Image"),n("pixelPaint.painter.costume","Costume"),n("pixelPaint.painter.backdrop","Backdrop")),children:L(k1,{disabled:R,className:u.nameInput,placeholder:n("pixelPaint.painter.name","name"),onSubmit:(a)=>Q({name:a}),value:b?p(b.name):H(n("pixelPaint.painter.image","Image"),n("pixelPaint.painter.costume","Costume"),n("pixelPaint.painter.backdrop","Backdrop"))})})}),K("div",{className:u.toolGroup,children:[L(n1,{disabled:P.length<=1,className:U(u.button,u.groupButtonFirst,{[u.groupButtonToggledOff]:R}),onClick:l,children:L("img",{src:Q1,className:u.buttonIcon,title:n("pixelPaint.painter.undo","Undo")})}),L(n1,{disabled:h.length===0,className:U(u.button,u.groupButtonLast,{[u.groupButtonToggledOff]:R}),onClick:o,children:L("img",{src:K1,className:u.buttonIcon,title:n("pixelPaint.painter.redo","Redo")})})]}),L("div",{className:u.toolGroup,children:t==="costume"&&K(n1,{vertical:!0,className:U(u.labelButton,{[u.selected]:m==="center"}),onClick:()=>v(m!=="center"?"center":"draw"),children:[L("img",{src:p1,className:u.buttonIcon,title:n("pixelPaint.painter.center","Center")}),L("span",{children:n("pixelPaint.painter.center","Center")})]})})]}),K("div",{className:u.row,children:[L("div",{className:u.toolGroup,children:L(C1,{className:U({[u.disabled]:x==="eraser"}),text:n("pixelPaint.painter.fill","Fill"),children:L(o1,{picking:m.startsWith("picker-"),color:f,onChange:S,onPickColor:(a)=>v(a===!1?"draw":"picker-fill")})})}),K("div",{className:U(u.toolGroup,u.dashedBorder),children:[L(C1,{className:U({[u.disabled]:!0}),text:n("pixelPaint.painter.outline","Outline"),children:L(o1,{outline:!0,picking:m.startsWith("picker-"),color:F,onChange:j,onPickColor:(a)=>v(a===!1?"draw":"picker-outline")})}),L(k1,{small:!0,type:"number",className:U(u.largeInput,{[u.disabled]:!0}),value:z,onSubmit:(a)=>B(X1(a,0,100))})]}),x==="pen"||x==="eraser"?K("div",{className:u.toolGroup,children:[L("img",{src:x==="pen"?c1:d1,className:u.toolIcon}),L(k1,{small:!0,type:"number",className:u.largeInput,value:G,onSubmit:(a)=>_(X1(a,1,100))})]}):null]}),K("div",{className:U(u.row,u.rowFill),children:[L(x1,{selectedTool:x,onSelect:A}),L("div",{className:u.drawBoxWrapper,children:L(m1,{image:b,zoom:s,selectedTool:{fillColor:f,outlineColor:F,penSize:G,outlineSize:z,type:m==="draw"?x:m},undoList:P,onChange:(a)=>Q(a),onChangeColor:r})})]}),K("div",{className:U(u.row,u.rowBottom),children:[L("div",{className:u.simpleGroup,children:t==="backdrop"&&L(n1,{disabled:!0,className:u.textButton,children:L(Q5,{id:"pixelPaint.mode.tileMap",defaultMessage:"Convert to TileMap"})})}),K("div",{className:u.simpleGroup,children:[L(n1,{className:U(u.button,u.groupButtonFirst),onClick:()=>s-1>0&&g(s-1),children:L("img",{src:R1,className:u.buttonIcon})}),L(n1,{className:U(u.button,u.groupButton),onClick:()=>g(1),children:L("img",{src:H1,className:u.buttonIcon})}),L(n1,{className:U(u.button,u.groupButtonLast),onClick:()=>s+1<20&&g(s+1),children:L("img",{src:G1,className:u.buttonIcon})})]})]})]})}W(".gJa9lW_pixel-paint-wrapper{background:var(--ui-white);border-radius:inherit;flex-grow:1;display:flex}");var q1={pixelPaintWrapper:"gJa9lW_pixel-paint-wrapper"};function G5({onSetupLibrary:t}){const{fileList:e,assetList:i,selectedFileId:n}=K5();let p=i.filter((g)=>/^image\//.test(g.type)),d="image";const s=e.find((g)=>g.id===n);if(s&&s.assets&&s.frame!=null)p=p.filter((g)=>s.assets.includes(g.id)),d=n===e[0].id?"backdrop":"costume";return R5("div",{className:q1.pixelPaintWrapper,children:[J1(w1,{mode:d,imageList:p,imageIndex:s.frame,onSetupLibrary:t}),J1(L1,{mode:d,imageIndex:s.frame,imageList:p})]})}import{jsx as J1,jsxs as R5}from"preact/jsx-runtime";var $1={"pixelPaint.contextMenu.duplicate":"duplicate","pixelPaint.contextMenu.export":"export","pixelPaint.contextMenu.delete":"delete","pixelPaint.actionButton.upload":"Upload Image","pixelPaint.actionButton.uploadCostume":"Upload Costume","pixelPaint.actionButton.uploadBackdrop":"Upload Backdrop","pixelPaint.actionButton.uploadError":"Upload \"{file}\" failed.","pixelPaint.actionButton.surprise":"Surprise","pixelPaint.actionButton.paint":"Paint","pixelPaint.actionButton.image":"Choose a Image","pixelPaint.actionButton.costume":"Choose a Costume","pixelPaint.actionButton.backdrop":"Choose a Backdrop","pixelPaint.painter.image":"Image","pixelPaint.painter.costume":"Costume","pixelPaint.painter.backdrop":"Backdrop","pixelPaint.painter.name":"name","pixelPaint.painter.undo":"Undo","pixelPaint.painter.redo":"Redo","pixelPaint.painter.pen":"Pen","pixelPaint.painter.eraser":"Eraser","pixelPaint.painter.fill":"Fill","pixelPaint.painter.text":"Text","pixelPaint.painter.line":"Line","pixelPaint.painter.rectangle":"Rectangle","pixelPaint.painter.circle":"Circle","pixelPaint.painter.select":"Select","pixelPaint.painter.center":"Center","pixelPaint.painter.outline":"Outline","pixelPaint.colorPicker.color":"Color","pixelPaint.colorPicker.saturation":"Saturation","pixelPaint.colorPicker.brightness":"Brightness","pixelPaint.mode.pixel":"Convert to Bitmap","pixelPaint.mode.tileMap":"Convert to TileMap"};var V1={"pixelPaint.contextMenu.duplicate":"\u590D\u5236","pixelPaint.contextMenu.export":"\u5BFC\u51FA","pixelPaint.contextMenu.delete":"\u5220\u9664","pixelPaint.actionButton.upload":"\u4E0A\u4F20\u56FE\u7247","pixelPaint.actionButton.uploadCostume":"\u4E0A\u4F20\u9020\u578B","pixelPaint.actionButton.uploadBackdrop":"\u4E0A\u4F20\u80CC\u666F","pixelPaint.actionButton.uploadError":"\u4E0A\u4F20\u201C{file}\u201D\u5931\u8D25\u3002","pixelPaint.actionButton.surprise":"\u968F\u673A","pixelPaint.actionButton.paint":"\u7ED8\u5236","pixelPaint.actionButton.image":"\u9009\u62E9\u4E00\u4E2A\u56FE\u7247","pixelPaint.actionButton.costume":"\u9009\u62E9\u4E00\u4E2A\u9020\u578B","pixelPaint.actionButton.backdrop":"\u9009\u62E9\u4E00\u4E2A\u80CC\u666F","pixelPaint.painter.image":"\u56FE\u7247","pixelPaint.painter.costume":"\u9020\u578B","pixelPaint.painter.backdrop":"\u80CC\u666F","pixelPaint.painter.name":"\u540D\u5B57","pixelPaint.painter.undo":"\u64A4\u9500","pixelPaint.painter.redo":"\u91CD\u505A","pixelPaint.painter.pen":"\u753B\u7B14","pixelPaint.painter.eraser":"\u6A61\u76AE\u64E6","pixelPaint.painter.fill":"\u586B\u5145","pixelPaint.painter.text":"\u6587\u672C","pixelPaint.painter.line":"\u7EBF\u6BB5","pixelPaint.painter.rectangle":"\u77E9\u5F62","pixelPaint.painter.circle":"\u5706\u5F62","pixelPaint.painter.select":"\u9009\u62E9","pixelPaint.painter.center":"\u4E2D\u5FC3","pixelPaint.painter.outline":"\u8F6E\u5ED3","pixelPaint.colorPicker.color":"\u989C\u8272","pixelPaint.colorPicker.saturation":"\u9971\u548C\u5EA6","pixelPaint.colorPicker.brightness":"\u4EAE\u5EA6","pixelPaint.mode.pixel":"\u8F6C\u6362\u4E3A\u4F4D\u56FE","pixelPaint.mode.tileMap":"\u8F6C\u6362\u4E3A TileMap"};var e4={en:$1,"zh-Hans":V1};export{e4 as locales,G5 as PixelPaint};
