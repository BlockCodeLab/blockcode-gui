import{useEditor as T5} from"@blockcode/core";import{useState as Q0} from"preact/hooks";import{useLocale as e0,useLayout as F5,useEditor as O5} from"@blockcode/core";import{IconSelector as G5,ActionButton as Z5} from"@blockcode/ui";class W{static get DrawWidth(){return 320}static get DrawHeight(){return 240}static from(F){const O=F>>2,G=Math.floor(O/320),$=O-G*320;return new W($,G)}constructor(F,O){this.setXY(F,O)}get x(){return this._x}set x(F){this._x=F,this._index=this.x+this.y*320<<2}get y(){return this._y}set y(F){this._y=F,this._index=this.x+this.y*320<<2}get index(){return this._index}get valid(){return this.x>=0&&this.x<320&&this.y>=0&&this.y<240}get invalid(){return!this.valid}get topPoint(){return new W(this.x,this.y-1)}get leftPoint(){return new W(this.x-1,this.y)}get rightPoint(){return new W(this.x+1,this.y)}get bottomPoint(){return new W(this.x,this.y+1)}get topLeftPoint(){return new W(this.x-1,this.y-1)}get topRightPoint(){return new W(this.x+1,this.y-1)}get bottomLeftPoint(){return new W(this.x-1,this.y+1)}get bottomRightPoint(){return new W(this.x+1,this.y+1)}setXY(F,O){return this._x=F,this._y=O,this._index=this.x+this.y*320<<2,this}equals(F){return this.x==F.x&&this.y==F.y}}function R0(F){return new Promise(async(O)=>{const G=new FileReader;G.readAsDataURL(F),G.addEventListener("load",()=>{const $=new Image;$.src=G.result,$.addEventListener("load",()=>{if($.width>W.DrawWidth||$.height>W.DrawHeight){const V=$.width/W.DrawWidth,Y=$.height/W.DrawHeight;let J=W.DrawWidth,H=W.DrawHeight;if(V>Y)H=$.height/V;else J=$.width/Y;const j=document.createElement("canvas");j.width=J,j.height=H,j.getContext("2d").drawImage($,0,0,J,H),$.src=j.toDataURL(F.type)}else $.dataset.url=$.src,O($)})})})}function j0(F){return new Promise(async(O)=>{const G=new Image;G.src=`data:${F.type};base64,${F.data}`,G.addEventListener("load",()=>{G.dataset.url=G.src,O(G)})})}function z0(F){return new Promise(async(O)=>{const G=new Image;G.src=F,G.addEventListener("load",()=>{const $=document.createElement("canvas");$.width=G.width,$.height=G.height,$.getContext("2d").drawImage(G,0,0,G.width,G.height),G.dataset.url=$.toDataURL("image/png"),O(G)})})}function e(F=32){const O=[];for(let G=0;G<F;G++)O[G]="0123456789abcdefghijklmnopqrstuvwxyz".charAt(Math.random()*"0123456789abcdefghijklmnopqrstuvwxyz".length);return O.join("")}function m(F){const O=globalThis.document,G=O.createElement("style");G.appendChild(O.createTextNode(F)),O.head.append(G)}m(".K-gn7q_selector-wrapper{background:var(--ui-secondary);width:150px;position:relative}.K-gn7q_selector-items-wrapper{width:150px;min-height:100%;padding-bottom:100px}.K-gn7q_selector-item{width:5rem;height:5rem;margin:.5rem auto}.K-gn7q_delete-menu-item:hover{background:var(--error-primary)}.K-gn7q_add-button-wrapper{background:linear-gradient(transparent,var(--ui-secondary));width:100%;height:100px;display:flex;position:absolute;bottom:0;left:0;right:0}.K-gn7q_add-button{margin:.75rem auto}");var F0={addButton:"K-gn7q_add-button",deleteMenuItem:"K-gn7q_delete-menu-item",addButtonWrapper:"K-gn7q_add-button-wrapper",selectorWrapper:"K-gn7q_selector-wrapper",selectorItemsWrapper:"K-gn7q_selector-items-wrapper",selectorItem:"K-gn7q_selector-item"};var A0="./assets/icon-sprite-d18dd1c39449bd1f.svg";var w0="./assets/icon-backdrop-b2bc77fff077fbb7.svg";var _0="./assets/icon-surprise-8aa9e285645a254d.svg";var k0="./assets/icon-search-da6ddbb0d3689046.svg";var v0="./assets/icon-paint-8a2941791fc8f1c0.svg";var B0="./assets/icon-file-upload-8698118c8522bf00.svg";import{jsx as O0} from"preact/jsx-runtime";function W0({mode:F,imageList:O,imageIndex:G,onSetupLibrary:$}){const[V,Y]=Q0(!1),[J,H]=Q0(!1),[j,A]=Q0(!1),{getText:z}=e0(),{createAlert:P,removeAlert:L}=F5(),{addAsset:b,deleteAsset:p,modifyFile:u}=O5(),B=O.map((q)=>q.id),{ImagesLibrary:D,BackdropsLibrary:c,CostumesLibrary:x}=$(),f=()=>{if(F==="costume"){Y(!1),H(!0),A(!1);return}if(F==="backdrop"){Y(!1),H(!1),A(!0);return}Y(!0),H(!1),A(!1)},h=()=>{Y(!1),H(!1),A(!1)},M=async(q)=>{const X=e();P("importing",{id:X});const N=await z0(`./assets/${q.id}.png`);b({...q,id:X,type:"image/png",data:N.dataset.url.slice("data:image/png;base64,".length),width:N.width,height:N.height}),B.push(X),L(X),u({assets:B,frame:B.length-1})},y=()=>{if(F==="costume"){M(x.surprise());return}if(F==="backdrop"){M(c.surprise());return}M(D.surprise())},I=(q,X,N)=>{if(F==="costume")return X;if(F==="backdrop")return N;return q},C=(q)=>`data:${q.type};base64,${q.data}`,d=(q)=>{u({frame:q})},r=()=>{const q=document.createElement("input");q.type="file",q.accept="image/*",q.multiple=!0,q.click(),q.addEventListener("change",async(X)=>{const N=e();P("importing",{id:N});for(let _ of X.target.files){const S=e(),s=_.name.slice(0,_.name.lastIndexOf(".")),i=await R0(_);b({id:S,type:_.type,name:s,data:i.dataset.url.slice(`data:${_.type};base64,`.length),width:i.width,height:i.height,centerX:Math.floor(i.width/2),centerY:Math.floor(i.height/2)}),B.push(S)}L(N),u({assets:B,frame:B.length-1})})},Z=()=>{const q=e();b({id:q,type:"image/png",name:z(`pixelPaint.painter.${F}`,F),data:"iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAAtJREFUGFdjYAACAAAFAAGq1chRAAAAAElFTkSuQmCC",width:1,height:1,centerX:1,centerY:1}),B.push(q),u({assets:B,frame:B.length-1})},K=(q)=>{p(B[q]),B.splice(q,1),u({assets:B,frame:G===0?0:q>G?G:G-1})},Q=(q)=>{const X=O[q],N=e();b({...X,id:N}),B.push(N),u({assets:B,frame:B.length-1})};return O0("div",{className:F0.selectorWrapper,children:[O0(G5,{displayOrder:!0,id:"paint-selector",className:F0.selectorItemsWrapper,items:O.map((q,X)=>({...q,details:`${q.width}\xD7${q.height}`,icon:C(q),order:X,className:F0.selectorItem,contextMenu:[[{label:z("pixelPaint.contextMenu.duplicate","duplicate"),onClick:()=>Q(X)},{label:z("pixelPaint.contextMenu.export","export"),disabled:!0}],[{label:z("pixelPaint.contextMenu.delete","delete"),className:F0.deleteMenuItem,disabled:O.length<=1,onClick:()=>K(X)}]]})),selectedIndex:G,onSelect:d,onDelete:O.length>1&&K}),O0("div",{className:F0.addButtonWrapper,children:O0(Z5,{tooltipPlacement:"right",className:F0.addButton,icon:F==="costume"?A0:w0,tooltip:I(z("pixelPaint.actionButton.image","Choose a Image"),z("pixelPaint.actionButton.costume","Choose a Costume"),z("pixelPaint.actionButton.backdrop","Choose a Backdrop")),onClick:f,moreButtons:[{icon:B0,tooltip:I(z("pixelPaint.actionButton.upload","Upload Image"),z("pixelPaint.actionButton.uploadCostume","Upload Costume"),z("pixelPaint.actionButton.uploadBackdrop","Upload Backdrop")),onClick:r},{icon:_0,tooltip:z("pixelPaint.actionButton.surprise","Surprise"),onClick:y},{icon:v0,tooltip:z("pixelPaint.actionButton.paint","Paint"),onClick:Z},{icon:k0,tooltip:I(z("pixelPaint.actionButton.image","Choose a Image"),z("pixelPaint.actionButton.costume","Choose a Costume"),z("pixelPaint.actionButton.backdrop","Choose a Backdrop")),onClick:f}]})}),V&&D&&O0(D,{onClose:h,onSelect:M}),J&&x&&O0(x,{onClose:h,onSelect:M}),j&&c&&O0(c,{onClose:h,onSelect:M})]})}import{useEffect as L5,useState as l} from"preact/hooks";import{useLocale as D5,useEditor as f5} from"@blockcode/core";import{classNames as g,Label as H0,BufferedInput as I5,Input as g0,Button as Z0} from"@blockcode/ui";class E{static decimalToHex(F){if(F<0)F+=16777216;let O=Number(F).toString(16);return O=`#${"000000".substr(0,6-O.length)}${O}`,O}static decimalToRgb(F){const O=F>>24&255,G=F>>16&255,$=F>>8&255,V=F&255;return{r:G,g:$,b:V,a:O>0?O:255}}static hexToRgb(F){const O=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;F=F.replace(O,($,V,Y,J)=>V+V+Y+Y+J+J);const G=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(F);return G?{r:parseInt(G[1],16),g:parseInt(G[2],16),b:parseInt(G[3],16)}:null}static rgbToHex(F){return E.decimalToHex(E.rgbToDecimal(F))}static rgbToDecimal(F){return(F.r<<16)+(F.g<<8)+F.b}static hexToDecimal(F){return E.rgbToDecimal(E.hexToRgb(F))}static hsvToRgb(F){let O=F.h%360;if(O<0)O+=360;const G=Math.max(0,Math.min(F.s,1)),$=Math.max(0,Math.min(F.v,1)),V=Math.floor(O/60),Y=O/60-V,J=$*(1-G),H=$*(1-G*Y),j=$*(1-G*(1-Y));let A,z,P;switch(V){default:case 0:A=$,z=j,P=J;break;case 1:A=H,z=$,P=J;break;case 2:A=J,z=$,P=j;break;case 3:A=J,z=H,P=$;break;case 4:A=j,z=J,P=$;break;case 5:A=$,z=J,P=H;break}return{r:Math.floor(A*255),g:Math.floor(z*255),b:Math.floor(P*255)}}static rgbToHsv(F){const O=F.r/255,G=F.g/255,$=F.b/255,V=Math.min(Math.min(O,G),$),Y=Math.max(Math.max(O,G),$);let J=0,H=0;if(V!==Y){const j=O===V?G-$:G===V?$-O:O-G;J=((O===V?3:G===V?5:1)-j/(Y-V))*60%360,H=(Y-V)/Y}return{h:J,s:H,v:Y}}static mixRgb(F,O,G){if(G<=0)return F;if(G>=1)return O;const $=1-G;return{r:$*F.r+G*O.r,g:$*F.g+G*O.g,b:$*F.b+G*O.b}}constructor(F,O=!1){if(this._clear=O,this._color=F,typeof F==="number")this._type="decimal";else if(typeof F==="string"&&F[0]==="#")this._type="hex";else if(Array.isArray(F)){const[G,$,V]=F;if($<=1&&V<=1)this._type="hsv",this._color={h:G,s:$,v:V};else this._type="rgb",this._color={r:G,g:$,b:V};this._clear=O||F[3]===0}else if(typeof F.r==="number")this._type="rgb";else if(typeof F.h==="number")this._type="hsv"}get clear(){return this._clear}get rgb(){if(this._type==="rgb")return this._color;if(this._type==="decimal")return E.decimalToRgb(this._color);if(this._type==="hsv")return E.hsvToRgb(this._color);if(this._type==="hex")return E.hexToRgb(this._color)}get hsv(){if(this._type==="hsv")return this._color;if(this._type==="decimal")return E.rgbToHsv(E.decimalToRgb(this._color));if(this._type==="rgb")return E.rgbToHsv(this._color);if(this._type==="hex")return E.rgbToHsv(E.hexToRgb(this._color))}get hex(){if(this._type==="hex")return this._color;if(this._type==="decimal")return E.decimalToHex(this._color);if(this._type==="rgb")return E.rgbToHex(this._color);if(this._type==="hsv")return E.rgbToHex(E.hsvToRgb(this._color))}get decimal(){if(this._type==="decimal")this._color;if(this._type==="rgb")return E.rgbToDecimal(this._color);if(this._type==="hsv")return E.rgbToDecimal(E.hsvToRgb(this._color));if(this._type==="hex")return E.hexToDecimal(this._color)}toRGBColor(){if(this._type==="rgb")return this;return new E(this.rgb,this.clear)}toHSVColor(){if(this._type==="hsv")return this;return new E(this.hsv,this.clear)}toHEXColor(){if(this._type==="hex")return this;return new E(this.hex,this.clear)}toDecimalColor(){if(this._type==="decimal")return this;return new E(this.decimal,this.clear)}equals(F){return this.rgb.r===F.rgb.r&&this.rgb.g===F.rgb.g&&this.rgb.b===F.rgb.b&&this.clear===F.clear}notEquals(F){return!this.equals(F)}}function S0(F){const O=$5(F),G=q5(F,O),$=J5(F,O,G),V=K5(F,O,G,$),Y={top:O||0,left:$||0,right:V||0,bottom:G||0};return Y.width=Y.right-Y.left+1,Y.height=Y.bottom-Y.top+1,Y}var $5=(F)=>{let O;for(let G=0;G<F.height;G++){O=G*F.width;for(let $=0;$<F.width;$++){if(F.data[(O<<2)+3]!==0)return G;O++}}},q5=(F,O)=>{let G;for(let $=F.height-1;$>=O;$--){G=$*F.width;for(let V=0;V<F.width;V++){if(F.data[(G<<2)+3]!==0)return $;G++}}},J5=(F,O,G)=>{let $;for(let V=0;V<F.width;V++)for(let Y=O;Y<=G;Y++)if($=Y*F.width+V,F.data[($<<2)+3]!==0)return V},K5=(F,O,G,$)=>{let V;for(let Y=F.width-1;Y>=$;Y--)for(let J=O;J<=G;J++)if(V=J*F.width+Y,F.data[(V<<2)+3]!==0)return Y};function P0(F){const{top:O,left:G,width:$,height:V}=S0(F),Y=Math.floor(F.width/2-G),J=Math.floor(F.height/2-O),H=document.createElement("canvas");H.width=$,H.height=V,H.getContext("2d").putImageData(F,-G,-O,G,O,$,V);const[A,z]=H.toDataURL().slice(5).split(";base64,");return{type:A,data:z,width:$,height:V,centerX:Y,centerY:J}}import{classNames as G0,Text as V0,Tooltip as W5} from"@blockcode/ui";m("._Y2YyW_color-picker-wrapper{margin-right:var(--space);cursor:pointer;width:3rem;height:2rem;display:flex}._Y2YyW_color-swatch{border:1px solid var(--ui-black-transparent);border-top-left-radius:var(--form-radius);border-bottom-left-radius:var(--form-radius);flex-shrink:0;flex-basis:2rem;height:100%;display:flex;position:relative}._Y2YyW_color-swatch-outline:after{content:\"\";background:var(--ui-white);border:1px solid var(--ui-black-transparent);z-index:1;width:.75rem;height:.75rem;position:absolute;top:.5rem;left:.5rem}._Y2YyW_picker-arrow{user-select:none;border:1px solid var(--ui-black-transparent);border-top-right-radius:var(--form-radius);border-bottom-right-radius:var(--form-radius);border-left:0;flex-shrink:0;flex-basis:1rem;justify-content:center;align-items:center;height:100%;font-size:.75rem;display:flex}._Y2YyW_color-tooltip{background:var(--ui-white);color:var(--text-primary);padding:calc(var(--space)/2)}._Y2YyW_tooltip-item{margin:8px}._Y2YyW_tooltip-item-label{font-weight:700}._Y2YyW_tooltip-item-readout{margin-left:10px}._Y2YyW_tooltip-item-slider{border-radius:11px;outline:none;width:150px;height:22px;margin-bottom:20px;position:relative}._Y2YyW_tooltip-item-slider-handler{background-color:var(--ui-white);box-shadow:0 0 0 4px var(--ui-black-transparent);touch-action:none;border-radius:100%;width:26px;height:26px;margin-top:-2px;position:absolute;left:100px}._Y2YyW_tooltip-item-toolbar{justify-content:space-between;display:flex}._Y2YyW_tooltip-item-toolbar-button{border:1px solid var(--ui-black-transparent);border-radius:var(--form-radius);cursor:pointer;width:calc(1.5rem + 2px);height:calc(1.5rem + 2px)}._Y2YyW_tooltip-item-toolbar-button._Y2YyW_selected{border:1px solid #855cd6;box-shadow:0 0 0 3px #855cd659}._Y2YyW_button-icon{width:1.5rem;height:1.5rem}");var w={colorSwatchOutline:"_Y2YyW_color-swatch-outline",pickerArrow:"_Y2YyW_picker-arrow",tooltipItemToolbar:"_Y2YyW_tooltip-item-toolbar",colorTooltip:"_Y2YyW_color-tooltip",selected:"_Y2YyW_selected",colorSwatch:"_Y2YyW_color-swatch",tooltipItemSlider:"_Y2YyW_tooltip-item-slider",tooltipItemToolbarButton:"_Y2YyW_tooltip-item-toolbar-button",buttonIcon:"_Y2YyW_button-icon",tooltipItemLabel:"_Y2YyW_tooltip-item-label",tooltipItem:"_Y2YyW_tooltip-item",tooltipItemReadout:"_Y2YyW_tooltip-item-readout",tooltipItemSliderHandler:"_Y2YyW_tooltip-item-slider-handler",colorPickerWrapper:"_Y2YyW_color-picker-wrapper"};var h0="./assets/icon-picker-84c34a6f34788fe2.svg";var Y0="./assets/icon-clear-ad3d0ac9d8fa6cb0.svg";import{jsx as k,Fragment as V5} from"preact/jsx-runtime";var Y5=[0,0,324,288,252,216,180,144,108,72,36,0,0],n=124;function $0({picking:F,color:O,outline:G,onChange:$,onPickColor:V}){const Y=O.hsv.h,J=O.hsv.s,H=O.hsv.v,j=(M,y,I,C)=>new E({h:M,s:y,v:I},C),A=(M)=>$(j(Math.round(M*360),J,H)),z=(M)=>$(j(Y,M,H)),P=(M)=>$(j(Y,J,M)),L=()=>$(j(Y,J,H,!0)),b=(M,y)=>{M.stopPropagation();const I=M.target,C=I.offsetLeft,d=M.clientX,r=(K)=>{K.preventDefault();let Q=K.clientX-d+C;if(Q>=n)Q=n;if(Q<=0)Q=0;I.style.left=`${Q}px`,y(Q/n)},Z=()=>{document.removeEventListener("mousemove",r),document.removeEventListener("mouseup",Z)};document.addEventListener("mousemove",r),document.addEventListener("mouseup",Z)},p=(M)=>b(M,A),u=(M)=>b(M,z),B=(M)=>b(M,P),D=(M,y)=>{const I=M.target.children[0];let C=M.offsetX-13;if(C>=n)C=n;if(C<=0)C=0;I.style.left=`${C}px`,y(C/n)},c=(M)=>D(M,A),x=(M)=>D(M,z),f=(M)=>D(M,P),h=Y5.map((M)=>j(M,J,H).hex);return k(W5,{clickable:!0,placement:"bottom",className:w.colorTooltip,onHide:()=>V(!1),content:k(V5,{children:[k("div",{className:w.tooltipItem,children:[k("span",{className:w.tooltipItemLabel,children:k(V0,{id:"pixelPaint.colorPicker.color",defaultMessage:"Color"})}),k("span",{className:w.tooltipItemReadout,children:Math.round(Y/360*100)})]}),k("div",{className:G0(w.tooltipItem,w.tooltipItemSlider),style:{background:`linear-gradient(to left, ${h[0]} 0px, ${h[1]} 13px, ${h[2]}, ${h[3]}, ${h[4]}, ${h[5]}, ${h[6]}, ${h[7]}, ${h[8]}, ${h[9]}, ${h[10]}, ${h[11]} 137px, ${h[12]} 100%)`},onClick:c,children:k("div",{className:w.tooltipItemSliderHandler,style:{left:`${Math.round(Y/360*n)}px`},onMouseDown:p,onClick:(M)=>M.stopPropagation()})}),k("div",{className:w.tooltipItem,children:[k("span",{className:w.tooltipItemLabel,children:k(V0,{id:"pixelPaint.colorPicker.saturation",defaultMessage:"Saturation"})}),k("span",{className:w.tooltipItemReadout,children:Math.round(J*100)})]}),k("div",{className:G0(w.tooltipItem,w.tooltipItemSlider),style:{background:`linear-gradient(to right, ${j(Y,0,H).hex} 0px, ${j(Y,1,H).hex} 100%)`},onClick:x,children:k("div",{className:w.tooltipItemSliderHandler,style:{left:`${Math.round(J*n)}px`},onMouseDown:u,onClick:(M)=>M.stopPropagation()})}),k("div",{className:w.tooltipItem,children:[k("span",{className:w.tooltipItemLabel,children:k(V0,{id:"pixelPaint.colorPicker.brightness",defaultMessage:"Brightness"})}),k("span",{className:w.tooltipItemReadout,children:Math.round(H*100)})]}),k("div",{className:G0(w.tooltipItem,w.tooltipItemSlider),style:{background:`linear-gradient(to right, ${j(Y,J,0).hex} 0px, ${j(Y,J,1).hex} 100%)`},onClick:f,children:k("div",{className:w.tooltipItemSliderHandler,style:{left:`${Math.round(H*n)}px`},onMouseDown:B,onClick:(M)=>M.stopPropagation()})}),k("div",{className:G0(w.tooltipItem,w.tooltipItemToolbar),children:[k("div",{className:G0(w.tooltipItemToolbarButton,{[w.selected]:O.clear}),onClick:L,children:k("img",{src:Y0,className:w.buttonIcon})}),k("div",{className:G0(w.tooltipItemToolbarButton,{[w.selected]:F}),onClick:V,children:k("img",{src:h0,className:w.buttonIcon})})]})]}),children:k("div",{className:w.colorPickerWrapper,children:[k("div",{className:G0(w.colorSwatch,{[w.colorSwatchOutline]:G}),style:{background:O.clear?"var(--ui-white)":j(Y,J,H).hex},children:O.clear&&k("img",{src:Y0})}),k("div",{className:w.pickerArrow,children:"\u25BE"})]})})}import{useLocale as A5} from"@blockcode/core";import{classNames as a,Button as t} from"@blockcode/ui";m(".zaEMxq_tool-box-wrapper{flex-flow:wrap;place-content:flex-start space-between;width:7rem;display:flex}.zaEMxq_tool-button{margin:calc(var(--space)/2);border-radius:calc(var(--space)/2);padding:calc(var(--space)/2);user-select:none;background:0 0;border:none;outline:none;transition:all .2s;display:inline-block}.zaEMxq_tool-button.zaEMxq_selected{background:var(--motion-primary)}.zaEMxq_tool-icon{vertical-align:middle;width:2rem;height:2rem}.zaEMxq_tool-button.zaEMxq_selected .zaEMxq_tool-icon{filter:brightness(0)invert()}");var v={toolButton:"zaEMxq_tool-button",toolBoxWrapper:"zaEMxq_tool-box-wrapper",selected:"zaEMxq_selected",toolIcon:"zaEMxq_tool-icon"};var q0="./assets/icon-pen-feefe485db8ab4fb.svg";var J0="./assets/icon-eraser-d74093113b7d2e66.svg";var L0="./assets/icon-fill-88af433e88f940a7.svg";var D0="./assets/icon-text-506c9e59be31058e.svg";var f0="./assets/icon-line-5ccd8ec9d6c1c618.svg";var I0="./assets/icon-rectangle-b3097e20fe790a9e.svg";var C0="./assets/icon-circle-5328f8d4320e955e.svg";var T0="./assets/icon-select-70c5ba0720e0d0e7.svg";import{jsx as T} from"preact/jsx-runtime";function X0({selectedTool:F,onSelect:O}){const{getText:G}=A5();return T("div",{className:v.toolBoxWrapper,children:[T(t,{className:a(v.toolButton,{[v.selected]:F==="pen"}),onClick:()=>O("pen"),children:T("img",{src:q0,className:v.toolIcon,title:G("pixelPaint.painter.pen","Pen")})}),T(t,{className:a(v.toolButton,{[v.selected]:F==="eraser"}),onClick:()=>O("eraser"),children:T("img",{src:J0,className:v.toolIcon,title:G("pixelPaint.painter.eraser","Eraser")})}),T(t,{className:a(v.toolButton,{[v.selected]:F==="fill"}),onClick:()=>O("fill"),children:T("img",{src:L0,className:v.toolIcon,title:G("pixelPaint.painter.fill","Fill")})}),T(t,{disabled:!0,className:a(v.toolButton,{[v.selected]:F==="text"}),onClick:()=>O("text"),children:T("img",{src:D0,className:v.toolIcon,title:G("pixelPaint.painter.text","Text")})}),T(t,{disabled:!0,className:a(v.toolButton,{[v.selected]:F==="line"}),onClick:()=>O("line"),children:T("img",{src:f0,className:v.toolIcon,title:G("pixelPaint.painter.line","Line")})}),T(t,{disabled:!0,className:a(v.toolButton,{[v.selected]:F==="rectangle"}),onClick:()=>O("rectangle"),children:T("img",{src:I0,className:v.toolIcon,title:G("pixelPaint.painter.rectangle","Rectangle")})}),T(t,{disabled:!0,className:a(v.toolButton,{[v.selected]:F==="circle"}),onClick:()=>O("circle"),children:T("img",{src:C0,className:v.toolIcon,title:G("pixelPaint.painter.circle","Circle")})}),T(t,{disabled:!0,className:a(v.toolButton,{[v.selected]:F==="select"}),onClick:()=>O("select"),children:T("img",{src:T0,className:v.toolIcon,title:G("pixelPaint.painter.select","Select")})})]})}import{useRef as _5,useEffect as b0,useState as k5} from"preact/hooks";import{classNames as u0} from"@blockcode/ui";m("._1X3Adq_draw-box{background:var(--ui-secondary);width:100%;height:100%;display:flex;position:absolute;top:0;left:0;overflow:auto}._1X3Adq_draw-canvas-wrapper{margin:auto;position:relative}._1X3Adq_draw-canvas{image-rendering:pixelated;background:url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+CjwhLS0gQ3JlYXRlZCB3aXRoIFZlY3Rvcm5hdG9yIChodHRwOi8vdmVjdG9ybmF0b3IuaW8vKSAtLT4KPHN2ZyBoZWlnaHQ9IjMwIiB3aWR0aD0iMzAiIHN0cm9rZS1taXRlcmxpbWl0PSIxMCIgc3R5bGU9ImZpbGwtcnVsZTpub256ZXJvO2NsaXAtcnVsZTpldmVub2RkO3N0cm9rZS1saW5lY2FwOnJvdW5kO3N0cm9rZS1saW5lam9pbjpyb3VuZDsiIHZlcnNpb249IjEuMSIgdmlld0JveD0iMCAwIDQwIDQwIiB4bWw6c3BhY2U9InByZXNlcnZlIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIj4KPGRlZnMvPgo8Zz4KPHBhdGggZD0iTTAgMEw0MCAwTDQwIDQwTDAgNDBMMCAwWiIgZmlsbD0iI2ZmZmZmZiIgZmlsbC1ydWxlPSJub256ZXJvIiBvcGFjaXR5PSIxIiBzdHJva2U9Im5vbmUiLz4KPHBhdGggZD0iTTAgMEwyMCAwTDIwIDIwTDAgMjBMMCAwWiIgZmlsbD0iI2VhZjBmOCIgZmlsbC1ydWxlPSJub256ZXJvIiBvcGFjaXR5PSIxIiBzdHJva2U9Im5vbmUiLz4KPHBhdGggZD0iTTIwIDIwTDQwIDIwTDQwIDQwTDIwIDQwTDIwIDIwWiIgZmlsbD0iI2VhZjBmOCIgZmlsbC1ydWxlPSJub256ZXJvIiBvcGFjaXR5PSIxIiBzdHJva2U9Im5vbmUiLz4KPC9nPgo8L3N2Zz4K);width:320px;height:240px}._1X3Adq_draw-canvas._1X3Adq_center{cursor:crosshair}._1X3Adq_draw-canvas._1X3Adq_picker{cursor:url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+Cjxzdmcgd2lkdGg9IjIwcHgiIGhlaWdodD0iMjBweCIgdmlld0JveD0iMCAwIDIwIDIwIiB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiPgogICAgPCEtLSBHZW5lcmF0b3I6IFNrZXRjaCA0My4yICgzOTA2OSkgLSBodHRwOi8vd3d3LmJvaGVtaWFuY29kaW5nLmNvbS9za2V0Y2ggLS0+CiAgICA8dGl0bGU+ZXllLWRyb3BwZXI8L3RpdGxlPgogICAgPGRlc2M+Q3JlYXRlZCB3aXRoIFNrZXRjaC48L2Rlc2M+CiAgICA8ZGVmcz48L2RlZnM+CiAgICA8ZyBpZD0iUGFnZS0xIiBzdHJva2U9Im5vbmUiIHN0cm9rZS13aWR0aD0iMSIgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIj4KICAgICAgICA8ZyBpZD0iZXllLWRyb3BwZXIiIGZpbGw9IiM1NzVFNzUiPgogICAgICAgICAgICA8cGF0aCBkPSJNOS4xNTMzNDYwNSwxMi40ODI0OTYyIEM5LjAzMzk0MDQ0LDEyLjYxODg3MzcgOC44ODA0MTg5NSwxMi43MDQxMDk2IDguNjA3NDkxODYsMTIuNzcyMjk4MyBDNy45MDgxMTYxOCwxMi45MjU3MjMgNy4yNDI4NTYzOSwxMy41NTY0Njg4IDcuMDM4MTYxMDcsMTQuMjU1NDAzMyBDNi45Njk5MjkzLDE0LjQ3NzAxNjcgNi43NDgxNzYwMywxNC43MTU2NzczIDYuNTA5MzY0ODMsMTQuODM1MDA3NiBMNC43MzUzMzg3MSwxNS42NzAzMTk2IEM0LjY1MDA0OSwxNS43MDQ0MTQgNC41ODE4MTcyMiwxNS43MjE0NjEyIDQuNTQ3NzAxMzQsMTUuNzIxNDYxMiBMNC4yNzQ3NzQyNCwxNS40NjU3NTM0IEM0LjI3NDc3NDI0LDE1LjQ0ODcwNjIgNC4yNzQ3NzQyNCwxNS4zODA1MTc1IDQuMzI1OTQ4MDcsMTUuMjYxMTg3MiBMNS4xNjE3ODczLDEzLjQ3MTIzMjkgQzUuMjY0MTM0OTYsMTMuMjQ5NjE5NSA1LjUwMjk0NjE3LDEzLjAyODAwNjEgNS43NDE3NTczNywxMi45NTk4MTc0IEM2LjQ0MTEzMzA1LDEyLjczODIwNCA3LjA3MjI3Njk2LDEyLjA5MDQxMSA3LjI1OTkxNDMzLDExLjIzODA1MTggQzcuMjk0MDMwMjIsMTEuMTAxNjc0MyA3LjM3OTMxOTk0LDEwLjk2NTI5NjggNy40OTg3MjU1NCwxMC44Mjg5MTkzIEwxMS40MzkxMTA1LDYuOTA4MDY2OTcgTDEzLjA5MzczMSw4LjU2MTY0Mzg0IEw5LjE1MzM0NjA1LDEyLjQ4MjQ5NjIgWiBNMTYuNjA3NjY3Myw1LjI4ODU4NDQ3IEMxNi44NjM1MzY1LDUuMDMyODc2NzEgMTcsNC42NzQ4ODU4NCAxNyw0LjMzMzk0MjE2IEMxNywzLjk5Mjk5ODQ4IDE2Ljg2MzUzNjUsMy42NTIwNTQ3OSAxNi42MDc2NjczLDMuMzk2MzQ3MDMgQzE2LjA3ODg3MTEsMi44Njc4ODQzMiAxNS4yNDMwMzE4LDIuODY3ODg0MzIgMTQuNzE0MjM1NiwzLjM5NjM0NzAzIEwxMy4yMzAxOTQ1LDQuODc5NDUyMDUgTDEzLjA1OTYxNTEsNC43MDg5ODAyMSBMMTIuNTEzNzYwOSw0LjE2MzQ3MDMyIEMxMi4xNzI2MDIsMy44MjI1MjY2NCAxMS42MDk2ODk5LDMuODIyNTI2NjQgMTEuMjY4NTMxLDQuMTYzNDcwMzIgTDEwLjYwMzI3MTIsNC44MTEyNjMzMiBDMTAuMjc5MTcwMyw1LjE1MjIwNyAxMC4yNjIxMTI0LDUuNjQ2NTc1MzQgMTAuNTUyMDk3NCw1Ljk4NzUxOTAzIEw2LjU5NDY1NDU0LDkuOTI1NDE4NTcgQzYuMzA0NjY5NTEsMTAuMjMyMjY3OSA2LjA5OTk3NDE4LDEwLjU5MDI1ODggNS45ODA1Njg1OCwxMS4xMDE2NzQzIEM1LjkyOTM5NDc1LDExLjM1NzM4MiA1LjYzOTQwOTcxLDExLjY0NzE4NDIgNS4zNjY0ODI2MiwxMS43MzI0MjAxIEM0LjgwMzU3MDQ5LDExLjkwMjg5MTkgNC4yNTc3MTYzLDEyLjM4MDIxMzEgNC4wMDE4NDcxNSwxMi45NDI3NzAyIEwzLjE2NjAwNzkyLDE0LjcxNTY3NzMgQzIuODkzMDgwODMsMTUuMzEyMzI4OCAyLjk2MTMxMjYsMTUuOTI2MDI3NCAzLjMzNjU4NzM2LDE2LjMxODExMjYgTDMuNjc3NzQ2MjMsMTYuNjU5MDU2MyBDMy44OTk0OTk0OSwxNi44ODA2Njk3IDQuMjA2NTQyNDcsMTcgNC41NDc3MDEzNCwxNyBDNC43Njk0NTQ2LDE3IDUuMDI1MzIzNzUsMTYuOTMxODExMyA1LjI2NDEzNDk2LDE2LjgyOTUyODIgTDcuMDU1MjE5MDEsMTUuOTk0MjE2MSBDNy42MTgxMzExNCwxNS43MjE0NjEyIDguMDk1NzUzNTYsMTUuMTkyOTk4NSA4LjI2NjMzMjk5LDE0LjYzMDQ0MTQgQzguMzM0NTY0NzcsMTQuMzU3Njg2NSA4LjY0MTYwNzc1LDE0LjA2Nzg4NDMgOS4wNTA5OTgzOSwxMy45ODI2NDg0IEM5LjQwOTIxNTIsMTMuODk3NDEyNSA5Ljc2NzQzMjAxLDEzLjY5Mjg0NjMgMTAuMDU3NDE3LDEzLjM4NTk5NyBMMTQuMDE0ODU5OSw5LjQ0ODA5NzQxIEMxNC4zNTYwMTg4LDkuNzM3ODk5NTQgMTQuODY3NzU3MSw5LjcwMzgwNTE4IDE1LjE3NDgwMDEsOS4zNzk5MDg2OCBMMTUuODQwMDU5OSw4LjczMjExNTY4IEMxNi4xODEyMTg3LDguMzkxMTcxOTkgMTYuMTgxMjE4Nyw3LjgyODYxNDkyIDE1Ljg0MDA1OTksNy40ODc2NzEyMyBMMTUuMjYwMDg5OCw2LjkwODA2Njk3IEwxNS4xMjM2MjYyLDYuNzcxNjg5NSBMMTYuNjA3NjY3Myw1LjI4ODU4NDQ3IFoiIGlkPSJleWUtZHJvcHBlci1pY29uIj48L3BhdGg+CiAgICAgICAgPC9nPgogICAgPC9nPgo8L3N2Zz4=) 4 15,crosshair}._1X3Adq_center-icon{pointer-events:none;filter:opacity(.5);position:absolute;top:0;left:0;transform:translate(-50%,-50%)}._1X3Adq_center-icon._1X3Adq_hidden{display:none}");var o={hidden:"_1X3Adq_hidden",drawBox:"_1X3Adq_draw-box",drawCanvas:"_1X3Adq_draw-canvas",drawCanvasWrapper:"_1X3Adq_draw-canvas-wrapper",center:"_1X3Adq_center",picker:"_1X3Adq_picker",centerIcon:"_1X3Adq_center-icon"};var K0="./assets/icon-center-efd037807b3d5feb.svg";import{jsx as N0} from"preact/jsx-runtime";function M0({image:F,selectedTool:O,zoom:G,undoList:$,onChange:V,onChangeColor:Y}){const J=_5(),[H,j]=k5(),A=O.fillColor||new E([0,0,0]),z=O.outlineColor||new E([0,0,0]);let P,L;const b=()=>{L=H.getImageData(0,0,W.DrawWidth,W.DrawHeight)},p=(Z=0,K=0)=>{H.clearRect(0,0,W.DrawWidth,W.DrawHeight),H.putImageData(L,Z,K)},u=()=>{V(L),L=null},B=()=>{let Z=new OffscreenCanvas(W.DrawWidth,W.DrawHeight),K=Z.getContext("2d",{willReadFrequently:!0});K.imageSmoothingEnabled=!1,K.putImageData($.at(-1),0,0),L=K.getImageData(0,0,W.DrawWidth,W.DrawHeight),K=null,Z=null},D=(Z,K)=>{if(Z.invalid)return;const Q=Z.index;L.data[Q+0]=K.r,L.data[Q+1]=K.g,L.data[Q+2]=K.b,L.data[Q+3]=K.a===0?0:255},c=(Z,K,Q,q)=>{D(new W(Z.x-K,Z.y+Q),q),D(new W(Z.x+K,Z.y+Q),q),D(new W(Z.x+K,Z.y-Q),q),D(new W(Z.x-K,Z.y-Q),q),D(new W(Z.x-Q,Z.y+K),q),D(new W(Z.x+Q,Z.y+K),q),D(new W(Z.x+Q,Z.y-K),q),D(new W(Z.x-Q,Z.y-K),q)},x=(Z,K,Q)=>{const q=Math.abs(K.x-Z.x),X=Math.abs(K.y-Z.y),N=Z.x<K.x?1:-1,_=Z.y<K.y?1:-1,S=new W(Z.x,Z.y);let s=q-X;while(!0){if(D(S,Q),S.x===K.x&&S.y===K.y)break;const i=2*s;if(i>-X)s-=X,S.x+=N;if(i<q)s+=q,S.y+=_}},f=(Z,K,Q)=>{let q=Z.x,X=K.x,N=Z.y,_=K.y;if(Q.outline){const S=new W(X,N),s=new W(q,_);x(Z,S,Q.outline),x(K,s,Q.outline),x(S,K,Q.outline),x(s,Z,Q.outline),q+=1,X-=1,N+=1,_-=1}if(Q.fill)for(let S=N;S<=_;S++)x(new W(q,S),new W(X,S),Q.fill)},h=(Z,K,Q)=>{let q=0,X=K,N=3-2*K;while(q<=X){if(Q.fill)for(let _=q;_<=X;_++)c(Z,q,_,Q.fill);if(Q.outline)c(Z,q,X,Q.outline);if(N<0)N=N+4*q+6;else N=N+4*(q-X),X--;q++}},M=(Z)=>{if(Z.invalid)return;const K={clear:A.clear,fill:A.rgb,outline:!1};if(K.clear||O.type==="eraser"){if(K.fill.a=0,!P)K.fill={r:255,g:255,b:255},K.outline={r:138,g:187,b:255}}if(O.penSize===1)D(Z,!P&&(K.clear||O.type==="eraser")?K.outline:K.fill);else if(O.penSize===3)f(new W(Z.x-1,Z.y-1),new W(Z.x+1,Z.y+1),K);else if(O.penSize<5){const Q=O.penSize/2;f(new W(Z.x-Q,Z.y-Q),new W(Z.x+Q-1,Z.y+Q-1),K)}else h(Z,Math.floor((O.penSize-1)/2),K)},y=(Z)=>{if(Z.invalid)return;const K=new E(Array.from(L.data.slice(Z.index,Z.index+4))),Q=[],q=(X)=>{if(X.invalid)return;if(!Q.includes(X.index)){const N=new E(Array.from(L.data.slice(X.index,X.index+4)));if(N.equals(K)&&N.notEquals(A))Q.push(X.index)}};q(Z);while(Q.length>0){const X=Q.shift();L.data[X+0]=A.rgb.r,L.data[X+1]=A.rgb.g,L.data[X+2]=A.rgb.b,L.data[X+3]=A.clear?0:255,Z=W.from(X),q(Z.topPoint),q(Z.leftPoint),q(Z.rightPoint),q(Z.bottomPoint)}},I=(Z)=>{if(Z.preventDefault(),!J.current)return;P=!0;const K=J.current.getBoundingClientRect();let Q=Z.clientX-K.left,q=Z.clientY-K.top;if(Q=Math.floor(W.DrawWidth*Q/J.current.clientWidth),q=Math.floor(W.DrawHeight*q/J.current.clientHeight),O.type==="pen"||O.type==="eraser"||O.type==="fill"){const N=new W(Q,q);if(b(),O.type==="pen"||O.type==="eraser")M(N);else if(O.type==="fill")y(N);p()}else if(O.type.startsWith("picker-"))Z.stopPropagation();else if(O.type.startsWith("center")){const N=W.DrawWidth/2-Q,_=W.DrawHeight/2-q;p(N,_),b()}const X=()=>{if(P)P=!1,u();document.removeEventListener("mouseup",X)};document.addEventListener("mouseup",X)},C=(Z)=>{if(Z.preventDefault(),!J.current)return;if(O.type==="center")return;const K=J.current.getBoundingClientRect();let Q=Z.clientX-K.left,q=Z.clientY-K.top;if(Q=Math.floor(W.DrawWidth*Q/J.current.clientWidth),q=Math.floor(W.DrawHeight*q/J.current.clientHeight),O.type==="pen"||O.type==="eraser"){const X=new W(Q,q);if(!P)B();else b();if(O.type==="pen"||O.type==="eraser")M(X);p()}else if(O.type.startsWith("picker-"));},d=(Z)=>{if(Z.preventDefault(),P=!1,O.type==="center"){u();return}const K=J.current.getBoundingClientRect();let Q=Z.clientX-K.left,q=Z.clientY-K.top;if(Q=Math.floor(W.DrawWidth*Q/J.current.clientWidth),q=Math.floor(W.DrawHeight*q/J.current.clientHeight),O.type.startsWith("picker-")){const[X,N,_,S]=H.getImageData(Q,q,1,1).data;if(S===0){if(O.type==="picker-fill")Y(new E(A.hsv,!0));if(O.type==="picker-outline")Y(new E(z.hsv,!0))}else Y(new E({r:X,g:N,b:_}).toHSVColor());return}if(u(),O.type==="eraser")B(),M(new W(Q,q)),p()},r=(Z)=>{if(Z.preventDefault(),!P)B(),p()};if(b0(()=>{if(J.current){const Z=J.current.getContext("2d",{willReadFrequently:!0});Z.imageSmoothingEnabled=!1,j(Z)}return()=>{}},[J]),b0(()=>{if(J.current){const Z=J.current.parentElement.parentElement;let K=(J.current.clientWidth-Z.clientWidth)/2,Q=(J.current.clientHeight-Z.clientHeight)/2;if(G>2){const X=Z.clientWidth/2;if(K=(Z.scrollLeft+X)/Z.dataset.scrollWidth*J.current.clientWidth-X,G>4){const N=Z.clientHeight/2;Q=(Z.scrollTop+N)/Z.dataset.scrollHeight*J.current.clientHeight-N}}Z.dataset.scrollWidth=J.current.clientWidth,Z.dataset.scrollHeight=J.current.clientHeight,Z.scroll({top:Q>0?Q:0,left:K>0?K:0});const q=J.current.nextSibling;q.style.top=`${G*W.DrawHeight/2}px`,q.style.left=`${G*W.DrawWidth/2}px`}return()=>{}},[G]),H&&$.length===0)if(F)j0(F).then((Z)=>{const K=W.DrawWidth/2-F.centerX,Q=W.DrawHeight/2-F.centerY;H.clearRect(0,0,W.DrawWidth,W.DrawHeight),H.drawImage(Z,K,Q),b(),u()});else b(),u();if(H&&$.length>0)B(),p();return N0("div",{className:o.drawBox,children:N0("div",{className:o.drawCanvasWrapper,children:[N0("canvas",{ref:J,className:u0(o.drawCanvas,{[o.center]:O.type==="center",[o.picker]:O.type.startsWith("picker-")}),width:W.DrawWidth,height:W.DrawHeight,style:{width:W.DrawWidth*G,height:W.DrawHeight*G},onMouseDown:I,onMouseMove:C,onMouseUp:d,onMouseLeave:r}),N0("img",{src:K0,className:u0(o.centerIcon,{[o.hidden]:O.type!=="center"})})]})})}m(".KOzPOa_painter-wrapper{padding:calc(var(--space)*1.5);border-left:1px solid var(--ui-black-transparent);color:var(--text-primary);flex-direction:column;flex:1;display:flex}.KOzPOa_row{min-height:3rem;margin-bottom:.5rem;display:flex}.KOzPOa_row-fill{padding-top:calc(var(--space)*2.5);border-top:1px dashed var(--ui-black-transparent);flex-direction:row;flex:1}.KOzPOa_row-right{margin-right:var(--space);justify-content:right}.KOzPOa_row:last-child{min-height:unset;margin-bottom:0}.KOzPOa_group{margin-right:calc(var(--space)*1.5);flex-direction:row;align-items:center;display:inline-flex}.KOzPOa_disabled{opacity:.3;pointer-events:none}.KOzPOa_dashed-border{border-right:1px dashed var(--ui-black-transparent);padding-right:var(--space)}.KOzPOa_name-input{width:8rem}.KOzPOa_large-input{width:4rem}.KOzPOa_tool-icon{margin-right:var(--space);width:2rem;height:2rem}.KOzPOa_label-image{vertical-align:middle;margin-right:calc(var(--space)/2)}.KOzPOa_button{width:calc(2rem + 2px);height:calc(2rem + 2px);padding:.375rem}.KOzPOa_button-icon{width:1.5rem;margin:auto}.KOzPOa_group-button{border-left:none;border-radius:0}.KOzPOa_group-button-first{border-top-right-radius:0;border-bottom-right-radius:0}.KOzPOa_group-button-last{border-left:none;border-top-left-radius:0;border-bottom-left-radius:0}.KOzPOa_group-button-toggled-off{filter:saturate(0)}.KOzPOa_label-button{border:0;font-weight:400}.KOzPOa_label-button.KOzPOa_selected{background:var(--motion-primary);color:var(--ui-white)}.KOzPOa_label-button.KOzPOa_selected .KOzPOa_button-icon{filter:brightness(0)invert()}.KOzPOa_draw-box-wrapper{margin:0 var(--space);border:1px solid var(--ui-black-transparent);border-radius:calc(var(--space)/2);flex:1;position:relative;overflow:hidden}");var U={group:"KOzPOa_group",nameInput:"KOzPOa_name-input",largeInput:"KOzPOa_large-input",rowRight:"KOzPOa_row-right",disabled:"KOzPOa_disabled",toolIcon:"KOzPOa_tool-icon",painterWrapper:"KOzPOa_painter-wrapper",groupButton:"KOzPOa_group-button",rowFill:"KOzPOa_row-fill",dashedBorder:"KOzPOa_dashed-border",groupButtonFirst:"KOzPOa_group-button-first",labelButton:"KOzPOa_label-button",labelImage:"KOzPOa_label-image",buttonIcon:"KOzPOa_button-icon",groupButtonToggledOff:"KOzPOa_group-button-toggled-off",drawBoxWrapper:"KOzPOa_draw-box-wrapper",row:"KOzPOa_row",button:"KOzPOa_button",groupButtonLast:"KOzPOa_group-button-last",selected:"KOzPOa_selected"};var x0="./assets/icon-undo-92fd565bdcf5e457.svg";var y0="./assets/icon-redo-68a33bfc57bb7814.svg";var p0="./assets/icon-zoom-in-de37432ea621c379.svg";var m0="./assets/icon-zoom-out-4c68fd9c343d89de.svg";var c0="./assets/icon-zoom-reset-7cf90555286e353d.svg";import{jsx as R,Fragment as C5} from"preact/jsx-runtime";function U0({mode:F,imageList:O,imageIndex:G}){const{getText:$,maybeLocaleText:V}=D5(),{modifyAsset:Y}=f5(),[J,H]=l(1),[j,A]=l("draw"),[z,P]=l("pen"),[L,b]=l(10),[p,u]=l(2),[B,D]=l(new E([260,0.6,1])),[c,x]=l(new E([0,1,0])),[f,h]=l([]),[M,y]=l([]),I=O[G],C=I&&I.id,d=!C,r=(N,_,S)=>{if(F==="costume")return _;if(F==="backdrop")return S;return N},Z=(N)=>{if(N.id=C,N.data){const _=P0(N.data);N.type=_.type,N.data=_.data,N.width=_.width,N.height=_.height,N.centerX=_.centerX,N.centerY=_.centerY}Y(N)},K=(N,_)=>{const S={};if(N==="name")S.name=_;if(N==="data"){if(S.data=_,f.length>20)f.splice(1,1);if(h(f.concat(S.data)),y([]),f.length===0)return}if(Z(S),j!=="draw")A("draw")},Q=(N)=>{if(j==="picker-fill")D(N);if(j==="picker-outline")x(N)},q=()=>{const N=f.pop();h(f),y(M.concat(N)),Z({data:f.at(-1)})},X=()=>{const N=M.pop();h(f.concat(N)),y(M),Z({data:N})};return L5(()=>{return h([]),y([]),A("draw"),()=>{}},[C]),R("div",{className:U.painterWrapper,children:[R("div",{className:U.row,children:[R("div",{className:U.group,children:R(H0,{text:r($("pixelPaint.painter.image","Image"),$("pixelPaint.painter.costume","Costume"),$("pixelPaint.painter.backdrop","Backdrop")),children:R(I5,{disabled:d,className:U.nameInput,placeholder:$("pixelPaint.painter.name","name"),onSubmit:(N)=>K("name",N),value:I?V(I.name):r($("pixelPaint.painter.image","Image"),$("pixelPaint.painter.costume","Costume"),$("pixelPaint.painter.backdrop","Backdrop"))})})}),R("div",{className:U.group,children:[R(Z0,{disabled:f.length<=1,className:g(U.button,U.groupButtonFirst,{[U.groupButtonToggledOff]:d}),onClick:q,children:R("img",{src:x0,className:U.buttonIcon,title:$("pixelPaint.painter.undo","Undo")})}),R(Z0,{disabled:M.length===0,className:g(U.button,U.groupButtonLast,{[U.groupButtonToggledOff]:d}),onClick:X,children:R("img",{src:y0,className:U.buttonIcon,title:$("pixelPaint.painter.redo","Redo")})})]}),R("div",{className:U.group,children:F==="costume"&&R(Z0,{vertical:!0,className:g(U.labelButton,{[U.selected]:j==="center"}),onClick:()=>A(j!=="center"?"center":"draw"),children:[R("img",{src:K0,className:U.buttonIcon,title:$("pixelPaint.painter.center","Center")}),R("span",{children:$("pixelPaint.painter.center","Center")})]})})]}),R("div",{className:U.row,children:[R("div",{className:U.group,children:R(H0,{text:$("pixelPaint.painter.fill","Fill"),children:R($0,{picking:j.startsWith("picker-"),color:B,onChange:D,onPickColor:(N)=>A(N===!1?"draw":"picker-fill")})})}),R("div",{className:g(U.group,U.dashedBorder),children:[R(H0,{className:g({[U.disabled]:!0}),text:$("pixelPaint.painter.outline","Outline"),children:R($0,{outline:!0,picking:j.startsWith("picker-"),color:c,onChange:x,onPickColor:(N)=>A(N===!1?"draw":"picker-outline")})}),R(g0,{small:!0,type:"number",min:0,max:100,step:1,className:g(U.largeInput,{[U.disabled]:!0}),value:p,onChange:(N)=>u(N.target.valueAsNumber)})]}),R("div",{className:U.group,children:z==="pen"||z==="eraser"?R(C5,{children:[R("img",{src:z==="pen"?q0:J0,className:U.toolIcon}),R(g0,{small:!0,type:"number",min:1,max:100,step:1,className:U.largeInput,value:L,onChange:(N)=>b(N.target.valueAsNumber)})]}):null})]}),R("div",{className:g(U.row,U.rowFill),children:[R(X0,{selectedTool:z,onSelect:P}),R("div",{className:U.drawBoxWrapper,children:R(M0,{image:I,zoom:J,selectedTool:{fillColor:B,outlineColor:c,penSize:L,outlineSize:p,type:j==="draw"?z:j},undoList:f,onChange:(N)=>K("data",N),onChangeColor:Q})})]}),R("div",{className:g(U.row,U.rowRight),children:[R(Z0,{className:g(U.button,U.groupButtonFirst),onClick:()=>J-1>0&&H(J-1),children:R("img",{src:m0,className:U.buttonIcon})}),R(Z0,{className:g(U.button,U.groupButton),onClick:()=>H(1),children:R("img",{src:c0,className:U.buttonIcon})}),R(Z0,{className:g(U.button,U.groupButtonLast),onClick:()=>J+1<20&&H(J+1),children:R("img",{src:p0,className:U.buttonIcon})})]})]})}m(".gJa9lW_pixel-paint-wrapper{background:var(--ui-white);border-radius:inherit;flex-grow:1;display:flex}");var d0={pixelPaintWrapper:"gJa9lW_pixel-paint-wrapper"};function b5({onSetupLibrary:F}){const{fileList:O,assetList:G,selectedIndex:$}=T5();let V=G.filter((H)=>/^image\//.test(H.type)),Y="image";const J=O[$];if(J&&J.assets&&J.frame!=null)V=V.filter((H)=>J.assets.includes(H.id)),Y=$===0?"backdrop":"costume";return E0("div",{className:d0.pixelPaintWrapper,children:[E0(W0,{mode:Y,imageList:V,imageIndex:J.frame,onSetupLibrary:F}),E0(U0,{mode:Y,imageIndex:J.frame,imageList:V})]})}import{jsx as E0} from"preact/jsx-runtime";var r0={"pixelPaint.contextMenu.duplicate":"duplicate","pixelPaint.contextMenu.export":"export","pixelPaint.contextMenu.delete":"delete","pixelPaint.actionButton.upload":"Upload Image","pixelPaint.actionButton.uploadCostume":"Upload Costume","pixelPaint.actionButton.uploadBackdrop":"Upload Backdrop","pixelPaint.actionButton.surprise":"Surprise","pixelPaint.actionButton.paint":"Paint","pixelPaint.actionButton.image":"Choose a Image","pixelPaint.actionButton.costume":"Choose a Costume","pixelPaint.actionButton.backdrop":"Choose a Backdrop","pixelPaint.painter.image":"Image","pixelPaint.painter.costume":"Costume","pixelPaint.painter.backdrop":"Backdrop","pixelPaint.painter.name":"name","pixelPaint.painter.undo":"Undo","pixelPaint.painter.redo":"Redo","pixelPaint.painter.pen":"Pen","pixelPaint.painter.eraser":"Eraser","pixelPaint.painter.fill":"Fill","pixelPaint.painter.text":"Text","pixelPaint.painter.line":"Line","pixelPaint.painter.rectangle":"Rectangle","pixelPaint.painter.circle":"Circle","pixelPaint.painter.select":"Select","pixelPaint.painter.center":"Center","pixelPaint.painter.outline":"Outline","pixelPaint.colorPicker.color":"Color","pixelPaint.colorPicker.saturation":"Saturation","pixelPaint.colorPicker.brightness":"Brightness"};var n0={"pixelPaint.contextMenu.duplicate":"\u590D\u5236","pixelPaint.contextMenu.export":"\u5BFC\u51FA","pixelPaint.contextMenu.delete":"\u5220\u9664","pixelPaint.actionButton.upload":"\u4E0A\u4F20\u56FE\u7247","pixelPaint.actionButton.uploadCostume":"\u4E0A\u4F20\u9020\u578B","pixelPaint.actionButton.uploadBackdrop":"\u4E0A\u4F20\u80CC\u666F","pixelPaint.actionButton.surprise":"\u968F\u673A","pixelPaint.actionButton.paint":"\u7ED8\u5236","pixelPaint.actionButton.image":"\u9009\u62E9\u4E00\u4E2A\u56FE\u7247","pixelPaint.actionButton.costume":"\u9009\u62E9\u4E00\u4E2A\u9020\u578B","pixelPaint.actionButton.backdrop":"\u9009\u62E9\u4E00\u4E2A\u80CC\u666F","pixelPaint.painter.image":"\u56FE\u7247","pixelPaint.painter.costume":"\u9020\u578B","pixelPaint.painter.backdrop":"\u80CC\u666F","pixelPaint.painter.name":"\u540D\u5B57","pixelPaint.painter.undo":"\u64A4\u9500","pixelPaint.painter.redo":"\u91CD\u505A","pixelPaint.painter.pen":"\u753B\u7B14","pixelPaint.painter.eraser":"\u6A61\u76AE\u64E6","pixelPaint.painter.fill":"\u586B\u5145","pixelPaint.painter.text":"\u6587\u672C","pixelPaint.painter.line":"\u7EBF\u6BB5","pixelPaint.painter.rectangle":"\u77E9\u5F62","pixelPaint.painter.circle":"\u5706\u5F62","pixelPaint.painter.select":"\u9009\u62E9","pixelPaint.painter.center":"\u4E2D\u5FC3","pixelPaint.painter.outline":"\u8F6E\u5ED3","pixelPaint.colorPicker.color":"\u989C\u8272","pixelPaint.colorPicker.saturation":"\u9971\u548C\u5EA6","pixelPaint.colorPicker.brightness":"\u4EAE\u5EA6"};var d7={en:r0,"zh-Hans":n0};export{d7 as locales,b5 as PixelPaint};
