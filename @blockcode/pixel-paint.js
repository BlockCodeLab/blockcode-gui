import{useEditor as K5}from"@blockcode/core";import{useState as h1}from"preact/hooks";import{useLocale as o5,useLayout as c5,useEditor as d5}from"@blockcode/core";import{IconSelector as s5,ActionButton as p5}from"@blockcode/ui";class d{static get DrawWidth(){return 320}static get DrawHeight(){return 240}static from(t){let e=t>>2,i=Math.floor(e/320),n=e-i*320;return new d(n,i)}constructor(t,e){this.setXY(t,e)}get x(){return this._x}set x(t){this._x=t,this._index=this.x+this.y*320<<2}get y(){return this._y}set y(t){this._y=t,this._index=this.x+this.y*320<<2}get index(){return this._index}get valid(){return this.x>=0&&this.x<320&&this.y>=0&&this.y<240}get invalid(){return!this.valid}get topPoint(){return new d(this.x,this.y-1)}get leftPoint(){return new d(this.x-1,this.y)}get rightPoint(){return new d(this.x+1,this.y)}get bottomPoint(){return new d(this.x,this.y+1)}get topLeftPoint(){return new d(this.x-1,this.y-1)}get topRightPoint(){return new d(this.x+1,this.y-1)}get bottomLeftPoint(){return new d(this.x-1,this.y+1)}get bottomRightPoint(){return new d(this.x+1,this.y+1)}setXY(t,e){return this._x=t,this._y=e,this._index=this.x+this.y*320<<2,this}equals(t){return this.x==t.x&&this.y==t.y}}var v1=22,t5="data:,";function N1(t){return new Promise(async(e)=>{let i=new FileReader;i.readAsDataURL(t),i.addEventListener("load",()=>{let n=new Image;n.src=i.result,n.addEventListener("load",()=>{if(n.dataset.data){e(n);return}let{width:p,height:s}=n;if(n.width>d.DrawWidth||n.height>d.DrawHeight){p=d.DrawWidth,s=d.DrawHeight;let v=n.width/d.DrawWidth,M=n.height/d.DrawHeight;if(v>M)s=n.height/v;else p=n.width/M}let o=document.createElement("canvas");o.width=p,o.height=s,o.getContext("2d").drawImage(n,0,0,p,s);let C=o.toDataURL("image/png");if(C===t5){e(null);return}n.dataset.data=C.slice(v1),n.src=C})})})}function f1(t){return new Promise(async(e)=>{let i=new Image,n="image/png";if(typeof t==="string")i.src=t;else n=t.type,i.src=`data:${n};base64,${t.data}`;i.addEventListener("load",()=>{i.dataset.data=i.src.slice(`data:${n};base64,`.length),e(i)})})}function I1(t){return new Promise(async(e)=>{let i=new Image;i.src=t,i.addEventListener("load",()=>{let n=document.createElement("canvas");n.width=i.width,n.height=i.height,n.getContext("2d").drawImage(i,0,0,i.width,i.height);let s=n.toDataURL("image/png");i.dataset.data=s.slice(v1),e(i)})})}function e1(t=32){let e=[];for(let i=0;i<t;i++)e[i]="0123456789abcdefghijklmnopqrstuvwxyz".charAt(Math.random()*36);return e.join("")}function U(t){let e=globalThis.document,i=e.createElement("style");i.appendChild(e.createTextNode(t)),e.head.append(i)}U(".K-gn7q_selector-wrapper{background:var(--ui-secondary);width:150px;position:relative}.K-gn7q_selector-items-wrapper{width:150px;min-height:100%;padding-bottom:100px}.K-gn7q_selector-item{width:5rem;height:5rem;margin:.5rem auto}.K-gn7q_delete-menu-item:hover{background:var(--error-primary)}.K-gn7q_add-button-wrapper{background:linear-gradient(transparent,var(--ui-secondary));width:100%;height:100px;display:flex;position:absolute;bottom:0;left:0;right:0}.K-gn7q_add-button{margin:.75rem auto}");var i1={selectorWrapper:"K-gn7q_selector-wrapper",addButtonWrapper:"K-gn7q_add-button-wrapper",addButton:"K-gn7q_add-button",selectorItemsWrapper:"K-gn7q_selector-items-wrapper",deleteMenuItem:"K-gn7q_delete-menu-item",selectorItem:"K-gn7q_selector-item"};var A1="./assets/icon-sprite-zx9m3hdh.svg";var D1="./assets/icon-backdrop-qvqgzqwj.svg";var O1="./assets/icon-surprise-d5t4529a.svg";var z1="./assets/icon-search-6g8kgvdt.svg";var b1="./assets/icon-paint-0h8zs19a.svg";var _1="./assets/icon-file-upload-0z25chr6.svg";import{jsx as a1,jsxs as h5}from"preact/jsx-runtime";function w1({mode:t,imageList:e,imageIndex:i,onSetupLibrary:n}){let[p,s]=h1(!1),[o,g]=h1(!1),[C,v]=h1(!1),{getText:M}=o5(),{createAlert:A,removeAlert:G}=c5(),{addAsset:_,deleteAsset:z,modifyFile:S}=d5(),f=e.map((l)=>l.id),{ImagesLibrary:Y,BackdropsLibrary:W,CostumesLibrary:P}=n(),E=()=>{if(t==="costume"){s(!1),g(!0),v(!1);return}if(t==="backdrop"){s(!1),g(!1),v(!0);return}s(!0),g(!1),v(!1)},N=()=>{s(!1),g(!1),v(!1)},h=async({tags:l,...c})=>{let a=e1();A("importing",{id:a});let w=await I1(`./assets/${c.id}.png`);_({...c,id:a,type:"image/png",data:w.dataset.data,width:w.width,height:w.height}),f.push(a),G(a),S({assets:f,frame:f.length-1})},F=()=>{if(t==="costume"){h(P.surprise());return}if(t==="backdrop"){h(W.surprise());return}h(Y.surprise())},b=(l,c,a)=>{if(t==="costume")return c;if(t==="backdrop")return a;return l},y=(l)=>`data:${l.type};base64,${l.data}`,R=(l)=>{S({frame:l})},H=()=>{let l=document.createElement("input");l.type="file",l.accept="image/*",l.multiple=!0,l.click(),l.addEventListener("change",async({target:c})=>{let a=e1();A("importing",{id:a});for(let w of c.files){let k=e1(),B=w.name.slice(0,w.name.lastIndexOf(".")),D=await N1(w);if(!D)A({message:M("pixelPaint.actionButton.uploadError",'Upload "{file}" failed.',{file:w.name})},2000),D={dataset:{data:"iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAAtJREFUGFdjYAACAAAFAAGq1chRAAAAAElFTkSuQmCC"},width:1,height:1};_({id:k,type:"image/png",name:B,data:D.dataset.data,width:D.width,height:D.height,centerX:Math.floor(D.width/2),centerY:Math.floor(D.height/2)}),f.push(k)}G(a),S({assets:f,frame:f.length-1})})},Z=()=>{let l=e1();_({id:l,type:"image/png",name:M(`pixelPaint.painter.${t}`,t),data:"iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAAtJREFUGFdjYAACAAAFAAGq1chRAAAAAElFTkSuQmCC",width:1,height:1,centerX:1,centerY:1}),f.push(l),S({assets:f,frame:f.length-1})},Q=(l)=>{z(f[l]),f.splice(l,1),S({assets:f,frame:i===0?0:l>i?i:i-1})},r=(l)=>{let c=e[l],a=e1();_({...c,id:a}),f.push(a),S({assets:f,frame:f.length-1})};return h5("div",{className:i1.selectorWrapper,children:[a1(s5,{displayOrder:!0,id:"paint-selector",className:i1.selectorItemsWrapper,items:e.map((l,c)=>({...l,details:`${l.width}×${l.height}`,icon:y(l),order:c,className:i1.selectorItem,contextMenu:[[{label:M("pixelPaint.contextMenu.duplicate","duplicate"),onClick:()=>r(c)},{label:M("pixelPaint.contextMenu.export","export"),disabled:!0}],[{label:M("pixelPaint.contextMenu.delete","delete"),className:i1.deleteMenuItem,disabled:e.length<=1,onClick:()=>Q(c)}]]})),selectedIndex:i,onSelect:R,onDelete:e.length>1&&Q}),a1("div",{className:i1.addButtonWrapper,children:a1(p5,{tooltipPlacement:"right",className:i1.addButton,icon:t==="costume"?A1:D1,tooltip:b(M("pixelPaint.actionButton.image","Choose a Image"),M("pixelPaint.actionButton.costume","Choose a Costume"),M("pixelPaint.actionButton.backdrop","Choose a Backdrop")),onClick:E,moreButtons:[{icon:_1,tooltip:b(M("pixelPaint.actionButton.upload","Upload Image"),M("pixelPaint.actionButton.uploadCostume","Upload Costume"),M("pixelPaint.actionButton.uploadBackdrop","Upload Backdrop")),onClick:H},{icon:O1,tooltip:M("pixelPaint.actionButton.surprise","Surprise"),onClick:F},{icon:b1,tooltip:M("pixelPaint.actionButton.paint","Paint"),onClick:Z},{icon:z1,tooltip:b(M("pixelPaint.actionButton.image","Choose a Image"),M("pixelPaint.actionButton.costume","Choose a Costume"),M("pixelPaint.actionButton.backdrop","Choose a Backdrop")),onClick:E}]})}),p&&Y&&a1(Y,{onClose:N,onSelect:h}),o&&P&&a1(P,{onClose:N,onSelect:h}),C&&W&&a1(W,{onClose:N,onSelect:h})]})}import{useEffect as U5,useState as q}from"preact/hooks";import{useLocale as j5,useEditor as Z5}from"@blockcode/core";import{classNames as j,Text as Q5,Label as x1,BufferedInput as k1,Button as n1}from"@blockcode/ui";class m{static decimalToHex(t){if(t<0)t+=16777216;let e=Number(t).toString(16);return e=`#${"000000".substr(0,6-e.length)}${e}`,e}static decimalToRgb(t){let e=t>>24&255,i=t>>16&255,n=t>>8&255,p=t&255;return{r:i,g:n,b:p,a:e>0?e:255}}static hexToRgb(t){let e=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;t=t.replace(e,(n,p,s,o)=>p+p+s+s+o+o);let i=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return i?{r:parseInt(i[1],16),g:parseInt(i[2],16),b:parseInt(i[3],16)}:null}static rgbToHex(t){return m.decimalToHex(m.rgbToDecimal(t))}static rgbToDecimal(t){return(t.r<<16)+(t.g<<8)+t.b}static hexToDecimal(t){return m.rgbToDecimal(m.hexToRgb(t))}static hsvToRgb(t){let e=t.h%360;if(e<0)e+=360;let i=Math.max(0,Math.min(t.s,1)),n=Math.max(0,Math.min(t.v,1)),p=Math.floor(e/60),s=e/60-p,o=n*(1-i),g=n*(1-i*s),C=n*(1-i*(1-s)),v,M,A;switch(p){default:case 0:v=n,M=C,A=o;break;case 1:v=g,M=n,A=o;break;case 2:v=o,M=n,A=C;break;case 3:v=o,M=g,A=n;break;case 4:v=C,M=o,A=n;break;case 5:v=n,M=o,A=g;break}return{r:Math.floor(v*255),g:Math.floor(M*255),b:Math.floor(A*255)}}static rgbToHsv(t){let e=t.r/255,i=t.g/255,n=t.b/255,p=Math.min(Math.min(e,i),n),s=Math.max(Math.max(e,i),n),o=0,g=0;if(p!==s){let C=e===p?i-n:i===p?n-e:e-i;o=((e===p?3:i===p?5:1)-C/(s-p))*60%360,g=(s-p)/s}return{h:o,s:g,v:s}}static mixRgb(t,e,i){if(i<=0)return t;if(i>=1)return e;let n=1-i;return{r:n*t.r+i*e.r,g:n*t.g+i*e.g,b:n*t.b+i*e.b}}constructor(t,e=!1){if(this._clear=e,this._color=t,typeof t==="number")this._type="decimal";else if(typeof t==="string"&&t[0]==="#")this._type="hex";else if(Array.isArray(t)){let[i,n,p]=t;if(n<=1&&p<=1)this._type="hsv",this._color={h:i,s:n,v:p};else this._type="rgb",this._color={r:i,g:n,b:p};this._clear=e||t[3]===0}else if(typeof t.r==="number")this._type="rgb";else if(typeof t.h==="number")this._type="hsv"}get clear(){return this._clear}get rgb(){if(this._type==="rgb")return this._color;if(this._type==="decimal")return m.decimalToRgb(this._color);if(this._type==="hsv")return m.hsvToRgb(this._color);if(this._type==="hex")return m.hexToRgb(this._color)}get hsv(){if(this._type==="hsv")return this._color;if(this._type==="decimal")return m.rgbToHsv(m.decimalToRgb(this._color));if(this._type==="rgb")return m.rgbToHsv(this._color);if(this._type==="hex")return m.rgbToHsv(m.hexToRgb(this._color))}get hex(){if(this._type==="hex")return this._color;if(this._type==="decimal")return m.decimalToHex(this._color);if(this._type==="rgb")return m.rgbToHex(this._color);if(this._type==="hsv")return m.rgbToHex(m.hsvToRgb(this._color))}get decimal(){if(this._type==="decimal")this._color;if(this._type==="rgb")return m.rgbToDecimal(this._color);if(this._type==="hsv")return m.rgbToDecimal(m.hsvToRgb(this._color));if(this._type==="hex")return m.hexToDecimal(this._color)}toRGBColor(){if(this._type==="rgb")return this;return new m(this.rgb,this.clear)}toHSVColor(){if(this._type==="hsv")return this;return new m(this.hsv,this.clear)}toHEXColor(){if(this._type==="hex")return this;return new m(this.hex,this.clear)}toDecimalColor(){if(this._type==="decimal")return this;return new m(this.decimal,this.clear)}equals(t){return this.rgb.r===t.rgb.r&&this.rgb.g===t.rgb.g&&this.rgb.b===t.rgb.b&&this.clear===t.clear}notEquals(t){return!this.equals(t)}}var w5=(t)=>{let e;for(let i=0;i<t.height;i++){e=i*t.width;for(let n=0;n<t.width;n++){if(t.data[(e<<2)+3]!==0)return i;e++}}},g5=(t,e)=>{let i;for(let n=t.height-1;n>=e;n--){i=n*t.width;for(let p=0;p<t.width;p++){if(t.data[(i<<2)+3]!==0)return n;i++}}},u5=(t,e,i)=>{let n;for(let p=0;p<t.width;p++)for(let s=e;s<=i;s++)if(n=s*t.width+p,t.data[(n<<2)+3]!==0)return p},M5=(t,e,i,n)=>{let p;for(let s=t.width-1;s>=n;s--)for(let o=e;o<=i;o++)if(p=o*t.width+s,t.data[(p<<2)+3]!==0)return s};function P1(t){let e=w5(t),i=g5(t,e),n=u5(t,e,i),p=M5(t,e,i,n),s={top:e||0,left:n||0,right:p||0,bottom:i||0};return s.width=s.right-s.left+1,s.height=s.bottom-s.top+1,s}function E1(t){let{top:e,left:i,width:n,height:p}=P1(t),s=Math.floor(t.width/2-i),o=Math.floor(t.height/2-e),g=document.createElement("canvas");g.width=n,g.height=p,g.getContext("2d").putImageData(t,-i,-e,i,e,n,p);let[v,M]=g.toDataURL().slice(5).split(";base64,");return{type:v,data:M,width:n,height:p,centerX:s,centerY:o}}import{classNames as r1,Text as u1,Tooltip as x5}from"@blockcode/ui";U('._Y2YyW_color-picker-wrapper{margin-right:var(--space);cursor:pointer;width:3rem;height:2rem;display:flex}._Y2YyW_color-swatch{border:1px solid var(--ui-black-transparent);border-top-left-radius:var(--form-radius);border-bottom-left-radius:var(--form-radius);flex-shrink:0;flex-basis:2rem;height:100%;display:flex;position:relative}._Y2YyW_color-swatch-outline:after{content:"";background:var(--ui-white);border:1px solid var(--ui-black-transparent);z-index:1;width:.75rem;height:.75rem;position:absolute;top:.5rem;left:.5rem}._Y2YyW_picker-arrow{user-select:none;border:1px solid var(--ui-black-transparent);border-top-right-radius:var(--form-radius);border-bottom-right-radius:var(--form-radius);border-left:0;flex-shrink:0;flex-basis:1rem;justify-content:center;align-items:center;height:100%;font-size:.75rem;display:flex}._Y2YyW_color-tooltip{background:var(--ui-white);color:var(--text-primary);padding:calc(var(--space)/2)}._Y2YyW_tooltip-item{margin:8px}._Y2YyW_tooltip-item-label{font-weight:700}._Y2YyW_tooltip-item-readout{margin-left:10px}._Y2YyW_tooltip-item-slider{border-radius:11px;outline:none;width:150px;height:22px;margin-bottom:20px;position:relative}._Y2YyW_tooltip-item-slider-handler{background-color:var(--ui-white);box-shadow:0 0 0 4px var(--ui-black-transparent);touch-action:none;border-radius:100%;width:26px;height:26px;margin-top:-2px;position:absolute;left:100px}._Y2YyW_tooltip-item-toolbar{justify-content:space-between;display:flex}._Y2YyW_tooltip-item-toolbar-button{border:1px solid var(--ui-black-transparent);border-radius:var(--form-radius);cursor:pointer;width:calc(1.5rem + 2px);height:calc(1.5rem + 2px)}._Y2YyW_tooltip-item-toolbar-button._Y2YyW_selected{border:1px solid #855cd6;box-shadow:0 0 0 3px #855cd659}._Y2YyW_button-icon{width:1.5rem;height:1.5rem}');var x={tooltipItemToolbar:"_Y2YyW_tooltip-item-toolbar",pickerArrow:"_Y2YyW_picker-arrow",colorSwatchOutline:"_Y2YyW_color-swatch-outline",colorSwatch:"_Y2YyW_color-swatch",tooltipItemSlider:"_Y2YyW_tooltip-item-slider",tooltipItemReadout:"_Y2YyW_tooltip-item-readout",colorPickerWrapper:"_Y2YyW_color-picker-wrapper",tooltipItemSliderHandler:"_Y2YyW_tooltip-item-slider-handler",colorTooltip:"_Y2YyW_color-tooltip",selected:"_Y2YyW_selected",buttonIcon:"_Y2YyW_button-icon",tooltipItemToolbarButton:"_Y2YyW_tooltip-item-toolbar-button",tooltipItem:"_Y2YyW_tooltip-item",tooltipItemLabel:"_Y2YyW_tooltip-item-label"};var y1="./assets/icon-picker-2frmfa34.svg";var g1="./assets/icon-clear-gctr9axd.svg";import{jsx as O,jsxs as l1,Fragment as L5}from"preact/jsx-runtime";var k5=[0,0,324,288,252,216,180,144,108,72,36,0,0],X=124;function c1({picking:t,color:e,outline:i,onChange:n,onPickColor:p}){let s=e.hsv.h,o=e.hsv.s,g=e.hsv.v,C=(h,F,b,y)=>new m({h,s:F,v:b},y),v=(h)=>n(C(Math.round(h*360),o,g)),M=(h)=>n(C(s,h,g)),A=(h)=>n(C(s,o,h)),G=()=>n(C(s,o,g,!0)),_=(h,F)=>{h.stopPropagation();let b=h.target,y=b.offsetLeft,R=h.clientX,H=(Q)=>{Q.preventDefault();let r=Q.clientX-R+y;if(r>=X)r=X;if(r<=0)r=0;b.style.left=`${r}px`,F(r/X)},Z=()=>{document.removeEventListener("mousemove",H),document.removeEventListener("mouseup",Z)};document.addEventListener("mousemove",H),document.addEventListener("mouseup",Z)},z=(h)=>_(h,v),S=(h)=>_(h,M),f=(h)=>_(h,A),Y=(h,F)=>{let b=h.target.children[0],y=h.offsetX-13;if(y>=X)y=X;if(y<=0)y=0;b.style.left=`${y}px`,F(y/X)},W=(h)=>Y(h,v),P=(h)=>Y(h,M),E=(h)=>Y(h,A),N=k5.map((h)=>C(h,o,g).hex);return O(x5,{clickable:!0,placement:"bottom",className:x.colorTooltip,onHide:()=>p(!1),content:l1(L5,{children:[l1("div",{className:x.tooltipItem,children:[O("span",{className:x.tooltipItemLabel,children:O(u1,{id:"pixelPaint.colorPicker.color",defaultMessage:"Color"})}),O("span",{className:x.tooltipItemReadout,children:Math.round(s/360*100)})]}),O("div",{className:r1(x.tooltipItem,x.tooltipItemSlider),style:{background:`linear-gradient(to left, ${N[0]} 0px, ${N[1]} 13px, ${N[2]}, ${N[3]}, ${N[4]}, ${N[5]}, ${N[6]}, ${N[7]}, ${N[8]}, ${N[9]}, ${N[10]}, ${N[11]} 137px, ${N[12]} 100%)`},onClick:W,children:O("div",{className:x.tooltipItemSliderHandler,style:{left:`${Math.round(s/360*X)}px`},onMouseDown:z,onClick:(h)=>h.stopPropagation()})}),l1("div",{className:x.tooltipItem,children:[O("span",{className:x.tooltipItemLabel,children:O(u1,{id:"pixelPaint.colorPicker.saturation",defaultMessage:"Saturation"})}),O("span",{className:x.tooltipItemReadout,children:Math.round(o*100)})]}),O("div",{className:r1(x.tooltipItem,x.tooltipItemSlider),style:{background:`linear-gradient(to right, ${C(s,0,g).hex} 0px, ${C(s,1,g).hex} 100%)`},onClick:P,children:O("div",{className:x.tooltipItemSliderHandler,style:{left:`${Math.round(o*X)}px`},onMouseDown:S,onClick:(h)=>h.stopPropagation()})}),l1("div",{className:x.tooltipItem,children:[O("span",{className:x.tooltipItemLabel,children:O(u1,{id:"pixelPaint.colorPicker.brightness",defaultMessage:"Brightness"})}),O("span",{className:x.tooltipItemReadout,children:Math.round(g*100)})]}),O("div",{className:r1(x.tooltipItem,x.tooltipItemSlider),style:{background:`linear-gradient(to right, ${C(s,o,0).hex} 0px, ${C(s,o,1).hex} 100%)`},onClick:E,children:O("div",{className:x.tooltipItemSliderHandler,style:{left:`${Math.round(g*X)}px`},onMouseDown:f,onClick:(h)=>h.stopPropagation()})}),l1("div",{className:r1(x.tooltipItem,x.tooltipItemToolbar),children:[O("div",{className:r1(x.tooltipItemToolbarButton,{[x.selected]:e.clear}),onClick:G,children:O("img",{src:g1,className:x.buttonIcon})}),O("div",{className:r1(x.tooltipItemToolbarButton,{[x.selected]:t}),onClick:p,children:O("img",{src:y1,className:x.buttonIcon})})]})]}),children:l1("div",{className:x.colorPickerWrapper,children:[O("div",{className:r1(x.colorSwatch,{[x.colorSwatchOutline]:i}),style:{background:e.clear?"var(--ui-white)":C(s,o,g).hex},children:e.clear&&O("img",{src:g1})}),O("div",{className:x.pickerArrow,children:"▾"})]})})}import{useLocale as b5}from"@blockcode/core";import{classNames as $,Button as V}from"@blockcode/ui";U(".zaEMxq_tool-box-wrapper{flex-flow:wrap;place-content:flex-start space-between;width:7rem;display:flex}.zaEMxq_tool-button{margin:calc(var(--space)/2);border-radius:calc(var(--space)/2);padding:calc(var(--space)/2);user-select:none;background:0 0;border:none;outline:none;transition:all .2s;display:inline-block}.zaEMxq_tool-button.zaEMxq_selected{background:var(--motion-primary)}.zaEMxq_tool-icon{vertical-align:middle;width:2rem;height:2rem}.zaEMxq_tool-button.zaEMxq_selected .zaEMxq_tool-icon{filter:brightness(0)invert()}");var I={toolIcon:"zaEMxq_tool-icon",toolButton:"zaEMxq_tool-button",toolBoxWrapper:"zaEMxq_tool-box-wrapper",selected:"zaEMxq_selected"};var d1="./assets/icon-pen-vmav54fy.svg";var s1="./assets/icon-eraser-6exvhk0q.svg";var B1="./assets/icon-fill-70s8y3f8.svg";var S1="./assets/icon-text-e5hysycg.svg";var Y1="./assets/icon-line-r61p9edw.svg";var T1="./assets/icon-rectangle-yasy0y9k.svg";var F1="./assets/icon-circle-ynejmr8k.svg";var W1="./assets/icon-select-7g007t5g.svg";import{jsx as T,jsxs as U1,Fragment as _5}from"preact/jsx-runtime";function M1({selectedTool:t,onSelect:e}){let{getText:i}=b5();return U1("div",{className:I.toolBoxWrapper,children:[T(V,{className:$(I.toolButton,{[I.selected]:t==="pen"}),onClick:()=>e("pen"),children:T("img",{src:d1,className:I.toolIcon,title:i("pixelPaint.painter.pen","Pen")})}),T(V,{className:$(I.toolButton,{[I.selected]:t==="eraser"}),onClick:()=>e("eraser"),children:T("img",{src:s1,className:I.toolIcon,title:i("pixelPaint.painter.eraser","Eraser")})}),T(V,{className:$(I.toolButton,{[I.selected]:t==="fill"}),onClick:()=>e("fill"),children:T("img",{src:B1,className:I.toolIcon,title:i("pixelPaint.painter.fill","Fill")})}),U1(_5,{children:[T(V,{disabled:!0,className:$(I.toolButton,{[I.selected]:t==="text"}),onClick:()=>e("text"),children:T("img",{src:S1,className:I.toolIcon,title:i("pixelPaint.painter.text","Text")})}),T(V,{disabled:!0,className:$(I.toolButton,{[I.selected]:t==="line"}),onClick:()=>e("line"),children:T("img",{src:Y1,className:I.toolIcon,title:i("pixelPaint.painter.line","Line")})}),T(V,{disabled:!0,className:$(I.toolButton,{[I.selected]:t==="rectangle"}),onClick:()=>e("rectangle"),children:T("img",{src:T1,className:I.toolIcon,title:i("pixelPaint.painter.rectangle","Rectangle")})}),T(V,{disabled:!0,className:$(I.toolButton,{[I.selected]:t==="circle"}),onClick:()=>e("circle"),children:T("img",{src:F1,className:I.toolIcon,title:i("pixelPaint.painter.circle","Circle")})}),T(V,{disabled:!0,className:$(I.toolButton,{[I.selected]:t==="select"}),onClick:()=>e("select"),children:T("img",{src:W1,className:I.toolIcon,title:i("pixelPaint.painter.select","Select")})})]})]})}import{useRef as E5,useEffect as j1,useState as y5}from"preact/hooks";import{classNames as Z1}from"@blockcode/ui";U("._1X3Adq_draw-box{background:var(--ui-secondary);width:100%;height:100%;display:flex;position:absolute;top:0;left:0;overflow:auto}._1X3Adq_draw-canvas-wrapper{margin:auto;position:relative}._1X3Adq_draw-canvas{image-rendering:pixelated;background:url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+CjwhLS0gQ3JlYXRlZCB3aXRoIFZlY3Rvcm5hdG9yIChodHRwOi8vdmVjdG9ybmF0b3IuaW8vKSAtLT4KPHN2ZyBoZWlnaHQ9IjMwIiB3aWR0aD0iMzAiIHN0cm9rZS1taXRlcmxpbWl0PSIxMCIgc3R5bGU9ImZpbGwtcnVsZTpub256ZXJvO2NsaXAtcnVsZTpldmVub2RkO3N0cm9rZS1saW5lY2FwOnJvdW5kO3N0cm9rZS1saW5lam9pbjpyb3VuZDsiIHZlcnNpb249IjEuMSIgdmlld0JveD0iMCAwIDQwIDQwIiB4bWw6c3BhY2U9InByZXNlcnZlIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIj4KPGRlZnMvPgo8Zz4KPHBhdGggZD0iTTAgMEw0MCAwTDQwIDQwTDAgNDBMMCAwWiIgZmlsbD0iI2ZmZmZmZiIgZmlsbC1ydWxlPSJub256ZXJvIiBvcGFjaXR5PSIxIiBzdHJva2U9Im5vbmUiLz4KPHBhdGggZD0iTTAgMEwyMCAwTDIwIDIwTDAgMjBMMCAwWiIgZmlsbD0iI2VhZjBmOCIgZmlsbC1ydWxlPSJub256ZXJvIiBvcGFjaXR5PSIxIiBzdHJva2U9Im5vbmUiLz4KPHBhdGggZD0iTTIwIDIwTDQwIDIwTDQwIDQwTDIwIDQwTDIwIDIwWiIgZmlsbD0iI2VhZjBmOCIgZmlsbC1ydWxlPSJub256ZXJvIiBvcGFjaXR5PSIxIiBzdHJva2U9Im5vbmUiLz4KPC9nPgo8L3N2Zz4K);width:320px;height:240px}._1X3Adq_draw-canvas._1X3Adq_center{cursor:crosshair}._1X3Adq_draw-canvas._1X3Adq_picker{cursor:url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+Cjxzdmcgd2lkdGg9IjIwcHgiIGhlaWdodD0iMjBweCIgdmlld0JveD0iMCAwIDIwIDIwIiB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiPgogICAgPCEtLSBHZW5lcmF0b3I6IFNrZXRjaCA0My4yICgzOTA2OSkgLSBodHRwOi8vd3d3LmJvaGVtaWFuY29kaW5nLmNvbS9za2V0Y2ggLS0+CiAgICA8dGl0bGU+ZXllLWRyb3BwZXI8L3RpdGxlPgogICAgPGRlc2M+Q3JlYXRlZCB3aXRoIFNrZXRjaC48L2Rlc2M+CiAgICA8ZGVmcz48L2RlZnM+CiAgICA8ZyBpZD0iUGFnZS0xIiBzdHJva2U9Im5vbmUiIHN0cm9rZS13aWR0aD0iMSIgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIj4KICAgICAgICA8ZyBpZD0iZXllLWRyb3BwZXIiIGZpbGw9IiM1NzVFNzUiPgogICAgICAgICAgICA8cGF0aCBkPSJNOS4xNTMzNDYwNSwxMi40ODI0OTYyIEM5LjAzMzk0MDQ0LDEyLjYxODg3MzcgOC44ODA0MTg5NSwxMi43MDQxMDk2IDguNjA3NDkxODYsMTIuNzcyMjk4MyBDNy45MDgxMTYxOCwxMi45MjU3MjMgNy4yNDI4NTYzOSwxMy41NTY0Njg4IDcuMDM4MTYxMDcsMTQuMjU1NDAzMyBDNi45Njk5MjkzLDE0LjQ3NzAxNjcgNi43NDgxNzYwMywxNC43MTU2NzczIDYuNTA5MzY0ODMsMTQuODM1MDA3NiBMNC43MzUzMzg3MSwxNS42NzAzMTk2IEM0LjY1MDA0OSwxNS43MDQ0MTQgNC41ODE4MTcyMiwxNS43MjE0NjEyIDQuNTQ3NzAxMzQsMTUuNzIxNDYxMiBMNC4yNzQ3NzQyNCwxNS40NjU3NTM0IEM0LjI3NDc3NDI0LDE1LjQ0ODcwNjIgNC4yNzQ3NzQyNCwxNS4zODA1MTc1IDQuMzI1OTQ4MDcsMTUuMjYxMTg3MiBMNS4xNjE3ODczLDEzLjQ3MTIzMjkgQzUuMjY0MTM0OTYsMTMuMjQ5NjE5NSA1LjUwMjk0NjE3LDEzLjAyODAwNjEgNS43NDE3NTczNywxMi45NTk4MTc0IEM2LjQ0MTEzMzA1LDEyLjczODIwNCA3LjA3MjI3Njk2LDEyLjA5MDQxMSA3LjI1OTkxNDMzLDExLjIzODA1MTggQzcuMjk0MDMwMjIsMTEuMTAxNjc0MyA3LjM3OTMxOTk0LDEwLjk2NTI5NjggNy40OTg3MjU1NCwxMC44Mjg5MTkzIEwxMS40MzkxMTA1LDYuOTA4MDY2OTcgTDEzLjA5MzczMSw4LjU2MTY0Mzg0IEw5LjE1MzM0NjA1LDEyLjQ4MjQ5NjIgWiBNMTYuNjA3NjY3Myw1LjI4ODU4NDQ3IEMxNi44NjM1MzY1LDUuMDMyODc2NzEgMTcsNC42NzQ4ODU4NCAxNyw0LjMzMzk0MjE2IEMxNywzLjk5Mjk5ODQ4IDE2Ljg2MzUzNjUsMy42NTIwNTQ3OSAxNi42MDc2NjczLDMuMzk2MzQ3MDMgQzE2LjA3ODg3MTEsMi44Njc4ODQzMiAxNS4yNDMwMzE4LDIuODY3ODg0MzIgMTQuNzE0MjM1NiwzLjM5NjM0NzAzIEwxMy4yMzAxOTQ1LDQuODc5NDUyMDUgTDEzLjA1OTYxNTEsNC43MDg5ODAyMSBMMTIuNTEzNzYwOSw0LjE2MzQ3MDMyIEMxMi4xNzI2MDIsMy44MjI1MjY2NCAxMS42MDk2ODk5LDMuODIyNTI2NjQgMTEuMjY4NTMxLDQuMTYzNDcwMzIgTDEwLjYwMzI3MTIsNC44MTEyNjMzMiBDMTAuMjc5MTcwMyw1LjE1MjIwNyAxMC4yNjIxMTI0LDUuNjQ2NTc1MzQgMTAuNTUyMDk3NCw1Ljk4NzUxOTAzIEw2LjU5NDY1NDU0LDkuOTI1NDE4NTcgQzYuMzA0NjY5NTEsMTAuMjMyMjY3OSA2LjA5OTk3NDE4LDEwLjU5MDI1ODggNS45ODA1Njg1OCwxMS4xMDE2NzQzIEM1LjkyOTM5NDc1LDExLjM1NzM4MiA1LjYzOTQwOTcxLDExLjY0NzE4NDIgNS4zNjY0ODI2MiwxMS43MzI0MjAxIEM0LjgwMzU3MDQ5LDExLjkwMjg5MTkgNC4yNTc3MTYzLDEyLjM4MDIxMzEgNC4wMDE4NDcxNSwxMi45NDI3NzAyIEwzLjE2NjAwNzkyLDE0LjcxNTY3NzMgQzIuODkzMDgwODMsMTUuMzEyMzI4OCAyLjk2MTMxMjYsMTUuOTI2MDI3NCAzLjMzNjU4NzM2LDE2LjMxODExMjYgTDMuNjc3NzQ2MjMsMTYuNjU5MDU2MyBDMy44OTk0OTk0OSwxNi44ODA2Njk3IDQuMjA2NTQyNDcsMTcgNC41NDc3MDEzNCwxNyBDNC43Njk0NTQ2LDE3IDUuMDI1MzIzNzUsMTYuOTMxODExMyA1LjI2NDEzNDk2LDE2LjgyOTUyODIgTDcuMDU1MjE5MDEsMTUuOTk0MjE2MSBDNy42MTgxMzExNCwxNS43MjE0NjEyIDguMDk1NzUzNTYsMTUuMTkyOTk4NSA4LjI2NjMzMjk5LDE0LjYzMDQ0MTQgQzguMzM0NTY0NzcsMTQuMzU3Njg2NSA4LjY0MTYwNzc1LDE0LjA2Nzg4NDMgOS4wNTA5OTgzOSwxMy45ODI2NDg0IEM5LjQwOTIxNTIsMTMuODk3NDEyNSA5Ljc2NzQzMjAxLDEzLjY5Mjg0NjMgMTAuMDU3NDE3LDEzLjM4NTk5NyBMMTQuMDE0ODU5OSw5LjQ0ODA5NzQxIEMxNC4zNTYwMTg4LDkuNzM3ODk5NTQgMTQuODY3NzU3MSw5LjcwMzgwNTE4IDE1LjE3NDgwMDEsOS4zNzk5MDg2OCBMMTUuODQwMDU5OSw4LjczMjExNTY4IEMxNi4xODEyMTg3LDguMzkxMTcxOTkgMTYuMTgxMjE4Nyw3LjgyODYxNDkyIDE1Ljg0MDA1OTksNy40ODc2NzEyMyBMMTUuMjYwMDg5OCw2LjkwODA2Njk3IEwxNS4xMjM2MjYyLDYuNzcxNjg5NSBMMTYuNjA3NjY3Myw1LjI4ODU4NDQ3IFoiIGlkPSJleWUtZHJvcHBlci1pY29uIj48L3BhdGg+CiAgICAgICAgPC9nPgogICAgPC9nPgo8L3N2Zz4=) 4 15,crosshair}._1X3Adq_center-icon{pointer-events:none;filter:opacity(.5);position:absolute;top:0;left:0;transform:translate(-50%,-50%)}._1X3Adq_center-icon._1X3Adq_hidden{display:none}");var t1={centerIcon:"_1X3Adq_center-icon",drawCanvasWrapper:"_1X3Adq_draw-canvas-wrapper",drawBox:"_1X3Adq_draw-box",center:"_1X3Adq_center",picker:"_1X3Adq_picker",hidden:"_1X3Adq_hidden",drawCanvas:"_1X3Adq_draw-canvas"};var p1="./assets/icon-center-bzxv0qgf.svg";import{jsx as m1,jsxs as B5}from"preact/jsx-runtime";function C1({image:t,selectedTool:e,zoom:i,undoList:n,onChange:p,onChangeColor:s}){let o=E5(),[g,C]=y5(),v=(d.DrawWidth-t.width)/2+t.centerX,M=(d.DrawHeight-t.height)/2+t.centerY,A=e.fillColor||new m([0,0,0]),G=e.outlineColor||new m([0,0,0]),_,z,S=()=>{z=g.getImageData(0,0,d.DrawWidth,d.DrawHeight)},f=(r=0,l=0)=>{g.clearRect(0,0,d.DrawWidth,d.DrawHeight),g.putImageData(z,r,l)},Y=()=>{p({data:z}),z=null},W=()=>{let r=new OffscreenCanvas(d.DrawWidth,d.DrawHeight),l=r.getContext("2d",{willReadFrequently:!0});l.imageSmoothingEnabled=!1,l.putImageData(n.at(-1),0,0),z=l.getImageData(0,0,d.DrawWidth,d.DrawHeight),l=null,r=null},P=(r,l)=>{if(r.invalid)return;let c=r.index;z.data[c+0]=l.r,z.data[c+1]=l.g,z.data[c+2]=l.b,z.data[c+3]=l.a===0?0:255},E=(r,l,c,a)=>{P(new d(r.x-l,r.y+c),a),P(new d(r.x+l,r.y+c),a),P(new d(r.x+l,r.y-c),a),P(new d(r.x-l,r.y-c),a),P(new d(r.x-c,r.y+l),a),P(new d(r.x+c,r.y+l),a),P(new d(r.x+c,r.y-l),a),P(new d(r.x-c,r.y-l),a)},N=(r,l,c)=>{let a=Math.abs(l.x-r.x),w=Math.abs(l.y-r.y),k=r.x<l.x?1:-1,B=r.y<l.y?1:-1,D=new d(r.x,r.y),J=a-w;while(!0){if(P(D,c),D.x===l.x&&D.y===l.y)break;let o1=2*J;if(o1>-w)J-=w,D.x+=k;if(o1<a)J+=a,D.y+=B}},h=(r,l,c)=>{let a=r.x,w=l.x,k=r.y,B=l.y;if(c.outline){let D=new d(w,k),J=new d(a,B);N(r,D,c.outline),N(l,J,c.outline),N(D,l,c.outline),N(J,r,c.outline),a+=1,w-=1,k+=1,B-=1}if(c.fill)for(let D=k;D<=B;D++)N(new d(a,D),new d(w,D),c.fill)},F=(r,l,c)=>{let a=0,w=l,k=3-2*l;while(a<=w){if(c.fill)for(let B=a;B<=w;B++)E(r,a,B,c.fill);if(c.outline)E(r,a,w,c.outline);if(k<0)k=k+4*a+6;else k=k+4*(a-w),w--;a++}},b=(r)=>{if(r.invalid)return;let l={clear:A.clear,fill:A.rgb,outline:!1};if(l.clear||e.type==="eraser"){if(l.fill.a=0,!_)l.fill={r:255,g:255,b:255},l.outline={r:138,g:187,b:255}}if(e.penSize===1)P(r,!_&&(l.clear||e.type==="eraser")?l.outline:l.fill);else if(e.penSize===3)h(new d(r.x-1,r.y-1),new d(r.x+1,r.y+1),l);else if(e.penSize<5){let c=e.penSize/2;h(new d(r.x-c,r.y-c),new d(r.x+c-1,r.y+c-1),l)}else F(r,Math.floor((e.penSize-1)/2),l)},y=(r)=>{if(r.invalid)return;let l=new m(Array.from(z.data.slice(r.index,r.index+4))),c=[],a=(w)=>{if(w.invalid)return;if(!c.includes(w.index)){let k=new m(Array.from(z.data.slice(w.index,w.index+4)));if(k.equals(l)&&k.notEquals(A))c.push(w.index)}};a(r);while(c.length>0){let w=c.shift();z.data[w+0]=A.rgb.r,z.data[w+1]=A.rgb.g,z.data[w+2]=A.rgb.b,z.data[w+3]=A.clear?0:255,r=d.from(w),a(r.topPoint),a(r.leftPoint),a(r.rightPoint),a(r.bottomPoint)}},R=(r)=>{if(r.preventDefault(),!o.current)return;_=!0;let l=o.current.getBoundingClientRect(),c=r.clientX-l.left,a=r.clientY-l.top;if(c=Math.floor(d.DrawWidth*c/o.current.clientWidth),a=Math.floor(d.DrawHeight*a/o.current.clientHeight),e.type==="pen"||e.type==="eraser"||e.type==="fill"){let k=new d(c,a);if(S(),e.type==="pen"||e.type==="eraser")b(k);else if(e.type==="fill")y(k);f()}else if(e.type.startsWith("picker-"))r.stopPropagation();else if(e.type.startsWith("center")){let k=d.DrawWidth/2-c,B=d.DrawHeight/2-a;f(k,B),S()}let w=()=>{if(_)_=!1,Y();document.removeEventListener("mouseup",w)};document.addEventListener("mouseup",w)},H=(r)=>{if(r.preventDefault(),!o.current)return;if(e.type==="center")return;let l=o.current.getBoundingClientRect(),c=r.clientX-l.left,a=r.clientY-l.top;if(c=Math.floor(d.DrawWidth*c/o.current.clientWidth),a=Math.floor(d.DrawHeight*a/o.current.clientHeight),e.type==="pen"||e.type==="eraser"){let w=new d(c,a);if(!_)W();else S();b(w),f()}else if(e.type.startsWith("picker-"));},Z=(r)=>{if(r.preventDefault(),_=!1,e.type==="center"){Y();return}let l=o.current.getBoundingClientRect(),c=r.clientX-l.left,a=r.clientY-l.top;if(c=Math.floor(d.DrawWidth*c/o.current.clientWidth),a=Math.floor(d.DrawHeight*a/o.current.clientHeight),e.type.startsWith("picker-")){let[w,k,B,D]=g.getImageData(c,a,1,1).data;if(D===0){if(e.type==="picker-fill")s(new m(A.hsv,!0));if(e.type==="picker-outline")s(new m(G.hsv,!0))}else s(new m({r:w,g:k,b:B}).toHSVColor());return}if(Y(),e.type==="eraser")W(),b(new d(c,a)),f()},Q=(r)=>{if(r.preventDefault(),!_)W(),f()};if(j1(()=>{if(o.current){let r=o.current.getContext("2d",{willReadFrequently:!0});r.imageSmoothingEnabled=!1,C(r)}},[o]),j1(()=>{if(o.current){let r=o.current.parentElement.parentElement,l=(o.current.clientWidth-r.clientWidth)/2,c=(o.current.clientHeight-r.clientHeight)/2;if(i>2){let w=r.clientWidth/2;if(l=(r.scrollLeft+w)/r.dataset.scrollWidth*o.current.clientWidth-w,i>4){let k=r.clientHeight/2;c=(r.scrollTop+k)/r.dataset.scrollHeight*o.current.clientHeight-k}}r.dataset.scrollWidth=o.current.clientWidth,r.dataset.scrollHeight=o.current.clientHeight,r.scroll({top:c>0?c:0,left:l>0?l:0});let a=o.current.nextSibling;a.style.top=`${i*d.DrawHeight/2}px`,a.style.left=`${i*d.DrawWidth/2}px`}},[i]),g&&n.length===0)if(t)f1(t).then((r)=>{let l=d.DrawWidth/2-t.centerX,c=d.DrawHeight/2-t.centerY;g.clearRect(0,0,d.DrawWidth,d.DrawHeight),g.drawImage(r,l,c),S(),Y()});else S(),Y();if(g&&n.length>0)W(),f();return m1("div",{className:t1.drawBox,children:B5("div",{className:t1.drawCanvasWrapper,children:[m1("canvas",{ref:o,className:Z1(t1.drawCanvas,{[t1.center]:e.type==="center",[t1.picker]:e.type.startsWith("picker-")}),width:d.DrawWidth,height:d.DrawHeight,style:{width:d.DrawWidth*i,height:d.DrawHeight*i},onMouseDown:R,onMouseMove:H,onMouseUp:Z,onMouseLeave:Q}),m1("img",{src:p1,className:Z1(t1.centerIcon,{[t1.hidden]:e.type!=="center"})})]})})}U(".KOzPOa_painter-wrapper{padding:calc(var(--space)*1.5);border-left:1px solid var(--ui-black-transparent);color:var(--text-primary);flex-direction:column;flex:1;display:flex}.KOzPOa_row{min-height:3rem;margin-bottom:.5rem;display:flex}.KOzPOa_row-fill{padding-top:calc(var(--space)*2.5);border-top:1px dashed var(--ui-black-transparent);flex-direction:row;flex:1}.KOzPOa_row-bottom{margin-right:var(--space);margin-left:calc(7em + var(--space));justify-content:space-between}.KOzPOa_row:last-child{min-height:unset;margin-bottom:0}.KOzPOa_tool-group{margin-right:calc(var(--space)*1.5);flex-direction:row;align-items:center;display:inline-flex}.KOzPOa_disabled{opacity:.3;pointer-events:none}.KOzPOa_dashed-border{border-right:1px dashed var(--ui-black-transparent);padding-right:var(--space)}.KOzPOa_name-input{width:8rem}.KOzPOa_large-input{width:4rem}.KOzPOa_tool-icon{margin-right:var(--space);width:2rem;height:2rem}.KOzPOa_label-image{vertical-align:middle;margin-right:calc(var(--space)/2)}.KOzPOa_button{width:calc(2rem + 2px);height:calc(2rem + 2px);padding:.375rem}.KOzPOa_text-button{height:calc(2rem + 2px);padding:.375rem}.KOzPOa_button-icon{width:1.5rem;margin:auto}.KOzPOa_simple-group{display:inline-flex}.KOzPOa_group-button{border-left:none;border-radius:0}.KOzPOa_group-button-first{border-top-right-radius:0;border-bottom-right-radius:0}.KOzPOa_group-button-last{border-left:none;border-top-left-radius:0;border-bottom-left-radius:0}.KOzPOa_group-button-toggled-off{filter:saturate(0)}.KOzPOa_label-button{border:0;font-weight:400}.KOzPOa_label-button.KOzPOa_selected{background:var(--motion-primary);color:var(--ui-white)}.KOzPOa_label-button.KOzPOa_selected .KOzPOa_button-icon{filter:brightness(0)invert()}.KOzPOa_draw-box-wrapper{margin:0 var(--space);border:1px solid var(--ui-black-transparent);border-radius:calc(var(--space)/2);flex:1;position:relative;overflow:hidden}");var u={dashedBorder:"KOzPOa_dashed-border",largeInput:"KOzPOa_large-input",groupButtonToggledOff:"KOzPOa_group-button-toggled-off",painterWrapper:"KOzPOa_painter-wrapper",textButton:"KOzPOa_text-button",toolGroup:"KOzPOa_tool-group",groupButton:"KOzPOa_group-button",labelImage:"KOzPOa_label-image",groupButtonLast:"KOzPOa_group-button-last",labelButton:"KOzPOa_label-button",row:"KOzPOa_row",drawBoxWrapper:"KOzPOa_draw-box-wrapper",toolIcon:"KOzPOa_tool-icon",rowFill:"KOzPOa_row-fill",rowBottom:"KOzPOa_row-bottom",nameInput:"KOzPOa_name-input",button:"KOzPOa_button",buttonIcon:"KOzPOa_button-icon",simpleGroup:"KOzPOa_simple-group",disabled:"KOzPOa_disabled",groupButtonFirst:"KOzPOa_group-button-first",selected:"KOzPOa_selected"};var Q1="./assets/icon-undo-q4nwvpxj.svg";var K1="./assets/icon-redo-mrvqwv38.svg";var G1="./assets/icon-zoom-in-s316e3qy.svg";var R1="./assets/icon-zoom-out-y9xmwx8c.svg";var H1="./assets/icon-zoom-reset-xne8n5sw.svg";import{jsx as L,jsxs as K}from"preact/jsx-runtime";var X1=(t,e=0,i=1/0)=>{return Math.min(Math.max(e,t),i)};function L1({mode:t,imageList:e,imageIndex:i}){let{getText:n,maybeLocaleText:p}=j5(),{modifyAsset:s}=Z5(),[o,g]=q(1),[C,v]=q("draw"),[M,A]=q("pen"),[G,_]=q(10),[z,S]=q(2),[f,Y]=q(new m([260,0.6,1])),[W,P]=q(new m([0,1,0])),[E,N]=q([]),[h,F]=q([]),b=e[i],y=b&&b.id,R=!y,H=(a,w,k)=>{if(t==="costume")return w;if(t==="backdrop")return k;return a},Z=(a)=>{if(a.id=y,a.data){let{type:w,data:k,width:B,height:D,centerX:J,centerY:o1}=E1(a.data);a.type=w,a.data=k,a.width=B,a.height=D,a.centerX=J,a.centerY=o1}s(a)},Q=(a)=>{if(a.data){if(E.length>20)E.splice(1,1);if(N(E.concat(a.data)),F([]),E.length===0)return}if(Z(a),C!=="draw")v("draw")},r=(a)=>{if(C==="picker-fill")Y(a);if(C==="picker-outline")P(a)},l=()=>{let a=E.pop();N(E),F(h.concat(a)),Z({data:E.at(-1)})},c=()=>{let a=h.pop();N(E.concat(a)),F(h),Z({data:a})};return U5(()=>{return N([]),F([]),v("draw"),()=>{}},[y]),K("div",{className:u.painterWrapper,children:[K("div",{className:u.row,children:[L("div",{className:u.toolGroup,children:L(x1,{text:H(n("pixelPaint.painter.image","Image"),n("pixelPaint.painter.costume","Costume"),n("pixelPaint.painter.backdrop","Backdrop")),children:L(k1,{disabled:R,className:u.nameInput,placeholder:n("pixelPaint.painter.name","name"),onSubmit:(a)=>Q({name:a}),value:b?p(b.name):H(n("pixelPaint.painter.image","Image"),n("pixelPaint.painter.costume","Costume"),n("pixelPaint.painter.backdrop","Backdrop"))})})}),K("div",{className:u.toolGroup,children:[L(n1,{disabled:E.length<=1,className:j(u.button,u.groupButtonFirst,{[u.groupButtonToggledOff]:R}),onClick:l,children:L("img",{src:Q1,className:u.buttonIcon,title:n("pixelPaint.painter.undo","Undo")})}),L(n1,{disabled:h.length===0,className:j(u.button,u.groupButtonLast,{[u.groupButtonToggledOff]:R}),onClick:c,children:L("img",{src:K1,className:u.buttonIcon,title:n("pixelPaint.painter.redo","Redo")})})]}),L("div",{className:u.toolGroup,children:t==="costume"&&K(n1,{vertical:!0,className:j(u.labelButton,{[u.selected]:C==="center"}),onClick:()=>v(C!=="center"?"center":"draw"),children:[L("img",{src:p1,className:u.buttonIcon,title:n("pixelPaint.painter.center","Center")}),L("span",{children:n("pixelPaint.painter.center","Center")})]})})]}),K("div",{className:u.row,children:[L("div",{className:u.toolGroup,children:L(x1,{className:j({[u.disabled]:M==="eraser"}),text:n("pixelPaint.painter.fill","Fill"),children:L(c1,{picking:C.startsWith("picker-"),color:f,onChange:Y,onPickColor:(a)=>v(a===!1?"draw":"picker-fill")})})}),K("div",{className:j(u.toolGroup,u.dashedBorder),children:[L(x1,{className:j({[u.disabled]:!0}),text:n("pixelPaint.painter.outline","Outline"),children:L(c1,{outline:!0,picking:C.startsWith("picker-"),color:W,onChange:P,onPickColor:(a)=>v(a===!1?"draw":"picker-outline")})}),L(k1,{small:!0,type:"number",className:j(u.largeInput,{[u.disabled]:!0}),value:z,onSubmit:(a)=>S(X1(a,0,100))})]}),M==="pen"||M==="eraser"?K("div",{className:u.toolGroup,children:[L("img",{src:M==="pen"?d1:s1,className:u.toolIcon}),L(k1,{small:!0,type:"number",className:u.largeInput,value:G,onSubmit:(a)=>_(X1(a,1,100))})]}):null]}),K("div",{className:j(u.row,u.rowFill),children:[L(M1,{selectedTool:M,onSelect:A}),L("div",{className:u.drawBoxWrapper,children:L(C1,{image:b,zoom:o,selectedTool:{fillColor:f,outlineColor:W,penSize:G,outlineSize:z,type:C==="draw"?M:C},undoList:E,onChange:(a)=>Q(a),onChangeColor:r})})]}),K("div",{className:j(u.row,u.rowBottom),children:[L("div",{className:u.simpleGroup,children:t==="backdrop"&&L(n1,{disabled:!0,className:u.textButton,children:L(Q5,{id:"pixelPaint.mode.tileMap",defaultMessage:"Convert to TileMap"})})}),K("div",{className:u.simpleGroup,children:[L(n1,{className:j(u.button,u.groupButtonFirst),onClick:()=>o-1>0&&g(o-1),children:L("img",{src:R1,className:u.buttonIcon})}),L(n1,{className:j(u.button,u.groupButton),onClick:()=>g(1),children:L("img",{src:H1,className:u.buttonIcon})}),L(n1,{className:j(u.button,u.groupButtonLast),onClick:()=>o+1<20&&g(o+1),children:L("img",{src:G1,className:u.buttonIcon})})]})]})]})}U(".gJa9lW_pixel-paint-wrapper{background:var(--ui-white);border-radius:inherit;flex-grow:1;display:flex}");var q1={pixelPaintWrapper:"gJa9lW_pixel-paint-wrapper"};import{jsx as J1,jsxs as R5}from"preact/jsx-runtime";function G5({onSetupLibrary:t}){let{fileList:e,assetList:i,selectedFileId:n}=K5(),p=i.filter((g)=>/^image\//.test(g.type)),s="image",o=e.find((g)=>g.id===n);if(o&&o.assets&&o.frame!=null)p=p.filter((g)=>o.assets.includes(g.id)),s=n===e[0].id?"backdrop":"costume";return R5("div",{className:q1.pixelPaintWrapper,children:[J1(w1,{mode:s,imageList:p,imageIndex:o.frame,onSetupLibrary:t}),J1(L1,{mode:s,imageIndex:o.frame,imageList:p})]})}var $1={"pixelPaint.contextMenu.duplicate":"duplicate","pixelPaint.contextMenu.export":"export","pixelPaint.contextMenu.delete":"delete","pixelPaint.actionButton.upload":"Upload Image","pixelPaint.actionButton.uploadCostume":"Upload Costume","pixelPaint.actionButton.uploadBackdrop":"Upload Backdrop","pixelPaint.actionButton.uploadError":'Upload "{file}" failed.',"pixelPaint.actionButton.surprise":"Surprise","pixelPaint.actionButton.paint":"Paint","pixelPaint.actionButton.image":"Choose a Image","pixelPaint.actionButton.costume":"Choose a Costume","pixelPaint.actionButton.backdrop":"Choose a Backdrop","pixelPaint.painter.image":"Image","pixelPaint.painter.costume":"Costume","pixelPaint.painter.backdrop":"Backdrop","pixelPaint.painter.name":"name","pixelPaint.painter.undo":"Undo","pixelPaint.painter.redo":"Redo","pixelPaint.painter.pen":"Pen","pixelPaint.painter.eraser":"Eraser","pixelPaint.painter.fill":"Fill","pixelPaint.painter.text":"Text","pixelPaint.painter.line":"Line","pixelPaint.painter.rectangle":"Rectangle","pixelPaint.painter.circle":"Circle","pixelPaint.painter.select":"Select","pixelPaint.painter.center":"Center","pixelPaint.painter.outline":"Outline","pixelPaint.colorPicker.color":"Color","pixelPaint.colorPicker.saturation":"Saturation","pixelPaint.colorPicker.brightness":"Brightness","pixelPaint.mode.pixel":"Convert to Bitmap","pixelPaint.mode.tileMap":"Convert to TileMap"};var V1={"pixelPaint.contextMenu.duplicate":"复制","pixelPaint.contextMenu.export":"导出","pixelPaint.contextMenu.delete":"删除","pixelPaint.actionButton.upload":"上传图片","pixelPaint.actionButton.uploadCostume":"上传造型","pixelPaint.actionButton.uploadBackdrop":"上传背景","pixelPaint.actionButton.uploadError":"上传“{file}”失败。","pixelPaint.actionButton.surprise":"随机","pixelPaint.actionButton.paint":"绘制","pixelPaint.actionButton.image":"选择一个图片","pixelPaint.actionButton.costume":"选择一个造型","pixelPaint.actionButton.backdrop":"选择一个背景","pixelPaint.painter.image":"图片","pixelPaint.painter.costume":"造型","pixelPaint.painter.backdrop":"背景","pixelPaint.painter.name":"名字","pixelPaint.painter.undo":"撤销","pixelPaint.painter.redo":"重做","pixelPaint.painter.pen":"画笔","pixelPaint.painter.eraser":"橡皮擦","pixelPaint.painter.fill":"填充","pixelPaint.painter.text":"文本","pixelPaint.painter.line":"线段","pixelPaint.painter.rectangle":"矩形","pixelPaint.painter.circle":"圆形","pixelPaint.painter.select":"选择","pixelPaint.painter.center":"中心","pixelPaint.painter.outline":"轮廓","pixelPaint.colorPicker.color":"颜色","pixelPaint.colorPicker.saturation":"饱和度","pixelPaint.colorPicker.brightness":"亮度","pixelPaint.mode.pixel":"转换为位图","pixelPaint.mode.tileMap":"转换为 TileMap"};var e4={en:$1,"zh-Hans":V1};export{e4 as locales,G5 as PixelPaint};
