import{useEditor as Z5}from"@blockcode/core";import{useState as d1}from"preact/hooks";import{useLocale as r5,useLayout as n5,useEditor as a5}from"@blockcode/core";import{IconSelector as l5,ActionButton as s5}from"@blockcode/ui";class d{static get DrawWidth(){return 320}static get DrawHeight(){return 240}static from(t){const e=t>>2,i=Math.floor(e/320),n=e-i*320;return new d(n,i)}constructor(t,e){this.setXY(t,e)}get x(){return this._x}set x(t){this._x=t,this._index=this.x+this.y*320<<2}get y(){return this._y}set y(t){this._y=t,this._index=this.x+this.y*320<<2}get index(){return this._index}get valid(){return this.x>=0&&this.x<320&&this.y>=0&&this.y<240}get invalid(){return!this.valid}get topPoint(){return new d(this.x,this.y-1)}get leftPoint(){return new d(this.x-1,this.y)}get rightPoint(){return new d(this.x+1,this.y)}get bottomPoint(){return new d(this.x,this.y+1)}get topLeftPoint(){return new d(this.x-1,this.y-1)}get topRightPoint(){return new d(this.x+1,this.y-1)}get bottomLeftPoint(){return new d(this.x-1,this.y+1)}get bottomRightPoint(){return new d(this.x+1,this.y+1)}setXY(t,e){return this._x=t,this._y=e,this._index=this.x+this.y*320<<2,this}equals(t){return this.x==t.x&&this.y==t.y}}function k1(t){return new Promise(async(e)=>{const i=new FileReader;i.readAsDataURL(t),i.addEventListener("load",()=>{const n=new Image;n.src=i.result,n.addEventListener("load",()=>{if(n.dataset.data){e(n);return}let{width:p,height:h}=n;if(n.width>d.DrawWidth||n.height>d.DrawHeight){p=d.DrawWidth,h=d.DrawHeight;const C=n.width/d.DrawWidth,m=n.height/d.DrawHeight;if(C>m)h=n.height/C;else p=n.width/m}const l=document.createElement("canvas");l.width=p,l.height=h,l.getContext("2d").drawImage(n,0,0,p,h);const k=l.toDataURL("image/png");if(k===q1){e(null);return}n.dataset.data=k.slice(C1),n.src=k})})})}function L1(t){return new Promise(async(e)=>{const i=new Image;let n="image/png";if(typeof t==="string")i.src=t;else n=t.type,i.src=`data:${n};base64,${t.data}`;i.addEventListener("load",()=>{i.dataset.data=i.src.slice(`data:${n};base64,`.length),e(i)})})}function v1(t){return new Promise(async(e)=>{const i=new Image;i.src=t,i.addEventListener("load",()=>{const n=document.createElement("canvas");n.width=i.width,n.height=i.height,n.getContext("2d").drawImage(i,0,0,i.width,i.height);const h=n.toDataURL("image/png");i.dataset.data=h.slice(C1),e(i)})})}var C1="data:image/png;base64,".length,q1="data:,";function t1(t=32){const e=[];for(let i=0;i<t;i++)e[i]="0123456789abcdefghijklmnopqrstuvwxyz".charAt(Math.random()*"0123456789abcdefghijklmnopqrstuvwxyz".length);return e.join("")}function W(t){const e=globalThis.document,i=e.createElement("style");i.appendChild(e.createTextNode(t)),e.head.append(i)}W(".K-gn7q_selector-wrapper{background:var(--ui-secondary);width:150px;position:relative}.K-gn7q_selector-items-wrapper{width:150px;min-height:100%;padding-bottom:100px}.K-gn7q_selector-item{width:5rem;height:5rem;margin:.5rem auto}.K-gn7q_delete-menu-item:hover{background:var(--error-primary)}.K-gn7q_add-button-wrapper{background:linear-gradient(transparent,var(--ui-secondary));width:100%;height:100px;display:flex;position:absolute;bottom:0;left:0;right:0}.K-gn7q_add-button{margin:.75rem auto}");var e1={addButtonWrapper:"K-gn7q_add-button-wrapper",selectorItem:"K-gn7q_selector-item",selectorItemsWrapper:"K-gn7q_selector-items-wrapper",selectorWrapper:"K-gn7q_selector-wrapper",deleteMenuItem:"K-gn7q_delete-menu-item",addButton:"K-gn7q_add-button"};var N1="./assets/icon-sprite-zx9m3hdh.svg";var f1="./assets/icon-backdrop-qvqgzqwj.svg";var I1="./assets/icon-surprise-d5t4529a.svg";var A1="./assets/icon-search-6g8kgvdt.svg";var D1="./assets/icon-paint-0h8zs19a.svg";var z1="./assets/icon-file-upload-0z25chr6.svg";import{jsx as n1,jsxs as o5}from"preact/jsx-runtime";function h1({mode:t,imageList:e,imageIndex:i,onSetupLibrary:n}){const[p,h]=d1(!1),[l,u]=d1(!1),[k,C]=d1(!1),{getText:m}=r5(),{createAlert:I,removeAlert:O}=n5(),{addAsset:y,deleteAsset:T,modifyFile:B}=a5(),A=e.map((a)=>a.id),{ImagesLibrary:_,BackdropsLibrary:U,CostumesLibrary:Y}=n(),j=()=>{if(t==="costume"){h(!1),u(!0),C(!1);return}if(t==="backdrop"){h(!1),u(!1),C(!0);return}h(!0),u(!1),C(!1)},z=()=>{h(!1),u(!1),C(!1)},w=async({tags:a,...g})=>{const s=t1();I("importing",{id:s});const L=await v1(`./assets/${g.id}.png`);y({...g,id:s,type:"image/png",data:L.dataset.data,width:L.width,height:L.height}),A.push(s),O(s),B({assets:A,frame:A.length-1})},F=()=>{if(t==="costume"){w(Y.surprise());return}if(t==="backdrop"){w(U.surprise());return}w(_.surprise())},P=(a,g,s)=>{if(t==="costume")return g;if(t==="backdrop")return s;return a},E=(a)=>`data:${a.type};base64,${a.data}`,R=(a)=>{B({frame:a})},G=()=>{const a=document.createElement("input");a.type="file",a.accept="image/*",a.multiple=!0,a.click(),a.addEventListener("change",async({target:g})=>{const s=t1();I("importing",{id:s});for(let L of g.files){const D=t1(),q=L.name.slice(0,L.name.lastIndexOf("."));let Q=await k1(L);if(Q)I({message:m("pixelPaint.actionButton.uploadError",'Upload "{file}" failed.',{file:L.name})},2000),Q={dataset:{data:"iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAAtJREFUGFdjYAACAAAFAAGq1chRAAAAAElFTkSuQmCC"},width:1,height:1};y({id:D,type:"image/png",name:q,data:Q.dataset.data,width:Q.width,height:Q.height,centerX:Math.floor(Q.width/2),centerY:Math.floor(Q.height/2)}),A.push(D)}O(s),B({assets:A,frame:A.length-1})})},r=()=>{const a=t1();y({id:a,type:"image/png",name:m(`pixelPaint.painter.${t}`,t),data:"iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAAtJREFUGFdjYAACAAAFAAGq1chRAAAAAElFTkSuQmCC",width:1,height:1,centerX:1,centerY:1}),A.push(a),B({assets:A,frame:A.length-1})},o=(a)=>{T(A[a]),A.splice(a,1),B({assets:A,frame:i===0?0:a>i?i:i-1})},c=(a)=>{const g=e[a],s=t1();y({...g,id:s}),A.push(s),B({assets:A,frame:A.length-1})};return o5("div",{className:e1.selectorWrapper,children:[n1(l5,{displayOrder:!0,id:"paint-selector",className:e1.selectorItemsWrapper,items:e.map((a,g)=>({...a,details:`${a.width}\xD7${a.height}`,icon:E(a),order:g,className:e1.selectorItem,contextMenu:[[{label:m("pixelPaint.contextMenu.duplicate","duplicate"),onClick:()=>c(g)},{label:m("pixelPaint.contextMenu.export","export"),disabled:!0}],[{label:m("pixelPaint.contextMenu.delete","delete"),className:e1.deleteMenuItem,disabled:e.length<=1,onClick:()=>o(g)}]]})),selectedIndex:i,onSelect:R,onDelete:e.length>1&&o}),n1("div",{className:e1.addButtonWrapper,children:n1(s5,{tooltipPlacement:"right",className:e1.addButton,icon:t==="costume"?N1:f1,tooltip:P(m("pixelPaint.actionButton.image","Choose a Image"),m("pixelPaint.actionButton.costume","Choose a Costume"),m("pixelPaint.actionButton.backdrop","Choose a Backdrop")),onClick:j,moreButtons:[{icon:z1,tooltip:P(m("pixelPaint.actionButton.upload","Upload Image"),m("pixelPaint.actionButton.uploadCostume","Upload Costume"),m("pixelPaint.actionButton.uploadBackdrop","Upload Backdrop")),onClick:G},{icon:I1,tooltip:m("pixelPaint.actionButton.surprise","Surprise"),onClick:F},{icon:D1,tooltip:m("pixelPaint.actionButton.paint","Paint"),onClick:r},{icon:A1,tooltip:P(m("pixelPaint.actionButton.image","Choose a Image"),m("pixelPaint.actionButton.costume","Choose a Costume"),m("pixelPaint.actionButton.backdrop","Choose a Backdrop")),onClick:j}]})}),p&&_&&n1(_,{onClose:z,onSelect:w}),l&&Y&&n1(Y,{onClose:z,onSelect:w}),k&&U&&n1(U,{onClose:z,onSelect:w})]})}import{useEffect as S5,useState as X}from"preact/hooks";import{useLocale as Y5,useEditor as F5}from"@blockcode/core";import{classNames as Z,Text as T5,Label as m1,BufferedInput as W5,Input as K1,Button as r1}from"@blockcode/ui";class M{static decimalToHex(t){if(t<0)t+=16777216;let e=Number(t).toString(16);return e=`#${"000000".substr(0,6-e.length)}${e}`,e}static decimalToRgb(t){const e=t>>24&255,i=t>>16&255,n=t>>8&255,p=t&255;return{r:i,g:n,b:p,a:e>0?e:255}}static hexToRgb(t){const e=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;t=t.replace(e,(n,p,h,l)=>p+p+h+h+l+l);const i=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return i?{r:parseInt(i[1],16),g:parseInt(i[2],16),b:parseInt(i[3],16)}:null}static rgbToHex(t){return M.decimalToHex(M.rgbToDecimal(t))}static rgbToDecimal(t){return(t.r<<16)+(t.g<<8)+t.b}static hexToDecimal(t){return M.rgbToDecimal(M.hexToRgb(t))}static hsvToRgb(t){let e=t.h%360;if(e<0)e+=360;const i=Math.max(0,Math.min(t.s,1)),n=Math.max(0,Math.min(t.v,1)),p=Math.floor(e/60),h=e/60-p,l=n*(1-i),u=n*(1-i*h),k=n*(1-i*(1-h));let C,m,I;switch(p){default:case 0:C=n,m=k,I=l;break;case 1:C=u,m=n,I=l;break;case 2:C=l,m=n,I=k;break;case 3:C=l,m=u,I=n;break;case 4:C=k,m=l,I=n;break;case 5:C=n,m=l,I=u;break}return{r:Math.floor(C*255),g:Math.floor(m*255),b:Math.floor(I*255)}}static rgbToHsv(t){const e=t.r/255,i=t.g/255,n=t.b/255,p=Math.min(Math.min(e,i),n),h=Math.max(Math.max(e,i),n);let l=0,u=0;if(p!==h){const k=e===p?i-n:i===p?n-e:e-i;l=((e===p?3:i===p?5:1)-k/(h-p))*60%360,u=(h-p)/h}return{h:l,s:u,v:h}}static mixRgb(t,e,i){if(i<=0)return t;if(i>=1)return e;const n=1-i;return{r:n*t.r+i*e.r,g:n*t.g+i*e.g,b:n*t.b+i*e.b}}constructor(t,e=!1){if(this._clear=e,this._color=t,typeof t==="number")this._type="decimal";else if(typeof t==="string"&&t[0]==="#")this._type="hex";else if(Array.isArray(t)){const[i,n,p]=t;if(n<=1&&p<=1)this._type="hsv",this._color={h:i,s:n,v:p};else this._type="rgb",this._color={r:i,g:n,b:p};this._clear=e||t[3]===0}else if(typeof t.r==="number")this._type="rgb";else if(typeof t.h==="number")this._type="hsv"}get clear(){return this._clear}get rgb(){if(this._type==="rgb")return this._color;if(this._type==="decimal")return M.decimalToRgb(this._color);if(this._type==="hsv")return M.hsvToRgb(this._color);if(this._type==="hex")return M.hexToRgb(this._color)}get hsv(){if(this._type==="hsv")return this._color;if(this._type==="decimal")return M.rgbToHsv(M.decimalToRgb(this._color));if(this._type==="rgb")return M.rgbToHsv(this._color);if(this._type==="hex")return M.rgbToHsv(M.hexToRgb(this._color))}get hex(){if(this._type==="hex")return this._color;if(this._type==="decimal")return M.decimalToHex(this._color);if(this._type==="rgb")return M.rgbToHex(this._color);if(this._type==="hsv")return M.rgbToHex(M.hsvToRgb(this._color))}get decimal(){if(this._type==="decimal")this._color;if(this._type==="rgb")return M.rgbToDecimal(this._color);if(this._type==="hsv")return M.rgbToDecimal(M.hsvToRgb(this._color));if(this._type==="hex")return M.hexToDecimal(this._color)}toRGBColor(){if(this._type==="rgb")return this;return new M(this.rgb,this.clear)}toHSVColor(){if(this._type==="hsv")return this;return new M(this.hsv,this.clear)}toHEXColor(){if(this._type==="hex")return this;return new M(this.hex,this.clear)}toDecimalColor(){if(this._type==="decimal")return this;return new M(this.decimal,this.clear)}equals(t){return this.rgb.r===t.rgb.r&&this.rgb.g===t.rgb.g&&this.rgb.b===t.rgb.b&&this.clear===t.clear}notEquals(t){return!this.equals(t)}}function O1(t){const e=c5(t),i=d5(t,e),n=h5(t,e,i),p=p5(t,e,i,n),h={top:e||0,left:n||0,right:p||0,bottom:i||0};return h.width=h.right-h.left+1,h.height=h.bottom-h.top+1,h}var c5=(t)=>{let e;for(let i=0;i<t.height;i++){e=i*t.width;for(let n=0;n<t.width;n++){if(t.data[(e<<2)+3]!==0)return i;e++}}},d5=(t,e)=>{let i;for(let n=t.height-1;n>=e;n--){i=n*t.width;for(let p=0;p<t.width;p++){if(t.data[(i<<2)+3]!==0)return n;i++}}},h5=(t,e,i)=>{let n;for(let p=0;p<t.width;p++)for(let h=e;h<=i;h++)if(n=h*t.width+p,t.data[(n<<2)+3]!==0)return p},p5=(t,e,i,n)=>{let p;for(let h=t.width-1;h>=n;h--)for(let l=e;l<=i;l++)if(p=l*t.width+h,t.data[(p<<2)+3]!==0)return h};function b1(t){const{top:e,left:i,width:n,height:p}=O1(t),h=Math.floor(t.width/2-i),l=Math.floor(t.height/2-e),u=document.createElement("canvas");u.width=n,u.height=p,u.getContext("2d").putImageData(t,-i,-e,i,e,n,p);const[C,m]=u.toDataURL().slice(5).split(";base64,");return{type:C,data:m,width:n,height:p,centerX:h,centerY:l}}import{classNames as i1,Text as w1,Tooltip as u5}from"@blockcode/ui";W("._Y2YyW_color-picker-wrapper{margin-right:var(--space);cursor:pointer;width:3rem;height:2rem;display:flex}._Y2YyW_color-swatch{border:1px solid var(--ui-black-transparent);border-top-left-radius:var(--form-radius);border-bottom-left-radius:var(--form-radius);flex-shrink:0;flex-basis:2rem;height:100%;display:flex;position:relative}._Y2YyW_color-swatch-outline:after{content:\"\";background:var(--ui-white);border:1px solid var(--ui-black-transparent);z-index:1;width:.75rem;height:.75rem;position:absolute;top:.5rem;left:.5rem}._Y2YyW_picker-arrow{user-select:none;border:1px solid var(--ui-black-transparent);border-top-right-radius:var(--form-radius);border-bottom-right-radius:var(--form-radius);border-left:0;flex-shrink:0;flex-basis:1rem;justify-content:center;align-items:center;height:100%;font-size:.75rem;display:flex}._Y2YyW_color-tooltip{background:var(--ui-white);color:var(--text-primary);padding:calc(var(--space)/2)}._Y2YyW_tooltip-item{margin:8px}._Y2YyW_tooltip-item-label{font-weight:700}._Y2YyW_tooltip-item-readout{margin-left:10px}._Y2YyW_tooltip-item-slider{border-radius:11px;outline:none;width:150px;height:22px;margin-bottom:20px;position:relative}._Y2YyW_tooltip-item-slider-handler{background-color:var(--ui-white);box-shadow:0 0 0 4px var(--ui-black-transparent);touch-action:none;border-radius:100%;width:26px;height:26px;margin-top:-2px;position:absolute;left:100px}._Y2YyW_tooltip-item-toolbar{justify-content:space-between;display:flex}._Y2YyW_tooltip-item-toolbar-button{border:1px solid var(--ui-black-transparent);border-radius:var(--form-radius);cursor:pointer;width:calc(1.5rem + 2px);height:calc(1.5rem + 2px)}._Y2YyW_tooltip-item-toolbar-button._Y2YyW_selected{border:1px solid #855cd6;box-shadow:0 0 0 3px #855cd659}._Y2YyW_button-icon{width:1.5rem;height:1.5rem}");var v={colorPickerWrapper:"_Y2YyW_color-picker-wrapper",pickerArrow:"_Y2YyW_picker-arrow",tooltipItemLabel:"_Y2YyW_tooltip-item-label",tooltipItemReadout:"_Y2YyW_tooltip-item-readout",tooltipItemToolbar:"_Y2YyW_tooltip-item-toolbar",colorSwatch:"_Y2YyW_color-swatch",colorTooltip:"_Y2YyW_color-tooltip",tooltipItemSlider:"_Y2YyW_tooltip-item-slider",buttonIcon:"_Y2YyW_button-icon",tooltipItemToolbarButton:"_Y2YyW_tooltip-item-toolbar-button",selected:"_Y2YyW_selected",colorSwatchOutline:"_Y2YyW_color-swatch-outline",tooltipItemSliderHandler:"_Y2YyW_tooltip-item-slider-handler",tooltipItem:"_Y2YyW_tooltip-item"};var _1="./assets/icon-picker-2frmfa34.svg";var p1="./assets/icon-clear-gctr9axd.svg";import{jsx as b,jsxs as a1,Fragment as m5}from"preact/jsx-runtime";var x5=[0,0,324,288,252,216,180,144,108,72,36,0,0],H=124;function l1({picking:t,color:e,outline:i,onChange:n,onPickColor:p}){const h=e.hsv.h,l=e.hsv.s,u=e.hsv.v,k=(w,F,P,E)=>new M({h:w,s:F,v:P},E),C=(w)=>n(k(Math.round(w*360),l,u)),m=(w)=>n(k(h,w,u)),I=(w)=>n(k(h,l,w)),O=()=>n(k(h,l,u,!0)),y=(w,F)=>{w.stopPropagation();const P=w.target,E=P.offsetLeft,R=w.clientX,G=(o)=>{o.preventDefault();let c=o.clientX-R+E;if(c>=H)c=H;if(c<=0)c=0;P.style.left=`${c}px`,F(c/H)},r=()=>{document.removeEventListener("mousemove",G),document.removeEventListener("mouseup",r)};document.addEventListener("mousemove",G),document.addEventListener("mouseup",r)},T=(w)=>y(w,C),B=(w)=>y(w,m),A=(w)=>y(w,I),_=(w,F)=>{const P=w.target.children[0];let E=w.offsetX-13;if(E>=H)E=H;if(E<=0)E=0;P.style.left=`${E}px`,F(E/H)},U=(w)=>_(w,C),Y=(w)=>_(w,m),j=(w)=>_(w,I),z=x5.map((w)=>k(w,l,u).hex);return b(u5,{clickable:!0,placement:"bottom",className:v.colorTooltip,onHide:()=>p(!1),content:a1(m5,{children:[a1("div",{className:v.tooltipItem,children:[b("span",{className:v.tooltipItemLabel,children:b(w1,{id:"pixelPaint.colorPicker.color",defaultMessage:"Color"})}),b("span",{className:v.tooltipItemReadout,children:Math.round(h/360*100)})]}),b("div",{className:i1(v.tooltipItem,v.tooltipItemSlider),style:{background:`linear-gradient(to left, ${z[0]} 0px, ${z[1]} 13px, ${z[2]}, ${z[3]}, ${z[4]}, ${z[5]}, ${z[6]}, ${z[7]}, ${z[8]}, ${z[9]}, ${z[10]}, ${z[11]} 137px, ${z[12]} 100%)`},onClick:U,children:b("div",{className:v.tooltipItemSliderHandler,style:{left:`${Math.round(h/360*H)}px`},onMouseDown:T,onClick:(w)=>w.stopPropagation()})}),a1("div",{className:v.tooltipItem,children:[b("span",{className:v.tooltipItemLabel,children:b(w1,{id:"pixelPaint.colorPicker.saturation",defaultMessage:"Saturation"})}),b("span",{className:v.tooltipItemReadout,children:Math.round(l*100)})]}),b("div",{className:i1(v.tooltipItem,v.tooltipItemSlider),style:{background:`linear-gradient(to right, ${k(h,0,u).hex} 0px, ${k(h,1,u).hex} 100%)`},onClick:Y,children:b("div",{className:v.tooltipItemSliderHandler,style:{left:`${Math.round(l*H)}px`},onMouseDown:B,onClick:(w)=>w.stopPropagation()})}),a1("div",{className:v.tooltipItem,children:[b("span",{className:v.tooltipItemLabel,children:b(w1,{id:"pixelPaint.colorPicker.brightness",defaultMessage:"Brightness"})}),b("span",{className:v.tooltipItemReadout,children:Math.round(u*100)})]}),b("div",{className:i1(v.tooltipItem,v.tooltipItemSlider),style:{background:`linear-gradient(to right, ${k(h,l,0).hex} 0px, ${k(h,l,1).hex} 100%)`},onClick:j,children:b("div",{className:v.tooltipItemSliderHandler,style:{left:`${Math.round(u*H)}px`},onMouseDown:A,onClick:(w)=>w.stopPropagation()})}),a1("div",{className:i1(v.tooltipItem,v.tooltipItemToolbar),children:[b("div",{className:i1(v.tooltipItemToolbarButton,{[v.selected]:e.clear}),onClick:O,children:b("img",{src:p1,className:v.buttonIcon})}),b("div",{className:i1(v.tooltipItemToolbarButton,{[v.selected]:t}),onClick:p,children:b("img",{src:_1,className:v.buttonIcon})})]})]}),children:a1("div",{className:v.colorPickerWrapper,children:[b("div",{className:i1(v.colorSwatch,{[v.colorSwatchOutline]:i}),style:{background:e.clear?"var(--ui-white)":k(h,l,u).hex},children:e.clear&&b("img",{src:p1})}),b("div",{className:v.pickerArrow,children:"\u25BE"})]})})}import{useLocale as A5}from"@blockcode/core";import{classNames as J,Button as $}from"@blockcode/ui";W(".zaEMxq_tool-box-wrapper{flex-flow:wrap;place-content:flex-start space-between;width:7rem;display:flex}.zaEMxq_tool-button{margin:calc(var(--space)/2);border-radius:calc(var(--space)/2);padding:calc(var(--space)/2);user-select:none;background:0 0;border:none;outline:none;transition:all .2s;display:inline-block}.zaEMxq_tool-button.zaEMxq_selected{background:var(--motion-primary)}.zaEMxq_tool-icon{vertical-align:middle;width:2rem;height:2rem}.zaEMxq_tool-button.zaEMxq_selected .zaEMxq_tool-icon{filter:brightness(0)invert()}");var f={toolBoxWrapper:"zaEMxq_tool-box-wrapper",toolIcon:"zaEMxq_tool-icon",selected:"zaEMxq_selected",toolButton:"zaEMxq_tool-button"};var s1="./assets/icon-pen-vmav54fy.svg";var o1="./assets/icon-eraser-6exvhk0q.svg";var j1="./assets/icon-fill-70s8y3f8.svg";var P1="./assets/icon-text-e5hysycg.svg";var E1="./assets/icon-line-r61p9edw.svg";var y1="./assets/icon-rectangle-yasy0y9k.svg";var B1="./assets/icon-circle-ynejmr8k.svg";var S1="./assets/icon-select-7g007t5g.svg";import{jsx as S,jsxs as D5}from"preact/jsx-runtime";function g1({selectedTool:t,onSelect:e}){const{getText:i}=A5();return D5("div",{className:f.toolBoxWrapper,children:[S($,{className:J(f.toolButton,{[f.selected]:t==="pen"}),onClick:()=>e("pen"),children:S("img",{src:s1,className:f.toolIcon,title:i("pixelPaint.painter.pen","Pen")})}),S($,{className:J(f.toolButton,{[f.selected]:t==="eraser"}),onClick:()=>e("eraser"),children:S("img",{src:o1,className:f.toolIcon,title:i("pixelPaint.painter.eraser","Eraser")})}),S($,{className:J(f.toolButton,{[f.selected]:t==="fill"}),onClick:()=>e("fill"),children:S("img",{src:j1,className:f.toolIcon,title:i("pixelPaint.painter.fill","Fill")})}),S($,{disabled:!0,className:J(f.toolButton,{[f.selected]:t==="text"}),onClick:()=>e("text"),children:S("img",{src:P1,className:f.toolIcon,title:i("pixelPaint.painter.text","Text")})}),S($,{disabled:!0,className:J(f.toolButton,{[f.selected]:t==="line"}),onClick:()=>e("line"),children:S("img",{src:E1,className:f.toolIcon,title:i("pixelPaint.painter.line","Line")})}),S($,{disabled:!0,className:J(f.toolButton,{[f.selected]:t==="rectangle"}),onClick:()=>e("rectangle"),children:S("img",{src:y1,className:f.toolIcon,title:i("pixelPaint.painter.rectangle","Rectangle")})}),S($,{disabled:!0,className:J(f.toolButton,{[f.selected]:t==="circle"}),onClick:()=>e("circle"),children:S("img",{src:B1,className:f.toolIcon,title:i("pixelPaint.painter.circle","Circle")})}),S($,{disabled:!0,className:J(f.toolButton,{[f.selected]:t==="select"}),onClick:()=>e("select"),children:S("img",{src:S1,className:f.toolIcon,title:i("pixelPaint.painter.select","Select")})})]})}import{useRef as O5,useEffect as Y1,useState as b5}from"preact/hooks";import{classNames as F1}from"@blockcode/ui";W("._1X3Adq_draw-box{background:var(--ui-secondary);width:100%;height:100%;display:flex;position:absolute;top:0;left:0;overflow:auto}._1X3Adq_draw-canvas-wrapper{margin:auto;position:relative}._1X3Adq_draw-canvas{image-rendering:pixelated;background:url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+CjwhLS0gQ3JlYXRlZCB3aXRoIFZlY3Rvcm5hdG9yIChodHRwOi8vdmVjdG9ybmF0b3IuaW8vKSAtLT4KPHN2ZyBoZWlnaHQ9IjMwIiB3aWR0aD0iMzAiIHN0cm9rZS1taXRlcmxpbWl0PSIxMCIgc3R5bGU9ImZpbGwtcnVsZTpub256ZXJvO2NsaXAtcnVsZTpldmVub2RkO3N0cm9rZS1saW5lY2FwOnJvdW5kO3N0cm9rZS1saW5lam9pbjpyb3VuZDsiIHZlcnNpb249IjEuMSIgdmlld0JveD0iMCAwIDQwIDQwIiB4bWw6c3BhY2U9InByZXNlcnZlIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIj4KPGRlZnMvPgo8Zz4KPHBhdGggZD0iTTAgMEw0MCAwTDQwIDQwTDAgNDBMMCAwWiIgZmlsbD0iI2ZmZmZmZiIgZmlsbC1ydWxlPSJub256ZXJvIiBvcGFjaXR5PSIxIiBzdHJva2U9Im5vbmUiLz4KPHBhdGggZD0iTTAgMEwyMCAwTDIwIDIwTDAgMjBMMCAwWiIgZmlsbD0iI2VhZjBmOCIgZmlsbC1ydWxlPSJub256ZXJvIiBvcGFjaXR5PSIxIiBzdHJva2U9Im5vbmUiLz4KPHBhdGggZD0iTTIwIDIwTDQwIDIwTDQwIDQwTDIwIDQwTDIwIDIwWiIgZmlsbD0iI2VhZjBmOCIgZmlsbC1ydWxlPSJub256ZXJvIiBvcGFjaXR5PSIxIiBzdHJva2U9Im5vbmUiLz4KPC9nPgo8L3N2Zz4K);width:320px;height:240px}._1X3Adq_draw-canvas._1X3Adq_center{cursor:crosshair}._1X3Adq_draw-canvas._1X3Adq_picker{cursor:url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+Cjxzdmcgd2lkdGg9IjIwcHgiIGhlaWdodD0iMjBweCIgdmlld0JveD0iMCAwIDIwIDIwIiB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiPgogICAgPCEtLSBHZW5lcmF0b3I6IFNrZXRjaCA0My4yICgzOTA2OSkgLSBodHRwOi8vd3d3LmJvaGVtaWFuY29kaW5nLmNvbS9za2V0Y2ggLS0+CiAgICA8dGl0bGU+ZXllLWRyb3BwZXI8L3RpdGxlPgogICAgPGRlc2M+Q3JlYXRlZCB3aXRoIFNrZXRjaC48L2Rlc2M+CiAgICA8ZGVmcz48L2RlZnM+CiAgICA8ZyBpZD0iUGFnZS0xIiBzdHJva2U9Im5vbmUiIHN0cm9rZS13aWR0aD0iMSIgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIj4KICAgICAgICA8ZyBpZD0iZXllLWRyb3BwZXIiIGZpbGw9IiM1NzVFNzUiPgogICAgICAgICAgICA8cGF0aCBkPSJNOS4xNTMzNDYwNSwxMi40ODI0OTYyIEM5LjAzMzk0MDQ0LDEyLjYxODg3MzcgOC44ODA0MTg5NSwxMi43MDQxMDk2IDguNjA3NDkxODYsMTIuNzcyMjk4MyBDNy45MDgxMTYxOCwxMi45MjU3MjMgNy4yNDI4NTYzOSwxMy41NTY0Njg4IDcuMDM4MTYxMDcsMTQuMjU1NDAzMyBDNi45Njk5MjkzLDE0LjQ3NzAxNjcgNi43NDgxNzYwMywxNC43MTU2NzczIDYuNTA5MzY0ODMsMTQuODM1MDA3NiBMNC43MzUzMzg3MSwxNS42NzAzMTk2IEM0LjY1MDA0OSwxNS43MDQ0MTQgNC41ODE4MTcyMiwxNS43MjE0NjEyIDQuNTQ3NzAxMzQsMTUuNzIxNDYxMiBMNC4yNzQ3NzQyNCwxNS40NjU3NTM0IEM0LjI3NDc3NDI0LDE1LjQ0ODcwNjIgNC4yNzQ3NzQyNCwxNS4zODA1MTc1IDQuMzI1OTQ4MDcsMTUuMjYxMTg3MiBMNS4xNjE3ODczLDEzLjQ3MTIzMjkgQzUuMjY0MTM0OTYsMTMuMjQ5NjE5NSA1LjUwMjk0NjE3LDEzLjAyODAwNjEgNS43NDE3NTczNywxMi45NTk4MTc0IEM2LjQ0MTEzMzA1LDEyLjczODIwNCA3LjA3MjI3Njk2LDEyLjA5MDQxMSA3LjI1OTkxNDMzLDExLjIzODA1MTggQzcuMjk0MDMwMjIsMTEuMTAxNjc0MyA3LjM3OTMxOTk0LDEwLjk2NTI5NjggNy40OTg3MjU1NCwxMC44Mjg5MTkzIEwxMS40MzkxMTA1LDYuOTA4MDY2OTcgTDEzLjA5MzczMSw4LjU2MTY0Mzg0IEw5LjE1MzM0NjA1LDEyLjQ4MjQ5NjIgWiBNMTYuNjA3NjY3Myw1LjI4ODU4NDQ3IEMxNi44NjM1MzY1LDUuMDMyODc2NzEgMTcsNC42NzQ4ODU4NCAxNyw0LjMzMzk0MjE2IEMxNywzLjk5Mjk5ODQ4IDE2Ljg2MzUzNjUsMy42NTIwNTQ3OSAxNi42MDc2NjczLDMuMzk2MzQ3MDMgQzE2LjA3ODg3MTEsMi44Njc4ODQzMiAxNS4yNDMwMzE4LDIuODY3ODg0MzIgMTQuNzE0MjM1NiwzLjM5NjM0NzAzIEwxMy4yMzAxOTQ1LDQuODc5NDUyMDUgTDEzLjA1OTYxNTEsNC43MDg5ODAyMSBMMTIuNTEzNzYwOSw0LjE2MzQ3MDMyIEMxMi4xNzI2MDIsMy44MjI1MjY2NCAxMS42MDk2ODk5LDMuODIyNTI2NjQgMTEuMjY4NTMxLDQuMTYzNDcwMzIgTDEwLjYwMzI3MTIsNC44MTEyNjMzMiBDMTAuMjc5MTcwMyw1LjE1MjIwNyAxMC4yNjIxMTI0LDUuNjQ2NTc1MzQgMTAuNTUyMDk3NCw1Ljk4NzUxOTAzIEw2LjU5NDY1NDU0LDkuOTI1NDE4NTcgQzYuMzA0NjY5NTEsMTAuMjMyMjY3OSA2LjA5OTk3NDE4LDEwLjU5MDI1ODggNS45ODA1Njg1OCwxMS4xMDE2NzQzIEM1LjkyOTM5NDc1LDExLjM1NzM4MiA1LjYzOTQwOTcxLDExLjY0NzE4NDIgNS4zNjY0ODI2MiwxMS43MzI0MjAxIEM0LjgwMzU3MDQ5LDExLjkwMjg5MTkgNC4yNTc3MTYzLDEyLjM4MDIxMzEgNC4wMDE4NDcxNSwxMi45NDI3NzAyIEwzLjE2NjAwNzkyLDE0LjcxNTY3NzMgQzIuODkzMDgwODMsMTUuMzEyMzI4OCAyLjk2MTMxMjYsMTUuOTI2MDI3NCAzLjMzNjU4NzM2LDE2LjMxODExMjYgTDMuNjc3NzQ2MjMsMTYuNjU5MDU2MyBDMy44OTk0OTk0OSwxNi44ODA2Njk3IDQuMjA2NTQyNDcsMTcgNC41NDc3MDEzNCwxNyBDNC43Njk0NTQ2LDE3IDUuMDI1MzIzNzUsMTYuOTMxODExMyA1LjI2NDEzNDk2LDE2LjgyOTUyODIgTDcuMDU1MjE5MDEsMTUuOTk0MjE2MSBDNy42MTgxMzExNCwxNS43MjE0NjEyIDguMDk1NzUzNTYsMTUuMTkyOTk4NSA4LjI2NjMzMjk5LDE0LjYzMDQ0MTQgQzguMzM0NTY0NzcsMTQuMzU3Njg2NSA4LjY0MTYwNzc1LDE0LjA2Nzg4NDMgOS4wNTA5OTgzOSwxMy45ODI2NDg0IEM5LjQwOTIxNTIsMTMuODk3NDEyNSA5Ljc2NzQzMjAxLDEzLjY5Mjg0NjMgMTAuMDU3NDE3LDEzLjM4NTk5NyBMMTQuMDE0ODU5OSw5LjQ0ODA5NzQxIEMxNC4zNTYwMTg4LDkuNzM3ODk5NTQgMTQuODY3NzU3MSw5LjcwMzgwNTE4IDE1LjE3NDgwMDEsOS4zNzk5MDg2OCBMMTUuODQwMDU5OSw4LjczMjExNTY4IEMxNi4xODEyMTg3LDguMzkxMTcxOTkgMTYuMTgxMjE4Nyw3LjgyODYxNDkyIDE1Ljg0MDA1OTksNy40ODc2NzEyMyBMMTUuMjYwMDg5OCw2LjkwODA2Njk3IEwxNS4xMjM2MjYyLDYuNzcxNjg5NSBMMTYuNjA3NjY3Myw1LjI4ODU4NDQ3IFoiIGlkPSJleWUtZHJvcHBlci1pY29uIj48L3BhdGg+CiAgICAgICAgPC9nPgogICAgPC9nPgo8L3N2Zz4=) 4 15,crosshair}._1X3Adq_center-icon{pointer-events:none;filter:opacity(.5);position:absolute;top:0;left:0;transform:translate(-50%,-50%)}._1X3Adq_center-icon._1X3Adq_hidden{display:none}");var V={hidden:"_1X3Adq_hidden",drawBox:"_1X3Adq_draw-box",center:"_1X3Adq_center",drawCanvas:"_1X3Adq_draw-canvas",centerIcon:"_1X3Adq_center-icon",drawCanvasWrapper:"_1X3Adq_draw-canvas-wrapper",picker:"_1X3Adq_picker"};var c1="./assets/icon-center-bzxv0qgf.svg";import{jsx as u1,jsxs as _5}from"preact/jsx-runtime";function x1({image:t,selectedTool:e,zoom:i,undoList:n,onChange:p,onChangeColor:h}){const l=O5(),[u,k]=b5(),C=e.fillColor||new M([0,0,0]),m=e.outlineColor||new M([0,0,0]);let I,O;const y=()=>{O=u.getImageData(0,0,d.DrawWidth,d.DrawHeight)},T=(r=0,o=0)=>{u.clearRect(0,0,d.DrawWidth,d.DrawHeight),u.putImageData(O,r,o)},B=()=>{p(O),O=null},A=()=>{let r=new OffscreenCanvas(d.DrawWidth,d.DrawHeight),o=r.getContext("2d",{willReadFrequently:!0});o.imageSmoothingEnabled=!1,o.putImageData(n.at(-1),0,0),O=o.getImageData(0,0,d.DrawWidth,d.DrawHeight),o=null,r=null},_=(r,o)=>{if(r.invalid)return;const c=r.index;O.data[c+0]=o.r,O.data[c+1]=o.g,O.data[c+2]=o.b,O.data[c+3]=o.a===0?0:255},U=(r,o,c,a)=>{_(new d(r.x-o,r.y+c),a),_(new d(r.x+o,r.y+c),a),_(new d(r.x+o,r.y-c),a),_(new d(r.x-o,r.y-c),a),_(new d(r.x-c,r.y+o),a),_(new d(r.x+c,r.y+o),a),_(new d(r.x+c,r.y-o),a),_(new d(r.x-c,r.y-o),a)},Y=(r,o,c)=>{const a=Math.abs(o.x-r.x),g=Math.abs(o.y-r.y),s=r.x<o.x?1:-1,L=r.y<o.y?1:-1,D=new d(r.x,r.y);let q=a-g;while(!0){if(_(D,c),D.x===o.x&&D.y===o.y)break;const Q=2*q;if(Q>-g)q-=g,D.x+=s;if(Q<a)q+=a,D.y+=L}},j=(r,o,c)=>{let a=r.x,g=o.x,s=r.y,L=o.y;if(c.outline){const D=new d(g,s),q=new d(a,L);Y(r,D,c.outline),Y(o,q,c.outline),Y(D,o,c.outline),Y(q,r,c.outline),a+=1,g-=1,s+=1,L-=1}if(c.fill)for(let D=s;D<=L;D++)Y(new d(a,D),new d(g,D),c.fill)},z=(r,o,c)=>{let a=0,g=o,s=3-2*o;while(a<=g){if(c.fill)for(let L=a;L<=g;L++)U(r,a,L,c.fill);if(c.outline)U(r,a,g,c.outline);if(s<0)s=s+4*a+6;else s=s+4*(a-g),g--;a++}},w=(r)=>{if(r.invalid)return;const o={clear:C.clear,fill:C.rgb,outline:!1};if(o.clear||e.type==="eraser"){if(o.fill.a=0,!I)o.fill={r:255,g:255,b:255},o.outline={r:138,g:187,b:255}}if(e.penSize===1)_(r,!I&&(o.clear||e.type==="eraser")?o.outline:o.fill);else if(e.penSize===3)j(new d(r.x-1,r.y-1),new d(r.x+1,r.y+1),o);else if(e.penSize<5){const c=e.penSize/2;j(new d(r.x-c,r.y-c),new d(r.x+c-1,r.y+c-1),o)}else z(r,Math.floor((e.penSize-1)/2),o)},F=(r)=>{if(r.invalid)return;const o=new M(Array.from(O.data.slice(r.index,r.index+4))),c=[],a=(g)=>{if(g.invalid)return;if(!c.includes(g.index)){const s=new M(Array.from(O.data.slice(g.index,g.index+4)));if(s.equals(o)&&s.notEquals(C))c.push(g.index)}};a(r);while(c.length>0){const g=c.shift();O.data[g+0]=C.rgb.r,O.data[g+1]=C.rgb.g,O.data[g+2]=C.rgb.b,O.data[g+3]=C.clear?0:255,r=d.from(g),a(r.topPoint),a(r.leftPoint),a(r.rightPoint),a(r.bottomPoint)}},P=(r)=>{if(r.preventDefault(),!l.current)return;I=!0;const o=l.current.getBoundingClientRect();let c=r.clientX-o.left,a=r.clientY-o.top;if(c=Math.floor(d.DrawWidth*c/l.current.clientWidth),a=Math.floor(d.DrawHeight*a/l.current.clientHeight),e.type==="pen"||e.type==="eraser"||e.type==="fill"){const s=new d(c,a);if(y(),e.type==="pen"||e.type==="eraser")w(s);else if(e.type==="fill")F(s);T()}else if(e.type.startsWith("picker-"))r.stopPropagation();else if(e.type.startsWith("center")){const s=d.DrawWidth/2-c,L=d.DrawHeight/2-a;T(s,L),y()}const g=()=>{if(I)I=!1,B();document.removeEventListener("mouseup",g)};document.addEventListener("mouseup",g)},E=(r)=>{if(r.preventDefault(),!l.current)return;if(e.type==="center")return;const o=l.current.getBoundingClientRect();let c=r.clientX-o.left,a=r.clientY-o.top;if(c=Math.floor(d.DrawWidth*c/l.current.clientWidth),a=Math.floor(d.DrawHeight*a/l.current.clientHeight),e.type==="pen"||e.type==="eraser"){const g=new d(c,a);if(!I)A();else y();if(e.type==="pen"||e.type==="eraser")w(g);T()}else if(e.type.startsWith("picker-"));},R=(r)=>{if(r.preventDefault(),I=!1,e.type==="center"){B();return}const o=l.current.getBoundingClientRect();let c=r.clientX-o.left,a=r.clientY-o.top;if(c=Math.floor(d.DrawWidth*c/l.current.clientWidth),a=Math.floor(d.DrawHeight*a/l.current.clientHeight),e.type.startsWith("picker-")){const[g,s,L,D]=u.getImageData(c,a,1,1).data;if(D===0){if(e.type==="picker-fill")h(new M(C.hsv,!0));if(e.type==="picker-outline")h(new M(m.hsv,!0))}else h(new M({r:g,g:s,b:L}).toHSVColor());return}if(B(),e.type==="eraser")A(),w(new d(c,a)),T()},G=(r)=>{if(r.preventDefault(),!I)A(),T()};if(Y1(()=>{if(l.current){const r=l.current.getContext("2d",{willReadFrequently:!0});r.imageSmoothingEnabled=!1,k(r)}return()=>{}},[l]),Y1(()=>{if(l.current){const r=l.current.parentElement.parentElement;let o=(l.current.clientWidth-r.clientWidth)/2,c=(l.current.clientHeight-r.clientHeight)/2;if(i>2){const g=r.clientWidth/2;if(o=(r.scrollLeft+g)/r.dataset.scrollWidth*l.current.clientWidth-g,i>4){const s=r.clientHeight/2;c=(r.scrollTop+s)/r.dataset.scrollHeight*l.current.clientHeight-s}}r.dataset.scrollWidth=l.current.clientWidth,r.dataset.scrollHeight=l.current.clientHeight,r.scroll({top:c>0?c:0,left:o>0?o:0});const a=l.current.nextSibling;a.style.top=`${i*d.DrawHeight/2}px`,a.style.left=`${i*d.DrawWidth/2}px`}return()=>{}},[i]),u&&n.length===0)if(t)L1(t).then((r)=>{const o=d.DrawWidth/2-t.centerX,c=d.DrawHeight/2-t.centerY;u.clearRect(0,0,d.DrawWidth,d.DrawHeight),u.drawImage(r,o,c),y(),B()});else y(),B();if(u&&n.length>0)A(),T();return u1("div",{className:V.drawBox,children:_5("div",{className:V.drawCanvasWrapper,children:[u1("canvas",{ref:l,className:F1(V.drawCanvas,{[V.center]:e.type==="center",[V.picker]:e.type.startsWith("picker-")}),width:d.DrawWidth,height:d.DrawHeight,style:{width:d.DrawWidth*i,height:d.DrawHeight*i},onMouseDown:P,onMouseMove:E,onMouseUp:R,onMouseLeave:G}),u1("img",{src:c1,className:F1(V.centerIcon,{[V.hidden]:e.type!=="center"})})]})})}W(".KOzPOa_painter-wrapper{padding:calc(var(--space)*1.5);border-left:1px solid var(--ui-black-transparent);color:var(--text-primary);flex-direction:column;flex:1;display:flex}.KOzPOa_row{min-height:3rem;margin-bottom:.5rem;display:flex}.KOzPOa_row-fill{padding-top:calc(var(--space)*2.5);border-top:1px dashed var(--ui-black-transparent);flex-direction:row;flex:1}.KOzPOa_row-bottom{margin-right:var(--space);margin-left:calc(7em + var(--space));justify-content:space-between}.KOzPOa_row:last-child{min-height:unset;margin-bottom:0}.KOzPOa_group{margin-right:calc(var(--space)*1.5);flex-direction:row;align-items:center;display:inline-flex}.KOzPOa_disabled{opacity:.3;pointer-events:none}.KOzPOa_dashed-border{border-right:1px dashed var(--ui-black-transparent);padding-right:var(--space)}.KOzPOa_name-input{width:8rem}.KOzPOa_large-input{width:4rem}.KOzPOa_tool-icon{margin-right:var(--space);width:2rem;height:2rem}.KOzPOa_label-image{vertical-align:middle;margin-right:calc(var(--space)/2)}.KOzPOa_button{width:calc(2rem + 2px);height:calc(2rem + 2px);padding:.375rem}.KOzPOa_text-button{height:calc(2rem + 2px);padding:.375rem}.KOzPOa_button-icon{width:1.5rem;margin:auto}.KOzPOa_group-button{border-left:none;border-radius:0}.KOzPOa_group-button-first{border-top-right-radius:0;border-bottom-right-radius:0}.KOzPOa_group-button-last{border-left:none;border-top-left-radius:0;border-bottom-left-radius:0}.KOzPOa_group-button-toggled-off{filter:saturate(0)}.KOzPOa_label-button{border:0;font-weight:400}.KOzPOa_label-button.KOzPOa_selected{background:var(--motion-primary);color:var(--ui-white)}.KOzPOa_label-button.KOzPOa_selected .KOzPOa_button-icon{filter:brightness(0)invert()}.KOzPOa_draw-box-wrapper{margin:0 var(--space);border:1px solid var(--ui-black-transparent);border-radius:calc(var(--space)/2);flex:1;position:relative;overflow:hidden}");var x={largeInput:"KOzPOa_large-input",groupButton:"KOzPOa_group-button",groupButtonLast:"KOzPOa_group-button-last",groupButtonFirst:"KOzPOa_group-button-first",labelButton:"KOzPOa_label-button",drawBoxWrapper:"KOzPOa_draw-box-wrapper",disabled:"KOzPOa_disabled",button:"KOzPOa_button",rowFill:"KOzPOa_row-fill",labelImage:"KOzPOa_label-image",group:"KOzPOa_group",selected:"KOzPOa_selected",rowBottom:"KOzPOa_row-bottom",textButton:"KOzPOa_text-button",buttonIcon:"KOzPOa_button-icon",dashedBorder:"KOzPOa_dashed-border",toolIcon:"KOzPOa_tool-icon",groupButtonToggledOff:"KOzPOa_group-button-toggled-off",nameInput:"KOzPOa_name-input",row:"KOzPOa_row",painterWrapper:"KOzPOa_painter-wrapper"};var T1="./assets/icon-undo-q4nwvpxj.svg";var W1="./assets/icon-redo-mrvqwv38.svg";var U1="./assets/icon-zoom-in-s316e3qy.svg";var Z1="./assets/icon-zoom-out-y9xmwx8c.svg";var Q1="./assets/icon-zoom-reset-xne8n5sw.svg";import{jsx as N,jsxs as K,Fragment as U5}from"preact/jsx-runtime";function M1({mode:t,imageList:e,imageIndex:i}){const{getText:n,maybeLocaleText:p}=Y5(),{modifyAsset:h}=F5(),[l,u]=X(1),[k,C]=X("draw"),[m,I]=X("pen"),[O,y]=X(10),[T,B]=X(2),[A,_]=X(new M([260,0.6,1])),[U,Y]=X(new M([0,1,0])),[j,z]=X([]),[w,F]=X([]),P=e[i],E=P&&P.id,R=!E,G=(s,L,D)=>{if(t==="costume")return L;if(t==="backdrop")return D;return s},r=(s)=>{if(s.id=E,s.data){const L=b1(s.data);s.type=L.type,s.data=L.data,s.width=L.width,s.height=L.height,s.centerX=L.centerX,s.centerY=L.centerY}h(s)},o=(s,L)=>{const D={};if(s==="name")D.name=L;if(s==="data"){if(D.data=L,j.length>20)j.splice(1,1);if(z(j.concat(D.data)),F([]),j.length===0)return}if(r(D),k!=="draw")C("draw")},c=(s)=>{if(k==="picker-fill")_(s);if(k==="picker-outline")Y(s)},a=()=>{const s=j.pop();z(j),F(w.concat(s)),r({data:j.at(-1)})},g=()=>{const s=w.pop();z(j.concat(s)),F(w),r({data:s})};return S5(()=>{return z([]),F([]),C("draw"),()=>{}},[E]),K("div",{className:x.painterWrapper,children:[K("div",{className:x.row,children:[N("div",{className:x.group,children:N(m1,{text:G(n("pixelPaint.painter.image","Image"),n("pixelPaint.painter.costume","Costume"),n("pixelPaint.painter.backdrop","Backdrop")),children:N(W5,{disabled:R,className:x.nameInput,placeholder:n("pixelPaint.painter.name","name"),onSubmit:(s)=>o("name",s),value:P?p(P.name):G(n("pixelPaint.painter.image","Image"),n("pixelPaint.painter.costume","Costume"),n("pixelPaint.painter.backdrop","Backdrop"))})})}),K("div",{className:x.group,children:[N(r1,{disabled:j.length<=1,className:Z(x.button,x.groupButtonFirst,{[x.groupButtonToggledOff]:R}),onClick:a,children:N("img",{src:T1,className:x.buttonIcon,title:n("pixelPaint.painter.undo","Undo")})}),N(r1,{disabled:w.length===0,className:Z(x.button,x.groupButtonLast,{[x.groupButtonToggledOff]:R}),onClick:g,children:N("img",{src:W1,className:x.buttonIcon,title:n("pixelPaint.painter.redo","Redo")})})]}),N("div",{className:x.group,children:t==="costume"&&K(r1,{vertical:!0,className:Z(x.labelButton,{[x.selected]:k==="center"}),onClick:()=>C(k!=="center"?"center":"draw"),children:[N("img",{src:c1,className:x.buttonIcon,title:n("pixelPaint.painter.center","Center")}),N("span",{children:n("pixelPaint.painter.center","Center")})]})})]}),K("div",{className:x.row,children:[N("div",{className:x.group,children:N(m1,{text:n("pixelPaint.painter.fill","Fill"),children:N(l1,{picking:k.startsWith("picker-"),color:A,onChange:_,onPickColor:(s)=>C(s===!1?"draw":"picker-fill")})})}),K("div",{className:Z(x.group,x.dashedBorder),children:[N(m1,{className:Z({[x.disabled]:!0}),text:n("pixelPaint.painter.outline","Outline"),children:N(l1,{outline:!0,picking:k.startsWith("picker-"),color:U,onChange:Y,onPickColor:(s)=>C(s===!1?"draw":"picker-outline")})}),N(K1,{small:!0,type:"number",min:0,max:100,step:1,className:Z(x.largeInput,{[x.disabled]:!0}),value:T,onChange:(s)=>B(s.target.valueAsNumber)})]}),N("div",{className:x.group,children:m==="pen"||m==="eraser"?K(U5,{children:[N("img",{src:m==="pen"?s1:o1,className:x.toolIcon}),N(K1,{small:!0,type:"number",min:1,max:100,step:1,className:x.largeInput,value:O,onChange:(s)=>y(s.target.valueAsNumber)})]}):null})]}),K("div",{className:Z(x.row,x.rowFill),children:[N(g1,{selectedTool:m,onSelect:I}),N("div",{className:x.drawBoxWrapper,children:N(x1,{image:P,zoom:l,selectedTool:{fillColor:A,outlineColor:U,penSize:O,outlineSize:T,type:k==="draw"?m:k},undoList:j,onChange:(s)=>o("data",s),onChangeColor:c})})]}),K("div",{className:Z(x.row,x.rowBottom),children:[N("div",{children:t==="backdrop"&&N(r1,{disabled:!0,className:x.textButton,children:N(T5,{id:"pixelPaint.mode.tileMap",defaultMessage:"Convert to TileMap"})})}),K("div",{children:[N(r1,{className:Z(x.button,x.groupButtonFirst),onClick:()=>l-1>0&&u(l-1),children:N("img",{src:Z1,className:x.buttonIcon})}),N(r1,{className:Z(x.button,x.groupButton),onClick:()=>u(1),children:N("img",{src:Q1,className:x.buttonIcon})}),N(r1,{className:Z(x.button,x.groupButtonLast),onClick:()=>l+1<20&&u(l+1),children:N("img",{src:U1,className:x.buttonIcon})})]})]})]})}W(".gJa9lW_pixel-paint-wrapper{background:var(--ui-white);border-radius:inherit;flex-grow:1;display:flex}");var R1={pixelPaintWrapper:"gJa9lW_pixel-paint-wrapper"};function Q5({onSetupLibrary:t}){const{fileList:e,assetList:i,selectedFileId:n}=Z5();let p=i.filter((u)=>/^image\//.test(u.type)),h="image";const l=e.find((u)=>u.id===n);if(l&&l.assets&&l.frame!=null)p=p.filter((u)=>l.assets.includes(u.id)),h=n===e[0].id?"backdrop":"costume";return K5("div",{className:R1.pixelPaintWrapper,children:[G1(h1,{mode:h,imageList:p,imageIndex:l.frame,onSetupLibrary:t}),G1(M1,{mode:h,imageIndex:l.frame,imageList:p})]})}import{jsx as G1,jsxs as K5}from"preact/jsx-runtime";var H1={"pixelPaint.contextMenu.duplicate":"duplicate","pixelPaint.contextMenu.export":"export","pixelPaint.contextMenu.delete":"delete","pixelPaint.actionButton.upload":"Upload Image","pixelPaint.actionButton.uploadCostume":"Upload Costume","pixelPaint.actionButton.uploadBackdrop":"Upload Backdrop","pixelPaint.actionButton.uploadError":"Upload \"{file}\" failed.","pixelPaint.actionButton.surprise":"Surprise","pixelPaint.actionButton.paint":"Paint","pixelPaint.actionButton.image":"Choose a Image","pixelPaint.actionButton.costume":"Choose a Costume","pixelPaint.actionButton.backdrop":"Choose a Backdrop","pixelPaint.painter.image":"Image","pixelPaint.painter.costume":"Costume","pixelPaint.painter.backdrop":"Backdrop","pixelPaint.painter.name":"name","pixelPaint.painter.undo":"Undo","pixelPaint.painter.redo":"Redo","pixelPaint.painter.pen":"Pen","pixelPaint.painter.eraser":"Eraser","pixelPaint.painter.fill":"Fill","pixelPaint.painter.text":"Text","pixelPaint.painter.line":"Line","pixelPaint.painter.rectangle":"Rectangle","pixelPaint.painter.circle":"Circle","pixelPaint.painter.select":"Select","pixelPaint.painter.center":"Center","pixelPaint.painter.outline":"Outline","pixelPaint.colorPicker.color":"Color","pixelPaint.colorPicker.saturation":"Saturation","pixelPaint.colorPicker.brightness":"Brightness","pixelPaint.mode.pixel":"Convert to Bitmap","pixelPaint.mode.tileMap":"Convert to TileMap"};var X1={"pixelPaint.contextMenu.duplicate":"\u590D\u5236","pixelPaint.contextMenu.export":"\u5BFC\u51FA","pixelPaint.contextMenu.delete":"\u5220\u9664","pixelPaint.actionButton.upload":"\u4E0A\u4F20\u56FE\u7247","pixelPaint.actionButton.uploadCostume":"\u4E0A\u4F20\u9020\u578B","pixelPaint.actionButton.uploadBackdrop":"\u4E0A\u4F20\u80CC\u666F","pixelPaint.actionButton.uploadError":"\u4E0A\u4F20\u201C{file}\u201D\u5931\u8D25\u3002","pixelPaint.actionButton.surprise":"\u968F\u673A","pixelPaint.actionButton.paint":"\u7ED8\u5236","pixelPaint.actionButton.image":"\u9009\u62E9\u4E00\u4E2A\u56FE\u7247","pixelPaint.actionButton.costume":"\u9009\u62E9\u4E00\u4E2A\u9020\u578B","pixelPaint.actionButton.backdrop":"\u9009\u62E9\u4E00\u4E2A\u80CC\u666F","pixelPaint.painter.image":"\u56FE\u7247","pixelPaint.painter.costume":"\u9020\u578B","pixelPaint.painter.backdrop":"\u80CC\u666F","pixelPaint.painter.name":"\u540D\u5B57","pixelPaint.painter.undo":"\u64A4\u9500","pixelPaint.painter.redo":"\u91CD\u505A","pixelPaint.painter.pen":"\u753B\u7B14","pixelPaint.painter.eraser":"\u6A61\u76AE\u64E6","pixelPaint.painter.fill":"\u586B\u5145","pixelPaint.painter.text":"\u6587\u672C","pixelPaint.painter.line":"\u7EBF\u6BB5","pixelPaint.painter.rectangle":"\u77E9\u5F62","pixelPaint.painter.circle":"\u5706\u5F62","pixelPaint.painter.select":"\u9009\u62E9","pixelPaint.painter.center":"\u4E2D\u5FC3","pixelPaint.painter.outline":"\u8F6E\u5ED3","pixelPaint.colorPicker.color":"\u989C\u8272","pixelPaint.colorPicker.saturation":"\u9971\u548C\u5EA6","pixelPaint.colorPicker.brightness":"\u4EAE\u5EA6","pixelPaint.mode.pixel":"\u8F6C\u6362\u4E3A\u4F4D\u56FE","pixelPaint.mode.tileMap":"\u8F6C\u6362\u4E3A TileMap"};var V2={en:H1,"zh-Hans":X1};export{V2 as locales,Q5 as PixelPaint};
