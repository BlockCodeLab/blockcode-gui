import{useEditor as Q5}from"@blockcode/core";import{useState as p1}from"preact/hooks";import{useLocale as l5,useLayout as s5,useEditor as o5}from"@blockcode/core";import{IconSelector as c5,ActionButton as d5}from"@blockcode/ui";class d{static get DrawWidth(){return 320}static get DrawHeight(){return 240}static from(t){const e=t>>2,i=Math.floor(e/320),n=e-i*320;return new d(n,i)}constructor(t,e){this.setXY(t,e)}get x(){return this._x}set x(t){this._x=t,this._index=this.x+this.y*320<<2}get y(){return this._y}set y(t){this._y=t,this._index=this.x+this.y*320<<2}get index(){return this._index}get valid(){return this.x>=0&&this.x<320&&this.y>=0&&this.y<240}get invalid(){return!this.valid}get topPoint(){return new d(this.x,this.y-1)}get leftPoint(){return new d(this.x-1,this.y)}get rightPoint(){return new d(this.x+1,this.y)}get bottomPoint(){return new d(this.x,this.y+1)}get topLeftPoint(){return new d(this.x-1,this.y-1)}get topRightPoint(){return new d(this.x+1,this.y-1)}get bottomLeftPoint(){return new d(this.x-1,this.y+1)}get bottomRightPoint(){return new d(this.x+1,this.y+1)}setXY(t,e){return this._x=t,this._y=e,this._index=this.x+this.y*320<<2,this}equals(t){return this.x==t.x&&this.y==t.y}}function N1(t){return new Promise(async(e)=>{const i=new FileReader;i.readAsDataURL(t),i.addEventListener("load",()=>{const n=new Image;n.src=i.result,n.addEventListener("load",()=>{if(n.dataset.data){e(n);return}let{width:p,height:c}=n;if(n.width>d.DrawWidth||n.height>d.DrawHeight){p=d.DrawWidth,c=d.DrawHeight;const v=n.width/d.DrawWidth,x=n.height/d.DrawHeight;if(v>x)c=n.height/v;else p=n.width/x}const o=document.createElement("canvas");o.width=p,o.height=c,o.getContext("2d").drawImage(n,0,0,p,c);const m=o.toDataURL("image/png");if(m===V1){e(null);return}n.dataset.data=m.slice(v1),n.src=m})})})}function f1(t){return new Promise(async(e)=>{const i=new Image;let n="image/png";if(typeof t==="string")i.src=t;else n=t.type,i.src=`data:${n};base64,${t.data}`;i.addEventListener("load",()=>{i.dataset.data=i.src.slice(`data:${n};base64,`.length),e(i)})})}function I1(t){return new Promise(async(e)=>{const i=new Image;i.src=t,i.addEventListener("load",()=>{const n=document.createElement("canvas");n.width=i.width,n.height=i.height,n.getContext("2d").drawImage(i,0,0,i.width,i.height);const c=n.toDataURL("image/png");i.dataset.data=c.slice(v1),e(i)})})}var v1="data:image/png;base64,".length,V1="data:,";function t1(t=32){const e=[];for(let i=0;i<t;i++)e[i]="0123456789abcdefghijklmnopqrstuvwxyz".charAt(Math.random()*"0123456789abcdefghijklmnopqrstuvwxyz".length);return e.join("")}function W(t){const e=globalThis.document,i=e.createElement("style");i.appendChild(e.createTextNode(t)),e.head.append(i)}W(".K-gn7q_selector-wrapper{background:var(--ui-secondary);width:150px;position:relative}.K-gn7q_selector-items-wrapper{width:150px;min-height:100%;padding-bottom:100px}.K-gn7q_selector-item{width:5rem;height:5rem;margin:.5rem auto}.K-gn7q_delete-menu-item:hover{background:var(--error-primary)}.K-gn7q_add-button-wrapper{background:linear-gradient(transparent,var(--ui-secondary));width:100%;height:100px;display:flex;position:absolute;bottom:0;left:0;right:0}.K-gn7q_add-button{margin:.75rem auto}");var e1={selectorItemsWrapper:"K-gn7q_selector-items-wrapper",selectorWrapper:"K-gn7q_selector-wrapper",selectorItem:"K-gn7q_selector-item",addButtonWrapper:"K-gn7q_add-button-wrapper",deleteMenuItem:"K-gn7q_delete-menu-item",addButton:"K-gn7q_add-button"};var A1="./assets/icon-sprite-zx9m3hdh.svg";var D1="./assets/icon-backdrop-qvqgzqwj.svg";var O1="./assets/icon-surprise-d5t4529a.svg";var z1="./assets/icon-search-6g8kgvdt.svg";var _1="./assets/icon-paint-0h8zs19a.svg";var b1="./assets/icon-file-upload-0z25chr6.svg";import{jsx as a1,jsxs as p5}from"preact/jsx-runtime";function h1({mode:t,imageList:e,imageIndex:i,onSetupLibrary:n}){const[p,c]=p1(!1),[o,u]=p1(!1),[m,v]=p1(!1),{getText:x}=l5(),{createAlert:A,removeAlert:G}=s5(),{addAsset:b,deleteAsset:z,modifyFile:S}=o5(),f=e.map((a)=>a.id),{ImagesLibrary:E,BackdropsLibrary:T,CostumesLibrary:j}=n(),P=()=>{if(t==="costume"){c(!1),u(!0),v(!1);return}if(t==="backdrop"){c(!1),u(!1),v(!0);return}c(!0),u(!1),v(!1)},N=()=>{c(!1),u(!1),v(!1)},w=async({tags:a,...s})=>{const l=t1();A("importing",{id:l});const h=await I1(`./assets/${s.id}.png`);b({...s,id:l,type:"image/png",data:h.dataset.data,width:h.width,height:h.height}),f.push(l),G(l),S({assets:f,frame:f.length-1})},F=()=>{if(t==="costume"){w(j.surprise());return}if(t==="backdrop"){w(T.surprise());return}w(E.surprise())},_=(a,s,l)=>{if(t==="costume")return s;if(t==="backdrop")return l;return a},y=(a)=>`data:${a.type};base64,${a.data}`,R=(a)=>{S({frame:a})},H=()=>{const a=document.createElement("input");a.type="file",a.accept="image/*",a.multiple=!0,a.click(),a.addEventListener("change",async({target:s})=>{const l=t1();A("importing",{id:l});for(let h of s.files){const L=t1(),Y=h.name.slice(0,h.name.lastIndexOf("."));let D=await N1(h);if(!D)A({message:x("pixelPaint.actionButton.uploadError",'Upload "{file}" failed.',{file:h.name})},2000),D={dataset:{data:"iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAAtJREFUGFdjYAACAAAFAAGq1chRAAAAAElFTkSuQmCC"},width:1,height:1};b({id:L,type:"image/png",name:Y,data:D.dataset.data,width:D.width,height:D.height,centerX:Math.floor(D.width/2),centerY:Math.floor(D.height/2)}),f.push(L)}G(l),S({assets:f,frame:f.length-1})})},Z=()=>{const a=t1();b({id:a,type:"image/png",name:x(`pixelPaint.painter.${t}`,t),data:"iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAAtJREFUGFdjYAACAAAFAAGq1chRAAAAAElFTkSuQmCC",width:1,height:1,centerX:1,centerY:1}),f.push(a),S({assets:f,frame:f.length-1})},Q=(a)=>{z(f[a]),f.splice(a,1),S({assets:f,frame:i===0?0:a>i?i:i-1})},r=(a)=>{const s=e[a],l=t1();b({...s,id:l}),f.push(l),S({assets:f,frame:f.length-1})};return p5("div",{className:e1.selectorWrapper,children:[a1(c5,{displayOrder:!0,id:"paint-selector",className:e1.selectorItemsWrapper,items:e.map((a,s)=>({...a,details:`${a.width}\xD7${a.height}`,icon:y(a),order:s,className:e1.selectorItem,contextMenu:[[{label:x("pixelPaint.contextMenu.duplicate","duplicate"),onClick:()=>r(s)},{label:x("pixelPaint.contextMenu.export","export"),disabled:!0}],[{label:x("pixelPaint.contextMenu.delete","delete"),className:e1.deleteMenuItem,disabled:e.length<=1,onClick:()=>Q(s)}]]})),selectedIndex:i,onSelect:R,onDelete:e.length>1&&Q}),a1("div",{className:e1.addButtonWrapper,children:a1(d5,{tooltipPlacement:"right",className:e1.addButton,icon:t==="costume"?A1:D1,tooltip:_(x("pixelPaint.actionButton.image","Choose a Image"),x("pixelPaint.actionButton.costume","Choose a Costume"),x("pixelPaint.actionButton.backdrop","Choose a Backdrop")),onClick:P,moreButtons:[{icon:b1,tooltip:_(x("pixelPaint.actionButton.upload","Upload Image"),x("pixelPaint.actionButton.uploadCostume","Upload Costume"),x("pixelPaint.actionButton.uploadBackdrop","Upload Backdrop")),onClick:H},{icon:O1,tooltip:x("pixelPaint.actionButton.surprise","Surprise"),onClick:F},{icon:_1,tooltip:x("pixelPaint.actionButton.paint","Paint"),onClick:Z},{icon:z1,tooltip:_(x("pixelPaint.actionButton.image","Choose a Image"),x("pixelPaint.actionButton.costume","Choose a Costume"),x("pixelPaint.actionButton.backdrop","Choose a Backdrop")),onClick:P}]})}),p&&E&&a1(E,{onClose:N,onSelect:w}),o&&j&&a1(j,{onClose:N,onSelect:w}),m&&T&&a1(T,{onClose:N,onSelect:w})]})}import{useEffect as T5,useState as q}from"preact/hooks";import{useLocale as W5,useEditor as U5}from"@blockcode/core";import{classNames as U,Text as Z5,Label as m1,BufferedInput as C1,Button as r1}from"@blockcode/ui";class M{static decimalToHex(t){if(t<0)t+=16777216;let e=Number(t).toString(16);return e=`#${"000000".substr(0,6-e.length)}${e}`,e}static decimalToRgb(t){const e=t>>24&255,i=t>>16&255,n=t>>8&255,p=t&255;return{r:i,g:n,b:p,a:e>0?e:255}}static hexToRgb(t){const e=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;t=t.replace(e,(n,p,c,o)=>p+p+c+c+o+o);const i=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return i?{r:parseInt(i[1],16),g:parseInt(i[2],16),b:parseInt(i[3],16)}:null}static rgbToHex(t){return M.decimalToHex(M.rgbToDecimal(t))}static rgbToDecimal(t){return(t.r<<16)+(t.g<<8)+t.b}static hexToDecimal(t){return M.rgbToDecimal(M.hexToRgb(t))}static hsvToRgb(t){let e=t.h%360;if(e<0)e+=360;const i=Math.max(0,Math.min(t.s,1)),n=Math.max(0,Math.min(t.v,1)),p=Math.floor(e/60),c=e/60-p,o=n*(1-i),u=n*(1-i*c),m=n*(1-i*(1-c));let v,x,A;switch(p){default:case 0:v=n,x=m,A=o;break;case 1:v=u,x=n,A=o;break;case 2:v=o,x=n,A=m;break;case 3:v=o,x=u,A=n;break;case 4:v=m,x=o,A=n;break;case 5:v=n,x=o,A=u;break}return{r:Math.floor(v*255),g:Math.floor(x*255),b:Math.floor(A*255)}}static rgbToHsv(t){const e=t.r/255,i=t.g/255,n=t.b/255,p=Math.min(Math.min(e,i),n),c=Math.max(Math.max(e,i),n);let o=0,u=0;if(p!==c){const m=e===p?i-n:i===p?n-e:e-i;o=((e===p?3:i===p?5:1)-m/(c-p))*60%360,u=(c-p)/c}return{h:o,s:u,v:c}}static mixRgb(t,e,i){if(i<=0)return t;if(i>=1)return e;const n=1-i;return{r:n*t.r+i*e.r,g:n*t.g+i*e.g,b:n*t.b+i*e.b}}constructor(t,e=!1){if(this._clear=e,this._color=t,typeof t==="number")this._type="decimal";else if(typeof t==="string"&&t[0]==="#")this._type="hex";else if(Array.isArray(t)){const[i,n,p]=t;if(n<=1&&p<=1)this._type="hsv",this._color={h:i,s:n,v:p};else this._type="rgb",this._color={r:i,g:n,b:p};this._clear=e||t[3]===0}else if(typeof t.r==="number")this._type="rgb";else if(typeof t.h==="number")this._type="hsv"}get clear(){return this._clear}get rgb(){if(this._type==="rgb")return this._color;if(this._type==="decimal")return M.decimalToRgb(this._color);if(this._type==="hsv")return M.hsvToRgb(this._color);if(this._type==="hex")return M.hexToRgb(this._color)}get hsv(){if(this._type==="hsv")return this._color;if(this._type==="decimal")return M.rgbToHsv(M.decimalToRgb(this._color));if(this._type==="rgb")return M.rgbToHsv(this._color);if(this._type==="hex")return M.rgbToHsv(M.hexToRgb(this._color))}get hex(){if(this._type==="hex")return this._color;if(this._type==="decimal")return M.decimalToHex(this._color);if(this._type==="rgb")return M.rgbToHex(this._color);if(this._type==="hsv")return M.rgbToHex(M.hsvToRgb(this._color))}get decimal(){if(this._type==="decimal")this._color;if(this._type==="rgb")return M.rgbToDecimal(this._color);if(this._type==="hsv")return M.rgbToDecimal(M.hsvToRgb(this._color));if(this._type==="hex")return M.hexToDecimal(this._color)}toRGBColor(){if(this._type==="rgb")return this;return new M(this.rgb,this.clear)}toHSVColor(){if(this._type==="hsv")return this;return new M(this.hsv,this.clear)}toHEXColor(){if(this._type==="hex")return this;return new M(this.hex,this.clear)}toDecimalColor(){if(this._type==="decimal")return this;return new M(this.decimal,this.clear)}equals(t){return this.rgb.r===t.rgb.r&&this.rgb.g===t.rgb.g&&this.rgb.b===t.rgb.b&&this.clear===t.clear}notEquals(t){return!this.equals(t)}}function j1(t){const e=h5(t),i=w5(t,e),n=g5(t,e,i),p=u5(t,e,i,n),c={top:e||0,left:n||0,right:p||0,bottom:i||0};return c.width=c.right-c.left+1,c.height=c.bottom-c.top+1,c}var h5=(t)=>{let e;for(let i=0;i<t.height;i++){e=i*t.width;for(let n=0;n<t.width;n++){if(t.data[(e<<2)+3]!==0)return i;e++}}},w5=(t,e)=>{let i;for(let n=t.height-1;n>=e;n--){i=n*t.width;for(let p=0;p<t.width;p++){if(t.data[(i<<2)+3]!==0)return n;i++}}},g5=(t,e,i)=>{let n;for(let p=0;p<t.width;p++)for(let c=e;c<=i;c++)if(n=c*t.width+p,t.data[(n<<2)+3]!==0)return p},u5=(t,e,i,n)=>{let p;for(let c=t.width-1;c>=n;c--)for(let o=e;o<=i;o++)if(p=o*t.width+c,t.data[(p<<2)+3]!==0)return c};function P1(t){const{top:e,left:i,width:n,height:p}=j1(t),c=document.createElement("canvas");c.width=n,c.height=p,c.getContext("2d").putImageData(t,-i,-e,i,e,n,p);const[u,m]=c.toDataURL().slice(5).split(";base64,");return{type:u,data:m,width:n,height:p}}import{classNames as i1,Text as g1,Tooltip as m5}from"@blockcode/ui";W("._Y2YyW_color-picker-wrapper{margin-right:var(--space);cursor:pointer;width:3rem;height:2rem;display:flex}._Y2YyW_color-swatch{border:1px solid var(--ui-black-transparent);border-top-left-radius:var(--form-radius);border-bottom-left-radius:var(--form-radius);flex-shrink:0;flex-basis:2rem;height:100%;display:flex;position:relative}._Y2YyW_color-swatch-outline:after{content:\"\";background:var(--ui-white);border:1px solid var(--ui-black-transparent);z-index:1;width:.75rem;height:.75rem;position:absolute;top:.5rem;left:.5rem}._Y2YyW_picker-arrow{user-select:none;border:1px solid var(--ui-black-transparent);border-top-right-radius:var(--form-radius);border-bottom-right-radius:var(--form-radius);border-left:0;flex-shrink:0;flex-basis:1rem;justify-content:center;align-items:center;height:100%;font-size:.75rem;display:flex}._Y2YyW_color-tooltip{background:var(--ui-white);color:var(--text-primary);padding:calc(var(--space)/2)}._Y2YyW_tooltip-item{margin:8px}._Y2YyW_tooltip-item-label{font-weight:700}._Y2YyW_tooltip-item-readout{margin-left:10px}._Y2YyW_tooltip-item-slider{border-radius:11px;outline:none;width:150px;height:22px;margin-bottom:20px;position:relative}._Y2YyW_tooltip-item-slider-handler{background-color:var(--ui-white);box-shadow:0 0 0 4px var(--ui-black-transparent);touch-action:none;border-radius:100%;width:26px;height:26px;margin-top:-2px;position:absolute;left:100px}._Y2YyW_tooltip-item-toolbar{justify-content:space-between;display:flex}._Y2YyW_tooltip-item-toolbar-button{border:1px solid var(--ui-black-transparent);border-radius:var(--form-radius);cursor:pointer;width:calc(1.5rem + 2px);height:calc(1.5rem + 2px)}._Y2YyW_tooltip-item-toolbar-button._Y2YyW_selected{border:1px solid #855cd6;box-shadow:0 0 0 3px #855cd659}._Y2YyW_button-icon{width:1.5rem;height:1.5rem}");var C={pickerArrow:"_Y2YyW_picker-arrow",tooltipItemToolbarButton:"_Y2YyW_tooltip-item-toolbar-button",tooltipItemSliderHandler:"_Y2YyW_tooltip-item-slider-handler",tooltipItemReadout:"_Y2YyW_tooltip-item-readout",colorPickerWrapper:"_Y2YyW_color-picker-wrapper",tooltipItemLabel:"_Y2YyW_tooltip-item-label",colorSwatch:"_Y2YyW_color-swatch",tooltipItemSlider:"_Y2YyW_tooltip-item-slider",tooltipItemToolbar:"_Y2YyW_tooltip-item-toolbar",selected:"_Y2YyW_selected",colorTooltip:"_Y2YyW_color-tooltip",colorSwatchOutline:"_Y2YyW_color-swatch-outline",tooltipItem:"_Y2YyW_tooltip-item",buttonIcon:"_Y2YyW_button-icon"};var y1="./assets/icon-picker-2frmfa34.svg";var w1="./assets/icon-clear-gctr9axd.svg";import{jsx as O,jsxs as l1,Fragment as k5}from"preact/jsx-runtime";var C5=[0,0,324,288,252,216,180,144,108,72,36,0,0],X=124;function s1({picking:t,color:e,outline:i,onChange:n,onPickColor:p}){const c=e.hsv.h,o=e.hsv.s,u=e.hsv.v,m=(w,F,_,y)=>new M({h:w,s:F,v:_},y),v=(w)=>n(m(Math.round(w*360),o,u)),x=(w)=>n(m(c,w,u)),A=(w)=>n(m(c,o,w)),G=()=>n(m(c,o,u,!0)),b=(w,F)=>{w.stopPropagation();const _=w.target,y=_.offsetLeft,R=w.clientX,H=(Q)=>{Q.preventDefault();let r=Q.clientX-R+y;if(r>=X)r=X;if(r<=0)r=0;_.style.left=`${r}px`,F(r/X)},Z=()=>{document.removeEventListener("mousemove",H),document.removeEventListener("mouseup",Z)};document.addEventListener("mousemove",H),document.addEventListener("mouseup",Z)},z=(w)=>b(w,v),S=(w)=>b(w,x),f=(w)=>b(w,A),E=(w,F)=>{const _=w.target.children[0];let y=w.offsetX-13;if(y>=X)y=X;if(y<=0)y=0;_.style.left=`${y}px`,F(y/X)},T=(w)=>E(w,v),j=(w)=>E(w,x),P=(w)=>E(w,A),N=C5.map((w)=>m(w,o,u).hex);return O(m5,{clickable:!0,placement:"bottom",className:C.colorTooltip,onHide:()=>p(!1),content:l1(k5,{children:[l1("div",{className:C.tooltipItem,children:[O("span",{className:C.tooltipItemLabel,children:O(g1,{id:"pixelPaint.colorPicker.color",defaultMessage:"Color"})}),O("span",{className:C.tooltipItemReadout,children:Math.round(c/360*100)})]}),O("div",{className:i1(C.tooltipItem,C.tooltipItemSlider),style:{background:`linear-gradient(to left, ${N[0]} 0px, ${N[1]} 13px, ${N[2]}, ${N[3]}, ${N[4]}, ${N[5]}, ${N[6]}, ${N[7]}, ${N[8]}, ${N[9]}, ${N[10]}, ${N[11]} 137px, ${N[12]} 100%)`},onClick:T,children:O("div",{className:C.tooltipItemSliderHandler,style:{left:`${Math.round(c/360*X)}px`},onMouseDown:z,onClick:(w)=>w.stopPropagation()})}),l1("div",{className:C.tooltipItem,children:[O("span",{className:C.tooltipItemLabel,children:O(g1,{id:"pixelPaint.colorPicker.saturation",defaultMessage:"Saturation"})}),O("span",{className:C.tooltipItemReadout,children:Math.round(o*100)})]}),O("div",{className:i1(C.tooltipItem,C.tooltipItemSlider),style:{background:`linear-gradient(to right, ${m(c,0,u).hex} 0px, ${m(c,1,u).hex} 100%)`},onClick:j,children:O("div",{className:C.tooltipItemSliderHandler,style:{left:`${Math.round(o*X)}px`},onMouseDown:S,onClick:(w)=>w.stopPropagation()})}),l1("div",{className:C.tooltipItem,children:[O("span",{className:C.tooltipItemLabel,children:O(g1,{id:"pixelPaint.colorPicker.brightness",defaultMessage:"Brightness"})}),O("span",{className:C.tooltipItemReadout,children:Math.round(u*100)})]}),O("div",{className:i1(C.tooltipItem,C.tooltipItemSlider),style:{background:`linear-gradient(to right, ${m(c,o,0).hex} 0px, ${m(c,o,1).hex} 100%)`},onClick:P,children:O("div",{className:C.tooltipItemSliderHandler,style:{left:`${Math.round(u*X)}px`},onMouseDown:f,onClick:(w)=>w.stopPropagation()})}),l1("div",{className:i1(C.tooltipItem,C.tooltipItemToolbar),children:[O("div",{className:i1(C.tooltipItemToolbarButton,{[C.selected]:e.clear}),onClick:G,children:O("img",{src:w1,className:C.buttonIcon})}),O("div",{className:i1(C.tooltipItemToolbarButton,{[C.selected]:t}),onClick:p,children:O("img",{src:y1,className:C.buttonIcon})})]})]}),children:l1("div",{className:C.colorPickerWrapper,children:[O("div",{className:i1(C.colorSwatch,{[C.colorSwatchOutline]:i}),style:{background:e.clear?"var(--ui-white)":m(c,o,u).hex},children:e.clear&&O("img",{src:w1})}),O("div",{className:C.pickerArrow,children:"\u25BE"})]})})}import{useLocale as z5}from"@blockcode/core";import{classNames as J,Button as $}from"@blockcode/ui";W(".zaEMxq_tool-box-wrapper{flex-flow:wrap;place-content:flex-start space-between;width:7rem;display:flex}.zaEMxq_tool-button{margin:calc(var(--space)/2);border-radius:calc(var(--space)/2);padding:calc(var(--space)/2);user-select:none;background:0 0;border:none;outline:none;transition:all .2s;display:inline-block}.zaEMxq_tool-button.zaEMxq_selected{background:var(--motion-primary)}.zaEMxq_tool-icon{vertical-align:middle;width:2rem;height:2rem}.zaEMxq_tool-button.zaEMxq_selected .zaEMxq_tool-icon{filter:brightness(0)invert()}");var I={toolButton:"zaEMxq_tool-button",toolIcon:"zaEMxq_tool-icon",toolBoxWrapper:"zaEMxq_tool-box-wrapper",selected:"zaEMxq_selected"};var o1="./assets/icon-pen-vmav54fy.svg";var c1="./assets/icon-eraser-6exvhk0q.svg";var E1="./assets/icon-fill-70s8y3f8.svg";var B1="./assets/icon-text-e5hysycg.svg";var S1="./assets/icon-line-r61p9edw.svg";var Y1="./assets/icon-rectangle-yasy0y9k.svg";var F1="./assets/icon-circle-ynejmr8k.svg";var T1="./assets/icon-select-7g007t5g.svg";import{jsx as B,jsxs as _5}from"preact/jsx-runtime";function u1({selectedTool:t,onSelect:e}){const{getText:i}=z5();return _5("div",{className:I.toolBoxWrapper,children:[B($,{className:J(I.toolButton,{[I.selected]:t==="pen"}),onClick:()=>e("pen"),children:B("img",{src:o1,className:I.toolIcon,title:i("pixelPaint.painter.pen","Pen")})}),B($,{className:J(I.toolButton,{[I.selected]:t==="eraser"}),onClick:()=>e("eraser"),children:B("img",{src:c1,className:I.toolIcon,title:i("pixelPaint.painter.eraser","Eraser")})}),B($,{className:J(I.toolButton,{[I.selected]:t==="fill"}),onClick:()=>e("fill"),children:B("img",{src:E1,className:I.toolIcon,title:i("pixelPaint.painter.fill","Fill")})}),B($,{disabled:!0,className:J(I.toolButton,{[I.selected]:t==="text"}),onClick:()=>e("text"),children:B("img",{src:B1,className:I.toolIcon,title:i("pixelPaint.painter.text","Text")})}),B($,{disabled:!0,className:J(I.toolButton,{[I.selected]:t==="line"}),onClick:()=>e("line"),children:B("img",{src:S1,className:I.toolIcon,title:i("pixelPaint.painter.line","Line")})}),B($,{disabled:!0,className:J(I.toolButton,{[I.selected]:t==="rectangle"}),onClick:()=>e("rectangle"),children:B("img",{src:Y1,className:I.toolIcon,title:i("pixelPaint.painter.rectangle","Rectangle")})}),B($,{disabled:!0,className:J(I.toolButton,{[I.selected]:t==="circle"}),onClick:()=>e("circle"),children:B("img",{src:F1,className:I.toolIcon,title:i("pixelPaint.painter.circle","Circle")})}),B($,{disabled:!0,className:J(I.toolButton,{[I.selected]:t==="select"}),onClick:()=>e("select"),children:B("img",{src:T1,className:I.toolIcon,title:i("pixelPaint.painter.select","Select")})})]})}import{useRef as j5,useEffect as W1,useState as P5}from"preact/hooks";import{classNames as U1}from"@blockcode/ui";W("._1X3Adq_draw-box{background:var(--ui-secondary);width:100%;height:100%;display:flex;position:absolute;top:0;left:0;overflow:auto}._1X3Adq_draw-canvas-wrapper{margin:auto;position:relative}._1X3Adq_draw-canvas{image-rendering:pixelated;background:url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+CjwhLS0gQ3JlYXRlZCB3aXRoIFZlY3Rvcm5hdG9yIChodHRwOi8vdmVjdG9ybmF0b3IuaW8vKSAtLT4KPHN2ZyBoZWlnaHQ9IjMwIiB3aWR0aD0iMzAiIHN0cm9rZS1taXRlcmxpbWl0PSIxMCIgc3R5bGU9ImZpbGwtcnVsZTpub256ZXJvO2NsaXAtcnVsZTpldmVub2RkO3N0cm9rZS1saW5lY2FwOnJvdW5kO3N0cm9rZS1saW5lam9pbjpyb3VuZDsiIHZlcnNpb249IjEuMSIgdmlld0JveD0iMCAwIDQwIDQwIiB4bWw6c3BhY2U9InByZXNlcnZlIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIj4KPGRlZnMvPgo8Zz4KPHBhdGggZD0iTTAgMEw0MCAwTDQwIDQwTDAgNDBMMCAwWiIgZmlsbD0iI2ZmZmZmZiIgZmlsbC1ydWxlPSJub256ZXJvIiBvcGFjaXR5PSIxIiBzdHJva2U9Im5vbmUiLz4KPHBhdGggZD0iTTAgMEwyMCAwTDIwIDIwTDAgMjBMMCAwWiIgZmlsbD0iI2VhZjBmOCIgZmlsbC1ydWxlPSJub256ZXJvIiBvcGFjaXR5PSIxIiBzdHJva2U9Im5vbmUiLz4KPHBhdGggZD0iTTIwIDIwTDQwIDIwTDQwIDQwTDIwIDQwTDIwIDIwWiIgZmlsbD0iI2VhZjBmOCIgZmlsbC1ydWxlPSJub256ZXJvIiBvcGFjaXR5PSIxIiBzdHJva2U9Im5vbmUiLz4KPC9nPgo8L3N2Zz4K);width:320px;height:240px}._1X3Adq_draw-canvas._1X3Adq_center{cursor:crosshair}._1X3Adq_draw-canvas._1X3Adq_picker{cursor:url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+Cjxzdmcgd2lkdGg9IjIwcHgiIGhlaWdodD0iMjBweCIgdmlld0JveD0iMCAwIDIwIDIwIiB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiPgogICAgPCEtLSBHZW5lcmF0b3I6IFNrZXRjaCA0My4yICgzOTA2OSkgLSBodHRwOi8vd3d3LmJvaGVtaWFuY29kaW5nLmNvbS9za2V0Y2ggLS0+CiAgICA8dGl0bGU+ZXllLWRyb3BwZXI8L3RpdGxlPgogICAgPGRlc2M+Q3JlYXRlZCB3aXRoIFNrZXRjaC48L2Rlc2M+CiAgICA8ZGVmcz48L2RlZnM+CiAgICA8ZyBpZD0iUGFnZS0xIiBzdHJva2U9Im5vbmUiIHN0cm9rZS13aWR0aD0iMSIgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIj4KICAgICAgICA8ZyBpZD0iZXllLWRyb3BwZXIiIGZpbGw9IiM1NzVFNzUiPgogICAgICAgICAgICA8cGF0aCBkPSJNOS4xNTMzNDYwNSwxMi40ODI0OTYyIEM5LjAzMzk0MDQ0LDEyLjYxODg3MzcgOC44ODA0MTg5NSwxMi43MDQxMDk2IDguNjA3NDkxODYsMTIuNzcyMjk4MyBDNy45MDgxMTYxOCwxMi45MjU3MjMgNy4yNDI4NTYzOSwxMy41NTY0Njg4IDcuMDM4MTYxMDcsMTQuMjU1NDAzMyBDNi45Njk5MjkzLDE0LjQ3NzAxNjcgNi43NDgxNzYwMywxNC43MTU2NzczIDYuNTA5MzY0ODMsMTQuODM1MDA3NiBMNC43MzUzMzg3MSwxNS42NzAzMTk2IEM0LjY1MDA0OSwxNS43MDQ0MTQgNC41ODE4MTcyMiwxNS43MjE0NjEyIDQuNTQ3NzAxMzQsMTUuNzIxNDYxMiBMNC4yNzQ3NzQyNCwxNS40NjU3NTM0IEM0LjI3NDc3NDI0LDE1LjQ0ODcwNjIgNC4yNzQ3NzQyNCwxNS4zODA1MTc1IDQuMzI1OTQ4MDcsMTUuMjYxMTg3MiBMNS4xNjE3ODczLDEzLjQ3MTIzMjkgQzUuMjY0MTM0OTYsMTMuMjQ5NjE5NSA1LjUwMjk0NjE3LDEzLjAyODAwNjEgNS43NDE3NTczNywxMi45NTk4MTc0IEM2LjQ0MTEzMzA1LDEyLjczODIwNCA3LjA3MjI3Njk2LDEyLjA5MDQxMSA3LjI1OTkxNDMzLDExLjIzODA1MTggQzcuMjk0MDMwMjIsMTEuMTAxNjc0MyA3LjM3OTMxOTk0LDEwLjk2NTI5NjggNy40OTg3MjU1NCwxMC44Mjg5MTkzIEwxMS40MzkxMTA1LDYuOTA4MDY2OTcgTDEzLjA5MzczMSw4LjU2MTY0Mzg0IEw5LjE1MzM0NjA1LDEyLjQ4MjQ5NjIgWiBNMTYuNjA3NjY3Myw1LjI4ODU4NDQ3IEMxNi44NjM1MzY1LDUuMDMyODc2NzEgMTcsNC42NzQ4ODU4NCAxNyw0LjMzMzk0MjE2IEMxNywzLjk5Mjk5ODQ4IDE2Ljg2MzUzNjUsMy42NTIwNTQ3OSAxNi42MDc2NjczLDMuMzk2MzQ3MDMgQzE2LjA3ODg3MTEsMi44Njc4ODQzMiAxNS4yNDMwMzE4LDIuODY3ODg0MzIgMTQuNzE0MjM1NiwzLjM5NjM0NzAzIEwxMy4yMzAxOTQ1LDQuODc5NDUyMDUgTDEzLjA1OTYxNTEsNC43MDg5ODAyMSBMMTIuNTEzNzYwOSw0LjE2MzQ3MDMyIEMxMi4xNzI2MDIsMy44MjI1MjY2NCAxMS42MDk2ODk5LDMuODIyNTI2NjQgMTEuMjY4NTMxLDQuMTYzNDcwMzIgTDEwLjYwMzI3MTIsNC44MTEyNjMzMiBDMTAuMjc5MTcwMyw1LjE1MjIwNyAxMC4yNjIxMTI0LDUuNjQ2NTc1MzQgMTAuNTUyMDk3NCw1Ljk4NzUxOTAzIEw2LjU5NDY1NDU0LDkuOTI1NDE4NTcgQzYuMzA0NjY5NTEsMTAuMjMyMjY3OSA2LjA5OTk3NDE4LDEwLjU5MDI1ODggNS45ODA1Njg1OCwxMS4xMDE2NzQzIEM1LjkyOTM5NDc1LDExLjM1NzM4MiA1LjYzOTQwOTcxLDExLjY0NzE4NDIgNS4zNjY0ODI2MiwxMS43MzI0MjAxIEM0LjgwMzU3MDQ5LDExLjkwMjg5MTkgNC4yNTc3MTYzLDEyLjM4MDIxMzEgNC4wMDE4NDcxNSwxMi45NDI3NzAyIEwzLjE2NjAwNzkyLDE0LjcxNTY3NzMgQzIuODkzMDgwODMsMTUuMzEyMzI4OCAyLjk2MTMxMjYsMTUuOTI2MDI3NCAzLjMzNjU4NzM2LDE2LjMxODExMjYgTDMuNjc3NzQ2MjMsMTYuNjU5MDU2MyBDMy44OTk0OTk0OSwxNi44ODA2Njk3IDQuMjA2NTQyNDcsMTcgNC41NDc3MDEzNCwxNyBDNC43Njk0NTQ2LDE3IDUuMDI1MzIzNzUsMTYuOTMxODExMyA1LjI2NDEzNDk2LDE2LjgyOTUyODIgTDcuMDU1MjE5MDEsMTUuOTk0MjE2MSBDNy42MTgxMzExNCwxNS43MjE0NjEyIDguMDk1NzUzNTYsMTUuMTkyOTk4NSA4LjI2NjMzMjk5LDE0LjYzMDQ0MTQgQzguMzM0NTY0NzcsMTQuMzU3Njg2NSA4LjY0MTYwNzc1LDE0LjA2Nzg4NDMgOS4wNTA5OTgzOSwxMy45ODI2NDg0IEM5LjQwOTIxNTIsMTMuODk3NDEyNSA5Ljc2NzQzMjAxLDEzLjY5Mjg0NjMgMTAuMDU3NDE3LDEzLjM4NTk5NyBMMTQuMDE0ODU5OSw5LjQ0ODA5NzQxIEMxNC4zNTYwMTg4LDkuNzM3ODk5NTQgMTQuODY3NzU3MSw5LjcwMzgwNTE4IDE1LjE3NDgwMDEsOS4zNzk5MDg2OCBMMTUuODQwMDU5OSw4LjczMjExNTY4IEMxNi4xODEyMTg3LDguMzkxMTcxOTkgMTYuMTgxMjE4Nyw3LjgyODYxNDkyIDE1Ljg0MDA1OTksNy40ODc2NzEyMyBMMTUuMjYwMDg5OCw2LjkwODA2Njk3IEwxNS4xMjM2MjYyLDYuNzcxNjg5NSBMMTYuNjA3NjY3Myw1LjI4ODU4NDQ3IFoiIGlkPSJleWUtZHJvcHBlci1pY29uIj48L3BhdGg+CiAgICAgICAgPC9nPgogICAgPC9nPgo8L3N2Zz4=) 4 15,crosshair}._1X3Adq_center-icon{pointer-events:none;filter:opacity(.5);position:absolute;top:0;left:0;transform:translate(-50%,-50%)}._1X3Adq_center-icon._1X3Adq_hidden{display:none}");var V={drawCanvasWrapper:"_1X3Adq_draw-canvas-wrapper",centerIcon:"_1X3Adq_center-icon",hidden:"_1X3Adq_hidden",drawBox:"_1X3Adq_draw-box",center:"_1X3Adq_center",drawCanvas:"_1X3Adq_draw-canvas",picker:"_1X3Adq_picker"};var d1="./assets/icon-center-bzxv0qgf.svg";import{jsx as x1,jsxs as y5}from"preact/jsx-runtime";function M1({image:t,selectedTool:e,zoom:i,undoList:n,onChange:p,onChangeColor:c}){const o=j5(),[u,m]=P5(),v=(d.DrawWidth-t.width)/2+t.centerX,x=(d.DrawHeight-t.height)/2+t.centerY,A=e.fillColor||new M([0,0,0]),G=e.outlineColor||new M([0,0,0]);let b,z;const S=()=>{z=u.getImageData(0,0,d.DrawWidth,d.DrawHeight)},f=(r=0,a=0)=>{u.clearRect(0,0,d.DrawWidth,d.DrawHeight),u.putImageData(z,r,a)},E=()=>{p({data:z}),z=null},T=()=>{let r=new OffscreenCanvas(d.DrawWidth,d.DrawHeight),a=r.getContext("2d",{willReadFrequently:!0});a.imageSmoothingEnabled=!1,a.putImageData(n.at(-1),0,0),z=a.getImageData(0,0,d.DrawWidth,d.DrawHeight),a=null,r=null},j=(r,a)=>{if(r.invalid)return;const s=r.index;z.data[s+0]=a.r,z.data[s+1]=a.g,z.data[s+2]=a.b,z.data[s+3]=a.a===0?0:255},P=(r,a,s,l)=>{j(new d(r.x-a,r.y+s),l),j(new d(r.x+a,r.y+s),l),j(new d(r.x+a,r.y-s),l),j(new d(r.x-a,r.y-s),l),j(new d(r.x-s,r.y+a),l),j(new d(r.x+s,r.y+a),l),j(new d(r.x+s,r.y-a),l),j(new d(r.x-s,r.y-a),l)},N=(r,a,s)=>{const l=Math.abs(a.x-r.x),h=Math.abs(a.y-r.y),L=r.x<a.x?1:-1,Y=r.y<a.y?1:-1,D=new d(r.x,r.y);let n1=l-h;while(!0){if(j(D,s),D.x===a.x&&D.y===a.y)break;const L1=2*n1;if(L1>-h)n1-=h,D.x+=L;if(L1<l)n1+=l,D.y+=Y}},w=(r,a,s)=>{let l=r.x,h=a.x,L=r.y,Y=a.y;if(s.outline){const D=new d(h,L),n1=new d(l,Y);N(r,D,s.outline),N(a,n1,s.outline),N(D,a,s.outline),N(n1,r,s.outline),l+=1,h-=1,L+=1,Y-=1}if(s.fill)for(let D=L;D<=Y;D++)N(new d(l,D),new d(h,D),s.fill)},F=(r,a,s)=>{let l=0,h=a,L=3-2*a;while(l<=h){if(s.fill)for(let Y=l;Y<=h;Y++)P(r,l,Y,s.fill);if(s.outline)P(r,l,h,s.outline);if(L<0)L=L+4*l+6;else L=L+4*(l-h),h--;l++}},_=(r)=>{if(r.invalid)return;const a={clear:A.clear,fill:A.rgb,outline:!1};if(a.clear||e.type==="eraser"){if(a.fill.a=0,!b)a.fill={r:255,g:255,b:255},a.outline={r:138,g:187,b:255}}if(e.penSize===1)j(r,!b&&(a.clear||e.type==="eraser")?a.outline:a.fill);else if(e.penSize===3)w(new d(r.x-1,r.y-1),new d(r.x+1,r.y+1),a);else if(e.penSize<5){const s=e.penSize/2;w(new d(r.x-s,r.y-s),new d(r.x+s-1,r.y+s-1),a)}else F(r,Math.floor((e.penSize-1)/2),a)},y=(r)=>{if(r.invalid)return;const a=new M(Array.from(z.data.slice(r.index,r.index+4))),s=[],l=(h)=>{if(h.invalid)return;if(!s.includes(h.index)){const L=new M(Array.from(z.data.slice(h.index,h.index+4)));if(L.equals(a)&&L.notEquals(A))s.push(h.index)}};l(r);while(s.length>0){const h=s.shift();z.data[h+0]=A.rgb.r,z.data[h+1]=A.rgb.g,z.data[h+2]=A.rgb.b,z.data[h+3]=A.clear?0:255,r=d.from(h),l(r.topPoint),l(r.leftPoint),l(r.rightPoint),l(r.bottomPoint)}},R=(r)=>{if(r.preventDefault(),!o.current)return;b=!0;const a=o.current.getBoundingClientRect();let s=r.clientX-a.left,l=r.clientY-a.top;if(s=Math.floor(d.DrawWidth*s/o.current.clientWidth),l=Math.floor(d.DrawHeight*l/o.current.clientHeight),e.type==="pen"||e.type==="eraser"||e.type==="fill"){const L=new d(s,l);if(S(),e.type==="pen"||e.type==="eraser")_(L);else if(e.type==="fill")y(L);f()}else if(e.type.startsWith("picker-"))r.stopPropagation();else if(e.type.startsWith("center")){const L=Math.floor(s-(d.DrawWidth-t.width)/2),Y=Math.floor(l-(d.DrawHeight-t.height)/2);p({centerX:L,centerY:Y})}const h=()=>{if(b)b=!1,E();document.removeEventListener("mouseup",h)};document.addEventListener("mouseup",h)},H=(r)=>{if(r.preventDefault(),!o.current)return;if(e.type==="center")return;const a=o.current.getBoundingClientRect();let s=r.clientX-a.left,l=r.clientY-a.top;if(s=Math.floor(d.DrawWidth*s/o.current.clientWidth),l=Math.floor(d.DrawHeight*l/o.current.clientHeight),e.type==="pen"||e.type==="eraser"){const h=new d(s,l);if(!b)T();else S();if(e.type==="pen"||e.type==="eraser")_(h);f()}else if(e.type.startsWith("picker-"));},Z=(r)=>{if(r.preventDefault(),b=!1,e.type==="center"){E();return}const a=o.current.getBoundingClientRect();let s=r.clientX-a.left,l=r.clientY-a.top;if(s=Math.floor(d.DrawWidth*s/o.current.clientWidth),l=Math.floor(d.DrawHeight*l/o.current.clientHeight),e.type.startsWith("picker-")){const[h,L,Y,D]=u.getImageData(s,l,1,1).data;if(D===0){if(e.type==="picker-fill")c(new M(A.hsv,!0));if(e.type==="picker-outline")c(new M(G.hsv,!0))}else c(new M({r:h,g:L,b:Y}).toHSVColor());return}if(E(),e.type==="eraser")T(),_(new d(s,l)),f()},Q=(r)=>{if(r.preventDefault(),!b)T(),f()};if(W1(()=>{if(o.current){const r=o.current.getContext("2d",{willReadFrequently:!0});r.imageSmoothingEnabled=!1,m(r)}},[o]),W1(()=>{if(o.current){const r=o.current.parentElement.parentElement;let a=(o.current.clientWidth-r.clientWidth)/2,s=(o.current.clientHeight-r.clientHeight)/2;if(i>2){const h=r.clientWidth/2;if(a=(r.scrollLeft+h)/r.dataset.scrollWidth*o.current.clientWidth-h,i>4){const L=r.clientHeight/2;s=(r.scrollTop+L)/r.dataset.scrollHeight*o.current.clientHeight-L}}r.dataset.scrollWidth=o.current.clientWidth,r.dataset.scrollHeight=o.current.clientHeight,r.scroll({top:s>0?s:0,left:a>0?a:0});const l=o.current.nextSibling;l.style.top=`${x*i}px`,l.style.left=`${v*i}px`}},[i]),u&&n.length===0)if(t)f1(t).then((r)=>{const a=(d.DrawWidth-t.width)/2,s=(d.DrawHeight-t.height)/2;u.clearRect(0,0,d.DrawWidth,d.DrawHeight),u.drawImage(r,a,s),S(),E()});else S(),E();if(u&&n.length>0)T(),f();return x1("div",{className:V.drawBox,children:y5("div",{className:V.drawCanvasWrapper,children:[x1("canvas",{ref:o,className:U1(V.drawCanvas,{[V.center]:e.type==="center",[V.picker]:e.type.startsWith("picker-")}),width:d.DrawWidth,height:d.DrawHeight,style:{width:d.DrawWidth*i,height:d.DrawHeight*i},onMouseDown:R,onMouseMove:H,onMouseUp:Z,onMouseLeave:Q}),x1("img",{src:d1,className:U1(V.centerIcon,{[V.hidden]:e.type!=="center"}),style:{top:`${x*i}px`,left:`${v*i}px`}})]})})}W(".KOzPOa_painter-wrapper{padding:calc(var(--space)*1.5);border-left:1px solid var(--ui-black-transparent);color:var(--text-primary);flex-direction:column;flex:1;display:flex}.KOzPOa_row{min-height:3rem;margin-bottom:.5rem;display:flex}.KOzPOa_row-fill{padding-top:calc(var(--space)*2.5);border-top:1px dashed var(--ui-black-transparent);flex-direction:row;flex:1}.KOzPOa_row-bottom{margin-right:var(--space);margin-left:calc(7em + var(--space));justify-content:space-between}.KOzPOa_row:last-child{min-height:unset;margin-bottom:0}.KOzPOa_tool-group{margin-right:calc(var(--space)*1.5);flex-direction:row;align-items:center;display:inline-flex}.KOzPOa_disabled{opacity:.3;pointer-events:none}.KOzPOa_dashed-border{border-right:1px dashed var(--ui-black-transparent);padding-right:var(--space)}.KOzPOa_name-input{width:8rem}.KOzPOa_large-input{width:4rem}.KOzPOa_tool-icon{margin-right:var(--space);width:2rem;height:2rem}.KOzPOa_label-image{vertical-align:middle;margin-right:calc(var(--space)/2)}.KOzPOa_button{width:calc(2rem + 2px);height:calc(2rem + 2px);padding:.375rem}.KOzPOa_text-button{height:calc(2rem + 2px);padding:.375rem}.KOzPOa_button-icon{width:1.5rem;margin:auto}.KOzPOa_simple-group{display:inline-flex}.KOzPOa_group-button{border-left:none;border-radius:0}.KOzPOa_group-button-first{border-top-right-radius:0;border-bottom-right-radius:0}.KOzPOa_group-button-last{border-left:none;border-top-left-radius:0;border-bottom-left-radius:0}.KOzPOa_group-button-toggled-off{filter:saturate(0)}.KOzPOa_label-button{border:0;font-weight:400}.KOzPOa_label-button.KOzPOa_selected{background:var(--motion-primary);color:var(--ui-white)}.KOzPOa_label-button.KOzPOa_selected .KOzPOa_button-icon{filter:brightness(0)invert()}.KOzPOa_draw-box-wrapper{margin:0 var(--space);border:1px solid var(--ui-black-transparent);border-radius:calc(var(--space)/2);flex:1;position:relative;overflow:hidden}");var g={largeInput:"KOzPOa_large-input",rowFill:"KOzPOa_row-fill",nameInput:"KOzPOa_name-input",labelImage:"KOzPOa_label-image",groupButton:"KOzPOa_group-button",painterWrapper:"KOzPOa_painter-wrapper",buttonIcon:"KOzPOa_button-icon",disabled:"KOzPOa_disabled",button:"KOzPOa_button",groupButtonToggledOff:"KOzPOa_group-button-toggled-off",toolIcon:"KOzPOa_tool-icon",row:"KOzPOa_row",dashedBorder:"KOzPOa_dashed-border",rowBottom:"KOzPOa_row-bottom",textButton:"KOzPOa_text-button",simpleGroup:"KOzPOa_simple-group",groupButtonLast:"KOzPOa_group-button-last",groupButtonFirst:"KOzPOa_group-button-first",labelButton:"KOzPOa_label-button",toolGroup:"KOzPOa_tool-group",selected:"KOzPOa_selected",drawBoxWrapper:"KOzPOa_draw-box-wrapper"};var Z1="./assets/icon-undo-q4nwvpxj.svg";var Q1="./assets/icon-redo-mrvqwv38.svg";var K1="./assets/icon-zoom-in-s316e3qy.svg";var G1="./assets/icon-zoom-out-y9xmwx8c.svg";var R1="./assets/icon-zoom-reset-xne8n5sw.svg";import{jsx as k,jsxs as K}from"preact/jsx-runtime";var H1=(t,e=0,i=1/0)=>{return Math.min(Math.max(e,t),i)};function k1({mode:t,imageList:e,imageIndex:i}){const{getText:n,maybeLocaleText:p}=W5(),{modifyAsset:c}=U5(),[o,u]=q(1),[m,v]=q("draw"),[x,A]=q("pen"),[G,b]=q(10),[z,S]=q(2),[f,E]=q(new M([260,0.6,1])),[T,j]=q(new M([0,1,0])),[P,N]=q([]),[w,F]=q([]),_=e[i],y=_&&_.id,R=!y,H=(l,h,L)=>{if(t==="costume")return h;if(t==="backdrop")return L;return l},Z=(l)=>{if(l.id=y,l.data){const h=P1(l.data);l.type=h.type,l.data=h.data,l.width=h.width,l.height=h.height}c(l)},Q=(l)=>{if(l.data){if(P.length>20)P.splice(1,1);if(N(P.concat(l.data)),F([]),P.length===0)return}if(Z(l),m!=="draw")v("draw")},r=(l)=>{if(m==="picker-fill")E(l);if(m==="picker-outline")j(l)},a=()=>{const l=P.pop();N(P),F(w.concat(l)),Z({data:P.at(-1)})},s=()=>{const l=w.pop();N(P.concat(l)),F(w),Z({data:l})};return T5(()=>{return N([]),F([]),v("draw"),()=>{}},[y]),K("div",{className:g.painterWrapper,children:[K("div",{className:g.row,children:[k("div",{className:g.toolGroup,children:k(m1,{text:H(n("pixelPaint.painter.image","Image"),n("pixelPaint.painter.costume","Costume"),n("pixelPaint.painter.backdrop","Backdrop")),children:k(C1,{disabled:R,className:g.nameInput,placeholder:n("pixelPaint.painter.name","name"),onSubmit:(l)=>Q({name:l}),value:_?p(_.name):H(n("pixelPaint.painter.image","Image"),n("pixelPaint.painter.costume","Costume"),n("pixelPaint.painter.backdrop","Backdrop"))})})}),K("div",{className:g.toolGroup,children:[k(r1,{disabled:P.length<=1,className:U(g.button,g.groupButtonFirst,{[g.groupButtonToggledOff]:R}),onClick:a,children:k("img",{src:Z1,className:g.buttonIcon,title:n("pixelPaint.painter.undo","Undo")})}),k(r1,{disabled:w.length===0,className:U(g.button,g.groupButtonLast,{[g.groupButtonToggledOff]:R}),onClick:s,children:k("img",{src:Q1,className:g.buttonIcon,title:n("pixelPaint.painter.redo","Redo")})})]}),k("div",{className:g.toolGroup,children:t==="costume"&&K(r1,{vertical:!0,className:U(g.labelButton,{[g.selected]:m==="center"}),onClick:()=>v(m!=="center"?"center":"draw"),children:[k("img",{src:d1,className:g.buttonIcon,title:n("pixelPaint.painter.center","Center")}),k("span",{children:n("pixelPaint.painter.center","Center")})]})})]}),K("div",{className:g.row,children:[k("div",{className:g.toolGroup,children:k(m1,{text:n("pixelPaint.painter.fill","Fill"),children:k(s1,{picking:m.startsWith("picker-"),color:f,onChange:E,onPickColor:(l)=>v(l===!1?"draw":"picker-fill")})})}),K("div",{className:U(g.toolGroup,g.dashedBorder),children:[k(m1,{className:U({[g.disabled]:!0}),text:n("pixelPaint.painter.outline","Outline"),children:k(s1,{outline:!0,picking:m.startsWith("picker-"),color:T,onChange:j,onPickColor:(l)=>v(l===!1?"draw":"picker-outline")})}),k(C1,{small:!0,type:"number",className:U(g.largeInput,{[g.disabled]:!0}),value:z,onSubmit:(l)=>S(H1(l,0,100))})]}),x==="pen"||x==="eraser"?K("div",{className:g.toolGroup,children:[k("img",{src:x==="pen"?o1:c1,className:g.toolIcon}),k(C1,{small:!0,type:"number",className:g.largeInput,value:G,onSubmit:(l)=>b(H1(l,1,100))})]}):null]}),K("div",{className:U(g.row,g.rowFill),children:[k(u1,{selectedTool:x,onSelect:A}),k("div",{className:g.drawBoxWrapper,children:k(M1,{image:_,zoom:o,selectedTool:{fillColor:f,outlineColor:T,penSize:G,outlineSize:z,type:m==="draw"?x:m},undoList:P,onChange:(l)=>Q(l),onChangeColor:r})})]}),K("div",{className:U(g.row,g.rowBottom),children:[k("div",{className:g.simpleGroup,children:t==="backdrop"&&k(r1,{disabled:!0,className:g.textButton,children:k(Z5,{id:"pixelPaint.mode.tileMap",defaultMessage:"Convert to TileMap"})})}),K("div",{className:g.simpleGroup,children:[k(r1,{className:U(g.button,g.groupButtonFirst),onClick:()=>o-1>0&&u(o-1),children:k("img",{src:G1,className:g.buttonIcon})}),k(r1,{className:U(g.button,g.groupButton),onClick:()=>u(1),children:k("img",{src:R1,className:g.buttonIcon})}),k(r1,{className:U(g.button,g.groupButtonLast),onClick:()=>o+1<20&&u(o+1),children:k("img",{src:K1,className:g.buttonIcon})})]})]})]})}W(".gJa9lW_pixel-paint-wrapper{background:var(--ui-white);border-radius:inherit;flex-grow:1;display:flex}");var X1={pixelPaintWrapper:"gJa9lW_pixel-paint-wrapper"};function K5({onSetupLibrary:t}){const{fileList:e,assetList:i,selectedFileId:n}=Q5();let p=i.filter((u)=>/^image\//.test(u.type)),c="image";const o=e.find((u)=>u.id===n);if(o&&o.assets&&o.frame!=null)p=p.filter((u)=>o.assets.includes(u.id)),c=n===e[0].id?"backdrop":"costume";return G5("div",{className:X1.pixelPaintWrapper,children:[q1(h1,{mode:c,imageList:p,imageIndex:o.frame,onSetupLibrary:t}),q1(k1,{mode:c,imageIndex:o.frame,imageList:p})]})}import{jsx as q1,jsxs as G5}from"preact/jsx-runtime";var J1={"pixelPaint.contextMenu.duplicate":"duplicate","pixelPaint.contextMenu.export":"export","pixelPaint.contextMenu.delete":"delete","pixelPaint.actionButton.upload":"Upload Image","pixelPaint.actionButton.uploadCostume":"Upload Costume","pixelPaint.actionButton.uploadBackdrop":"Upload Backdrop","pixelPaint.actionButton.uploadError":"Upload \"{file}\" failed.","pixelPaint.actionButton.surprise":"Surprise","pixelPaint.actionButton.paint":"Paint","pixelPaint.actionButton.image":"Choose a Image","pixelPaint.actionButton.costume":"Choose a Costume","pixelPaint.actionButton.backdrop":"Choose a Backdrop","pixelPaint.painter.image":"Image","pixelPaint.painter.costume":"Costume","pixelPaint.painter.backdrop":"Backdrop","pixelPaint.painter.name":"name","pixelPaint.painter.undo":"Undo","pixelPaint.painter.redo":"Redo","pixelPaint.painter.pen":"Pen","pixelPaint.painter.eraser":"Eraser","pixelPaint.painter.fill":"Fill","pixelPaint.painter.text":"Text","pixelPaint.painter.line":"Line","pixelPaint.painter.rectangle":"Rectangle","pixelPaint.painter.circle":"Circle","pixelPaint.painter.select":"Select","pixelPaint.painter.center":"Center","pixelPaint.painter.outline":"Outline","pixelPaint.colorPicker.color":"Color","pixelPaint.colorPicker.saturation":"Saturation","pixelPaint.colorPicker.brightness":"Brightness","pixelPaint.mode.pixel":"Convert to Bitmap","pixelPaint.mode.tileMap":"Convert to TileMap"};var $1={"pixelPaint.contextMenu.duplicate":"\u590D\u5236","pixelPaint.contextMenu.export":"\u5BFC\u51FA","pixelPaint.contextMenu.delete":"\u5220\u9664","pixelPaint.actionButton.upload":"\u4E0A\u4F20\u56FE\u7247","pixelPaint.actionButton.uploadCostume":"\u4E0A\u4F20\u9020\u578B","pixelPaint.actionButton.uploadBackdrop":"\u4E0A\u4F20\u80CC\u666F","pixelPaint.actionButton.uploadError":"\u4E0A\u4F20\u201C{file}\u201D\u5931\u8D25\u3002","pixelPaint.actionButton.surprise":"\u968F\u673A","pixelPaint.actionButton.paint":"\u7ED8\u5236","pixelPaint.actionButton.image":"\u9009\u62E9\u4E00\u4E2A\u56FE\u7247","pixelPaint.actionButton.costume":"\u9009\u62E9\u4E00\u4E2A\u9020\u578B","pixelPaint.actionButton.backdrop":"\u9009\u62E9\u4E00\u4E2A\u80CC\u666F","pixelPaint.painter.image":"\u56FE\u7247","pixelPaint.painter.costume":"\u9020\u578B","pixelPaint.painter.backdrop":"\u80CC\u666F","pixelPaint.painter.name":"\u540D\u5B57","pixelPaint.painter.undo":"\u64A4\u9500","pixelPaint.painter.redo":"\u91CD\u505A","pixelPaint.painter.pen":"\u753B\u7B14","pixelPaint.painter.eraser":"\u6A61\u76AE\u64E6","pixelPaint.painter.fill":"\u586B\u5145","pixelPaint.painter.text":"\u6587\u672C","pixelPaint.painter.line":"\u7EBF\u6BB5","pixelPaint.painter.rectangle":"\u77E9\u5F62","pixelPaint.painter.circle":"\u5706\u5F62","pixelPaint.painter.select":"\u9009\u62E9","pixelPaint.painter.center":"\u4E2D\u5FC3","pixelPaint.painter.outline":"\u8F6E\u5ED3","pixelPaint.colorPicker.color":"\u989C\u8272","pixelPaint.colorPicker.saturation":"\u9971\u548C\u5EA6","pixelPaint.colorPicker.brightness":"\u4EAE\u5EA6","pixelPaint.mode.pixel":"\u8F6C\u6362\u4E3A\u4F4D\u56FE","pixelPaint.mode.tileMap":"\u8F6C\u6362\u4E3A TileMap"};var t4={en:J1,"zh-Hans":$1};export{t4 as locales,K5 as PixelPaint};
