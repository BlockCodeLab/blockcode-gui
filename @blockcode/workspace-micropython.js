var x1=Object.create;var{defineProperty:v1,getPrototypeOf:y1,getOwnPropertyNames:I1}=Object;var j1=Object.prototype.hasOwnProperty;var K0=(I,x,j)=>{j=I!=null?x1(y1(I)):{};const o=x||!I||!I.__esModule?v1(j,"default",{value:I,enumerable:!0}):j;for(let P of I1(I))if(!j1.call(o,P))v1(o,P,{get:()=>I[P],enumerable:!0});return o};var U0=(I,x)=>()=>(x||I((x={exports:{}}).exports,x),x.exports);var C1=U0((T0,u0)=>{(function(I,x){if(typeof T0=="object"&&typeof u0=="object")u0.exports=x();else if(typeof define=="function"&&define.amd)define([],x);else{var j=x();for(var o in j)(typeof T0=="object"?T0:I)[o]=j[o]}})(self,()=>(()=>{var I={4567:function(P,v,b){var A=this&&this.__decorate||function(R,p,$,F){var O,L=arguments.length,Z=L<3?p:F===null?F=Object.getOwnPropertyDescriptor(p,$):F;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")Z=Reflect.decorate(R,p,$,F);else for(var W=R.length-1;W>=0;W--)(O=R[W])&&(Z=(L<3?O(Z):L>3?O(p,$,Z):O(p,$))||Z);return L>3&&Z&&Object.defineProperty(p,$,Z),Z},H=this&&this.__param||function(R,p){return function($,F){p($,F,R)}};Object.defineProperty(v,"__esModule",{value:!0}),v.AccessibilityManager=void 0;const E=b(9042),h=b(6114),D=b(9924),f=b(844),S=b(5596),g=b(4725),w=b(3656);let C=v.AccessibilityManager=class extends f.Disposable{constructor(R,p){super(),this._terminal=R,this._renderService=p,this._liveRegionLineCount=0,this._charsToConsume=[],this._charsToAnnounce="",this._accessibilityContainer=document.createElement("div"),this._accessibilityContainer.classList.add("xterm-accessibility"),this._rowContainer=document.createElement("div"),this._rowContainer.setAttribute("role","list"),this._rowContainer.classList.add("xterm-accessibility-tree"),this._rowElements=[];for(let $=0;$<this._terminal.rows;$++)this._rowElements[$]=this._createAccessibilityTreeNode(),this._rowContainer.appendChild(this._rowElements[$]);if(this._topBoundaryFocusListener=($)=>this._handleBoundaryFocus($,0),this._bottomBoundaryFocusListener=($)=>this._handleBoundaryFocus($,1),this._rowElements[0].addEventListener("focus",this._topBoundaryFocusListener),this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._refreshRowsDimensions(),this._accessibilityContainer.appendChild(this._rowContainer),this._liveRegion=document.createElement("div"),this._liveRegion.classList.add("live-region"),this._liveRegion.setAttribute("aria-live","assertive"),this._accessibilityContainer.appendChild(this._liveRegion),this._liveRegionDebouncer=this.register(new D.TimeBasedDebouncer(this._renderRows.bind(this))),!this._terminal.element)throw new Error("Cannot enable accessibility before Terminal.open");this._terminal.element.insertAdjacentElement("afterbegin",this._accessibilityContainer),this.register(this._terminal.onResize(($)=>this._handleResize($.rows))),this.register(this._terminal.onRender(($)=>this._refreshRows($.start,$.end))),this.register(this._terminal.onScroll(()=>this._refreshRows())),this.register(this._terminal.onA11yChar(($)=>this._handleChar($))),this.register(this._terminal.onLineFeed(()=>this._handleChar("\n"))),this.register(this._terminal.onA11yTab(($)=>this._handleTab($))),this.register(this._terminal.onKey(($)=>this._handleKey($.key))),this.register(this._terminal.onBlur(()=>this._clearLiveRegion())),this.register(this._renderService.onDimensionsChange(()=>this._refreshRowsDimensions())),this._screenDprMonitor=new S.ScreenDprMonitor(window),this.register(this._screenDprMonitor),this._screenDprMonitor.setListener(()=>this._refreshRowsDimensions()),this.register(w.addDisposableDomListener(window,"resize",()=>this._refreshRowsDimensions())),this._refreshRows(),this.register(f.toDisposable(()=>{this._accessibilityContainer.remove(),this._rowElements.length=0}))}_handleTab(R){for(let p=0;p<R;p++)this._handleChar(" ")}_handleChar(R){this._liveRegionLineCount<21&&(this._charsToConsume.length>0?this._charsToConsume.shift()!==R&&(this._charsToAnnounce+=R):this._charsToAnnounce+=R,R==="\n"&&(this._liveRegionLineCount++,this._liveRegionLineCount===21&&(this._liveRegion.textContent+=E.tooMuchOutput)),h.isMac&&this._liveRegion.textContent&&this._liveRegion.textContent.length>0&&!this._liveRegion.parentNode&&setTimeout(()=>{this._accessibilityContainer.appendChild(this._liveRegion)},0))}_clearLiveRegion(){this._liveRegion.textContent="",this._liveRegionLineCount=0,h.isMac&&this._liveRegion.remove()}_handleKey(R){this._clearLiveRegion(),/\p{Control}/u.test(R)||this._charsToConsume.push(R)}_refreshRows(R,p){this._liveRegionDebouncer.refresh(R,p,this._terminal.rows)}_renderRows(R,p){const $=this._terminal.buffer,F=$.lines.length.toString();for(let O=R;O<=p;O++){const L=$.translateBufferLineToString($.ydisp+O,!0),Z=($.ydisp+O+1).toString(),W=this._rowElements[O];W&&(L.length===0?W.innerText="\xA0":W.textContent=L,W.setAttribute("aria-posinset",Z),W.setAttribute("aria-setsize",F))}this._announceCharacters()}_announceCharacters(){this._charsToAnnounce.length!==0&&(this._liveRegion.textContent+=this._charsToAnnounce,this._charsToAnnounce="")}_handleBoundaryFocus(R,p){const $=R.target,F=this._rowElements[p===0?1:this._rowElements.length-2];if($.getAttribute("aria-posinset")===(p===0?"1":`${this._terminal.buffer.lines.length}`))return;if(R.relatedTarget!==F)return;let O,L;if(p===0?(O=$,L=this._rowElements.pop(),this._rowContainer.removeChild(L)):(O=this._rowElements.shift(),L=$,this._rowContainer.removeChild(O)),O.removeEventListener("focus",this._topBoundaryFocusListener),L.removeEventListener("focus",this._bottomBoundaryFocusListener),p===0){const Z=this._createAccessibilityTreeNode();this._rowElements.unshift(Z),this._rowContainer.insertAdjacentElement("afterbegin",Z)}else{const Z=this._createAccessibilityTreeNode();this._rowElements.push(Z),this._rowContainer.appendChild(Z)}this._rowElements[0].addEventListener("focus",this._topBoundaryFocusListener),this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._terminal.scrollLines(p===0?-1:1),this._rowElements[p===0?1:this._rowElements.length-2].focus(),R.preventDefault(),R.stopImmediatePropagation()}_handleResize(R){this._rowElements[this._rowElements.length-1].removeEventListener("focus",this._bottomBoundaryFocusListener);for(let p=this._rowContainer.children.length;p<this._terminal.rows;p++)this._rowElements[p]=this._createAccessibilityTreeNode(),this._rowContainer.appendChild(this._rowElements[p]);for(;this._rowElements.length>R;)this._rowContainer.removeChild(this._rowElements.pop());this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._refreshRowsDimensions()}_createAccessibilityTreeNode(){const R=document.createElement("div");return R.setAttribute("role","listitem"),R.tabIndex=-1,this._refreshRowDimensions(R),R}_refreshRowsDimensions(){if(this._renderService.dimensions.css.cell.height){this._accessibilityContainer.style.width=`${this._renderService.dimensions.css.canvas.width}px`,this._rowElements.length!==this._terminal.rows&&this._handleResize(this._terminal.rows);for(let R=0;R<this._terminal.rows;R++)this._refreshRowDimensions(this._rowElements[R])}}_refreshRowDimensions(R){R.style.height=`${this._renderService.dimensions.css.cell.height}px`}};v.AccessibilityManager=C=A([H(1,g.IRenderService)],C)},3614:(P,v)=>{function b(h){return h.replace(/\r?\n/g,"\r")}function A(h,D){return D?"[200~"+h+"[201~":h}function H(h,D,f,S){h=A(h=b(h),f.decPrivateModes.bracketedPasteMode&&S.rawOptions.ignoreBracketedPasteMode!==!0),f.triggerDataEvent(h,!0),D.value=""}function E(h,D,f){const S=f.getBoundingClientRect(),g=h.clientX-S.left-10,w=h.clientY-S.top-10;D.style.width="20px",D.style.height="20px",D.style.left=`${g}px`,D.style.top=`${w}px`,D.style.zIndex="1000",D.focus()}Object.defineProperty(v,"__esModule",{value:!0}),v.rightClickHandler=v.moveTextAreaUnderMouseCursor=v.paste=v.handlePasteEvent=v.copyHandler=v.bracketTextForPaste=v.prepareTextForTerminal=void 0,v.prepareTextForTerminal=b,v.bracketTextForPaste=A,v.copyHandler=function(h,D){h.clipboardData&&h.clipboardData.setData("text/plain",D.selectionText),h.preventDefault()},v.handlePasteEvent=function(h,D,f,S){h.stopPropagation(),h.clipboardData&&H(h.clipboardData.getData("text/plain"),D,f,S)},v.paste=H,v.moveTextAreaUnderMouseCursor=E,v.rightClickHandler=function(h,D,f,S,g){E(h,D,f),g&&S.rightClickSelect(h),D.value=S.selectionText,D.select()}},7239:(P,v,b)=>{Object.defineProperty(v,"__esModule",{value:!0}),v.ColorContrastCache=void 0;const A=b(1505);v.ColorContrastCache=class{constructor(){this._color=new A.TwoKeyMap,this._css=new A.TwoKeyMap}setCss(H,E,h){this._css.set(H,E,h)}getCss(H,E){return this._css.get(H,E)}setColor(H,E,h){this._color.set(H,E,h)}getColor(H,E){return this._color.get(H,E)}clear(){this._color.clear(),this._css.clear()}}},3656:(P,v)=>{Object.defineProperty(v,"__esModule",{value:!0}),v.addDisposableDomListener=void 0,v.addDisposableDomListener=function(b,A,H,E){b.addEventListener(A,H,E);let h=!1;return{dispose:()=>{h||(h=!0,b.removeEventListener(A,H,E))}}}},6465:function(P,v,b){var A=this&&this.__decorate||function(g,w,C,R){var p,$=arguments.length,F=$<3?w:R===null?R=Object.getOwnPropertyDescriptor(w,C):R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")F=Reflect.decorate(g,w,C,R);else for(var O=g.length-1;O>=0;O--)(p=g[O])&&(F=($<3?p(F):$>3?p(w,C,F):p(w,C))||F);return $>3&&F&&Object.defineProperty(w,C,F),F},H=this&&this.__param||function(g,w){return function(C,R){w(C,R,g)}};Object.defineProperty(v,"__esModule",{value:!0}),v.Linkifier2=void 0;const E=b(3656),h=b(8460),D=b(844),f=b(2585);let S=v.Linkifier2=class extends D.Disposable{get currentLink(){return this._currentLink}constructor(g){super(),this._bufferService=g,this._linkProviders=[],this._linkCacheDisposables=[],this._isMouseOut=!0,this._wasResized=!1,this._activeLine=-1,this._onShowLinkUnderline=this.register(new h.EventEmitter),this.onShowLinkUnderline=this._onShowLinkUnderline.event,this._onHideLinkUnderline=this.register(new h.EventEmitter),this.onHideLinkUnderline=this._onHideLinkUnderline.event,this.register(D.getDisposeArrayDisposable(this._linkCacheDisposables)),this.register(D.toDisposable(()=>{this._lastMouseEvent=void 0})),this.register(this._bufferService.onResize(()=>{this._clearCurrentLink(),this._wasResized=!0}))}registerLinkProvider(g){return this._linkProviders.push(g),{dispose:()=>{const w=this._linkProviders.indexOf(g);w!==-1&&this._linkProviders.splice(w,1)}}}attachToDom(g,w,C){this._element=g,this._mouseService=w,this._renderService=C,this.register(E.addDisposableDomListener(this._element,"mouseleave",()=>{this._isMouseOut=!0,this._clearCurrentLink()})),this.register(E.addDisposableDomListener(this._element,"mousemove",this._handleMouseMove.bind(this))),this.register(E.addDisposableDomListener(this._element,"mousedown",this._handleMouseDown.bind(this))),this.register(E.addDisposableDomListener(this._element,"mouseup",this._handleMouseUp.bind(this)))}_handleMouseMove(g){if(this._lastMouseEvent=g,!this._element||!this._mouseService)return;const w=this._positionFromMouseEvent(g,this._element,this._mouseService);if(!w)return;this._isMouseOut=!1;const C=g.composedPath();for(let R=0;R<C.length;R++){const p=C[R];if(p.classList.contains("xterm"))break;if(p.classList.contains("xterm-hover"))return}this._lastBufferCell&&w.x===this._lastBufferCell.x&&w.y===this._lastBufferCell.y||(this._handleHover(w),this._lastBufferCell=w)}_handleHover(g){if(this._activeLine!==g.y||this._wasResized)return this._clearCurrentLink(),this._askForLink(g,!1),void(this._wasResized=!1);this._currentLink&&this._linkAtPosition(this._currentLink.link,g)||(this._clearCurrentLink(),this._askForLink(g,!0))}_askForLink(g,w){var C,R;this._activeProviderReplies&&w||((C=this._activeProviderReplies)===null||C===void 0||C.forEach(($)=>{$==null||$.forEach((F)=>{F.link.dispose&&F.link.dispose()})}),this._activeProviderReplies=new Map,this._activeLine=g.y);let p=!1;for(let[$,F]of this._linkProviders.entries())w?((R=this._activeProviderReplies)===null||R===void 0?void 0:R.get($))&&(p=this._checkLinkProviderResult($,g,p)):F.provideLinks(g.y,(O)=>{var L,Z;if(this._isMouseOut)return;const W=O==null?void 0:O.map((B)=>({link:B}));(L=this._activeProviderReplies)===null||L===void 0||L.set($,W),p=this._checkLinkProviderResult($,g,p),((Z=this._activeProviderReplies)===null||Z===void 0?void 0:Z.size)===this._linkProviders.length&&this._removeIntersectingLinks(g.y,this._activeProviderReplies)})}_removeIntersectingLinks(g,w){const C=new Set;for(let R=0;R<w.size;R++){const p=w.get(R);if(p)for(let $=0;$<p.length;$++){const F=p[$],O=F.link.range.start.y<g?0:F.link.range.start.x,L=F.link.range.end.y>g?this._bufferService.cols:F.link.range.end.x;for(let Z=O;Z<=L;Z++){if(C.has(Z)){p.splice($--,1);break}C.add(Z)}}}}_checkLinkProviderResult(g,w,C){var R;if(!this._activeProviderReplies)return C;const p=this._activeProviderReplies.get(g);let $=!1;for(let F=0;F<g;F++)this._activeProviderReplies.has(F)&&!this._activeProviderReplies.get(F)||($=!0);if(!$&&p){const F=p.find((O)=>this._linkAtPosition(O.link,w));F&&(C=!0,this._handleNewLink(F))}if(this._activeProviderReplies.size===this._linkProviders.length&&!C)for(let F=0;F<this._activeProviderReplies.size;F++){const O=(R=this._activeProviderReplies.get(F))===null||R===void 0?void 0:R.find((L)=>this._linkAtPosition(L.link,w));if(O){C=!0,this._handleNewLink(O);break}}return C}_handleMouseDown(){this._mouseDownLink=this._currentLink}_handleMouseUp(g){if(!this._element||!this._mouseService||!this._currentLink)return;const w=this._positionFromMouseEvent(g,this._element,this._mouseService);w&&this._mouseDownLink===this._currentLink&&this._linkAtPosition(this._currentLink.link,w)&&this._currentLink.link.activate(g,this._currentLink.link.text)}_clearCurrentLink(g,w){this._element&&this._currentLink&&this._lastMouseEvent&&(!g||!w||this._currentLink.link.range.start.y>=g&&this._currentLink.link.range.end.y<=w)&&(this._linkLeave(this._element,this._currentLink.link,this._lastMouseEvent),this._currentLink=void 0,D.disposeArray(this._linkCacheDisposables))}_handleNewLink(g){if(!this._element||!this._lastMouseEvent||!this._mouseService)return;const w=this._positionFromMouseEvent(this._lastMouseEvent,this._element,this._mouseService);w&&this._linkAtPosition(g.link,w)&&(this._currentLink=g,this._currentLink.state={decorations:{underline:g.link.decorations===void 0||g.link.decorations.underline,pointerCursor:g.link.decorations===void 0||g.link.decorations.pointerCursor},isHovered:!0},this._linkHover(this._element,g.link,this._lastMouseEvent),g.link.decorations={},Object.defineProperties(g.link.decorations,{pointerCursor:{get:()=>{var C,R;return(R=(C=this._currentLink)===null||C===void 0?void 0:C.state)===null||R===void 0?void 0:R.decorations.pointerCursor},set:(C)=>{var R,p;((R=this._currentLink)===null||R===void 0?void 0:R.state)&&this._currentLink.state.decorations.pointerCursor!==C&&(this._currentLink.state.decorations.pointerCursor=C,this._currentLink.state.isHovered&&((p=this._element)===null||p===void 0||p.classList.toggle("xterm-cursor-pointer",C)))}},underline:{get:()=>{var C,R;return(R=(C=this._currentLink)===null||C===void 0?void 0:C.state)===null||R===void 0?void 0:R.decorations.underline},set:(C)=>{var R,p,$;((R=this._currentLink)===null||R===void 0?void 0:R.state)&&(($=(p=this._currentLink)===null||p===void 0?void 0:p.state)===null||$===void 0?void 0:$.decorations.underline)!==C&&(this._currentLink.state.decorations.underline=C,this._currentLink.state.isHovered&&this._fireUnderlineEvent(g.link,C))}}}),this._renderService&&this._linkCacheDisposables.push(this._renderService.onRenderedViewportChange((C)=>{if(!this._currentLink)return;const R=C.start===0?0:C.start+1+this._bufferService.buffer.ydisp,p=this._bufferService.buffer.ydisp+1+C.end;if(this._currentLink.link.range.start.y>=R&&this._currentLink.link.range.end.y<=p&&(this._clearCurrentLink(R,p),this._lastMouseEvent&&this._element)){const $=this._positionFromMouseEvent(this._lastMouseEvent,this._element,this._mouseService);$&&this._askForLink($,!1)}})))}_linkHover(g,w,C){var R;((R=this._currentLink)===null||R===void 0?void 0:R.state)&&(this._currentLink.state.isHovered=!0,this._currentLink.state.decorations.underline&&this._fireUnderlineEvent(w,!0),this._currentLink.state.decorations.pointerCursor&&g.classList.add("xterm-cursor-pointer")),w.hover&&w.hover(C,w.text)}_fireUnderlineEvent(g,w){const C=g.range,R=this._bufferService.buffer.ydisp,p=this._createLinkUnderlineEvent(C.start.x-1,C.start.y-R-1,C.end.x,C.end.y-R-1,void 0);(w?this._onShowLinkUnderline:this._onHideLinkUnderline).fire(p)}_linkLeave(g,w,C){var R;((R=this._currentLink)===null||R===void 0?void 0:R.state)&&(this._currentLink.state.isHovered=!1,this._currentLink.state.decorations.underline&&this._fireUnderlineEvent(w,!1),this._currentLink.state.decorations.pointerCursor&&g.classList.remove("xterm-cursor-pointer")),w.leave&&w.leave(C,w.text)}_linkAtPosition(g,w){const C=g.range.start.y*this._bufferService.cols+g.range.start.x,R=g.range.end.y*this._bufferService.cols+g.range.end.x,p=w.y*this._bufferService.cols+w.x;return C<=p&&p<=R}_positionFromMouseEvent(g,w,C){const R=C.getCoords(g,w,this._bufferService.cols,this._bufferService.rows);if(R)return{x:R[0],y:R[1]+this._bufferService.buffer.ydisp}}_createLinkUnderlineEvent(g,w,C,R,p){return{x1:g,y1:w,x2:C,y2:R,cols:this._bufferService.cols,fg:p}}};v.Linkifier2=S=A([H(0,f.IBufferService)],S)},9042:(P,v)=>{Object.defineProperty(v,"__esModule",{value:!0}),v.tooMuchOutput=v.promptLabel=void 0,v.promptLabel="Terminal input",v.tooMuchOutput="Too much output to announce, navigate to rows manually to read"},3730:function(P,v,b){var A=this&&this.__decorate||function(S,g,w,C){var R,p=arguments.length,$=p<3?g:C===null?C=Object.getOwnPropertyDescriptor(g,w):C;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")$=Reflect.decorate(S,g,w,C);else for(var F=S.length-1;F>=0;F--)(R=S[F])&&($=(p<3?R($):p>3?R(g,w,$):R(g,w))||$);return p>3&&$&&Object.defineProperty(g,w,$),$},H=this&&this.__param||function(S,g){return function(w,C){g(w,C,S)}};Object.defineProperty(v,"__esModule",{value:!0}),v.OscLinkProvider=void 0;const E=b(511),h=b(2585);let D=v.OscLinkProvider=class{constructor(S,g,w){this._bufferService=S,this._optionsService=g,this._oscLinkService=w}provideLinks(S,g){var w;const C=this._bufferService.buffer.lines.get(S-1);if(!C)return void g(void 0);const R=[],p=this._optionsService.rawOptions.linkHandler,$=new E.CellData,F=C.getTrimmedLength();let O=-1,L=-1,Z=!1;for(let W=0;W<F;W++)if(L!==-1||C.hasContent(W)){if(C.loadCell(W,$),$.hasExtendedAttrs()&&$.extended.urlId){if(L===-1){L=W,O=$.extended.urlId;continue}Z=$.extended.urlId!==O}else L!==-1&&(Z=!0);if(Z||L!==-1&&W===F-1){const B=(w=this._oscLinkService.getLinkData(O))===null||w===void 0?void 0:w.uri;if(B){const Y={start:{x:L+1,y:S},end:{x:W+(Z||W!==F-1?0:1),y:S}};let G=!1;if(!(p==null?void 0:p.allowNonHttpProtocols))try{const T=new URL(B);["http:","https:"].includes(T.protocol)||(G=!0)}catch(T){G=!0}G||R.push({text:B,range:Y,activate:(T,J)=>p?p.activate(T,J,Y):f(0,J),hover:(T,J)=>{var X;return(X=p==null?void 0:p.hover)===null||X===void 0?void 0:X.call(p,T,J,Y)},leave:(T,J)=>{var X;return(X=p==null?void 0:p.leave)===null||X===void 0?void 0:X.call(p,T,J,Y)}})}Z=!1,$.hasExtendedAttrs()&&$.extended.urlId?(L=W,O=$.extended.urlId):(L=-1,O=-1)}}g(R)}};function f(S,g){if(confirm(`Do you want to navigate to ${g}?\n\nWARNING: This link could potentially be dangerous`)){const w=window.open();if(w){try{w.opener=null}catch(C){}w.location.href=g}else console.warn("Opening link blocked as opener could not be cleared")}}v.OscLinkProvider=D=A([H(0,h.IBufferService),H(1,h.IOptionsService),H(2,h.IOscLinkService)],D)},6193:(P,v)=>{Object.defineProperty(v,"__esModule",{value:!0}),v.RenderDebouncer=void 0,v.RenderDebouncer=class{constructor(b,A){this._parentWindow=b,this._renderCallback=A,this._refreshCallbacks=[]}dispose(){this._animationFrame&&(this._parentWindow.cancelAnimationFrame(this._animationFrame),this._animationFrame=void 0)}addRefreshCallback(b){return this._refreshCallbacks.push(b),this._animationFrame||(this._animationFrame=this._parentWindow.requestAnimationFrame(()=>this._innerRefresh())),this._animationFrame}refresh(b,A,H){this._rowCount=H,b=b!==void 0?b:0,A=A!==void 0?A:this._rowCount-1,this._rowStart=this._rowStart!==void 0?Math.min(this._rowStart,b):b,this._rowEnd=this._rowEnd!==void 0?Math.max(this._rowEnd,A):A,this._animationFrame||(this._animationFrame=this._parentWindow.requestAnimationFrame(()=>this._innerRefresh()))}_innerRefresh(){if(this._animationFrame=void 0,this._rowStart===void 0||this._rowEnd===void 0||this._rowCount===void 0)return void this._runRefreshCallbacks();const b=Math.max(this._rowStart,0),A=Math.min(this._rowEnd,this._rowCount-1);this._rowStart=void 0,this._rowEnd=void 0,this._renderCallback(b,A),this._runRefreshCallbacks()}_runRefreshCallbacks(){for(let b of this._refreshCallbacks)b(0);this._refreshCallbacks=[]}}},5596:(P,v,b)=>{Object.defineProperty(v,"__esModule",{value:!0}),v.ScreenDprMonitor=void 0;const A=b(844);class H extends A.Disposable{constructor(E){super(),this._parentWindow=E,this._currentDevicePixelRatio=this._parentWindow.devicePixelRatio,this.register(A.toDisposable(()=>{this.clearListener()}))}setListener(E){this._listener&&this.clearListener(),this._listener=E,this._outerListener=()=>{this._listener&&(this._listener(this._parentWindow.devicePixelRatio,this._currentDevicePixelRatio),this._updateDpr())},this._updateDpr()}_updateDpr(){var E;this._outerListener&&((E=this._resolutionMediaMatchList)===null||E===void 0||E.removeListener(this._outerListener),this._currentDevicePixelRatio=this._parentWindow.devicePixelRatio,this._resolutionMediaMatchList=this._parentWindow.matchMedia(`screen and (resolution: ${this._parentWindow.devicePixelRatio}dppx)`),this._resolutionMediaMatchList.addListener(this._outerListener))}clearListener(){this._resolutionMediaMatchList&&this._listener&&this._outerListener&&(this._resolutionMediaMatchList.removeListener(this._outerListener),this._resolutionMediaMatchList=void 0,this._listener=void 0,this._outerListener=void 0)}}v.ScreenDprMonitor=H},3236:(P,v,b)=>{Object.defineProperty(v,"__esModule",{value:!0}),v.Terminal=void 0;const A=b(3614),H=b(3656),E=b(6465),h=b(9042),D=b(3730),f=b(1680),S=b(3107),g=b(5744),w=b(2950),C=b(1296),R=b(428),p=b(4269),$=b(5114),F=b(8934),O=b(3230),L=b(9312),Z=b(4725),W=b(6731),B=b(8055),Y=b(8969),G=b(8460),T=b(844),J=b(6114),X=b(8437),m=b(2584),q=b(7399),V=b(5941),Q=b(9074),k=b(2585),N=b(5435),y=b(4567),u=typeof window!="undefined"?window.document:null;class c extends Y.CoreTerminal{get onFocus(){return this._onFocus.event}get onBlur(){return this._onBlur.event}get onA11yChar(){return this._onA11yCharEmitter.event}get onA11yTab(){return this._onA11yTabEmitter.event}get onWillOpen(){return this._onWillOpen.event}constructor(M={}){super(M),this.browser=J,this._keyDownHandled=!1,this._keyDownSeen=!1,this._keyPressHandled=!1,this._unprocessedDeadKey=!1,this._accessibilityManager=this.register(new T.MutableDisposable),this._onCursorMove=this.register(new G.EventEmitter),this.onCursorMove=this._onCursorMove.event,this._onKey=this.register(new G.EventEmitter),this.onKey=this._onKey.event,this._onRender=this.register(new G.EventEmitter),this.onRender=this._onRender.event,this._onSelectionChange=this.register(new G.EventEmitter),this.onSelectionChange=this._onSelectionChange.event,this._onTitleChange=this.register(new G.EventEmitter),this.onTitleChange=this._onTitleChange.event,this._onBell=this.register(new G.EventEmitter),this.onBell=this._onBell.event,this._onFocus=this.register(new G.EventEmitter),this._onBlur=this.register(new G.EventEmitter),this._onA11yCharEmitter=this.register(new G.EventEmitter),this._onA11yTabEmitter=this.register(new G.EventEmitter),this._onWillOpen=this.register(new G.EventEmitter),this._setup(),this.linkifier2=this.register(this._instantiationService.createInstance(E.Linkifier2)),this.linkifier2.registerLinkProvider(this._instantiationService.createInstance(D.OscLinkProvider)),this._decorationService=this._instantiationService.createInstance(Q.DecorationService),this._instantiationService.setService(k.IDecorationService,this._decorationService),this.register(this._inputHandler.onRequestBell(()=>this._onBell.fire())),this.register(this._inputHandler.onRequestRefreshRows((_,U)=>this.refresh(_,U))),this.register(this._inputHandler.onRequestSendFocus(()=>this._reportFocus())),this.register(this._inputHandler.onRequestReset(()=>this.reset())),this.register(this._inputHandler.onRequestWindowsOptionsReport((_)=>this._reportWindowsOptions(_))),this.register(this._inputHandler.onColor((_)=>this._handleColorEvent(_))),this.register(G.forwardEvent(this._inputHandler.onCursorMove,this._onCursorMove)),this.register(G.forwardEvent(this._inputHandler.onTitleChange,this._onTitleChange)),this.register(G.forwardEvent(this._inputHandler.onA11yChar,this._onA11yCharEmitter)),this.register(G.forwardEvent(this._inputHandler.onA11yTab,this._onA11yTabEmitter)),this.register(this._bufferService.onResize((_)=>this._afterResize(_.cols,_.rows))),this.register(T.toDisposable(()=>{var _,U;this._customKeyEventHandler=void 0,(U=(_=this.element)===null||_===void 0?void 0:_.parentNode)===null||U===void 0||U.removeChild(this.element)}))}_handleColorEvent(M){if(this._themeService)for(let _ of M){let U,K="";switch(_.index){case 256:U="foreground",K="10";break;case 257:U="background",K="11";break;case 258:U="cursor",K="12";break;default:U="ansi",K="4;"+_.index}switch(_.type){case 0:const r=B.color.toColorRGB(U==="ansi"?this._themeService.colors.ansi[_.index]:this._themeService.colors[U]);this.coreService.triggerDataEvent(`${m.C0.ESC}]${K};${V.toRgbString(r)}${m.C1_ESCAPED.ST}`);break;case 1:if(U==="ansi")this._themeService.modifyColors((z)=>z.ansi[_.index]=B.rgba.toColor(..._.color));else{const z=U;this._themeService.modifyColors((v0)=>v0[z]=B.rgba.toColor(..._.color))}break;case 2:this._themeService.restoreColor(_.index)}}}_setup(){super._setup(),this._customKeyEventHandler=void 0}get buffer(){return this.buffers.active}focus(){this.textarea&&this.textarea.focus({preventScroll:!0})}_handleScreenReaderModeOptionChange(M){M?!this._accessibilityManager.value&&this._renderService&&(this._accessibilityManager.value=this._instantiationService.createInstance(y.AccessibilityManager,this)):this._accessibilityManager.clear()}_handleTextAreaFocus(M){this.coreService.decPrivateModes.sendFocus&&this.coreService.triggerDataEvent(m.C0.ESC+"[I"),this.updateCursorStyle(M),this.element.classList.add("focus"),this._showCursor(),this._onFocus.fire()}blur(){var M;return(M=this.textarea)===null||M===void 0?void 0:M.blur()}_handleTextAreaBlur(){this.textarea.value="",this.refresh(this.buffer.y,this.buffer.y),this.coreService.decPrivateModes.sendFocus&&this.coreService.triggerDataEvent(m.C0.ESC+"[O"),this.element.classList.remove("focus"),this._onBlur.fire()}_syncTextArea(){if(!this.textarea||!this.buffer.isCursorInViewport||this._compositionHelper.isComposing||!this._renderService)return;const M=this.buffer.ybase+this.buffer.y,_=this.buffer.lines.get(M);if(!_)return;const U=Math.min(this.buffer.x,this.cols-1),K=this._renderService.dimensions.css.cell.height,r=_.getWidth(U),z=this._renderService.dimensions.css.cell.width*r,v0=this.buffer.y*this._renderService.dimensions.css.cell.height,t=U*this._renderService.dimensions.css.cell.width;this.textarea.style.left=t+"px",this.textarea.style.top=v0+"px",this.textarea.style.width=z+"px",this.textarea.style.height=K+"px",this.textarea.style.lineHeight=K+"px",this.textarea.style.zIndex="-5"}_initGlobal(){this._bindKeys(),this.register(H.addDisposableDomListener(this.element,"copy",(_)=>{this.hasSelection()&&A.copyHandler(_,this._selectionService)}));const M=(_)=>A.handlePasteEvent(_,this.textarea,this.coreService,this.optionsService);this.register(H.addDisposableDomListener(this.textarea,"paste",M)),this.register(H.addDisposableDomListener(this.element,"paste",M)),J.isFirefox?this.register(H.addDisposableDomListener(this.element,"mousedown",(_)=>{_.button===2&&A.rightClickHandler(_,this.textarea,this.screenElement,this._selectionService,this.options.rightClickSelectsWord)})):this.register(H.addDisposableDomListener(this.element,"contextmenu",(_)=>{A.rightClickHandler(_,this.textarea,this.screenElement,this._selectionService,this.options.rightClickSelectsWord)})),J.isLinux&&this.register(H.addDisposableDomListener(this.element,"auxclick",(_)=>{_.button===1&&A.moveTextAreaUnderMouseCursor(_,this.textarea,this.screenElement)}))}_bindKeys(){this.register(H.addDisposableDomListener(this.textarea,"keyup",(M)=>this._keyUp(M),!0)),this.register(H.addDisposableDomListener(this.textarea,"keydown",(M)=>this._keyDown(M),!0)),this.register(H.addDisposableDomListener(this.textarea,"keypress",(M)=>this._keyPress(M),!0)),this.register(H.addDisposableDomListener(this.textarea,"compositionstart",()=>this._compositionHelper.compositionstart())),this.register(H.addDisposableDomListener(this.textarea,"compositionupdate",(M)=>this._compositionHelper.compositionupdate(M))),this.register(H.addDisposableDomListener(this.textarea,"compositionend",()=>this._compositionHelper.compositionend())),this.register(H.addDisposableDomListener(this.textarea,"input",(M)=>this._inputEvent(M),!0)),this.register(this.onRender(()=>this._compositionHelper.updateCompositionElements()))}open(M){var _;if(!M)throw new Error("Terminal requires a parent element.");M.isConnected||this._logService.debug("Terminal.open was called on an element that was not attached to the DOM"),this._document=M.ownerDocument,this.element=this._document.createElement("div"),this.element.dir="ltr",this.element.classList.add("terminal"),this.element.classList.add("xterm"),M.appendChild(this.element);const U=u.createDocumentFragment();this._viewportElement=u.createElement("div"),this._viewportElement.classList.add("xterm-viewport"),U.appendChild(this._viewportElement),this._viewportScrollArea=u.createElement("div"),this._viewportScrollArea.classList.add("xterm-scroll-area"),this._viewportElement.appendChild(this._viewportScrollArea),this.screenElement=u.createElement("div"),this.screenElement.classList.add("xterm-screen"),this._helperContainer=u.createElement("div"),this._helperContainer.classList.add("xterm-helpers"),this.screenElement.appendChild(this._helperContainer),U.appendChild(this.screenElement),this.textarea=u.createElement("textarea"),this.textarea.classList.add("xterm-helper-textarea"),this.textarea.setAttribute("aria-label",h.promptLabel),J.isChromeOS||this.textarea.setAttribute("aria-multiline","false"),this.textarea.setAttribute("autocorrect","off"),this.textarea.setAttribute("autocapitalize","off"),this.textarea.setAttribute("spellcheck","false"),this.textarea.tabIndex=0,this._coreBrowserService=this._instantiationService.createInstance($.CoreBrowserService,this.textarea,(_=this._document.defaultView)!==null&&_!==void 0?_:window),this._instantiationService.setService(Z.ICoreBrowserService,this._coreBrowserService),this.register(H.addDisposableDomListener(this.textarea,"focus",(K)=>this._handleTextAreaFocus(K))),this.register(H.addDisposableDomListener(this.textarea,"blur",()=>this._handleTextAreaBlur())),this._helperContainer.appendChild(this.textarea),this._charSizeService=this._instantiationService.createInstance(R.CharSizeService,this._document,this._helperContainer),this._instantiationService.setService(Z.ICharSizeService,this._charSizeService),this._themeService=this._instantiationService.createInstance(W.ThemeService),this._instantiationService.setService(Z.IThemeService,this._themeService),this._characterJoinerService=this._instantiationService.createInstance(p.CharacterJoinerService),this._instantiationService.setService(Z.ICharacterJoinerService,this._characterJoinerService),this._renderService=this.register(this._instantiationService.createInstance(O.RenderService,this.rows,this.screenElement)),this._instantiationService.setService(Z.IRenderService,this._renderService),this.register(this._renderService.onRenderedViewportChange((K)=>this._onRender.fire(K))),this.onResize((K)=>this._renderService.resize(K.cols,K.rows)),this._compositionView=u.createElement("div"),this._compositionView.classList.add("composition-view"),this._compositionHelper=this._instantiationService.createInstance(w.CompositionHelper,this.textarea,this._compositionView),this._helperContainer.appendChild(this._compositionView),this.element.appendChild(U);try{this._onWillOpen.fire(this.element)}catch(K){}this._renderService.hasRenderer()||this._renderService.setRenderer(this._createRenderer()),this._mouseService=this._instantiationService.createInstance(F.MouseService),this._instantiationService.setService(Z.IMouseService,this._mouseService),this.viewport=this._instantiationService.createInstance(f.Viewport,this._viewportElement,this._viewportScrollArea),this.viewport.onRequestScrollLines((K)=>this.scrollLines(K.amount,K.suppressScrollEvent,1)),this.register(this._inputHandler.onRequestSyncScrollBar(()=>this.viewport.syncScrollArea())),this.register(this.viewport),this.register(this.onCursorMove(()=>{this._renderService.handleCursorMove(),this._syncTextArea()})),this.register(this.onResize(()=>this._renderService.handleResize(this.cols,this.rows))),this.register(this.onBlur(()=>this._renderService.handleBlur())),this.register(this.onFocus(()=>this._renderService.handleFocus())),this.register(this._renderService.onDimensionsChange(()=>this.viewport.syncScrollArea())),this._selectionService=this.register(this._instantiationService.createInstance(L.SelectionService,this.element,this.screenElement,this.linkifier2)),this._instantiationService.setService(Z.ISelectionService,this._selectionService),this.register(this._selectionService.onRequestScrollLines((K)=>this.scrollLines(K.amount,K.suppressScrollEvent))),this.register(this._selectionService.onSelectionChange(()=>this._onSelectionChange.fire())),this.register(this._selectionService.onRequestRedraw((K)=>this._renderService.handleSelectionChanged(K.start,K.end,K.columnSelectMode))),this.register(this._selectionService.onLinuxMouseSelection((K)=>{this.textarea.value=K,this.textarea.focus(),this.textarea.select()})),this.register(this._onScroll.event((K)=>{this.viewport.syncScrollArea(),this._selectionService.refresh()})),this.register(H.addDisposableDomListener(this._viewportElement,"scroll",()=>this._selectionService.refresh())),this.linkifier2.attachToDom(this.screenElement,this._mouseService,this._renderService),this.register(this._instantiationService.createInstance(S.BufferDecorationRenderer,this.screenElement)),this.register(H.addDisposableDomListener(this.element,"mousedown",(K)=>this._selectionService.handleMouseDown(K))),this.coreMouseService.areMouseEventsActive?(this._selectionService.disable(),this.element.classList.add("enable-mouse-events")):this._selectionService.enable(),this.options.screenReaderMode&&(this._accessibilityManager.value=this._instantiationService.createInstance(y.AccessibilityManager,this)),this.register(this.optionsService.onSpecificOptionChange("screenReaderMode",(K)=>this._handleScreenReaderModeOptionChange(K))),this.options.overviewRulerWidth&&(this._overviewRulerRenderer=this.register(this._instantiationService.createInstance(g.OverviewRulerRenderer,this._viewportElement,this.screenElement))),this.optionsService.onSpecificOptionChange("overviewRulerWidth",(K)=>{!this._overviewRulerRenderer&&K&&this._viewportElement&&this.screenElement&&(this._overviewRulerRenderer=this.register(this._instantiationService.createInstance(g.OverviewRulerRenderer,this._viewportElement,this.screenElement)))}),this._charSizeService.measure(),this.refresh(0,this.rows-1),this._initGlobal(),this.bindMouse()}_createRenderer(){return this._instantiationService.createInstance(C.DomRenderer,this.element,this.screenElement,this._viewportElement,this.linkifier2)}bindMouse(){const M=this,_=this.element;function U(z){const v0=M._mouseService.getMouseReportCoords(z,M.screenElement);if(!v0)return!1;let t,S0;switch(z.overrideType||z.type){case"mousemove":S0=32,z.buttons===void 0?(t=3,z.button!==void 0&&(t=z.button<3?z.button:3)):t=1&z.buttons?0:4&z.buttons?1:2&z.buttons?2:3;break;case"mouseup":S0=0,t=z.button<3?z.button:3;break;case"mousedown":S0=1,t=z.button<3?z.button:3;break;case"wheel":if(M.viewport.getLinesScrolled(z)===0)return!1;S0=z.deltaY<0?0:1,t=4;break;default:return!1}return!(S0===void 0||t===void 0||t>4)&&M.coreMouseService.triggerMouseEvent({col:v0.col,row:v0.row,x:v0.x,y:v0.y,button:t,action:S0,ctrl:z.ctrlKey,alt:z.altKey,shift:z.shiftKey})}const K={mouseup:null,wheel:null,mousedrag:null,mousemove:null},r={mouseup:(z)=>(U(z),z.buttons||(this._document.removeEventListener("mouseup",K.mouseup),K.mousedrag&&this._document.removeEventListener("mousemove",K.mousedrag)),this.cancel(z)),wheel:(z)=>(U(z),this.cancel(z,!0)),mousedrag:(z)=>{z.buttons&&U(z)},mousemove:(z)=>{z.buttons||U(z)}};this.register(this.coreMouseService.onProtocolChange((z)=>{z?(this.optionsService.rawOptions.logLevel==="debug"&&this._logService.debug("Binding to mouse events:",this.coreMouseService.explainEvents(z)),this.element.classList.add("enable-mouse-events"),this._selectionService.disable()):(this._logService.debug("Unbinding from mouse events."),this.element.classList.remove("enable-mouse-events"),this._selectionService.enable()),8&z?K.mousemove||(_.addEventListener("mousemove",r.mousemove),K.mousemove=r.mousemove):(_.removeEventListener("mousemove",K.mousemove),K.mousemove=null),16&z?K.wheel||(_.addEventListener("wheel",r.wheel,{passive:!1}),K.wheel=r.wheel):(_.removeEventListener("wheel",K.wheel),K.wheel=null),2&z?K.mouseup||(_.addEventListener("mouseup",r.mouseup),K.mouseup=r.mouseup):(this._document.removeEventListener("mouseup",K.mouseup),_.removeEventListener("mouseup",K.mouseup),K.mouseup=null),4&z?K.mousedrag||(K.mousedrag=r.mousedrag):(this._document.removeEventListener("mousemove",K.mousedrag),K.mousedrag=null)})),this.coreMouseService.activeProtocol=this.coreMouseService.activeProtocol,this.register(H.addDisposableDomListener(_,"mousedown",(z)=>{if(z.preventDefault(),this.focus(),this.coreMouseService.areMouseEventsActive&&!this._selectionService.shouldForceSelection(z))return U(z),K.mouseup&&this._document.addEventListener("mouseup",K.mouseup),K.mousedrag&&this._document.addEventListener("mousemove",K.mousedrag),this.cancel(z)})),this.register(H.addDisposableDomListener(_,"wheel",(z)=>{if(!K.wheel){if(!this.buffer.hasScrollback){const v0=this.viewport.getLinesScrolled(z);if(v0===0)return;const t=m.C0.ESC+(this.coreService.decPrivateModes.applicationCursorKeys?"O":"[")+(z.deltaY<0?"A":"B");let S0="";for(let e=0;e<Math.abs(v0);e++)S0+=t;return this.coreService.triggerDataEvent(S0,!0),this.cancel(z,!0)}return this.viewport.handleWheel(z)?this.cancel(z):void 0}},{passive:!1})),this.register(H.addDisposableDomListener(_,"touchstart",(z)=>{if(!this.coreMouseService.areMouseEventsActive)return this.viewport.handleTouchStart(z),this.cancel(z)},{passive:!0})),this.register(H.addDisposableDomListener(_,"touchmove",(z)=>{if(!this.coreMouseService.areMouseEventsActive)return this.viewport.handleTouchMove(z)?void 0:this.cancel(z)},{passive:!1}))}refresh(M,_){var U;(U=this._renderService)===null||U===void 0||U.refreshRows(M,_)}updateCursorStyle(M){var _;((_=this._selectionService)===null||_===void 0?void 0:_.shouldColumnSelect(M))?this.element.classList.add("column-select"):this.element.classList.remove("column-select")}_showCursor(){this.coreService.isCursorInitialized||(this.coreService.isCursorInitialized=!0,this.refresh(this.buffer.y,this.buffer.y))}scrollLines(M,_,U=0){var K;U===1?(super.scrollLines(M,_,U),this.refresh(0,this.rows-1)):(K=this.viewport)===null||K===void 0||K.scrollLines(M)}paste(M){A.paste(M,this.textarea,this.coreService,this.optionsService)}attachCustomKeyEventHandler(M){this._customKeyEventHandler=M}registerLinkProvider(M){return this.linkifier2.registerLinkProvider(M)}registerCharacterJoiner(M){if(!this._characterJoinerService)throw new Error("Terminal must be opened first");const _=this._characterJoinerService.register(M);return this.refresh(0,this.rows-1),_}deregisterCharacterJoiner(M){if(!this._characterJoinerService)throw new Error("Terminal must be opened first");this._characterJoinerService.deregister(M)&&this.refresh(0,this.rows-1)}get markers(){return this.buffer.markers}registerMarker(M){return this.buffer.addMarker(this.buffer.ybase+this.buffer.y+M)}registerDecoration(M){return this._decorationService.registerDecoration(M)}hasSelection(){return!!this._selectionService&&this._selectionService.hasSelection}select(M,_,U){this._selectionService.setSelection(M,_,U)}getSelection(){return this._selectionService?this._selectionService.selectionText:""}getSelectionPosition(){if(this._selectionService&&this._selectionService.hasSelection)return{start:{x:this._selectionService.selectionStart[0],y:this._selectionService.selectionStart[1]},end:{x:this._selectionService.selectionEnd[0],y:this._selectionService.selectionEnd[1]}}}clearSelection(){var M;(M=this._selectionService)===null||M===void 0||M.clearSelection()}selectAll(){var M;(M=this._selectionService)===null||M===void 0||M.selectAll()}selectLines(M,_){var U;(U=this._selectionService)===null||U===void 0||U.selectLines(M,_)}_keyDown(M){if(this._keyDownHandled=!1,this._keyDownSeen=!0,this._customKeyEventHandler&&this._customKeyEventHandler(M)===!1)return!1;const _=this.browser.isMac&&this.options.macOptionIsMeta&&M.altKey;if(!_&&!this._compositionHelper.keydown(M))return this.options.scrollOnUserInput&&this.buffer.ybase!==this.buffer.ydisp&&this.scrollToBottom(),!1;_||M.key!=="Dead"&&M.key!=="AltGraph"||(this._unprocessedDeadKey=!0);const U=q.evaluateKeyboardEvent(M,this.coreService.decPrivateModes.applicationCursorKeys,this.browser.isMac,this.options.macOptionIsMeta);if(this.updateCursorStyle(M),U.type===3||U.type===2){const K=this.rows-1;return this.scrollLines(U.type===2?-K:K),this.cancel(M,!0)}return U.type===1&&this.selectAll(),!!this._isThirdLevelShift(this.browser,M)||(U.cancel&&this.cancel(M,!0),!U.key||!!(M.key&&!M.ctrlKey&&!M.altKey&&!M.metaKey&&M.key.length===1&&M.key.charCodeAt(0)>=65&&M.key.charCodeAt(0)<=90)||(this._unprocessedDeadKey?(this._unprocessedDeadKey=!1,!0):(U.key!==m.C0.ETX&&U.key!==m.C0.CR||(this.textarea.value=""),this._onKey.fire({key:U.key,domEvent:M}),this._showCursor(),this.coreService.triggerDataEvent(U.key,!0),!this.optionsService.rawOptions.screenReaderMode||M.altKey||M.ctrlKey?this.cancel(M,!0):void(this._keyDownHandled=!0))))}_isThirdLevelShift(M,_){const U=M.isMac&&!this.options.macOptionIsMeta&&_.altKey&&!_.ctrlKey&&!_.metaKey||M.isWindows&&_.altKey&&_.ctrlKey&&!_.metaKey||M.isWindows&&_.getModifierState("AltGraph");return _.type==="keypress"?U:U&&(!_.keyCode||_.keyCode>47)}_keyUp(M){this._keyDownSeen=!1,this._customKeyEventHandler&&this._customKeyEventHandler(M)===!1||(function(_){return _.keyCode===16||_.keyCode===17||_.keyCode===18}(M)||this.focus(),this.updateCursorStyle(M),this._keyPressHandled=!1)}_keyPress(M){let _;if(this._keyPressHandled=!1,this._keyDownHandled)return!1;if(this._customKeyEventHandler&&this._customKeyEventHandler(M)===!1)return!1;if(this.cancel(M),M.charCode)_=M.charCode;else if(M.which===null||M.which===void 0)_=M.keyCode;else{if(M.which===0||M.charCode===0)return!1;_=M.which}return!(!_||(M.altKey||M.ctrlKey||M.metaKey)&&!this._isThirdLevelShift(this.browser,M)||(_=String.fromCharCode(_),this._onKey.fire({key:_,domEvent:M}),this._showCursor(),this.coreService.triggerDataEvent(_,!0),this._keyPressHandled=!0,this._unprocessedDeadKey=!1,0))}_inputEvent(M){if(M.data&&M.inputType==="insertText"&&(!M.composed||!this._keyDownSeen)&&!this.optionsService.rawOptions.screenReaderMode){if(this._keyPressHandled)return!1;this._unprocessedDeadKey=!1;const _=M.data;return this.coreService.triggerDataEvent(_,!0),this.cancel(M),!0}return!1}resize(M,_){M!==this.cols||_!==this.rows?super.resize(M,_):this._charSizeService&&!this._charSizeService.hasValidSize&&this._charSizeService.measure()}_afterResize(M,_){var U,K;(U=this._charSizeService)===null||U===void 0||U.measure(),(K=this.viewport)===null||K===void 0||K.syncScrollArea(!0)}clear(){var M;if(this.buffer.ybase!==0||this.buffer.y!==0){this.buffer.clearAllMarkers(),this.buffer.lines.set(0,this.buffer.lines.get(this.buffer.ybase+this.buffer.y)),this.buffer.lines.length=1,this.buffer.ydisp=0,this.buffer.ybase=0,this.buffer.y=0;for(let _=1;_<this.rows;_++)this.buffer.lines.push(this.buffer.getBlankLine(X.DEFAULT_ATTR_DATA));this._onScroll.fire({position:this.buffer.ydisp,source:0}),(M=this.viewport)===null||M===void 0||M.reset(),this.refresh(0,this.rows-1)}}reset(){var M,_;this.options.rows=this.rows,this.options.cols=this.cols;const U=this._customKeyEventHandler;this._setup(),super.reset(),(M=this._selectionService)===null||M===void 0||M.reset(),this._decorationService.reset(),(_=this.viewport)===null||_===void 0||_.reset(),this._customKeyEventHandler=U,this.refresh(0,this.rows-1)}clearTextureAtlas(){var M;(M=this._renderService)===null||M===void 0||M.clearTextureAtlas()}_reportFocus(){var M;((M=this.element)===null||M===void 0?void 0:M.classList.contains("focus"))?this.coreService.triggerDataEvent(m.C0.ESC+"[I"):this.coreService.triggerDataEvent(m.C0.ESC+"[O")}_reportWindowsOptions(M){if(this._renderService)switch(M){case N.WindowsOptionsReportType.GET_WIN_SIZE_PIXELS:const _=this._renderService.dimensions.css.canvas.width.toFixed(0),U=this._renderService.dimensions.css.canvas.height.toFixed(0);this.coreService.triggerDataEvent(`${m.C0.ESC}[4;${U};${_}t`);break;case N.WindowsOptionsReportType.GET_CELL_SIZE_PIXELS:const K=this._renderService.dimensions.css.cell.width.toFixed(0),r=this._renderService.dimensions.css.cell.height.toFixed(0);this.coreService.triggerDataEvent(`${m.C0.ESC}[6;${r};${K}t`)}}cancel(M,_){if(this.options.cancelEvents||_)return M.preventDefault(),M.stopPropagation(),!1}}v.Terminal=c},9924:(P,v)=>{Object.defineProperty(v,"__esModule",{value:!0}),v.TimeBasedDebouncer=void 0,v.TimeBasedDebouncer=class{constructor(b,A=1000){this._renderCallback=b,this._debounceThresholdMS=A,this._lastRefreshMs=0,this._additionalRefreshRequested=!1}dispose(){this._refreshTimeoutID&&clearTimeout(this._refreshTimeoutID)}refresh(b,A,H){this._rowCount=H,b=b!==void 0?b:0,A=A!==void 0?A:this._rowCount-1,this._rowStart=this._rowStart!==void 0?Math.min(this._rowStart,b):b,this._rowEnd=this._rowEnd!==void 0?Math.max(this._rowEnd,A):A;const E=Date.now();if(E-this._lastRefreshMs>=this._debounceThresholdMS)this._lastRefreshMs=E,this._innerRefresh();else if(!this._additionalRefreshRequested){const h=E-this._lastRefreshMs,D=this._debounceThresholdMS-h;this._additionalRefreshRequested=!0,this._refreshTimeoutID=window.setTimeout(()=>{this._lastRefreshMs=Date.now(),this._innerRefresh(),this._additionalRefreshRequested=!1,this._refreshTimeoutID=void 0},D)}}_innerRefresh(){if(this._rowStart===void 0||this._rowEnd===void 0||this._rowCount===void 0)return;const b=Math.max(this._rowStart,0),A=Math.min(this._rowEnd,this._rowCount-1);this._rowStart=void 0,this._rowEnd=void 0,this._renderCallback(b,A)}}},1680:function(P,v,b){var A=this&&this.__decorate||function(w,C,R,p){var $,F=arguments.length,O=F<3?C:p===null?p=Object.getOwnPropertyDescriptor(C,R):p;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")O=Reflect.decorate(w,C,R,p);else for(var L=w.length-1;L>=0;L--)($=w[L])&&(O=(F<3?$(O):F>3?$(C,R,O):$(C,R))||O);return F>3&&O&&Object.defineProperty(C,R,O),O},H=this&&this.__param||function(w,C){return function(R,p){C(R,p,w)}};Object.defineProperty(v,"__esModule",{value:!0}),v.Viewport=void 0;const E=b(3656),h=b(4725),D=b(8460),f=b(844),S=b(2585);let g=v.Viewport=class extends f.Disposable{constructor(w,C,R,p,$,F,O,L){super(),this._viewportElement=w,this._scrollArea=C,this._bufferService=R,this._optionsService=p,this._charSizeService=$,this._renderService=F,this._coreBrowserService=O,this.scrollBarWidth=0,this._currentRowHeight=0,this._currentDeviceCellHeight=0,this._lastRecordedBufferLength=0,this._lastRecordedViewportHeight=0,this._lastRecordedBufferHeight=0,this._lastTouchY=0,this._lastScrollTop=0,this._wheelPartialScroll=0,this._refreshAnimationFrame=null,this._ignoreNextScrollEvent=!1,this._smoothScrollState={startTime:0,origin:-1,target:-1},this._onRequestScrollLines=this.register(new D.EventEmitter),this.onRequestScrollLines=this._onRequestScrollLines.event,this.scrollBarWidth=this._viewportElement.offsetWidth-this._scrollArea.offsetWidth||15,this.register(E.addDisposableDomListener(this._viewportElement,"scroll",this._handleScroll.bind(this))),this._activeBuffer=this._bufferService.buffer,this.register(this._bufferService.buffers.onBufferActivate((Z)=>this._activeBuffer=Z.activeBuffer)),this._renderDimensions=this._renderService.dimensions,this.register(this._renderService.onDimensionsChange((Z)=>this._renderDimensions=Z)),this._handleThemeChange(L.colors),this.register(L.onChangeColors((Z)=>this._handleThemeChange(Z))),this.register(this._optionsService.onSpecificOptionChange("scrollback",()=>this.syncScrollArea())),setTimeout(()=>this.syncScrollArea())}_handleThemeChange(w){this._viewportElement.style.backgroundColor=w.background.css}reset(){this._currentRowHeight=0,this._currentDeviceCellHeight=0,this._lastRecordedBufferLength=0,this._lastRecordedViewportHeight=0,this._lastRecordedBufferHeight=0,this._lastTouchY=0,this._lastScrollTop=0,this._coreBrowserService.window.requestAnimationFrame(()=>this.syncScrollArea())}_refresh(w){if(w)return this._innerRefresh(),void(this._refreshAnimationFrame!==null&&this._coreBrowserService.window.cancelAnimationFrame(this._refreshAnimationFrame));this._refreshAnimationFrame===null&&(this._refreshAnimationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>this._innerRefresh()))}_innerRefresh(){if(this._charSizeService.height>0){this._currentRowHeight=this._renderService.dimensions.device.cell.height/this._coreBrowserService.dpr,this._currentDeviceCellHeight=this._renderService.dimensions.device.cell.height,this._lastRecordedViewportHeight=this._viewportElement.offsetHeight;const C=Math.round(this._currentRowHeight*this._lastRecordedBufferLength)+(this._lastRecordedViewportHeight-this._renderService.dimensions.css.canvas.height);this._lastRecordedBufferHeight!==C&&(this._lastRecordedBufferHeight=C,this._scrollArea.style.height=this._lastRecordedBufferHeight+"px")}const w=this._bufferService.buffer.ydisp*this._currentRowHeight;this._viewportElement.scrollTop!==w&&(this._ignoreNextScrollEvent=!0,this._viewportElement.scrollTop=w),this._refreshAnimationFrame=null}syncScrollArea(w=!1){if(this._lastRecordedBufferLength!==this._bufferService.buffer.lines.length)return this._lastRecordedBufferLength=this._bufferService.buffer.lines.length,void this._refresh(w);this._lastRecordedViewportHeight===this._renderService.dimensions.css.canvas.height&&this._lastScrollTop===this._activeBuffer.ydisp*this._currentRowHeight&&this._renderDimensions.device.cell.height===this._currentDeviceCellHeight||this._refresh(w)}_handleScroll(w){if(this._lastScrollTop=this._viewportElement.scrollTop,!this._viewportElement.offsetParent)return;if(this._ignoreNextScrollEvent)return this._ignoreNextScrollEvent=!1,void this._onRequestScrollLines.fire({amount:0,suppressScrollEvent:!0});const C=Math.round(this._lastScrollTop/this._currentRowHeight)-this._bufferService.buffer.ydisp;this._onRequestScrollLines.fire({amount:C,suppressScrollEvent:!0})}_smoothScroll(){if(this._isDisposed||this._smoothScrollState.origin===-1||this._smoothScrollState.target===-1)return;const w=this._smoothScrollPercent();this._viewportElement.scrollTop=this._smoothScrollState.origin+Math.round(w*(this._smoothScrollState.target-this._smoothScrollState.origin)),w<1?this._coreBrowserService.window.requestAnimationFrame(()=>this._smoothScroll()):this._clearSmoothScrollState()}_smoothScrollPercent(){return this._optionsService.rawOptions.smoothScrollDuration&&this._smoothScrollState.startTime?Math.max(Math.min((Date.now()-this._smoothScrollState.startTime)/this._optionsService.rawOptions.smoothScrollDuration,1),0):1}_clearSmoothScrollState(){this._smoothScrollState.startTime=0,this._smoothScrollState.origin=-1,this._smoothScrollState.target=-1}_bubbleScroll(w,C){const R=this._viewportElement.scrollTop+this._lastRecordedViewportHeight;return!(C<0&&this._viewportElement.scrollTop!==0||C>0&&R<this._lastRecordedBufferHeight)||(w.cancelable&&w.preventDefault(),!1)}handleWheel(w){const C=this._getPixelsScrolled(w);return C!==0&&(this._optionsService.rawOptions.smoothScrollDuration?(this._smoothScrollState.startTime=Date.now(),this._smoothScrollPercent()<1?(this._smoothScrollState.origin=this._viewportElement.scrollTop,this._smoothScrollState.target===-1?this._smoothScrollState.target=this._viewportElement.scrollTop+C:this._smoothScrollState.target+=C,this._smoothScrollState.target=Math.max(Math.min(this._smoothScrollState.target,this._viewportElement.scrollHeight),0),this._smoothScroll()):this._clearSmoothScrollState()):this._viewportElement.scrollTop+=C,this._bubbleScroll(w,C))}scrollLines(w){if(w!==0)if(this._optionsService.rawOptions.smoothScrollDuration){const C=w*this._currentRowHeight;this._smoothScrollState.startTime=Date.now(),this._smoothScrollPercent()<1?(this._smoothScrollState.origin=this._viewportElement.scrollTop,this._smoothScrollState.target=this._smoothScrollState.origin+C,this._smoothScrollState.target=Math.max(Math.min(this._smoothScrollState.target,this._viewportElement.scrollHeight),0),this._smoothScroll()):this._clearSmoothScrollState()}else this._onRequestScrollLines.fire({amount:w,suppressScrollEvent:!1})}_getPixelsScrolled(w){if(w.deltaY===0||w.shiftKey)return 0;let C=this._applyScrollModifier(w.deltaY,w);return w.deltaMode===WheelEvent.DOM_DELTA_LINE?C*=this._currentRowHeight:w.deltaMode===WheelEvent.DOM_DELTA_PAGE&&(C*=this._currentRowHeight*this._bufferService.rows),C}getBufferElements(w,C){var R;let p,$="";const F=[],O=C!=null?C:this._bufferService.buffer.lines.length,L=this._bufferService.buffer.lines;for(let Z=w;Z<O;Z++){const W=L.get(Z);if(!W)continue;const B=(R=L.get(Z+1))===null||R===void 0?void 0:R.isWrapped;if($+=W.translateToString(!B),!B||Z===L.length-1){const Y=document.createElement("div");Y.textContent=$,F.push(Y),$.length>0&&(p=Y),$=""}}return{bufferElements:F,cursorElement:p}}getLinesScrolled(w){if(w.deltaY===0||w.shiftKey)return 0;let C=this._applyScrollModifier(w.deltaY,w);return w.deltaMode===WheelEvent.DOM_DELTA_PIXEL?(C/=this._currentRowHeight+0,this._wheelPartialScroll+=C,C=Math.floor(Math.abs(this._wheelPartialScroll))*(this._wheelPartialScroll>0?1:-1),this._wheelPartialScroll%=1):w.deltaMode===WheelEvent.DOM_DELTA_PAGE&&(C*=this._bufferService.rows),C}_applyScrollModifier(w,C){const R=this._optionsService.rawOptions.fastScrollModifier;return R==="alt"&&C.altKey||R==="ctrl"&&C.ctrlKey||R==="shift"&&C.shiftKey?w*this._optionsService.rawOptions.fastScrollSensitivity*this._optionsService.rawOptions.scrollSensitivity:w*this._optionsService.rawOptions.scrollSensitivity}handleTouchStart(w){this._lastTouchY=w.touches[0].pageY}handleTouchMove(w){const C=this._lastTouchY-w.touches[0].pageY;return this._lastTouchY=w.touches[0].pageY,C!==0&&(this._viewportElement.scrollTop+=C,this._bubbleScroll(w,C))}};v.Viewport=g=A([H(2,S.IBufferService),H(3,S.IOptionsService),H(4,h.ICharSizeService),H(5,h.IRenderService),H(6,h.ICoreBrowserService),H(7,h.IThemeService)],g)},3107:function(P,v,b){var A=this&&this.__decorate||function(g,w,C,R){var p,$=arguments.length,F=$<3?w:R===null?R=Object.getOwnPropertyDescriptor(w,C):R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")F=Reflect.decorate(g,w,C,R);else for(var O=g.length-1;O>=0;O--)(p=g[O])&&(F=($<3?p(F):$>3?p(w,C,F):p(w,C))||F);return $>3&&F&&Object.defineProperty(w,C,F),F},H=this&&this.__param||function(g,w){return function(C,R){w(C,R,g)}};Object.defineProperty(v,"__esModule",{value:!0}),v.BufferDecorationRenderer=void 0;const E=b(3656),h=b(4725),D=b(844),f=b(2585);let S=v.BufferDecorationRenderer=class extends D.Disposable{constructor(g,w,C,R){super(),this._screenElement=g,this._bufferService=w,this._decorationService=C,this._renderService=R,this._decorationElements=new Map,this._altBufferIsActive=!1,this._dimensionsChanged=!1,this._container=document.createElement("div"),this._container.classList.add("xterm-decoration-container"),this._screenElement.appendChild(this._container),this.register(this._renderService.onRenderedViewportChange(()=>this._doRefreshDecorations())),this.register(this._renderService.onDimensionsChange(()=>{this._dimensionsChanged=!0,this._queueRefresh()})),this.register(E.addDisposableDomListener(window,"resize",()=>this._queueRefresh())),this.register(this._bufferService.buffers.onBufferActivate(()=>{this._altBufferIsActive=this._bufferService.buffer===this._bufferService.buffers.alt})),this.register(this._decorationService.onDecorationRegistered(()=>this._queueRefresh())),this.register(this._decorationService.onDecorationRemoved((p)=>this._removeDecoration(p))),this.register(D.toDisposable(()=>{this._container.remove(),this._decorationElements.clear()}))}_queueRefresh(){this._animationFrame===void 0&&(this._animationFrame=this._renderService.addRefreshCallback(()=>{this._doRefreshDecorations(),this._animationFrame=void 0}))}_doRefreshDecorations(){for(let g of this._decorationService.decorations)this._renderDecoration(g);this._dimensionsChanged=!1}_renderDecoration(g){this._refreshStyle(g),this._dimensionsChanged&&this._refreshXPosition(g)}_createElement(g){var w,C;const R=document.createElement("div");R.classList.add("xterm-decoration"),R.classList.toggle("xterm-decoration-top-layer",((w=g==null?void 0:g.options)===null||w===void 0?void 0:w.layer)==="top"),R.style.width=`${Math.round((g.options.width||1)*this._renderService.dimensions.css.cell.width)}px`,R.style.height=(g.options.height||1)*this._renderService.dimensions.css.cell.height+"px",R.style.top=(g.marker.line-this._bufferService.buffers.active.ydisp)*this._renderService.dimensions.css.cell.height+"px",R.style.lineHeight=`${this._renderService.dimensions.css.cell.height}px`;const p=(C=g.options.x)!==null&&C!==void 0?C:0;return p&&p>this._bufferService.cols&&(R.style.display="none"),this._refreshXPosition(g,R),R}_refreshStyle(g){const w=g.marker.line-this._bufferService.buffers.active.ydisp;if(w<0||w>=this._bufferService.rows)g.element&&(g.element.style.display="none",g.onRenderEmitter.fire(g.element));else{let C=this._decorationElements.get(g);C||(C=this._createElement(g),g.element=C,this._decorationElements.set(g,C),this._container.appendChild(C),g.onDispose(()=>{this._decorationElements.delete(g),C.remove()})),C.style.top=w*this._renderService.dimensions.css.cell.height+"px",C.style.display=this._altBufferIsActive?"none":"block",g.onRenderEmitter.fire(C)}}_refreshXPosition(g,w=g.element){var C;if(!w)return;const R=(C=g.options.x)!==null&&C!==void 0?C:0;(g.options.anchor||"left")==="right"?w.style.right=R?R*this._renderService.dimensions.css.cell.width+"px":"":w.style.left=R?R*this._renderService.dimensions.css.cell.width+"px":""}_removeDecoration(g){var w;(w=this._decorationElements.get(g))===null||w===void 0||w.remove(),this._decorationElements.delete(g),g.dispose()}};v.BufferDecorationRenderer=S=A([H(1,f.IBufferService),H(2,f.IDecorationService),H(3,h.IRenderService)],S)},5871:(P,v)=>{Object.defineProperty(v,"__esModule",{value:!0}),v.ColorZoneStore=void 0,v.ColorZoneStore=class{constructor(){this._zones=[],this._zonePool=[],this._zonePoolIndex=0,this._linePadding={full:0,left:0,center:0,right:0}}get zones(){return this._zonePool.length=Math.min(this._zonePool.length,this._zones.length),this._zones}clear(){this._zones.length=0,this._zonePoolIndex=0}addDecoration(b){if(b.options.overviewRulerOptions){for(let A of this._zones)if(A.color===b.options.overviewRulerOptions.color&&A.position===b.options.overviewRulerOptions.position){if(this._lineIntersectsZone(A,b.marker.line))return;if(this._lineAdjacentToZone(A,b.marker.line,b.options.overviewRulerOptions.position))return void this._addLineToZone(A,b.marker.line)}if(this._zonePoolIndex<this._zonePool.length)return this._zonePool[this._zonePoolIndex].color=b.options.overviewRulerOptions.color,this._zonePool[this._zonePoolIndex].position=b.options.overviewRulerOptions.position,this._zonePool[this._zonePoolIndex].startBufferLine=b.marker.line,this._zonePool[this._zonePoolIndex].endBufferLine=b.marker.line,void this._zones.push(this._zonePool[this._zonePoolIndex++]);this._zones.push({color:b.options.overviewRulerOptions.color,position:b.options.overviewRulerOptions.position,startBufferLine:b.marker.line,endBufferLine:b.marker.line}),this._zonePool.push(this._zones[this._zones.length-1]),this._zonePoolIndex++}}setPadding(b){this._linePadding=b}_lineIntersectsZone(b,A){return A>=b.startBufferLine&&A<=b.endBufferLine}_lineAdjacentToZone(b,A,H){return A>=b.startBufferLine-this._linePadding[H||"full"]&&A<=b.endBufferLine+this._linePadding[H||"full"]}_addLineToZone(b,A){b.startBufferLine=Math.min(b.startBufferLine,A),b.endBufferLine=Math.max(b.endBufferLine,A)}}},5744:function(P,v,b){var A=this&&this.__decorate||function(p,$,F,O){var L,Z=arguments.length,W=Z<3?$:O===null?O=Object.getOwnPropertyDescriptor($,F):O;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")W=Reflect.decorate(p,$,F,O);else for(var B=p.length-1;B>=0;B--)(L=p[B])&&(W=(Z<3?L(W):Z>3?L($,F,W):L($,F))||W);return Z>3&&W&&Object.defineProperty($,F,W),W},H=this&&this.__param||function(p,$){return function(F,O){$(F,O,p)}};Object.defineProperty(v,"__esModule",{value:!0}),v.OverviewRulerRenderer=void 0;const E=b(5871),h=b(3656),D=b(4725),f=b(844),S=b(2585),g={full:0,left:0,center:0,right:0},w={full:0,left:0,center:0,right:0},C={full:0,left:0,center:0,right:0};let R=v.OverviewRulerRenderer=class extends f.Disposable{get _width(){return this._optionsService.options.overviewRulerWidth||0}constructor(p,$,F,O,L,Z,W){var B;super(),this._viewportElement=p,this._screenElement=$,this._bufferService=F,this._decorationService=O,this._renderService=L,this._optionsService=Z,this._coreBrowseService=W,this._colorZoneStore=new E.ColorZoneStore,this._shouldUpdateDimensions=!0,this._shouldUpdateAnchor=!0,this._lastKnownBufferLength=0,this._canvas=document.createElement("canvas"),this._canvas.classList.add("xterm-decoration-overview-ruler"),this._refreshCanvasDimensions(),(B=this._viewportElement.parentElement)===null||B===void 0||B.insertBefore(this._canvas,this._viewportElement);const Y=this._canvas.getContext("2d");if(!Y)throw new Error("Ctx cannot be null");this._ctx=Y,this._registerDecorationListeners(),this._registerBufferChangeListeners(),this._registerDimensionChangeListeners(),this.register(f.toDisposable(()=>{var G;(G=this._canvas)===null||G===void 0||G.remove()}))}_registerDecorationListeners(){this.register(this._decorationService.onDecorationRegistered(()=>this._queueRefresh(void 0,!0))),this.register(this._decorationService.onDecorationRemoved(()=>this._queueRefresh(void 0,!0)))}_registerBufferChangeListeners(){this.register(this._renderService.onRenderedViewportChange(()=>this._queueRefresh())),this.register(this._bufferService.buffers.onBufferActivate(()=>{this._canvas.style.display=this._bufferService.buffer===this._bufferService.buffers.alt?"none":"block"})),this.register(this._bufferService.onScroll(()=>{this._lastKnownBufferLength!==this._bufferService.buffers.normal.lines.length&&(this._refreshDrawHeightConstants(),this._refreshColorZonePadding())}))}_registerDimensionChangeListeners(){this.register(this._renderService.onRender(()=>{this._containerHeight&&this._containerHeight===this._screenElement.clientHeight||(this._queueRefresh(!0),this._containerHeight=this._screenElement.clientHeight)})),this.register(this._optionsService.onSpecificOptionChange("overviewRulerWidth",()=>this._queueRefresh(!0))),this.register(h.addDisposableDomListener(this._coreBrowseService.window,"resize",()=>this._queueRefresh(!0))),this._queueRefresh(!0)}_refreshDrawConstants(){const p=Math.floor(this._canvas.width/3),$=Math.ceil(this._canvas.width/3);w.full=this._canvas.width,w.left=p,w.center=$,w.right=p,this._refreshDrawHeightConstants(),C.full=0,C.left=0,C.center=w.left,C.right=w.left+w.center}_refreshDrawHeightConstants(){g.full=Math.round(2*this._coreBrowseService.dpr);const p=this._canvas.height/this._bufferService.buffer.lines.length,$=Math.round(Math.max(Math.min(p,12),6)*this._coreBrowseService.dpr);g.left=$,g.center=$,g.right=$}_refreshColorZonePadding(){this._colorZoneStore.setPadding({full:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*g.full),left:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*g.left),center:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*g.center),right:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*g.right)}),this._lastKnownBufferLength=this._bufferService.buffers.normal.lines.length}_refreshCanvasDimensions(){this._canvas.style.width=`${this._width}px`,this._canvas.width=Math.round(this._width*this._coreBrowseService.dpr),this._canvas.style.height=`${this._screenElement.clientHeight}px`,this._canvas.height=Math.round(this._screenElement.clientHeight*this._coreBrowseService.dpr),this._refreshDrawConstants(),this._refreshColorZonePadding()}_refreshDecorations(){this._shouldUpdateDimensions&&this._refreshCanvasDimensions(),this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height),this._colorZoneStore.clear();for(let $ of this._decorationService.decorations)this._colorZoneStore.addDecoration($);this._ctx.lineWidth=1;const p=this._colorZoneStore.zones;for(let $ of p)$.position!=="full"&&this._renderColorZone($);for(let $ of p)$.position==="full"&&this._renderColorZone($);this._shouldUpdateDimensions=!1,this._shouldUpdateAnchor=!1}_renderColorZone(p){this._ctx.fillStyle=p.color,this._ctx.fillRect(C[p.position||"full"],Math.round((this._canvas.height-1)*(p.startBufferLine/this._bufferService.buffers.active.lines.length)-g[p.position||"full"]/2),w[p.position||"full"],Math.round((this._canvas.height-1)*((p.endBufferLine-p.startBufferLine)/this._bufferService.buffers.active.lines.length)+g[p.position||"full"]))}_queueRefresh(p,$){this._shouldUpdateDimensions=p||this._shouldUpdateDimensions,this._shouldUpdateAnchor=$||this._shouldUpdateAnchor,this._animationFrame===void 0&&(this._animationFrame=this._coreBrowseService.window.requestAnimationFrame(()=>{this._refreshDecorations(),this._animationFrame=void 0}))}};v.OverviewRulerRenderer=R=A([H(2,S.IBufferService),H(3,S.IDecorationService),H(4,D.IRenderService),H(5,S.IOptionsService),H(6,D.ICoreBrowserService)],R)},2950:function(P,v,b){var A=this&&this.__decorate||function(S,g,w,C){var R,p=arguments.length,$=p<3?g:C===null?C=Object.getOwnPropertyDescriptor(g,w):C;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")$=Reflect.decorate(S,g,w,C);else for(var F=S.length-1;F>=0;F--)(R=S[F])&&($=(p<3?R($):p>3?R(g,w,$):R(g,w))||$);return p>3&&$&&Object.defineProperty(g,w,$),$},H=this&&this.__param||function(S,g){return function(w,C){g(w,C,S)}};Object.defineProperty(v,"__esModule",{value:!0}),v.CompositionHelper=void 0;const E=b(4725),h=b(2585),D=b(2584);let f=v.CompositionHelper=class{get isComposing(){return this._isComposing}constructor(S,g,w,C,R,p){this._textarea=S,this._compositionView=g,this._bufferService=w,this._optionsService=C,this._coreService=R,this._renderService=p,this._isComposing=!1,this._isSendingComposition=!1,this._compositionPosition={start:0,end:0},this._dataAlreadySent=""}compositionstart(){this._isComposing=!0,this._compositionPosition.start=this._textarea.value.length,this._compositionView.textContent="",this._dataAlreadySent="",this._compositionView.classList.add("active")}compositionupdate(S){this._compositionView.textContent=S.data,this.updateCompositionElements(),setTimeout(()=>{this._compositionPosition.end=this._textarea.value.length},0)}compositionend(){this._finalizeComposition(!0)}keydown(S){if(this._isComposing||this._isSendingComposition){if(S.keyCode===229)return!1;if(S.keyCode===16||S.keyCode===17||S.keyCode===18)return!1;this._finalizeComposition(!1)}return S.keyCode!==229||(this._handleAnyTextareaChanges(),!1)}_finalizeComposition(S){if(this._compositionView.classList.remove("active"),this._isComposing=!1,S){const g={start:this._compositionPosition.start,end:this._compositionPosition.end};this._isSendingComposition=!0,setTimeout(()=>{if(this._isSendingComposition){let w;this._isSendingComposition=!1,g.start+=this._dataAlreadySent.length,w=this._isComposing?this._textarea.value.substring(g.start,g.end):this._textarea.value.substring(g.start),w.length>0&&this._coreService.triggerDataEvent(w,!0)}},0)}else{this._isSendingComposition=!1;const g=this._textarea.value.substring(this._compositionPosition.start,this._compositionPosition.end);this._coreService.triggerDataEvent(g,!0)}}_handleAnyTextareaChanges(){const S=this._textarea.value;setTimeout(()=>{if(!this._isComposing){const g=this._textarea.value,w=g.replace(S,"");this._dataAlreadySent=w,g.length>S.length?this._coreService.triggerDataEvent(w,!0):g.length<S.length?this._coreService.triggerDataEvent(`${D.C0.DEL}`,!0):g.length===S.length&&g!==S&&this._coreService.triggerDataEvent(g,!0)}},0)}updateCompositionElements(S){if(this._isComposing){if(this._bufferService.buffer.isCursorInViewport){const g=Math.min(this._bufferService.buffer.x,this._bufferService.cols-1),w=this._renderService.dimensions.css.cell.height,C=this._bufferService.buffer.y*this._renderService.dimensions.css.cell.height,R=g*this._renderService.dimensions.css.cell.width;this._compositionView.style.left=R+"px",this._compositionView.style.top=C+"px",this._compositionView.style.height=w+"px",this._compositionView.style.lineHeight=w+"px",this._compositionView.style.fontFamily=this._optionsService.rawOptions.fontFamily,this._compositionView.style.fontSize=this._optionsService.rawOptions.fontSize+"px";const p=this._compositionView.getBoundingClientRect();this._textarea.style.left=R+"px",this._textarea.style.top=C+"px",this._textarea.style.width=Math.max(p.width,1)+"px",this._textarea.style.height=Math.max(p.height,1)+"px",this._textarea.style.lineHeight=p.height+"px"}S||setTimeout(()=>this.updateCompositionElements(!0),0)}}};v.CompositionHelper=f=A([H(2,h.IBufferService),H(3,h.IOptionsService),H(4,h.ICoreService),H(5,E.IRenderService)],f)},9806:(P,v)=>{function b(A,H,E){const h=E.getBoundingClientRect(),D=A.getComputedStyle(E),f=parseInt(D.getPropertyValue("padding-left")),S=parseInt(D.getPropertyValue("padding-top"));return[H.clientX-h.left-f,H.clientY-h.top-S]}Object.defineProperty(v,"__esModule",{value:!0}),v.getCoords=v.getCoordsRelativeToElement=void 0,v.getCoordsRelativeToElement=b,v.getCoords=function(A,H,E,h,D,f,S,g,w){if(!f)return;const C=b(A,H,E);return C?(C[0]=Math.ceil((C[0]+(w?S/2:0))/S),C[1]=Math.ceil(C[1]/g),C[0]=Math.min(Math.max(C[0],1),h+(w?1:0)),C[1]=Math.min(Math.max(C[1],1),D),C):void 0}},9504:(P,v,b)=>{Object.defineProperty(v,"__esModule",{value:!0}),v.moveToCellSequence=void 0;const A=b(2584);function H(g,w,C,R){const p=g-E(g,C),$=w-E(w,C),F=Math.abs(p-$)-function(O,L,Z){let W=0;const B=O-E(O,Z),Y=L-E(L,Z);for(let G=0;G<Math.abs(B-Y);G++){const T=h(O,L)==="A"?-1:1,J=Z.buffer.lines.get(B+T*G);(J==null?void 0:J.isWrapped)&&W++}return W}(g,w,C);return S(F,f(h(g,w),R))}function E(g,w){let C=0,R=w.buffer.lines.get(g),p=R==null?void 0:R.isWrapped;for(;p&&g>=0&&g<w.rows;)C++,R=w.buffer.lines.get(--g),p=R==null?void 0:R.isWrapped;return C}function h(g,w){return g>w?"A":"B"}function D(g,w,C,R,p,$){let F=g,O=w,L="";for(;F!==C||O!==R;)F+=p?1:-1,p&&F>$.cols-1?(L+=$.buffer.translateBufferLineToString(O,!1,g,F),F=0,g=0,O++):!p&&F<0&&(L+=$.buffer.translateBufferLineToString(O,!1,0,g+1),F=$.cols-1,g=F,O--);return L+$.buffer.translateBufferLineToString(O,!1,g,F)}function f(g,w){const C=w?"O":"[";return A.C0.ESC+C+g}function S(g,w){g=Math.floor(g);let C="";for(let R=0;R<g;R++)C+=w;return C}v.moveToCellSequence=function(g,w,C,R){const p=C.buffer.x,$=C.buffer.y;if(!C.buffer.hasScrollback)return function(L,Z,W,B,Y,G){return H(Z,B,Y,G).length===0?"":S(D(L,Z,L,Z-E(Z,Y),!1,Y).length,f("D",G))}(p,$,0,w,C,R)+H($,w,C,R)+function(L,Z,W,B,Y,G){let T;T=H(Z,B,Y,G).length>0?B-E(B,Y):Z;const J=B,X=function(m,q,V,Q,k,N){let y;return y=H(V,Q,k,N).length>0?Q-E(Q,k):q,m<V&&y<=Q||m>=V&&y<Q?"C":"D"}(L,Z,W,B,Y,G);return S(D(L,T,W,J,X==="C",Y).length,f(X,G))}(p,$,g,w,C,R);let F;if($===w)return F=p>g?"D":"C",S(Math.abs(p-g),f(F,R));F=$>w?"D":"C";const O=Math.abs($-w);return S(function(L,Z){return Z.cols-L}($>w?g:p,C)+(O-1)*C.cols+1+(($>w?p:g)-1),f(F,R))}},1296:function(P,v,b){var A=this&&this.__decorate||function(Y,G,T,J){var X,m=arguments.length,q=m<3?G:J===null?J=Object.getOwnPropertyDescriptor(G,T):J;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")q=Reflect.decorate(Y,G,T,J);else for(var V=Y.length-1;V>=0;V--)(X=Y[V])&&(q=(m<3?X(q):m>3?X(G,T,q):X(G,T))||q);return m>3&&q&&Object.defineProperty(G,T,q),q},H=this&&this.__param||function(Y,G){return function(T,J){G(T,J,Y)}};Object.defineProperty(v,"__esModule",{value:!0}),v.DomRenderer=void 0;const E=b(3787),h=b(2550),D=b(2223),f=b(6171),S=b(4725),g=b(8055),w=b(8460),C=b(844),R=b(2585),p="xterm-dom-renderer-owner-",$="xterm-rows",F="xterm-fg-",O="xterm-bg-",L="xterm-focus",Z="xterm-selection";let W=1,B=v.DomRenderer=class extends C.Disposable{constructor(Y,G,T,J,X,m,q,V,Q,k){super(),this._element=Y,this._screenElement=G,this._viewportElement=T,this._linkifier2=J,this._charSizeService=m,this._optionsService=q,this._bufferService=V,this._coreBrowserService=Q,this._themeService=k,this._terminalClass=W++,this._rowElements=[],this.onRequestRedraw=this.register(new w.EventEmitter).event,this._rowContainer=document.createElement("div"),this._rowContainer.classList.add($),this._rowContainer.style.lineHeight="normal",this._rowContainer.setAttribute("aria-hidden","true"),this._refreshRowElements(this._bufferService.cols,this._bufferService.rows),this._selectionContainer=document.createElement("div"),this._selectionContainer.classList.add(Z),this._selectionContainer.setAttribute("aria-hidden","true"),this.dimensions=f.createRenderDimensions(),this._updateDimensions(),this.register(this._optionsService.onOptionChange(()=>this._handleOptionsChanged())),this.register(this._themeService.onChangeColors((N)=>this._injectCss(N))),this._injectCss(this._themeService.colors),this._rowFactory=X.createInstance(E.DomRendererRowFactory,document),this._element.classList.add(p+this._terminalClass),this._screenElement.appendChild(this._rowContainer),this._screenElement.appendChild(this._selectionContainer),this.register(this._linkifier2.onShowLinkUnderline((N)=>this._handleLinkHover(N))),this.register(this._linkifier2.onHideLinkUnderline((N)=>this._handleLinkLeave(N))),this.register(C.toDisposable(()=>{this._element.classList.remove(p+this._terminalClass),this._rowContainer.remove(),this._selectionContainer.remove(),this._widthCache.dispose(),this._themeStyleElement.remove(),this._dimensionsStyleElement.remove()})),this._widthCache=new h.WidthCache(document),this._widthCache.setFont(this._optionsService.rawOptions.fontFamily,this._optionsService.rawOptions.fontSize,this._optionsService.rawOptions.fontWeight,this._optionsService.rawOptions.fontWeightBold),this._setDefaultSpacing()}_updateDimensions(){const Y=this._coreBrowserService.dpr;this.dimensions.device.char.width=this._charSizeService.width*Y,this.dimensions.device.char.height=Math.ceil(this._charSizeService.height*Y),this.dimensions.device.cell.width=this.dimensions.device.char.width+Math.round(this._optionsService.rawOptions.letterSpacing),this.dimensions.device.cell.height=Math.floor(this.dimensions.device.char.height*this._optionsService.rawOptions.lineHeight),this.dimensions.device.char.left=0,this.dimensions.device.char.top=0,this.dimensions.device.canvas.width=this.dimensions.device.cell.width*this._bufferService.cols,this.dimensions.device.canvas.height=this.dimensions.device.cell.height*this._bufferService.rows,this.dimensions.css.canvas.width=Math.round(this.dimensions.device.canvas.width/Y),this.dimensions.css.canvas.height=Math.round(this.dimensions.device.canvas.height/Y),this.dimensions.css.cell.width=this.dimensions.css.canvas.width/this._bufferService.cols,this.dimensions.css.cell.height=this.dimensions.css.canvas.height/this._bufferService.rows;for(let T of this._rowElements)T.style.width=`${this.dimensions.css.canvas.width}px`,T.style.height=`${this.dimensions.css.cell.height}px`,T.style.lineHeight=`${this.dimensions.css.cell.height}px`,T.style.overflow="hidden";this._dimensionsStyleElement||(this._dimensionsStyleElement=document.createElement("style"),this._screenElement.appendChild(this._dimensionsStyleElement));const G=`${this._terminalSelector} .${$} span { display: inline-block; height: 100%; vertical-align: top;}`;this._dimensionsStyleElement.textContent=G,this._selectionContainer.style.height=this._viewportElement.style.height,this._screenElement.style.width=`${this.dimensions.css.canvas.width}px`,this._screenElement.style.height=`${this.dimensions.css.canvas.height}px`}_injectCss(Y){this._themeStyleElement||(this._themeStyleElement=document.createElement("style"),this._screenElement.appendChild(this._themeStyleElement));let G=`${this._terminalSelector} .${$} { color: ${Y.foreground.css}; font-family: ${this._optionsService.rawOptions.fontFamily}; font-size: ${this._optionsService.rawOptions.fontSize}px; font-kerning: none; white-space: pre}`;G+=`${this._terminalSelector} .${$} .xterm-dim { color: ${g.color.multiplyOpacity(Y.foreground,0.5).css};}`,G+=`${this._terminalSelector} span:not(.xterm-bold) { font-weight: ${this._optionsService.rawOptions.fontWeight};}${this._terminalSelector} span.xterm-bold { font-weight: ${this._optionsService.rawOptions.fontWeightBold};}${this._terminalSelector} span.xterm-italic { font-style: italic;}`,G+="@keyframes blink_box_shadow_"+this._terminalClass+" { 50% {  border-bottom-style: hidden; }}",G+="@keyframes blink_block_"+this._terminalClass+" { 0% {"+`  background-color: ${Y.cursor.css};`+`  color: ${Y.cursorAccent.css}; } 50% {  background-color: inherit;`+`  color: ${Y.cursor.css}; }}`,G+=`${this._terminalSelector} .${$}.${L} .xterm-cursor.xterm-cursor-blink:not(.xterm-cursor-block) { animation: blink_box_shadow_`+this._terminalClass+" 1s step-end infinite;}"+`${this._terminalSelector} .${$}.${L} .xterm-cursor.xterm-cursor-blink.xterm-cursor-block { animation: blink_block_`+this._terminalClass+" 1s step-end infinite;}"+`${this._terminalSelector} .${$} .xterm-cursor.xterm-cursor-block {`+` background-color: ${Y.cursor.css};`+` color: ${Y.cursorAccent.css};}`+`${this._terminalSelector} .${$} .xterm-cursor.xterm-cursor-outline {`+` outline: 1px solid ${Y.cursor.css}; outline-offset: -1px;}`+`${this._terminalSelector} .${$} .xterm-cursor.xterm-cursor-bar {`+` box-shadow: ${this._optionsService.rawOptions.cursorWidth}px 0 0 ${Y.cursor.css} inset;}`+`${this._terminalSelector} .${$} .xterm-cursor.xterm-cursor-underline {`+` border-bottom: 1px ${Y.cursor.css}; border-bottom-style: solid; height: calc(100% - 1px);}`,G+=`${this._terminalSelector} .${Z} { position: absolute; top: 0; left: 0; z-index: 1; pointer-events: none;}${this._terminalSelector}.focus .${Z} div { position: absolute; background-color: ${Y.selectionBackgroundOpaque.css};}${this._terminalSelector} .${Z} div { position: absolute; background-color: ${Y.selectionInactiveBackgroundOpaque.css};}`;for(let[T,J]of Y.ansi.entries())G+=`${this._terminalSelector} .${F}${T} { color: ${J.css}; }${this._terminalSelector} .${F}${T}.xterm-dim { color: ${g.color.multiplyOpacity(J,0.5).css}; }${this._terminalSelector} .${O}${T} { background-color: ${J.css}; }`;G+=`${this._terminalSelector} .${F}${D.INVERTED_DEFAULT_COLOR} { color: ${g.color.opaque(Y.background).css}; }${this._terminalSelector} .${F}${D.INVERTED_DEFAULT_COLOR}.xterm-dim { color: ${g.color.multiplyOpacity(g.color.opaque(Y.background),0.5).css}; }${this._terminalSelector} .${O}${D.INVERTED_DEFAULT_COLOR} { background-color: ${Y.foreground.css}; }`,this._themeStyleElement.textContent=G}_setDefaultSpacing(){const Y=this.dimensions.css.cell.width-this._widthCache.get("W",!1,!1);this._rowContainer.style.letterSpacing=`${Y}px`,this._rowFactory.defaultSpacing=Y}handleDevicePixelRatioChange(){this._updateDimensions(),this._widthCache.clear(),this._setDefaultSpacing()}_refreshRowElements(Y,G){for(let T=this._rowElements.length;T<=G;T++){const J=document.createElement("div");this._rowContainer.appendChild(J),this._rowElements.push(J)}for(;this._rowElements.length>G;)this._rowContainer.removeChild(this._rowElements.pop())}handleResize(Y,G){this._refreshRowElements(Y,G),this._updateDimensions()}handleCharSizeChanged(){this._updateDimensions(),this._widthCache.clear(),this._setDefaultSpacing()}handleBlur(){this._rowContainer.classList.remove(L)}handleFocus(){this._rowContainer.classList.add(L),this.renderRows(this._bufferService.buffer.y,this._bufferService.buffer.y)}handleSelectionChanged(Y,G,T){if(this._selectionContainer.replaceChildren(),this._rowFactory.handleSelectionChanged(Y,G,T),this.renderRows(0,this._bufferService.rows-1),!Y||!G)return;const J=Y[1]-this._bufferService.buffer.ydisp,X=G[1]-this._bufferService.buffer.ydisp,m=Math.max(J,0),q=Math.min(X,this._bufferService.rows-1);if(m>=this._bufferService.rows||q<0)return;const V=document.createDocumentFragment();if(T){const Q=Y[0]>G[0];V.appendChild(this._createSelectionElement(m,Q?G[0]:Y[0],Q?Y[0]:G[0],q-m+1))}else{const Q=J===m?Y[0]:0,k=m===X?G[0]:this._bufferService.cols;V.appendChild(this._createSelectionElement(m,Q,k));const N=q-m-1;if(V.appendChild(this._createSelectionElement(m+1,0,this._bufferService.cols,N)),m!==q){const y=X===q?G[0]:this._bufferService.cols;V.appendChild(this._createSelectionElement(q,0,y))}}this._selectionContainer.appendChild(V)}_createSelectionElement(Y,G,T,J=1){const X=document.createElement("div");return X.style.height=J*this.dimensions.css.cell.height+"px",X.style.top=Y*this.dimensions.css.cell.height+"px",X.style.left=G*this.dimensions.css.cell.width+"px",X.style.width=this.dimensions.css.cell.width*(T-G)+"px",X}handleCursorMove(){}_handleOptionsChanged(){this._updateDimensions(),this._injectCss(this._themeService.colors),this._widthCache.setFont(this._optionsService.rawOptions.fontFamily,this._optionsService.rawOptions.fontSize,this._optionsService.rawOptions.fontWeight,this._optionsService.rawOptions.fontWeightBold),this._setDefaultSpacing()}clear(){for(let Y of this._rowElements)Y.replaceChildren()}renderRows(Y,G){const T=this._bufferService.buffer,J=T.ybase+T.y,X=Math.min(T.x,this._bufferService.cols-1),m=this._optionsService.rawOptions.cursorBlink,q=this._optionsService.rawOptions.cursorStyle,V=this._optionsService.rawOptions.cursorInactiveStyle;for(let Q=Y;Q<=G;Q++){const k=Q+T.ydisp,N=this._rowElements[Q],y=T.lines.get(k);if(!N||!y)break;N.replaceChildren(...this._rowFactory.createRow(y,k,k===J,q,V,X,m,this.dimensions.css.cell.width,this._widthCache,-1,-1))}}get _terminalSelector(){return`.${p}${this._terminalClass}`}_handleLinkHover(Y){this._setCellUnderline(Y.x1,Y.x2,Y.y1,Y.y2,Y.cols,!0)}_handleLinkLeave(Y){this._setCellUnderline(Y.x1,Y.x2,Y.y1,Y.y2,Y.cols,!1)}_setCellUnderline(Y,G,T,J,X,m){T<0&&(Y=0),J<0&&(G=0);const q=this._bufferService.rows-1;T=Math.max(Math.min(T,q),0),J=Math.max(Math.min(J,q),0),X=Math.min(X,this._bufferService.cols);const V=this._bufferService.buffer,Q=V.ybase+V.y,k=Math.min(V.x,X-1),N=this._optionsService.rawOptions.cursorBlink,y=this._optionsService.rawOptions.cursorStyle,u=this._optionsService.rawOptions.cursorInactiveStyle;for(let c=T;c<=J;++c){const M=c+V.ydisp,_=this._rowElements[c],U=V.lines.get(M);if(!_||!U)break;_.replaceChildren(...this._rowFactory.createRow(U,M,M===Q,y,u,k,N,this.dimensions.css.cell.width,this._widthCache,m?c===T?Y:0:-1,m?(c===J?G:X)-1:-1))}}};v.DomRenderer=B=A([H(4,R.IInstantiationService),H(5,S.ICharSizeService),H(6,R.IOptionsService),H(7,R.IBufferService),H(8,S.ICoreBrowserService),H(9,S.IThemeService)],B)},3787:function(P,v,b){var A=this&&this.__decorate||function(F,O,L,Z){var W,B=arguments.length,Y=B<3?O:Z===null?Z=Object.getOwnPropertyDescriptor(O,L):Z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")Y=Reflect.decorate(F,O,L,Z);else for(var G=F.length-1;G>=0;G--)(W=F[G])&&(Y=(B<3?W(Y):B>3?W(O,L,Y):W(O,L))||Y);return B>3&&Y&&Object.defineProperty(O,L,Y),Y},H=this&&this.__param||function(F,O){return function(L,Z){O(L,Z,F)}};Object.defineProperty(v,"__esModule",{value:!0}),v.DomRendererRowFactory=void 0;const E=b(2223),h=b(643),D=b(511),f=b(2585),S=b(8055),g=b(4725),w=b(4269),C=b(6171),R=b(3734);let p=v.DomRendererRowFactory=class{constructor(F,O,L,Z,W,B,Y){this._document=F,this._characterJoinerService=O,this._optionsService=L,this._coreBrowserService=Z,this._coreService=W,this._decorationService=B,this._themeService=Y,this._workCell=new D.CellData,this._columnSelectMode=!1,this.defaultSpacing=0}handleSelectionChanged(F,O,L){this._selectionStart=F,this._selectionEnd=O,this._columnSelectMode=L}createRow(F,O,L,Z,W,B,Y,G,T,J,X){const m=[],q=this._characterJoinerService.getJoinedCharacters(O),V=this._themeService.colors;let Q,k=F.getNoBgTrimmedLength();L&&k<B+1&&(k=B+1);let N=0,y="",u=0,c=0,M=0,_=!1,U=0,K=!1,r=0;const z=[],v0=J!==-1&&X!==-1;for(let t=0;t<k;t++){F.loadCell(t,this._workCell);let S0=this._workCell.getWidth();if(S0===0)continue;let e=!1,W0=t,a=this._workCell;if(q.length>0&&t===q[0][0]){e=!0;const i=q.shift();a=new w.JoinedCellData(this._workCell,F.translateToString(!0,i[0],i[1]),i[1]-i[0]),W0=i[1]-1,S0=a.getWidth()}const A0=this._isCellInSelection(t,O),Z0=L&&t===B,F0=v0&&t>=J&&t<=X;let g0=!1;this._decorationService.forEachDecorationAtCell(t,O,void 0,(i)=>{g0=!0});let s=a.getChars()||h.WHITESPACE_CELL_CHAR;if(s===" "&&(a.isUnderline()||a.isOverline())&&(s="\xA0"),r=S0*G-T.get(s,a.isBold(),a.isItalic()),Q){if(N&&(A0&&K||!A0&&!K&&a.bg===u)&&(A0&&K&&V.selectionForeground||a.fg===c)&&a.extended.ext===M&&F0===_&&r===U&&!Z0&&!e&&!g0){y+=s,N++;continue}N&&(Q.textContent=y),Q=this._document.createElement("span"),N=0,y=""}else Q=this._document.createElement("span");if(u=a.bg,c=a.fg,M=a.extended.ext,_=F0,U=r,K=A0,e&&B>=t&&B<=W0&&(B=t),!this._coreService.isCursorHidden&&Z0){if(z.push("xterm-cursor"),this._coreBrowserService.isFocused)Y&&z.push("xterm-cursor-blink"),z.push(Z==="bar"?"xterm-cursor-bar":Z==="underline"?"xterm-cursor-underline":"xterm-cursor-block");else if(W)switch(W){case"outline":z.push("xterm-cursor-outline");break;case"block":z.push("xterm-cursor-block");break;case"bar":z.push("xterm-cursor-bar");break;case"underline":z.push("xterm-cursor-underline")}}if(a.isBold()&&z.push("xterm-bold"),a.isItalic()&&z.push("xterm-italic"),a.isDim()&&z.push("xterm-dim"),y=a.isInvisible()?h.WHITESPACE_CELL_CHAR:a.getChars()||h.WHITESPACE_CELL_CHAR,a.isUnderline()&&(z.push(`xterm-underline-${a.extended.underlineStyle}`),y===" "&&(y="\xA0"),!a.isUnderlineColorDefault()))if(a.isUnderlineColorRGB())Q.style.textDecorationColor=`rgb(${R.AttributeData.toColorRGB(a.getUnderlineColor()).join(",")})`;else{let i=a.getUnderlineColor();this._optionsService.rawOptions.drawBoldTextInBrightColors&&a.isBold()&&i<8&&(i+=8),Q.style.textDecorationColor=V.ansi[i].css}a.isOverline()&&(z.push("xterm-overline"),y===" "&&(y="\xA0")),a.isStrikethrough()&&z.push("xterm-strikethrough"),F0&&(Q.style.textDecoration="underline");let l=a.getFgColor(),d=a.getFgColorMode(),n=a.getBgColor(),b0=a.getBgColorMode();const E0=!!a.isInverse();if(E0){const i=l;l=n,n=i;const M0=d;d=b0,b0=M0}let H0,h0,C0,R0=!1;switch(this._decorationService.forEachDecorationAtCell(t,O,void 0,(i)=>{i.options.layer!=="top"&&R0||(i.backgroundColorRGB&&(b0=50331648,n=i.backgroundColorRGB.rgba>>8&16777215,H0=i.backgroundColorRGB),i.foregroundColorRGB&&(d=50331648,l=i.foregroundColorRGB.rgba>>8&16777215,h0=i.foregroundColorRGB),R0=i.options.layer==="top")}),!R0&&A0&&(H0=this._coreBrowserService.isFocused?V.selectionBackgroundOpaque:V.selectionInactiveBackgroundOpaque,n=H0.rgba>>8&16777215,b0=50331648,R0=!0,V.selectionForeground&&(d=50331648,l=V.selectionForeground.rgba>>8&16777215,h0=V.selectionForeground)),R0&&z.push("xterm-decoration-top"),b0){case 16777216:case 33554432:C0=V.ansi[n],z.push(`xterm-bg-${n}`);break;case 50331648:C0=S.rgba.toColor(n>>16,n>>8&255,255&n),this._addStyle(Q,`background-color:#${$((n>>>0).toString(16),"0",6)}`);break;default:E0?(C0=V.foreground,z.push(`xterm-bg-${E.INVERTED_DEFAULT_COLOR}`)):C0=V.background}switch(H0||a.isDim()&&(H0=S.color.multiplyOpacity(C0,0.5)),d){case 16777216:case 33554432:a.isBold()&&l<8&&this._optionsService.rawOptions.drawBoldTextInBrightColors&&(l+=8),this._applyMinimumContrast(Q,C0,V.ansi[l],a,H0,void 0)||z.push(`xterm-fg-${l}`);break;case 50331648:const i=S.rgba.toColor(l>>16&255,l>>8&255,255&l);this._applyMinimumContrast(Q,C0,i,a,H0,h0)||this._addStyle(Q,`color:#${$(l.toString(16),"0",6)}`);break;default:this._applyMinimumContrast(Q,C0,V.foreground,a,H0,void 0)||E0&&z.push(`xterm-fg-${E.INVERTED_DEFAULT_COLOR}`)}z.length&&(Q.className=z.join(" "),z.length=0),Z0||e||g0?Q.textContent=y:N++,r!==this.defaultSpacing&&(Q.style.letterSpacing=`${r}px`),m.push(Q),t=W0}return Q&&N&&(Q.textContent=y),m}_applyMinimumContrast(F,O,L,Z,W,B){if(this._optionsService.rawOptions.minimumContrastRatio===1||C.excludeFromContrastRatioDemands(Z.getCode()))return!1;const Y=this._getContrastCache(Z);let G;if(W||B||(G=Y.getColor(O.rgba,L.rgba)),G===void 0){const T=this._optionsService.rawOptions.minimumContrastRatio/(Z.isDim()?2:1);G=S.color.ensureContrastRatio(W||O,B||L,T),Y.setColor((W||O).rgba,(B||L).rgba,G!=null?G:null)}return!!G&&(this._addStyle(F,`color:${G.css}`),!0)}_getContrastCache(F){return F.isDim()?this._themeService.colors.halfContrastCache:this._themeService.colors.contrastCache}_addStyle(F,O){F.setAttribute("style",`${F.getAttribute("style")||""}${O};`)}_isCellInSelection(F,O){const L=this._selectionStart,Z=this._selectionEnd;return!(!L||!Z)&&(this._columnSelectMode?L[0]<=Z[0]?F>=L[0]&&O>=L[1]&&F<Z[0]&&O<=Z[1]:F<L[0]&&O>=L[1]&&F>=Z[0]&&O<=Z[1]:O>L[1]&&O<Z[1]||L[1]===Z[1]&&O===L[1]&&F>=L[0]&&F<Z[0]||L[1]<Z[1]&&O===Z[1]&&F<Z[0]||L[1]<Z[1]&&O===L[1]&&F>=L[0])}};function $(F,O,L){for(;F.length<L;)F=O+F;return F}v.DomRendererRowFactory=p=A([H(1,g.ICharacterJoinerService),H(2,f.IOptionsService),H(3,g.ICoreBrowserService),H(4,f.ICoreService),H(5,f.IDecorationService),H(6,g.IThemeService)],p)},2550:(P,v)=>{Object.defineProperty(v,"__esModule",{value:!0}),v.WidthCache=void 0,v.WidthCache=class{constructor(b){this._flat=new Float32Array(256),this._font="",this._fontSize=0,this._weight="normal",this._weightBold="bold",this._measureElements=[],this._container=b.createElement("div"),this._container.style.position="absolute",this._container.style.top="-50000px",this._container.style.width="50000px",this._container.style.whiteSpace="pre",this._container.style.fontKerning="none";const A=b.createElement("span"),H=b.createElement("span");H.style.fontWeight="bold";const E=b.createElement("span");E.style.fontStyle="italic";const h=b.createElement("span");h.style.fontWeight="bold",h.style.fontStyle="italic",this._measureElements=[A,H,E,h],this._container.appendChild(A),this._container.appendChild(H),this._container.appendChild(E),this._container.appendChild(h),b.body.appendChild(this._container),this.clear()}dispose(){this._container.remove(),this._measureElements.length=0,this._holey=void 0}clear(){this._flat.fill(-9999),this._holey=new Map}setFont(b,A,H,E){b===this._font&&A===this._fontSize&&H===this._weight&&E===this._weightBold||(this._font=b,this._fontSize=A,this._weight=H,this._weightBold=E,this._container.style.fontFamily=this._font,this._container.style.fontSize=`${this._fontSize}px`,this._measureElements[0].style.fontWeight=`${H}`,this._measureElements[1].style.fontWeight=`${E}`,this._measureElements[2].style.fontWeight=`${H}`,this._measureElements[3].style.fontWeight=`${E}`,this.clear())}get(b,A,H){let E=0;if(!A&&!H&&b.length===1&&(E=b.charCodeAt(0))<256)return this._flat[E]!==-9999?this._flat[E]:this._flat[E]=this._measure(b,0);let h=b;A&&(h+="B"),H&&(h+="I");let D=this._holey.get(h);if(D===void 0){let f=0;A&&(f|=1),H&&(f|=2),D=this._measure(b,f),this._holey.set(h,D)}return D}_measure(b,A){const H=this._measureElements[A];return H.textContent=b.repeat(32),H.offsetWidth/32}}},2223:(P,v,b)=>{Object.defineProperty(v,"__esModule",{value:!0}),v.TEXT_BASELINE=v.DIM_OPACITY=v.INVERTED_DEFAULT_COLOR=void 0;const A=b(6114);v.INVERTED_DEFAULT_COLOR=257,v.DIM_OPACITY=0.5,v.TEXT_BASELINE=A.isFirefox||A.isLegacyEdge?"bottom":"ideographic"},6171:(P,v)=>{function b(A){return 57508<=A&&A<=57558}Object.defineProperty(v,"__esModule",{value:!0}),v.createRenderDimensions=v.excludeFromContrastRatioDemands=v.isRestrictedPowerlineGlyph=v.isPowerlineGlyph=v.throwIfFalsy=void 0,v.throwIfFalsy=function(A){if(!A)throw new Error("value must not be falsy");return A},v.isPowerlineGlyph=b,v.isRestrictedPowerlineGlyph=function(A){return 57520<=A&&A<=57527},v.excludeFromContrastRatioDemands=function(A){return b(A)||function(H){return 9472<=H&&H<=9631}(A)},v.createRenderDimensions=function(){return{css:{canvas:{width:0,height:0},cell:{width:0,height:0}},device:{canvas:{width:0,height:0},cell:{width:0,height:0},char:{width:0,height:0,left:0,top:0}}}}},456:(P,v)=>{Object.defineProperty(v,"__esModule",{value:!0}),v.SelectionModel=void 0,v.SelectionModel=class{constructor(b){this._bufferService=b,this.isSelectAllActive=!1,this.selectionStartLength=0}clearSelection(){this.selectionStart=void 0,this.selectionEnd=void 0,this.isSelectAllActive=!1,this.selectionStartLength=0}get finalSelectionStart(){return this.isSelectAllActive?[0,0]:this.selectionEnd&&this.selectionStart&&this.areSelectionValuesReversed()?this.selectionEnd:this.selectionStart}get finalSelectionEnd(){if(this.isSelectAllActive)return[this._bufferService.cols,this._bufferService.buffer.ybase+this._bufferService.rows-1];if(this.selectionStart){if(!this.selectionEnd||this.areSelectionValuesReversed()){const b=this.selectionStart[0]+this.selectionStartLength;return b>this._bufferService.cols?b%this._bufferService.cols==0?[this._bufferService.cols,this.selectionStart[1]+Math.floor(b/this._bufferService.cols)-1]:[b%this._bufferService.cols,this.selectionStart[1]+Math.floor(b/this._bufferService.cols)]:[b,this.selectionStart[1]]}if(this.selectionStartLength&&this.selectionEnd[1]===this.selectionStart[1]){const b=this.selectionStart[0]+this.selectionStartLength;return b>this._bufferService.cols?[b%this._bufferService.cols,this.selectionStart[1]+Math.floor(b/this._bufferService.cols)]:[Math.max(b,this.selectionEnd[0]),this.selectionEnd[1]]}return this.selectionEnd}}areSelectionValuesReversed(){const b=this.selectionStart,A=this.selectionEnd;return!(!b||!A)&&(b[1]>A[1]||b[1]===A[1]&&b[0]>A[0])}handleTrim(b){return this.selectionStart&&(this.selectionStart[1]-=b),this.selectionEnd&&(this.selectionEnd[1]-=b),this.selectionEnd&&this.selectionEnd[1]<0?(this.clearSelection(),!0):(this.selectionStart&&this.selectionStart[1]<0&&(this.selectionStart[1]=0),!1)}}},428:function(P,v,b){var A=this&&this.__decorate||function(g,w,C,R){var p,$=arguments.length,F=$<3?w:R===null?R=Object.getOwnPropertyDescriptor(w,C):R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")F=Reflect.decorate(g,w,C,R);else for(var O=g.length-1;O>=0;O--)(p=g[O])&&(F=($<3?p(F):$>3?p(w,C,F):p(w,C))||F);return $>3&&F&&Object.defineProperty(w,C,F),F},H=this&&this.__param||function(g,w){return function(C,R){w(C,R,g)}};Object.defineProperty(v,"__esModule",{value:!0}),v.CharSizeService=void 0;const E=b(2585),h=b(8460),D=b(844);let f=v.CharSizeService=class extends D.Disposable{get hasValidSize(){return this.width>0&&this.height>0}constructor(g,w,C){super(),this._optionsService=C,this.width=0,this.height=0,this._onCharSizeChange=this.register(new h.EventEmitter),this.onCharSizeChange=this._onCharSizeChange.event,this._measureStrategy=new S(g,w,this._optionsService),this.register(this._optionsService.onMultipleOptionChange(["fontFamily","fontSize"],()=>this.measure()))}measure(){const g=this._measureStrategy.measure();g.width===this.width&&g.height===this.height||(this.width=g.width,this.height=g.height,this._onCharSizeChange.fire())}};v.CharSizeService=f=A([H(2,E.IOptionsService)],f);class S{constructor(g,w,C){this._document=g,this._parentElement=w,this._optionsService=C,this._result={width:0,height:0},this._measureElement=this._document.createElement("span"),this._measureElement.classList.add("xterm-char-measure-element"),this._measureElement.textContent="W".repeat(32),this._measureElement.setAttribute("aria-hidden","true"),this._measureElement.style.whiteSpace="pre",this._measureElement.style.fontKerning="none",this._parentElement.appendChild(this._measureElement)}measure(){this._measureElement.style.fontFamily=this._optionsService.rawOptions.fontFamily,this._measureElement.style.fontSize=`${this._optionsService.rawOptions.fontSize}px`;const g={height:Number(this._measureElement.offsetHeight),width:Number(this._measureElement.offsetWidth)};return g.width!==0&&g.height!==0&&(this._result.width=g.width/32,this._result.height=Math.ceil(g.height)),this._result}}},4269:function(P,v,b){var A=this&&this.__decorate||function(w,C,R,p){var $,F=arguments.length,O=F<3?C:p===null?p=Object.getOwnPropertyDescriptor(C,R):p;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")O=Reflect.decorate(w,C,R,p);else for(var L=w.length-1;L>=0;L--)($=w[L])&&(O=(F<3?$(O):F>3?$(C,R,O):$(C,R))||O);return F>3&&O&&Object.defineProperty(C,R,O),O},H=this&&this.__param||function(w,C){return function(R,p){C(R,p,w)}};Object.defineProperty(v,"__esModule",{value:!0}),v.CharacterJoinerService=v.JoinedCellData=void 0;const E=b(3734),h=b(643),D=b(511),f=b(2585);class S extends E.AttributeData{constructor(w,C,R){super(),this.content=0,this.combinedData="",this.fg=w.fg,this.bg=w.bg,this.combinedData=C,this._width=R}isCombined(){return 2097152}getWidth(){return this._width}getChars(){return this.combinedData}getCode(){return 2097151}setFromCharData(w){throw new Error("not implemented")}getAsCharData(){return[this.fg,this.getChars(),this.getWidth(),this.getCode()]}}v.JoinedCellData=S;let g=v.CharacterJoinerService=class w{constructor(C){this._bufferService=C,this._characterJoiners=[],this._nextCharacterJoinerId=0,this._workCell=new D.CellData}register(C){const R={id:this._nextCharacterJoinerId++,handler:C};return this._characterJoiners.push(R),R.id}deregister(C){for(let R=0;R<this._characterJoiners.length;R++)if(this._characterJoiners[R].id===C)return this._characterJoiners.splice(R,1),!0;return!1}getJoinedCharacters(C){if(this._characterJoiners.length===0)return[];const R=this._bufferService.buffer.lines.get(C);if(!R||R.length===0)return[];const p=[],$=R.translateToString(!0);let F=0,O=0,L=0,Z=R.getFg(0),W=R.getBg(0);for(let B=0;B<R.getTrimmedLength();B++)if(R.loadCell(B,this._workCell),this._workCell.getWidth()!==0){if(this._workCell.fg!==Z||this._workCell.bg!==W){if(B-F>1){const Y=this._getJoinedRanges($,L,O,R,F);for(let G=0;G<Y.length;G++)p.push(Y[G])}F=B,L=O,Z=this._workCell.fg,W=this._workCell.bg}O+=this._workCell.getChars().length||h.WHITESPACE_CELL_CHAR.length}if(this._bufferService.cols-F>1){const B=this._getJoinedRanges($,L,O,R,F);for(let Y=0;Y<B.length;Y++)p.push(B[Y])}return p}_getJoinedRanges(C,R,p,$,F){const O=C.substring(R,p);let L=[];try{L=this._characterJoiners[0].handler(O)}catch(Z){console.error(Z)}for(let Z=1;Z<this._characterJoiners.length;Z++)try{const W=this._characterJoiners[Z].handler(O);for(let B=0;B<W.length;B++)w._mergeRanges(L,W[B])}catch(W){console.error(W)}return this._stringRangesToCellRanges(L,$,F),L}_stringRangesToCellRanges(C,R,p){let $=0,F=!1,O=0,L=C[$];if(L){for(let Z=p;Z<this._bufferService.cols;Z++){const W=R.getWidth(Z),B=R.getString(Z).length||h.WHITESPACE_CELL_CHAR.length;if(W!==0){if(!F&&L[0]<=O&&(L[0]=Z,F=!0),L[1]<=O){if(L[1]=Z,L=C[++$],!L)break;L[0]<=O?(L[0]=Z,F=!0):F=!1}O+=B}}L&&(L[1]=this._bufferService.cols)}}static _mergeRanges(C,R){let p=!1;for(let $=0;$<C.length;$++){const F=C[$];if(p){if(R[1]<=F[0])return C[$-1][1]=R[1],C;if(R[1]<=F[1])return C[$-1][1]=Math.max(R[1],F[1]),C.splice($,1),C;C.splice($,1),$--}else{if(R[1]<=F[0])return C.splice($,0,R),C;if(R[1]<=F[1])return F[0]=Math.min(R[0],F[0]),C;R[0]<F[1]&&(F[0]=Math.min(R[0],F[0]),p=!0)}}return p?C[C.length-1][1]=R[1]:C.push(R),C}};v.CharacterJoinerService=g=A([H(0,f.IBufferService)],g)},5114:(P,v)=>{Object.defineProperty(v,"__esModule",{value:!0}),v.CoreBrowserService=void 0,v.CoreBrowserService=class{constructor(b,A){this._textarea=b,this.window=A,this._isFocused=!1,this._cachedIsFocused=void 0,this._textarea.addEventListener("focus",()=>this._isFocused=!0),this._textarea.addEventListener("blur",()=>this._isFocused=!1)}get dpr(){return this.window.devicePixelRatio}get isFocused(){return this._cachedIsFocused===void 0&&(this._cachedIsFocused=this._isFocused&&this._textarea.ownerDocument.hasFocus(),queueMicrotask(()=>this._cachedIsFocused=void 0)),this._cachedIsFocused}}},8934:function(P,v,b){var A=this&&this.__decorate||function(f,S,g,w){var C,R=arguments.length,p=R<3?S:w===null?w=Object.getOwnPropertyDescriptor(S,g):w;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")p=Reflect.decorate(f,S,g,w);else for(var $=f.length-1;$>=0;$--)(C=f[$])&&(p=(R<3?C(p):R>3?C(S,g,p):C(S,g))||p);return R>3&&p&&Object.defineProperty(S,g,p),p},H=this&&this.__param||function(f,S){return function(g,w){S(g,w,f)}};Object.defineProperty(v,"__esModule",{value:!0}),v.MouseService=void 0;const E=b(4725),h=b(9806);let D=v.MouseService=class{constructor(f,S){this._renderService=f,this._charSizeService=S}getCoords(f,S,g,w,C){return h.getCoords(window,f,S,g,w,this._charSizeService.hasValidSize,this._renderService.dimensions.css.cell.width,this._renderService.dimensions.css.cell.height,C)}getMouseReportCoords(f,S){const g=h.getCoordsRelativeToElement(window,f,S);if(this._charSizeService.hasValidSize)return g[0]=Math.min(Math.max(g[0],0),this._renderService.dimensions.css.canvas.width-1),g[1]=Math.min(Math.max(g[1],0),this._renderService.dimensions.css.canvas.height-1),{col:Math.floor(g[0]/this._renderService.dimensions.css.cell.width),row:Math.floor(g[1]/this._renderService.dimensions.css.cell.height),x:Math.floor(g[0]),y:Math.floor(g[1])}}};v.MouseService=D=A([H(0,E.IRenderService),H(1,E.ICharSizeService)],D)},3230:function(P,v,b){var A=this&&this.__decorate||function(p,$,F,O){var L,Z=arguments.length,W=Z<3?$:O===null?O=Object.getOwnPropertyDescriptor($,F):O;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")W=Reflect.decorate(p,$,F,O);else for(var B=p.length-1;B>=0;B--)(L=p[B])&&(W=(Z<3?L(W):Z>3?L($,F,W):L($,F))||W);return Z>3&&W&&Object.defineProperty($,F,W),W},H=this&&this.__param||function(p,$){return function(F,O){$(F,O,p)}};Object.defineProperty(v,"__esModule",{value:!0}),v.RenderService=void 0;const E=b(3656),h=b(6193),D=b(5596),f=b(4725),S=b(8460),g=b(844),w=b(7226),C=b(2585);let R=v.RenderService=class extends g.Disposable{get dimensions(){return this._renderer.value.dimensions}constructor(p,$,F,O,L,Z,W,B){if(super(),this._rowCount=p,this._charSizeService=O,this._renderer=this.register(new g.MutableDisposable),this._pausedResizeTask=new w.DebouncedIdleTask,this._isPaused=!1,this._needsFullRefresh=!1,this._isNextRenderRedrawOnly=!0,this._needsSelectionRefresh=!1,this._canvasWidth=0,this._canvasHeight=0,this._selectionState={start:void 0,end:void 0,columnSelectMode:!1},this._onDimensionsChange=this.register(new S.EventEmitter),this.onDimensionsChange=this._onDimensionsChange.event,this._onRenderedViewportChange=this.register(new S.EventEmitter),this.onRenderedViewportChange=this._onRenderedViewportChange.event,this._onRender=this.register(new S.EventEmitter),this.onRender=this._onRender.event,this._onRefreshRequest=this.register(new S.EventEmitter),this.onRefreshRequest=this._onRefreshRequest.event,this._renderDebouncer=new h.RenderDebouncer(W.window,(Y,G)=>this._renderRows(Y,G)),this.register(this._renderDebouncer),this._screenDprMonitor=new D.ScreenDprMonitor(W.window),this._screenDprMonitor.setListener(()=>this.handleDevicePixelRatioChange()),this.register(this._screenDprMonitor),this.register(Z.onResize(()=>this._fullRefresh())),this.register(Z.buffers.onBufferActivate(()=>{var Y;return(Y=this._renderer.value)===null||Y===void 0?void 0:Y.clear()})),this.register(F.onOptionChange(()=>this._handleOptionsChanged())),this.register(this._charSizeService.onCharSizeChange(()=>this.handleCharSizeChanged())),this.register(L.onDecorationRegistered(()=>this._fullRefresh())),this.register(L.onDecorationRemoved(()=>this._fullRefresh())),this.register(F.onMultipleOptionChange(["customGlyphs","drawBoldTextInBrightColors","letterSpacing","lineHeight","fontFamily","fontSize","fontWeight","fontWeightBold","minimumContrastRatio"],()=>{this.clear(),this.handleResize(Z.cols,Z.rows),this._fullRefresh()})),this.register(F.onMultipleOptionChange(["cursorBlink","cursorStyle"],()=>this.refreshRows(Z.buffer.y,Z.buffer.y,!0))),this.register(E.addDisposableDomListener(W.window,"resize",()=>this.handleDevicePixelRatioChange())),this.register(B.onChangeColors(()=>this._fullRefresh())),"IntersectionObserver"in W.window){const Y=new W.window.IntersectionObserver((G)=>this._handleIntersectionChange(G[G.length-1]),{threshold:0});Y.observe($),this.register({dispose:()=>Y.disconnect()})}}_handleIntersectionChange(p){this._isPaused=p.isIntersecting===void 0?p.intersectionRatio===0:!p.isIntersecting,this._isPaused||this._charSizeService.hasValidSize||this._charSizeService.measure(),!this._isPaused&&this._needsFullRefresh&&(this._pausedResizeTask.flush(),this.refreshRows(0,this._rowCount-1),this._needsFullRefresh=!1)}refreshRows(p,$,F=!1){this._isPaused?this._needsFullRefresh=!0:(F||(this._isNextRenderRedrawOnly=!1),this._renderDebouncer.refresh(p,$,this._rowCount))}_renderRows(p,$){this._renderer.value&&(p=Math.min(p,this._rowCount-1),$=Math.min($,this._rowCount-1),this._renderer.value.renderRows(p,$),this._needsSelectionRefresh&&(this._renderer.value.handleSelectionChanged(this._selectionState.start,this._selectionState.end,this._selectionState.columnSelectMode),this._needsSelectionRefresh=!1),this._isNextRenderRedrawOnly||this._onRenderedViewportChange.fire({start:p,end:$}),this._onRender.fire({start:p,end:$}),this._isNextRenderRedrawOnly=!0)}resize(p,$){this._rowCount=$,this._fireOnCanvasResize()}_handleOptionsChanged(){this._renderer.value&&(this.refreshRows(0,this._rowCount-1),this._fireOnCanvasResize())}_fireOnCanvasResize(){this._renderer.value&&(this._renderer.value.dimensions.css.canvas.width===this._canvasWidth&&this._renderer.value.dimensions.css.canvas.height===this._canvasHeight||this._onDimensionsChange.fire(this._renderer.value.dimensions))}hasRenderer(){return!!this._renderer.value}setRenderer(p){this._renderer.value=p,this._renderer.value.onRequestRedraw(($)=>this.refreshRows($.start,$.end,!0)),this._needsSelectionRefresh=!0,this._fullRefresh()}addRefreshCallback(p){return this._renderDebouncer.addRefreshCallback(p)}_fullRefresh(){this._isPaused?this._needsFullRefresh=!0:this.refreshRows(0,this._rowCount-1)}clearTextureAtlas(){var p,$;this._renderer.value&&(($=(p=this._renderer.value).clearTextureAtlas)===null||$===void 0||$.call(p),this._fullRefresh())}handleDevicePixelRatioChange(){this._charSizeService.measure(),this._renderer.value&&(this._renderer.value.handleDevicePixelRatioChange(),this.refreshRows(0,this._rowCount-1))}handleResize(p,$){this._renderer.value&&(this._isPaused?this._pausedResizeTask.set(()=>this._renderer.value.handleResize(p,$)):this._renderer.value.handleResize(p,$),this._fullRefresh())}handleCharSizeChanged(){var p;(p=this._renderer.value)===null||p===void 0||p.handleCharSizeChanged()}handleBlur(){var p;(p=this._renderer.value)===null||p===void 0||p.handleBlur()}handleFocus(){var p;(p=this._renderer.value)===null||p===void 0||p.handleFocus()}handleSelectionChanged(p,$,F){var O;this._selectionState.start=p,this._selectionState.end=$,this._selectionState.columnSelectMode=F,(O=this._renderer.value)===null||O===void 0||O.handleSelectionChanged(p,$,F)}handleCursorMove(){var p;(p=this._renderer.value)===null||p===void 0||p.handleCursorMove()}clear(){var p;(p=this._renderer.value)===null||p===void 0||p.clear()}};v.RenderService=R=A([H(2,C.IOptionsService),H(3,f.ICharSizeService),H(4,C.IDecorationService),H(5,C.IBufferService),H(6,f.ICoreBrowserService),H(7,f.IThemeService)],R)},9312:function(P,v,b){var A=this&&this.__decorate||function(L,Z,W,B){var Y,G=arguments.length,T=G<3?Z:B===null?B=Object.getOwnPropertyDescriptor(Z,W):B;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")T=Reflect.decorate(L,Z,W,B);else for(var J=L.length-1;J>=0;J--)(Y=L[J])&&(T=(G<3?Y(T):G>3?Y(Z,W,T):Y(Z,W))||T);return G>3&&T&&Object.defineProperty(Z,W,T),T},H=this&&this.__param||function(L,Z){return function(W,B){Z(W,B,L)}};Object.defineProperty(v,"__esModule",{value:!0}),v.SelectionService=void 0;const E=b(9806),h=b(9504),D=b(456),f=b(4725),S=b(8460),g=b(844),w=b(6114),C=b(4841),R=b(511),p=b(2585),$=String.fromCharCode(160),F=new RegExp($,"g");let O=v.SelectionService=class extends g.Disposable{constructor(L,Z,W,B,Y,G,T,J,X){super(),this._element=L,this._screenElement=Z,this._linkifier=W,this._bufferService=B,this._coreService=Y,this._mouseService=G,this._optionsService=T,this._renderService=J,this._coreBrowserService=X,this._dragScrollAmount=0,this._enabled=!0,this._workCell=new R.CellData,this._mouseDownTimeStamp=0,this._oldHasSelection=!1,this._oldSelectionStart=void 0,this._oldSelectionEnd=void 0,this._onLinuxMouseSelection=this.register(new S.EventEmitter),this.onLinuxMouseSelection=this._onLinuxMouseSelection.event,this._onRedrawRequest=this.register(new S.EventEmitter),this.onRequestRedraw=this._onRedrawRequest.event,this._onSelectionChange=this.register(new S.EventEmitter),this.onSelectionChange=this._onSelectionChange.event,this._onRequestScrollLines=this.register(new S.EventEmitter),this.onRequestScrollLines=this._onRequestScrollLines.event,this._mouseMoveListener=(m)=>this._handleMouseMove(m),this._mouseUpListener=(m)=>this._handleMouseUp(m),this._coreService.onUserInput(()=>{this.hasSelection&&this.clearSelection()}),this._trimListener=this._bufferService.buffer.lines.onTrim((m)=>this._handleTrim(m)),this.register(this._bufferService.buffers.onBufferActivate((m)=>this._handleBufferActivate(m))),this.enable(),this._model=new D.SelectionModel(this._bufferService),this._activeSelectionMode=0,this.register(g.toDisposable(()=>{this._removeMouseDownListeners()}))}reset(){this.clearSelection()}disable(){this.clearSelection(),this._enabled=!1}enable(){this._enabled=!0}get selectionStart(){return this._model.finalSelectionStart}get selectionEnd(){return this._model.finalSelectionEnd}get hasSelection(){const L=this._model.finalSelectionStart,Z=this._model.finalSelectionEnd;return!(!L||!Z||L[0]===Z[0]&&L[1]===Z[1])}get selectionText(){const L=this._model.finalSelectionStart,Z=this._model.finalSelectionEnd;if(!L||!Z)return"";const W=this._bufferService.buffer,B=[];if(this._activeSelectionMode===3){if(L[0]===Z[0])return"";const Y=L[0]<Z[0]?L[0]:Z[0],G=L[0]<Z[0]?Z[0]:L[0];for(let T=L[1];T<=Z[1];T++){const J=W.translateBufferLineToString(T,!0,Y,G);B.push(J)}}else{const Y=L[1]===Z[1]?Z[0]:void 0;B.push(W.translateBufferLineToString(L[1],!0,L[0],Y));for(let G=L[1]+1;G<=Z[1]-1;G++){const T=W.lines.get(G),J=W.translateBufferLineToString(G,!0);(T==null?void 0:T.isWrapped)?B[B.length-1]+=J:B.push(J)}if(L[1]!==Z[1]){const G=W.lines.get(Z[1]),T=W.translateBufferLineToString(Z[1],!0,0,Z[0]);G&&G.isWrapped?B[B.length-1]+=T:B.push(T)}}return B.map((Y)=>Y.replace(F," ")).join(w.isWindows?"\r\n":"\n")}clearSelection(){this._model.clearSelection(),this._removeMouseDownListeners(),this.refresh(),this._onSelectionChange.fire()}refresh(L){this._refreshAnimationFrame||(this._refreshAnimationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>this._refresh())),w.isLinux&&L&&this.selectionText.length&&this._onLinuxMouseSelection.fire(this.selectionText)}_refresh(){this._refreshAnimationFrame=void 0,this._onRedrawRequest.fire({start:this._model.finalSelectionStart,end:this._model.finalSelectionEnd,columnSelectMode:this._activeSelectionMode===3})}_isClickInSelection(L){const Z=this._getMouseBufferCoords(L),W=this._model.finalSelectionStart,B=this._model.finalSelectionEnd;return!!(W&&B&&Z)&&this._areCoordsInSelection(Z,W,B)}isCellInSelection(L,Z){const W=this._model.finalSelectionStart,B=this._model.finalSelectionEnd;return!(!W||!B)&&this._areCoordsInSelection([L,Z],W,B)}_areCoordsInSelection(L,Z,W){return L[1]>Z[1]&&L[1]<W[1]||Z[1]===W[1]&&L[1]===Z[1]&&L[0]>=Z[0]&&L[0]<W[0]||Z[1]<W[1]&&L[1]===W[1]&&L[0]<W[0]||Z[1]<W[1]&&L[1]===Z[1]&&L[0]>=Z[0]}_selectWordAtCursor(L,Z){var W,B;const Y=(B=(W=this._linkifier.currentLink)===null||W===void 0?void 0:W.link)===null||B===void 0?void 0:B.range;if(Y)return this._model.selectionStart=[Y.start.x-1,Y.start.y-1],this._model.selectionStartLength=C.getRangeLength(Y,this._bufferService.cols),this._model.selectionEnd=void 0,!0;const G=this._getMouseBufferCoords(L);return!!G&&(this._selectWordAt(G,Z),this._model.selectionEnd=void 0,!0)}selectAll(){this._model.isSelectAllActive=!0,this.refresh(),this._onSelectionChange.fire()}selectLines(L,Z){this._model.clearSelection(),L=Math.max(L,0),Z=Math.min(Z,this._bufferService.buffer.lines.length-1),this._model.selectionStart=[0,L],this._model.selectionEnd=[this._bufferService.cols,Z],this.refresh(),this._onSelectionChange.fire()}_handleTrim(L){this._model.handleTrim(L)&&this.refresh()}_getMouseBufferCoords(L){const Z=this._mouseService.getCoords(L,this._screenElement,this._bufferService.cols,this._bufferService.rows,!0);if(Z)return Z[0]--,Z[1]--,Z[1]+=this._bufferService.buffer.ydisp,Z}_getMouseEventScrollAmount(L){let Z=E.getCoordsRelativeToElement(this._coreBrowserService.window,L,this._screenElement)[1];const W=this._renderService.dimensions.css.canvas.height;return Z>=0&&Z<=W?0:(Z>W&&(Z-=W),Z=Math.min(Math.max(Z,-50),50),Z/=50,Z/Math.abs(Z)+Math.round(14*Z))}shouldForceSelection(L){return w.isMac?L.altKey&&this._optionsService.rawOptions.macOptionClickForcesSelection:L.shiftKey}handleMouseDown(L){if(this._mouseDownTimeStamp=L.timeStamp,(L.button!==2||!this.hasSelection)&&L.button===0){if(!this._enabled){if(!this.shouldForceSelection(L))return;L.stopPropagation()}L.preventDefault(),this._dragScrollAmount=0,this._enabled&&L.shiftKey?this._handleIncrementalClick(L):L.detail===1?this._handleSingleClick(L):L.detail===2?this._handleDoubleClick(L):L.detail===3&&this._handleTripleClick(L),this._addMouseDownListeners(),this.refresh(!0)}}_addMouseDownListeners(){this._screenElement.ownerDocument&&(this._screenElement.ownerDocument.addEventListener("mousemove",this._mouseMoveListener),this._screenElement.ownerDocument.addEventListener("mouseup",this._mouseUpListener)),this._dragScrollIntervalTimer=this._coreBrowserService.window.setInterval(()=>this._dragScroll(),50)}_removeMouseDownListeners(){this._screenElement.ownerDocument&&(this._screenElement.ownerDocument.removeEventListener("mousemove",this._mouseMoveListener),this._screenElement.ownerDocument.removeEventListener("mouseup",this._mouseUpListener)),this._coreBrowserService.window.clearInterval(this._dragScrollIntervalTimer),this._dragScrollIntervalTimer=void 0}_handleIncrementalClick(L){this._model.selectionStart&&(this._model.selectionEnd=this._getMouseBufferCoords(L))}_handleSingleClick(L){if(this._model.selectionStartLength=0,this._model.isSelectAllActive=!1,this._activeSelectionMode=this.shouldColumnSelect(L)?3:0,this._model.selectionStart=this._getMouseBufferCoords(L),!this._model.selectionStart)return;this._model.selectionEnd=void 0;const Z=this._bufferService.buffer.lines.get(this._model.selectionStart[1]);Z&&Z.length!==this._model.selectionStart[0]&&Z.hasWidth(this._model.selectionStart[0])===0&&this._model.selectionStart[0]++}_handleDoubleClick(L){this._selectWordAtCursor(L,!0)&&(this._activeSelectionMode=1)}_handleTripleClick(L){const Z=this._getMouseBufferCoords(L);Z&&(this._activeSelectionMode=2,this._selectLineAt(Z[1]))}shouldColumnSelect(L){return L.altKey&&!(w.isMac&&this._optionsService.rawOptions.macOptionClickForcesSelection)}_handleMouseMove(L){if(L.stopImmediatePropagation(),!this._model.selectionStart)return;const Z=this._model.selectionEnd?[this._model.selectionEnd[0],this._model.selectionEnd[1]]:null;if(this._model.selectionEnd=this._getMouseBufferCoords(L),!this._model.selectionEnd)return void this.refresh(!0);this._activeSelectionMode===2?this._model.selectionEnd[1]<this._model.selectionStart[1]?this._model.selectionEnd[0]=0:this._model.selectionEnd[0]=this._bufferService.cols:this._activeSelectionMode===1&&this._selectToWordAt(this._model.selectionEnd),this._dragScrollAmount=this._getMouseEventScrollAmount(L),this._activeSelectionMode!==3&&(this._dragScrollAmount>0?this._model.selectionEnd[0]=this._bufferService.cols:this._dragScrollAmount<0&&(this._model.selectionEnd[0]=0));const W=this._bufferService.buffer;if(this._model.selectionEnd[1]<W.lines.length){const B=W.lines.get(this._model.selectionEnd[1]);B&&B.hasWidth(this._model.selectionEnd[0])===0&&this._model.selectionEnd[0]++}Z&&Z[0]===this._model.selectionEnd[0]&&Z[1]===this._model.selectionEnd[1]||this.refresh(!0)}_dragScroll(){if(this._model.selectionEnd&&this._model.selectionStart&&this._dragScrollAmount){this._onRequestScrollLines.fire({amount:this._dragScrollAmount,suppressScrollEvent:!1});const L=this._bufferService.buffer;this._dragScrollAmount>0?(this._activeSelectionMode!==3&&(this._model.selectionEnd[0]=this._bufferService.cols),this._model.selectionEnd[1]=Math.min(L.ydisp+this._bufferService.rows,L.lines.length-1)):(this._activeSelectionMode!==3&&(this._model.selectionEnd[0]=0),this._model.selectionEnd[1]=L.ydisp),this.refresh()}}_handleMouseUp(L){const Z=L.timeStamp-this._mouseDownTimeStamp;if(this._removeMouseDownListeners(),this.selectionText.length<=1&&Z<500&&L.altKey&&this._optionsService.rawOptions.altClickMovesCursor){if(this._bufferService.buffer.ybase===this._bufferService.buffer.ydisp){const W=this._mouseService.getCoords(L,this._element,this._bufferService.cols,this._bufferService.rows,!1);if(W&&W[0]!==void 0&&W[1]!==void 0){const B=h.moveToCellSequence(W[0]-1,W[1]-1,this._bufferService,this._coreService.decPrivateModes.applicationCursorKeys);this._coreService.triggerDataEvent(B,!0)}}}else this._fireEventIfSelectionChanged()}_fireEventIfSelectionChanged(){const L=this._model.finalSelectionStart,Z=this._model.finalSelectionEnd,W=!(!L||!Z||L[0]===Z[0]&&L[1]===Z[1]);W?L&&Z&&(this._oldSelectionStart&&this._oldSelectionEnd&&L[0]===this._oldSelectionStart[0]&&L[1]===this._oldSelectionStart[1]&&Z[0]===this._oldSelectionEnd[0]&&Z[1]===this._oldSelectionEnd[1]||this._fireOnSelectionChange(L,Z,W)):this._oldHasSelection&&this._fireOnSelectionChange(L,Z,W)}_fireOnSelectionChange(L,Z,W){this._oldSelectionStart=L,this._oldSelectionEnd=Z,this._oldHasSelection=W,this._onSelectionChange.fire()}_handleBufferActivate(L){this.clearSelection(),this._trimListener.dispose(),this._trimListener=L.activeBuffer.lines.onTrim((Z)=>this._handleTrim(Z))}_convertViewportColToCharacterIndex(L,Z){let W=Z;for(let B=0;Z>=B;B++){const Y=L.loadCell(B,this._workCell).getChars().length;this._workCell.getWidth()===0?W--:Y>1&&Z!==B&&(W+=Y-1)}return W}setSelection(L,Z,W){this._model.clearSelection(),this._removeMouseDownListeners(),this._model.selectionStart=[L,Z],this._model.selectionStartLength=W,this.refresh(),this._fireEventIfSelectionChanged()}rightClickSelect(L){this._isClickInSelection(L)||(this._selectWordAtCursor(L,!1)&&this.refresh(!0),this._fireEventIfSelectionChanged())}_getWordAt(L,Z,W=!0,B=!0){if(L[0]>=this._bufferService.cols)return;const Y=this._bufferService.buffer,G=Y.lines.get(L[1]);if(!G)return;const T=Y.translateBufferLineToString(L[1],!1);let J=this._convertViewportColToCharacterIndex(G,L[0]),X=J;const m=L[0]-J;let q=0,V=0,Q=0,k=0;if(T.charAt(J)===" "){for(;J>0&&T.charAt(J-1)===" ";)J--;for(;X<T.length&&T.charAt(X+1)===" ";)X++}else{let u=L[0],c=L[0];G.getWidth(u)===0&&(q++,u--),G.getWidth(c)===2&&(V++,c++);const M=G.getString(c).length;for(M>1&&(k+=M-1,X+=M-1);u>0&&J>0&&!this._isCharWordSeparator(G.loadCell(u-1,this._workCell));){G.loadCell(u-1,this._workCell);const _=this._workCell.getChars().length;this._workCell.getWidth()===0?(q++,u--):_>1&&(Q+=_-1,J-=_-1),J--,u--}for(;c<G.length&&X+1<T.length&&!this._isCharWordSeparator(G.loadCell(c+1,this._workCell));){G.loadCell(c+1,this._workCell);const _=this._workCell.getChars().length;this._workCell.getWidth()===2?(V++,c++):_>1&&(k+=_-1,X+=_-1),X++,c++}}X++;let N=J+m-q+Q,y=Math.min(this._bufferService.cols,X-J+q+V-Q-k);if(Z||T.slice(J,X).trim()!==""){if(W&&N===0&&G.getCodePoint(0)!==32){const u=Y.lines.get(L[1]-1);if(u&&G.isWrapped&&u.getCodePoint(this._bufferService.cols-1)!==32){const c=this._getWordAt([this._bufferService.cols-1,L[1]-1],!1,!0,!1);if(c){const M=this._bufferService.cols-c.start;N-=M,y+=M}}}if(B&&N+y===this._bufferService.cols&&G.getCodePoint(this._bufferService.cols-1)!==32){const u=Y.lines.get(L[1]+1);if((u==null?void 0:u.isWrapped)&&u.getCodePoint(0)!==32){const c=this._getWordAt([0,L[1]+1],!1,!1,!0);c&&(y+=c.length)}}return{start:N,length:y}}}_selectWordAt(L,Z){const W=this._getWordAt(L,Z);if(W){for(;W.start<0;)W.start+=this._bufferService.cols,L[1]--;this._model.selectionStart=[W.start,L[1]],this._model.selectionStartLength=W.length}}_selectToWordAt(L){const Z=this._getWordAt(L,!0);if(Z){let W=L[1];for(;Z.start<0;)Z.start+=this._bufferService.cols,W--;if(!this._model.areSelectionValuesReversed())for(;Z.start+Z.length>this._bufferService.cols;)Z.length-=this._bufferService.cols,W++;this._model.selectionEnd=[this._model.areSelectionValuesReversed()?Z.start:Z.start+Z.length,W]}}_isCharWordSeparator(L){return L.getWidth()!==0&&this._optionsService.rawOptions.wordSeparator.indexOf(L.getChars())>=0}_selectLineAt(L){const Z=this._bufferService.buffer.getWrappedRangeForLine(L),W={start:{x:0,y:Z.first},end:{x:this._bufferService.cols-1,y:Z.last}};this._model.selectionStart=[0,Z.first],this._model.selectionEnd=void 0,this._model.selectionStartLength=C.getRangeLength(W,this._bufferService.cols)}};v.SelectionService=O=A([H(3,p.IBufferService),H(4,p.ICoreService),H(5,f.IMouseService),H(6,p.IOptionsService),H(7,f.IRenderService),H(8,f.ICoreBrowserService)],O)},4725:(P,v,b)=>{Object.defineProperty(v,"__esModule",{value:!0}),v.IThemeService=v.ICharacterJoinerService=v.ISelectionService=v.IRenderService=v.IMouseService=v.ICoreBrowserService=v.ICharSizeService=void 0;const A=b(8343);v.ICharSizeService=A.createDecorator("CharSizeService"),v.ICoreBrowserService=A.createDecorator("CoreBrowserService"),v.IMouseService=A.createDecorator("MouseService"),v.IRenderService=A.createDecorator("RenderService"),v.ISelectionService=A.createDecorator("SelectionService"),v.ICharacterJoinerService=A.createDecorator("CharacterJoinerService"),v.IThemeService=A.createDecorator("ThemeService")},6731:function(P,v,b){var A=this&&this.__decorate||function(O,L,Z,W){var B,Y=arguments.length,G=Y<3?L:W===null?W=Object.getOwnPropertyDescriptor(L,Z):W;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")G=Reflect.decorate(O,L,Z,W);else for(var T=O.length-1;T>=0;T--)(B=O[T])&&(G=(Y<3?B(G):Y>3?B(L,Z,G):B(L,Z))||G);return Y>3&&G&&Object.defineProperty(L,Z,G),G},H=this&&this.__param||function(O,L){return function(Z,W){L(Z,W,O)}};Object.defineProperty(v,"__esModule",{value:!0}),v.ThemeService=v.DEFAULT_ANSI_COLORS=void 0;const E=b(7239),h=b(8055),D=b(8460),f=b(844),S=b(2585),g=h.css.toColor("#ffffff"),w=h.css.toColor("#000000"),C=h.css.toColor("#ffffff"),R=h.css.toColor("#000000"),p={css:"rgba(255, 255, 255, 0.3)",rgba:4294967117};v.DEFAULT_ANSI_COLORS=Object.freeze((()=>{const O=[h.css.toColor("#2e3436"),h.css.toColor("#cc0000"),h.css.toColor("#4e9a06"),h.css.toColor("#c4a000"),h.css.toColor("#3465a4"),h.css.toColor("#75507b"),h.css.toColor("#06989a"),h.css.toColor("#d3d7cf"),h.css.toColor("#555753"),h.css.toColor("#ef2929"),h.css.toColor("#8ae234"),h.css.toColor("#fce94f"),h.css.toColor("#729fcf"),h.css.toColor("#ad7fa8"),h.css.toColor("#34e2e2"),h.css.toColor("#eeeeec")],L=[0,95,135,175,215,255];for(let Z=0;Z<216;Z++){const W=L[Z/36%6|0],B=L[Z/6%6|0],Y=L[Z%6];O.push({css:h.channels.toCss(W,B,Y),rgba:h.channels.toRgba(W,B,Y)})}for(let Z=0;Z<24;Z++){const W=8+10*Z;O.push({css:h.channels.toCss(W,W,W),rgba:h.channels.toRgba(W,W,W)})}return O})());let $=v.ThemeService=class extends f.Disposable{get colors(){return this._colors}constructor(O){super(),this._optionsService=O,this._contrastCache=new E.ColorContrastCache,this._halfContrastCache=new E.ColorContrastCache,this._onChangeColors=this.register(new D.EventEmitter),this.onChangeColors=this._onChangeColors.event,this._colors={foreground:g,background:w,cursor:C,cursorAccent:R,selectionForeground:void 0,selectionBackgroundTransparent:p,selectionBackgroundOpaque:h.color.blend(w,p),selectionInactiveBackgroundTransparent:p,selectionInactiveBackgroundOpaque:h.color.blend(w,p),ansi:v.DEFAULT_ANSI_COLORS.slice(),contrastCache:this._contrastCache,halfContrastCache:this._halfContrastCache},this._updateRestoreColors(),this._setTheme(this._optionsService.rawOptions.theme),this.register(this._optionsService.onSpecificOptionChange("minimumContrastRatio",()=>this._contrastCache.clear())),this.register(this._optionsService.onSpecificOptionChange("theme",()=>this._setTheme(this._optionsService.rawOptions.theme)))}_setTheme(O={}){const L=this._colors;if(L.foreground=F(O.foreground,g),L.background=F(O.background,w),L.cursor=F(O.cursor,C),L.cursorAccent=F(O.cursorAccent,R),L.selectionBackgroundTransparent=F(O.selectionBackground,p),L.selectionBackgroundOpaque=h.color.blend(L.background,L.selectionBackgroundTransparent),L.selectionInactiveBackgroundTransparent=F(O.selectionInactiveBackground,L.selectionBackgroundTransparent),L.selectionInactiveBackgroundOpaque=h.color.blend(L.background,L.selectionInactiveBackgroundTransparent),L.selectionForeground=O.selectionForeground?F(O.selectionForeground,h.NULL_COLOR):void 0,L.selectionForeground===h.NULL_COLOR&&(L.selectionForeground=void 0),h.color.isOpaque(L.selectionBackgroundTransparent))L.selectionBackgroundTransparent=h.color.opacity(L.selectionBackgroundTransparent,0.3);if(h.color.isOpaque(L.selectionInactiveBackgroundTransparent))L.selectionInactiveBackgroundTransparent=h.color.opacity(L.selectionInactiveBackgroundTransparent,0.3);if(L.ansi=v.DEFAULT_ANSI_COLORS.slice(),L.ansi[0]=F(O.black,v.DEFAULT_ANSI_COLORS[0]),L.ansi[1]=F(O.red,v.DEFAULT_ANSI_COLORS[1]),L.ansi[2]=F(O.green,v.DEFAULT_ANSI_COLORS[2]),L.ansi[3]=F(O.yellow,v.DEFAULT_ANSI_COLORS[3]),L.ansi[4]=F(O.blue,v.DEFAULT_ANSI_COLORS[4]),L.ansi[5]=F(O.magenta,v.DEFAULT_ANSI_COLORS[5]),L.ansi[6]=F(O.cyan,v.DEFAULT_ANSI_COLORS[6]),L.ansi[7]=F(O.white,v.DEFAULT_ANSI_COLORS[7]),L.ansi[8]=F(O.brightBlack,v.DEFAULT_ANSI_COLORS[8]),L.ansi[9]=F(O.brightRed,v.DEFAULT_ANSI_COLORS[9]),L.ansi[10]=F(O.brightGreen,v.DEFAULT_ANSI_COLORS[10]),L.ansi[11]=F(O.brightYellow,v.DEFAULT_ANSI_COLORS[11]),L.ansi[12]=F(O.brightBlue,v.DEFAULT_ANSI_COLORS[12]),L.ansi[13]=F(O.brightMagenta,v.DEFAULT_ANSI_COLORS[13]),L.ansi[14]=F(O.brightCyan,v.DEFAULT_ANSI_COLORS[14]),L.ansi[15]=F(O.brightWhite,v.DEFAULT_ANSI_COLORS[15]),O.extendedAnsi){const Z=Math.min(L.ansi.length-16,O.extendedAnsi.length);for(let W=0;W<Z;W++)L.ansi[W+16]=F(O.extendedAnsi[W],v.DEFAULT_ANSI_COLORS[W+16])}this._contrastCache.clear(),this._halfContrastCache.clear(),this._updateRestoreColors(),this._onChangeColors.fire(this.colors)}restoreColor(O){this._restoreColor(O),this._onChangeColors.fire(this.colors)}_restoreColor(O){if(O!==void 0)switch(O){case 256:this._colors.foreground=this._restoreColors.foreground;break;case 257:this._colors.background=this._restoreColors.background;break;case 258:this._colors.cursor=this._restoreColors.cursor;break;default:this._colors.ansi[O]=this._restoreColors.ansi[O]}else for(let L=0;L<this._restoreColors.ansi.length;++L)this._colors.ansi[L]=this._restoreColors.ansi[L]}modifyColors(O){O(this._colors),this._onChangeColors.fire(this.colors)}_updateRestoreColors(){this._restoreColors={foreground:this._colors.foreground,background:this._colors.background,cursor:this._colors.cursor,ansi:this._colors.ansi.slice()}}};function F(O,L){if(O!==void 0)try{return h.css.toColor(O)}catch(Z){}return L}v.ThemeService=$=A([H(0,S.IOptionsService)],$)},6349:(P,v,b)=>{Object.defineProperty(v,"__esModule",{value:!0}),v.CircularList=void 0;const A=b(8460),H=b(844);class E extends H.Disposable{constructor(h){super(),this._maxLength=h,this.onDeleteEmitter=this.register(new A.EventEmitter),this.onDelete=this.onDeleteEmitter.event,this.onInsertEmitter=this.register(new A.EventEmitter),this.onInsert=this.onInsertEmitter.event,this.onTrimEmitter=this.register(new A.EventEmitter),this.onTrim=this.onTrimEmitter.event,this._array=new Array(this._maxLength),this._startIndex=0,this._length=0}get maxLength(){return this._maxLength}set maxLength(h){if(this._maxLength===h)return;const D=new Array(h);for(let f=0;f<Math.min(h,this.length);f++)D[f]=this._array[this._getCyclicIndex(f)];this._array=D,this._maxLength=h,this._startIndex=0}get length(){return this._length}set length(h){if(h>this._length)for(let D=this._length;D<h;D++)this._array[D]=void 0;this._length=h}get(h){return this._array[this._getCyclicIndex(h)]}set(h,D){this._array[this._getCyclicIndex(h)]=D}push(h){this._array[this._getCyclicIndex(this._length)]=h,this._length===this._maxLength?(this._startIndex=++this._startIndex%this._maxLength,this.onTrimEmitter.fire(1)):this._length++}recycle(){if(this._length!==this._maxLength)throw new Error("Can only recycle when the buffer is full");return this._startIndex=++this._startIndex%this._maxLength,this.onTrimEmitter.fire(1),this._array[this._getCyclicIndex(this._length-1)]}get isFull(){return this._length===this._maxLength}pop(){return this._array[this._getCyclicIndex(this._length---1)]}splice(h,D,...f){if(D){for(let S=h;S<this._length-D;S++)this._array[this._getCyclicIndex(S)]=this._array[this._getCyclicIndex(S+D)];this._length-=D,this.onDeleteEmitter.fire({index:h,amount:D})}for(let S=this._length-1;S>=h;S--)this._array[this._getCyclicIndex(S+f.length)]=this._array[this._getCyclicIndex(S)];for(let S=0;S<f.length;S++)this._array[this._getCyclicIndex(h+S)]=f[S];if(f.length&&this.onInsertEmitter.fire({index:h,amount:f.length}),this._length+f.length>this._maxLength){const S=this._length+f.length-this._maxLength;this._startIndex+=S,this._length=this._maxLength,this.onTrimEmitter.fire(S)}else this._length+=f.length}trimStart(h){h>this._length&&(h=this._length),this._startIndex+=h,this._length-=h,this.onTrimEmitter.fire(h)}shiftElements(h,D,f){if(!(D<=0)){if(h<0||h>=this._length)throw new Error("start argument out of range");if(h+f<0)throw new Error("Cannot shift elements in list beyond index 0");if(f>0){for(let g=D-1;g>=0;g--)this.set(h+g+f,this.get(h+g));const S=h+D+f-this._length;if(S>0)for(this._length+=S;this._length>this._maxLength;)this._length--,this._startIndex++,this.onTrimEmitter.fire(1)}else for(let S=0;S<D;S++)this.set(h+S+f,this.get(h+S))}}_getCyclicIndex(h){return(this._startIndex+h)%this._maxLength}}v.CircularList=E},1439:(P,v)=>{Object.defineProperty(v,"__esModule",{value:!0}),v.clone=void 0,v.clone=function b(A,H=5){if(typeof A!="object")return A;const E=Array.isArray(A)?[]:{};for(let h in A)E[h]=H<=1?A[h]:A[h]&&b(A[h],H-1);return E}},8055:(P,v,b)=>{Object.defineProperty(v,"__esModule",{value:!0}),v.contrastRatio=v.toPaddedHex=v.rgba=v.rgb=v.css=v.color=v.channels=v.NULL_COLOR=void 0;const A=b(6114);let H=0,E=0,h=0,D=0;var f,S,g,w,C;function R($){const F=$.toString(16);return F.length<2?"0"+F:F}function p($,F){return $<F?(F+0.05)/($+0.05):($+0.05)/(F+0.05)}v.NULL_COLOR={css:"#00000000",rgba:0},function($){$.toCss=function(F,O,L,Z){return Z!==void 0?`#${R(F)}${R(O)}${R(L)}${R(Z)}`:`#${R(F)}${R(O)}${R(L)}`},$.toRgba=function(F,O,L,Z=255){return(F<<24|O<<16|L<<8|Z)>>>0}}(f||(v.channels=f={})),function($){function F(O,L){return D=Math.round(255*L),[H,E,h]=C.toChannels(O.rgba),{css:f.toCss(H,E,h,D),rgba:f.toRgba(H,E,h,D)}}$.blend=function(O,L){if(D=(255&L.rgba)/255,D===1)return{css:L.css,rgba:L.rgba};const Z=L.rgba>>24&255,W=L.rgba>>16&255,B=L.rgba>>8&255,Y=O.rgba>>24&255,G=O.rgba>>16&255,T=O.rgba>>8&255;return H=Y+Math.round((Z-Y)*D),E=G+Math.round((W-G)*D),h=T+Math.round((B-T)*D),{css:f.toCss(H,E,h),rgba:f.toRgba(H,E,h)}},$.isOpaque=function(O){return(255&O.rgba)==255},$.ensureContrastRatio=function(O,L,Z){const W=C.ensureContrastRatio(O.rgba,L.rgba,Z);if(W)return C.toColor(W>>24&255,W>>16&255,W>>8&255)},$.opaque=function(O){const L=(255|O.rgba)>>>0;return[H,E,h]=C.toChannels(L),{css:f.toCss(H,E,h),rgba:L}},$.opacity=F,$.multiplyOpacity=function(O,L){return D=255&O.rgba,F(O,D*L/255)},$.toColorRGB=function(O){return[O.rgba>>24&255,O.rgba>>16&255,O.rgba>>8&255]}}(S||(v.color=S={})),function($){let F,O;if(!A.isNode){const L=document.createElement("canvas");L.width=1,L.height=1;const Z=L.getContext("2d",{willReadFrequently:!0});Z&&(F=Z,F.globalCompositeOperation="copy",O=F.createLinearGradient(0,0,1,1))}$.toColor=function(L){if(L.match(/#[\da-f]{3,8}/i))switch(L.length){case 4:return H=parseInt(L.slice(1,2).repeat(2),16),E=parseInt(L.slice(2,3).repeat(2),16),h=parseInt(L.slice(3,4).repeat(2),16),C.toColor(H,E,h);case 5:return H=parseInt(L.slice(1,2).repeat(2),16),E=parseInt(L.slice(2,3).repeat(2),16),h=parseInt(L.slice(3,4).repeat(2),16),D=parseInt(L.slice(4,5).repeat(2),16),C.toColor(H,E,h,D);case 7:return{css:L,rgba:(parseInt(L.slice(1),16)<<8|255)>>>0};case 9:return{css:L,rgba:parseInt(L.slice(1),16)>>>0}}const Z=L.match(/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(,\s*(0|1|\d?\.(\d+))\s*)?\)/);if(Z)return H=parseInt(Z[1]),E=parseInt(Z[2]),h=parseInt(Z[3]),D=Math.round(255*(Z[5]===void 0?1:parseFloat(Z[5]))),C.toColor(H,E,h,D);if(!F||!O)throw new Error("css.toColor: Unsupported css format");if(F.fillStyle=O,F.fillStyle=L,typeof F.fillStyle!="string")throw new Error("css.toColor: Unsupported css format");if(F.fillRect(0,0,1,1),[H,E,h,D]=F.getImageData(0,0,1,1).data,D!==255)throw new Error("css.toColor: Unsupported css format");return{rgba:f.toRgba(H,E,h,D),css:L}}}(g||(v.css=g={})),function($){function F(O,L,Z){const W=O/255,B=L/255,Y=Z/255;return 0.2126*(W<=0.03928?W/12.92:Math.pow((W+0.055)/1.055,2.4))+0.7152*(B<=0.03928?B/12.92:Math.pow((B+0.055)/1.055,2.4))+0.0722*(Y<=0.03928?Y/12.92:Math.pow((Y+0.055)/1.055,2.4))}$.relativeLuminance=function(O){return F(O>>16&255,O>>8&255,255&O)},$.relativeLuminance2=F}(w||(v.rgb=w={})),function($){function F(L,Z,W){const B=L>>24&255,Y=L>>16&255,G=L>>8&255;let T=Z>>24&255,J=Z>>16&255,X=Z>>8&255,m=p(w.relativeLuminance2(T,J,X),w.relativeLuminance2(B,Y,G));for(;m<W&&(T>0||J>0||X>0);)T-=Math.max(0,Math.ceil(0.1*T)),J-=Math.max(0,Math.ceil(0.1*J)),X-=Math.max(0,Math.ceil(0.1*X)),m=p(w.relativeLuminance2(T,J,X),w.relativeLuminance2(B,Y,G));return(T<<24|J<<16|X<<8|255)>>>0}function O(L,Z,W){const B=L>>24&255,Y=L>>16&255,G=L>>8&255;let T=Z>>24&255,J=Z>>16&255,X=Z>>8&255,m=p(w.relativeLuminance2(T,J,X),w.relativeLuminance2(B,Y,G));for(;m<W&&(T<255||J<255||X<255);)T=Math.min(255,T+Math.ceil(0.1*(255-T))),J=Math.min(255,J+Math.ceil(0.1*(255-J))),X=Math.min(255,X+Math.ceil(0.1*(255-X))),m=p(w.relativeLuminance2(T,J,X),w.relativeLuminance2(B,Y,G));return(T<<24|J<<16|X<<8|255)>>>0}$.ensureContrastRatio=function(L,Z,W){const B=w.relativeLuminance(L>>8),Y=w.relativeLuminance(Z>>8);if(p(B,Y)<W){if(Y<B){const J=F(L,Z,W),X=p(B,w.relativeLuminance(J>>8));if(X<W){const m=O(L,Z,W);return X>p(B,w.relativeLuminance(m>>8))?J:m}return J}const G=O(L,Z,W),T=p(B,w.relativeLuminance(G>>8));if(T<W){const J=F(L,Z,W);return T>p(B,w.relativeLuminance(J>>8))?G:J}return G}},$.reduceLuminance=F,$.increaseLuminance=O,$.toChannels=function(L){return[L>>24&255,L>>16&255,L>>8&255,255&L]},$.toColor=function(L,Z,W,B){return{css:f.toCss(L,Z,W,B),rgba:f.toRgba(L,Z,W,B)}}}(C||(v.rgba=C={})),v.toPaddedHex=R,v.contrastRatio=p},8969:(P,v,b)=>{Object.defineProperty(v,"__esModule",{value:!0}),v.CoreTerminal=void 0;const A=b(844),H=b(2585),E=b(4348),h=b(7866),D=b(744),f=b(7302),S=b(6975),g=b(8460),w=b(1753),C=b(1480),R=b(7994),p=b(9282),$=b(5435),F=b(5981),O=b(2660);let L=!1;class Z extends A.Disposable{get onScroll(){return this._onScrollApi||(this._onScrollApi=this.register(new g.EventEmitter),this._onScroll.event((W)=>{var B;(B=this._onScrollApi)===null||B===void 0||B.fire(W.position)})),this._onScrollApi.event}get cols(){return this._bufferService.cols}get rows(){return this._bufferService.rows}get buffers(){return this._bufferService.buffers}get options(){return this.optionsService.options}set options(W){for(let B in W)this.optionsService.options[B]=W[B]}constructor(W){super(),this._windowsWrappingHeuristics=this.register(new A.MutableDisposable),this._onBinary=this.register(new g.EventEmitter),this.onBinary=this._onBinary.event,this._onData=this.register(new g.EventEmitter),this.onData=this._onData.event,this._onLineFeed=this.register(new g.EventEmitter),this.onLineFeed=this._onLineFeed.event,this._onResize=this.register(new g.EventEmitter),this.onResize=this._onResize.event,this._onWriteParsed=this.register(new g.EventEmitter),this.onWriteParsed=this._onWriteParsed.event,this._onScroll=this.register(new g.EventEmitter),this._instantiationService=new E.InstantiationService,this.optionsService=this.register(new f.OptionsService(W)),this._instantiationService.setService(H.IOptionsService,this.optionsService),this._bufferService=this.register(this._instantiationService.createInstance(D.BufferService)),this._instantiationService.setService(H.IBufferService,this._bufferService),this._logService=this.register(this._instantiationService.createInstance(h.LogService)),this._instantiationService.setService(H.ILogService,this._logService),this.coreService=this.register(this._instantiationService.createInstance(S.CoreService)),this._instantiationService.setService(H.ICoreService,this.coreService),this.coreMouseService=this.register(this._instantiationService.createInstance(w.CoreMouseService)),this._instantiationService.setService(H.ICoreMouseService,this.coreMouseService),this.unicodeService=this.register(this._instantiationService.createInstance(C.UnicodeService)),this._instantiationService.setService(H.IUnicodeService,this.unicodeService),this._charsetService=this._instantiationService.createInstance(R.CharsetService),this._instantiationService.setService(H.ICharsetService,this._charsetService),this._oscLinkService=this._instantiationService.createInstance(O.OscLinkService),this._instantiationService.setService(H.IOscLinkService,this._oscLinkService),this._inputHandler=this.register(new $.InputHandler(this._bufferService,this._charsetService,this.coreService,this._logService,this.optionsService,this._oscLinkService,this.coreMouseService,this.unicodeService)),this.register(g.forwardEvent(this._inputHandler.onLineFeed,this._onLineFeed)),this.register(this._inputHandler),this.register(g.forwardEvent(this._bufferService.onResize,this._onResize)),this.register(g.forwardEvent(this.coreService.onData,this._onData)),this.register(g.forwardEvent(this.coreService.onBinary,this._onBinary)),this.register(this.coreService.onRequestScrollToBottom(()=>this.scrollToBottom())),this.register(this.coreService.onUserInput(()=>this._writeBuffer.handleUserInput())),this.register(this.optionsService.onMultipleOptionChange(["windowsMode","windowsPty"],()=>this._handleWindowsPtyOptionChange())),this.register(this._bufferService.onScroll((B)=>{this._onScroll.fire({position:this._bufferService.buffer.ydisp,source:0}),this._inputHandler.markRangeDirty(this._bufferService.buffer.scrollTop,this._bufferService.buffer.scrollBottom)})),this.register(this._inputHandler.onScroll((B)=>{this._onScroll.fire({position:this._bufferService.buffer.ydisp,source:0}),this._inputHandler.markRangeDirty(this._bufferService.buffer.scrollTop,this._bufferService.buffer.scrollBottom)})),this._writeBuffer=this.register(new F.WriteBuffer((B,Y)=>this._inputHandler.parse(B,Y))),this.register(g.forwardEvent(this._writeBuffer.onWriteParsed,this._onWriteParsed))}write(W,B){this._writeBuffer.write(W,B)}writeSync(W,B){this._logService.logLevel<=H.LogLevelEnum.WARN&&!L&&(this._logService.warn("writeSync is unreliable and will be removed soon."),L=!0),this._writeBuffer.writeSync(W,B)}resize(W,B){isNaN(W)||isNaN(B)||(W=Math.max(W,D.MINIMUM_COLS),B=Math.max(B,D.MINIMUM_ROWS),this._bufferService.resize(W,B))}scroll(W,B=!1){this._bufferService.scroll(W,B)}scrollLines(W,B,Y){this._bufferService.scrollLines(W,B,Y)}scrollPages(W){this.scrollLines(W*(this.rows-1))}scrollToTop(){this.scrollLines(-this._bufferService.buffer.ydisp)}scrollToBottom(){this.scrollLines(this._bufferService.buffer.ybase-this._bufferService.buffer.ydisp)}scrollToLine(W){const B=W-this._bufferService.buffer.ydisp;B!==0&&this.scrollLines(B)}registerEscHandler(W,B){return this._inputHandler.registerEscHandler(W,B)}registerDcsHandler(W,B){return this._inputHandler.registerDcsHandler(W,B)}registerCsiHandler(W,B){return this._inputHandler.registerCsiHandler(W,B)}registerOscHandler(W,B){return this._inputHandler.registerOscHandler(W,B)}_setup(){this._handleWindowsPtyOptionChange()}reset(){this._inputHandler.reset(),this._bufferService.reset(),this._charsetService.reset(),this.coreService.reset(),this.coreMouseService.reset()}_handleWindowsPtyOptionChange(){let W=!1;const B=this.optionsService.rawOptions.windowsPty;B&&B.buildNumber!==void 0&&B.buildNumber!==void 0?W=B.backend==="conpty"&&B.buildNumber<21376:this.optionsService.rawOptions.windowsMode&&(W=!0),W?this._enableWindowsWrappingHeuristics():this._windowsWrappingHeuristics.clear()}_enableWindowsWrappingHeuristics(){if(!this._windowsWrappingHeuristics.value){const W=[];W.push(this.onLineFeed(p.updateWindowsModeWrappedState.bind(null,this._bufferService))),W.push(this.registerCsiHandler({final:"H"},()=>(p.updateWindowsModeWrappedState(this._bufferService),!1))),this._windowsWrappingHeuristics.value=A.toDisposable(()=>{for(let B of W)B.dispose()})}}}v.CoreTerminal=Z},8460:(P,v)=>{Object.defineProperty(v,"__esModule",{value:!0}),v.forwardEvent=v.EventEmitter=void 0,v.EventEmitter=class{constructor(){this._listeners=[],this._disposed=!1}get event(){return this._event||(this._event=(b)=>(this._listeners.push(b),{dispose:()=>{if(!this._disposed){for(let A=0;A<this._listeners.length;A++)if(this._listeners[A]===b)return void this._listeners.splice(A,1)}}})),this._event}fire(b,A){const H=[];for(let E=0;E<this._listeners.length;E++)H.push(this._listeners[E]);for(let E=0;E<H.length;E++)H[E].call(void 0,b,A)}dispose(){this.clearListeners(),this._disposed=!0}clearListeners(){this._listeners&&(this._listeners.length=0)}},v.forwardEvent=function(b,A){return b((H)=>A.fire(H))}},5435:function(P,v,b){var A=this&&this.__decorate||function(m,q,V,Q){var k,N=arguments.length,y=N<3?q:Q===null?Q=Object.getOwnPropertyDescriptor(q,V):Q;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")y=Reflect.decorate(m,q,V,Q);else for(var u=m.length-1;u>=0;u--)(k=m[u])&&(y=(N<3?k(y):N>3?k(q,V,y):k(q,V))||y);return N>3&&y&&Object.defineProperty(q,V,y),y},H=this&&this.__param||function(m,q){return function(V,Q){q(V,Q,m)}};Object.defineProperty(v,"__esModule",{value:!0}),v.InputHandler=v.WindowsOptionsReportType=void 0;const E=b(2584),h=b(7116),D=b(2015),f=b(844),S=b(482),g=b(8437),w=b(8460),C=b(643),R=b(511),p=b(3734),$=b(2585),F=b(6242),O=b(6351),L=b(5941),Z={"(":0,")":1,"*":2,"+":3,"-":1,".":2},W=131072;function B(m,q){if(m>24)return q.setWinLines||!1;switch(m){case 1:return!!q.restoreWin;case 2:return!!q.minimizeWin;case 3:return!!q.setWinPosition;case 4:return!!q.setWinSizePixels;case 5:return!!q.raiseWin;case 6:return!!q.lowerWin;case 7:return!!q.refreshWin;case 8:return!!q.setWinSizeChars;case 9:return!!q.maximizeWin;case 10:return!!q.fullscreenWin;case 11:return!!q.getWinState;case 13:return!!q.getWinPosition;case 14:return!!q.getWinSizePixels;case 15:return!!q.getScreenSizePixels;case 16:return!!q.getCellSizePixels;case 18:return!!q.getWinSizeChars;case 19:return!!q.getScreenSizeChars;case 20:return!!q.getIconTitle;case 21:return!!q.getWinTitle;case 22:return!!q.pushTitle;case 23:return!!q.popTitle;case 24:return!!q.setWinLines}return!1}var Y;(function(m){m[m.GET_WIN_SIZE_PIXELS=0]="GET_WIN_SIZE_PIXELS",m[m.GET_CELL_SIZE_PIXELS=1]="GET_CELL_SIZE_PIXELS"})(Y||(v.WindowsOptionsReportType=Y={}));let G=0;class T extends f.Disposable{getAttrData(){return this._curAttrData}constructor(m,q,V,Q,k,N,y,u,c=new D.EscapeSequenceParser){super(),this._bufferService=m,this._charsetService=q,this._coreService=V,this._logService=Q,this._optionsService=k,this._oscLinkService=N,this._coreMouseService=y,this._unicodeService=u,this._parser=c,this._parseBuffer=new Uint32Array(4096),this._stringDecoder=new S.StringToUtf32,this._utf8Decoder=new S.Utf8ToUtf32,this._workCell=new R.CellData,this._windowTitle="",this._iconName="",this._windowTitleStack=[],this._iconNameStack=[],this._curAttrData=g.DEFAULT_ATTR_DATA.clone(),this._eraseAttrDataInternal=g.DEFAULT_ATTR_DATA.clone(),this._onRequestBell=this.register(new w.EventEmitter),this.onRequestBell=this._onRequestBell.event,this._onRequestRefreshRows=this.register(new w.EventEmitter),this.onRequestRefreshRows=this._onRequestRefreshRows.event,this._onRequestReset=this.register(new w.EventEmitter),this.onRequestReset=this._onRequestReset.event,this._onRequestSendFocus=this.register(new w.EventEmitter),this.onRequestSendFocus=this._onRequestSendFocus.event,this._onRequestSyncScrollBar=this.register(new w.EventEmitter),this.onRequestSyncScrollBar=this._onRequestSyncScrollBar.event,this._onRequestWindowsOptionsReport=this.register(new w.EventEmitter),this.onRequestWindowsOptionsReport=this._onRequestWindowsOptionsReport.event,this._onA11yChar=this.register(new w.EventEmitter),this.onA11yChar=this._onA11yChar.event,this._onA11yTab=this.register(new w.EventEmitter),this.onA11yTab=this._onA11yTab.event,this._onCursorMove=this.register(new w.EventEmitter),this.onCursorMove=this._onCursorMove.event,this._onLineFeed=this.register(new w.EventEmitter),this.onLineFeed=this._onLineFeed.event,this._onScroll=this.register(new w.EventEmitter),this.onScroll=this._onScroll.event,this._onTitleChange=this.register(new w.EventEmitter),this.onTitleChange=this._onTitleChange.event,this._onColor=this.register(new w.EventEmitter),this.onColor=this._onColor.event,this._parseStack={paused:!1,cursorStartX:0,cursorStartY:0,decodedLength:0,position:0},this._specialColors=[256,257,258],this.register(this._parser),this._dirtyRowTracker=new J(this._bufferService),this._activeBuffer=this._bufferService.buffer,this.register(this._bufferService.buffers.onBufferActivate((M)=>this._activeBuffer=M.activeBuffer)),this._parser.setCsiHandlerFallback((M,_)=>{this._logService.debug("Unknown CSI code: ",{identifier:this._parser.identToString(M),params:_.toArray()})}),this._parser.setEscHandlerFallback((M)=>{this._logService.debug("Unknown ESC code: ",{identifier:this._parser.identToString(M)})}),this._parser.setExecuteHandlerFallback((M)=>{this._logService.debug("Unknown EXECUTE code: ",{code:M})}),this._parser.setOscHandlerFallback((M,_,U)=>{this._logService.debug("Unknown OSC code: ",{identifier:M,action:_,data:U})}),this._parser.setDcsHandlerFallback((M,_,U)=>{_==="HOOK"&&(U=U.toArray()),this._logService.debug("Unknown DCS code: ",{identifier:this._parser.identToString(M),action:_,payload:U})}),this._parser.setPrintHandler((M,_,U)=>this.print(M,_,U)),this._parser.registerCsiHandler({final:"@"},(M)=>this.insertChars(M)),this._parser.registerCsiHandler({intermediates:" ",final:"@"},(M)=>this.scrollLeft(M)),this._parser.registerCsiHandler({final:"A"},(M)=>this.cursorUp(M)),this._parser.registerCsiHandler({intermediates:" ",final:"A"},(M)=>this.scrollRight(M)),this._parser.registerCsiHandler({final:"B"},(M)=>this.cursorDown(M)),this._parser.registerCsiHandler({final:"C"},(M)=>this.cursorForward(M)),this._parser.registerCsiHandler({final:"D"},(M)=>this.cursorBackward(M)),this._parser.registerCsiHandler({final:"E"},(M)=>this.cursorNextLine(M)),this._parser.registerCsiHandler({final:"F"},(M)=>this.cursorPrecedingLine(M)),this._parser.registerCsiHandler({final:"G"},(M)=>this.cursorCharAbsolute(M)),this._parser.registerCsiHandler({final:"H"},(M)=>this.cursorPosition(M)),this._parser.registerCsiHandler({final:"I"},(M)=>this.cursorForwardTab(M)),this._parser.registerCsiHandler({final:"J"},(M)=>this.eraseInDisplay(M,!1)),this._parser.registerCsiHandler({prefix:"?",final:"J"},(M)=>this.eraseInDisplay(M,!0)),this._parser.registerCsiHandler({final:"K"},(M)=>this.eraseInLine(M,!1)),this._parser.registerCsiHandler({prefix:"?",final:"K"},(M)=>this.eraseInLine(M,!0)),this._parser.registerCsiHandler({final:"L"},(M)=>this.insertLines(M)),this._parser.registerCsiHandler({final:"M"},(M)=>this.deleteLines(M)),this._parser.registerCsiHandler({final:"P"},(M)=>this.deleteChars(M)),this._parser.registerCsiHandler({final:"S"},(M)=>this.scrollUp(M)),this._parser.registerCsiHandler({final:"T"},(M)=>this.scrollDown(M)),this._parser.registerCsiHandler({final:"X"},(M)=>this.eraseChars(M)),this._parser.registerCsiHandler({final:"Z"},(M)=>this.cursorBackwardTab(M)),this._parser.registerCsiHandler({final:"`"},(M)=>this.charPosAbsolute(M)),this._parser.registerCsiHandler({final:"a"},(M)=>this.hPositionRelative(M)),this._parser.registerCsiHandler({final:"b"},(M)=>this.repeatPrecedingCharacter(M)),this._parser.registerCsiHandler({final:"c"},(M)=>this.sendDeviceAttributesPrimary(M)),this._parser.registerCsiHandler({prefix:">",final:"c"},(M)=>this.sendDeviceAttributesSecondary(M)),this._parser.registerCsiHandler({final:"d"},(M)=>this.linePosAbsolute(M)),this._parser.registerCsiHandler({final:"e"},(M)=>this.vPositionRelative(M)),this._parser.registerCsiHandler({final:"f"},(M)=>this.hVPosition(M)),this._parser.registerCsiHandler({final:"g"},(M)=>this.tabClear(M)),this._parser.registerCsiHandler({final:"h"},(M)=>this.setMode(M)),this._parser.registerCsiHandler({prefix:"?",final:"h"},(M)=>this.setModePrivate(M)),this._parser.registerCsiHandler({final:"l"},(M)=>this.resetMode(M)),this._parser.registerCsiHandler({prefix:"?",final:"l"},(M)=>this.resetModePrivate(M)),this._parser.registerCsiHandler({final:"m"},(M)=>this.charAttributes(M)),this._parser.registerCsiHandler({final:"n"},(M)=>this.deviceStatus(M)),this._parser.registerCsiHandler({prefix:"?",final:"n"},(M)=>this.deviceStatusPrivate(M)),this._parser.registerCsiHandler({intermediates:"!",final:"p"},(M)=>this.softReset(M)),this._parser.registerCsiHandler({intermediates:" ",final:"q"},(M)=>this.setCursorStyle(M)),this._parser.registerCsiHandler({final:"r"},(M)=>this.setScrollRegion(M)),this._parser.registerCsiHandler({final:"s"},(M)=>this.saveCursor(M)),this._parser.registerCsiHandler({final:"t"},(M)=>this.windowOptions(M)),this._parser.registerCsiHandler({final:"u"},(M)=>this.restoreCursor(M)),this._parser.registerCsiHandler({intermediates:"'",final:"}"},(M)=>this.insertColumns(M)),this._parser.registerCsiHandler({intermediates:"'",final:"~"},(M)=>this.deleteColumns(M)),this._parser.registerCsiHandler({intermediates:'"',final:"q"},(M)=>this.selectProtected(M)),this._parser.registerCsiHandler({intermediates:"$",final:"p"},(M)=>this.requestMode(M,!0)),this._parser.registerCsiHandler({prefix:"?",intermediates:"$",final:"p"},(M)=>this.requestMode(M,!1)),this._parser.setExecuteHandler(E.C0.BEL,()=>this.bell()),this._parser.setExecuteHandler(E.C0.LF,()=>this.lineFeed()),this._parser.setExecuteHandler(E.C0.VT,()=>this.lineFeed()),this._parser.setExecuteHandler(E.C0.FF,()=>this.lineFeed()),this._parser.setExecuteHandler(E.C0.CR,()=>this.carriageReturn()),this._parser.setExecuteHandler(E.C0.BS,()=>this.backspace()),this._parser.setExecuteHandler(E.C0.HT,()=>this.tab()),this._parser.setExecuteHandler(E.C0.SO,()=>this.shiftOut()),this._parser.setExecuteHandler(E.C0.SI,()=>this.shiftIn()),this._parser.setExecuteHandler(E.C1.IND,()=>this.index()),this._parser.setExecuteHandler(E.C1.NEL,()=>this.nextLine()),this._parser.setExecuteHandler(E.C1.HTS,()=>this.tabSet()),this._parser.registerOscHandler(0,new F.OscHandler((M)=>(this.setTitle(M),this.setIconName(M),!0))),this._parser.registerOscHandler(1,new F.OscHandler((M)=>this.setIconName(M))),this._parser.registerOscHandler(2,new F.OscHandler((M)=>this.setTitle(M))),this._parser.registerOscHandler(4,new F.OscHandler((M)=>this.setOrReportIndexedColor(M))),this._parser.registerOscHandler(8,new F.OscHandler((M)=>this.setHyperlink(M))),this._parser.registerOscHandler(10,new F.OscHandler((M)=>this.setOrReportFgColor(M))),this._parser.registerOscHandler(11,new F.OscHandler((M)=>this.setOrReportBgColor(M))),this._parser.registerOscHandler(12,new F.OscHandler((M)=>this.setOrReportCursorColor(M))),this._parser.registerOscHandler(104,new F.OscHandler((M)=>this.restoreIndexedColor(M))),this._parser.registerOscHandler(110,new F.OscHandler((M)=>this.restoreFgColor(M))),this._parser.registerOscHandler(111,new F.OscHandler((M)=>this.restoreBgColor(M))),this._parser.registerOscHandler(112,new F.OscHandler((M)=>this.restoreCursorColor(M))),this._parser.registerEscHandler({final:"7"},()=>this.saveCursor()),this._parser.registerEscHandler({final:"8"},()=>this.restoreCursor()),this._parser.registerEscHandler({final:"D"},()=>this.index()),this._parser.registerEscHandler({final:"E"},()=>this.nextLine()),this._parser.registerEscHandler({final:"H"},()=>this.tabSet()),this._parser.registerEscHandler({final:"M"},()=>this.reverseIndex()),this._parser.registerEscHandler({final:"="},()=>this.keypadApplicationMode()),this._parser.registerEscHandler({final:">"},()=>this.keypadNumericMode()),this._parser.registerEscHandler({final:"c"},()=>this.fullReset()),this._parser.registerEscHandler({final:"n"},()=>this.setgLevel(2)),this._parser.registerEscHandler({final:"o"},()=>this.setgLevel(3)),this._parser.registerEscHandler({final:"|"},()=>this.setgLevel(3)),this._parser.registerEscHandler({final:"}"},()=>this.setgLevel(2)),this._parser.registerEscHandler({final:"~"},()=>this.setgLevel(1)),this._parser.registerEscHandler({intermediates:"%",final:"@"},()=>this.selectDefaultCharset()),this._parser.registerEscHandler({intermediates:"%",final:"G"},()=>this.selectDefaultCharset());for(let M in h.CHARSETS)this._parser.registerEscHandler({intermediates:"(",final:M},()=>this.selectCharset("("+M)),this._parser.registerEscHandler({intermediates:")",final:M},()=>this.selectCharset(")"+M)),this._parser.registerEscHandler({intermediates:"*",final:M},()=>this.selectCharset("*"+M)),this._parser.registerEscHandler({intermediates:"+",final:M},()=>this.selectCharset("+"+M)),this._parser.registerEscHandler({intermediates:"-",final:M},()=>this.selectCharset("-"+M)),this._parser.registerEscHandler({intermediates:".",final:M},()=>this.selectCharset("."+M)),this._parser.registerEscHandler({intermediates:"/",final:M},()=>this.selectCharset("/"+M));this._parser.registerEscHandler({intermediates:"#",final:"8"},()=>this.screenAlignmentPattern()),this._parser.setErrorHandler((M)=>(this._logService.error("Parsing error: ",M),M)),this._parser.registerDcsHandler({intermediates:"$",final:"q"},new O.DcsHandler((M,_)=>this.requestStatusString(M,_)))}_preserveStack(m,q,V,Q){this._parseStack.paused=!0,this._parseStack.cursorStartX=m,this._parseStack.cursorStartY=q,this._parseStack.decodedLength=V,this._parseStack.position=Q}_logSlowResolvingAsync(m){this._logService.logLevel<=$.LogLevelEnum.WARN&&Promise.race([m,new Promise((q,V)=>setTimeout(()=>V("#SLOW_TIMEOUT"),5000))]).catch((q)=>{if(q!=="#SLOW_TIMEOUT")throw q;console.warn("async parser handler taking longer than 5000 ms")})}_getCurrentLinkId(){return this._curAttrData.extended.urlId}parse(m,q){let V,Q=this._activeBuffer.x,k=this._activeBuffer.y,N=0;const y=this._parseStack.paused;if(y){if(V=this._parser.parse(this._parseBuffer,this._parseStack.decodedLength,q))return this._logSlowResolvingAsync(V),V;Q=this._parseStack.cursorStartX,k=this._parseStack.cursorStartY,this._parseStack.paused=!1,m.length>W&&(N=this._parseStack.position+W)}if(this._logService.logLevel<=$.LogLevelEnum.DEBUG&&this._logService.debug("parsing data"+(typeof m=="string"?` "${m}"`:` "${Array.prototype.map.call(m,(u)=>String.fromCharCode(u)).join("")}"`),typeof m=="string"?m.split("").map((u)=>u.charCodeAt(0)):m),this._parseBuffer.length<m.length&&this._parseBuffer.length<W&&(this._parseBuffer=new Uint32Array(Math.min(m.length,W))),y||this._dirtyRowTracker.clearRange(),m.length>W)for(let u=N;u<m.length;u+=W){const c=u+W<m.length?u+W:m.length,M=typeof m=="string"?this._stringDecoder.decode(m.substring(u,c),this._parseBuffer):this._utf8Decoder.decode(m.subarray(u,c),this._parseBuffer);if(V=this._parser.parse(this._parseBuffer,M))return this._preserveStack(Q,k,M,u),this._logSlowResolvingAsync(V),V}else if(!y){const u=typeof m=="string"?this._stringDecoder.decode(m,this._parseBuffer):this._utf8Decoder.decode(m,this._parseBuffer);if(V=this._parser.parse(this._parseBuffer,u))return this._preserveStack(Q,k,u,0),this._logSlowResolvingAsync(V),V}this._activeBuffer.x===Q&&this._activeBuffer.y===k||this._onCursorMove.fire(),this._onRequestRefreshRows.fire(this._dirtyRowTracker.start,this._dirtyRowTracker.end)}print(m,q,V){let Q,k;const N=this._charsetService.charset,y=this._optionsService.rawOptions.screenReaderMode,u=this._bufferService.cols,c=this._coreService.decPrivateModes.wraparound,M=this._coreService.modes.insertMode,_=this._curAttrData;let U=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._activeBuffer.x&&V-q>0&&U.getWidth(this._activeBuffer.x-1)===2&&U.setCellFromCodePoint(this._activeBuffer.x-1,0,1,_.fg,_.bg,_.extended);for(let K=q;K<V;++K){if(Q=m[K],k=this._unicodeService.wcwidth(Q),Q<127&&N){const r=N[String.fromCharCode(Q)];r&&(Q=r.charCodeAt(0))}if(y&&this._onA11yChar.fire(S.stringFromCodePoint(Q)),this._getCurrentLinkId()&&this._oscLinkService.addLineToLink(this._getCurrentLinkId(),this._activeBuffer.ybase+this._activeBuffer.y),k||!this._activeBuffer.x){if(this._activeBuffer.x+k-1>=u){if(c){for(;this._activeBuffer.x<u;)U.setCellFromCodePoint(this._activeBuffer.x++,0,1,_.fg,_.bg,_.extended);this._activeBuffer.x=0,this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData(),!0)):(this._activeBuffer.y>=this._bufferService.rows&&(this._activeBuffer.y=this._bufferService.rows-1),this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!0),U=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y)}else if(this._activeBuffer.x=u-1,k===2)continue}if(M&&(U.insertCells(this._activeBuffer.x,k,this._activeBuffer.getNullCell(_),_),U.getWidth(u-1)===2&&U.setCellFromCodePoint(u-1,C.NULL_CELL_CODE,C.NULL_CELL_WIDTH,_.fg,_.bg,_.extended)),U.setCellFromCodePoint(this._activeBuffer.x++,Q,k,_.fg,_.bg,_.extended),k>0)for(;--k;)U.setCellFromCodePoint(this._activeBuffer.x++,0,0,_.fg,_.bg,_.extended)}else U.getWidth(this._activeBuffer.x-1)?U.addCodepointToCell(this._activeBuffer.x-1,Q):U.addCodepointToCell(this._activeBuffer.x-2,Q)}V-q>0&&(U.loadCell(this._activeBuffer.x-1,this._workCell),this._workCell.getWidth()===2||this._workCell.getCode()>65535?this._parser.precedingCodepoint=0:this._workCell.isCombined()?this._parser.precedingCodepoint=this._workCell.getChars().charCodeAt(0):this._parser.precedingCodepoint=this._workCell.content),this._activeBuffer.x<u&&V-q>0&&U.getWidth(this._activeBuffer.x)===0&&!U.hasContent(this._activeBuffer.x)&&U.setCellFromCodePoint(this._activeBuffer.x,0,1,_.fg,_.bg,_.extended),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}registerCsiHandler(m,q){return m.final!=="t"||m.prefix||m.intermediates?this._parser.registerCsiHandler(m,q):this._parser.registerCsiHandler(m,(V)=>!B(V.params[0],this._optionsService.rawOptions.windowOptions)||q(V))}registerDcsHandler(m,q){return this._parser.registerDcsHandler(m,new O.DcsHandler(q))}registerEscHandler(m,q){return this._parser.registerEscHandler(m,q)}registerOscHandler(m,q){return this._parser.registerOscHandler(m,new F.OscHandler(q))}bell(){return this._onRequestBell.fire(),!0}lineFeed(){return this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._optionsService.rawOptions.convertEol&&(this._activeBuffer.x=0),this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData())):this._activeBuffer.y>=this._bufferService.rows?this._activeBuffer.y=this._bufferService.rows-1:this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!1,this._activeBuffer.x>=this._bufferService.cols&&this._activeBuffer.x--,this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._onLineFeed.fire(),!0}carriageReturn(){return this._activeBuffer.x=0,!0}backspace(){var m;if(!this._coreService.decPrivateModes.reverseWraparound)return this._restrictCursor(),this._activeBuffer.x>0&&this._activeBuffer.x--,!0;if(this._restrictCursor(this._bufferService.cols),this._activeBuffer.x>0)this._activeBuffer.x--;else if(this._activeBuffer.x===0&&this._activeBuffer.y>this._activeBuffer.scrollTop&&this._activeBuffer.y<=this._activeBuffer.scrollBottom&&((m=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y))===null||m===void 0?void 0:m.isWrapped)){this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!1,this._activeBuffer.y--,this._activeBuffer.x=this._bufferService.cols-1;const q=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);q.hasWidth(this._activeBuffer.x)&&!q.hasContent(this._activeBuffer.x)&&this._activeBuffer.x--}return this._restrictCursor(),!0}tab(){if(this._activeBuffer.x>=this._bufferService.cols)return!0;const m=this._activeBuffer.x;return this._activeBuffer.x=this._activeBuffer.nextStop(),this._optionsService.rawOptions.screenReaderMode&&this._onA11yTab.fire(this._activeBuffer.x-m),!0}shiftOut(){return this._charsetService.setgLevel(1),!0}shiftIn(){return this._charsetService.setgLevel(0),!0}_restrictCursor(m=this._bufferService.cols-1){this._activeBuffer.x=Math.min(m,Math.max(0,this._activeBuffer.x)),this._activeBuffer.y=this._coreService.decPrivateModes.origin?Math.min(this._activeBuffer.scrollBottom,Math.max(this._activeBuffer.scrollTop,this._activeBuffer.y)):Math.min(this._bufferService.rows-1,Math.max(0,this._activeBuffer.y)),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}_setCursor(m,q){this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._coreService.decPrivateModes.origin?(this._activeBuffer.x=m,this._activeBuffer.y=this._activeBuffer.scrollTop+q):(this._activeBuffer.x=m,this._activeBuffer.y=q),this._restrictCursor(),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}_moveCursor(m,q){this._restrictCursor(),this._setCursor(this._activeBuffer.x+m,this._activeBuffer.y+q)}cursorUp(m){const q=this._activeBuffer.y-this._activeBuffer.scrollTop;return q>=0?this._moveCursor(0,-Math.min(q,m.params[0]||1)):this._moveCursor(0,-(m.params[0]||1)),!0}cursorDown(m){const q=this._activeBuffer.scrollBottom-this._activeBuffer.y;return q>=0?this._moveCursor(0,Math.min(q,m.params[0]||1)):this._moveCursor(0,m.params[0]||1),!0}cursorForward(m){return this._moveCursor(m.params[0]||1,0),!0}cursorBackward(m){return this._moveCursor(-(m.params[0]||1),0),!0}cursorNextLine(m){return this.cursorDown(m),this._activeBuffer.x=0,!0}cursorPrecedingLine(m){return this.cursorUp(m),this._activeBuffer.x=0,!0}cursorCharAbsolute(m){return this._setCursor((m.params[0]||1)-1,this._activeBuffer.y),!0}cursorPosition(m){return this._setCursor(m.length>=2?(m.params[1]||1)-1:0,(m.params[0]||1)-1),!0}charPosAbsolute(m){return this._setCursor((m.params[0]||1)-1,this._activeBuffer.y),!0}hPositionRelative(m){return this._moveCursor(m.params[0]||1,0),!0}linePosAbsolute(m){return this._setCursor(this._activeBuffer.x,(m.params[0]||1)-1),!0}vPositionRelative(m){return this._moveCursor(0,m.params[0]||1),!0}hVPosition(m){return this.cursorPosition(m),!0}tabClear(m){const q=m.params[0];return q===0?delete this._activeBuffer.tabs[this._activeBuffer.x]:q===3&&(this._activeBuffer.tabs={}),!0}cursorForwardTab(m){if(this._activeBuffer.x>=this._bufferService.cols)return!0;let q=m.params[0]||1;for(;q--;)this._activeBuffer.x=this._activeBuffer.nextStop();return!0}cursorBackwardTab(m){if(this._activeBuffer.x>=this._bufferService.cols)return!0;let q=m.params[0]||1;for(;q--;)this._activeBuffer.x=this._activeBuffer.prevStop();return!0}selectProtected(m){const q=m.params[0];return q===1&&(this._curAttrData.bg|=536870912),q!==2&&q!==0||(this._curAttrData.bg&=-536870913),!0}_eraseInBufferLine(m,q,V,Q=!1,k=!1){const N=this._activeBuffer.lines.get(this._activeBuffer.ybase+m);N.replaceCells(q,V,this._activeBuffer.getNullCell(this._eraseAttrData()),this._eraseAttrData(),k),Q&&(N.isWrapped=!1)}_resetBufferLine(m,q=!1){const V=this._activeBuffer.lines.get(this._activeBuffer.ybase+m);V&&(V.fill(this._activeBuffer.getNullCell(this._eraseAttrData()),q),this._bufferService.buffer.clearMarkers(this._activeBuffer.ybase+m),V.isWrapped=!1)}eraseInDisplay(m,q=!1){let V;switch(this._restrictCursor(this._bufferService.cols),m.params[0]){case 0:for(V=this._activeBuffer.y,this._dirtyRowTracker.markDirty(V),this._eraseInBufferLine(V++,this._activeBuffer.x,this._bufferService.cols,this._activeBuffer.x===0,q);V<this._bufferService.rows;V++)this._resetBufferLine(V,q);this._dirtyRowTracker.markDirty(V);break;case 1:for(V=this._activeBuffer.y,this._dirtyRowTracker.markDirty(V),this._eraseInBufferLine(V,0,this._activeBuffer.x+1,!0,q),this._activeBuffer.x+1>=this._bufferService.cols&&(this._activeBuffer.lines.get(V+1).isWrapped=!1);V--;)this._resetBufferLine(V,q);this._dirtyRowTracker.markDirty(0);break;case 2:for(V=this._bufferService.rows,this._dirtyRowTracker.markDirty(V-1);V--;)this._resetBufferLine(V,q);this._dirtyRowTracker.markDirty(0);break;case 3:const Q=this._activeBuffer.lines.length-this._bufferService.rows;Q>0&&(this._activeBuffer.lines.trimStart(Q),this._activeBuffer.ybase=Math.max(this._activeBuffer.ybase-Q,0),this._activeBuffer.ydisp=Math.max(this._activeBuffer.ydisp-Q,0),this._onScroll.fire(0))}return!0}eraseInLine(m,q=!1){switch(this._restrictCursor(this._bufferService.cols),m.params[0]){case 0:this._eraseInBufferLine(this._activeBuffer.y,this._activeBuffer.x,this._bufferService.cols,this._activeBuffer.x===0,q);break;case 1:this._eraseInBufferLine(this._activeBuffer.y,0,this._activeBuffer.x+1,!1,q);break;case 2:this._eraseInBufferLine(this._activeBuffer.y,0,this._bufferService.cols,!0,q)}return this._dirtyRowTracker.markDirty(this._activeBuffer.y),!0}insertLines(m){this._restrictCursor();let q=m.params[0]||1;if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const V=this._activeBuffer.ybase+this._activeBuffer.y,Q=this._bufferService.rows-1-this._activeBuffer.scrollBottom,k=this._bufferService.rows-1+this._activeBuffer.ybase-Q+1;for(;q--;)this._activeBuffer.lines.splice(k-1,1),this._activeBuffer.lines.splice(V,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.y,this._activeBuffer.scrollBottom),this._activeBuffer.x=0,!0}deleteLines(m){this._restrictCursor();let q=m.params[0]||1;if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const V=this._activeBuffer.ybase+this._activeBuffer.y;let Q;for(Q=this._bufferService.rows-1-this._activeBuffer.scrollBottom,Q=this._bufferService.rows-1+this._activeBuffer.ybase-Q;q--;)this._activeBuffer.lines.splice(V,1),this._activeBuffer.lines.splice(Q,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.y,this._activeBuffer.scrollBottom),this._activeBuffer.x=0,!0}insertChars(m){this._restrictCursor();const q=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return q&&(q.insertCells(this._activeBuffer.x,m.params[0]||1,this._activeBuffer.getNullCell(this._eraseAttrData()),this._eraseAttrData()),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}deleteChars(m){this._restrictCursor();const q=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return q&&(q.deleteCells(this._activeBuffer.x,m.params[0]||1,this._activeBuffer.getNullCell(this._eraseAttrData()),this._eraseAttrData()),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}scrollUp(m){let q=m.params[0]||1;for(;q--;)this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollTop,1),this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollBottom,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}scrollDown(m){let q=m.params[0]||1;for(;q--;)this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollBottom,1),this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollTop,0,this._activeBuffer.getBlankLine(g.DEFAULT_ATTR_DATA));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}scrollLeft(m){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const q=m.params[0]||1;for(let V=this._activeBuffer.scrollTop;V<=this._activeBuffer.scrollBottom;++V){const Q=this._activeBuffer.lines.get(this._activeBuffer.ybase+V);Q.deleteCells(0,q,this._activeBuffer.getNullCell(this._eraseAttrData()),this._eraseAttrData()),Q.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}scrollRight(m){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const q=m.params[0]||1;for(let V=this._activeBuffer.scrollTop;V<=this._activeBuffer.scrollBottom;++V){const Q=this._activeBuffer.lines.get(this._activeBuffer.ybase+V);Q.insertCells(0,q,this._activeBuffer.getNullCell(this._eraseAttrData()),this._eraseAttrData()),Q.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}insertColumns(m){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const q=m.params[0]||1;for(let V=this._activeBuffer.scrollTop;V<=this._activeBuffer.scrollBottom;++V){const Q=this._activeBuffer.lines.get(this._activeBuffer.ybase+V);Q.insertCells(this._activeBuffer.x,q,this._activeBuffer.getNullCell(this._eraseAttrData()),this._eraseAttrData()),Q.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}deleteColumns(m){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const q=m.params[0]||1;for(let V=this._activeBuffer.scrollTop;V<=this._activeBuffer.scrollBottom;++V){const Q=this._activeBuffer.lines.get(this._activeBuffer.ybase+V);Q.deleteCells(this._activeBuffer.x,q,this._activeBuffer.getNullCell(this._eraseAttrData()),this._eraseAttrData()),Q.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}eraseChars(m){this._restrictCursor();const q=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return q&&(q.replaceCells(this._activeBuffer.x,this._activeBuffer.x+(m.params[0]||1),this._activeBuffer.getNullCell(this._eraseAttrData()),this._eraseAttrData()),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}repeatPrecedingCharacter(m){if(!this._parser.precedingCodepoint)return!0;const q=m.params[0]||1,V=new Uint32Array(q);for(let Q=0;Q<q;++Q)V[Q]=this._parser.precedingCodepoint;return this.print(V,0,V.length),!0}sendDeviceAttributesPrimary(m){return m.params[0]>0||(this._is("xterm")||this._is("rxvt-unicode")||this._is("screen")?this._coreService.triggerDataEvent(E.C0.ESC+"[?1;2c"):this._is("linux")&&this._coreService.triggerDataEvent(E.C0.ESC+"[?6c")),!0}sendDeviceAttributesSecondary(m){return m.params[0]>0||(this._is("xterm")?this._coreService.triggerDataEvent(E.C0.ESC+"[>0;276;0c"):this._is("rxvt-unicode")?this._coreService.triggerDataEvent(E.C0.ESC+"[>85;95;0c"):this._is("linux")?this._coreService.triggerDataEvent(m.params[0]+"c"):this._is("screen")&&this._coreService.triggerDataEvent(E.C0.ESC+"[>83;40003;0c")),!0}_is(m){return(this._optionsService.rawOptions.termName+"").indexOf(m)===0}setMode(m){for(let q=0;q<m.length;q++)switch(m.params[q]){case 4:this._coreService.modes.insertMode=!0;break;case 20:this._optionsService.options.convertEol=!0}return!0}setModePrivate(m){for(let q=0;q<m.length;q++)switch(m.params[q]){case 1:this._coreService.decPrivateModes.applicationCursorKeys=!0;break;case 2:this._charsetService.setgCharset(0,h.DEFAULT_CHARSET),this._charsetService.setgCharset(1,h.DEFAULT_CHARSET),this._charsetService.setgCharset(2,h.DEFAULT_CHARSET),this._charsetService.setgCharset(3,h.DEFAULT_CHARSET);break;case 3:this._optionsService.rawOptions.windowOptions.setWinLines&&(this._bufferService.resize(132,this._bufferService.rows),this._onRequestReset.fire());break;case 6:this._coreService.decPrivateModes.origin=!0,this._setCursor(0,0);break;case 7:this._coreService.decPrivateModes.wraparound=!0;break;case 12:this._optionsService.options.cursorBlink=!0;break;case 45:this._coreService.decPrivateModes.reverseWraparound=!0;break;case 66:this._logService.debug("Serial port requested application keypad."),this._coreService.decPrivateModes.applicationKeypad=!0,this._onRequestSyncScrollBar.fire();break;case 9:this._coreMouseService.activeProtocol="X10";break;case 1000:this._coreMouseService.activeProtocol="VT200";break;case 1002:this._coreMouseService.activeProtocol="DRAG";break;case 1003:this._coreMouseService.activeProtocol="ANY";break;case 1004:this._coreService.decPrivateModes.sendFocus=!0,this._onRequestSendFocus.fire();break;case 1005:this._logService.debug("DECSET 1005 not supported (see #2507)");break;case 1006:this._coreMouseService.activeEncoding="SGR";break;case 1015:this._logService.debug("DECSET 1015 not supported (see #2507)");break;case 1016:this._coreMouseService.activeEncoding="SGR_PIXELS";break;case 25:this._coreService.isCursorHidden=!1;break;case 1048:this.saveCursor();break;case 1049:this.saveCursor();case 47:case 1047:this._bufferService.buffers.activateAltBuffer(this._eraseAttrData()),this._coreService.isCursorInitialized=!0,this._onRequestRefreshRows.fire(0,this._bufferService.rows-1),this._onRequestSyncScrollBar.fire();break;case 2004:this._coreService.decPrivateModes.bracketedPasteMode=!0}return!0}resetMode(m){for(let q=0;q<m.length;q++)switch(m.params[q]){case 4:this._coreService.modes.insertMode=!1;break;case 20:this._optionsService.options.convertEol=!1}return!0}resetModePrivate(m){for(let q=0;q<m.length;q++)switch(m.params[q]){case 1:this._coreService.decPrivateModes.applicationCursorKeys=!1;break;case 3:this._optionsService.rawOptions.windowOptions.setWinLines&&(this._bufferService.resize(80,this._bufferService.rows),this._onRequestReset.fire());break;case 6:this._coreService.decPrivateModes.origin=!1,this._setCursor(0,0);break;case 7:this._coreService.decPrivateModes.wraparound=!1;break;case 12:this._optionsService.options.cursorBlink=!1;break;case 45:this._coreService.decPrivateModes.reverseWraparound=!1;break;case 66:this._logService.debug("Switching back to normal keypad."),this._coreService.decPrivateModes.applicationKeypad=!1,this._onRequestSyncScrollBar.fire();break;case 9:case 1000:case 1002:case 1003:this._coreMouseService.activeProtocol="NONE";break;case 1004:this._coreService.decPrivateModes.sendFocus=!1;break;case 1005:this._logService.debug("DECRST 1005 not supported (see #2507)");break;case 1006:case 1016:this._coreMouseService.activeEncoding="DEFAULT";break;case 1015:this._logService.debug("DECRST 1015 not supported (see #2507)");break;case 25:this._coreService.isCursorHidden=!0;break;case 1048:this.restoreCursor();break;case 1049:case 47:case 1047:this._bufferService.buffers.activateNormalBuffer(),m.params[q]===1049&&this.restoreCursor(),this._coreService.isCursorInitialized=!0,this._onRequestRefreshRows.fire(0,this._bufferService.rows-1),this._onRequestSyncScrollBar.fire();break;case 2004:this._coreService.decPrivateModes.bracketedPasteMode=!1}return!0}requestMode(m,q){const V=this._coreService.decPrivateModes,{activeProtocol:Q,activeEncoding:k}=this._coreMouseService,N=this._coreService,{buffers:y,cols:u}=this._bufferService,{active:c,alt:M}=y,_=this._optionsService.rawOptions,U=(v0)=>v0?1:2,K=m.params[0];return r=K,z=q?K===2?4:K===4?U(N.modes.insertMode):K===12?3:K===20?U(_.convertEol):0:K===1?U(V.applicationCursorKeys):K===3?_.windowOptions.setWinLines?u===80?2:u===132?1:0:0:K===6?U(V.origin):K===7?U(V.wraparound):K===8?3:K===9?U(Q==="X10"):K===12?U(_.cursorBlink):K===25?U(!N.isCursorHidden):K===45?U(V.reverseWraparound):K===66?U(V.applicationKeypad):K===67?4:K===1000?U(Q==="VT200"):K===1002?U(Q==="DRAG"):K===1003?U(Q==="ANY"):K===1004?U(V.sendFocus):K===1005?4:K===1006?U(k==="SGR"):K===1015?4:K===1016?U(k==="SGR_PIXELS"):K===1048?1:K===47||K===1047||K===1049?U(c===M):K===2004?U(V.bracketedPasteMode):0,N.triggerDataEvent(`${E.C0.ESC}[${q?"":"?"}${r};${z}\$y`),!0;var r,z}_updateAttrColor(m,q,V,Q,k){return q===2?(m|=50331648,m&=-16777216,m|=p.AttributeData.fromColorRGB([V,Q,k])):q===5&&(m&=-50331904,m|=33554432|255&V),m}_extractColor(m,q,V){const Q=[0,0,-1,0,0,0];let k=0,N=0;do{if(Q[N+k]=m.params[q+N],m.hasSubParams(q+N)){const y=m.getSubParams(q+N);let u=0;do Q[1]===5&&(k=1),Q[N+u+1+k]=y[u];while(++u<y.length&&u+N+1+k<Q.length);break}if(Q[1]===5&&N+k>=2||Q[1]===2&&N+k>=5)break;Q[1]&&(k=1)}while(++N+q<m.length&&N+k<Q.length);for(let y=2;y<Q.length;++y)Q[y]===-1&&(Q[y]=0);switch(Q[0]){case 38:V.fg=this._updateAttrColor(V.fg,Q[1],Q[3],Q[4],Q[5]);break;case 48:V.bg=this._updateAttrColor(V.bg,Q[1],Q[3],Q[4],Q[5]);break;case 58:V.extended=V.extended.clone(),V.extended.underlineColor=this._updateAttrColor(V.extended.underlineColor,Q[1],Q[3],Q[4],Q[5])}return N}_processUnderline(m,q){q.extended=q.extended.clone(),(!~m||m>5)&&(m=1),q.extended.underlineStyle=m,q.fg|=268435456,m===0&&(q.fg&=-268435457),q.updateExtended()}_processSGR0(m){m.fg=g.DEFAULT_ATTR_DATA.fg,m.bg=g.DEFAULT_ATTR_DATA.bg,m.extended=m.extended.clone(),m.extended.underlineStyle=0,m.extended.underlineColor&=-67108864,m.updateExtended()}charAttributes(m){if(m.length===1&&m.params[0]===0)return this._processSGR0(this._curAttrData),!0;const q=m.length;let V;const Q=this._curAttrData;for(let k=0;k<q;k++)V=m.params[k],V>=30&&V<=37?(Q.fg&=-50331904,Q.fg|=16777216|V-30):V>=40&&V<=47?(Q.bg&=-50331904,Q.bg|=16777216|V-40):V>=90&&V<=97?(Q.fg&=-50331904,Q.fg|=16777224|V-90):V>=100&&V<=107?(Q.bg&=-50331904,Q.bg|=16777224|V-100):V===0?this._processSGR0(Q):V===1?Q.fg|=134217728:V===3?Q.bg|=67108864:V===4?(Q.fg|=268435456,this._processUnderline(m.hasSubParams(k)?m.getSubParams(k)[0]:1,Q)):V===5?Q.fg|=536870912:V===7?Q.fg|=67108864:V===8?Q.fg|=1073741824:V===9?Q.fg|=2147483648:V===2?Q.bg|=134217728:V===21?this._processUnderline(2,Q):V===22?(Q.fg&=-134217729,Q.bg&=-134217729):V===23?Q.bg&=-67108865:V===24?(Q.fg&=-268435457,this._processUnderline(0,Q)):V===25?Q.fg&=-536870913:V===27?Q.fg&=-67108865:V===28?Q.fg&=-1073741825:V===29?Q.fg&=2147483647:V===39?(Q.fg&=-67108864,Q.fg|=16777215&g.DEFAULT_ATTR_DATA.fg):V===49?(Q.bg&=-67108864,Q.bg|=16777215&g.DEFAULT_ATTR_DATA.bg):V===38||V===48||V===58?k+=this._extractColor(m,k,Q):V===53?Q.bg|=1073741824:V===55?Q.bg&=-1073741825:V===59?(Q.extended=Q.extended.clone(),Q.extended.underlineColor=-1,Q.updateExtended()):V===100?(Q.fg&=-67108864,Q.fg|=16777215&g.DEFAULT_ATTR_DATA.fg,Q.bg&=-67108864,Q.bg|=16777215&g.DEFAULT_ATTR_DATA.bg):this._logService.debug("Unknown SGR attribute: %d.",V);return!0}deviceStatus(m){switch(m.params[0]){case 5:this._coreService.triggerDataEvent(`${E.C0.ESC}[0n`);break;case 6:const q=this._activeBuffer.y+1,V=this._activeBuffer.x+1;this._coreService.triggerDataEvent(`${E.C0.ESC}[${q};${V}R`)}return!0}deviceStatusPrivate(m){if(m.params[0]===6){const q=this._activeBuffer.y+1,V=this._activeBuffer.x+1;this._coreService.triggerDataEvent(`${E.C0.ESC}[?${q};${V}R`)}return!0}softReset(m){return this._coreService.isCursorHidden=!1,this._onRequestSyncScrollBar.fire(),this._activeBuffer.scrollTop=0,this._activeBuffer.scrollBottom=this._bufferService.rows-1,this._curAttrData=g.DEFAULT_ATTR_DATA.clone(),this._coreService.reset(),this._charsetService.reset(),this._activeBuffer.savedX=0,this._activeBuffer.savedY=this._activeBuffer.ybase,this._activeBuffer.savedCurAttrData.fg=this._curAttrData.fg,this._activeBuffer.savedCurAttrData.bg=this._curAttrData.bg,this._activeBuffer.savedCharset=this._charsetService.charset,this._coreService.decPrivateModes.origin=!1,!0}setCursorStyle(m){const q=m.params[0]||1;switch(q){case 1:case 2:this._optionsService.options.cursorStyle="block";break;case 3:case 4:this._optionsService.options.cursorStyle="underline";break;case 5:case 6:this._optionsService.options.cursorStyle="bar"}const V=q%2==1;return this._optionsService.options.cursorBlink=V,!0}setScrollRegion(m){const q=m.params[0]||1;let V;return(m.length<2||(V=m.params[1])>this._bufferService.rows||V===0)&&(V=this._bufferService.rows),V>q&&(this._activeBuffer.scrollTop=q-1,this._activeBuffer.scrollBottom=V-1,this._setCursor(0,0)),!0}windowOptions(m){if(!B(m.params[0],this._optionsService.rawOptions.windowOptions))return!0;const q=m.length>1?m.params[1]:0;switch(m.params[0]){case 14:q!==2&&this._onRequestWindowsOptionsReport.fire(Y.GET_WIN_SIZE_PIXELS);break;case 16:this._onRequestWindowsOptionsReport.fire(Y.GET_CELL_SIZE_PIXELS);break;case 18:this._bufferService&&this._coreService.triggerDataEvent(`${E.C0.ESC}[8;${this._bufferService.rows};${this._bufferService.cols}t`);break;case 22:q!==0&&q!==2||(this._windowTitleStack.push(this._windowTitle),this._windowTitleStack.length>10&&this._windowTitleStack.shift()),q!==0&&q!==1||(this._iconNameStack.push(this._iconName),this._iconNameStack.length>10&&this._iconNameStack.shift());break;case 23:q!==0&&q!==2||this._windowTitleStack.length&&this.setTitle(this._windowTitleStack.pop()),q!==0&&q!==1||this._iconNameStack.length&&this.setIconName(this._iconNameStack.pop())}return!0}saveCursor(m){return this._activeBuffer.savedX=this._activeBuffer.x,this._activeBuffer.savedY=this._activeBuffer.ybase+this._activeBuffer.y,this._activeBuffer.savedCurAttrData.fg=this._curAttrData.fg,this._activeBuffer.savedCurAttrData.bg=this._curAttrData.bg,this._activeBuffer.savedCharset=this._charsetService.charset,!0}restoreCursor(m){return this._activeBuffer.x=this._activeBuffer.savedX||0,this._activeBuffer.y=Math.max(this._activeBuffer.savedY-this._activeBuffer.ybase,0),this._curAttrData.fg=this._activeBuffer.savedCurAttrData.fg,this._curAttrData.bg=this._activeBuffer.savedCurAttrData.bg,this._charsetService.charset=this._savedCharset,this._activeBuffer.savedCharset&&(this._charsetService.charset=this._activeBuffer.savedCharset),this._restrictCursor(),!0}setTitle(m){return this._windowTitle=m,this._onTitleChange.fire(m),!0}setIconName(m){return this._iconName=m,!0}setOrReportIndexedColor(m){const q=[],V=m.split(";");for(;V.length>1;){const Q=V.shift(),k=V.shift();if(/^\d+$/.exec(Q)){const N=parseInt(Q);if(X(N))if(k==="?")q.push({type:0,index:N});else{const y=L.parseColor(k);y&&q.push({type:1,index:N,color:y})}}}return q.length&&this._onColor.fire(q),!0}setHyperlink(m){const q=m.split(";");return!(q.length<2)&&(q[1]?this._createHyperlink(q[0],q[1]):!q[0]&&this._finishHyperlink())}_createHyperlink(m,q){this._getCurrentLinkId()&&this._finishHyperlink();const V=m.split(":");let Q;const k=V.findIndex((N)=>N.startsWith("id="));return k!==-1&&(Q=V[k].slice(3)||void 0),this._curAttrData.extended=this._curAttrData.extended.clone(),this._curAttrData.extended.urlId=this._oscLinkService.registerLink({id:Q,uri:q}),this._curAttrData.updateExtended(),!0}_finishHyperlink(){return this._curAttrData.extended=this._curAttrData.extended.clone(),this._curAttrData.extended.urlId=0,this._curAttrData.updateExtended(),!0}_setOrReportSpecialColor(m,q){const V=m.split(";");for(let Q=0;Q<V.length&&!(q>=this._specialColors.length);++Q,++q)if(V[Q]==="?")this._onColor.fire([{type:0,index:this._specialColors[q]}]);else{const k=L.parseColor(V[Q]);k&&this._onColor.fire([{type:1,index:this._specialColors[q],color:k}])}return!0}setOrReportFgColor(m){return this._setOrReportSpecialColor(m,0)}setOrReportBgColor(m){return this._setOrReportSpecialColor(m,1)}setOrReportCursorColor(m){return this._setOrReportSpecialColor(m,2)}restoreIndexedColor(m){if(!m)return this._onColor.fire([{type:2}]),!0;const q=[],V=m.split(";");for(let Q=0;Q<V.length;++Q)if(/^\d+$/.exec(V[Q])){const k=parseInt(V[Q]);X(k)&&q.push({type:2,index:k})}return q.length&&this._onColor.fire(q),!0}restoreFgColor(m){return this._onColor.fire([{type:2,index:256}]),!0}restoreBgColor(m){return this._onColor.fire([{type:2,index:257}]),!0}restoreCursorColor(m){return this._onColor.fire([{type:2,index:258}]),!0}nextLine(){return this._activeBuffer.x=0,this.index(),!0}keypadApplicationMode(){return this._logService.debug("Serial port requested application keypad."),this._coreService.decPrivateModes.applicationKeypad=!0,this._onRequestSyncScrollBar.fire(),!0}keypadNumericMode(){return this._logService.debug("Switching back to normal keypad."),this._coreService.decPrivateModes.applicationKeypad=!1,this._onRequestSyncScrollBar.fire(),!0}selectDefaultCharset(){return this._charsetService.setgLevel(0),this._charsetService.setgCharset(0,h.DEFAULT_CHARSET),!0}selectCharset(m){return m.length!==2?(this.selectDefaultCharset(),!0):(m[0]==="/"||this._charsetService.setgCharset(Z[m[0]],h.CHARSETS[m[1]]||h.DEFAULT_CHARSET),!0)}index(){return this._restrictCursor(),this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData())):this._activeBuffer.y>=this._bufferService.rows&&(this._activeBuffer.y=this._bufferService.rows-1),this._restrictCursor(),!0}tabSet(){return this._activeBuffer.tabs[this._activeBuffer.x]=!0,!0}reverseIndex(){if(this._restrictCursor(),this._activeBuffer.y===this._activeBuffer.scrollTop){const m=this._activeBuffer.scrollBottom-this._activeBuffer.scrollTop;this._activeBuffer.lines.shiftElements(this._activeBuffer.ybase+this._activeBuffer.y,m,1),this._activeBuffer.lines.set(this._activeBuffer.ybase+this._activeBuffer.y,this._activeBuffer.getBlankLine(this._eraseAttrData())),this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom)}else this._activeBuffer.y--,this._restrictCursor();return!0}fullReset(){return this._parser.reset(),this._onRequestReset.fire(),!0}reset(){this._curAttrData=g.DEFAULT_ATTR_DATA.clone(),this._eraseAttrDataInternal=g.DEFAULT_ATTR_DATA.clone()}_eraseAttrData(){return this._eraseAttrDataInternal.bg&=-67108864,this._eraseAttrDataInternal.bg|=67108863&this._curAttrData.bg,this._eraseAttrDataInternal}setgLevel(m){return this._charsetService.setgLevel(m),!0}screenAlignmentPattern(){const m=new R.CellData;m.content=1<<22|"E".charCodeAt(0),m.fg=this._curAttrData.fg,m.bg=this._curAttrData.bg,this._setCursor(0,0);for(let q=0;q<this._bufferService.rows;++q){const V=this._activeBuffer.ybase+this._activeBuffer.y+q,Q=this._activeBuffer.lines.get(V);Q&&(Q.fill(m),Q.isWrapped=!1)}return this._dirtyRowTracker.markAllDirty(),this._setCursor(0,0),!0}requestStatusString(m,q){const V=this._bufferService.buffer,Q=this._optionsService.rawOptions;return((k)=>(this._coreService.triggerDataEvent(`${E.C0.ESC}${k}${E.C0.ESC}\\`),!0))(m==='"q'?`P1\$r${this._curAttrData.isProtected()?1:0}"q`:m==='"p'?'P1$r61;1"p':m==="r"?`P1\$r${V.scrollTop+1};${V.scrollBottom+1}r`:m==="m"?"P1$r0m":m===" q"?`P1\$r${{block:2,underline:4,bar:6}[Q.cursorStyle]-(Q.cursorBlink?1:0)} q`:"P0$r")}markRangeDirty(m,q){this._dirtyRowTracker.markRangeDirty(m,q)}}v.InputHandler=T;let J=class{constructor(m){this._bufferService=m,this.clearRange()}clearRange(){this.start=this._bufferService.buffer.y,this.end=this._bufferService.buffer.y}markDirty(m){m<this.start?this.start=m:m>this.end&&(this.end=m)}markRangeDirty(m,q){m>q&&(G=m,m=q,q=G),m<this.start&&(this.start=m),q>this.end&&(this.end=q)}markAllDirty(){this.markRangeDirty(0,this._bufferService.rows-1)}};function X(m){return 0<=m&&m<256}J=A([H(0,$.IBufferService)],J)},844:(P,v)=>{function b(A){for(let H of A)H.dispose();A.length=0}Object.defineProperty(v,"__esModule",{value:!0}),v.getDisposeArrayDisposable=v.disposeArray=v.toDisposable=v.MutableDisposable=v.Disposable=void 0,v.Disposable=class{constructor(){this._disposables=[],this._isDisposed=!1}dispose(){this._isDisposed=!0;for(let A of this._disposables)A.dispose();this._disposables.length=0}register(A){return this._disposables.push(A),A}unregister(A){const H=this._disposables.indexOf(A);H!==-1&&this._disposables.splice(H,1)}},v.MutableDisposable=class{constructor(){this._isDisposed=!1}get value(){return this._isDisposed?void 0:this._value}set value(A){var H;this._isDisposed||A===this._value||((H=this._value)===null||H===void 0||H.dispose(),this._value=A)}clear(){this.value=void 0}dispose(){var A;this._isDisposed=!0,(A=this._value)===null||A===void 0||A.dispose(),this._value=void 0}},v.toDisposable=function(A){return{dispose:A}},v.disposeArray=b,v.getDisposeArrayDisposable=function(A){return{dispose:()=>b(A)}}},1505:(P,v)=>{Object.defineProperty(v,"__esModule",{value:!0}),v.FourKeyMap=v.TwoKeyMap=void 0;class b{constructor(){this._data={}}set(A,H,E){this._data[A]||(this._data[A]={}),this._data[A][H]=E}get(A,H){return this._data[A]?this._data[A][H]:void 0}clear(){this._data={}}}v.TwoKeyMap=b,v.FourKeyMap=class{constructor(){this._data=new b}set(A,H,E,h,D){this._data.get(A,H)||this._data.set(A,H,new b),this._data.get(A,H).set(E,h,D)}get(A,H,E,h){var D;return(D=this._data.get(A,H))===null||D===void 0?void 0:D.get(E,h)}clear(){this._data.clear()}}},6114:(P,v)=>{Object.defineProperty(v,"__esModule",{value:!0}),v.isChromeOS=v.isLinux=v.isWindows=v.isIphone=v.isIpad=v.isMac=v.getSafariVersion=v.isSafari=v.isLegacyEdge=v.isFirefox=v.isNode=void 0,v.isNode=typeof navigator=="undefined";const b=v.isNode?"node":navigator.userAgent,A=v.isNode?"node":navigator.platform;v.isFirefox=b.includes("Firefox"),v.isLegacyEdge=b.includes("Edge"),v.isSafari=/^((?!chrome|android).)*safari/i.test(b),v.getSafariVersion=function(){if(!v.isSafari)return 0;const H=b.match(/Version\/(\d+)/);return H===null||H.length<2?0:parseInt(H[1])},v.isMac=["Macintosh","MacIntel","MacPPC","Mac68K"].includes(A),v.isIpad=A==="iPad",v.isIphone=A==="iPhone",v.isWindows=["Windows","Win16","Win32","WinCE"].includes(A),v.isLinux=A.indexOf("Linux")>=0,v.isChromeOS=/\bCrOS\b/.test(b)},6106:(P,v)=>{Object.defineProperty(v,"__esModule",{value:!0}),v.SortedList=void 0;let b=0;v.SortedList=class{constructor(A){this._getKey=A,this._array=[]}clear(){this._array.length=0}insert(A){this._array.length!==0?(b=this._search(this._getKey(A)),this._array.splice(b,0,A)):this._array.push(A)}delete(A){if(this._array.length===0)return!1;const H=this._getKey(A);if(H===void 0)return!1;if(b=this._search(H),b===-1)return!1;if(this._getKey(this._array[b])!==H)return!1;do if(this._array[b]===A)return this._array.splice(b,1),!0;while(++b<this._array.length&&this._getKey(this._array[b])===H);return!1}*getKeyIterator(A){if(this._array.length!==0&&(b=this._search(A),!(b<0||b>=this._array.length)&&this._getKey(this._array[b])===A))do yield this._array[b];while(++b<this._array.length&&this._getKey(this._array[b])===A)}forEachByKey(A,H){if(this._array.length!==0&&(b=this._search(A),!(b<0||b>=this._array.length)&&this._getKey(this._array[b])===A))do H(this._array[b]);while(++b<this._array.length&&this._getKey(this._array[b])===A)}values(){return[...this._array].values()}_search(A){let H=0,E=this._array.length-1;for(;E>=H;){let h=H+E>>1;const D=this._getKey(this._array[h]);if(D>A)E=h-1;else{if(!(D<A)){for(;h>0&&this._getKey(this._array[h-1])===A;)h--;return h}H=h+1}}return H}}},7226:(P,v,b)=>{Object.defineProperty(v,"__esModule",{value:!0}),v.DebouncedIdleTask=v.IdleTaskQueue=v.PriorityTaskQueue=void 0;const A=b(6114);class H{constructor(){this._tasks=[],this._i=0}enqueue(h){this._tasks.push(h),this._start()}flush(){for(;this._i<this._tasks.length;)this._tasks[this._i]()||this._i++;this.clear()}clear(){this._idleCallback&&(this._cancelCallback(this._idleCallback),this._idleCallback=void 0),this._i=0,this._tasks.length=0}_start(){this._idleCallback||(this._idleCallback=this._requestCallback(this._process.bind(this)))}_process(h){this._idleCallback=void 0;let D=0,f=0,S=h.timeRemaining(),g=0;for(;this._i<this._tasks.length;){if(D=Date.now(),this._tasks[this._i]()||this._i++,D=Math.max(1,Date.now()-D),f=Math.max(D,f),g=h.timeRemaining(),1.5*f>g)return S-D<-20&&console.warn(`task queue exceeded allotted deadline by ${Math.abs(Math.round(S-D))}ms`),void this._start();S=g}this.clear()}}class E extends H{_requestCallback(h){return setTimeout(()=>h(this._createDeadline(16)))}_cancelCallback(h){clearTimeout(h)}_createDeadline(h){const D=Date.now()+h;return{timeRemaining:()=>Math.max(0,D-Date.now())}}}v.PriorityTaskQueue=E,v.IdleTaskQueue=!A.isNode&&"requestIdleCallback"in window?class extends H{_requestCallback(h){return requestIdleCallback(h)}_cancelCallback(h){cancelIdleCallback(h)}}:E,v.DebouncedIdleTask=class{constructor(){this._queue=new v.IdleTaskQueue}set(h){this._queue.clear(),this._queue.enqueue(h)}flush(){this._queue.flush()}}},9282:(P,v,b)=>{Object.defineProperty(v,"__esModule",{value:!0}),v.updateWindowsModeWrappedState=void 0;const A=b(643);v.updateWindowsModeWrappedState=function(H){const E=H.buffer.lines.get(H.buffer.ybase+H.buffer.y-1),h=E==null?void 0:E.get(H.cols-1),D=H.buffer.lines.get(H.buffer.ybase+H.buffer.y);D&&h&&(D.isWrapped=h[A.CHAR_DATA_CODE_INDEX]!==A.NULL_CELL_CODE&&h[A.CHAR_DATA_CODE_INDEX]!==A.WHITESPACE_CELL_CODE)}},3734:(P,v)=>{Object.defineProperty(v,"__esModule",{value:!0}),v.ExtendedAttrs=v.AttributeData=void 0;class b{constructor(){this.fg=0,this.bg=0,this.extended=new A}static toColorRGB(H){return[H>>>16&255,H>>>8&255,255&H]}static fromColorRGB(H){return(255&H[0])<<16|(255&H[1])<<8|255&H[2]}clone(){const H=new b;return H.fg=this.fg,H.bg=this.bg,H.extended=this.extended.clone(),H}isInverse(){return 67108864&this.fg}isBold(){return 134217728&this.fg}isUnderline(){return this.hasExtendedAttrs()&&this.extended.underlineStyle!==0?1:268435456&this.fg}isBlink(){return 536870912&this.fg}isInvisible(){return 1073741824&this.fg}isItalic(){return 67108864&this.bg}isDim(){return 134217728&this.bg}isStrikethrough(){return 2147483648&this.fg}isProtected(){return 536870912&this.bg}isOverline(){return 1073741824&this.bg}getFgColorMode(){return 50331648&this.fg}getBgColorMode(){return 50331648&this.bg}isFgRGB(){return(50331648&this.fg)==50331648}isBgRGB(){return(50331648&this.bg)==50331648}isFgPalette(){return(50331648&this.fg)==16777216||(50331648&this.fg)==33554432}isBgPalette(){return(50331648&this.bg)==16777216||(50331648&this.bg)==33554432}isFgDefault(){return(50331648&this.fg)==0}isBgDefault(){return(50331648&this.bg)==0}isAttributeDefault(){return this.fg===0&&this.bg===0}getFgColor(){switch(50331648&this.fg){case 16777216:case 33554432:return 255&this.fg;case 50331648:return 16777215&this.fg;default:return-1}}getBgColor(){switch(50331648&this.bg){case 16777216:case 33554432:return 255&this.bg;case 50331648:return 16777215&this.bg;default:return-1}}hasExtendedAttrs(){return 268435456&this.bg}updateExtended(){this.extended.isEmpty()?this.bg&=-268435457:this.bg|=268435456}getUnderlineColor(){if(268435456&this.bg&&~this.extended.underlineColor)switch(50331648&this.extended.underlineColor){case 16777216:case 33554432:return 255&this.extended.underlineColor;case 50331648:return 16777215&this.extended.underlineColor;default:return this.getFgColor()}return this.getFgColor()}getUnderlineColorMode(){return 268435456&this.bg&&~this.extended.underlineColor?50331648&this.extended.underlineColor:this.getFgColorMode()}isUnderlineColorRGB(){return 268435456&this.bg&&~this.extended.underlineColor?(50331648&this.extended.underlineColor)==50331648:this.isFgRGB()}isUnderlineColorPalette(){return 268435456&this.bg&&~this.extended.underlineColor?(50331648&this.extended.underlineColor)==16777216||(50331648&this.extended.underlineColor)==33554432:this.isFgPalette()}isUnderlineColorDefault(){return 268435456&this.bg&&~this.extended.underlineColor?(50331648&this.extended.underlineColor)==0:this.isFgDefault()}getUnderlineStyle(){return 268435456&this.fg?268435456&this.bg?this.extended.underlineStyle:1:0}}v.AttributeData=b;class A{get ext(){return this._urlId?-469762049&this._ext|this.underlineStyle<<26:this._ext}set ext(H){this._ext=H}get underlineStyle(){return this._urlId?5:(469762048&this._ext)>>26}set underlineStyle(H){this._ext&=-469762049,this._ext|=H<<26&469762048}get underlineColor(){return 67108863&this._ext}set underlineColor(H){this._ext&=-67108864,this._ext|=67108863&H}get urlId(){return this._urlId}set urlId(H){this._urlId=H}constructor(H=0,E=0){this._ext=0,this._urlId=0,this._ext=H,this._urlId=E}clone(){return new A(this._ext,this._urlId)}isEmpty(){return this.underlineStyle===0&&this._urlId===0}}v.ExtendedAttrs=A},9092:(P,v,b)=>{Object.defineProperty(v,"__esModule",{value:!0}),v.Buffer=v.MAX_BUFFER_SIZE=void 0;const A=b(6349),H=b(7226),E=b(3734),h=b(8437),D=b(4634),f=b(511),S=b(643),g=b(4863),w=b(7116);v.MAX_BUFFER_SIZE=4294967295,v.Buffer=class{constructor(C,R,p){this._hasScrollback=C,this._optionsService=R,this._bufferService=p,this.ydisp=0,this.ybase=0,this.y=0,this.x=0,this.tabs={},this.savedY=0,this.savedX=0,this.savedCurAttrData=h.DEFAULT_ATTR_DATA.clone(),this.savedCharset=w.DEFAULT_CHARSET,this.markers=[],this._nullCell=f.CellData.fromCharData([0,S.NULL_CELL_CHAR,S.NULL_CELL_WIDTH,S.NULL_CELL_CODE]),this._whitespaceCell=f.CellData.fromCharData([0,S.WHITESPACE_CELL_CHAR,S.WHITESPACE_CELL_WIDTH,S.WHITESPACE_CELL_CODE]),this._isClearing=!1,this._memoryCleanupQueue=new H.IdleTaskQueue,this._memoryCleanupPosition=0,this._cols=this._bufferService.cols,this._rows=this._bufferService.rows,this.lines=new A.CircularList(this._getCorrectBufferLength(this._rows)),this.scrollTop=0,this.scrollBottom=this._rows-1,this.setupTabStops()}getNullCell(C){return C?(this._nullCell.fg=C.fg,this._nullCell.bg=C.bg,this._nullCell.extended=C.extended):(this._nullCell.fg=0,this._nullCell.bg=0,this._nullCell.extended=new E.ExtendedAttrs),this._nullCell}getWhitespaceCell(C){return C?(this._whitespaceCell.fg=C.fg,this._whitespaceCell.bg=C.bg,this._whitespaceCell.extended=C.extended):(this._whitespaceCell.fg=0,this._whitespaceCell.bg=0,this._whitespaceCell.extended=new E.ExtendedAttrs),this._whitespaceCell}getBlankLine(C,R){return new h.BufferLine(this._bufferService.cols,this.getNullCell(C),R)}get hasScrollback(){return this._hasScrollback&&this.lines.maxLength>this._rows}get isCursorInViewport(){const C=this.ybase+this.y-this.ydisp;return C>=0&&C<this._rows}_getCorrectBufferLength(C){if(!this._hasScrollback)return C;const R=C+this._optionsService.rawOptions.scrollback;return R>v.MAX_BUFFER_SIZE?v.MAX_BUFFER_SIZE:R}fillViewportRows(C){if(this.lines.length===0){C===void 0&&(C=h.DEFAULT_ATTR_DATA);let R=this._rows;for(;R--;)this.lines.push(this.getBlankLine(C))}}clear(){this.ydisp=0,this.ybase=0,this.y=0,this.x=0,this.lines=new A.CircularList(this._getCorrectBufferLength(this._rows)),this.scrollTop=0,this.scrollBottom=this._rows-1,this.setupTabStops()}resize(C,R){const p=this.getNullCell(h.DEFAULT_ATTR_DATA);let $=0;const F=this._getCorrectBufferLength(R);if(F>this.lines.maxLength&&(this.lines.maxLength=F),this.lines.length>0){if(this._cols<C)for(let L=0;L<this.lines.length;L++)$+=+this.lines.get(L).resize(C,p);let O=0;if(this._rows<R)for(let L=this._rows;L<R;L++)this.lines.length<R+this.ybase&&(this._optionsService.rawOptions.windowsMode||this._optionsService.rawOptions.windowsPty.backend!==void 0||this._optionsService.rawOptions.windowsPty.buildNumber!==void 0?this.lines.push(new h.BufferLine(C,p)):this.ybase>0&&this.lines.length<=this.ybase+this.y+O+1?(this.ybase--,O++,this.ydisp>0&&this.ydisp--):this.lines.push(new h.BufferLine(C,p)));else for(let L=this._rows;L>R;L--)this.lines.length>R+this.ybase&&(this.lines.length>this.ybase+this.y+1?this.lines.pop():(this.ybase++,this.ydisp++));if(F<this.lines.maxLength){const L=this.lines.length-F;L>0&&(this.lines.trimStart(L),this.ybase=Math.max(this.ybase-L,0),this.ydisp=Math.max(this.ydisp-L,0),this.savedY=Math.max(this.savedY-L,0)),this.lines.maxLength=F}this.x=Math.min(this.x,C-1),this.y=Math.min(this.y,R-1),O&&(this.y+=O),this.savedX=Math.min(this.savedX,C-1),this.scrollTop=0}if(this.scrollBottom=R-1,this._isReflowEnabled&&(this._reflow(C,R),this._cols>C))for(let O=0;O<this.lines.length;O++)$+=+this.lines.get(O).resize(C,p);this._cols=C,this._rows=R,this._memoryCleanupQueue.clear(),$>0.1*this.lines.length&&(this._memoryCleanupPosition=0,this._memoryCleanupQueue.enqueue(()=>this._batchedMemoryCleanup()))}_batchedMemoryCleanup(){let C=!0;this._memoryCleanupPosition>=this.lines.length&&(this._memoryCleanupPosition=0,C=!1);let R=0;for(;this._memoryCleanupPosition<this.lines.length;)if(R+=this.lines.get(this._memoryCleanupPosition++).cleanupMemory(),R>100)return!0;return C}get _isReflowEnabled(){const C=this._optionsService.rawOptions.windowsPty;return C&&C.buildNumber?this._hasScrollback&&C.backend==="conpty"&&C.buildNumber>=21376:this._hasScrollback&&!this._optionsService.rawOptions.windowsMode}_reflow(C,R){this._cols!==C&&(C>this._cols?this._reflowLarger(C,R):this._reflowSmaller(C,R))}_reflowLarger(C,R){const p=D.reflowLargerGetLinesToRemove(this.lines,this._cols,C,this.ybase+this.y,this.getNullCell(h.DEFAULT_ATTR_DATA));if(p.length>0){const $=D.reflowLargerCreateNewLayout(this.lines,p);D.reflowLargerApplyNewLayout(this.lines,$.layout),this._reflowLargerAdjustViewport(C,R,$.countRemoved)}}_reflowLargerAdjustViewport(C,R,p){const $=this.getNullCell(h.DEFAULT_ATTR_DATA);let F=p;for(;F-- >0;)this.ybase===0?(this.y>0&&this.y--,this.lines.length<R&&this.lines.push(new h.BufferLine(C,$))):(this.ydisp===this.ybase&&this.ydisp--,this.ybase--);this.savedY=Math.max(this.savedY-p,0)}_reflowSmaller(C,R){const p=this.getNullCell(h.DEFAULT_ATTR_DATA),$=[];let F=0;for(let O=this.lines.length-1;O>=0;O--){let L=this.lines.get(O);if(!L||!L.isWrapped&&L.getTrimmedLength()<=C)continue;const Z=[L];for(;L.isWrapped&&O>0;)L=this.lines.get(--O),Z.unshift(L);const W=this.ybase+this.y;if(W>=O&&W<O+Z.length)continue;const B=Z[Z.length-1].getTrimmedLength(),Y=D.reflowSmallerGetNewLineLengths(Z,this._cols,C),G=Y.length-Z.length;let T;T=this.ybase===0&&this.y!==this.lines.length-1?Math.max(0,this.y-this.lines.maxLength+G):Math.max(0,this.lines.length-this.lines.maxLength+G);const J=[];for(let k=0;k<G;k++){const N=this.getBlankLine(h.DEFAULT_ATTR_DATA,!0);J.push(N)}J.length>0&&($.push({start:O+Z.length+F,newLines:J}),F+=J.length),Z.push(...J);let X=Y.length-1,m=Y[X];m===0&&(X--,m=Y[X]);let q=Z.length-G-1,V=B;for(;q>=0;){const k=Math.min(V,m);if(Z[X]===void 0)break;if(Z[X].copyCellsFrom(Z[q],V-k,m-k,k,!0),m-=k,m===0&&(X--,m=Y[X]),V-=k,V===0){q--;const N=Math.max(q,0);V=D.getWrappedLineTrimmedLength(Z,N,this._cols)}}for(let k=0;k<Z.length;k++)Y[k]<C&&Z[k].setCell(Y[k],p);let Q=G-T;for(;Q-- >0;)this.ybase===0?this.y<R-1?(this.y++,this.lines.pop()):(this.ybase++,this.ydisp++):this.ybase<Math.min(this.lines.maxLength,this.lines.length+F)-R&&(this.ybase===this.ydisp&&this.ydisp++,this.ybase++);this.savedY=Math.min(this.savedY+G,this.ybase+R-1)}if($.length>0){const O=[],L=[];for(let X=0;X<this.lines.length;X++)L.push(this.lines.get(X));const Z=this.lines.length;let W=Z-1,B=0,Y=$[B];this.lines.length=Math.min(this.lines.maxLength,this.lines.length+F);let G=0;for(let X=Math.min(this.lines.maxLength-1,Z+F-1);X>=0;X--)if(Y&&Y.start>W+G){for(let m=Y.newLines.length-1;m>=0;m--)this.lines.set(X--,Y.newLines[m]);X++,O.push({index:W+1,amount:Y.newLines.length}),G+=Y.newLines.length,Y=$[++B]}else this.lines.set(X,L[W--]);let T=0;for(let X=O.length-1;X>=0;X--)O[X].index+=T,this.lines.onInsertEmitter.fire(O[X]),T+=O[X].amount;const J=Math.max(0,Z+F-this.lines.maxLength);J>0&&this.lines.onTrimEmitter.fire(J)}}translateBufferLineToString(C,R,p=0,$){const F=this.lines.get(C);return F?F.translateToString(R,p,$):""}getWrappedRangeForLine(C){let R=C,p=C;for(;R>0&&this.lines.get(R).isWrapped;)R--;for(;p+1<this.lines.length&&this.lines.get(p+1).isWrapped;)p++;return{first:R,last:p}}setupTabStops(C){for(C!=null?this.tabs[C]||(C=this.prevStop(C)):(this.tabs={},C=0);C<this._cols;C+=this._optionsService.rawOptions.tabStopWidth)this.tabs[C]=!0}prevStop(C){for(C==null&&(C=this.x);!this.tabs[--C]&&C>0;);return C>=this._cols?this._cols-1:C<0?0:C}nextStop(C){for(C==null&&(C=this.x);!this.tabs[++C]&&C<this._cols;);return C>=this._cols?this._cols-1:C<0?0:C}clearMarkers(C){this._isClearing=!0;for(let R=0;R<this.markers.length;R++)this.markers[R].line===C&&(this.markers[R].dispose(),this.markers.splice(R--,1));this._isClearing=!1}clearAllMarkers(){this._isClearing=!0;for(let C=0;C<this.markers.length;C++)this.markers[C].dispose(),this.markers.splice(C--,1);this._isClearing=!1}addMarker(C){const R=new g.Marker(C);return this.markers.push(R),R.register(this.lines.onTrim((p)=>{R.line-=p,R.line<0&&R.dispose()})),R.register(this.lines.onInsert((p)=>{R.line>=p.index&&(R.line+=p.amount)})),R.register(this.lines.onDelete((p)=>{R.line>=p.index&&R.line<p.index+p.amount&&R.dispose(),R.line>p.index&&(R.line-=p.amount)})),R.register(R.onDispose(()=>this._removeMarker(R))),R}_removeMarker(C){this._isClearing||this.markers.splice(this.markers.indexOf(C),1)}}},8437:(P,v,b)=>{Object.defineProperty(v,"__esModule",{value:!0}),v.BufferLine=v.DEFAULT_ATTR_DATA=void 0;const A=b(3734),H=b(511),E=b(643),h=b(482);v.DEFAULT_ATTR_DATA=Object.freeze(new A.AttributeData);let D=0;class f{constructor(S,g,w=!1){this.isWrapped=w,this._combined={},this._extendedAttrs={},this._data=new Uint32Array(3*S);const C=g||H.CellData.fromCharData([0,E.NULL_CELL_CHAR,E.NULL_CELL_WIDTH,E.NULL_CELL_CODE]);for(let R=0;R<S;++R)this.setCell(R,C);this.length=S}get(S){const g=this._data[3*S+0],w=2097151&g;return[this._data[3*S+1],2097152&g?this._combined[S]:w?h.stringFromCodePoint(w):"",g>>22,2097152&g?this._combined[S].charCodeAt(this._combined[S].length-1):w]}set(S,g){this._data[3*S+1]=g[E.CHAR_DATA_ATTR_INDEX],g[E.CHAR_DATA_CHAR_INDEX].length>1?(this._combined[S]=g[1],this._data[3*S+0]=2097152|S|g[E.CHAR_DATA_WIDTH_INDEX]<<22):this._data[3*S+0]=g[E.CHAR_DATA_CHAR_INDEX].charCodeAt(0)|g[E.CHAR_DATA_WIDTH_INDEX]<<22}getWidth(S){return this._data[3*S+0]>>22}hasWidth(S){return 12582912&this._data[3*S+0]}getFg(S){return this._data[3*S+1]}getBg(S){return this._data[3*S+2]}hasContent(S){return 4194303&this._data[3*S+0]}getCodePoint(S){const g=this._data[3*S+0];return 2097152&g?this._combined[S].charCodeAt(this._combined[S].length-1):2097151&g}isCombined(S){return 2097152&this._data[3*S+0]}getString(S){const g=this._data[3*S+0];return 2097152&g?this._combined[S]:2097151&g?h.stringFromCodePoint(2097151&g):""}isProtected(S){return 536870912&this._data[3*S+2]}loadCell(S,g){return D=3*S,g.content=this._data[D+0],g.fg=this._data[D+1],g.bg=this._data[D+2],2097152&g.content&&(g.combinedData=this._combined[S]),268435456&g.bg&&(g.extended=this._extendedAttrs[S]),g}setCell(S,g){2097152&g.content&&(this._combined[S]=g.combinedData),268435456&g.bg&&(this._extendedAttrs[S]=g.extended),this._data[3*S+0]=g.content,this._data[3*S+1]=g.fg,this._data[3*S+2]=g.bg}setCellFromCodePoint(S,g,w,C,R,p){268435456&R&&(this._extendedAttrs[S]=p),this._data[3*S+0]=g|w<<22,this._data[3*S+1]=C,this._data[3*S+2]=R}addCodepointToCell(S,g){let w=this._data[3*S+0];2097152&w?this._combined[S]+=h.stringFromCodePoint(g):(2097151&w?(this._combined[S]=h.stringFromCodePoint(2097151&w)+h.stringFromCodePoint(g),w&=-2097152,w|=2097152):w=g|1<<22,this._data[3*S+0]=w)}insertCells(S,g,w,C){if((S%=this.length)&&this.getWidth(S-1)===2&&this.setCellFromCodePoint(S-1,0,1,(C==null?void 0:C.fg)||0,(C==null?void 0:C.bg)||0,(C==null?void 0:C.extended)||new A.ExtendedAttrs),g<this.length-S){const R=new H.CellData;for(let p=this.length-S-g-1;p>=0;--p)this.setCell(S+g+p,this.loadCell(S+p,R));for(let p=0;p<g;++p)this.setCell(S+p,w)}else for(let R=S;R<this.length;++R)this.setCell(R,w);this.getWidth(this.length-1)===2&&this.setCellFromCodePoint(this.length-1,0,1,(C==null?void 0:C.fg)||0,(C==null?void 0:C.bg)||0,(C==null?void 0:C.extended)||new A.ExtendedAttrs)}deleteCells(S,g,w,C){if(S%=this.length,g<this.length-S){const R=new H.CellData;for(let p=0;p<this.length-S-g;++p)this.setCell(S+p,this.loadCell(S+g+p,R));for(let p=this.length-g;p<this.length;++p)this.setCell(p,w)}else for(let R=S;R<this.length;++R)this.setCell(R,w);S&&this.getWidth(S-1)===2&&this.setCellFromCodePoint(S-1,0,1,(C==null?void 0:C.fg)||0,(C==null?void 0:C.bg)||0,(C==null?void 0:C.extended)||new A.ExtendedAttrs),this.getWidth(S)!==0||this.hasContent(S)||this.setCellFromCodePoint(S,0,1,(C==null?void 0:C.fg)||0,(C==null?void 0:C.bg)||0,(C==null?void 0:C.extended)||new A.ExtendedAttrs)}replaceCells(S,g,w,C,R=!1){if(R)for(S&&this.getWidth(S-1)===2&&!this.isProtected(S-1)&&this.setCellFromCodePoint(S-1,0,1,(C==null?void 0:C.fg)||0,(C==null?void 0:C.bg)||0,(C==null?void 0:C.extended)||new A.ExtendedAttrs),g<this.length&&this.getWidth(g-1)===2&&!this.isProtected(g)&&this.setCellFromCodePoint(g,0,1,(C==null?void 0:C.fg)||0,(C==null?void 0:C.bg)||0,(C==null?void 0:C.extended)||new A.ExtendedAttrs);S<g&&S<this.length;)this.isProtected(S)||this.setCell(S,w),S++;else for(S&&this.getWidth(S-1)===2&&this.setCellFromCodePoint(S-1,0,1,(C==null?void 0:C.fg)||0,(C==null?void 0:C.bg)||0,(C==null?void 0:C.extended)||new A.ExtendedAttrs),g<this.length&&this.getWidth(g-1)===2&&this.setCellFromCodePoint(g,0,1,(C==null?void 0:C.fg)||0,(C==null?void 0:C.bg)||0,(C==null?void 0:C.extended)||new A.ExtendedAttrs);S<g&&S<this.length;)this.setCell(S++,w)}resize(S,g){if(S===this.length)return 4*this._data.length*2<this._data.buffer.byteLength;const w=3*S;if(S>this.length){if(this._data.buffer.byteLength>=4*w)this._data=new Uint32Array(this._data.buffer,0,w);else{const C=new Uint32Array(w);C.set(this._data),this._data=C}for(let C=this.length;C<S;++C)this.setCell(C,g)}else{this._data=this._data.subarray(0,w);const C=Object.keys(this._combined);for(let p=0;p<C.length;p++){const $=parseInt(C[p],10);$>=S&&delete this._combined[$]}const R=Object.keys(this._extendedAttrs);for(let p=0;p<R.length;p++){const $=parseInt(R[p],10);$>=S&&delete this._extendedAttrs[$]}}return this.length=S,4*w*2<this._data.buffer.byteLength}cleanupMemory(){if(4*this._data.length*2<this._data.buffer.byteLength){const S=new Uint32Array(this._data.length);return S.set(this._data),this._data=S,1}return 0}fill(S,g=!1){if(g)for(let w=0;w<this.length;++w)this.isProtected(w)||this.setCell(w,S);else{this._combined={},this._extendedAttrs={};for(let w=0;w<this.length;++w)this.setCell(w,S)}}copyFrom(S){this.length!==S.length?this._data=new Uint32Array(S._data):this._data.set(S._data),this.length=S.length,this._combined={};for(let g in S._combined)this._combined[g]=S._combined[g];this._extendedAttrs={};for(let g in S._extendedAttrs)this._extendedAttrs[g]=S._extendedAttrs[g];this.isWrapped=S.isWrapped}clone(){const S=new f(0);S._data=new Uint32Array(this._data),S.length=this.length;for(let g in this._combined)S._combined[g]=this._combined[g];for(let g in this._extendedAttrs)S._extendedAttrs[g]=this._extendedAttrs[g];return S.isWrapped=this.isWrapped,S}getTrimmedLength(){for(let S=this.length-1;S>=0;--S)if(4194303&this._data[3*S+0])return S+(this._data[3*S+0]>>22);return 0}getNoBgTrimmedLength(){for(let S=this.length-1;S>=0;--S)if(4194303&this._data[3*S+0]||50331648&this._data[3*S+2])return S+(this._data[3*S+0]>>22);return 0}copyCellsFrom(S,g,w,C,R){const p=S._data;if(R)for(let F=C-1;F>=0;F--){for(let O=0;O<3;O++)this._data[3*(w+F)+O]=p[3*(g+F)+O];268435456&p[3*(g+F)+2]&&(this._extendedAttrs[w+F]=S._extendedAttrs[g+F])}else for(let F=0;F<C;F++){for(let O=0;O<3;O++)this._data[3*(w+F)+O]=p[3*(g+F)+O];268435456&p[3*(g+F)+2]&&(this._extendedAttrs[w+F]=S._extendedAttrs[g+F])}const $=Object.keys(S._combined);for(let F=0;F<$.length;F++){const O=parseInt($[F],10);O>=g&&(this._combined[O-g+w]=S._combined[O])}}translateToString(S=!1,g=0,w=this.length){S&&(w=Math.min(w,this.getTrimmedLength()));let C="";for(;g<w;){const R=this._data[3*g+0],p=2097151&R;C+=2097152&R?this._combined[g]:p?h.stringFromCodePoint(p):E.WHITESPACE_CELL_CHAR,g+=R>>22||1}return C}}v.BufferLine=f},4841:(P,v)=>{Object.defineProperty(v,"__esModule",{value:!0}),v.getRangeLength=void 0,v.getRangeLength=function(b,A){if(b.start.y>b.end.y)throw new Error(`Buffer range end (${b.end.x}, ${b.end.y}) cannot be before start (${b.start.x}, ${b.start.y})`);return A*(b.end.y-b.start.y)+(b.end.x-b.start.x+1)}},4634:(P,v)=>{function b(A,H,E){if(H===A.length-1)return A[H].getTrimmedLength();const h=!A[H].hasContent(E-1)&&A[H].getWidth(E-1)===1,D=A[H+1].getWidth(0)===2;return h&&D?E-1:E}Object.defineProperty(v,"__esModule",{value:!0}),v.getWrappedLineTrimmedLength=v.reflowSmallerGetNewLineLengths=v.reflowLargerApplyNewLayout=v.reflowLargerCreateNewLayout=v.reflowLargerGetLinesToRemove=void 0,v.reflowLargerGetLinesToRemove=function(A,H,E,h,D){const f=[];for(let S=0;S<A.length-1;S++){let g=S,w=A.get(++g);if(!w.isWrapped)continue;const C=[A.get(S)];for(;g<A.length&&w.isWrapped;)C.push(w),w=A.get(++g);if(h>=S&&h<g){S+=C.length-1;continue}let R=0,p=b(C,R,H),$=1,F=0;for(;$<C.length;){const L=b(C,$,H),Z=L-F,W=E-p,B=Math.min(Z,W);C[R].copyCellsFrom(C[$],F,p,B,!1),p+=B,p===E&&(R++,p=0),F+=B,F===L&&($++,F=0),p===0&&R!==0&&C[R-1].getWidth(E-1)===2&&(C[R].copyCellsFrom(C[R-1],E-1,p++,1,!1),C[R-1].setCell(E-1,D))}C[R].replaceCells(p,E,D);let O=0;for(let L=C.length-1;L>0&&(L>R||C[L].getTrimmedLength()===0);L--)O++;O>0&&(f.push(S+C.length-O),f.push(O)),S+=C.length-1}return f},v.reflowLargerCreateNewLayout=function(A,H){const E=[];let h=0,D=H[h],f=0;for(let S=0;S<A.length;S++)if(D===S){const g=H[++h];A.onDeleteEmitter.fire({index:S-f,amount:g}),S+=g-1,f+=g,D=H[++h]}else E.push(S);return{layout:E,countRemoved:f}},v.reflowLargerApplyNewLayout=function(A,H){const E=[];for(let h=0;h<H.length;h++)E.push(A.get(H[h]));for(let h=0;h<E.length;h++)A.set(h,E[h]);A.length=H.length},v.reflowSmallerGetNewLineLengths=function(A,H,E){const h=[],D=A.map((w,C)=>b(A,C,H)).reduce((w,C)=>w+C);let f=0,S=0,g=0;for(;g<D;){if(D-g<E){h.push(D-g);break}f+=E;const w=b(A,S,H);f>w&&(f-=w,S++);const C=A[S].getWidth(f-1)===2;C&&f--;const R=C?E-1:E;h.push(R),g+=R}return h},v.getWrappedLineTrimmedLength=b},5295:(P,v,b)=>{Object.defineProperty(v,"__esModule",{value:!0}),v.BufferSet=void 0;const A=b(8460),H=b(844),E=b(9092);class h extends H.Disposable{constructor(D,f){super(),this._optionsService=D,this._bufferService=f,this._onBufferActivate=this.register(new A.EventEmitter),this.onBufferActivate=this._onBufferActivate.event,this.reset(),this.register(this._optionsService.onSpecificOptionChange("scrollback",()=>this.resize(this._bufferService.cols,this._bufferService.rows))),this.register(this._optionsService.onSpecificOptionChange("tabStopWidth",()=>this.setupTabStops()))}reset(){this._normal=new E.Buffer(!0,this._optionsService,this._bufferService),this._normal.fillViewportRows(),this._alt=new E.Buffer(!1,this._optionsService,this._bufferService),this._activeBuffer=this._normal,this._onBufferActivate.fire({activeBuffer:this._normal,inactiveBuffer:this._alt}),this.setupTabStops()}get alt(){return this._alt}get active(){return this._activeBuffer}get normal(){return this._normal}activateNormalBuffer(){this._activeBuffer!==this._normal&&(this._normal.x=this._alt.x,this._normal.y=this._alt.y,this._alt.clearAllMarkers(),this._alt.clear(),this._activeBuffer=this._normal,this._onBufferActivate.fire({activeBuffer:this._normal,inactiveBuffer:this._alt}))}activateAltBuffer(D){this._activeBuffer!==this._alt&&(this._alt.fillViewportRows(D),this._alt.x=this._normal.x,this._alt.y=this._normal.y,this._activeBuffer=this._alt,this._onBufferActivate.fire({activeBuffer:this._alt,inactiveBuffer:this._normal}))}resize(D,f){this._normal.resize(D,f),this._alt.resize(D,f),this.setupTabStops(D)}setupTabStops(D){this._normal.setupTabStops(D),this._alt.setupTabStops(D)}}v.BufferSet=h},511:(P,v,b)=>{Object.defineProperty(v,"__esModule",{value:!0}),v.CellData=void 0;const A=b(482),H=b(643),E=b(3734);class h extends E.AttributeData{constructor(){super(...arguments),this.content=0,this.fg=0,this.bg=0,this.extended=new E.ExtendedAttrs,this.combinedData=""}static fromCharData(D){const f=new h;return f.setFromCharData(D),f}isCombined(){return 2097152&this.content}getWidth(){return this.content>>22}getChars(){return 2097152&this.content?this.combinedData:2097151&this.content?A.stringFromCodePoint(2097151&this.content):""}getCode(){return this.isCombined()?this.combinedData.charCodeAt(this.combinedData.length-1):2097151&this.content}setFromCharData(D){this.fg=D[H.CHAR_DATA_ATTR_INDEX],this.bg=0;let f=!1;if(D[H.CHAR_DATA_CHAR_INDEX].length>2)f=!0;else if(D[H.CHAR_DATA_CHAR_INDEX].length===2){const S=D[H.CHAR_DATA_CHAR_INDEX].charCodeAt(0);if(55296<=S&&S<=56319){const g=D[H.CHAR_DATA_CHAR_INDEX].charCodeAt(1);56320<=g&&g<=57343?this.content=1024*(S-55296)+g-56320+65536|D[H.CHAR_DATA_WIDTH_INDEX]<<22:f=!0}else f=!0}else this.content=D[H.CHAR_DATA_CHAR_INDEX].charCodeAt(0)|D[H.CHAR_DATA_WIDTH_INDEX]<<22;f&&(this.combinedData=D[H.CHAR_DATA_CHAR_INDEX],this.content=2097152|D[H.CHAR_DATA_WIDTH_INDEX]<<22)}getAsCharData(){return[this.fg,this.getChars(),this.getWidth(),this.getCode()]}}v.CellData=h},643:(P,v)=>{Object.defineProperty(v,"__esModule",{value:!0}),v.WHITESPACE_CELL_CODE=v.WHITESPACE_CELL_WIDTH=v.WHITESPACE_CELL_CHAR=v.NULL_CELL_CODE=v.NULL_CELL_WIDTH=v.NULL_CELL_CHAR=v.CHAR_DATA_CODE_INDEX=v.CHAR_DATA_WIDTH_INDEX=v.CHAR_DATA_CHAR_INDEX=v.CHAR_DATA_ATTR_INDEX=v.DEFAULT_EXT=v.DEFAULT_ATTR=v.DEFAULT_COLOR=void 0,v.DEFAULT_COLOR=0,v.DEFAULT_ATTR=256|v.DEFAULT_COLOR<<9,v.DEFAULT_EXT=0,v.CHAR_DATA_ATTR_INDEX=0,v.CHAR_DATA_CHAR_INDEX=1,v.CHAR_DATA_WIDTH_INDEX=2,v.CHAR_DATA_CODE_INDEX=3,v.NULL_CELL_CHAR="",v.NULL_CELL_WIDTH=1,v.NULL_CELL_CODE=0,v.WHITESPACE_CELL_CHAR=" ",v.WHITESPACE_CELL_WIDTH=1,v.WHITESPACE_CELL_CODE=32},4863:(P,v,b)=>{Object.defineProperty(v,"__esModule",{value:!0}),v.Marker=void 0;const A=b(8460),H=b(844);class E{get id(){return this._id}constructor(h){this.line=h,this.isDisposed=!1,this._disposables=[],this._id=E._nextId++,this._onDispose=this.register(new A.EventEmitter),this.onDispose=this._onDispose.event}dispose(){this.isDisposed||(this.isDisposed=!0,this.line=-1,this._onDispose.fire(),H.disposeArray(this._disposables),this._disposables.length=0)}register(h){return this._disposables.push(h),h}}v.Marker=E,E._nextId=1},7116:(P,v)=>{Object.defineProperty(v,"__esModule",{value:!0}),v.DEFAULT_CHARSET=v.CHARSETS=void 0,v.CHARSETS={},v.DEFAULT_CHARSET=v.CHARSETS.B,v.CHARSETS[0]={"`":"\u25C6",a:"\u2592",b:"\u2409",c:"\u240C",d:"\u240D",e:"\u240A",f:"\xB0",g:"\xB1",h:"\u2424",i:"\u240B",j:"\u2518",k:"\u2510",l:"\u250C",m:"\u2514",n:"\u253C",o:"\u23BA",p:"\u23BB",q:"\u2500",r:"\u23BC",s:"\u23BD",t:"\u251C",u:"\u2524",v:"\u2534",w:"\u252C",x:"\u2502",y:"\u2264",z:"\u2265","{":"\u03C0","|":"\u2260","}":"\xA3","~":"\xB7"},v.CHARSETS.A={"#":"\xA3"},v.CHARSETS.B=void 0,v.CHARSETS[4]={"#":"\xA3","@":"\xBE","[":"ij","\\":"\xBD","]":"|","{":"\xA8","|":"f","}":"\xBC","~":"\xB4"},v.CHARSETS.C=v.CHARSETS[5]={"[":"\xC4","\\":"\xD6","]":"\xC5","^":"\xDC","`":"\xE9","{":"\xE4","|":"\xF6","}":"\xE5","~":"\xFC"},v.CHARSETS.R={"#":"\xA3","@":"\xE0","[":"\xB0","\\":"\xE7","]":"\xA7","{":"\xE9","|":"\xF9","}":"\xE8","~":"\xA8"},v.CHARSETS.Q={"@":"\xE0","[":"\xE2","\\":"\xE7","]":"\xEA","^":"\xEE","`":"\xF4","{":"\xE9","|":"\xF9","}":"\xE8","~":"\xFB"},v.CHARSETS.K={"@":"\xA7","[":"\xC4","\\":"\xD6","]":"\xDC","{":"\xE4","|":"\xF6","}":"\xFC","~":"\xDF"},v.CHARSETS.Y={"#":"\xA3","@":"\xA7","[":"\xB0","\\":"\xE7","]":"\xE9","`":"\xF9","{":"\xE0","|":"\xF2","}":"\xE8","~":"\xEC"},v.CHARSETS.E=v.CHARSETS[6]={"@":"\xC4","[":"\xC6","\\":"\xD8","]":"\xC5","^":"\xDC","`":"\xE4","{":"\xE6","|":"\xF8","}":"\xE5","~":"\xFC"},v.CHARSETS.Z={"#":"\xA3","@":"\xA7","[":"\xA1","\\":"\xD1","]":"\xBF","{":"\xB0","|":"\xF1","}":"\xE7"},v.CHARSETS.H=v.CHARSETS[7]={"@":"\xC9","[":"\xC4","\\":"\xD6","]":"\xC5","^":"\xDC","`":"\xE9","{":"\xE4","|":"\xF6","}":"\xE5","~":"\xFC"},v.CHARSETS["="]={"#":"\xF9","@":"\xE0","[":"\xE9","\\":"\xE7","]":"\xEA","^":"\xEE",_:"\xE8","`":"\xF4","{":"\xE4","|":"\xF6","}":"\xFC","~":"\xFB"}},2584:(P,v)=>{var b,A,H;Object.defineProperty(v,"__esModule",{value:!0}),v.C1_ESCAPED=v.C1=v.C0=void 0,function(E){E.NUL="\0",E.SOH="",E.STX="",E.ETX="",E.EOT="",E.ENQ="",E.ACK="",E.BEL="",E.BS="\b",E.HT="\t",E.LF="\n",E.VT="\v",E.FF="\f",E.CR="\r",E.SO="",E.SI="",E.DLE="",E.DC1="",E.DC2="",E.DC3="",E.DC4="",E.NAK="",E.SYN="",E.ETB="",E.CAN="",E.EM="",E.SUB="",E.ESC="",E.FS="",E.GS="",E.RS="",E.US="",E.SP=" ",E.DEL=""}(b||(v.C0=b={})),function(E){E.PAD="\x80",E.HOP="\x81",E.BPH="\x82",E.NBH="\x83",E.IND="\x84",E.NEL="\x85",E.SSA="\x86",E.ESA="\x87",E.HTS="\x88",E.HTJ="\x89",E.VTS="\x8A",E.PLD="\x8B",E.PLU="\x8C",E.RI="\x8D",E.SS2="\x8E",E.SS3="\x8F",E.DCS="\x90",E.PU1="\x91",E.PU2="\x92",E.STS="\x93",E.CCH="\x94",E.MW="\x95",E.SPA="\x96",E.EPA="\x97",E.SOS="\x98",E.SGCI="\x99",E.SCI="\x9A",E.CSI="\x9B",E.ST="\x9C",E.OSC="\x9D",E.PM="\x9E",E.APC="\x9F"}(A||(v.C1=A={})),function(E){E.ST=`${b.ESC}\\`}(H||(v.C1_ESCAPED=H={}))},7399:(P,v,b)=>{Object.defineProperty(v,"__esModule",{value:!0}),v.evaluateKeyboardEvent=void 0;const A=b(2584),H={48:["0",")"],49:["1","!"],50:["2","@"],51:["3","#"],52:["4","$"],53:["5","%"],54:["6","^"],55:["7","&"],56:["8","*"],57:["9","("],186:[";",":"],187:["=","+"],188:[",","<"],189:["-","_"],190:[".",">"],191:["/","?"],192:["`","~"],219:["[","{"],220:["\\","|"],221:["]","}"],222:["'",'"']};v.evaluateKeyboardEvent=function(E,h,D,f){const S={type:0,cancel:!1,key:void 0},g=(E.shiftKey?1:0)|(E.altKey?2:0)|(E.ctrlKey?4:0)|(E.metaKey?8:0);switch(E.keyCode){case 0:E.key==="UIKeyInputUpArrow"?S.key=h?A.C0.ESC+"OA":A.C0.ESC+"[A":E.key==="UIKeyInputLeftArrow"?S.key=h?A.C0.ESC+"OD":A.C0.ESC+"[D":E.key==="UIKeyInputRightArrow"?S.key=h?A.C0.ESC+"OC":A.C0.ESC+"[C":E.key==="UIKeyInputDownArrow"&&(S.key=h?A.C0.ESC+"OB":A.C0.ESC+"[B");break;case 8:if(E.altKey){S.key=A.C0.ESC+A.C0.DEL;break}S.key=A.C0.DEL;break;case 9:if(E.shiftKey){S.key=A.C0.ESC+"[Z";break}S.key=A.C0.HT,S.cancel=!0;break;case 13:S.key=E.altKey?A.C0.ESC+A.C0.CR:A.C0.CR,S.cancel=!0;break;case 27:S.key=A.C0.ESC,E.altKey&&(S.key=A.C0.ESC+A.C0.ESC),S.cancel=!0;break;case 37:if(E.metaKey)break;g?(S.key=A.C0.ESC+"[1;"+(g+1)+"D",S.key===A.C0.ESC+"[1;3D"&&(S.key=A.C0.ESC+(D?"b":"[1;5D"))):S.key=h?A.C0.ESC+"OD":A.C0.ESC+"[D";break;case 39:if(E.metaKey)break;g?(S.key=A.C0.ESC+"[1;"+(g+1)+"C",S.key===A.C0.ESC+"[1;3C"&&(S.key=A.C0.ESC+(D?"f":"[1;5C"))):S.key=h?A.C0.ESC+"OC":A.C0.ESC+"[C";break;case 38:if(E.metaKey)break;g?(S.key=A.C0.ESC+"[1;"+(g+1)+"A",D||S.key!==A.C0.ESC+"[1;3A"||(S.key=A.C0.ESC+"[1;5A")):S.key=h?A.C0.ESC+"OA":A.C0.ESC+"[A";break;case 40:if(E.metaKey)break;g?(S.key=A.C0.ESC+"[1;"+(g+1)+"B",D||S.key!==A.C0.ESC+"[1;3B"||(S.key=A.C0.ESC+"[1;5B")):S.key=h?A.C0.ESC+"OB":A.C0.ESC+"[B";break;case 45:E.shiftKey||E.ctrlKey||(S.key=A.C0.ESC+"[2~");break;case 46:S.key=g?A.C0.ESC+"[3;"+(g+1)+"~":A.C0.ESC+"[3~";break;case 36:S.key=g?A.C0.ESC+"[1;"+(g+1)+"H":h?A.C0.ESC+"OH":A.C0.ESC+"[H";break;case 35:S.key=g?A.C0.ESC+"[1;"+(g+1)+"F":h?A.C0.ESC+"OF":A.C0.ESC+"[F";break;case 33:E.shiftKey?S.type=2:E.ctrlKey?S.key=A.C0.ESC+"[5;"+(g+1)+"~":S.key=A.C0.ESC+"[5~";break;case 34:E.shiftKey?S.type=3:E.ctrlKey?S.key=A.C0.ESC+"[6;"+(g+1)+"~":S.key=A.C0.ESC+"[6~";break;case 112:S.key=g?A.C0.ESC+"[1;"+(g+1)+"P":A.C0.ESC+"OP";break;case 113:S.key=g?A.C0.ESC+"[1;"+(g+1)+"Q":A.C0.ESC+"OQ";break;case 114:S.key=g?A.C0.ESC+"[1;"+(g+1)+"R":A.C0.ESC+"OR";break;case 115:S.key=g?A.C0.ESC+"[1;"+(g+1)+"S":A.C0.ESC+"OS";break;case 116:S.key=g?A.C0.ESC+"[15;"+(g+1)+"~":A.C0.ESC+"[15~";break;case 117:S.key=g?A.C0.ESC+"[17;"+(g+1)+"~":A.C0.ESC+"[17~";break;case 118:S.key=g?A.C0.ESC+"[18;"+(g+1)+"~":A.C0.ESC+"[18~";break;case 119:S.key=g?A.C0.ESC+"[19;"+(g+1)+"~":A.C0.ESC+"[19~";break;case 120:S.key=g?A.C0.ESC+"[20;"+(g+1)+"~":A.C0.ESC+"[20~";break;case 121:S.key=g?A.C0.ESC+"[21;"+(g+1)+"~":A.C0.ESC+"[21~";break;case 122:S.key=g?A.C0.ESC+"[23;"+(g+1)+"~":A.C0.ESC+"[23~";break;case 123:S.key=g?A.C0.ESC+"[24;"+(g+1)+"~":A.C0.ESC+"[24~";break;default:if(!E.ctrlKey||E.shiftKey||E.altKey||E.metaKey)if(D&&!f||!E.altKey||E.metaKey)!D||E.altKey||E.ctrlKey||E.shiftKey||!E.metaKey?E.key&&!E.ctrlKey&&!E.altKey&&!E.metaKey&&E.keyCode>=48&&E.key.length===1?S.key=E.key:E.key&&E.ctrlKey&&(E.key==="_"&&(S.key=A.C0.US),E.key==="@"&&(S.key=A.C0.NUL)):E.keyCode===65&&(S.type=1);else{const w=H[E.keyCode],C=w==null?void 0:w[E.shiftKey?1:0];if(C)S.key=A.C0.ESC+C;else if(E.keyCode>=65&&E.keyCode<=90){const R=E.ctrlKey?E.keyCode-64:E.keyCode+32;let p=String.fromCharCode(R);E.shiftKey&&(p=p.toUpperCase()),S.key=A.C0.ESC+p}else if(E.keyCode===32)S.key=A.C0.ESC+(E.ctrlKey?A.C0.NUL:" ");else if(E.key==="Dead"&&E.code.startsWith("Key")){let R=E.code.slice(3,4);E.shiftKey||(R=R.toLowerCase()),S.key=A.C0.ESC+R,S.cancel=!0}}else E.keyCode>=65&&E.keyCode<=90?S.key=String.fromCharCode(E.keyCode-64):E.keyCode===32?S.key=A.C0.NUL:E.keyCode>=51&&E.keyCode<=55?S.key=String.fromCharCode(E.keyCode-51+27):E.keyCode===56?S.key=A.C0.DEL:E.keyCode===219?S.key=A.C0.ESC:E.keyCode===220?S.key=A.C0.FS:E.keyCode===221&&(S.key=A.C0.GS)}return S}},482:(P,v)=>{Object.defineProperty(v,"__esModule",{value:!0}),v.Utf8ToUtf32=v.StringToUtf32=v.utf32ToString=v.stringFromCodePoint=void 0,v.stringFromCodePoint=function(b){return b>65535?(b-=65536,String.fromCharCode(55296+(b>>10))+String.fromCharCode(b%1024+56320)):String.fromCharCode(b)},v.utf32ToString=function(b,A=0,H=b.length){let E="";for(let h=A;h<H;++h){let D=b[h];D>65535?(D-=65536,E+=String.fromCharCode(55296+(D>>10))+String.fromCharCode(D%1024+56320)):E+=String.fromCharCode(D)}return E},v.StringToUtf32=class{constructor(){this._interim=0}clear(){this._interim=0}decode(b,A){const H=b.length;if(!H)return 0;let E=0,h=0;if(this._interim){const D=b.charCodeAt(h++);56320<=D&&D<=57343?A[E++]=1024*(this._interim-55296)+D-56320+65536:(A[E++]=this._interim,A[E++]=D),this._interim=0}for(let D=h;D<H;++D){const f=b.charCodeAt(D);if(55296<=f&&f<=56319){if(++D>=H)return this._interim=f,E;const S=b.charCodeAt(D);56320<=S&&S<=57343?A[E++]=1024*(f-55296)+S-56320+65536:(A[E++]=f,A[E++]=S)}else f!==65279&&(A[E++]=f)}return E}},v.Utf8ToUtf32=class{constructor(){this.interim=new Uint8Array(3)}clear(){this.interim.fill(0)}decode(b,A){const H=b.length;if(!H)return 0;let E,h,D,f,S=0,g=0,w=0;if(this.interim[0]){let p=!1,$=this.interim[0];$&=(224&$)==192?31:(240&$)==224?15:7;let F,O=0;for(;(F=63&this.interim[++O])&&O<4;)$<<=6,$|=F;const L=(224&this.interim[0])==192?2:(240&this.interim[0])==224?3:4,Z=L-O;for(;w<Z;){if(w>=H)return 0;if(F=b[w++],(192&F)!=128){w--,p=!0;break}this.interim[O++]=F,$<<=6,$|=63&F}p||(L===2?$<128?w--:A[S++]=$:L===3?$<2048||$>=55296&&$<=57343||$===65279||(A[S++]=$):$<65536||$>1114111||(A[S++]=$)),this.interim.fill(0)}const C=H-4;let R=w;for(;R<H;){for(;!(!(R<C)||128&(E=b[R])||128&(h=b[R+1])||128&(D=b[R+2])||128&(f=b[R+3]));)A[S++]=E,A[S++]=h,A[S++]=D,A[S++]=f,R+=4;if(E=b[R++],E<128)A[S++]=E;else if((224&E)==192){if(R>=H)return this.interim[0]=E,S;if(h=b[R++],(192&h)!=128){R--;continue}if(g=(31&E)<<6|63&h,g<128){R--;continue}A[S++]=g}else if((240&E)==224){if(R>=H)return this.interim[0]=E,S;if(h=b[R++],(192&h)!=128){R--;continue}if(R>=H)return this.interim[0]=E,this.interim[1]=h,S;if(D=b[R++],(192&D)!=128){R--;continue}if(g=(15&E)<<12|(63&h)<<6|63&D,g<2048||g>=55296&&g<=57343||g===65279)continue;A[S++]=g}else if((248&E)==240){if(R>=H)return this.interim[0]=E,S;if(h=b[R++],(192&h)!=128){R--;continue}if(R>=H)return this.interim[0]=E,this.interim[1]=h,S;if(D=b[R++],(192&D)!=128){R--;continue}if(R>=H)return this.interim[0]=E,this.interim[1]=h,this.interim[2]=D,S;if(f=b[R++],(192&f)!=128){R--;continue}if(g=(7&E)<<18|(63&h)<<12|(63&D)<<6|63&f,g<65536||g>1114111)continue;A[S++]=g}}return S}}},225:(P,v)=>{Object.defineProperty(v,"__esModule",{value:!0}),v.UnicodeV6=void 0;const b=[[768,879],[1155,1158],[1160,1161],[1425,1469],[1471,1471],[1473,1474],[1476,1477],[1479,1479],[1536,1539],[1552,1557],[1611,1630],[1648,1648],[1750,1764],[1767,1768],[1770,1773],[1807,1807],[1809,1809],[1840,1866],[1958,1968],[2027,2035],[2305,2306],[2364,2364],[2369,2376],[2381,2381],[2385,2388],[2402,2403],[2433,2433],[2492,2492],[2497,2500],[2509,2509],[2530,2531],[2561,2562],[2620,2620],[2625,2626],[2631,2632],[2635,2637],[2672,2673],[2689,2690],[2748,2748],[2753,2757],[2759,2760],[2765,2765],[2786,2787],[2817,2817],[2876,2876],[2879,2879],[2881,2883],[2893,2893],[2902,2902],[2946,2946],[3008,3008],[3021,3021],[3134,3136],[3142,3144],[3146,3149],[3157,3158],[3260,3260],[3263,3263],[3270,3270],[3276,3277],[3298,3299],[3393,3395],[3405,3405],[3530,3530],[3538,3540],[3542,3542],[3633,3633],[3636,3642],[3655,3662],[3761,3761],[3764,3769],[3771,3772],[3784,3789],[3864,3865],[3893,3893],[3895,3895],[3897,3897],[3953,3966],[3968,3972],[3974,3975],[3984,3991],[3993,4028],[4038,4038],[4141,4144],[4146,4146],[4150,4151],[4153,4153],[4184,4185],[4448,4607],[4959,4959],[5906,5908],[5938,5940],[5970,5971],[6002,6003],[6068,6069],[6071,6077],[6086,6086],[6089,6099],[6109,6109],[6155,6157],[6313,6313],[6432,6434],[6439,6440],[6450,6450],[6457,6459],[6679,6680],[6912,6915],[6964,6964],[6966,6970],[6972,6972],[6978,6978],[7019,7027],[7616,7626],[7678,7679],[8203,8207],[8234,8238],[8288,8291],[8298,8303],[8400,8431],[12330,12335],[12441,12442],[43014,43014],[43019,43019],[43045,43046],[64286,64286],[65024,65039],[65056,65059],[65279,65279],[65529,65531]],A=[[68097,68099],[68101,68102],[68108,68111],[68152,68154],[68159,68159],[119143,119145],[119155,119170],[119173,119179],[119210,119213],[119362,119364],[917505,917505],[917536,917631],[917760,917999]];let H;v.UnicodeV6=class{constructor(){if(this.version="6",!H){H=new Uint8Array(65536),H.fill(1),H[0]=0,H.fill(0,1,32),H.fill(0,127,160),H.fill(2,4352,4448),H[9001]=2,H[9002]=2,H.fill(2,11904,42192),H[12351]=1,H.fill(2,44032,55204),H.fill(2,63744,64256),H.fill(2,65040,65050),H.fill(2,65072,65136),H.fill(2,65280,65377),H.fill(2,65504,65511);for(let E=0;E<b.length;++E)H.fill(0,b[E][0],b[E][1]+1)}}wcwidth(E){return E<32?0:E<127?1:E<65536?H[E]:function(h,D){let f,S=0,g=D.length-1;if(h<D[0][0]||h>D[g][1])return!1;for(;g>=S;)if(f=S+g>>1,h>D[f][1])S=f+1;else{if(!(h<D[f][0]))return!0;g=f-1}return!1}(E,A)?0:E>=131072&&E<=196605||E>=196608&&E<=262141?2:1}}},5981:(P,v,b)=>{Object.defineProperty(v,"__esModule",{value:!0}),v.WriteBuffer=void 0;const A=b(8460),H=b(844);class E extends H.Disposable{constructor(h){super(),this._action=h,this._writeBuffer=[],this._callbacks=[],this._pendingData=0,this._bufferOffset=0,this._isSyncWriting=!1,this._syncCalls=0,this._didUserInput=!1,this._onWriteParsed=this.register(new A.EventEmitter),this.onWriteParsed=this._onWriteParsed.event}handleUserInput(){this._didUserInput=!0}writeSync(h,D){if(D!==void 0&&this._syncCalls>D)return void(this._syncCalls=0);if(this._pendingData+=h.length,this._writeBuffer.push(h),this._callbacks.push(void 0),this._syncCalls++,this._isSyncWriting)return;let f;for(this._isSyncWriting=!0;f=this._writeBuffer.shift();){this._action(f);const S=this._callbacks.shift();S&&S()}this._pendingData=0,this._bufferOffset=2147483647,this._isSyncWriting=!1,this._syncCalls=0}write(h,D){if(this._pendingData>50000000)throw new Error("write data discarded, use flow control to avoid losing data");if(!this._writeBuffer.length){if(this._bufferOffset=0,this._didUserInput)return this._didUserInput=!1,this._pendingData+=h.length,this._writeBuffer.push(h),this._callbacks.push(D),void this._innerWrite();setTimeout(()=>this._innerWrite())}this._pendingData+=h.length,this._writeBuffer.push(h),this._callbacks.push(D)}_innerWrite(h=0,D=!0){const f=h||Date.now();for(;this._writeBuffer.length>this._bufferOffset;){const S=this._writeBuffer[this._bufferOffset],g=this._action(S,D);if(g){const C=(R)=>Date.now()-f>=12?setTimeout(()=>this._innerWrite(0,R)):this._innerWrite(f,R);return void g.catch((R)=>(queueMicrotask(()=>{throw R}),Promise.resolve(!1))).then(C)}const w=this._callbacks[this._bufferOffset];if(w&&w(),this._bufferOffset++,this._pendingData-=S.length,Date.now()-f>=12)break}this._writeBuffer.length>this._bufferOffset?(this._bufferOffset>50&&(this._writeBuffer=this._writeBuffer.slice(this._bufferOffset),this._callbacks=this._callbacks.slice(this._bufferOffset),this._bufferOffset=0),setTimeout(()=>this._innerWrite())):(this._writeBuffer.length=0,this._callbacks.length=0,this._pendingData=0,this._bufferOffset=0),this._onWriteParsed.fire()}}v.WriteBuffer=E},5941:(P,v)=>{Object.defineProperty(v,"__esModule",{value:!0}),v.toRgbString=v.parseColor=void 0;const b=/^([\da-f])\/([\da-f])\/([\da-f])$|^([\da-f]{2})\/([\da-f]{2})\/([\da-f]{2})$|^([\da-f]{3})\/([\da-f]{3})\/([\da-f]{3})$|^([\da-f]{4})\/([\da-f]{4})\/([\da-f]{4})$/,A=/^[\da-f]+$/;function H(E,h){const D=E.toString(16),f=D.length<2?"0"+D:D;switch(h){case 4:return D[0];case 8:return f;case 12:return(f+f).slice(0,3);default:return f+f}}v.parseColor=function(E){if(!E)return;let h=E.toLowerCase();if(h.indexOf("rgb:")===0){h=h.slice(4);const D=b.exec(h);if(D){const f=D[1]?15:D[4]?255:D[7]?4095:65535;return[Math.round(parseInt(D[1]||D[4]||D[7]||D[10],16)/f*255),Math.round(parseInt(D[2]||D[5]||D[8]||D[11],16)/f*255),Math.round(parseInt(D[3]||D[6]||D[9]||D[12],16)/f*255)]}}else if(h.indexOf("#")===0&&(h=h.slice(1),A.exec(h)&&[3,6,9,12].includes(h.length))){const D=h.length/3,f=[0,0,0];for(let S=0;S<3;++S){const g=parseInt(h.slice(D*S,D*S+D),16);f[S]=D===1?g<<4:D===2?g:D===3?g>>4:g>>8}return f}},v.toRgbString=function(E,h=16){const[D,f,S]=E;return`rgb:${H(D,h)}/${H(f,h)}/${H(S,h)}`}},5770:(P,v)=>{Object.defineProperty(v,"__esModule",{value:!0}),v.PAYLOAD_LIMIT=void 0,v.PAYLOAD_LIMIT=1e7},6351:(P,v,b)=>{Object.defineProperty(v,"__esModule",{value:!0}),v.DcsHandler=v.DcsParser=void 0;const A=b(482),H=b(8742),E=b(5770),h=[];v.DcsParser=class{constructor(){this._handlers=Object.create(null),this._active=h,this._ident=0,this._handlerFb=()=>{},this._stack={paused:!1,loopPosition:0,fallThrough:!1}}dispose(){this._handlers=Object.create(null),this._handlerFb=()=>{},this._active=h}registerHandler(f,S){this._handlers[f]===void 0&&(this._handlers[f]=[]);const g=this._handlers[f];return g.push(S),{dispose:()=>{const w=g.indexOf(S);w!==-1&&g.splice(w,1)}}}clearHandler(f){this._handlers[f]&&delete this._handlers[f]}setHandlerFallback(f){this._handlerFb=f}reset(){if(this._active.length)for(let f=this._stack.paused?this._stack.loopPosition-1:this._active.length-1;f>=0;--f)this._active[f].unhook(!1);this._stack.paused=!1,this._active=h,this._ident=0}hook(f,S){if(this.reset(),this._ident=f,this._active=this._handlers[f]||h,this._active.length)for(let g=this._active.length-1;g>=0;g--)this._active[g].hook(S);else this._handlerFb(this._ident,"HOOK",S)}put(f,S,g){if(this._active.length)for(let w=this._active.length-1;w>=0;w--)this._active[w].put(f,S,g);else this._handlerFb(this._ident,"PUT",A.utf32ToString(f,S,g))}unhook(f,S=!0){if(this._active.length){let g=!1,w=this._active.length-1,C=!1;if(this._stack.paused&&(w=this._stack.loopPosition-1,g=S,C=this._stack.fallThrough,this._stack.paused=!1),!C&&g===!1){for(;w>=0&&(g=this._active[w].unhook(f),g!==!0);w--)if(g instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=w,this._stack.fallThrough=!1,g;w--}for(;w>=0;w--)if(g=this._active[w].unhook(!1),g instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=w,this._stack.fallThrough=!0,g}else this._handlerFb(this._ident,"UNHOOK",f);this._active=h,this._ident=0}};const D=new H.Params;D.addParam(0),v.DcsHandler=class{constructor(f){this._handler=f,this._data="",this._params=D,this._hitLimit=!1}hook(f){this._params=f.length>1||f.params[0]?f.clone():D,this._data="",this._hitLimit=!1}put(f,S,g){this._hitLimit||(this._data+=A.utf32ToString(f,S,g),this._data.length>E.PAYLOAD_LIMIT&&(this._data="",this._hitLimit=!0))}unhook(f){let S=!1;if(this._hitLimit)S=!1;else if(f&&(S=this._handler(this._data,this._params),S instanceof Promise))return S.then((g)=>(this._params=D,this._data="",this._hitLimit=!1,g));return this._params=D,this._data="",this._hitLimit=!1,S}}},2015:(P,v,b)=>{Object.defineProperty(v,"__esModule",{value:!0}),v.EscapeSequenceParser=v.VT500_TRANSITION_TABLE=v.TransitionTable=void 0;const A=b(844),H=b(8742),E=b(6242),h=b(6351);class D{constructor(g){this.table=new Uint8Array(g)}setDefault(g,w){this.table.fill(g<<4|w)}add(g,w,C,R){this.table[w<<8|g]=C<<4|R}addMany(g,w,C,R){for(let p=0;p<g.length;p++)this.table[w<<8|g[p]]=C<<4|R}}v.TransitionTable=D;const f=160;v.VT500_TRANSITION_TABLE=function(){const g=new D(4095),w=Array.apply(null,Array(256)).map((O,L)=>L),C=(O,L)=>w.slice(O,L),R=C(32,127),p=C(0,24);p.push(25),p.push.apply(p,C(28,32));const $=C(0,14);let F;for(F in g.setDefault(1,0),g.addMany(R,0,2,0),$)g.addMany([24,26,153,154],F,3,0),g.addMany(C(128,144),F,3,0),g.addMany(C(144,152),F,3,0),g.add(156,F,0,0),g.add(27,F,11,1),g.add(157,F,4,8),g.addMany([152,158,159],F,0,7),g.add(155,F,11,3),g.add(144,F,11,9);return g.addMany(p,0,3,0),g.addMany(p,1,3,1),g.add(127,1,0,1),g.addMany(p,8,0,8),g.addMany(p,3,3,3),g.add(127,3,0,3),g.addMany(p,4,3,4),g.add(127,4,0,4),g.addMany(p,6,3,6),g.addMany(p,5,3,5),g.add(127,5,0,5),g.addMany(p,2,3,2),g.add(127,2,0,2),g.add(93,1,4,8),g.addMany(R,8,5,8),g.add(127,8,5,8),g.addMany([156,27,24,26,7],8,6,0),g.addMany(C(28,32),8,0,8),g.addMany([88,94,95],1,0,7),g.addMany(R,7,0,7),g.addMany(p,7,0,7),g.add(156,7,0,0),g.add(127,7,0,7),g.add(91,1,11,3),g.addMany(C(64,127),3,7,0),g.addMany(C(48,60),3,8,4),g.addMany([60,61,62,63],3,9,4),g.addMany(C(48,60),4,8,4),g.addMany(C(64,127),4,7,0),g.addMany([60,61,62,63],4,0,6),g.addMany(C(32,64),6,0,6),g.add(127,6,0,6),g.addMany(C(64,127),6,0,0),g.addMany(C(32,48),3,9,5),g.addMany(C(32,48),5,9,5),g.addMany(C(48,64),5,0,6),g.addMany(C(64,127),5,7,0),g.addMany(C(32,48),4,9,5),g.addMany(C(32,48),1,9,2),g.addMany(C(32,48),2,9,2),g.addMany(C(48,127),2,10,0),g.addMany(C(48,80),1,10,0),g.addMany(C(81,88),1,10,0),g.addMany([89,90,92],1,10,0),g.addMany(C(96,127),1,10,0),g.add(80,1,11,9),g.addMany(p,9,0,9),g.add(127,9,0,9),g.addMany(C(28,32),9,0,9),g.addMany(C(32,48),9,9,12),g.addMany(C(48,60),9,8,10),g.addMany([60,61,62,63],9,9,10),g.addMany(p,11,0,11),g.addMany(C(32,128),11,0,11),g.addMany(C(28,32),11,0,11),g.addMany(p,10,0,10),g.add(127,10,0,10),g.addMany(C(28,32),10,0,10),g.addMany(C(48,60),10,8,10),g.addMany([60,61,62,63],10,0,11),g.addMany(C(32,48),10,9,12),g.addMany(p,12,0,12),g.add(127,12,0,12),g.addMany(C(28,32),12,0,12),g.addMany(C(32,48),12,9,12),g.addMany(C(48,64),12,0,11),g.addMany(C(64,127),12,12,13),g.addMany(C(64,127),10,12,13),g.addMany(C(64,127),9,12,13),g.addMany(p,13,13,13),g.addMany(R,13,13,13),g.add(127,13,0,13),g.addMany([27,156,24,26],13,14,0),g.add(f,0,2,0),g.add(f,8,5,8),g.add(f,6,0,6),g.add(f,11,0,11),g.add(f,13,13,13),g}();class S extends A.Disposable{constructor(g=v.VT500_TRANSITION_TABLE){super(),this._transitions=g,this._parseStack={state:0,handlers:[],handlerPos:0,transition:0,chunkPos:0},this.initialState=0,this.currentState=this.initialState,this._params=new H.Params,this._params.addParam(0),this._collect=0,this.precedingCodepoint=0,this._printHandlerFb=(w,C,R)=>{},this._executeHandlerFb=(w)=>{},this._csiHandlerFb=(w,C)=>{},this._escHandlerFb=(w)=>{},this._errorHandlerFb=(w)=>w,this._printHandler=this._printHandlerFb,this._executeHandlers=Object.create(null),this._csiHandlers=Object.create(null),this._escHandlers=Object.create(null),this.register(A.toDisposable(()=>{this._csiHandlers=Object.create(null),this._executeHandlers=Object.create(null),this._escHandlers=Object.create(null)})),this._oscParser=this.register(new E.OscParser),this._dcsParser=this.register(new h.DcsParser),this._errorHandler=this._errorHandlerFb,this.registerEscHandler({final:"\\"},()=>!0)}_identifier(g,w=[64,126]){let C=0;if(g.prefix){if(g.prefix.length>1)throw new Error("only one byte as prefix supported");if(C=g.prefix.charCodeAt(0),C&&60>C||C>63)throw new Error("prefix must be in range 0x3c .. 0x3f")}if(g.intermediates){if(g.intermediates.length>2)throw new Error("only two bytes as intermediates are supported");for(let p=0;p<g.intermediates.length;++p){const $=g.intermediates.charCodeAt(p);if(32>$||$>47)throw new Error("intermediate must be in range 0x20 .. 0x2f");C<<=8,C|=$}}if(g.final.length!==1)throw new Error("final must be a single byte");const R=g.final.charCodeAt(0);if(w[0]>R||R>w[1])throw new Error(`final must be in range ${w[0]} .. ${w[1]}`);return C<<=8,C|=R,C}identToString(g){const w=[];for(;g;)w.push(String.fromCharCode(255&g)),g>>=8;return w.reverse().join("")}setPrintHandler(g){this._printHandler=g}clearPrintHandler(){this._printHandler=this._printHandlerFb}registerEscHandler(g,w){const C=this._identifier(g,[48,126]);this._escHandlers[C]===void 0&&(this._escHandlers[C]=[]);const R=this._escHandlers[C];return R.push(w),{dispose:()=>{const p=R.indexOf(w);p!==-1&&R.splice(p,1)}}}clearEscHandler(g){this._escHandlers[this._identifier(g,[48,126])]&&delete this._escHandlers[this._identifier(g,[48,126])]}setEscHandlerFallback(g){this._escHandlerFb=g}setExecuteHandler(g,w){this._executeHandlers[g.charCodeAt(0)]=w}clearExecuteHandler(g){this._executeHandlers[g.charCodeAt(0)]&&delete this._executeHandlers[g.charCodeAt(0)]}setExecuteHandlerFallback(g){this._executeHandlerFb=g}registerCsiHandler(g,w){const C=this._identifier(g);this._csiHandlers[C]===void 0&&(this._csiHandlers[C]=[]);const R=this._csiHandlers[C];return R.push(w),{dispose:()=>{const p=R.indexOf(w);p!==-1&&R.splice(p,1)}}}clearCsiHandler(g){this._csiHandlers[this._identifier(g)]&&delete this._csiHandlers[this._identifier(g)]}setCsiHandlerFallback(g){this._csiHandlerFb=g}registerDcsHandler(g,w){return this._dcsParser.registerHandler(this._identifier(g),w)}clearDcsHandler(g){this._dcsParser.clearHandler(this._identifier(g))}setDcsHandlerFallback(g){this._dcsParser.setHandlerFallback(g)}registerOscHandler(g,w){return this._oscParser.registerHandler(g,w)}clearOscHandler(g){this._oscParser.clearHandler(g)}setOscHandlerFallback(g){this._oscParser.setHandlerFallback(g)}setErrorHandler(g){this._errorHandler=g}clearErrorHandler(){this._errorHandler=this._errorHandlerFb}reset(){this.currentState=this.initialState,this._oscParser.reset(),this._dcsParser.reset(),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingCodepoint=0,this._parseStack.state!==0&&(this._parseStack.state=2,this._parseStack.handlers=[])}_preserveStack(g,w,C,R,p){this._parseStack.state=g,this._parseStack.handlers=w,this._parseStack.handlerPos=C,this._parseStack.transition=R,this._parseStack.chunkPos=p}parse(g,w,C){let R,p=0,$=0,F=0;if(this._parseStack.state)if(this._parseStack.state===2)this._parseStack.state=0,F=this._parseStack.chunkPos+1;else{if(C===void 0||this._parseStack.state===1)throw this._parseStack.state=1,new Error("improper continuation due to previous async handler, giving up parsing");const O=this._parseStack.handlers;let L=this._parseStack.handlerPos-1;switch(this._parseStack.state){case 3:if(C===!1&&L>-1){for(;L>=0&&(R=O[L](this._params),R!==!0);L--)if(R instanceof Promise)return this._parseStack.handlerPos=L,R}this._parseStack.handlers=[];break;case 4:if(C===!1&&L>-1){for(;L>=0&&(R=O[L](),R!==!0);L--)if(R instanceof Promise)return this._parseStack.handlerPos=L,R}this._parseStack.handlers=[];break;case 6:if(p=g[this._parseStack.chunkPos],R=this._dcsParser.unhook(p!==24&&p!==26,C),R)return R;p===27&&(this._parseStack.transition|=1),this._params.reset(),this._params.addParam(0),this._collect=0;break;case 5:if(p=g[this._parseStack.chunkPos],R=this._oscParser.end(p!==24&&p!==26,C),R)return R;p===27&&(this._parseStack.transition|=1),this._params.reset(),this._params.addParam(0),this._collect=0}this._parseStack.state=0,F=this._parseStack.chunkPos+1,this.precedingCodepoint=0,this.currentState=15&this._parseStack.transition}for(let O=F;O<w;++O){switch(p=g[O],$=this._transitions.table[this.currentState<<8|(p<160?p:f)],$>>4){case 2:for(let Y=O+1;;++Y){if(Y>=w||(p=g[Y])<32||p>126&&p<f){this._printHandler(g,O,Y),O=Y-1;break}if(++Y>=w||(p=g[Y])<32||p>126&&p<f){this._printHandler(g,O,Y),O=Y-1;break}if(++Y>=w||(p=g[Y])<32||p>126&&p<f){this._printHandler(g,O,Y),O=Y-1;break}if(++Y>=w||(p=g[Y])<32||p>126&&p<f){this._printHandler(g,O,Y),O=Y-1;break}}break;case 3:this._executeHandlers[p]?this._executeHandlers[p]():this._executeHandlerFb(p),this.precedingCodepoint=0;break;case 0:break;case 1:if(this._errorHandler({position:O,code:p,currentState:this.currentState,collect:this._collect,params:this._params,abort:!1}).abort)return;break;case 7:const L=this._csiHandlers[this._collect<<8|p];let Z=L?L.length-1:-1;for(;Z>=0&&(R=L[Z](this._params),R!==!0);Z--)if(R instanceof Promise)return this._preserveStack(3,L,Z,$,O),R;Z<0&&this._csiHandlerFb(this._collect<<8|p,this._params),this.precedingCodepoint=0;break;case 8:do switch(p){case 59:this._params.addParam(0);break;case 58:this._params.addSubParam(-1);break;default:this._params.addDigit(p-48)}while(++O<w&&(p=g[O])>47&&p<60);O--;break;case 9:this._collect<<=8,this._collect|=p;break;case 10:const W=this._escHandlers[this._collect<<8|p];let B=W?W.length-1:-1;for(;B>=0&&(R=W[B](),R!==!0);B--)if(R instanceof Promise)return this._preserveStack(4,W,B,$,O),R;B<0&&this._escHandlerFb(this._collect<<8|p),this.precedingCodepoint=0;break;case 11:this._params.reset(),this._params.addParam(0),this._collect=0;break;case 12:this._dcsParser.hook(this._collect<<8|p,this._params);break;case 13:for(let Y=O+1;;++Y)if(Y>=w||(p=g[Y])===24||p===26||p===27||p>127&&p<f){this._dcsParser.put(g,O,Y),O=Y-1;break}break;case 14:if(R=this._dcsParser.unhook(p!==24&&p!==26),R)return this._preserveStack(6,[],0,$,O),R;p===27&&($|=1),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingCodepoint=0;break;case 4:this._oscParser.start();break;case 5:for(let Y=O+1;;Y++)if(Y>=w||(p=g[Y])<32||p>127&&p<f){this._oscParser.put(g,O,Y),O=Y-1;break}break;case 6:if(R=this._oscParser.end(p!==24&&p!==26),R)return this._preserveStack(5,[],0,$,O),R;p===27&&($|=1),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingCodepoint=0}this.currentState=15&$}}}v.EscapeSequenceParser=S},6242:(P,v,b)=>{Object.defineProperty(v,"__esModule",{value:!0}),v.OscHandler=v.OscParser=void 0;const A=b(5770),H=b(482),E=[];v.OscParser=class{constructor(){this._state=0,this._active=E,this._id=-1,this._handlers=Object.create(null),this._handlerFb=()=>{},this._stack={paused:!1,loopPosition:0,fallThrough:!1}}registerHandler(h,D){this._handlers[h]===void 0&&(this._handlers[h]=[]);const f=this._handlers[h];return f.push(D),{dispose:()=>{const S=f.indexOf(D);S!==-1&&f.splice(S,1)}}}clearHandler(h){this._handlers[h]&&delete this._handlers[h]}setHandlerFallback(h){this._handlerFb=h}dispose(){this._handlers=Object.create(null),this._handlerFb=()=>{},this._active=E}reset(){if(this._state===2)for(let h=this._stack.paused?this._stack.loopPosition-1:this._active.length-1;h>=0;--h)this._active[h].end(!1);this._stack.paused=!1,this._active=E,this._id=-1,this._state=0}_start(){if(this._active=this._handlers[this._id]||E,this._active.length)for(let h=this._active.length-1;h>=0;h--)this._active[h].start();else this._handlerFb(this._id,"START")}_put(h,D,f){if(this._active.length)for(let S=this._active.length-1;S>=0;S--)this._active[S].put(h,D,f);else this._handlerFb(this._id,"PUT",H.utf32ToString(h,D,f))}start(){this.reset(),this._state=1}put(h,D,f){if(this._state!==3){if(this._state===1)for(;D<f;){const S=h[D++];if(S===59){this._state=2,this._start();break}if(S<48||57<S)return void(this._state=3);this._id===-1&&(this._id=0),this._id=10*this._id+S-48}this._state===2&&f-D>0&&this._put(h,D,f)}}end(h,D=!0){if(this._state!==0){if(this._state!==3)if(this._state===1&&this._start(),this._active.length){let f=!1,S=this._active.length-1,g=!1;if(this._stack.paused&&(S=this._stack.loopPosition-1,f=D,g=this._stack.fallThrough,this._stack.paused=!1),!g&&f===!1){for(;S>=0&&(f=this._active[S].end(h),f!==!0);S--)if(f instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=S,this._stack.fallThrough=!1,f;S--}for(;S>=0;S--)if(f=this._active[S].end(!1),f instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=S,this._stack.fallThrough=!0,f}else this._handlerFb(this._id,"END",h);this._active=E,this._id=-1,this._state=0}}},v.OscHandler=class{constructor(h){this._handler=h,this._data="",this._hitLimit=!1}start(){this._data="",this._hitLimit=!1}put(h,D,f){this._hitLimit||(this._data+=H.utf32ToString(h,D,f),this._data.length>A.PAYLOAD_LIMIT&&(this._data="",this._hitLimit=!0))}end(h){let D=!1;if(this._hitLimit)D=!1;else if(h&&(D=this._handler(this._data),D instanceof Promise))return D.then((f)=>(this._data="",this._hitLimit=!1,f));return this._data="",this._hitLimit=!1,D}}},8742:(P,v)=>{Object.defineProperty(v,"__esModule",{value:!0}),v.Params=void 0;const b=2147483647;class A{static fromArray(H){const E=new A;if(!H.length)return E;for(let h=Array.isArray(H[0])?1:0;h<H.length;++h){const D=H[h];if(Array.isArray(D))for(let f=0;f<D.length;++f)E.addSubParam(D[f]);else E.addParam(D)}return E}constructor(H=32,E=32){if(this.maxLength=H,this.maxSubParamsLength=E,E>256)throw new Error("maxSubParamsLength must not be greater than 256");this.params=new Int32Array(H),this.length=0,this._subParams=new Int32Array(E),this._subParamsLength=0,this._subParamsIdx=new Uint16Array(H),this._rejectDigits=!1,this._rejectSubDigits=!1,this._digitIsSub=!1}clone(){const H=new A(this.maxLength,this.maxSubParamsLength);return H.params.set(this.params),H.length=this.length,H._subParams.set(this._subParams),H._subParamsLength=this._subParamsLength,H._subParamsIdx.set(this._subParamsIdx),H._rejectDigits=this._rejectDigits,H._rejectSubDigits=this._rejectSubDigits,H._digitIsSub=this._digitIsSub,H}toArray(){const H=[];for(let E=0;E<this.length;++E){H.push(this.params[E]);const h=this._subParamsIdx[E]>>8,D=255&this._subParamsIdx[E];D-h>0&&H.push(Array.prototype.slice.call(this._subParams,h,D))}return H}reset(){this.length=0,this._subParamsLength=0,this._rejectDigits=!1,this._rejectSubDigits=!1,this._digitIsSub=!1}addParam(H){if(this._digitIsSub=!1,this.length>=this.maxLength)this._rejectDigits=!0;else{if(H<-1)throw new Error("values lesser than -1 are not allowed");this._subParamsIdx[this.length]=this._subParamsLength<<8|this._subParamsLength,this.params[this.length++]=H>b?b:H}}addSubParam(H){if(this._digitIsSub=!0,this.length)if(this._rejectDigits||this._subParamsLength>=this.maxSubParamsLength)this._rejectSubDigits=!0;else{if(H<-1)throw new Error("values lesser than -1 are not allowed");this._subParams[this._subParamsLength++]=H>b?b:H,this._subParamsIdx[this.length-1]++}}hasSubParams(H){return(255&this._subParamsIdx[H])-(this._subParamsIdx[H]>>8)>0}getSubParams(H){const E=this._subParamsIdx[H]>>8,h=255&this._subParamsIdx[H];return h-E>0?this._subParams.subarray(E,h):null}getSubParamsAll(){const H={};for(let E=0;E<this.length;++E){const h=this._subParamsIdx[E]>>8,D=255&this._subParamsIdx[E];D-h>0&&(H[E]=this._subParams.slice(h,D))}return H}addDigit(H){let E;if(this._rejectDigits||!(E=this._digitIsSub?this._subParamsLength:this.length)||this._digitIsSub&&this._rejectSubDigits)return;const h=this._digitIsSub?this._subParams:this.params,D=h[E-1];h[E-1]=~D?Math.min(10*D+H,b):H}}v.Params=A},5741:(P,v)=>{Object.defineProperty(v,"__esModule",{value:!0}),v.AddonManager=void 0,v.AddonManager=class{constructor(){this._addons=[]}dispose(){for(let b=this._addons.length-1;b>=0;b--)this._addons[b].instance.dispose()}loadAddon(b,A){const H={instance:A,dispose:A.dispose,isDisposed:!1};this._addons.push(H),A.dispose=()=>this._wrappedAddonDispose(H),A.activate(b)}_wrappedAddonDispose(b){if(b.isDisposed)return;let A=-1;for(let H=0;H<this._addons.length;H++)if(this._addons[H]===b){A=H;break}if(A===-1)throw new Error("Could not dispose an addon that has not been loaded");b.isDisposed=!0,b.dispose.apply(b.instance),this._addons.splice(A,1)}}},8771:(P,v,b)=>{Object.defineProperty(v,"__esModule",{value:!0}),v.BufferApiView=void 0;const A=b(3785),H=b(511);v.BufferApiView=class{constructor(E,h){this._buffer=E,this.type=h}init(E){return this._buffer=E,this}get cursorY(){return this._buffer.y}get cursorX(){return this._buffer.x}get viewportY(){return this._buffer.ydisp}get baseY(){return this._buffer.ybase}get length(){return this._buffer.lines.length}getLine(E){const h=this._buffer.lines.get(E);if(h)return new A.BufferLineApiView(h)}getNullCell(){return new H.CellData}}},3785:(P,v,b)=>{Object.defineProperty(v,"__esModule",{value:!0}),v.BufferLineApiView=void 0;const A=b(511);v.BufferLineApiView=class{constructor(H){this._line=H}get isWrapped(){return this._line.isWrapped}get length(){return this._line.length}getCell(H,E){if(!(H<0||H>=this._line.length))return E?(this._line.loadCell(H,E),E):this._line.loadCell(H,new A.CellData)}translateToString(H,E,h){return this._line.translateToString(H,E,h)}}},8285:(P,v,b)=>{Object.defineProperty(v,"__esModule",{value:!0}),v.BufferNamespaceApi=void 0;const A=b(8771),H=b(8460),E=b(844);class h extends E.Disposable{constructor(D){super(),this._core=D,this._onBufferChange=this.register(new H.EventEmitter),this.onBufferChange=this._onBufferChange.event,this._normal=new A.BufferApiView(this._core.buffers.normal,"normal"),this._alternate=new A.BufferApiView(this._core.buffers.alt,"alternate"),this._core.buffers.onBufferActivate(()=>this._onBufferChange.fire(this.active))}get active(){if(this._core.buffers.active===this._core.buffers.normal)return this.normal;if(this._core.buffers.active===this._core.buffers.alt)return this.alternate;throw new Error("Active buffer is neither normal nor alternate")}get normal(){return this._normal.init(this._core.buffers.normal)}get alternate(){return this._alternate.init(this._core.buffers.alt)}}v.BufferNamespaceApi=h},7975:(P,v)=>{Object.defineProperty(v,"__esModule",{value:!0}),v.ParserApi=void 0,v.ParserApi=class{constructor(b){this._core=b}registerCsiHandler(b,A){return this._core.registerCsiHandler(b,(H)=>A(H.toArray()))}addCsiHandler(b,A){return this.registerCsiHandler(b,A)}registerDcsHandler(b,A){return this._core.registerDcsHandler(b,(H,E)=>A(H,E.toArray()))}addDcsHandler(b,A){return this.registerDcsHandler(b,A)}registerEscHandler(b,A){return this._core.registerEscHandler(b,A)}addEscHandler(b,A){return this.registerEscHandler(b,A)}registerOscHandler(b,A){return this._core.registerOscHandler(b,A)}addOscHandler(b,A){return this.registerOscHandler(b,A)}}},7090:(P,v)=>{Object.defineProperty(v,"__esModule",{value:!0}),v.UnicodeApi=void 0,v.UnicodeApi=class{constructor(b){this._core=b}register(b){this._core.unicodeService.register(b)}get versions(){return this._core.unicodeService.versions}get activeVersion(){return this._core.unicodeService.activeVersion}set activeVersion(b){this._core.unicodeService.activeVersion=b}}},744:function(P,v,b){var A=this&&this.__decorate||function(g,w,C,R){var p,$=arguments.length,F=$<3?w:R===null?R=Object.getOwnPropertyDescriptor(w,C):R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")F=Reflect.decorate(g,w,C,R);else for(var O=g.length-1;O>=0;O--)(p=g[O])&&(F=($<3?p(F):$>3?p(w,C,F):p(w,C))||F);return $>3&&F&&Object.defineProperty(w,C,F),F},H=this&&this.__param||function(g,w){return function(C,R){w(C,R,g)}};Object.defineProperty(v,"__esModule",{value:!0}),v.BufferService=v.MINIMUM_ROWS=v.MINIMUM_COLS=void 0;const E=b(8460),h=b(844),D=b(5295),f=b(2585);v.MINIMUM_COLS=2,v.MINIMUM_ROWS=1;let S=v.BufferService=class extends h.Disposable{get buffer(){return this.buffers.active}constructor(g){super(),this.isUserScrolling=!1,this._onResize=this.register(new E.EventEmitter),this.onResize=this._onResize.event,this._onScroll=this.register(new E.EventEmitter),this.onScroll=this._onScroll.event,this.cols=Math.max(g.rawOptions.cols||0,v.MINIMUM_COLS),this.rows=Math.max(g.rawOptions.rows||0,v.MINIMUM_ROWS),this.buffers=this.register(new D.BufferSet(g,this))}resize(g,w){this.cols=g,this.rows=w,this.buffers.resize(g,w),this._onResize.fire({cols:g,rows:w})}reset(){this.buffers.reset(),this.isUserScrolling=!1}scroll(g,w=!1){const C=this.buffer;let R;R=this._cachedBlankLine,R&&R.length===this.cols&&R.getFg(0)===g.fg&&R.getBg(0)===g.bg||(R=C.getBlankLine(g,w),this._cachedBlankLine=R),R.isWrapped=w;const p=C.ybase+C.scrollTop,$=C.ybase+C.scrollBottom;if(C.scrollTop===0){const F=C.lines.isFull;$===C.lines.length-1?F?C.lines.recycle().copyFrom(R):C.lines.push(R.clone()):C.lines.splice($+1,0,R.clone()),F?this.isUserScrolling&&(C.ydisp=Math.max(C.ydisp-1,0)):(C.ybase++,this.isUserScrolling||C.ydisp++)}else{const F=$-p+1;C.lines.shiftElements(p+1,F-1,-1),C.lines.set($,R.clone())}this.isUserScrolling||(C.ydisp=C.ybase),this._onScroll.fire(C.ydisp)}scrollLines(g,w,C){const R=this.buffer;if(g<0){if(R.ydisp===0)return;this.isUserScrolling=!0}else g+R.ydisp>=R.ybase&&(this.isUserScrolling=!1);const p=R.ydisp;R.ydisp=Math.max(Math.min(R.ydisp+g,R.ybase),0),p!==R.ydisp&&(w||this._onScroll.fire(R.ydisp))}};v.BufferService=S=A([H(0,f.IOptionsService)],S)},7994:(P,v)=>{Object.defineProperty(v,"__esModule",{value:!0}),v.CharsetService=void 0,v.CharsetService=class{constructor(){this.glevel=0,this._charsets=[]}reset(){this.charset=void 0,this._charsets=[],this.glevel=0}setgLevel(b){this.glevel=b,this.charset=this._charsets[b]}setgCharset(b,A){this._charsets[b]=A,this.glevel===b&&(this.charset=A)}}},1753:function(P,v,b){var A=this&&this.__decorate||function(R,p,$,F){var O,L=arguments.length,Z=L<3?p:F===null?F=Object.getOwnPropertyDescriptor(p,$):F;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")Z=Reflect.decorate(R,p,$,F);else for(var W=R.length-1;W>=0;W--)(O=R[W])&&(Z=(L<3?O(Z):L>3?O(p,$,Z):O(p,$))||Z);return L>3&&Z&&Object.defineProperty(p,$,Z),Z},H=this&&this.__param||function(R,p){return function($,F){p($,F,R)}};Object.defineProperty(v,"__esModule",{value:!0}),v.CoreMouseService=void 0;const E=b(2585),h=b(8460),D=b(844),f={NONE:{events:0,restrict:()=>!1},X10:{events:1,restrict:(R)=>R.button!==4&&R.action===1&&(R.ctrl=!1,R.alt=!1,R.shift=!1,!0)},VT200:{events:19,restrict:(R)=>R.action!==32},DRAG:{events:23,restrict:(R)=>R.action!==32||R.button!==3},ANY:{events:31,restrict:(R)=>!0}};function S(R,p){let $=(R.ctrl?16:0)|(R.shift?4:0)|(R.alt?8:0);return R.button===4?($|=64,$|=R.action):($|=3&R.button,4&R.button&&($|=64),8&R.button&&($|=128),R.action===32?$|=32:R.action!==0||p||($|=3)),$}const g=String.fromCharCode,w={DEFAULT:(R)=>{const p=[S(R,!1)+32,R.col+32,R.row+32];return p[0]>255||p[1]>255||p[2]>255?"":`[M${g(p[0])}${g(p[1])}${g(p[2])}`},SGR:(R)=>{const p=R.action===0&&R.button!==4?"m":"M";return`[<${S(R,!0)};${R.col};${R.row}${p}`},SGR_PIXELS:(R)=>{const p=R.action===0&&R.button!==4?"m":"M";return`[<${S(R,!0)};${R.x};${R.y}${p}`}};let C=v.CoreMouseService=class extends D.Disposable{constructor(R,p){super(),this._bufferService=R,this._coreService=p,this._protocols={},this._encodings={},this._activeProtocol="",this._activeEncoding="",this._lastEvent=null,this._onProtocolChange=this.register(new h.EventEmitter),this.onProtocolChange=this._onProtocolChange.event;for(let $ of Object.keys(f))this.addProtocol($,f[$]);for(let $ of Object.keys(w))this.addEncoding($,w[$]);this.reset()}addProtocol(R,p){this._protocols[R]=p}addEncoding(R,p){this._encodings[R]=p}get activeProtocol(){return this._activeProtocol}get areMouseEventsActive(){return this._protocols[this._activeProtocol].events!==0}set activeProtocol(R){if(!this._protocols[R])throw new Error(`unknown protocol "${R}"`);this._activeProtocol=R,this._onProtocolChange.fire(this._protocols[R].events)}get activeEncoding(){return this._activeEncoding}set activeEncoding(R){if(!this._encodings[R])throw new Error(`unknown encoding "${R}"`);this._activeEncoding=R}reset(){this.activeProtocol="NONE",this.activeEncoding="DEFAULT",this._lastEvent=null}triggerMouseEvent(R){if(R.col<0||R.col>=this._bufferService.cols||R.row<0||R.row>=this._bufferService.rows)return!1;if(R.button===4&&R.action===32)return!1;if(R.button===3&&R.action!==32)return!1;if(R.button!==4&&(R.action===2||R.action===3))return!1;if(R.col++,R.row++,R.action===32&&this._lastEvent&&this._equalEvents(this._lastEvent,R,this._activeEncoding==="SGR_PIXELS"))return!1;if(!this._protocols[this._activeProtocol].restrict(R))return!1;const p=this._encodings[this._activeEncoding](R);return p&&(this._activeEncoding==="DEFAULT"?this._coreService.triggerBinaryEvent(p):this._coreService.triggerDataEvent(p,!0)),this._lastEvent=R,!0}explainEvents(R){return{down:!!(1&R),up:!!(2&R),drag:!!(4&R),move:!!(8&R),wheel:!!(16&R)}}_equalEvents(R,p,$){if($){if(R.x!==p.x)return!1;if(R.y!==p.y)return!1}else{if(R.col!==p.col)return!1;if(R.row!==p.row)return!1}return R.button===p.button&&R.action===p.action&&R.ctrl===p.ctrl&&R.alt===p.alt&&R.shift===p.shift}};v.CoreMouseService=C=A([H(0,E.IBufferService),H(1,E.ICoreService)],C)},6975:function(P,v,b){var A=this&&this.__decorate||function(C,R,p,$){var F,O=arguments.length,L=O<3?R:$===null?$=Object.getOwnPropertyDescriptor(R,p):$;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")L=Reflect.decorate(C,R,p,$);else for(var Z=C.length-1;Z>=0;Z--)(F=C[Z])&&(L=(O<3?F(L):O>3?F(R,p,L):F(R,p))||L);return O>3&&L&&Object.defineProperty(R,p,L),L},H=this&&this.__param||function(C,R){return function(p,$){R(p,$,C)}};Object.defineProperty(v,"__esModule",{value:!0}),v.CoreService=void 0;const E=b(1439),h=b(8460),D=b(844),f=b(2585),S=Object.freeze({insertMode:!1}),g=Object.freeze({applicationCursorKeys:!1,applicationKeypad:!1,bracketedPasteMode:!1,origin:!1,reverseWraparound:!1,sendFocus:!1,wraparound:!0});let w=v.CoreService=class extends D.Disposable{constructor(C,R,p){super(),this._bufferService=C,this._logService=R,this._optionsService=p,this.isCursorInitialized=!1,this.isCursorHidden=!1,this._onData=this.register(new h.EventEmitter),this.onData=this._onData.event,this._onUserInput=this.register(new h.EventEmitter),this.onUserInput=this._onUserInput.event,this._onBinary=this.register(new h.EventEmitter),this.onBinary=this._onBinary.event,this._onRequestScrollToBottom=this.register(new h.EventEmitter),this.onRequestScrollToBottom=this._onRequestScrollToBottom.event,this.modes=E.clone(S),this.decPrivateModes=E.clone(g)}reset(){this.modes=E.clone(S),this.decPrivateModes=E.clone(g)}triggerDataEvent(C,R=!1){if(this._optionsService.rawOptions.disableStdin)return;const p=this._bufferService.buffer;R&&this._optionsService.rawOptions.scrollOnUserInput&&p.ybase!==p.ydisp&&this._onRequestScrollToBottom.fire(),R&&this._onUserInput.fire(),this._logService.debug(`sending data "${C}"`,()=>C.split("").map(($)=>$.charCodeAt(0))),this._onData.fire(C)}triggerBinaryEvent(C){this._optionsService.rawOptions.disableStdin||(this._logService.debug(`sending binary "${C}"`,()=>C.split("").map((R)=>R.charCodeAt(0))),this._onBinary.fire(C))}};v.CoreService=w=A([H(0,f.IBufferService),H(1,f.ILogService),H(2,f.IOptionsService)],w)},9074:(P,v,b)=>{Object.defineProperty(v,"__esModule",{value:!0}),v.DecorationService=void 0;const A=b(8055),H=b(8460),E=b(844),h=b(6106);let D=0,f=0;class S extends E.Disposable{get decorations(){return this._decorations.values()}constructor(){super(),this._decorations=new h.SortedList((w)=>w==null?void 0:w.marker.line),this._onDecorationRegistered=this.register(new H.EventEmitter),this.onDecorationRegistered=this._onDecorationRegistered.event,this._onDecorationRemoved=this.register(new H.EventEmitter),this.onDecorationRemoved=this._onDecorationRemoved.event,this.register(E.toDisposable(()=>this.reset()))}registerDecoration(w){if(w.marker.isDisposed)return;const C=new g(w);if(C){const R=C.marker.onDispose(()=>C.dispose());C.onDispose(()=>{C&&(this._decorations.delete(C)&&this._onDecorationRemoved.fire(C),R.dispose())}),this._decorations.insert(C),this._onDecorationRegistered.fire(C)}return C}reset(){for(let w of this._decorations.values())w.dispose();this._decorations.clear()}*getDecorationsAtCell(w,C,R){var p,$,F;let O=0,L=0;for(let Z of this._decorations.getKeyIterator(C))O=(p=Z.options.x)!==null&&p!==void 0?p:0,L=O+(($=Z.options.width)!==null&&$!==void 0?$:1),w>=O&&w<L&&(!R||((F=Z.options.layer)!==null&&F!==void 0?F:"bottom")===R)&&(yield Z)}forEachDecorationAtCell(w,C,R,p){this._decorations.forEachByKey(C,($)=>{var F,O,L;D=(F=$.options.x)!==null&&F!==void 0?F:0,f=D+((O=$.options.width)!==null&&O!==void 0?O:1),w>=D&&w<f&&(!R||((L=$.options.layer)!==null&&L!==void 0?L:"bottom")===R)&&p($)})}}v.DecorationService=S;class g extends E.Disposable{get isDisposed(){return this._isDisposed}get backgroundColorRGB(){return this._cachedBg===null&&(this.options.backgroundColor?this._cachedBg=A.css.toColor(this.options.backgroundColor):this._cachedBg=void 0),this._cachedBg}get foregroundColorRGB(){return this._cachedFg===null&&(this.options.foregroundColor?this._cachedFg=A.css.toColor(this.options.foregroundColor):this._cachedFg=void 0),this._cachedFg}constructor(w){super(),this.options=w,this.onRenderEmitter=this.register(new H.EventEmitter),this.onRender=this.onRenderEmitter.event,this._onDispose=this.register(new H.EventEmitter),this.onDispose=this._onDispose.event,this._cachedBg=null,this._cachedFg=null,this.marker=w.marker,this.options.overviewRulerOptions&&!this.options.overviewRulerOptions.position&&(this.options.overviewRulerOptions.position="full")}dispose(){this._onDispose.fire(),super.dispose()}}},4348:(P,v,b)=>{Object.defineProperty(v,"__esModule",{value:!0}),v.InstantiationService=v.ServiceCollection=void 0;const A=b(2585),H=b(8343);class E{constructor(...h){this._entries=new Map;for(let[D,f]of h)this.set(D,f)}set(h,D){const f=this._entries.get(h);return this._entries.set(h,D),f}forEach(h){for(let[D,f]of this._entries.entries())h(D,f)}has(h){return this._entries.has(h)}get(h){return this._entries.get(h)}}v.ServiceCollection=E,v.InstantiationService=class{constructor(){this._services=new E,this._services.set(A.IInstantiationService,this)}setService(h,D){this._services.set(h,D)}getService(h){return this._services.get(h)}createInstance(h,...D){const f=H.getServiceDependencies(h).sort((w,C)=>w.index-C.index),S=[];for(let w of f){const C=this._services.get(w.id);if(!C)throw new Error(`[createInstance] ${h.name} depends on UNKNOWN service ${w.id}.`);S.push(C)}const g=f.length>0?f[0].index:D.length;if(D.length!==g)throw new Error(`[createInstance] First service dependency of ${h.name} at position ${g+1} conflicts with ${D.length} static arguments`);return new h(...[...D,...S])}}},7866:function(P,v,b){var A=this&&this.__decorate||function(g,w,C,R){var p,$=arguments.length,F=$<3?w:R===null?R=Object.getOwnPropertyDescriptor(w,C):R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")F=Reflect.decorate(g,w,C,R);else for(var O=g.length-1;O>=0;O--)(p=g[O])&&(F=($<3?p(F):$>3?p(w,C,F):p(w,C))||F);return $>3&&F&&Object.defineProperty(w,C,F),F},H=this&&this.__param||function(g,w){return function(C,R){w(C,R,g)}};Object.defineProperty(v,"__esModule",{value:!0}),v.traceCall=v.setTraceLogger=v.LogService=void 0;const E=b(844),h=b(2585),D={trace:h.LogLevelEnum.TRACE,debug:h.LogLevelEnum.DEBUG,info:h.LogLevelEnum.INFO,warn:h.LogLevelEnum.WARN,error:h.LogLevelEnum.ERROR,off:h.LogLevelEnum.OFF};let f,S=v.LogService=class extends E.Disposable{get logLevel(){return this._logLevel}constructor(g){super(),this._optionsService=g,this._logLevel=h.LogLevelEnum.OFF,this._updateLogLevel(),this.register(this._optionsService.onSpecificOptionChange("logLevel",()=>this._updateLogLevel())),f=this}_updateLogLevel(){this._logLevel=D[this._optionsService.rawOptions.logLevel]}_evalLazyOptionalParams(g){for(let w=0;w<g.length;w++)typeof g[w]=="function"&&(g[w]=g[w]())}_log(g,w,C){this._evalLazyOptionalParams(C),g.call(console,(this._optionsService.options.logger?"":"xterm.js: ")+w,...C)}trace(g,...w){var C,R;this._logLevel<=h.LogLevelEnum.TRACE&&this._log((R=(C=this._optionsService.options.logger)===null||C===void 0?void 0:C.trace.bind(this._optionsService.options.logger))!==null&&R!==void 0?R:console.log,g,w)}debug(g,...w){var C,R;this._logLevel<=h.LogLevelEnum.DEBUG&&this._log((R=(C=this._optionsService.options.logger)===null||C===void 0?void 0:C.debug.bind(this._optionsService.options.logger))!==null&&R!==void 0?R:console.log,g,w)}info(g,...w){var C,R;this._logLevel<=h.LogLevelEnum.INFO&&this._log((R=(C=this._optionsService.options.logger)===null||C===void 0?void 0:C.info.bind(this._optionsService.options.logger))!==null&&R!==void 0?R:console.info,g,w)}warn(g,...w){var C,R;this._logLevel<=h.LogLevelEnum.WARN&&this._log((R=(C=this._optionsService.options.logger)===null||C===void 0?void 0:C.warn.bind(this._optionsService.options.logger))!==null&&R!==void 0?R:console.warn,g,w)}error(g,...w){var C,R;this._logLevel<=h.LogLevelEnum.ERROR&&this._log((R=(C=this._optionsService.options.logger)===null||C===void 0?void 0:C.error.bind(this._optionsService.options.logger))!==null&&R!==void 0?R:console.error,g,w)}};v.LogService=S=A([H(0,h.IOptionsService)],S),v.setTraceLogger=function(g){f=g},v.traceCall=function(g,w,C){if(typeof C.value!="function")throw new Error("not supported");const R=C.value;C.value=function(...p){if(f.logLevel!==h.LogLevelEnum.TRACE)return R.apply(this,p);f.trace(`GlyphRenderer#${R.name}(${p.map((F)=>JSON.stringify(F)).join(", ")})`);const $=R.apply(this,p);return f.trace(`GlyphRenderer#${R.name} return`,$),$}}},7302:(P,v,b)=>{Object.defineProperty(v,"__esModule",{value:!0}),v.OptionsService=v.DEFAULT_OPTIONS=void 0;const A=b(8460),H=b(844),E=b(6114);v.DEFAULT_OPTIONS={cols:80,rows:24,cursorBlink:!1,cursorStyle:"block",cursorWidth:1,cursorInactiveStyle:"outline",customGlyphs:!0,drawBoldTextInBrightColors:!0,fastScrollModifier:"alt",fastScrollSensitivity:5,fontFamily:"courier-new, courier, monospace",fontSize:15,fontWeight:"normal",fontWeightBold:"bold",ignoreBracketedPasteMode:!1,lineHeight:1,letterSpacing:0,linkHandler:null,logLevel:"info",logger:null,scrollback:1000,scrollOnUserInput:!0,scrollSensitivity:1,screenReaderMode:!1,smoothScrollDuration:0,macOptionIsMeta:!1,macOptionClickForcesSelection:!1,minimumContrastRatio:1,disableStdin:!1,allowProposedApi:!1,allowTransparency:!1,tabStopWidth:8,theme:{},rightClickSelectsWord:E.isMac,windowOptions:{},windowsMode:!1,windowsPty:{},wordSeparator:" ()[]{}',\"`",altClickMovesCursor:!0,convertEol:!1,termName:"xterm",cancelEvents:!1,overviewRulerWidth:0};const h=["normal","bold","100","200","300","400","500","600","700","800","900"];class D extends H.Disposable{constructor(f){super(),this._onOptionChange=this.register(new A.EventEmitter),this.onOptionChange=this._onOptionChange.event;const S=Object.assign({},v.DEFAULT_OPTIONS);for(let g in f)if(g in S)try{const w=f[g];S[g]=this._sanitizeAndValidateOption(g,w)}catch(w){console.error(w)}this.rawOptions=S,this.options=Object.assign({},S),this._setupOptions()}onSpecificOptionChange(f,S){return this.onOptionChange((g)=>{g===f&&S(this.rawOptions[f])})}onMultipleOptionChange(f,S){return this.onOptionChange((g)=>{f.indexOf(g)!==-1&&S()})}_setupOptions(){const f=(g)=>{if(!(g in v.DEFAULT_OPTIONS))throw new Error(`No option with key "${g}"`);return this.rawOptions[g]},S=(g,w)=>{if(!(g in v.DEFAULT_OPTIONS))throw new Error(`No option with key "${g}"`);w=this._sanitizeAndValidateOption(g,w),this.rawOptions[g]!==w&&(this.rawOptions[g]=w,this._onOptionChange.fire(g))};for(let g in this.rawOptions){const w={get:f.bind(this,g),set:S.bind(this,g)};Object.defineProperty(this.options,g,w)}}_sanitizeAndValidateOption(f,S){switch(f){case"cursorStyle":if(S||(S=v.DEFAULT_OPTIONS[f]),!function(g){return g==="block"||g==="underline"||g==="bar"}(S))throw new Error(`"${S}" is not a valid value for ${f}`);break;case"wordSeparator":S||(S=v.DEFAULT_OPTIONS[f]);break;case"fontWeight":case"fontWeightBold":if(typeof S=="number"&&1<=S&&S<=1000)break;S=h.includes(S)?S:v.DEFAULT_OPTIONS[f];break;case"cursorWidth":S=Math.floor(S);case"lineHeight":case"tabStopWidth":if(S<1)throw new Error(`${f} cannot be less than 1, value: ${S}`);break;case"minimumContrastRatio":S=Math.max(1,Math.min(21,Math.round(10*S)/10));break;case"scrollback":if((S=Math.min(S,4294967295))<0)throw new Error(`${f} cannot be less than 0, value: ${S}`);break;case"fastScrollSensitivity":case"scrollSensitivity":if(S<=0)throw new Error(`${f} cannot be less than or equal to 0, value: ${S}`);break;case"rows":case"cols":if(!S&&S!==0)throw new Error(`${f} must be numeric, value: ${S}`);break;case"windowsPty":S=S!=null?S:{}}return S}}v.OptionsService=D},2660:function(P,v,b){var A=this&&this.__decorate||function(D,f,S,g){var w,C=arguments.length,R=C<3?f:g===null?g=Object.getOwnPropertyDescriptor(f,S):g;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")R=Reflect.decorate(D,f,S,g);else for(var p=D.length-1;p>=0;p--)(w=D[p])&&(R=(C<3?w(R):C>3?w(f,S,R):w(f,S))||R);return C>3&&R&&Object.defineProperty(f,S,R),R},H=this&&this.__param||function(D,f){return function(S,g){f(S,g,D)}};Object.defineProperty(v,"__esModule",{value:!0}),v.OscLinkService=void 0;const E=b(2585);let h=v.OscLinkService=class{constructor(D){this._bufferService=D,this._nextId=1,this._entriesWithId=new Map,this._dataByLinkId=new Map}registerLink(D){const f=this._bufferService.buffer;if(D.id===void 0){const p=f.addMarker(f.ybase+f.y),$={data:D,id:this._nextId++,lines:[p]};return p.onDispose(()=>this._removeMarkerFromLink($,p)),this._dataByLinkId.set($.id,$),$.id}const S=D,g=this._getEntryIdKey(S),w=this._entriesWithId.get(g);if(w)return this.addLineToLink(w.id,f.ybase+f.y),w.id;const C=f.addMarker(f.ybase+f.y),R={id:this._nextId++,key:this._getEntryIdKey(S),data:S,lines:[C]};return C.onDispose(()=>this._removeMarkerFromLink(R,C)),this._entriesWithId.set(R.key,R),this._dataByLinkId.set(R.id,R),R.id}addLineToLink(D,f){const S=this._dataByLinkId.get(D);if(S&&S.lines.every((g)=>g.line!==f)){const g=this._bufferService.buffer.addMarker(f);S.lines.push(g),g.onDispose(()=>this._removeMarkerFromLink(S,g))}}getLinkData(D){var f;return(f=this._dataByLinkId.get(D))===null||f===void 0?void 0:f.data}_getEntryIdKey(D){return`${D.id};;${D.uri}`}_removeMarkerFromLink(D,f){const S=D.lines.indexOf(f);S!==-1&&(D.lines.splice(S,1),D.lines.length===0&&(D.data.id!==void 0&&this._entriesWithId.delete(D.key),this._dataByLinkId.delete(D.id)))}};v.OscLinkService=h=A([H(0,E.IBufferService)],h)},8343:(P,v)=>{Object.defineProperty(v,"__esModule",{value:!0}),v.createDecorator=v.getServiceDependencies=v.serviceRegistry=void 0;const b="di$target",A="di$dependencies";v.serviceRegistry=new Map,v.getServiceDependencies=function(H){return H[A]||[]},v.createDecorator=function(H){if(v.serviceRegistry.has(H))return v.serviceRegistry.get(H);const E=function(h,D,f){if(arguments.length!==3)throw new Error("@IServiceName-decorator can only be used to decorate a parameter");(function(S,g,w){g[b]===g?g[A].push({id:S,index:w}):(g[A]=[{id:S,index:w}],g[b]=g)})(E,h,f)};return E.toString=()=>H,v.serviceRegistry.set(H,E),E}},2585:(P,v,b)=>{Object.defineProperty(v,"__esModule",{value:!0}),v.IDecorationService=v.IUnicodeService=v.IOscLinkService=v.IOptionsService=v.ILogService=v.LogLevelEnum=v.IInstantiationService=v.ICharsetService=v.ICoreService=v.ICoreMouseService=v.IBufferService=void 0;const A=b(8343);var H;v.IBufferService=A.createDecorator("BufferService"),v.ICoreMouseService=A.createDecorator("CoreMouseService"),v.ICoreService=A.createDecorator("CoreService"),v.ICharsetService=A.createDecorator("CharsetService"),v.IInstantiationService=A.createDecorator("InstantiationService"),function(E){E[E.TRACE=0]="TRACE",E[E.DEBUG=1]="DEBUG",E[E.INFO=2]="INFO",E[E.WARN=3]="WARN",E[E.ERROR=4]="ERROR",E[E.OFF=5]="OFF"}(H||(v.LogLevelEnum=H={})),v.ILogService=A.createDecorator("LogService"),v.IOptionsService=A.createDecorator("OptionsService"),v.IOscLinkService=A.createDecorator("OscLinkService"),v.IUnicodeService=A.createDecorator("UnicodeService"),v.IDecorationService=A.createDecorator("DecorationService")},1480:(P,v,b)=>{Object.defineProperty(v,"__esModule",{value:!0}),v.UnicodeService=void 0;const A=b(8460),H=b(225);v.UnicodeService=class{constructor(){this._providers=Object.create(null),this._active="",this._onChange=new A.EventEmitter,this.onChange=this._onChange.event;const E=new H.UnicodeV6;this.register(E),this._active=E.version,this._activeProvider=E}dispose(){this._onChange.dispose()}get versions(){return Object.keys(this._providers)}get activeVersion(){return this._active}set activeVersion(E){if(!this._providers[E])throw new Error(`unknown Unicode version "${E}"`);this._active=E,this._activeProvider=this._providers[E],this._onChange.fire(E)}register(E){this._providers[E.version]=E}wcwidth(E){return this._activeProvider.wcwidth(E)}getStringCellWidth(E){let h=0;const D=E.length;for(let f=0;f<D;++f){let S=E.charCodeAt(f);if(55296<=S&&S<=56319){if(++f>=D)return h+this.wcwidth(S);const g=E.charCodeAt(f);56320<=g&&g<=57343?S=1024*(S-55296)+g-56320+65536:h+=this.wcwidth(g)}h+=this.wcwidth(S)}return h}}}},x={};function j(P){var v=x[P];if(v!==void 0)return v.exports;var b=x[P]={exports:{}};return I[P].call(b.exports,b,b.exports,j),b.exports}var o={};return(()=>{var P=o;Object.defineProperty(P,"__esModule",{value:!0}),P.Terminal=void 0;const v=j(9042),b=j(3236),A=j(844),H=j(5741),E=j(8285),h=j(7975),D=j(7090),f=["cols","rows"];class S extends A.Disposable{constructor(g){super(),this._core=this.register(new b.Terminal(g)),this._addonManager=this.register(new H.AddonManager),this._publicOptions=Object.assign({},this._core.options);const w=(R)=>this._core.options[R],C=(R,p)=>{this._checkReadonlyOptions(R),this._core.options[R]=p};for(let R in this._core.options){const p={get:w.bind(this,R),set:C.bind(this,R)};Object.defineProperty(this._publicOptions,R,p)}}_checkReadonlyOptions(g){if(f.includes(g))throw new Error(`Option "${g}" can only be set in the constructor`)}_checkProposedApi(){if(!this._core.optionsService.rawOptions.allowProposedApi)throw new Error("You must set the allowProposedApi option to true to use proposed API")}get onBell(){return this._core.onBell}get onBinary(){return this._core.onBinary}get onCursorMove(){return this._core.onCursorMove}get onData(){return this._core.onData}get onKey(){return this._core.onKey}get onLineFeed(){return this._core.onLineFeed}get onRender(){return this._core.onRender}get onResize(){return this._core.onResize}get onScroll(){return this._core.onScroll}get onSelectionChange(){return this._core.onSelectionChange}get onTitleChange(){return this._core.onTitleChange}get onWriteParsed(){return this._core.onWriteParsed}get element(){return this._core.element}get parser(){return this._parser||(this._parser=new h.ParserApi(this._core)),this._parser}get unicode(){return this._checkProposedApi(),new D.UnicodeApi(this._core)}get textarea(){return this._core.textarea}get rows(){return this._core.rows}get cols(){return this._core.cols}get buffer(){return this._buffer||(this._buffer=this.register(new E.BufferNamespaceApi(this._core))),this._buffer}get markers(){return this._checkProposedApi(),this._core.markers}get modes(){const g=this._core.coreService.decPrivateModes;let w="none";switch(this._core.coreMouseService.activeProtocol){case"X10":w="x10";break;case"VT200":w="vt200";break;case"DRAG":w="drag";break;case"ANY":w="any"}return{applicationCursorKeysMode:g.applicationCursorKeys,applicationKeypadMode:g.applicationKeypad,bracketedPasteMode:g.bracketedPasteMode,insertMode:this._core.coreService.modes.insertMode,mouseTrackingMode:w,originMode:g.origin,reverseWraparoundMode:g.reverseWraparound,sendFocusMode:g.sendFocus,wraparoundMode:g.wraparound}}get options(){return this._publicOptions}set options(g){for(let w in g)this._publicOptions[w]=g[w]}blur(){this._core.blur()}focus(){this._core.focus()}resize(g,w){this._verifyIntegers(g,w),this._core.resize(g,w)}open(g){this._core.open(g)}attachCustomKeyEventHandler(g){this._core.attachCustomKeyEventHandler(g)}registerLinkProvider(g){return this._core.registerLinkProvider(g)}registerCharacterJoiner(g){return this._checkProposedApi(),this._core.registerCharacterJoiner(g)}deregisterCharacterJoiner(g){this._checkProposedApi(),this._core.deregisterCharacterJoiner(g)}registerMarker(g=0){return this._verifyIntegers(g),this._core.registerMarker(g)}registerDecoration(g){var w,C,R;return this._checkProposedApi(),this._verifyPositiveIntegers((w=g.x)!==null&&w!==void 0?w:0,(C=g.width)!==null&&C!==void 0?C:0,(R=g.height)!==null&&R!==void 0?R:0),this._core.registerDecoration(g)}hasSelection(){return this._core.hasSelection()}select(g,w,C){this._verifyIntegers(g,w,C),this._core.select(g,w,C)}getSelection(){return this._core.getSelection()}getSelectionPosition(){return this._core.getSelectionPosition()}clearSelection(){this._core.clearSelection()}selectAll(){this._core.selectAll()}selectLines(g,w){this._verifyIntegers(g,w),this._core.selectLines(g,w)}dispose(){super.dispose()}scrollLines(g){this._verifyIntegers(g),this._core.scrollLines(g)}scrollPages(g){this._verifyIntegers(g),this._core.scrollPages(g)}scrollToTop(){this._core.scrollToTop()}scrollToBottom(){this._core.scrollToBottom()}scrollToLine(g){this._verifyIntegers(g),this._core.scrollToLine(g)}clear(){this._core.clear()}write(g,w){this._core.write(g,w)}writeln(g,w){this._core.write(g),this._core.write("\r\n",w)}paste(g){this._core.paste(g)}refresh(g,w){this._verifyIntegers(g,w),this._core.refresh(g,w)}reset(){this._core.reset()}clearTextureAtlas(){this._core.clearTextureAtlas()}loadAddon(g){this._addonManager.loadAddon(this,g)}static get strings(){return v}_verifyIntegers(...g){for(let w of g)if(w===Infinity||isNaN(w)||w%1!=0)throw new Error("This API only accepts integers")}_verifyPositiveIntegers(...g){for(let w of g)if(w&&(w===Infinity||isNaN(w)||w%1!=0||w<0))throw new Error("This API only accepts positive integers")}}P.Terminal=S})(),o})())});var E1=U0((J0,x0)=>{(function(I,x){typeof J0=="object"&&typeof x0=="object"?x0.exports=x():typeof define=="function"&&define.amd?define([],x):typeof J0=="object"?J0.WebglAddon=x():I.WebglAddon=x()})(self,()=>(()=>{var I={965:function(P,v,b){var A=this&&this.__decorate||function(O,L,Z,W){var B,Y=arguments.length,G=Y<3?L:W===null?W=Object.getOwnPropertyDescriptor(L,Z):W;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")G=Reflect.decorate(O,L,Z,W);else for(var T=O.length-1;T>=0;T--)(B=O[T])&&(G=(Y<3?B(G):Y>3?B(L,Z,G):B(L,Z))||G);return Y>3&&G&&Object.defineProperty(L,Z,G),G};Object.defineProperty(v,"__esModule",{value:!0}),v.GlyphRenderer=void 0;const H=b(374),E=b(509),h=b(855),D=b(859),f=b(776),S=b(381),g=11,w=g*Float32Array.BYTES_PER_ELEMENT;let C,R=0,p=0,$=0;class F extends D.Disposable{constructor(O,L,Z){super(),this._terminal=O,this._gl=L,this._dimensions=Z,this._activeBuffer=0,this._vertices={count:0,attributes:new Float32Array(0),attributesBuffers:[new Float32Array(0),new Float32Array(0)]};const W=this._gl;E.TextureAtlas.maxAtlasPages===void 0&&(E.TextureAtlas.maxAtlasPages=Math.min(32,H.throwIfFalsy(W.getParameter(W.MAX_TEXTURE_IMAGE_UNITS))),E.TextureAtlas.maxTextureSize=H.throwIfFalsy(W.getParameter(W.MAX_TEXTURE_SIZE))),this._program=H.throwIfFalsy(S.createProgram(W,"#version 300 es\nlayout (location = 0) in vec2 a_unitquad;\nlayout (location = 1) in vec2 a_cellpos;\nlayout (location = 2) in vec2 a_offset;\nlayout (location = 3) in vec2 a_size;\nlayout (location = 4) in float a_texpage;\nlayout (location = 5) in vec2 a_texcoord;\nlayout (location = 6) in vec2 a_texsize;\n\nuniform mat4 u_projection;\nuniform vec2 u_resolution;\n\nout vec2 v_texcoord;\nflat out int v_texpage;\n\nvoid main() {\n  vec2 zeroToOne = (a_offset / u_resolution) + a_cellpos + (a_unitquad * a_size);\n  gl_Position = u_projection * vec4(zeroToOne, 0.0, 1.0);\n  v_texpage = int(a_texpage);\n  v_texcoord = a_texcoord + a_unitquad * a_texsize;\n}",function(X){let m="";for(let q=1;q<X;q++)m+=` else if (v_texpage == ${q}) { outColor = texture(u_texture[${q}], v_texcoord); }`;return`#version 300 es\nprecision lowp float;\n\nin vec2 v_texcoord;\nflat in int v_texpage;\n\nuniform sampler2D u_texture[${X}];\n\nout vec4 outColor;\n\nvoid main() {\n  if (v_texpage == 0) {\n    outColor = texture(u_texture[0], v_texcoord);\n  } ${m}\n}`}(E.TextureAtlas.maxAtlasPages))),this.register(D.toDisposable(()=>W.deleteProgram(this._program))),this._projectionLocation=H.throwIfFalsy(W.getUniformLocation(this._program,"u_projection")),this._resolutionLocation=H.throwIfFalsy(W.getUniformLocation(this._program,"u_resolution")),this._textureLocation=H.throwIfFalsy(W.getUniformLocation(this._program,"u_texture")),this._vertexArrayObject=W.createVertexArray(),W.bindVertexArray(this._vertexArrayObject);const B=new Float32Array([0,0,1,0,0,1,1,1]),Y=W.createBuffer();this.register(D.toDisposable(()=>W.deleteBuffer(Y))),W.bindBuffer(W.ARRAY_BUFFER,Y),W.bufferData(W.ARRAY_BUFFER,B,W.STATIC_DRAW),W.enableVertexAttribArray(0),W.vertexAttribPointer(0,2,this._gl.FLOAT,!1,0,0);const G=new Uint8Array([0,1,2,3]),T=W.createBuffer();this.register(D.toDisposable(()=>W.deleteBuffer(T))),W.bindBuffer(W.ELEMENT_ARRAY_BUFFER,T),W.bufferData(W.ELEMENT_ARRAY_BUFFER,G,W.STATIC_DRAW),this._attributesBuffer=H.throwIfFalsy(W.createBuffer()),this.register(D.toDisposable(()=>W.deleteBuffer(this._attributesBuffer))),W.bindBuffer(W.ARRAY_BUFFER,this._attributesBuffer),W.enableVertexAttribArray(2),W.vertexAttribPointer(2,2,W.FLOAT,!1,w,0),W.vertexAttribDivisor(2,1),W.enableVertexAttribArray(3),W.vertexAttribPointer(3,2,W.FLOAT,!1,w,2*Float32Array.BYTES_PER_ELEMENT),W.vertexAttribDivisor(3,1),W.enableVertexAttribArray(4),W.vertexAttribPointer(4,1,W.FLOAT,!1,w,4*Float32Array.BYTES_PER_ELEMENT),W.vertexAttribDivisor(4,1),W.enableVertexAttribArray(5),W.vertexAttribPointer(5,2,W.FLOAT,!1,w,5*Float32Array.BYTES_PER_ELEMENT),W.vertexAttribDivisor(5,1),W.enableVertexAttribArray(6),W.vertexAttribPointer(6,2,W.FLOAT,!1,w,7*Float32Array.BYTES_PER_ELEMENT),W.vertexAttribDivisor(6,1),W.enableVertexAttribArray(1),W.vertexAttribPointer(1,2,W.FLOAT,!1,w,9*Float32Array.BYTES_PER_ELEMENT),W.vertexAttribDivisor(1,1),W.useProgram(this._program);const J=new Int32Array(E.TextureAtlas.maxAtlasPages);for(let X=0;X<E.TextureAtlas.maxAtlasPages;X++)J[X]=X;W.uniform1iv(this._textureLocation,J),W.uniformMatrix4fv(this._projectionLocation,!1,S.PROJECTION_MATRIX),this._atlasTextures=[];for(let X=0;X<E.TextureAtlas.maxAtlasPages;X++){const m=new S.GLTexture(H.throwIfFalsy(W.createTexture()));this.register(D.toDisposable(()=>W.deleteTexture(m.texture))),W.activeTexture(W.TEXTURE0+X),W.bindTexture(W.TEXTURE_2D,m.texture),W.texParameteri(W.TEXTURE_2D,W.TEXTURE_WRAP_S,W.CLAMP_TO_EDGE),W.texParameteri(W.TEXTURE_2D,W.TEXTURE_WRAP_T,W.CLAMP_TO_EDGE),W.texImage2D(W.TEXTURE_2D,0,W.RGBA,1,1,0,W.RGBA,W.UNSIGNED_BYTE,new Uint8Array([255,0,0,255])),this._atlasTextures[X]=m}W.enable(W.BLEND),W.blendFunc(W.SRC_ALPHA,W.ONE_MINUS_SRC_ALPHA),this.handleResize()}beginFrame(){return!this._atlas||this._atlas.beginFrame()}updateCell(O,L,Z,W,B,Y,G,T){this._updateCell(this._vertices.attributes,O,L,Z,W,B,Y,G,T)}_updateCell(O,L,Z,W,B,Y,G,T,J){R=(Z*this._terminal.cols+L)*g,W!==h.NULL_CELL_CODE&&W!==void 0?this._atlas&&(C=T&&T.length>1?this._atlas.getRasterizedGlyphCombinedChar(T,B,Y,G,!1):this._atlas.getRasterizedGlyph(W,B,Y,G,!1),p=Math.floor((this._dimensions.device.cell.width-this._dimensions.device.char.width)/2),B!==J&&C.offset.x>p?($=C.offset.x-p,O[R]=-(C.offset.x-$)+this._dimensions.device.char.left,O[R+1]=-C.offset.y+this._dimensions.device.char.top,O[R+2]=(C.size.x-$)/this._dimensions.device.canvas.width,O[R+3]=C.size.y/this._dimensions.device.canvas.height,O[R+4]=C.texturePage,O[R+5]=C.texturePositionClipSpace.x+$/this._atlas.pages[C.texturePage].canvas.width,O[R+6]=C.texturePositionClipSpace.y,O[R+7]=C.sizeClipSpace.x-$/this._atlas.pages[C.texturePage].canvas.width,O[R+8]=C.sizeClipSpace.y):(O[R]=-C.offset.x+this._dimensions.device.char.left,O[R+1]=-C.offset.y+this._dimensions.device.char.top,O[R+2]=C.size.x/this._dimensions.device.canvas.width,O[R+3]=C.size.y/this._dimensions.device.canvas.height,O[R+4]=C.texturePage,O[R+5]=C.texturePositionClipSpace.x,O[R+6]=C.texturePositionClipSpace.y,O[R+7]=C.sizeClipSpace.x,O[R+8]=C.sizeClipSpace.y)):O.fill(0,R,R+g-1-2)}clear(){const O=this._terminal,L=O.cols*O.rows*g;this._vertices.count!==L?this._vertices.attributes=new Float32Array(L):this._vertices.attributes.fill(0);let Z=0;for(;Z<this._vertices.attributesBuffers.length;Z++)this._vertices.count!==L?this._vertices.attributesBuffers[Z]=new Float32Array(L):this._vertices.attributesBuffers[Z].fill(0);this._vertices.count=L,Z=0;for(let W=0;W<O.rows;W++)for(let B=0;B<O.cols;B++)this._vertices.attributes[Z+9]=B/O.cols,this._vertices.attributes[Z+10]=W/O.rows,Z+=g}handleResize(){const O=this._gl;O.useProgram(this._program),O.viewport(0,0,O.canvas.width,O.canvas.height),O.uniform2f(this._resolutionLocation,O.canvas.width,O.canvas.height),this.clear()}render(O){if(!this._atlas)return;const L=this._gl;L.useProgram(this._program),L.bindVertexArray(this._vertexArrayObject),this._activeBuffer=(this._activeBuffer+1)%2;const Z=this._vertices.attributesBuffers[this._activeBuffer];let W=0;for(let B=0;B<O.lineLengths.length;B++){const Y=B*this._terminal.cols*g,G=this._vertices.attributes.subarray(Y,Y+O.lineLengths[B]*g);Z.set(G,W),W+=G.length}L.bindBuffer(L.ARRAY_BUFFER,this._attributesBuffer),L.bufferData(L.ARRAY_BUFFER,Z.subarray(0,W),L.STREAM_DRAW);for(let B=0;B<this._atlas.pages.length;B++)this._atlas.pages[B].version!==this._atlasTextures[B].version&&this._bindAtlasPageTexture(L,this._atlas,B);L.drawElementsInstanced(L.TRIANGLE_STRIP,4,L.UNSIGNED_BYTE,0,W/g)}setAtlas(O){this._atlas=O;for(let L of this._atlasTextures)L.version=-1}_bindAtlasPageTexture(O,L,Z){O.activeTexture(O.TEXTURE0+Z),O.bindTexture(O.TEXTURE_2D,this._atlasTextures[Z].texture),O.texParameteri(O.TEXTURE_2D,O.TEXTURE_WRAP_S,O.CLAMP_TO_EDGE),O.texParameteri(O.TEXTURE_2D,O.TEXTURE_WRAP_T,O.CLAMP_TO_EDGE),O.texImage2D(O.TEXTURE_2D,0,O.RGBA,O.RGBA,O.UNSIGNED_BYTE,L.pages[Z].canvas),O.generateMipmap(O.TEXTURE_2D),this._atlasTextures[Z].version=L.pages[Z].version}setDimensions(O){this._dimensions=O}}v.GlyphRenderer=F,A([f.traceCall],F.prototype,"updateCell",null)},742:(P,v,b)=>{Object.defineProperty(v,"__esModule",{value:!0}),v.RectangleRenderer=void 0;const A=b(374),H=b(859),E=b(310),h=b(381),D=8*Float32Array.BYTES_PER_ELEMENT;class f{constructor(){this.attributes=new Float32Array(160),this.count=0}}let S=0,g=0,w=0,C=0,R=0,p=0,$=0;class F extends H.Disposable{constructor(O,L,Z,W){super(),this._terminal=O,this._gl=L,this._dimensions=Z,this._themeService=W,this._vertices=new f,this._verticesCursor=new f;const B=this._gl;this._program=A.throwIfFalsy(h.createProgram(B,"#version 300 es\nlayout (location = 0) in vec2 a_position;\nlayout (location = 1) in vec2 a_size;\nlayout (location = 2) in vec4 a_color;\nlayout (location = 3) in vec2 a_unitquad;\n\nuniform mat4 u_projection;\n\nout vec4 v_color;\n\nvoid main() {\n  vec2 zeroToOne = a_position + (a_unitquad * a_size);\n  gl_Position = u_projection * vec4(zeroToOne, 0.0, 1.0);\n  v_color = a_color;\n}","#version 300 es\nprecision lowp float;\n\nin vec4 v_color;\n\nout vec4 outColor;\n\nvoid main() {\n  outColor = v_color;\n}")),this.register(H.toDisposable(()=>B.deleteProgram(this._program))),this._projectionLocation=A.throwIfFalsy(B.getUniformLocation(this._program,"u_projection")),this._vertexArrayObject=B.createVertexArray(),B.bindVertexArray(this._vertexArrayObject);const Y=new Float32Array([0,0,1,0,0,1,1,1]),G=B.createBuffer();this.register(H.toDisposable(()=>B.deleteBuffer(G))),B.bindBuffer(B.ARRAY_BUFFER,G),B.bufferData(B.ARRAY_BUFFER,Y,B.STATIC_DRAW),B.enableVertexAttribArray(3),B.vertexAttribPointer(3,2,this._gl.FLOAT,!1,0,0);const T=new Uint8Array([0,1,2,3]),J=B.createBuffer();this.register(H.toDisposable(()=>B.deleteBuffer(J))),B.bindBuffer(B.ELEMENT_ARRAY_BUFFER,J),B.bufferData(B.ELEMENT_ARRAY_BUFFER,T,B.STATIC_DRAW),this._attributesBuffer=A.throwIfFalsy(B.createBuffer()),this.register(H.toDisposable(()=>B.deleteBuffer(this._attributesBuffer))),B.bindBuffer(B.ARRAY_BUFFER,this._attributesBuffer),B.enableVertexAttribArray(0),B.vertexAttribPointer(0,2,B.FLOAT,!1,D,0),B.vertexAttribDivisor(0,1),B.enableVertexAttribArray(1),B.vertexAttribPointer(1,2,B.FLOAT,!1,D,2*Float32Array.BYTES_PER_ELEMENT),B.vertexAttribDivisor(1,1),B.enableVertexAttribArray(2),B.vertexAttribPointer(2,4,B.FLOAT,!1,D,4*Float32Array.BYTES_PER_ELEMENT),B.vertexAttribDivisor(2,1),this._updateCachedColors(W.colors),this.register(this._themeService.onChangeColors((X)=>{this._updateCachedColors(X),this._updateViewportRectangle()}))}renderBackgrounds(){this._renderVertices(this._vertices)}renderCursor(){this._renderVertices(this._verticesCursor)}_renderVertices(O){const L=this._gl;L.useProgram(this._program),L.bindVertexArray(this._vertexArrayObject),L.uniformMatrix4fv(this._projectionLocation,!1,h.PROJECTION_MATRIX),L.bindBuffer(L.ARRAY_BUFFER,this._attributesBuffer),L.bufferData(L.ARRAY_BUFFER,O.attributes,L.DYNAMIC_DRAW),L.drawElementsInstanced(this._gl.TRIANGLE_STRIP,4,L.UNSIGNED_BYTE,0,O.count)}handleResize(){this._updateViewportRectangle()}setDimensions(O){this._dimensions=O}_updateCachedColors(O){this._bgFloat=this._colorToFloat32Array(O.background),this._cursorFloat=this._colorToFloat32Array(O.cursor)}_updateViewportRectangle(){this._addRectangleFloat(this._vertices.attributes,0,0,0,this._terminal.cols*this._dimensions.device.cell.width,this._terminal.rows*this._dimensions.device.cell.height,this._bgFloat)}updateBackgrounds(O){const L=this._terminal,Z=this._vertices;let W,B,Y,G,T,J,X,m,q,V,Q,k=1;for(W=0;W<L.rows;W++){for(Y=-1,G=0,T=0,J=!1,B=0;B<L.cols;B++)X=(W*L.cols+B)*E.RENDER_MODEL_INDICIES_PER_CELL,m=O.cells[X+E.RENDER_MODEL_BG_OFFSET],q=O.cells[X+E.RENDER_MODEL_FG_OFFSET],V=!!(67108864&q),(m!==G||q!==T&&(J||V))&&((G!==0||J&&T!==0)&&(Q=8*k++,this._updateRectangle(Z,Q,T,G,Y,B,W)),Y=B,G=m,T=q,J=V);(G!==0||J&&T!==0)&&(Q=8*k++,this._updateRectangle(Z,Q,T,G,Y,L.cols,W))}Z.count=k}updateCursor(O){const L=this._verticesCursor,Z=O.cursor;if(!Z||Z.style==="block")return void(L.count=0);let W,B=0;Z.style!=="bar"&&Z.style!=="outline"||(W=8*B++,this._addRectangleFloat(L.attributes,W,Z.x*this._dimensions.device.cell.width,Z.y*this._dimensions.device.cell.height,Z.style==="bar"?Z.dpr*Z.cursorWidth:Z.dpr,this._dimensions.device.cell.height,this._cursorFloat)),Z.style!=="underline"&&Z.style!=="outline"||(W=8*B++,this._addRectangleFloat(L.attributes,W,Z.x*this._dimensions.device.cell.width,(Z.y+1)*this._dimensions.device.cell.height-Z.dpr,Z.width*this._dimensions.device.cell.width,Z.dpr,this._cursorFloat)),Z.style==="outline"&&(W=8*B++,this._addRectangleFloat(L.attributes,W,Z.x*this._dimensions.device.cell.width,Z.y*this._dimensions.device.cell.height,Z.width*this._dimensions.device.cell.width,Z.dpr,this._cursorFloat),W=8*B++,this._addRectangleFloat(L.attributes,W,(Z.x+Z.width)*this._dimensions.device.cell.width-Z.dpr,Z.y*this._dimensions.device.cell.height,Z.dpr,this._dimensions.device.cell.height,this._cursorFloat)),L.count=B}_updateRectangle(O,L,Z,W,B,Y,G){if(67108864&Z)switch(50331648&Z){case 16777216:case 33554432:S=this._themeService.colors.ansi[255&Z].rgba;break;case 50331648:S=(16777215&Z)<<8;break;default:S=this._themeService.colors.foreground.rgba}else switch(50331648&W){case 16777216:case 33554432:S=this._themeService.colors.ansi[255&W].rgba;break;case 50331648:S=(16777215&W)<<8;break;default:S=this._themeService.colors.background.rgba}O.attributes.length<L+4&&(O.attributes=h.expandFloat32Array(O.attributes,this._terminal.rows*this._terminal.cols*8)),g=B*this._dimensions.device.cell.width,w=G*this._dimensions.device.cell.height,C=(S>>24&255)/255,R=(S>>16&255)/255,p=(S>>8&255)/255,$=1,this._addRectangle(O.attributes,L,g,w,(Y-B)*this._dimensions.device.cell.width,this._dimensions.device.cell.height,C,R,p,$)}_addRectangle(O,L,Z,W,B,Y,G,T,J,X){O[L]=Z/this._dimensions.device.canvas.width,O[L+1]=W/this._dimensions.device.canvas.height,O[L+2]=B/this._dimensions.device.canvas.width,O[L+3]=Y/this._dimensions.device.canvas.height,O[L+4]=G,O[L+5]=T,O[L+6]=J,O[L+7]=X}_addRectangleFloat(O,L,Z,W,B,Y,G){O[L]=Z/this._dimensions.device.canvas.width,O[L+1]=W/this._dimensions.device.canvas.height,O[L+2]=B/this._dimensions.device.canvas.width,O[L+3]=Y/this._dimensions.device.canvas.height,O[L+4]=G[0],O[L+5]=G[1],O[L+6]=G[2],O[L+7]=G[3]}_colorToFloat32Array(O){return new Float32Array([(O.rgba>>24&255)/255,(O.rgba>>16&255)/255,(O.rgba>>8&255)/255,(255&O.rgba)/255])}}v.RectangleRenderer=F},310:(P,v,b)=>{Object.defineProperty(v,"__esModule",{value:!0}),v.RenderModel=v.COMBINED_CHAR_BIT_MASK=v.RENDER_MODEL_EXT_OFFSET=v.RENDER_MODEL_FG_OFFSET=v.RENDER_MODEL_BG_OFFSET=v.RENDER_MODEL_INDICIES_PER_CELL=void 0;const A=b(296);v.RENDER_MODEL_INDICIES_PER_CELL=4,v.RENDER_MODEL_BG_OFFSET=1,v.RENDER_MODEL_FG_OFFSET=2,v.RENDER_MODEL_EXT_OFFSET=3,v.COMBINED_CHAR_BIT_MASK=2147483648,v.RenderModel=class{constructor(){this.cells=new Uint32Array(0),this.lineLengths=new Uint32Array(0),this.selection=A.createSelectionRenderModel()}resize(H,E){const h=H*E*v.RENDER_MODEL_INDICIES_PER_CELL;h!==this.cells.length&&(this.cells=new Uint32Array(h),this.lineLengths=new Uint32Array(E))}clear(){this.cells.fill(0,0),this.lineLengths.fill(0,0)}}},666:function(P,v,b){var A=this&&this.__decorate||function(G,T,J,X){var m,q=arguments.length,V=q<3?T:X===null?X=Object.getOwnPropertyDescriptor(T,J):X;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")V=Reflect.decorate(G,T,J,X);else for(var Q=G.length-1;Q>=0;Q--)(m=G[Q])&&(V=(q<3?m(V):q>3?m(T,J,V):m(T,J))||V);return q>3&&V&&Object.defineProperty(T,J,V),V};Object.defineProperty(v,"__esModule",{value:!0}),v.JoinedCellData=v.WebglRenderer=void 0;const H=b(820),E=b(274),h=b(627),D=b(457),f=b(56),S=b(374),g=b(345),w=b(859),C=b(147),R=b(782),p=b(855),$=b(776),F=b(965),O=b(742),L=b(310),Z=b(733);class W extends w.Disposable{constructor(G,T,J,X,m,q,V,Q,k){super(),this._terminal=G,this._characterJoinerService=T,this._charSizeService=J,this._coreBrowserService=X,this._coreService=m,this._decorationService=q,this._optionsService=V,this._themeService=Q,this._cursorBlinkStateManager=new w.MutableDisposable,this._charAtlasDisposable=this.register(new w.MutableDisposable),this._model=new L.RenderModel,this._workCell=new R.CellData,this._rectangleRenderer=this.register(new w.MutableDisposable),this._glyphRenderer=this.register(new w.MutableDisposable),this._onChangeTextureAtlas=this.register(new g.EventEmitter),this.onChangeTextureAtlas=this._onChangeTextureAtlas.event,this._onAddTextureAtlasCanvas=this.register(new g.EventEmitter),this.onAddTextureAtlasCanvas=this._onAddTextureAtlasCanvas.event,this._onRemoveTextureAtlasCanvas=this.register(new g.EventEmitter),this.onRemoveTextureAtlasCanvas=this._onRemoveTextureAtlasCanvas.event,this._onRequestRedraw=this.register(new g.EventEmitter),this.onRequestRedraw=this._onRequestRedraw.event,this._onContextLoss=this.register(new g.EventEmitter),this.onContextLoss=this._onContextLoss.event,this.register(this._themeService.onChangeColors(()=>this._handleColorChange())),this._cellColorResolver=new E.CellColorResolver(this._terminal,this._model.selection,this._decorationService,this._coreBrowserService,this._themeService),this._core=this._terminal._core,this._renderLayers=[new Z.LinkRenderLayer(this._core.screenElement,2,this._terminal,this._core.linkifier2,this._coreBrowserService,V,this._themeService)],this.dimensions=S.createRenderDimensions(),this._devicePixelRatio=this._coreBrowserService.dpr,this._updateDimensions(),this._updateCursorBlink(),this.register(V.onOptionChange(()=>this._handleOptionsChanged())),this._canvas=document.createElement("canvas");const N={antialias:!1,depth:!1,preserveDrawingBuffer:k};if(this._gl=this._canvas.getContext("webgl2",N),!this._gl)throw new Error("WebGL2 not supported "+this._gl);this.register(H.addDisposableDomListener(this._canvas,"webglcontextlost",(y)=>{console.log("webglcontextlost event received"),y.preventDefault(),this._contextRestorationTimeout=setTimeout(()=>{this._contextRestorationTimeout=void 0,console.warn("webgl context not restored; firing onContextLoss"),this._onContextLoss.fire(y)},3000)})),this.register(H.addDisposableDomListener(this._canvas,"webglcontextrestored",(y)=>{console.warn("webglcontextrestored event received"),clearTimeout(this._contextRestorationTimeout),this._contextRestorationTimeout=void 0,h.removeTerminalFromCache(this._terminal),this._initializeWebGLState(),this._requestRedrawViewport()})),this.register(f.observeDevicePixelDimensions(this._canvas,this._coreBrowserService.window,(y,u)=>this._setCanvasDevicePixelDimensions(y,u))),this._core.screenElement.appendChild(this._canvas),[this._rectangleRenderer.value,this._glyphRenderer.value]=this._initializeWebGLState(),this._isAttached=this._coreBrowserService.window.document.body.contains(this._core.screenElement),this.register(w.toDisposable(()=>{var y;for(let u of this._renderLayers)u.dispose();(y=this._canvas.parentElement)===null||y===void 0||y.removeChild(this._canvas),h.removeTerminalFromCache(this._terminal)}))}get textureAtlas(){var G;return(G=this._charAtlas)===null||G===void 0?void 0:G.pages[0].canvas}_handleColorChange(){this._refreshCharAtlas(),this._clearModel(!0)}handleDevicePixelRatioChange(){this._devicePixelRatio!==this._coreBrowserService.dpr&&(this._devicePixelRatio=this._coreBrowserService.dpr,this.handleResize(this._terminal.cols,this._terminal.rows))}handleResize(G,T){var J,X,m,q;this._updateDimensions(),this._model.resize(this._terminal.cols,this._terminal.rows);for(let V of this._renderLayers)V.resize(this._terminal,this.dimensions);this._canvas.width=this.dimensions.device.canvas.width,this._canvas.height=this.dimensions.device.canvas.height,this._canvas.style.width=`${this.dimensions.css.canvas.width}px`,this._canvas.style.height=`${this.dimensions.css.canvas.height}px`,this._core.screenElement.style.width=`${this.dimensions.css.canvas.width}px`,this._core.screenElement.style.height=`${this.dimensions.css.canvas.height}px`,(J=this._rectangleRenderer.value)===null||J===void 0||J.setDimensions(this.dimensions),(X=this._rectangleRenderer.value)===null||X===void 0||X.handleResize(),(m=this._glyphRenderer.value)===null||m===void 0||m.setDimensions(this.dimensions),(q=this._glyphRenderer.value)===null||q===void 0||q.handleResize(),this._refreshCharAtlas(),this._clearModel(!1)}handleCharSizeChanged(){this.handleResize(this._terminal.cols,this._terminal.rows)}handleBlur(){var G;for(let T of this._renderLayers)T.handleBlur(this._terminal);(G=this._cursorBlinkStateManager.value)===null||G===void 0||G.pause(),this._requestRedrawViewport()}handleFocus(){var G;for(let T of this._renderLayers)T.handleFocus(this._terminal);(G=this._cursorBlinkStateManager.value)===null||G===void 0||G.resume(),this._requestRedrawViewport()}handleSelectionChanged(G,T,J){for(let X of this._renderLayers)X.handleSelectionChanged(this._terminal,G,T,J);this._model.selection.update(this._terminal,G,T,J),this._requestRedrawViewport()}handleCursorMove(){var G;for(let T of this._renderLayers)T.handleCursorMove(this._terminal);(G=this._cursorBlinkStateManager.value)===null||G===void 0||G.restartBlinkAnimation()}_handleOptionsChanged(){this._updateDimensions(),this._refreshCharAtlas(),this._updateCursorBlink()}_initializeWebGLState(){return this._rectangleRenderer.value=new O.RectangleRenderer(this._terminal,this._gl,this.dimensions,this._themeService),this._glyphRenderer.value=new F.GlyphRenderer(this._terminal,this._gl,this.dimensions),this.handleCharSizeChanged(),[this._rectangleRenderer.value,this._glyphRenderer.value]}_refreshCharAtlas(){var G;if(this.dimensions.device.char.width<=0&&this.dimensions.device.char.height<=0)return void(this._isAttached=!1);const T=h.acquireTextureAtlas(this._terminal,this._optionsService.rawOptions,this._themeService.colors,this.dimensions.device.cell.width,this.dimensions.device.cell.height,this.dimensions.device.char.width,this.dimensions.device.char.height,this._coreBrowserService.dpr);this._charAtlas!==T&&(this._onChangeTextureAtlas.fire(T.pages[0].canvas),this._charAtlasDisposable.value=w.getDisposeArrayDisposable([g.forwardEvent(T.onAddTextureAtlasCanvas,this._onAddTextureAtlasCanvas),g.forwardEvent(T.onRemoveTextureAtlasCanvas,this._onRemoveTextureAtlasCanvas)])),this._charAtlas=T,this._charAtlas.warmUp(),(G=this._glyphRenderer.value)===null||G===void 0||G.setAtlas(this._charAtlas)}_clearModel(G){var T;this._model.clear(),G&&((T=this._glyphRenderer.value)===null||T===void 0||T.clear())}clearTextureAtlas(){var G;(G=this._charAtlas)===null||G===void 0||G.clearTexture(),this._clearModel(!0),this._requestRedrawViewport()}clear(){var G;this._clearModel(!0);for(let T of this._renderLayers)T.reset(this._terminal);(G=this._cursorBlinkStateManager.value)===null||G===void 0||G.restartBlinkAnimation(),this._updateCursorBlink()}registerCharacterJoiner(G){return-1}deregisterCharacterJoiner(G){return!1}renderRows(G,T){if(!this._isAttached){if(!(this._coreBrowserService.window.document.body.contains(this._core.screenElement)&&this._charSizeService.width&&this._charSizeService.height))return;this._updateDimensions(),this._refreshCharAtlas(),this._isAttached=!0}for(let J of this._renderLayers)J.handleGridChanged(this._terminal,G,T);this._glyphRenderer.value&&this._rectangleRenderer.value&&(this._glyphRenderer.value.beginFrame()?(this._clearModel(!0),this._updateModel(0,this._terminal.rows-1)):this._updateModel(G,T),this._rectangleRenderer.value.renderBackgrounds(),this._glyphRenderer.value.render(this._model),this._cursorBlinkStateManager.value&&!this._cursorBlinkStateManager.value.isCursorVisible||this._rectangleRenderer.value.renderCursor())}_updateCursorBlink(){this._terminal.options.cursorBlink?this._cursorBlinkStateManager.value=new D.CursorBlinkStateManager(()=>{this._requestRedrawCursor()},this._coreBrowserService):this._cursorBlinkStateManager.clear(),this._requestRedrawCursor()}_updateModel(G,T){const J=this._core;let X,m,q,V,Q,k,N,y,u,c,M,_,U,K=this._workCell;G=Y(G,J.rows-1,0),T=Y(T,J.rows-1,0);const r=this._terminal.buffer.active.baseY+this._terminal.buffer.active.cursorY,z=Math.min(this._terminal.buffer.active.cursorX,J.cols-1);let v0=-1;const t=this._coreService.isCursorInitialized&&!this._coreService.isCursorHidden&&(!this._cursorBlinkStateManager.value||this._cursorBlinkStateManager.value.isCursorVisible);this._model.cursor=void 0;let S0=!1;for(m=G;m<=T;m++)for(q=m+J.buffer.ydisp,V=J.buffer.lines.get(q),this._model.lineLengths[m]=0,Q=this._characterJoinerService.getJoinedCharacters(q),_=0;_<J.cols;_++)if(X=this._cellColorResolver.result.bg,V.loadCell(_,K),_===0&&(X=this._cellColorResolver.result.bg),k=!1,N=_,Q.length>0&&_===Q[0][0]&&(k=!0,y=Q.shift(),K=new B(K,V.translateToString(!0,y[0],y[1]),y[1]-y[0]),N=y[1]-1),u=K.getChars(),c=K.getCode(),M=(m*J.cols+_)*L.RENDER_MODEL_INDICIES_PER_CELL,this._cellColorResolver.resolve(K,_,q),t&&q===r&&(_===z&&(this._model.cursor={x:z,y:this._terminal.buffer.active.cursorY,width:K.getWidth(),style:this._coreBrowserService.isFocused?J.options.cursorStyle||"block":J.options.cursorInactiveStyle,cursorWidth:J.options.cursorWidth,dpr:this._devicePixelRatio},v0=z+K.getWidth()-1),_>=z&&_<=v0&&(this._coreBrowserService.isFocused&&(J.options.cursorStyle||"block")==="block"||this._coreBrowserService.isFocused===!1&&J.options.cursorInactiveStyle==="block")&&(this._cellColorResolver.result.fg=50331648|this._themeService.colors.cursorAccent.rgba>>8&16777215,this._cellColorResolver.result.bg=50331648|this._themeService.colors.cursor.rgba>>8&16777215)),c!==p.NULL_CELL_CODE&&(this._model.lineLengths[m]=_+1),(this._model.cells[M]!==c||this._model.cells[M+L.RENDER_MODEL_BG_OFFSET]!==this._cellColorResolver.result.bg||this._model.cells[M+L.RENDER_MODEL_FG_OFFSET]!==this._cellColorResolver.result.fg||this._model.cells[M+L.RENDER_MODEL_EXT_OFFSET]!==this._cellColorResolver.result.ext)&&(S0=!0,u.length>1&&(c|=L.COMBINED_CHAR_BIT_MASK),this._model.cells[M]=c,this._model.cells[M+L.RENDER_MODEL_BG_OFFSET]=this._cellColorResolver.result.bg,this._model.cells[M+L.RENDER_MODEL_FG_OFFSET]=this._cellColorResolver.result.fg,this._model.cells[M+L.RENDER_MODEL_EXT_OFFSET]=this._cellColorResolver.result.ext,this._glyphRenderer.value.updateCell(_,m,c,this._cellColorResolver.result.bg,this._cellColorResolver.result.fg,this._cellColorResolver.result.ext,u,X),k))for(K=this._workCell,_++;_<N;_++)U=(m*J.cols+_)*L.RENDER_MODEL_INDICIES_PER_CELL,this._glyphRenderer.value.updateCell(_,m,p.NULL_CELL_CODE,0,0,0,p.NULL_CELL_CHAR,0),this._model.cells[U]=p.NULL_CELL_CODE,this._model.cells[U+L.RENDER_MODEL_BG_OFFSET]=this._cellColorResolver.result.bg,this._model.cells[U+L.RENDER_MODEL_FG_OFFSET]=this._cellColorResolver.result.fg,this._model.cells[U+L.RENDER_MODEL_EXT_OFFSET]=this._cellColorResolver.result.ext;S0&&this._rectangleRenderer.value.updateBackgrounds(this._model),this._rectangleRenderer.value.updateCursor(this._model)}_updateDimensions(){this._charSizeService.width&&this._charSizeService.height&&(this.dimensions.device.char.width=Math.floor(this._charSizeService.width*this._devicePixelRatio),this.dimensions.device.char.height=Math.ceil(this._charSizeService.height*this._devicePixelRatio),this.dimensions.device.cell.height=Math.floor(this.dimensions.device.char.height*this._optionsService.rawOptions.lineHeight),this.dimensions.device.char.top=this._optionsService.rawOptions.lineHeight===1?0:Math.round((this.dimensions.device.cell.height-this.dimensions.device.char.height)/2),this.dimensions.device.cell.width=this.dimensions.device.char.width+Math.round(this._optionsService.rawOptions.letterSpacing),this.dimensions.device.char.left=Math.floor(this._optionsService.rawOptions.letterSpacing/2),this.dimensions.device.canvas.height=this._terminal.rows*this.dimensions.device.cell.height,this.dimensions.device.canvas.width=this._terminal.cols*this.dimensions.device.cell.width,this.dimensions.css.canvas.height=Math.round(this.dimensions.device.canvas.height/this._devicePixelRatio),this.dimensions.css.canvas.width=Math.round(this.dimensions.device.canvas.width/this._devicePixelRatio),this.dimensions.css.cell.height=this.dimensions.device.cell.height/this._devicePixelRatio,this.dimensions.css.cell.width=this.dimensions.device.cell.width/this._devicePixelRatio)}_setCanvasDevicePixelDimensions(G,T){this._canvas.width===G&&this._canvas.height===T||(this._canvas.width=G,this._canvas.height=T,this._requestRedrawViewport())}_requestRedrawViewport(){this._onRequestRedraw.fire({start:0,end:this._terminal.rows-1})}_requestRedrawCursor(){const G=this._terminal.buffer.active.cursorY;this._onRequestRedraw.fire({start:G,end:G})}}v.WebglRenderer=W,A([$.traceCall],W.prototype,"renderRows",null);class B extends C.AttributeData{constructor(G,T,J){super(),this.content=0,this.combinedData="",this.fg=G.fg,this.bg=G.bg,this.combinedData=T,this._width=J}isCombined(){return 2097152}getWidth(){return this._width}getChars(){return this.combinedData}getCode(){return 2097151}setFromCharData(G){throw new Error("not implemented")}getAsCharData(){return[this.fg,this.getChars(),this.getWidth(),this.getCode()]}}function Y(G,T,J=0){return Math.max(Math.min(G,T),J)}v.JoinedCellData=B},381:(P,v,b)=>{Object.defineProperty(v,"__esModule",{value:!0}),v.GLTexture=v.expandFloat32Array=v.createShader=v.createProgram=v.PROJECTION_MATRIX=void 0;const A=b(374);function H(E,h,D){const f=A.throwIfFalsy(E.createShader(h));if(E.shaderSource(f,D),E.compileShader(f),E.getShaderParameter(f,E.COMPILE_STATUS))return f;console.error(E.getShaderInfoLog(f)),E.deleteShader(f)}v.PROJECTION_MATRIX=new Float32Array([2,0,0,0,0,-2,0,0,0,0,1,0,-1,1,0,1]),v.createProgram=function(E,h,D){const f=A.throwIfFalsy(E.createProgram());if(E.attachShader(f,A.throwIfFalsy(H(E,E.VERTEX_SHADER,h))),E.attachShader(f,A.throwIfFalsy(H(E,E.FRAGMENT_SHADER,D))),E.linkProgram(f),E.getProgramParameter(f,E.LINK_STATUS))return f;console.error(E.getProgramInfoLog(f)),E.deleteProgram(f)},v.createShader=H,v.expandFloat32Array=function(E,h){const D=Math.min(2*E.length,h),f=new Float32Array(D);for(let S=0;S<E.length;S++)f[S]=E[S];return f},v.GLTexture=class{constructor(E){this.texture=E,this.version=-1}}},592:(P,v,b)=>{Object.defineProperty(v,"__esModule",{value:!0}),v.BaseRenderLayer=void 0;const A=b(627),H=b(237),E=b(374),h=b(859);class D extends h.Disposable{constructor(f,S,g,w,C,R,p,$){super(),this._container=S,this._alpha=C,this._coreBrowserService=R,this._optionsService=p,this._themeService=$,this._deviceCharWidth=0,this._deviceCharHeight=0,this._deviceCellWidth=0,this._deviceCellHeight=0,this._deviceCharLeft=0,this._deviceCharTop=0,this._canvas=document.createElement("canvas"),this._canvas.classList.add(`xterm-${g}-layer`),this._canvas.style.zIndex=w.toString(),this._initCanvas(),this._container.appendChild(this._canvas),this.register(this._themeService.onChangeColors((F)=>{this._refreshCharAtlas(f,F),this.reset(f)})),this.register(h.toDisposable(()=>{this._canvas.remove()}))}_initCanvas(){this._ctx=E.throwIfFalsy(this._canvas.getContext("2d",{alpha:this._alpha})),this._alpha||this._clearAll()}handleBlur(f){}handleFocus(f){}handleCursorMove(f){}handleGridChanged(f,S,g){}handleSelectionChanged(f,S,g,w=!1){}_setTransparency(f,S){if(S===this._alpha)return;const g=this._canvas;this._alpha=S,this._canvas=this._canvas.cloneNode(),this._initCanvas(),this._container.replaceChild(this._canvas,g),this._refreshCharAtlas(f,this._themeService.colors),this.handleGridChanged(f,0,f.rows-1)}_refreshCharAtlas(f,S){this._deviceCharWidth<=0&&this._deviceCharHeight<=0||(this._charAtlas=A.acquireTextureAtlas(f,this._optionsService.rawOptions,S,this._deviceCellWidth,this._deviceCellHeight,this._deviceCharWidth,this._deviceCharHeight,this._coreBrowserService.dpr),this._charAtlas.warmUp())}resize(f,S){this._deviceCellWidth=S.device.cell.width,this._deviceCellHeight=S.device.cell.height,this._deviceCharWidth=S.device.char.width,this._deviceCharHeight=S.device.char.height,this._deviceCharLeft=S.device.char.left,this._deviceCharTop=S.device.char.top,this._canvas.width=S.device.canvas.width,this._canvas.height=S.device.canvas.height,this._canvas.style.width=`${S.css.canvas.width}px`,this._canvas.style.height=`${S.css.canvas.height}px`,this._alpha||this._clearAll(),this._refreshCharAtlas(f,this._themeService.colors)}_fillBottomLineAtCells(f,S,g=1){this._ctx.fillRect(f*this._deviceCellWidth,(S+1)*this._deviceCellHeight-this._coreBrowserService.dpr-1,g*this._deviceCellWidth,this._coreBrowserService.dpr)}_clearAll(){this._alpha?this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height):(this._ctx.fillStyle=this._themeService.colors.background.css,this._ctx.fillRect(0,0,this._canvas.width,this._canvas.height))}_clearCells(f,S,g,w){this._alpha?this._ctx.clearRect(f*this._deviceCellWidth,S*this._deviceCellHeight,g*this._deviceCellWidth,w*this._deviceCellHeight):(this._ctx.fillStyle=this._themeService.colors.background.css,this._ctx.fillRect(f*this._deviceCellWidth,S*this._deviceCellHeight,g*this._deviceCellWidth,w*this._deviceCellHeight))}_fillCharTrueColor(f,S,g,w){this._ctx.font=this._getFont(f,!1,!1),this._ctx.textBaseline=H.TEXT_BASELINE,this._clipCell(g,w,S.getWidth()),this._ctx.fillText(S.getChars(),g*this._deviceCellWidth+this._deviceCharLeft,w*this._deviceCellHeight+this._deviceCharTop+this._deviceCharHeight)}_clipCell(f,S,g){this._ctx.beginPath(),this._ctx.rect(f*this._deviceCellWidth,S*this._deviceCellHeight,g*this._deviceCellWidth,this._deviceCellHeight),this._ctx.clip()}_getFont(f,S,g){return`${g?"italic":""} ${S?f.options.fontWeightBold:f.options.fontWeight} ${f.options.fontSize*this._coreBrowserService.dpr}px ${f.options.fontFamily}`}}v.BaseRenderLayer=D},733:(P,v,b)=>{Object.defineProperty(v,"__esModule",{value:!0}),v.LinkRenderLayer=void 0;const A=b(197),H=b(237),E=b(592);class h extends E.BaseRenderLayer{constructor(D,f,S,g,w,C,R){super(S,D,"link",f,!0,w,C,R),this.register(g.onShowLinkUnderline((p)=>this._handleShowLinkUnderline(p))),this.register(g.onHideLinkUnderline((p)=>this._handleHideLinkUnderline(p)))}resize(D,f){super.resize(D,f),this._state=void 0}reset(D){this._clearCurrentLink()}_clearCurrentLink(){if(this._state){this._clearCells(this._state.x1,this._state.y1,this._state.cols-this._state.x1,1);const D=this._state.y2-this._state.y1-1;D>0&&this._clearCells(0,this._state.y1+1,this._state.cols,D),this._clearCells(0,this._state.y2,this._state.x2,1),this._state=void 0}}_handleShowLinkUnderline(D){if(D.fg===H.INVERTED_DEFAULT_COLOR?this._ctx.fillStyle=this._themeService.colors.background.css:D.fg!==void 0&&A.is256Color(D.fg)?this._ctx.fillStyle=this._themeService.colors.ansi[D.fg].css:this._ctx.fillStyle=this._themeService.colors.foreground.css,D.y1===D.y2)this._fillBottomLineAtCells(D.x1,D.y1,D.x2-D.x1);else{this._fillBottomLineAtCells(D.x1,D.y1,D.cols-D.x1);for(let f=D.y1+1;f<D.y2;f++)this._fillBottomLineAtCells(0,f,D.cols);this._fillBottomLineAtCells(0,D.y2,D.x2)}this._state=D}_handleHideLinkUnderline(D){this._clearCurrentLink()}}v.LinkRenderLayer=h},820:(P,v)=>{Object.defineProperty(v,"__esModule",{value:!0}),v.addDisposableDomListener=void 0,v.addDisposableDomListener=function(b,A,H,E){b.addEventListener(A,H,E);let h=!1;return{dispose:()=>{h||(h=!0,b.removeEventListener(A,H,E))}}}},274:(P,v)=>{Object.defineProperty(v,"__esModule",{value:!0}),v.CellColorResolver=void 0;let b,A=0,H=0,E=!1,h=!1,D=!1;v.CellColorResolver=class{constructor(f,S,g,w,C){this._terminal=f,this._selectionRenderModel=S,this._decorationService=g,this._coreBrowserService=w,this._themeService=C,this.result={fg:0,bg:0,ext:0}}resolve(f,S,g){this.result.bg=f.bg,this.result.fg=f.fg,this.result.ext=268435456&f.bg?f.extended.ext:0,H=0,A=0,h=!1,E=!1,D=!1,b=this._themeService.colors,this._decorationService.forEachDecorationAtCell(S,g,"bottom",(w)=>{w.backgroundColorRGB&&(H=w.backgroundColorRGB.rgba>>8&16777215,h=!0),w.foregroundColorRGB&&(A=w.foregroundColorRGB.rgba>>8&16777215,E=!0)}),D=this._selectionRenderModel.isCellSelected(this._terminal,S,g),D&&(H=(this._coreBrowserService.isFocused?b.selectionBackgroundOpaque:b.selectionInactiveBackgroundOpaque).rgba>>8&16777215,h=!0,b.selectionForeground&&(A=b.selectionForeground.rgba>>8&16777215,E=!0)),this._decorationService.forEachDecorationAtCell(S,g,"top",(w)=>{w.backgroundColorRGB&&(H=w.backgroundColorRGB.rgba>>8&16777215,h=!0),w.foregroundColorRGB&&(A=w.foregroundColorRGB.rgba>>8&16777215,E=!0)}),h&&(H=D?-16777216&f.bg&-134217729|H|50331648:-16777216&f.bg|H|50331648),E&&(A=-16777216&f.fg&-67108865|A|50331648),67108864&this.result.fg&&(h&&!E&&(A=(50331648&this.result.bg)==0?-134217728&this.result.fg|16777215&b.background.rgba>>8|50331648:-134217728&this.result.fg|67108863&this.result.bg,E=!0),!h&&E&&(H=(50331648&this.result.fg)==0?-67108864&this.result.bg|16777215&b.foreground.rgba>>8|50331648:-67108864&this.result.bg|67108863&this.result.fg,h=!0)),b=void 0,this.result.bg=h?H:this.result.bg,this.result.fg=E?A:this.result.fg}}},627:(P,v,b)=>{Object.defineProperty(v,"__esModule",{value:!0}),v.removeTerminalFromCache=v.acquireTextureAtlas=void 0;const A=b(509),H=b(197),E=[];v.acquireTextureAtlas=function(h,D,f,S,g,w,C,R){const p=H.generateConfig(S,g,w,C,D,f,R);for(let O=0;O<E.length;O++){const L=E[O],Z=L.ownedBy.indexOf(h);if(Z>=0){if(H.configEquals(L.config,p))return L.atlas;L.ownedBy.length===1?(L.atlas.dispose(),E.splice(O,1)):L.ownedBy.splice(Z,1);break}}for(let O=0;O<E.length;O++){const L=E[O];if(H.configEquals(L.config,p))return L.ownedBy.push(h),L.atlas}const $=h._core,F={atlas:new A.TextureAtlas(document,p,$.unicodeService),config:p,ownedBy:[h]};return E.push(F),F.atlas},v.removeTerminalFromCache=function(h){for(let D=0;D<E.length;D++){const f=E[D].ownedBy.indexOf(h);if(f!==-1){E[D].ownedBy.length===1?(E[D].atlas.dispose(),E.splice(D,1)):E[D].ownedBy.splice(f,1);break}}}},197:(P,v,b)=>{Object.defineProperty(v,"__esModule",{value:!0}),v.is256Color=v.configEquals=v.generateConfig=void 0;const A=b(160);v.generateConfig=function(H,E,h,D,f,S,g){const w={foreground:S.foreground,background:S.background,cursor:A.NULL_COLOR,cursorAccent:A.NULL_COLOR,selectionForeground:A.NULL_COLOR,selectionBackgroundTransparent:A.NULL_COLOR,selectionBackgroundOpaque:A.NULL_COLOR,selectionInactiveBackgroundTransparent:A.NULL_COLOR,selectionInactiveBackgroundOpaque:A.NULL_COLOR,ansi:S.ansi.slice(),contrastCache:S.contrastCache,halfContrastCache:S.halfContrastCache};return{customGlyphs:f.customGlyphs,devicePixelRatio:g,letterSpacing:f.letterSpacing,lineHeight:f.lineHeight,deviceCellWidth:H,deviceCellHeight:E,deviceCharWidth:h,deviceCharHeight:D,fontFamily:f.fontFamily,fontSize:f.fontSize,fontWeight:f.fontWeight,fontWeightBold:f.fontWeightBold,allowTransparency:f.allowTransparency,drawBoldTextInBrightColors:f.drawBoldTextInBrightColors,minimumContrastRatio:f.minimumContrastRatio,colors:w}},v.configEquals=function(H,E){for(let h=0;h<H.colors.ansi.length;h++)if(H.colors.ansi[h].rgba!==E.colors.ansi[h].rgba)return!1;return H.devicePixelRatio===E.devicePixelRatio&&H.customGlyphs===E.customGlyphs&&H.lineHeight===E.lineHeight&&H.letterSpacing===E.letterSpacing&&H.fontFamily===E.fontFamily&&H.fontSize===E.fontSize&&H.fontWeight===E.fontWeight&&H.fontWeightBold===E.fontWeightBold&&H.allowTransparency===E.allowTransparency&&H.deviceCharWidth===E.deviceCharWidth&&H.deviceCharHeight===E.deviceCharHeight&&H.drawBoldTextInBrightColors===E.drawBoldTextInBrightColors&&H.minimumContrastRatio===E.minimumContrastRatio&&H.colors.foreground.rgba===E.colors.foreground.rgba&&H.colors.background.rgba===E.colors.background.rgba},v.is256Color=function(H){return(50331648&H)==16777216||(50331648&H)==33554432}},237:(P,v,b)=>{Object.defineProperty(v,"__esModule",{value:!0}),v.TEXT_BASELINE=v.DIM_OPACITY=v.INVERTED_DEFAULT_COLOR=void 0;const A=b(399);v.INVERTED_DEFAULT_COLOR=257,v.DIM_OPACITY=0.5,v.TEXT_BASELINE=A.isFirefox||A.isLegacyEdge?"bottom":"ideographic"},457:(P,v)=>{Object.defineProperty(v,"__esModule",{value:!0}),v.CursorBlinkStateManager=void 0,v.CursorBlinkStateManager=class{constructor(b,A){this._renderCallback=b,this._coreBrowserService=A,this.isCursorVisible=!0,this._coreBrowserService.isFocused&&this._restartInterval()}get isPaused(){return!(this._blinkStartTimeout||this._blinkInterval)}dispose(){this._blinkInterval&&(this._coreBrowserService.window.clearInterval(this._blinkInterval),this._blinkInterval=void 0),this._blinkStartTimeout&&(this._coreBrowserService.window.clearTimeout(this._blinkStartTimeout),this._blinkStartTimeout=void 0),this._animationFrame&&(this._coreBrowserService.window.cancelAnimationFrame(this._animationFrame),this._animationFrame=void 0)}restartBlinkAnimation(){this.isPaused||(this._animationTimeRestarted=Date.now(),this.isCursorVisible=!0,this._animationFrame||(this._animationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>{this._renderCallback(),this._animationFrame=void 0})))}_restartInterval(b=600){this._blinkInterval&&(this._coreBrowserService.window.clearInterval(this._blinkInterval),this._blinkInterval=void 0),this._blinkStartTimeout=this._coreBrowserService.window.setTimeout(()=>{if(this._animationTimeRestarted){const A=600-(Date.now()-this._animationTimeRestarted);if(this._animationTimeRestarted=void 0,A>0)return void this._restartInterval(A)}this.isCursorVisible=!1,this._animationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>{this._renderCallback(),this._animationFrame=void 0}),this._blinkInterval=this._coreBrowserService.window.setInterval(()=>{if(this._animationTimeRestarted){const A=600-(Date.now()-this._animationTimeRestarted);return this._animationTimeRestarted=void 0,void this._restartInterval(A)}this.isCursorVisible=!this.isCursorVisible,this._animationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>{this._renderCallback(),this._animationFrame=void 0})},600)},b)}pause(){this.isCursorVisible=!0,this._blinkInterval&&(this._coreBrowserService.window.clearInterval(this._blinkInterval),this._blinkInterval=void 0),this._blinkStartTimeout&&(this._coreBrowserService.window.clearTimeout(this._blinkStartTimeout),this._blinkStartTimeout=void 0),this._animationFrame&&(this._coreBrowserService.window.cancelAnimationFrame(this._animationFrame),this._animationFrame=void 0)}resume(){this.pause(),this._animationTimeRestarted=void 0,this._restartInterval(),this.restartBlinkAnimation()}}},860:(P,v,b)=>{Object.defineProperty(v,"__esModule",{value:!0}),v.tryDrawCustomChar=v.powerlineDefinitions=v.boxDrawingDefinitions=v.blockElementDefinitions=void 0;const A=b(374);v.blockElementDefinitions={"\u2580":[{x:0,y:0,w:8,h:4}],"\u2581":[{x:0,y:7,w:8,h:1}],"\u2582":[{x:0,y:6,w:8,h:2}],"\u2583":[{x:0,y:5,w:8,h:3}],"\u2584":[{x:0,y:4,w:8,h:4}],"\u2585":[{x:0,y:3,w:8,h:5}],"\u2586":[{x:0,y:2,w:8,h:6}],"\u2587":[{x:0,y:1,w:8,h:7}],"\u2588":[{x:0,y:0,w:8,h:8}],"\u2589":[{x:0,y:0,w:7,h:8}],"\u258A":[{x:0,y:0,w:6,h:8}],"\u258B":[{x:0,y:0,w:5,h:8}],"\u258C":[{x:0,y:0,w:4,h:8}],"\u258D":[{x:0,y:0,w:3,h:8}],"\u258E":[{x:0,y:0,w:2,h:8}],"\u258F":[{x:0,y:0,w:1,h:8}],"\u2590":[{x:4,y:0,w:4,h:8}],"\u2594":[{x:0,y:0,w:8,h:1}],"\u2595":[{x:7,y:0,w:1,h:8}],"\u2596":[{x:0,y:4,w:4,h:4}],"\u2597":[{x:4,y:4,w:4,h:4}],"\u2598":[{x:0,y:0,w:4,h:4}],"\u2599":[{x:0,y:0,w:4,h:8},{x:0,y:4,w:8,h:4}],"\u259A":[{x:0,y:0,w:4,h:4},{x:4,y:4,w:4,h:4}],"\u259B":[{x:0,y:0,w:4,h:8},{x:4,y:0,w:4,h:4}],"\u259C":[{x:0,y:0,w:8,h:4},{x:4,y:0,w:4,h:8}],"\u259D":[{x:4,y:0,w:4,h:4}],"\u259E":[{x:4,y:0,w:4,h:4},{x:0,y:4,w:4,h:4}],"\u259F":[{x:4,y:0,w:4,h:8},{x:0,y:4,w:8,h:4}],"\uD83E\uDF70":[{x:1,y:0,w:1,h:8}],"\uD83E\uDF71":[{x:2,y:0,w:1,h:8}],"\uD83E\uDF72":[{x:3,y:0,w:1,h:8}],"\uD83E\uDF73":[{x:4,y:0,w:1,h:8}],"\uD83E\uDF74":[{x:5,y:0,w:1,h:8}],"\uD83E\uDF75":[{x:6,y:0,w:1,h:8}],"\uD83E\uDF76":[{x:0,y:1,w:8,h:1}],"\uD83E\uDF77":[{x:0,y:2,w:8,h:1}],"\uD83E\uDF78":[{x:0,y:3,w:8,h:1}],"\uD83E\uDF79":[{x:0,y:4,w:8,h:1}],"\uD83E\uDF7A":[{x:0,y:5,w:8,h:1}],"\uD83E\uDF7B":[{x:0,y:6,w:8,h:1}],"\uD83E\uDF7C":[{x:0,y:0,w:1,h:8},{x:0,y:7,w:8,h:1}],"\uD83E\uDF7D":[{x:0,y:0,w:1,h:8},{x:0,y:0,w:8,h:1}],"\uD83E\uDF7E":[{x:7,y:0,w:1,h:8},{x:0,y:0,w:8,h:1}],"\uD83E\uDF7F":[{x:7,y:0,w:1,h:8},{x:0,y:7,w:8,h:1}],"\uD83E\uDF80":[{x:0,y:0,w:8,h:1},{x:0,y:7,w:8,h:1}],"\uD83E\uDF81":[{x:0,y:0,w:8,h:1},{x:0,y:2,w:8,h:1},{x:0,y:4,w:8,h:1},{x:0,y:7,w:8,h:1}],"\uD83E\uDF82":[{x:0,y:0,w:8,h:2}],"\uD83E\uDF83":[{x:0,y:0,w:8,h:3}],"\uD83E\uDF84":[{x:0,y:0,w:8,h:5}],"\uD83E\uDF85":[{x:0,y:0,w:8,h:6}],"\uD83E\uDF86":[{x:0,y:0,w:8,h:7}],"\uD83E\uDF87":[{x:6,y:0,w:2,h:8}],"\uD83E\uDF88":[{x:5,y:0,w:3,h:8}],"\uD83E\uDF89":[{x:3,y:0,w:5,h:8}],"\uD83E\uDF8A":[{x:2,y:0,w:6,h:8}],"\uD83E\uDF8B":[{x:1,y:0,w:7,h:8}],"\uD83E\uDF95":[{x:0,y:0,w:2,h:2},{x:4,y:0,w:2,h:2},{x:2,y:2,w:2,h:2},{x:6,y:2,w:2,h:2},{x:0,y:4,w:2,h:2},{x:4,y:4,w:2,h:2},{x:2,y:6,w:2,h:2},{x:6,y:6,w:2,h:2}],"\uD83E\uDF96":[{x:2,y:0,w:2,h:2},{x:6,y:0,w:2,h:2},{x:0,y:2,w:2,h:2},{x:4,y:2,w:2,h:2},{x:2,y:4,w:2,h:2},{x:6,y:4,w:2,h:2},{x:0,y:6,w:2,h:2},{x:4,y:6,w:2,h:2}],"\uD83E\uDF97":[{x:0,y:2,w:8,h:2},{x:0,y:6,w:8,h:2}]};const H={"\u2591":[[1,0,0,0],[0,0,0,0],[0,0,1,0],[0,0,0,0]],"\u2592":[[1,0],[0,0],[0,1],[0,0]],"\u2593":[[0,1],[1,1],[1,0],[1,1]]};v.boxDrawingDefinitions={"\u2500":{1:"M0,.5 L1,.5"},"\u2501":{3:"M0,.5 L1,.5"},"\u2502":{1:"M.5,0 L.5,1"},"\u2503":{3:"M.5,0 L.5,1"},"\u250C":{1:"M0.5,1 L.5,.5 L1,.5"},"\u250F":{3:"M0.5,1 L.5,.5 L1,.5"},"\u2510":{1:"M0,.5 L.5,.5 L.5,1"},"\u2513":{3:"M0,.5 L.5,.5 L.5,1"},"\u2514":{1:"M.5,0 L.5,.5 L1,.5"},"\u2517":{3:"M.5,0 L.5,.5 L1,.5"},"\u2518":{1:"M.5,0 L.5,.5 L0,.5"},"\u251B":{3:"M.5,0 L.5,.5 L0,.5"},"\u251C":{1:"M.5,0 L.5,1 M.5,.5 L1,.5"},"\u2523":{3:"M.5,0 L.5,1 M.5,.5 L1,.5"},"\u2524":{1:"M.5,0 L.5,1 M.5,.5 L0,.5"},"\u252B":{3:"M.5,0 L.5,1 M.5,.5 L0,.5"},"\u252C":{1:"M0,.5 L1,.5 M.5,.5 L.5,1"},"\u2533":{3:"M0,.5 L1,.5 M.5,.5 L.5,1"},"\u2534":{1:"M0,.5 L1,.5 M.5,.5 L.5,0"},"\u253B":{3:"M0,.5 L1,.5 M.5,.5 L.5,0"},"\u253C":{1:"M0,.5 L1,.5 M.5,0 L.5,1"},"\u254B":{3:"M0,.5 L1,.5 M.5,0 L.5,1"},"\u2574":{1:"M.5,.5 L0,.5"},"\u2578":{3:"M.5,.5 L0,.5"},"\u2575":{1:"M.5,.5 L.5,0"},"\u2579":{3:"M.5,.5 L.5,0"},"\u2576":{1:"M.5,.5 L1,.5"},"\u257A":{3:"M.5,.5 L1,.5"},"\u2577":{1:"M.5,.5 L.5,1"},"\u257B":{3:"M.5,.5 L.5,1"},"\u2550":{1:(S,g)=>`M0,${0.5-g} L1,${0.5-g} M0,${0.5+g} L1,${0.5+g}`},"\u2551":{1:(S,g)=>`M${0.5-S},0 L${0.5-S},1 M${0.5+S},0 L${0.5+S},1`},"\u2552":{1:(S,g)=>`M.5,1 L.5,${0.5-g} L1,${0.5-g} M.5,${0.5+g} L1,${0.5+g}`},"\u2553":{1:(S,g)=>`M${0.5-S},1 L${0.5-S},.5 L1,.5 M${0.5+S},.5 L${0.5+S},1`},"\u2554":{1:(S,g)=>`M1,${0.5-g} L${0.5-S},${0.5-g} L${0.5-S},1 M1,${0.5+g} L${0.5+S},${0.5+g} L${0.5+S},1`},"\u2555":{1:(S,g)=>`M0,${0.5-g} L.5,${0.5-g} L.5,1 M0,${0.5+g} L.5,${0.5+g}`},"\u2556":{1:(S,g)=>`M${0.5+S},1 L${0.5+S},.5 L0,.5 M${0.5-S},.5 L${0.5-S},1`},"\u2557":{1:(S,g)=>`M0,${0.5+g} L${0.5-S},${0.5+g} L${0.5-S},1 M0,${0.5-g} L${0.5+S},${0.5-g} L${0.5+S},1`},"\u2558":{1:(S,g)=>`M.5,0 L.5,${0.5+g} L1,${0.5+g} M.5,${0.5-g} L1,${0.5-g}`},"\u2559":{1:(S,g)=>`M1,.5 L${0.5-S},.5 L${0.5-S},0 M${0.5+S},.5 L${0.5+S},0`},"\u255A":{1:(S,g)=>`M1,${0.5-g} L${0.5+S},${0.5-g} L${0.5+S},0 M1,${0.5+g} L${0.5-S},${0.5+g} L${0.5-S},0`},"\u255B":{1:(S,g)=>`M0,${0.5+g} L.5,${0.5+g} L.5,0 M0,${0.5-g} L.5,${0.5-g}`},"\u255C":{1:(S,g)=>`M0,.5 L${0.5+S},.5 L${0.5+S},0 M${0.5-S},.5 L${0.5-S},0`},"\u255D":{1:(S,g)=>`M0,${0.5-g} L${0.5-S},${0.5-g} L${0.5-S},0 M0,${0.5+g} L${0.5+S},${0.5+g} L${0.5+S},0`},"\u255E":{1:(S,g)=>`M.5,0 L.5,1 M.5,${0.5-g} L1,${0.5-g} M.5,${0.5+g} L1,${0.5+g}`},"\u255F":{1:(S,g)=>`M${0.5-S},0 L${0.5-S},1 M${0.5+S},0 L${0.5+S},1 M${0.5+S},.5 L1,.5`},"\u2560":{1:(S,g)=>`M${0.5-S},0 L${0.5-S},1 M1,${0.5+g} L${0.5+S},${0.5+g} L${0.5+S},1 M1,${0.5-g} L${0.5+S},${0.5-g} L${0.5+S},0`},"\u2561":{1:(S,g)=>`M.5,0 L.5,1 M0,${0.5-g} L.5,${0.5-g} M0,${0.5+g} L.5,${0.5+g}`},"\u2562":{1:(S,g)=>`M0,.5 L${0.5-S},.5 M${0.5-S},0 L${0.5-S},1 M${0.5+S},0 L${0.5+S},1`},"\u2563":{1:(S,g)=>`M${0.5+S},0 L${0.5+S},1 M0,${0.5+g} L${0.5-S},${0.5+g} L${0.5-S},1 M0,${0.5-g} L${0.5-S},${0.5-g} L${0.5-S},0`},"\u2564":{1:(S,g)=>`M0,${0.5-g} L1,${0.5-g} M0,${0.5+g} L1,${0.5+g} M.5,${0.5+g} L.5,1`},"\u2565":{1:(S,g)=>`M0,.5 L1,.5 M${0.5-S},.5 L${0.5-S},1 M${0.5+S},.5 L${0.5+S},1`},"\u2566":{1:(S,g)=>`M0,${0.5-g} L1,${0.5-g} M0,${0.5+g} L${0.5-S},${0.5+g} L${0.5-S},1 M1,${0.5+g} L${0.5+S},${0.5+g} L${0.5+S},1`},"\u2567":{1:(S,g)=>`M.5,0 L.5,${0.5-g} M0,${0.5-g} L1,${0.5-g} M0,${0.5+g} L1,${0.5+g}`},"\u2568":{1:(S,g)=>`M0,.5 L1,.5 M${0.5-S},.5 L${0.5-S},0 M${0.5+S},.5 L${0.5+S},0`},"\u2569":{1:(S,g)=>`M0,${0.5+g} L1,${0.5+g} M0,${0.5-g} L${0.5-S},${0.5-g} L${0.5-S},0 M1,${0.5-g} L${0.5+S},${0.5-g} L${0.5+S},0`},"\u256A":{1:(S,g)=>`M.5,0 L.5,1 M0,${0.5-g} L1,${0.5-g} M0,${0.5+g} L1,${0.5+g}`},"\u256B":{1:(S,g)=>`M0,.5 L1,.5 M${0.5-S},0 L${0.5-S},1 M${0.5+S},0 L${0.5+S},1`},"\u256C":{1:(S,g)=>`M0,${0.5+g} L${0.5-S},${0.5+g} L${0.5-S},1 M1,${0.5+g} L${0.5+S},${0.5+g} L${0.5+S},1 M0,${0.5-g} L${0.5-S},${0.5-g} L${0.5-S},0 M1,${0.5-g} L${0.5+S},${0.5-g} L${0.5+S},0`},"\u2571":{1:"M1,0 L0,1"},"\u2572":{1:"M0,0 L1,1"},"\u2573":{1:"M1,0 L0,1 M0,0 L1,1"},"\u257C":{1:"M.5,.5 L0,.5",3:"M.5,.5 L1,.5"},"\u257D":{1:"M.5,.5 L.5,0",3:"M.5,.5 L.5,1"},"\u257E":{1:"M.5,.5 L1,.5",3:"M.5,.5 L0,.5"},"\u257F":{1:"M.5,.5 L.5,1",3:"M.5,.5 L.5,0"},"\u250D":{1:"M.5,.5 L.5,1",3:"M.5,.5 L1,.5"},"\u250E":{1:"M.5,.5 L1,.5",3:"M.5,.5 L.5,1"},"\u2511":{1:"M.5,.5 L.5,1",3:"M.5,.5 L0,.5"},"\u2512":{1:"M.5,.5 L0,.5",3:"M.5,.5 L.5,1"},"\u2515":{1:"M.5,.5 L.5,0",3:"M.5,.5 L1,.5"},"\u2516":{1:"M.5,.5 L1,.5",3:"M.5,.5 L.5,0"},"\u2519":{1:"M.5,.5 L.5,0",3:"M.5,.5 L0,.5"},"\u251A":{1:"M.5,.5 L0,.5",3:"M.5,.5 L.5,0"},"\u251D":{1:"M.5,0 L.5,1",3:"M.5,.5 L1,.5"},"\u251E":{1:"M0.5,1 L.5,.5 L1,.5",3:"M.5,.5 L.5,0"},"\u251F":{1:"M.5,0 L.5,.5 L1,.5",3:"M.5,.5 L.5,1"},"\u2520":{1:"M.5,.5 L1,.5",3:"M.5,0 L.5,1"},"\u2521":{1:"M.5,.5 L.5,1",3:"M.5,0 L.5,.5 L1,.5"},"\u2522":{1:"M.5,.5 L.5,0",3:"M0.5,1 L.5,.5 L1,.5"},"\u2525":{1:"M.5,0 L.5,1",3:"M.5,.5 L0,.5"},"\u2526":{1:"M0,.5 L.5,.5 L.5,1",3:"M.5,.5 L.5,0"},"\u2527":{1:"M.5,0 L.5,.5 L0,.5",3:"M.5,.5 L.5,1"},"\u2528":{1:"M.5,.5 L0,.5",3:"M.5,0 L.5,1"},"\u2529":{1:"M.5,.5 L.5,1",3:"M.5,0 L.5,.5 L0,.5"},"\u252A":{1:"M.5,.5 L.5,0",3:"M0,.5 L.5,.5 L.5,1"},"\u252D":{1:"M0.5,1 L.5,.5 L1,.5",3:"M.5,.5 L0,.5"},"\u252E":{1:"M0,.5 L.5,.5 L.5,1",3:"M.5,.5 L1,.5"},"\u252F":{1:"M.5,.5 L.5,1",3:"M0,.5 L1,.5"},"\u2530":{1:"M0,.5 L1,.5",3:"M.5,.5 L.5,1"},"\u2531":{1:"M.5,.5 L1,.5",3:"M0,.5 L.5,.5 L.5,1"},"\u2532":{1:"M.5,.5 L0,.5",3:"M0.5,1 L.5,.5 L1,.5"},"\u2535":{1:"M.5,0 L.5,.5 L1,.5",3:"M.5,.5 L0,.5"},"\u2536":{1:"M.5,0 L.5,.5 L0,.5",3:"M.5,.5 L1,.5"},"\u2537":{1:"M.5,.5 L.5,0",3:"M0,.5 L1,.5"},"\u2538":{1:"M0,.5 L1,.5",3:"M.5,.5 L.5,0"},"\u2539":{1:"M.5,.5 L1,.5",3:"M.5,0 L.5,.5 L0,.5"},"\u253A":{1:"M.5,.5 L0,.5",3:"M.5,0 L.5,.5 L1,.5"},"\u253D":{1:"M.5,0 L.5,1 M.5,.5 L1,.5",3:"M.5,.5 L0,.5"},"\u253E":{1:"M.5,0 L.5,1 M.5,.5 L0,.5",3:"M.5,.5 L1,.5"},"\u253F":{1:"M.5,0 L.5,1",3:"M0,.5 L1,.5"},"\u2540":{1:"M0,.5 L1,.5 M.5,.5 L.5,1",3:"M.5,.5 L.5,0"},"\u2541":{1:"M.5,.5 L.5,0 M0,.5 L1,.5",3:"M.5,.5 L.5,1"},"\u2542":{1:"M0,.5 L1,.5",3:"M.5,0 L.5,1"},"\u2543":{1:"M0.5,1 L.5,.5 L1,.5",3:"M.5,0 L.5,.5 L0,.5"},"\u2544":{1:"M0,.5 L.5,.5 L.5,1",3:"M.5,0 L.5,.5 L1,.5"},"\u2545":{1:"M.5,0 L.5,.5 L1,.5",3:"M0,.5 L.5,.5 L.5,1"},"\u2546":{1:"M.5,0 L.5,.5 L0,.5",3:"M0.5,1 L.5,.5 L1,.5"},"\u2547":{1:"M.5,.5 L.5,1",3:"M.5,.5 L.5,0 M0,.5 L1,.5"},"\u2548":{1:"M.5,.5 L.5,0",3:"M0,.5 L1,.5 M.5,.5 L.5,1"},"\u2549":{1:"M.5,.5 L1,.5",3:"M.5,0 L.5,1 M.5,.5 L0,.5"},"\u254A":{1:"M.5,.5 L0,.5",3:"M.5,0 L.5,1 M.5,.5 L1,.5"},"\u254C":{1:"M.1,.5 L.4,.5 M.6,.5 L.9,.5"},"\u254D":{3:"M.1,.5 L.4,.5 M.6,.5 L.9,.5"},"\u2504":{1:"M.0667,.5 L.2667,.5 M.4,.5 L.6,.5 M.7333,.5 L.9333,.5"},"\u2505":{3:"M.0667,.5 L.2667,.5 M.4,.5 L.6,.5 M.7333,.5 L.9333,.5"},"\u2508":{1:"M.05,.5 L.2,.5 M.3,.5 L.45,.5 M.55,.5 L.7,.5 M.8,.5 L.95,.5"},"\u2509":{3:"M.05,.5 L.2,.5 M.3,.5 L.45,.5 M.55,.5 L.7,.5 M.8,.5 L.95,.5"},"\u254E":{1:"M.5,.1 L.5,.4 M.5,.6 L.5,.9"},"\u254F":{3:"M.5,.1 L.5,.4 M.5,.6 L.5,.9"},"\u2506":{1:"M.5,.0667 L.5,.2667 M.5,.4 L.5,.6 M.5,.7333 L.5,.9333"},"\u2507":{3:"M.5,.0667 L.5,.2667 M.5,.4 L.5,.6 M.5,.7333 L.5,.9333"},"\u250A":{1:"M.5,.05 L.5,.2 M.5,.3 L.5,.45 L.5,.55 M.5,.7 L.5,.95"},"\u250B":{3:"M.5,.05 L.5,.2 M.5,.3 L.5,.45 L.5,.55 M.5,.7 L.5,.95"},"\u256D":{1:(S,g)=>`M.5,1 L.5,${0.5+g/0.15*0.5} C.5,${0.5+g/0.15*0.5},.5,.5,1,.5`},"\u256E":{1:(S,g)=>`M.5,1 L.5,${0.5+g/0.15*0.5} C.5,${0.5+g/0.15*0.5},.5,.5,0,.5`},"\u256F":{1:(S,g)=>`M.5,0 L.5,${0.5-g/0.15*0.5} C.5,${0.5-g/0.15*0.5},.5,.5,0,.5`},"\u2570":{1:(S,g)=>`M.5,0 L.5,${0.5-g/0.15*0.5} C.5,${0.5-g/0.15*0.5},.5,.5,1,.5`}},v.powerlineDefinitions={"\uE0B0":{d:"M0,0 L1,.5 L0,1",type:0,rightPadding:2},"\uE0B1":{d:"M-1,-.5 L1,.5 L-1,1.5",type:1,leftPadding:1,rightPadding:1},"\uE0B2":{d:"M1,0 L0,.5 L1,1",type:0,leftPadding:2},"\uE0B3":{d:"M2,-.5 L0,.5 L2,1.5",type:1,leftPadding:1,rightPadding:1},"\uE0B4":{d:"M0,0 L0,1 C0.552,1,1,0.776,1,.5 C1,0.224,0.552,0,0,0",type:0,rightPadding:1},"\uE0B5":{d:"M.2,1 C.422,1,.8,.826,.78,.5 C.8,.174,0.422,0,.2,0",type:1,rightPadding:1},"\uE0B6":{d:"M1,0 L1,1 C0.448,1,0,0.776,0,.5 C0,0.224,0.448,0,1,0",type:0,leftPadding:1},"\uE0B7":{d:"M.8,1 C0.578,1,0.2,.826,.22,.5 C0.2,0.174,0.578,0,0.8,0",type:1,leftPadding:1},"\uE0B8":{d:"M-.5,-.5 L1.5,1.5 L-.5,1.5",type:0},"\uE0B9":{d:"M-.5,-.5 L1.5,1.5",type:1,leftPadding:1,rightPadding:1},"\uE0BA":{d:"M1.5,-.5 L-.5,1.5 L1.5,1.5",type:0},"\uE0BC":{d:"M1.5,-.5 L-.5,1.5 L-.5,-.5",type:0},"\uE0BD":{d:"M1.5,-.5 L-.5,1.5",type:1,leftPadding:1,rightPadding:1},"\uE0BE":{d:"M-.5,-.5 L1.5,1.5 L1.5,-.5",type:0}},v.powerlineDefinitions["\uE0BB"]=v.powerlineDefinitions["\uE0BD"],v.powerlineDefinitions["\uE0BF"]=v.powerlineDefinitions["\uE0B9"],v.tryDrawCustomChar=function(S,g,w,C,R,p,$,F){const O=v.blockElementDefinitions[g];if(O)return function(B,Y,G,T,J,X){for(let m=0;m<Y.length;m++){const q=Y[m],V=J/8,Q=X/8;B.fillRect(G+q.x*V,T+q.y*Q,q.w*V,q.h*Q)}}(S,O,w,C,R,p),!0;const L=H[g];if(L)return function(B,Y,G,T,J,X){let m=E.get(Y);m||(m=new Map,E.set(Y,m));const q=B.fillStyle;if(typeof q!="string")throw new Error(`Unexpected fillStyle type "${q}"`);let V=m.get(q);if(!V){const Q=Y[0].length,k=Y.length,N=document.createElement("canvas");N.width=Q,N.height=k;const y=A.throwIfFalsy(N.getContext("2d")),u=new ImageData(Q,k);let c,M,_,U;if(q.startsWith("#"))c=parseInt(q.slice(1,3),16),M=parseInt(q.slice(3,5),16),_=parseInt(q.slice(5,7),16),U=q.length>7&&parseInt(q.slice(7,9),16)||1;else{if(!q.startsWith("rgba"))throw new Error(`Unexpected fillStyle color format "${q}" when drawing pattern glyph`);[c,M,_,U]=q.substring(5,q.length-1).split(",").map((K)=>parseFloat(K))}for(let K=0;K<k;K++)for(let r=0;r<Q;r++)u.data[4*(K*Q+r)]=c,u.data[4*(K*Q+r)+1]=M,u.data[4*(K*Q+r)+2]=_,u.data[4*(K*Q+r)+3]=Y[K][r]*(255*U);y.putImageData(u,0,0),V=A.throwIfFalsy(B.createPattern(N,null)),m.set(q,V)}B.fillStyle=V,B.fillRect(G,T,J,X)}(S,L,w,C,R,p),!0;const Z=v.boxDrawingDefinitions[g];if(Z)return function(B,Y,G,T,J,X,m){B.strokeStyle=B.fillStyle;for(let[q,V]of Object.entries(Y)){let Q;B.beginPath(),B.lineWidth=m*Number.parseInt(q),Q=typeof V=="function"?V(0.15,0.15/X*J):V;for(let k of Q.split(" ")){const N=k[0],y=D[N];if(!y){console.error(`Could not find drawing instructions for "${N}"`);continue}const u=k.substring(1).split(",");u[0]&&u[1]&&y(B,f(u,J,X,G,T,!0,m))}B.stroke(),B.closePath()}}(S,Z,w,C,R,p,F),!0;const W=v.powerlineDefinitions[g];return!!W&&(function(B,Y,G,T,J,X,m,q){var V,Q;const k=new Path2D;k.rect(G,T,J,X),B.clip(k),B.beginPath();const N=m/12;B.lineWidth=q*N;for(let y of Y.d.split(" ")){const u=y[0],c=D[u];if(!c){console.error(`Could not find drawing instructions for "${u}"`);continue}const M=y.substring(1).split(",");M[0]&&M[1]&&c(B,f(M,J,X,G,T,!1,q,((V=Y.leftPadding)!==null&&V!==void 0?V:0)*(N/2),((Q=Y.rightPadding)!==null&&Q!==void 0?Q:0)*(N/2)))}Y.type===1?(B.strokeStyle=B.fillStyle,B.stroke()):B.fill(),B.closePath()}(S,W,w,C,R,p,$,F),!0)};const E=new Map;function h(S,g,w=0){return Math.max(Math.min(S,g),w)}const D={C:(S,g)=>S.bezierCurveTo(g[0],g[1],g[2],g[3],g[4],g[5]),L:(S,g)=>S.lineTo(g[0],g[1]),M:(S,g)=>S.moveTo(g[0],g[1])};function f(S,g,w,C,R,p,$,F=0,O=0){const L=S.map((Z)=>parseFloat(Z)||parseInt(Z));if(L.length<2)throw new Error("Too few arguments for instruction");for(let Z=0;Z<L.length;Z+=2)L[Z]*=g-F*$-O*$,p&&L[Z]!==0&&(L[Z]=h(Math.round(L[Z]+0.5)-0.5,g,0)),L[Z]+=C+F*$;for(let Z=1;Z<L.length;Z+=2)L[Z]*=w,p&&L[Z]!==0&&(L[Z]=h(Math.round(L[Z]+0.5)-0.5,w,0)),L[Z]+=R;return L}},56:(P,v,b)=>{Object.defineProperty(v,"__esModule",{value:!0}),v.observeDevicePixelDimensions=void 0;const A=b(859);v.observeDevicePixelDimensions=function(H,E,h){let D=new E.ResizeObserver((f)=>{const S=f.find((C)=>C.target===H);if(!S)return;if(!("devicePixelContentBoxSize"in S))return D==null||D.disconnect(),void(D=void 0);const g=S.devicePixelContentBoxSize[0].inlineSize,w=S.devicePixelContentBoxSize[0].blockSize;g>0&&w>0&&h(g,w)});try{D.observe(H,{box:["device-pixel-content-box"]})}catch(f){D.disconnect(),D=void 0}return A.toDisposable(()=>D==null?void 0:D.disconnect())}},374:(P,v)=>{function b(A){return 57508<=A&&A<=57558}Object.defineProperty(v,"__esModule",{value:!0}),v.createRenderDimensions=v.excludeFromContrastRatioDemands=v.isRestrictedPowerlineGlyph=v.isPowerlineGlyph=v.throwIfFalsy=void 0,v.throwIfFalsy=function(A){if(!A)throw new Error("value must not be falsy");return A},v.isPowerlineGlyph=b,v.isRestrictedPowerlineGlyph=function(A){return 57520<=A&&A<=57527},v.excludeFromContrastRatioDemands=function(A){return b(A)||function(H){return 9472<=H&&H<=9631}(A)},v.createRenderDimensions=function(){return{css:{canvas:{width:0,height:0},cell:{width:0,height:0}},device:{canvas:{width:0,height:0},cell:{width:0,height:0},char:{width:0,height:0,left:0,top:0}}}}},296:(P,v)=>{Object.defineProperty(v,"__esModule",{value:!0}),v.createSelectionRenderModel=void 0;class b{constructor(){this.clear()}clear(){this.hasSelection=!1,this.columnSelectMode=!1,this.viewportStartRow=0,this.viewportEndRow=0,this.viewportCappedStartRow=0,this.viewportCappedEndRow=0,this.startCol=0,this.endCol=0,this.selectionStart=void 0,this.selectionEnd=void 0}update(A,H,E,h=!1){if(this.selectionStart=H,this.selectionEnd=E,!H||!E||H[0]===E[0]&&H[1]===E[1])return void this.clear();const D=H[1]-A.buffer.active.viewportY,f=E[1]-A.buffer.active.viewportY,S=Math.max(D,0),g=Math.min(f,A.rows-1);S>=A.rows||g<0?this.clear():(this.hasSelection=!0,this.columnSelectMode=h,this.viewportStartRow=D,this.viewportEndRow=f,this.viewportCappedStartRow=S,this.viewportCappedEndRow=g,this.startCol=H[0],this.endCol=E[0])}isCellSelected(A,H,E){return!!this.hasSelection&&(E-=A.buffer.active.viewportY,this.columnSelectMode?this.startCol<=this.endCol?H>=this.startCol&&E>=this.viewportCappedStartRow&&H<this.endCol&&E<=this.viewportCappedEndRow:H<this.startCol&&E>=this.viewportCappedStartRow&&H>=this.endCol&&E<=this.viewportCappedEndRow:E>this.viewportStartRow&&E<this.viewportEndRow||this.viewportStartRow===this.viewportEndRow&&E===this.viewportStartRow&&H>=this.startCol&&H<this.endCol||this.viewportStartRow<this.viewportEndRow&&E===this.viewportEndRow&&H<this.endCol||this.viewportStartRow<this.viewportEndRow&&E===this.viewportStartRow&&H>=this.startCol)}}v.createSelectionRenderModel=function(){return new b}},509:function(P,v,b){var A=this&&this.__decorate||function(W,B,Y,G){var T,J=arguments.length,X=J<3?B:G===null?G=Object.getOwnPropertyDescriptor(B,Y):G;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")X=Reflect.decorate(W,B,Y,G);else for(var m=W.length-1;m>=0;m--)(T=W[m])&&(X=(J<3?T(X):J>3?T(B,Y,X):T(B,Y))||X);return J>3&&X&&Object.defineProperty(B,Y,X),X};Object.defineProperty(v,"__esModule",{value:!0}),v.TextureAtlas=void 0;const H=b(237),E=b(860),h=b(374),D=b(160),f=b(345),S=b(485),g=b(385),w=b(147),C=b(855),R=b(776),p={texturePage:0,texturePosition:{x:0,y:0},texturePositionClipSpace:{x:0,y:0},offset:{x:0,y:0},size:{x:0,y:0},sizeClipSpace:{x:0,y:0}};let $;class F{get pages(){return this._pages}constructor(W,B,Y){this._document=W,this._config=B,this._unicodeService=Y,this._didWarmUp=!1,this._cacheMap=new S.FourKeyMap,this._cacheMapCombined=new S.FourKeyMap,this._pages=[],this._activePages=[],this._workBoundingBox={top:0,left:0,bottom:0,right:0},this._workAttributeData=new w.AttributeData,this._textureSize=512,this._onAddTextureAtlasCanvas=new f.EventEmitter,this.onAddTextureAtlasCanvas=this._onAddTextureAtlasCanvas.event,this._onRemoveTextureAtlasCanvas=new f.EventEmitter,this.onRemoveTextureAtlasCanvas=this._onRemoveTextureAtlasCanvas.event,this._requestClearModel=!1,this._createNewPage(),this._tmpCanvas=Z(W,4*this._config.deviceCellWidth+4,this._config.deviceCellHeight+4),this._tmpCtx=h.throwIfFalsy(this._tmpCanvas.getContext("2d",{alpha:this._config.allowTransparency,willReadFrequently:!0}))}dispose(){for(let W of this.pages)W.canvas.remove();this._onAddTextureAtlasCanvas.dispose()}warmUp(){this._didWarmUp||(this._doWarmUp(),this._didWarmUp=!0)}_doWarmUp(){const W=new g.IdleTaskQueue;for(let B=33;B<126;B++)W.enqueue(()=>{if(!this._cacheMap.get(B,C.DEFAULT_COLOR,C.DEFAULT_COLOR,C.DEFAULT_EXT)){const Y=this._drawToCache(B,C.DEFAULT_COLOR,C.DEFAULT_COLOR,C.DEFAULT_EXT);this._cacheMap.set(B,C.DEFAULT_COLOR,C.DEFAULT_COLOR,C.DEFAULT_EXT,Y)}})}beginFrame(){return this._requestClearModel}clearTexture(){if(this._pages[0].currentRow.x!==0||this._pages[0].currentRow.y!==0){for(let W of this._pages)W.clear();this._cacheMap.clear(),this._cacheMapCombined.clear(),this._didWarmUp=!1}}_createNewPage(){if(F.maxAtlasPages&&this._pages.length>=Math.max(4,F.maxAtlasPages)){const B=this._pages.filter((q)=>2*q.canvas.width<=(F.maxTextureSize||4096)).sort((q,V)=>V.canvas.width!==q.canvas.width?V.canvas.width-q.canvas.width:V.percentageUsed-q.percentageUsed);let Y=-1,G=0;for(let q=0;q<B.length;q++)if(B[q].canvas.width!==G)Y=q,G=B[q].canvas.width;else if(q-Y==3)break;const T=B.slice(Y,Y+4),J=T.map((q)=>q.glyphs[0].texturePage).sort((q,V)=>q>V?1:-1),X=this.pages.length-T.length,m=this._mergePages(T,X);m.version++;for(let q=J.length-1;q>=0;q--)this._deletePage(J[q]);this.pages.push(m),this._requestClearModel=!0,this._onAddTextureAtlasCanvas.fire(m.canvas)}const W=new O(this._document,this._textureSize);return this._pages.push(W),this._activePages.push(W),this._onAddTextureAtlasCanvas.fire(W.canvas),W}_mergePages(W,B){const Y=2*W[0].canvas.width,G=new O(this._document,Y,W);for(let[T,J]of W.entries()){const X=T*J.canvas.width%Y,m=Math.floor(T/2)*J.canvas.height;G.ctx.drawImage(J.canvas,X,m);for(let V of J.glyphs)V.texturePage=B,V.sizeClipSpace.x=V.size.x/Y,V.sizeClipSpace.y=V.size.y/Y,V.texturePosition.x+=X,V.texturePosition.y+=m,V.texturePositionClipSpace.x=V.texturePosition.x/Y,V.texturePositionClipSpace.y=V.texturePosition.y/Y;this._onRemoveTextureAtlasCanvas.fire(J.canvas);const q=this._activePages.indexOf(J);q!==-1&&this._activePages.splice(q,1)}return G}_deletePage(W){this._pages.splice(W,1);for(let B=W;B<this._pages.length;B++){const Y=this._pages[B];for(let G of Y.glyphs)G.texturePage--;Y.version++}}getRasterizedGlyphCombinedChar(W,B,Y,G,T){return this._getFromCacheMap(this._cacheMapCombined,W,B,Y,G,T)}getRasterizedGlyph(W,B,Y,G,T){return this._getFromCacheMap(this._cacheMap,W,B,Y,G,T)}_getFromCacheMap(W,B,Y,G,T,J=!1){return $=W.get(B,Y,G,T),$||($=this._drawToCache(B,Y,G,T,J),W.set(B,Y,G,T,$)),$}_getColorFromAnsiIndex(W){if(W>=this._config.colors.ansi.length)throw new Error("No color found for idx "+W);return this._config.colors.ansi[W]}_getBackgroundColor(W,B,Y,G){if(this._config.allowTransparency)return D.NULL_COLOR;let T;switch(W){case 16777216:case 33554432:T=this._getColorFromAnsiIndex(B);break;case 50331648:const J=w.AttributeData.toColorRGB(B);T=D.rgba.toColor(J[0],J[1],J[2]);break;default:T=Y?D.color.opaque(this._config.colors.foreground):this._config.colors.background}return T}_getForegroundColor(W,B,Y,G,T,J,X,m,q,V){const Q=this._getMinimumContrastColor(W,B,Y,G,T,J,!1,q,m,V);if(Q)return Q;let k;switch(T){case 16777216:case 33554432:this._config.drawBoldTextInBrightColors&&q&&J<8&&(J+=8),k=this._getColorFromAnsiIndex(J);break;case 50331648:const N=w.AttributeData.toColorRGB(J);k=D.rgba.toColor(N[0],N[1],N[2]);break;default:k=X?this._config.colors.background:this._config.colors.foreground}return this._config.allowTransparency&&(k=D.color.opaque(k)),m&&(k=D.color.multiplyOpacity(k,H.DIM_OPACITY)),k}_resolveBackgroundRgba(W,B,Y){switch(W){case 16777216:case 33554432:return this._getColorFromAnsiIndex(B).rgba;case 50331648:return B<<8;default:return Y?this._config.colors.foreground.rgba:this._config.colors.background.rgba}}_resolveForegroundRgba(W,B,Y,G){switch(W){case 16777216:case 33554432:return this._config.drawBoldTextInBrightColors&&G&&B<8&&(B+=8),this._getColorFromAnsiIndex(B).rgba;case 50331648:return B<<8;default:return Y?this._config.colors.background.rgba:this._config.colors.foreground.rgba}}_getMinimumContrastColor(W,B,Y,G,T,J,X,m,q,V){if(this._config.minimumContrastRatio===1||V)return;const Q=this._getContrastCache(q),k=Q.getColor(W,G);if(k!==void 0)return k||void 0;const N=this._resolveBackgroundRgba(B,Y,X),y=this._resolveForegroundRgba(T,J,X,m),u=D.rgba.ensureContrastRatio(N,y,this._config.minimumContrastRatio/(q?2:1));if(!u)return void Q.setColor(W,G,null);const c=D.rgba.toColor(u>>24&255,u>>16&255,u>>8&255);return Q.setColor(W,G,c),c}_getContrastCache(W){return W?this._config.colors.halfContrastCache:this._config.colors.contrastCache}_drawToCache(W,B,Y,G,T=!1){const J=typeof W=="number"?String.fromCharCode(W):W,X=Math.min(this._config.deviceCellWidth*Math.max(J.length,2)+4,this._textureSize);this._tmpCanvas.width<X&&(this._tmpCanvas.width=X);const m=Math.min(this._config.deviceCellHeight+8,this._textureSize);if(this._tmpCanvas.height<m&&(this._tmpCanvas.height=m),this._tmpCtx.save(),this._workAttributeData.fg=Y,this._workAttributeData.bg=B,this._workAttributeData.extended.ext=G,this._workAttributeData.isInvisible())return p;const q=!!this._workAttributeData.isBold(),V=!!this._workAttributeData.isInverse(),Q=!!this._workAttributeData.isDim(),k=!!this._workAttributeData.isItalic(),N=!!this._workAttributeData.isUnderline(),y=!!this._workAttributeData.isStrikethrough(),u=!!this._workAttributeData.isOverline();let c=this._workAttributeData.getFgColor(),M=this._workAttributeData.getFgColorMode(),_=this._workAttributeData.getBgColor(),U=this._workAttributeData.getBgColorMode();if(V){const d=c;c=_,_=d;const n=M;M=U,U=n}const K=this._getBackgroundColor(U,_,V,Q);this._tmpCtx.globalCompositeOperation="copy",this._tmpCtx.fillStyle=K.css,this._tmpCtx.fillRect(0,0,this._tmpCanvas.width,this._tmpCanvas.height),this._tmpCtx.globalCompositeOperation="source-over";const r=q?this._config.fontWeightBold:this._config.fontWeight,z=k?"italic":"";this._tmpCtx.font=`${z} ${r} ${this._config.fontSize*this._config.devicePixelRatio}px ${this._config.fontFamily}`,this._tmpCtx.textBaseline=H.TEXT_BASELINE;const v0=J.length===1&&h.isPowerlineGlyph(J.charCodeAt(0)),t=J.length===1&&h.isRestrictedPowerlineGlyph(J.charCodeAt(0)),S0=this._getForegroundColor(B,U,_,Y,M,c,V,Q,q,h.excludeFromContrastRatioDemands(J.charCodeAt(0)));this._tmpCtx.fillStyle=S0.css;const e=t?0:4;let W0=!1;this._config.customGlyphs!==!1&&(W0=E.tryDrawCustomChar(this._tmpCtx,J,e,e,this._config.deviceCellWidth,this._config.deviceCellHeight,this._config.fontSize,this._config.devicePixelRatio));let a,A0=!v0;if(a=typeof W=="number"?this._unicodeService.wcwidth(W):this._unicodeService.getStringCellWidth(W),N){this._tmpCtx.save();const d=Math.max(1,Math.floor(this._config.fontSize*this._config.devicePixelRatio/15)),n=d%2==1?0.5:0;if(this._tmpCtx.lineWidth=d,this._workAttributeData.isUnderlineColorDefault())this._tmpCtx.strokeStyle=this._tmpCtx.fillStyle;else if(this._workAttributeData.isUnderlineColorRGB())A0=!1,this._tmpCtx.strokeStyle=`rgb(${w.AttributeData.toColorRGB(this._workAttributeData.getUnderlineColor()).join(",")})`;else{A0=!1;let C0=this._workAttributeData.getUnderlineColor();this._config.drawBoldTextInBrightColors&&this._workAttributeData.isBold()&&C0<8&&(C0+=8),this._tmpCtx.strokeStyle=this._getColorFromAnsiIndex(C0).css}this._tmpCtx.beginPath();const b0=e,E0=Math.ceil(e+this._config.deviceCharHeight)-n-(T?2*d:0),H0=E0+d,h0=E0+2*d;for(let C0=0;C0<a;C0++){this._tmpCtx.save();const R0=b0+C0*this._config.deviceCellWidth,i=b0+(C0+1)*this._config.deviceCellWidth,M0=R0+this._config.deviceCellWidth/2;switch(this._workAttributeData.extended.underlineStyle){case 2:this._tmpCtx.moveTo(R0,E0),this._tmpCtx.lineTo(i,E0),this._tmpCtx.moveTo(R0,h0),this._tmpCtx.lineTo(i,h0);break;case 3:const G0=d<=1?h0:Math.ceil(e+this._config.deviceCharHeight-d/2)-n,V0=d<=1?E0:Math.ceil(e+this._config.deviceCharHeight+d/2)-n,g1=new Path2D;g1.rect(R0,E0,this._config.deviceCellWidth,h0-E0),this._tmpCtx.clip(g1),this._tmpCtx.moveTo(R0-this._config.deviceCellWidth/2,H0),this._tmpCtx.bezierCurveTo(R0-this._config.deviceCellWidth/2,V0,R0,V0,R0,H0),this._tmpCtx.bezierCurveTo(R0,G0,M0,G0,M0,H0),this._tmpCtx.bezierCurveTo(M0,V0,i,V0,i,H0),this._tmpCtx.bezierCurveTo(i,G0,i+this._config.deviceCellWidth/2,G0,i+this._config.deviceCellWidth/2,H0);break;case 4:this._tmpCtx.setLineDash([Math.round(d),Math.round(d)]),this._tmpCtx.moveTo(R0,E0),this._tmpCtx.lineTo(i,E0);break;case 5:this._tmpCtx.setLineDash([4*this._config.devicePixelRatio,3*this._config.devicePixelRatio]),this._tmpCtx.moveTo(R0,E0),this._tmpCtx.lineTo(i,E0);break;default:this._tmpCtx.moveTo(R0,E0),this._tmpCtx.lineTo(i,E0)}this._tmpCtx.stroke(),this._tmpCtx.restore()}if(this._tmpCtx.restore(),!W0&&this._config.fontSize>=12&&!this._config.allowTransparency&&J!==" "){this._tmpCtx.save(),this._tmpCtx.textBaseline="alphabetic";const C0=this._tmpCtx.measureText(J);if(this._tmpCtx.restore(),"actualBoundingBoxDescent"in C0&&C0.actualBoundingBoxDescent>0){this._tmpCtx.save();const R0=new Path2D;R0.rect(b0,E0-Math.ceil(d/2),this._config.deviceCellWidth*a,h0-E0+Math.ceil(d/2)),this._tmpCtx.clip(R0),this._tmpCtx.lineWidth=3*this._config.devicePixelRatio,this._tmpCtx.strokeStyle=K.css,this._tmpCtx.strokeText(J,e,e+this._config.deviceCharHeight),this._tmpCtx.restore()}}}if(u){const d=Math.max(1,Math.floor(this._config.fontSize*this._config.devicePixelRatio/15)),n=d%2==1?0.5:0;this._tmpCtx.lineWidth=d,this._tmpCtx.strokeStyle=this._tmpCtx.fillStyle,this._tmpCtx.beginPath(),this._tmpCtx.moveTo(e,e+n),this._tmpCtx.lineTo(e+this._config.deviceCharWidth*a,e+n),this._tmpCtx.stroke()}if(W0||this._tmpCtx.fillText(J,e,e+this._config.deviceCharHeight),J==="_"&&!this._config.allowTransparency){let d=L(this._tmpCtx.getImageData(e,e,this._config.deviceCellWidth,this._config.deviceCellHeight),K,S0,A0);if(d)for(let n=1;n<=5&&(this._tmpCtx.save(),this._tmpCtx.fillStyle=K.css,this._tmpCtx.fillRect(0,0,this._tmpCanvas.width,this._tmpCanvas.height),this._tmpCtx.restore(),this._tmpCtx.fillText(J,e,e+this._config.deviceCharHeight-n),d=L(this._tmpCtx.getImageData(e,e,this._config.deviceCellWidth,this._config.deviceCellHeight),K,S0,A0),d);n++);}if(y){const d=Math.max(1,Math.floor(this._config.fontSize*this._config.devicePixelRatio/10)),n=this._tmpCtx.lineWidth%2==1?0.5:0;this._tmpCtx.lineWidth=d,this._tmpCtx.strokeStyle=this._tmpCtx.fillStyle,this._tmpCtx.beginPath(),this._tmpCtx.moveTo(e,e+Math.floor(this._config.deviceCharHeight/2)-n),this._tmpCtx.lineTo(e+this._config.deviceCharWidth*a,e+Math.floor(this._config.deviceCharHeight/2)-n),this._tmpCtx.stroke()}this._tmpCtx.restore();const Z0=this._tmpCtx.getImageData(0,0,this._tmpCanvas.width,this._tmpCanvas.height);let F0;if(F0=this._config.allowTransparency?function(d){for(let n=0;n<d.data.length;n+=4)if(d.data[n+3]>0)return!1;return!0}(Z0):L(Z0,K,S0,A0),F0)return p;const g0=this._findGlyphBoundingBox(Z0,this._workBoundingBox,X,t,W0,e);let s,l;for(;;){if(this._activePages.length===0){const d=this._createNewPage();s=d,l=d.currentRow,l.height=g0.size.y;break}s=this._activePages[this._activePages.length-1],l=s.currentRow;for(let d of this._activePages)g0.size.y<=d.currentRow.height&&(s=d,l=d.currentRow);for(let d=this._activePages.length-1;d>=0;d--)for(let n of this._activePages[d].fixedRows)n.height<=l.height&&g0.size.y<=n.height&&(s=this._activePages[d],l=n);if(l.y+g0.size.y>=s.canvas.height||l.height>g0.size.y+2){let d=!1;if(s.currentRow.y+s.currentRow.height+g0.size.y>=s.canvas.height){let n;for(let b0 of this._activePages)if(b0.currentRow.y+b0.currentRow.height+g0.size.y<b0.canvas.height){n=b0;break}if(n)s=n;else if(F.maxAtlasPages&&this._pages.length>=F.maxAtlasPages&&l.y+g0.size.y<=s.canvas.height&&l.height>=g0.size.y&&l.x+g0.size.x<=s.canvas.width)d=!0;else{const b0=this._createNewPage();s=b0,l=b0.currentRow,l.height=g0.size.y,d=!0}}d||(s.currentRow.height>0&&s.fixedRows.push(s.currentRow),l={x:0,y:s.currentRow.y+s.currentRow.height,height:g0.size.y},s.fixedRows.push(l),s.currentRow={x:0,y:l.y+l.height,height:0})}if(l.x+g0.size.x<=s.canvas.width)break;l===s.currentRow?(l.x=0,l.y+=l.height,l.height=0):s.fixedRows.splice(s.fixedRows.indexOf(l),1)}return g0.texturePage=this._pages.indexOf(s),g0.texturePosition.x=l.x,g0.texturePosition.y=l.y,g0.texturePositionClipSpace.x=l.x/s.canvas.width,g0.texturePositionClipSpace.y=l.y/s.canvas.height,g0.sizeClipSpace.x/=s.canvas.width,g0.sizeClipSpace.y/=s.canvas.height,l.height=Math.max(l.height,g0.size.y),l.x+=g0.size.x,s.ctx.putImageData(Z0,g0.texturePosition.x-this._workBoundingBox.left,g0.texturePosition.y-this._workBoundingBox.top,this._workBoundingBox.left,this._workBoundingBox.top,g0.size.x,g0.size.y),s.addGlyph(g0),s.version++,g0}_findGlyphBoundingBox(W,B,Y,G,T,J){B.top=0;const X=G?this._config.deviceCellHeight:this._tmpCanvas.height,m=G?this._config.deviceCellWidth:Y;let q=!1;for(let V=0;V<X;V++){for(let Q=0;Q<m;Q++){const k=V*this._tmpCanvas.width*4+4*Q+3;if(W.data[k]!==0){B.top=V,q=!0;break}}if(q)break}B.left=0,q=!1;for(let V=0;V<J+m;V++){for(let Q=0;Q<X;Q++){const k=Q*this._tmpCanvas.width*4+4*V+3;if(W.data[k]!==0){B.left=V,q=!0;break}}if(q)break}B.right=m,q=!1;for(let V=J+m-1;V>=J;V--){for(let Q=0;Q<X;Q++){const k=Q*this._tmpCanvas.width*4+4*V+3;if(W.data[k]!==0){B.right=V,q=!0;break}}if(q)break}B.bottom=X,q=!1;for(let V=X-1;V>=0;V--){for(let Q=0;Q<m;Q++){const k=V*this._tmpCanvas.width*4+4*Q+3;if(W.data[k]!==0){B.bottom=V,q=!0;break}}if(q)break}return{texturePage:0,texturePosition:{x:0,y:0},texturePositionClipSpace:{x:0,y:0},size:{x:B.right-B.left+1,y:B.bottom-B.top+1},sizeClipSpace:{x:B.right-B.left+1,y:B.bottom-B.top+1},offset:{x:-B.left+J+(G||T?Math.floor((this._config.deviceCellWidth-this._config.deviceCharWidth)/2):0),y:-B.top+J+(G||T?this._config.lineHeight===1?0:Math.round((this._config.deviceCellHeight-this._config.deviceCharHeight)/2):0)}}}}v.TextureAtlas=F,A([R.traceCall],F.prototype,"_drawToCache",null);class O{get percentageUsed(){return this._usedPixels/(this.canvas.width*this.canvas.height)}get glyphs(){return this._glyphs}addGlyph(W){this._glyphs.push(W),this._usedPixels+=W.size.x*W.size.y}constructor(W,B,Y){if(this._usedPixels=0,this._glyphs=[],this.version=0,this.currentRow={x:0,y:0,height:0},this.fixedRows=[],Y)for(let G of Y)this._glyphs.push(...G.glyphs),this._usedPixels+=G._usedPixels;this.canvas=Z(W,B,B),this.ctx=h.throwIfFalsy(this.canvas.getContext("2d",{alpha:!0}))}clear(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.currentRow.x=0,this.currentRow.y=0,this.currentRow.height=0,this.fixedRows.length=0,this.version++}}function L(W,B,Y,G){const T=B.rgba>>>24,J=B.rgba>>>16&255,X=B.rgba>>>8&255,m=Y.rgba>>>24,q=Y.rgba>>>16&255,V=Y.rgba>>>8&255,Q=Math.floor((Math.abs(T-m)+Math.abs(J-q)+Math.abs(X-V))/12);let k=!0;for(let N=0;N<W.data.length;N+=4)W.data[N]===T&&W.data[N+1]===J&&W.data[N+2]===X||G&&Math.abs(W.data[N]-T)+Math.abs(W.data[N+1]-J)+Math.abs(W.data[N+2]-X)<Q?W.data[N+3]=0:k=!1;return k}function Z(W,B,Y){const G=W.createElement("canvas");return G.width=B,G.height=Y,G}},160:(P,v,b)=>{Object.defineProperty(v,"__esModule",{value:!0}),v.contrastRatio=v.toPaddedHex=v.rgba=v.rgb=v.css=v.color=v.channels=v.NULL_COLOR=void 0;const A=b(399);let H=0,E=0,h=0,D=0;var f,S,g,w,C;function R($){const F=$.toString(16);return F.length<2?"0"+F:F}function p($,F){return $<F?(F+0.05)/($+0.05):($+0.05)/(F+0.05)}v.NULL_COLOR={css:"#00000000",rgba:0},function($){$.toCss=function(F,O,L,Z){return Z!==void 0?`#${R(F)}${R(O)}${R(L)}${R(Z)}`:`#${R(F)}${R(O)}${R(L)}`},$.toRgba=function(F,O,L,Z=255){return(F<<24|O<<16|L<<8|Z)>>>0}}(f||(v.channels=f={})),function($){function F(O,L){return D=Math.round(255*L),[H,E,h]=C.toChannels(O.rgba),{css:f.toCss(H,E,h,D),rgba:f.toRgba(H,E,h,D)}}$.blend=function(O,L){if(D=(255&L.rgba)/255,D===1)return{css:L.css,rgba:L.rgba};const Z=L.rgba>>24&255,W=L.rgba>>16&255,B=L.rgba>>8&255,Y=O.rgba>>24&255,G=O.rgba>>16&255,T=O.rgba>>8&255;return H=Y+Math.round((Z-Y)*D),E=G+Math.round((W-G)*D),h=T+Math.round((B-T)*D),{css:f.toCss(H,E,h),rgba:f.toRgba(H,E,h)}},$.isOpaque=function(O){return(255&O.rgba)==255},$.ensureContrastRatio=function(O,L,Z){const W=C.ensureContrastRatio(O.rgba,L.rgba,Z);if(W)return C.toColor(W>>24&255,W>>16&255,W>>8&255)},$.opaque=function(O){const L=(255|O.rgba)>>>0;return[H,E,h]=C.toChannels(L),{css:f.toCss(H,E,h),rgba:L}},$.opacity=F,$.multiplyOpacity=function(O,L){return D=255&O.rgba,F(O,D*L/255)},$.toColorRGB=function(O){return[O.rgba>>24&255,O.rgba>>16&255,O.rgba>>8&255]}}(S||(v.color=S={})),function($){let F,O;if(!A.isNode){const L=document.createElement("canvas");L.width=1,L.height=1;const Z=L.getContext("2d",{willReadFrequently:!0});Z&&(F=Z,F.globalCompositeOperation="copy",O=F.createLinearGradient(0,0,1,1))}$.toColor=function(L){if(L.match(/#[\da-f]{3,8}/i))switch(L.length){case 4:return H=parseInt(L.slice(1,2).repeat(2),16),E=parseInt(L.slice(2,3).repeat(2),16),h=parseInt(L.slice(3,4).repeat(2),16),C.toColor(H,E,h);case 5:return H=parseInt(L.slice(1,2).repeat(2),16),E=parseInt(L.slice(2,3).repeat(2),16),h=parseInt(L.slice(3,4).repeat(2),16),D=parseInt(L.slice(4,5).repeat(2),16),C.toColor(H,E,h,D);case 7:return{css:L,rgba:(parseInt(L.slice(1),16)<<8|255)>>>0};case 9:return{css:L,rgba:parseInt(L.slice(1),16)>>>0}}const Z=L.match(/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(,\s*(0|1|\d?\.(\d+))\s*)?\)/);if(Z)return H=parseInt(Z[1]),E=parseInt(Z[2]),h=parseInt(Z[3]),D=Math.round(255*(Z[5]===void 0?1:parseFloat(Z[5]))),C.toColor(H,E,h,D);if(!F||!O)throw new Error("css.toColor: Unsupported css format");if(F.fillStyle=O,F.fillStyle=L,typeof F.fillStyle!="string")throw new Error("css.toColor: Unsupported css format");if(F.fillRect(0,0,1,1),[H,E,h,D]=F.getImageData(0,0,1,1).data,D!==255)throw new Error("css.toColor: Unsupported css format");return{rgba:f.toRgba(H,E,h,D),css:L}}}(g||(v.css=g={})),function($){function F(O,L,Z){const W=O/255,B=L/255,Y=Z/255;return 0.2126*(W<=0.03928?W/12.92:Math.pow((W+0.055)/1.055,2.4))+0.7152*(B<=0.03928?B/12.92:Math.pow((B+0.055)/1.055,2.4))+0.0722*(Y<=0.03928?Y/12.92:Math.pow((Y+0.055)/1.055,2.4))}$.relativeLuminance=function(O){return F(O>>16&255,O>>8&255,255&O)},$.relativeLuminance2=F}(w||(v.rgb=w={})),function($){function F(L,Z,W){const B=L>>24&255,Y=L>>16&255,G=L>>8&255;let T=Z>>24&255,J=Z>>16&255,X=Z>>8&255,m=p(w.relativeLuminance2(T,J,X),w.relativeLuminance2(B,Y,G));for(;m<W&&(T>0||J>0||X>0);)T-=Math.max(0,Math.ceil(0.1*T)),J-=Math.max(0,Math.ceil(0.1*J)),X-=Math.max(0,Math.ceil(0.1*X)),m=p(w.relativeLuminance2(T,J,X),w.relativeLuminance2(B,Y,G));return(T<<24|J<<16|X<<8|255)>>>0}function O(L,Z,W){const B=L>>24&255,Y=L>>16&255,G=L>>8&255;let T=Z>>24&255,J=Z>>16&255,X=Z>>8&255,m=p(w.relativeLuminance2(T,J,X),w.relativeLuminance2(B,Y,G));for(;m<W&&(T<255||J<255||X<255);)T=Math.min(255,T+Math.ceil(0.1*(255-T))),J=Math.min(255,J+Math.ceil(0.1*(255-J))),X=Math.min(255,X+Math.ceil(0.1*(255-X))),m=p(w.relativeLuminance2(T,J,X),w.relativeLuminance2(B,Y,G));return(T<<24|J<<16|X<<8|255)>>>0}$.ensureContrastRatio=function(L,Z,W){const B=w.relativeLuminance(L>>8),Y=w.relativeLuminance(Z>>8);if(p(B,Y)<W){if(Y<B){const J=F(L,Z,W),X=p(B,w.relativeLuminance(J>>8));if(X<W){const m=O(L,Z,W);return X>p(B,w.relativeLuminance(m>>8))?J:m}return J}const G=O(L,Z,W),T=p(B,w.relativeLuminance(G>>8));if(T<W){const J=F(L,Z,W);return T>p(B,w.relativeLuminance(J>>8))?G:J}return G}},$.reduceLuminance=F,$.increaseLuminance=O,$.toChannels=function(L){return[L>>24&255,L>>16&255,L>>8&255,255&L]},$.toColor=function(L,Z,W,B){return{css:f.toCss(L,Z,W,B),rgba:f.toRgba(L,Z,W,B)}}}(C||(v.rgba=C={})),v.toPaddedHex=R,v.contrastRatio=p},345:(P,v)=>{Object.defineProperty(v,"__esModule",{value:!0}),v.forwardEvent=v.EventEmitter=void 0,v.EventEmitter=class{constructor(){this._listeners=[],this._disposed=!1}get event(){return this._event||(this._event=(b)=>(this._listeners.push(b),{dispose:()=>{if(!this._disposed){for(let A=0;A<this._listeners.length;A++)if(this._listeners[A]===b)return void this._listeners.splice(A,1)}}})),this._event}fire(b,A){const H=[];for(let E=0;E<this._listeners.length;E++)H.push(this._listeners[E]);for(let E=0;E<H.length;E++)H[E].call(void 0,b,A)}dispose(){this.clearListeners(),this._disposed=!0}clearListeners(){this._listeners&&(this._listeners.length=0)}},v.forwardEvent=function(b,A){return b((H)=>A.fire(H))}},859:(P,v)=>{function b(A){for(let H of A)H.dispose();A.length=0}Object.defineProperty(v,"__esModule",{value:!0}),v.getDisposeArrayDisposable=v.disposeArray=v.toDisposable=v.MutableDisposable=v.Disposable=void 0,v.Disposable=class{constructor(){this._disposables=[],this._isDisposed=!1}dispose(){this._isDisposed=!0;for(let A of this._disposables)A.dispose();this._disposables.length=0}register(A){return this._disposables.push(A),A}unregister(A){const H=this._disposables.indexOf(A);H!==-1&&this._disposables.splice(H,1)}},v.MutableDisposable=class{constructor(){this._isDisposed=!1}get value(){return this._isDisposed?void 0:this._value}set value(A){var H;this._isDisposed||A===this._value||((H=this._value)===null||H===void 0||H.dispose(),this._value=A)}clear(){this.value=void 0}dispose(){var A;this._isDisposed=!0,(A=this._value)===null||A===void 0||A.dispose(),this._value=void 0}},v.toDisposable=function(A){return{dispose:A}},v.disposeArray=b,v.getDisposeArrayDisposable=function(A){return{dispose:()=>b(A)}}},485:(P,v)=>{Object.defineProperty(v,"__esModule",{value:!0}),v.FourKeyMap=v.TwoKeyMap=void 0;class b{constructor(){this._data={}}set(A,H,E){this._data[A]||(this._data[A]={}),this._data[A][H]=E}get(A,H){return this._data[A]?this._data[A][H]:void 0}clear(){this._data={}}}v.TwoKeyMap=b,v.FourKeyMap=class{constructor(){this._data=new b}set(A,H,E,h,D){this._data.get(A,H)||this._data.set(A,H,new b),this._data.get(A,H).set(E,h,D)}get(A,H,E,h){var D;return(D=this._data.get(A,H))===null||D===void 0?void 0:D.get(E,h)}clear(){this._data.clear()}}},399:(P,v)=>{Object.defineProperty(v,"__esModule",{value:!0}),v.isChromeOS=v.isLinux=v.isWindows=v.isIphone=v.isIpad=v.isMac=v.getSafariVersion=v.isSafari=v.isLegacyEdge=v.isFirefox=v.isNode=void 0,v.isNode=typeof navigator=="undefined";const b=v.isNode?"node":navigator.userAgent,A=v.isNode?"node":navigator.platform;v.isFirefox=b.includes("Firefox"),v.isLegacyEdge=b.includes("Edge"),v.isSafari=/^((?!chrome|android).)*safari/i.test(b),v.getSafariVersion=function(){if(!v.isSafari)return 0;const H=b.match(/Version\/(\d+)/);return H===null||H.length<2?0:parseInt(H[1])},v.isMac=["Macintosh","MacIntel","MacPPC","Mac68K"].includes(A),v.isIpad=A==="iPad",v.isIphone=A==="iPhone",v.isWindows=["Windows","Win16","Win32","WinCE"].includes(A),v.isLinux=A.indexOf("Linux")>=0,v.isChromeOS=/\bCrOS\b/.test(b)},385:(P,v,b)=>{Object.defineProperty(v,"__esModule",{value:!0}),v.DebouncedIdleTask=v.IdleTaskQueue=v.PriorityTaskQueue=void 0;const A=b(399);class H{constructor(){this._tasks=[],this._i=0}enqueue(h){this._tasks.push(h),this._start()}flush(){for(;this._i<this._tasks.length;)this._tasks[this._i]()||this._i++;this.clear()}clear(){this._idleCallback&&(this._cancelCallback(this._idleCallback),this._idleCallback=void 0),this._i=0,this._tasks.length=0}_start(){this._idleCallback||(this._idleCallback=this._requestCallback(this._process.bind(this)))}_process(h){this._idleCallback=void 0;let D=0,f=0,S=h.timeRemaining(),g=0;for(;this._i<this._tasks.length;){if(D=Date.now(),this._tasks[this._i]()||this._i++,D=Math.max(1,Date.now()-D),f=Math.max(D,f),g=h.timeRemaining(),1.5*f>g)return S-D<-20&&console.warn(`task queue exceeded allotted deadline by ${Math.abs(Math.round(S-D))}ms`),void this._start();S=g}this.clear()}}class E extends H{_requestCallback(h){return setTimeout(()=>h(this._createDeadline(16)))}_cancelCallback(h){clearTimeout(h)}_createDeadline(h){const D=Date.now()+h;return{timeRemaining:()=>Math.max(0,D-Date.now())}}}v.PriorityTaskQueue=E,v.IdleTaskQueue=!A.isNode&&"requestIdleCallback"in window?class extends H{_requestCallback(h){return requestIdleCallback(h)}_cancelCallback(h){cancelIdleCallback(h)}}:E,v.DebouncedIdleTask=class{constructor(){this._queue=new v.IdleTaskQueue}set(h){this._queue.clear(),this._queue.enqueue(h)}flush(){this._queue.flush()}}},147:(P,v)=>{Object.defineProperty(v,"__esModule",{value:!0}),v.ExtendedAttrs=v.AttributeData=void 0;class b{constructor(){this.fg=0,this.bg=0,this.extended=new A}static toColorRGB(H){return[H>>>16&255,H>>>8&255,255&H]}static fromColorRGB(H){return(255&H[0])<<16|(255&H[1])<<8|255&H[2]}clone(){const H=new b;return H.fg=this.fg,H.bg=this.bg,H.extended=this.extended.clone(),H}isInverse(){return 67108864&this.fg}isBold(){return 134217728&this.fg}isUnderline(){return this.hasExtendedAttrs()&&this.extended.underlineStyle!==0?1:268435456&this.fg}isBlink(){return 536870912&this.fg}isInvisible(){return 1073741824&this.fg}isItalic(){return 67108864&this.bg}isDim(){return 134217728&this.bg}isStrikethrough(){return 2147483648&this.fg}isProtected(){return 536870912&this.bg}isOverline(){return 1073741824&this.bg}getFgColorMode(){return 50331648&this.fg}getBgColorMode(){return 50331648&this.bg}isFgRGB(){return(50331648&this.fg)==50331648}isBgRGB(){return(50331648&this.bg)==50331648}isFgPalette(){return(50331648&this.fg)==16777216||(50331648&this.fg)==33554432}isBgPalette(){return(50331648&this.bg)==16777216||(50331648&this.bg)==33554432}isFgDefault(){return(50331648&this.fg)==0}isBgDefault(){return(50331648&this.bg)==0}isAttributeDefault(){return this.fg===0&&this.bg===0}getFgColor(){switch(50331648&this.fg){case 16777216:case 33554432:return 255&this.fg;case 50331648:return 16777215&this.fg;default:return-1}}getBgColor(){switch(50331648&this.bg){case 16777216:case 33554432:return 255&this.bg;case 50331648:return 16777215&this.bg;default:return-1}}hasExtendedAttrs(){return 268435456&this.bg}updateExtended(){this.extended.isEmpty()?this.bg&=-268435457:this.bg|=268435456}getUnderlineColor(){if(268435456&this.bg&&~this.extended.underlineColor)switch(50331648&this.extended.underlineColor){case 16777216:case 33554432:return 255&this.extended.underlineColor;case 50331648:return 16777215&this.extended.underlineColor;default:return this.getFgColor()}return this.getFgColor()}getUnderlineColorMode(){return 268435456&this.bg&&~this.extended.underlineColor?50331648&this.extended.underlineColor:this.getFgColorMode()}isUnderlineColorRGB(){return 268435456&this.bg&&~this.extended.underlineColor?(50331648&this.extended.underlineColor)==50331648:this.isFgRGB()}isUnderlineColorPalette(){return 268435456&this.bg&&~this.extended.underlineColor?(50331648&this.extended.underlineColor)==16777216||(50331648&this.extended.underlineColor)==33554432:this.isFgPalette()}isUnderlineColorDefault(){return 268435456&this.bg&&~this.extended.underlineColor?(50331648&this.extended.underlineColor)==0:this.isFgDefault()}getUnderlineStyle(){return 268435456&this.fg?268435456&this.bg?this.extended.underlineStyle:1:0}}v.AttributeData=b;class A{get ext(){return this._urlId?-469762049&this._ext|this.underlineStyle<<26:this._ext}set ext(H){this._ext=H}get underlineStyle(){return this._urlId?5:(469762048&this._ext)>>26}set underlineStyle(H){this._ext&=-469762049,this._ext|=H<<26&469762048}get underlineColor(){return 67108863&this._ext}set underlineColor(H){this._ext&=-67108864,this._ext|=67108863&H}get urlId(){return this._urlId}set urlId(H){this._urlId=H}constructor(H=0,E=0){this._ext=0,this._urlId=0,this._ext=H,this._urlId=E}clone(){return new A(this._ext,this._urlId)}isEmpty(){return this.underlineStyle===0&&this._urlId===0}}v.ExtendedAttrs=A},782:(P,v,b)=>{Object.defineProperty(v,"__esModule",{value:!0}),v.CellData=void 0;const A=b(133),H=b(855),E=b(147);class h extends E.AttributeData{constructor(){super(...arguments),this.content=0,this.fg=0,this.bg=0,this.extended=new E.ExtendedAttrs,this.combinedData=""}static fromCharData(D){const f=new h;return f.setFromCharData(D),f}isCombined(){return 2097152&this.content}getWidth(){return this.content>>22}getChars(){return 2097152&this.content?this.combinedData:2097151&this.content?A.stringFromCodePoint(2097151&this.content):""}getCode(){return this.isCombined()?this.combinedData.charCodeAt(this.combinedData.length-1):2097151&this.content}setFromCharData(D){this.fg=D[H.CHAR_DATA_ATTR_INDEX],this.bg=0;let f=!1;if(D[H.CHAR_DATA_CHAR_INDEX].length>2)f=!0;else if(D[H.CHAR_DATA_CHAR_INDEX].length===2){const S=D[H.CHAR_DATA_CHAR_INDEX].charCodeAt(0);if(55296<=S&&S<=56319){const g=D[H.CHAR_DATA_CHAR_INDEX].charCodeAt(1);56320<=g&&g<=57343?this.content=1024*(S-55296)+g-56320+65536|D[H.CHAR_DATA_WIDTH_INDEX]<<22:f=!0}else f=!0}else this.content=D[H.CHAR_DATA_CHAR_INDEX].charCodeAt(0)|D[H.CHAR_DATA_WIDTH_INDEX]<<22;f&&(this.combinedData=D[H.CHAR_DATA_CHAR_INDEX],this.content=2097152|D[H.CHAR_DATA_WIDTH_INDEX]<<22)}getAsCharData(){return[this.fg,this.getChars(),this.getWidth(),this.getCode()]}}v.CellData=h},855:(P,v)=>{Object.defineProperty(v,"__esModule",{value:!0}),v.WHITESPACE_CELL_CODE=v.WHITESPACE_CELL_WIDTH=v.WHITESPACE_CELL_CHAR=v.NULL_CELL_CODE=v.NULL_CELL_WIDTH=v.NULL_CELL_CHAR=v.CHAR_DATA_CODE_INDEX=v.CHAR_DATA_WIDTH_INDEX=v.CHAR_DATA_CHAR_INDEX=v.CHAR_DATA_ATTR_INDEX=v.DEFAULT_EXT=v.DEFAULT_ATTR=v.DEFAULT_COLOR=void 0,v.DEFAULT_COLOR=0,v.DEFAULT_ATTR=256|v.DEFAULT_COLOR<<9,v.DEFAULT_EXT=0,v.CHAR_DATA_ATTR_INDEX=0,v.CHAR_DATA_CHAR_INDEX=1,v.CHAR_DATA_WIDTH_INDEX=2,v.CHAR_DATA_CODE_INDEX=3,v.NULL_CELL_CHAR="",v.NULL_CELL_WIDTH=1,v.NULL_CELL_CODE=0,v.WHITESPACE_CELL_CHAR=" ",v.WHITESPACE_CELL_WIDTH=1,v.WHITESPACE_CELL_CODE=32},133:(P,v)=>{Object.defineProperty(v,"__esModule",{value:!0}),v.Utf8ToUtf32=v.StringToUtf32=v.utf32ToString=v.stringFromCodePoint=void 0,v.stringFromCodePoint=function(b){return b>65535?(b-=65536,String.fromCharCode(55296+(b>>10))+String.fromCharCode(b%1024+56320)):String.fromCharCode(b)},v.utf32ToString=function(b,A=0,H=b.length){let E="";for(let h=A;h<H;++h){let D=b[h];D>65535?(D-=65536,E+=String.fromCharCode(55296+(D>>10))+String.fromCharCode(D%1024+56320)):E+=String.fromCharCode(D)}return E},v.StringToUtf32=class{constructor(){this._interim=0}clear(){this._interim=0}decode(b,A){const H=b.length;if(!H)return 0;let E=0,h=0;if(this._interim){const D=b.charCodeAt(h++);56320<=D&&D<=57343?A[E++]=1024*(this._interim-55296)+D-56320+65536:(A[E++]=this._interim,A[E++]=D),this._interim=0}for(let D=h;D<H;++D){const f=b.charCodeAt(D);if(55296<=f&&f<=56319){if(++D>=H)return this._interim=f,E;const S=b.charCodeAt(D);56320<=S&&S<=57343?A[E++]=1024*(f-55296)+S-56320+65536:(A[E++]=f,A[E++]=S)}else f!==65279&&(A[E++]=f)}return E}},v.Utf8ToUtf32=class{constructor(){this.interim=new Uint8Array(3)}clear(){this.interim.fill(0)}decode(b,A){const H=b.length;if(!H)return 0;let E,h,D,f,S=0,g=0,w=0;if(this.interim[0]){let p=!1,$=this.interim[0];$&=(224&$)==192?31:(240&$)==224?15:7;let F,O=0;for(;(F=63&this.interim[++O])&&O<4;)$<<=6,$|=F;const L=(224&this.interim[0])==192?2:(240&this.interim[0])==224?3:4,Z=L-O;for(;w<Z;){if(w>=H)return 0;if(F=b[w++],(192&F)!=128){w--,p=!0;break}this.interim[O++]=F,$<<=6,$|=63&F}p||(L===2?$<128?w--:A[S++]=$:L===3?$<2048||$>=55296&&$<=57343||$===65279||(A[S++]=$):$<65536||$>1114111||(A[S++]=$)),this.interim.fill(0)}const C=H-4;let R=w;for(;R<H;){for(;!(!(R<C)||128&(E=b[R])||128&(h=b[R+1])||128&(D=b[R+2])||128&(f=b[R+3]));)A[S++]=E,A[S++]=h,A[S++]=D,A[S++]=f,R+=4;if(E=b[R++],E<128)A[S++]=E;else if((224&E)==192){if(R>=H)return this.interim[0]=E,S;if(h=b[R++],(192&h)!=128){R--;continue}if(g=(31&E)<<6|63&h,g<128){R--;continue}A[S++]=g}else if((240&E)==224){if(R>=H)return this.interim[0]=E,S;if(h=b[R++],(192&h)!=128){R--;continue}if(R>=H)return this.interim[0]=E,this.interim[1]=h,S;if(D=b[R++],(192&D)!=128){R--;continue}if(g=(15&E)<<12|(63&h)<<6|63&D,g<2048||g>=55296&&g<=57343||g===65279)continue;A[S++]=g}else if((248&E)==240){if(R>=H)return this.interim[0]=E,S;if(h=b[R++],(192&h)!=128){R--;continue}if(R>=H)return this.interim[0]=E,this.interim[1]=h,S;if(D=b[R++],(192&D)!=128){R--;continue}if(R>=H)return this.interim[0]=E,this.interim[1]=h,this.interim[2]=D,S;if(f=b[R++],(192&f)!=128){R--;continue}if(g=(7&E)<<18|(63&h)<<12|(63&D)<<6|63&f,g<65536||g>1114111)continue;A[S++]=g}}return S}}},776:function(P,v,b){var A=this&&this.__decorate||function(g,w,C,R){var p,$=arguments.length,F=$<3?w:R===null?R=Object.getOwnPropertyDescriptor(w,C):R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")F=Reflect.decorate(g,w,C,R);else for(var O=g.length-1;O>=0;O--)(p=g[O])&&(F=($<3?p(F):$>3?p(w,C,F):p(w,C))||F);return $>3&&F&&Object.defineProperty(w,C,F),F},H=this&&this.__param||function(g,w){return function(C,R){w(C,R,g)}};Object.defineProperty(v,"__esModule",{value:!0}),v.traceCall=v.setTraceLogger=v.LogService=void 0;const E=b(859),h=b(97),D={trace:h.LogLevelEnum.TRACE,debug:h.LogLevelEnum.DEBUG,info:h.LogLevelEnum.INFO,warn:h.LogLevelEnum.WARN,error:h.LogLevelEnum.ERROR,off:h.LogLevelEnum.OFF};let f,S=v.LogService=class extends E.Disposable{get logLevel(){return this._logLevel}constructor(g){super(),this._optionsService=g,this._logLevel=h.LogLevelEnum.OFF,this._updateLogLevel(),this.register(this._optionsService.onSpecificOptionChange("logLevel",()=>this._updateLogLevel())),f=this}_updateLogLevel(){this._logLevel=D[this._optionsService.rawOptions.logLevel]}_evalLazyOptionalParams(g){for(let w=0;w<g.length;w++)typeof g[w]=="function"&&(g[w]=g[w]())}_log(g,w,C){this._evalLazyOptionalParams(C),g.call(console,(this._optionsService.options.logger?"":"xterm.js: ")+w,...C)}trace(g,...w){var C,R;this._logLevel<=h.LogLevelEnum.TRACE&&this._log((R=(C=this._optionsService.options.logger)===null||C===void 0?void 0:C.trace.bind(this._optionsService.options.logger))!==null&&R!==void 0?R:console.log,g,w)}debug(g,...w){var C,R;this._logLevel<=h.LogLevelEnum.DEBUG&&this._log((R=(C=this._optionsService.options.logger)===null||C===void 0?void 0:C.debug.bind(this._optionsService.options.logger))!==null&&R!==void 0?R:console.log,g,w)}info(g,...w){var C,R;this._logLevel<=h.LogLevelEnum.INFO&&this._log((R=(C=this._optionsService.options.logger)===null||C===void 0?void 0:C.info.bind(this._optionsService.options.logger))!==null&&R!==void 0?R:console.info,g,w)}warn(g,...w){var C,R;this._logLevel<=h.LogLevelEnum.WARN&&this._log((R=(C=this._optionsService.options.logger)===null||C===void 0?void 0:C.warn.bind(this._optionsService.options.logger))!==null&&R!==void 0?R:console.warn,g,w)}error(g,...w){var C,R;this._logLevel<=h.LogLevelEnum.ERROR&&this._log((R=(C=this._optionsService.options.logger)===null||C===void 0?void 0:C.error.bind(this._optionsService.options.logger))!==null&&R!==void 0?R:console.error,g,w)}};v.LogService=S=A([H(0,h.IOptionsService)],S),v.setTraceLogger=function(g){f=g},v.traceCall=function(g,w,C){if(typeof C.value!="function")throw new Error("not supported");const R=C.value;C.value=function(...p){if(f.logLevel!==h.LogLevelEnum.TRACE)return R.apply(this,p);f.trace(`GlyphRenderer#${R.name}(${p.map((F)=>JSON.stringify(F)).join(", ")})`);const $=R.apply(this,p);return f.trace(`GlyphRenderer#${R.name} return`,$),$}}},726:(P,v)=>{Object.defineProperty(v,"__esModule",{value:!0}),v.createDecorator=v.getServiceDependencies=v.serviceRegistry=void 0;const b="di$target",A="di$dependencies";v.serviceRegistry=new Map,v.getServiceDependencies=function(H){return H[A]||[]},v.createDecorator=function(H){if(v.serviceRegistry.has(H))return v.serviceRegistry.get(H);const E=function(h,D,f){if(arguments.length!==3)throw new Error("@IServiceName-decorator can only be used to decorate a parameter");(function(S,g,w){g[b]===g?g[A].push({id:S,index:w}):(g[A]=[{id:S,index:w}],g[b]=g)})(E,h,f)};return E.toString=()=>H,v.serviceRegistry.set(H,E),E}},97:(P,v,b)=>{Object.defineProperty(v,"__esModule",{value:!0}),v.IDecorationService=v.IUnicodeService=v.IOscLinkService=v.IOptionsService=v.ILogService=v.LogLevelEnum=v.IInstantiationService=v.ICharsetService=v.ICoreService=v.ICoreMouseService=v.IBufferService=void 0;const A=b(726);var H;v.IBufferService=A.createDecorator("BufferService"),v.ICoreMouseService=A.createDecorator("CoreMouseService"),v.ICoreService=A.createDecorator("CoreService"),v.ICharsetService=A.createDecorator("CharsetService"),v.IInstantiationService=A.createDecorator("InstantiationService"),function(E){E[E.TRACE=0]="TRACE",E[E.DEBUG=1]="DEBUG",E[E.INFO=2]="INFO",E[E.WARN=3]="WARN",E[E.ERROR=4]="ERROR",E[E.OFF=5]="OFF"}(H||(v.LogLevelEnum=H={})),v.ILogService=A.createDecorator("LogService"),v.IOptionsService=A.createDecorator("OptionsService"),v.IOscLinkService=A.createDecorator("OscLinkService"),v.IUnicodeService=A.createDecorator("UnicodeService"),v.IDecorationService=A.createDecorator("DecorationService")}},x={};function j(P){var v=x[P];if(v!==void 0)return v.exports;var b=x[P]={exports:{}};return I[P].call(b.exports,b,b.exports,j),b.exports}var o={};return(()=>{var P=o;Object.defineProperty(P,"__esModule",{value:!0}),P.WebglAddon=void 0;const v=j(345),b=j(859),A=j(399),H=j(666),E=j(776);class h extends b.Disposable{constructor(D){if(A.isSafari&&A.getSafariVersion()<16)throw new Error("Webgl2 is only supported on Safari 16 and above");super(),this._preserveDrawingBuffer=D,this._onChangeTextureAtlas=this.register(new v.EventEmitter),this.onChangeTextureAtlas=this._onChangeTextureAtlas.event,this._onAddTextureAtlasCanvas=this.register(new v.EventEmitter),this.onAddTextureAtlasCanvas=this._onAddTextureAtlasCanvas.event,this._onRemoveTextureAtlasCanvas=this.register(new v.EventEmitter),this.onRemoveTextureAtlasCanvas=this._onRemoveTextureAtlasCanvas.event,this._onContextLoss=this.register(new v.EventEmitter),this.onContextLoss=this._onContextLoss.event}activate(D){const f=D._core;if(!D.element)return void this.register(f.onWillOpen(()=>this.activate(D)));this._terminal=D;const{coreService:S,optionsService:g}=f,w=f,C=w._renderService,R=w._characterJoinerService,p=w._charSizeService,$=w._coreBrowserService,F=w._decorationService,O=w._logService,L=w._themeService;E.setTraceLogger(O),this._renderer=this.register(new H.WebglRenderer(D,R,p,$,S,F,g,L,this._preserveDrawingBuffer)),this.register(v.forwardEvent(this._renderer.onContextLoss,this._onContextLoss)),this.register(v.forwardEvent(this._renderer.onChangeTextureAtlas,this._onChangeTextureAtlas)),this.register(v.forwardEvent(this._renderer.onAddTextureAtlasCanvas,this._onAddTextureAtlasCanvas)),this.register(v.forwardEvent(this._renderer.onRemoveTextureAtlasCanvas,this._onRemoveTextureAtlasCanvas)),C.setRenderer(this._renderer),this.register(b.toDisposable(()=>{const Z=this._terminal._core._renderService;Z.setRenderer(this._terminal._core._createRenderer()),Z.handleResize(D.cols,D.rows)}))}get textureAtlas(){var D;return(D=this._renderer)===null||D===void 0?void 0:D.textureAtlas}clearTextureAtlas(){var D;(D=this._renderer)===null||D===void 0||D.clearTextureAtlas()}}P.WebglAddon=h})(),o})())});var w1=U0((X0,y0)=>{(function(I,x){typeof X0=="object"&&typeof y0=="object"?y0.exports=x():typeof define=="function"&&define.amd?define([],x):typeof X0=="object"?X0.FitAddon=x():I.FitAddon=x()})(self,()=>(()=>{var I={};return(()=>{var x=I;Object.defineProperty(x,"__esModule",{value:!0}),x.FitAddon=void 0,x.FitAddon=class{activate(j){this._terminal=j}dispose(){}fit(){const j=this.proposeDimensions();if(!j||!this._terminal||isNaN(j.cols)||isNaN(j.rows))return;const o=this._terminal._core;this._terminal.rows===j.rows&&this._terminal.cols===j.cols||(o._renderService.clear(),this._terminal.resize(j.cols,j.rows))}proposeDimensions(){if(!this._terminal)return;if(!this._terminal.element||!this._terminal.element.parentElement)return;const j=this._terminal._core,o=j._renderService.dimensions;if(o.css.cell.width===0||o.css.cell.height===0)return;const P=this._terminal.options.scrollback===0?0:j.viewport.scrollBarWidth,v=window.getComputedStyle(this._terminal.element.parentElement),b=parseInt(v.getPropertyValue("height")),A=Math.max(0,parseInt(v.getPropertyValue("width"))),H=window.getComputedStyle(this._terminal.element),E=b-(parseInt(H.getPropertyValue("padding-top"))+parseInt(H.getPropertyValue("padding-bottom"))),h=A-(parseInt(H.getPropertyValue("padding-right"))+parseInt(H.getPropertyValue("padding-left")))-P;return{cols:Math.max(2,Math.floor(h/o.css.cell.width)),rows:Math.max(1,Math.floor(E/o.css.cell.height))}}}})(),I})())});import{Text as t0} from"@blockcode/ui";import{Keys as L0} from"@blockcode/core";import{Text as p0} from"@blockcode/ui";import{jsx as D0} from"preact/jsx-runtime";var Y0=/Mac/i.test(navigator.platform||navigator.userAgent),S1=()=>[{label:D0(p0,{id:"micropython.menu.file",defaultMessage:"File"}),menuItems:[[{label:D0(p0,{id:"micropython.menu.newProject",defaultMessage:"New"}),hotkey:[Y0?L0.COMMAND:L0.CONTROL,L0.N],async onClick(){console.log("new")}}],[{label:D0(p0,{id:"micropython.menu.openProject",defaultMessage:"Open"}),hotkey:[Y0?L0.COMMAND:L0.CONTROL,L0.O],async onClick(){console.log("open")}},{label:D0(p0,{id:"micropython.menu.saveProject",defaultMessage:"Save"}),hotkey:[Y0?L0.COMMAND:L0.CONTROL,L0.S],async onClick(){console.log("save")}}],[{label:D0(p0,{id:"micropython.menu.uploadProject",defaultMessage:"Load from your computer"}),async onClick(){console.log("upload")}},{label:D0(p0,{id:"micropython.menu.downloadProject",defaultMessage:"save to your computer"}),async onClick(){console.log("download")}}]]},{label:D0(p0,{id:"micropython.menu.edit",defaultMessage:"Edit"}),menuItems:[[{label:D0(p0,{id:"micropython.menu.undo",defaultMessage:"Undo"}),hotkey:[Y0?L0.COMMAND:L0.CONTROL,L0.Z],async onClick(){console.log("undo")}},{label:D0(p0,{id:"micropython.menu.redo",defaultMessage:"Redo"}),hotkey:Y0?[L0.SHIFT,L0.COMMAND,L0.Z]:[L0.CONTROL,L0.Y],async onClick(){console.log("redo")}}]]}];import{ContextMenu as a1} from"@blockcode/ui";import{CodeEditor as n1} from"@blockcode/code-editor";import{useLocale as d1} from"@blockcode/core";import{ComingSoon as l1} from"@blockcode/ui";function w0(I){const x=globalThis.document,j=x.createElement("style");j.appendChild(x.createTextNode(I)),x.head.append(j)}w0(".wlG9Ta_package-list{background:var(--ui-white);border-right:1px solid var(--ui-black-transparent);border-radius:inherit;flex-direction:column;display:flex;position:relative}.wlG9Ta_list-wrapper{width:60px}.wlG9Ta_package-button{z-index:var(--z-index-extension-button);background:var(--motion-primary);box-sizing:content-box;border-bottom-left-radius:inherit;height:3.25rem;position:absolute;bottom:-1px;left:-1px;right:-1px}.wlG9Ta_package-button:before{--fade-out-distance:15px;content:\"\";top:calc(calc(-1*var(--fade-out-distance)));height:var(--fade-out-distance);background:linear-gradient(#0000,#00000026);position:absolute;left:0;right:0}.wlG9Ta_button{cursor:pointer;background:0 0;border:none;outline:none;width:100%;height:100%}.wlG9Ta_button-icon{width:1.75rem;height:1.75rem}");var m0={listWrapper:"wlG9Ta_list-wrapper",packageList:"wlG9Ta_package-list",packageButton:"wlG9Ta_package-button",button:"wlG9Ta_button",buttonIcon:"wlG9Ta_button-icon"};var R1="./assets/icon-add-package-5a8496eef1cfaf22.svg";import{jsx as B0} from"preact/jsx-runtime";function N0(){const{getText:I}=d1();return B0("div",{className:m0.packageList,children:[B0("div",{className:m0.listWrapper}),B0(l1,{placement:"right",children:B0("div",{className:m0.packageButton,children:B0("button",{className:m0.button,title:I("micropython.packageList.addPackage","Add"),children:B0("img",{className:m0.buttonIcon,src:R1,title:"Add"})})})})]})}import{jsx as Q0,Fragment as o1} from"preact/jsx-runtime";function z0(){return Q0(o1,{children:[Q0(N0,{}),Q0(a1,{children:Q0(n1,{})})]})}import{useRef as s1,useEffect as i1} from"preact/hooks";import{useEditor as t1} from"@blockcode/core";import{classNames as e1} from"@blockcode/ui";var L1=K0(C1(),1),H1=K0(E1(),1),A1=K0(w1(),1);var I0={cursor:"#f8f8f8",foreground:"#f8f8f8",background:"#2d2e2c",selection:"#5da5d5",black:"#1e1e1d",brightblack:"#262625",red:"#ce5c5c",brightred:"#ff7272",green:"#5bcc5b",brightgreen:"#72ff72",yellow:"#cccc5b",brightyellow:"#ffff72",blue:"#5d5dd3",brightblue:"#7279ff",magenta:"#bc5ed1",brightmagenta:"#e572ff",cyan:"#5da5d5",brightcyan:"#72f0ff",white:"#f8f8f8",brightwhite:"#ffffff"};w0(".xterm{cursor:text;-webkit-user-select:none;-ms-user-select:none;user-select:none;position:relative}.xterm.focus,.xterm:focus{outline:none}.xterm .xterm-helpers{z-index:5;position:absolute;top:0}.xterm .xterm-helper-textarea{opacity:0;z-index:-5;white-space:nowrap;resize:none;border:0;width:0;height:0;margin:0;padding:0;position:absolute;top:0;left:-9999em;overflow:hidden}.xterm .composition-view{color:#fff;white-space:nowrap;z-index:1;background:#000;display:none;position:absolute}.xterm .composition-view.active{display:block}.xterm .xterm-viewport{cursor:default;background-color:#000;position:absolute;inset:0;overflow-y:scroll}.xterm .xterm-screen{position:relative}.xterm .xterm-screen canvas{position:absolute;top:0;left:0}.xterm .xterm-scroll-area{visibility:hidden}.xterm-char-measure-element{visibility:hidden;line-height:normal;display:inline-block;position:absolute;top:0;left:-9999em}.xterm.enable-mouse-events{cursor:default}.xterm.xterm-cursor-pointer,.xterm .xterm-cursor-pointer{cursor:pointer}.xterm.column-select.focus{cursor:crosshair}.xterm .xterm-accessibility,.xterm .xterm-message{z-index:10;color:#0000;pointer-events:none;position:absolute;inset:0}.xterm .live-region{width:1px;height:1px;position:absolute;left:-9999px;overflow:hidden}.xterm-dim{opacity:1!important}.xterm-underline-1{text-decoration:underline}.xterm-underline-2{text-decoration:underline double}.xterm-underline-3{text-decoration:underline wavy}.xterm-underline-4{text-decoration:underline dotted}.xterm-underline-5{text-decoration:underline dashed}.xterm-overline{text-decoration:overline}.xterm-overline.xterm-underline-1{text-decoration:underline overline}.xterm-overline.xterm-underline-2{text-decoration:overline double underline}.xterm-overline.xterm-underline-3{text-decoration:overline wavy underline}.xterm-overline.xterm-underline-4{text-decoration:overline dotted underline}.xterm-overline.xterm-underline-5{text-decoration:overline dashed underline}.xterm-strikethrough{text-decoration:line-through}.xterm-screen .xterm-decoration-container .xterm-decoration{z-index:6;position:absolute}.xterm-screen .xterm-decoration-container .xterm-decoration.xterm-decoration-top-layer{z-index:7}.xterm-decoration-overview-ruler{z-index:8;pointer-events:none;position:absolute;top:0;right:0}.xterm-decoration-top{z-index:2;position:relative}");var b1=/Mac/i.test(navigator.platform||navigator.userAgent),r1=/Win/i.test(navigator.platform||navigator.userAgent);function j0(I){const x=new L1.Terminal({convertEol:!0,cursorBlink:!0,cursorInactiveStyle:"none",fontFamily:'"Cascadia Code", Menlo, monospace',fontSize:12,lineHeight:1.2,windowsMode:r1,macOptionIsMeta:b1,macOptionClickForcesSelection:b1,theme:I0});x.open(I),I.style.background=I0.background;const j=new H1.WebglAddon;x.loadAddon(j),j.onContextLoss(()=>j.dispose());const o=new A1.FitAddon;return x.fit=()=>o.fit(),x.loadAddon(o),x.onWriteParsed(()=>x.fit()),x.element.addEventListener("focusin",()=>x.fit()),window.addEventListener("resize",()=>x.fit()),x}w0(".F8uhtG_terminal-wrapper{border-radius:inherit;flex:1;padding:2px;display:flex;position:relative;overflow:hidden}.F8uhtG_terminal-wrapper .xterm{position:absolute}");var h1={terminalWrapper:"F8uhtG_terminal-wrapper"};import{jsx as g2} from"preact/jsx-runtime";function c0({className:I}){const x=s1(null),{device:j}=t1();if(x.term)if(j){if(x.term.disabled=!1,j.serial.listenerCount("data")===0)j.serial.on("data",(o)=>x.term.write(o)),x.term.onData((o)=>j.writeAndReadUntil(o)),x.term.clear()}else x.term.disabled=!0,x.term._core._onData.clearListeners();return i1(()=>{if(x.current)x.term=j0(x.current),x.term.disabled=!0,x.term.element.addEventListener("focusin",()=>{if(x.term.disabled)x.term.blur()}),x.resizeObserver=new window.ResizeObserver(()=>x.term.fit(!0)),x.resizeObserver.observe(x.current);return()=>{if(x.term)x.resizeObserver.unobserve(x.current),x.term.dispose(),x.term=null}},[x]),g2("div",{className:e1(h1.terminalWrapper,I),ref:x})}import{useLocale as H2,useEditor as A2} from"@blockcode/core";import{classNames as $1} from"@blockcode/ui";import{useLocale as R2,useEditor as C2,MicroPythonBoard as E2} from"@blockcode/core";var p1=[{usbVendorId:12346},{usbVendorId:11914}];w0("._2ghkea_status-icon{cursor:pointer;height:1.25rem}._2ghkea_status-text{flex:1}");var D1={statusIcon:"_2ghkea_status-icon",statusText:"_2ghkea_status-text"};var O1="./assets/status-not-ready-0f9d57eed7fe9b83.svg";var W1="./assets/status-ready-038751c506ee8838.svg";import{jsx as w2} from"preact/jsx-runtime";function d0(){const{getText:I}=R2(),{device:x,connectDevice:j}=C2(),o=x?I("micropython.deviceManager.ready","Ready"):I("micropython.deviceManager.notReady","Not Ready"),P=async()=>{if(x){try{await x.disconnect()}catch(v){console.error(v)}j(null)}else{const v=new E2;try{await v.requestPort(p1),await v.connect(),await v.stop(),j(v)}catch(A){console.error(A)}const b=()=>setTimeout(async()=>{if(v.connected)b();else j(null)},1000);b()}};return w2("img",{className:D1.statusIcon,src:x?W1:O1,title:o,onClick:P})}w0(".Rg0_6G_toolbar-wrapper{height:var(--tool-bar-height);padding:var(--space)0;flex-shrink:0;justify-content:space-between;align-items:center;display:flex}.Rg0_6G_run-code,.Rg0_6G_stop-all{user-select:none;cursor:pointer;border:0;border-radius:.25rem;width:2rem;height:2rem;padding:.375rem}.Rg0_6G_run-code img,.Rg0_6G_stop-all img{width:100%;height:100%}.Rg0_6G_run-code:hover,.Rg0_6G_stop-all:hover{background:var(--motion-light-transparent)}.Rg0_6G_run-code.Rg0_6G_actived{background:var(--motion-transparent)}.Rg0_6G_stop-all{opacity:.5}.Rg0_6G_stop-all.Rg0_6G_actived{opacity:1}.Rg0_6G_run-code.Rg0_6G_disabled,.Rg0_6G_stop-all.Rg0_6G_disabled{cursor:default;opacity:.5}.Rg0_6G_run-code.Rg0_6G_disabled:hover,.Rg0_6G_stop-all.Rg0_6G_disabled:hover{background:0 0}.Rg0_6G_toolbar-button{width:calc(2rem + 2px);height:calc(2rem + 2px);padding:.375rem!important}.Rg0_6G_button-icon{vertical-align:middle;width:100%;height:100%}.Rg0_6G_space{margin-left:.2rem}.Rg0_6G_toolbar-button-group{display:flex}.Rg0_6G_group-button-first{border-top-right-radius:0;border-bottom-right-radius:0}.Rg0_6G_group-button{border-left:none;border-radius:0}.Rg0_6G_group-button-last{border-left:none;border-top-left-radius:0;border-bottom-left-radius:0}.Rg0_6G_group-button-toggled-off{filter:saturate(0)}");var f0={actived:"Rg0_6G_actived",groupButtonLast:"Rg0_6G_group-button-last",groupButtonToggledOff:"Rg0_6G_group-button-toggled-off",buttonIcon:"Rg0_6G_button-icon",space:"Rg0_6G_space",toolbarButton:"Rg0_6G_toolbar-button",stopAll:"Rg0_6G_stop-all",groupButton:"Rg0_6G_group-button",toolbarWrapper:"Rg0_6G_toolbar-wrapper",toolbarButtonGroup:"Rg0_6G_toolbar-button-group",runCode:"Rg0_6G_run-code",disabled:"Rg0_6G_disabled",groupButtonFirst:"Rg0_6G_group-button-first"};var Z1="./assets/icon-run-code-3ca2e75390db71e4.svg";var f1="./assets/icon-stop-all-9deb61cb903f7a6c.svg";import{jsx as q0} from"preact/jsx-runtime";function l0(){const{getText:I}=H2(),{device:x}=A2(),j=!x;return q0("div",{className:f0.toolbarWrapper,children:[q0("div",{className:f0.toolbarButtonGroup,children:[q0("img",{className:$1(f0.runCode,{[f0.disabled]:j}),src:Z1,title:I("micropython.runCode","Run")}),q0("img",{className:$1(f0.stopAll,{[f0.disabled]:j}),src:f1,title:I("micropython.stopAll","Stop")})]}),q0("div",{className:f0.toolbarButtonGroup,children:q0(d0,{})})]})}import{useEditor as J2,useLocale as X2,exportFile as _2} from"@blockcode/core";import{IconSelector as P2,ActionButton as k2} from"@blockcode/ui";import{useLocale as h2,useEditor as p2} from"@blockcode/core";import{classNames as D2,Label as a0,BufferedInput as F1,Input as O2} from"@blockcode/ui";w0(".RSt__W_file-info-wrapper{background:var(--ui-white);color:var(--text-primary);border-top-left-radius:var(--space);border-top-right-radius:var(--space);border-bottom:1px solid var(--ui-black-transparent);padding:.75rem}.RSt__W_row{justify-content:space-between;display:flex}.RSt__W_row-primary{margin-bottom:.5rem}.RSt__W_group{flex-direction:row;align-items:center;display:inline-flex}.RSt__W_filename-input{flex:1}.RSt__W_filesize-input{width:4rem}");var $0={filesizeInput:"RSt__W_filesize-input",fileInfoWrapper:"RSt__W_file-info-wrapper",group:"RSt__W_group",rowPrimary:"RSt__W_row-primary",row:"RSt__W_row",filenameInput:"RSt__W_filename-input"};import{jsx as O0} from"preact/jsx-runtime";var W2=(I)=>{if(I>1048576)return`${(I/1024/1024).toFixed(2)}MB`;if(I>1024)return`${(I/1024).toFixed(2)}KB`;return`${I}B`};function n0(){const{getText:I}=h2(),{fileList:x,selectedIndex:j,renameFile:o}=p2(),P=j>=0&&x[j],v=j===-1,b=(E)=>o(E),A=P?P.name.slice(0,P.name.lastIndexOf(".")):"",H=P?P.name.slice(P.name.lastIndexOf(".")+1):"";return O0("div",{className:$0.fileInfoWrapper,children:[O0("div",{className:D2($0.row,$0.rowPrimary),children:[O0(a0,{text:I("micropython.fileInfo.name","File")}),O0(F1,{className:$0.filenameInput,disabled:v,onSubmit:(E)=>b(`${E}.${H}`),value:A})]}),O0("div",{className:$0.row,children:[O0(a0,{secondary:!0,text:I("micropython.fileInfo.type","Type"),children:O0(F1,{small:!0,disabled:v||P.readOnly,onSubmit:(E)=>b(`${A}.${E}`),value:H})}),O0(a0,{secondary:!0,text:I("micropython.fileInfo.size","Size"),children:O0(O2,{small:!0,disabled:!0,className:$0.filesizeInput,value:P?W2(P.buffer?P.buffer.byteLength:P.content.length):""})})]})]})}w0(".iCOoyG_file-selector-wrapper{background-color:var(--ui-secondary);border-top-right-radius:var(--space);border-top-left-radius:var(--space);border:1px solid var(--ui-black-transparent);border-bottom:0;flex:1;position:relative}.iCOoyG_delete-menu-item:hover{background:var(--error-primary)}.iCOoyG_add-button{position:absolute;bottom:.75rem;right:1rem}");var _0={deleteMenuItem:"iCOoyG_delete-menu-item",addButton:"iCOoyG_add-button",fileSelectorWrapper:"iCOoyG_file-selector-wrapper"};var m1="./assets/icon-new-218a55086844ac80.svg";var B1="./assets/icon-file-upload-c23f079a5e6707a2.svg";var q1="./assets/icon-new-code-1967fe45c3b09925.svg";var M1="./assets/icon-new-json-7bb8b4e3758c956d.svg";var Y1="./assets/icon-binary-bd5ff37e4e663e60.svg";var G1="./assets/icon-csv-01ac17dad06788cf.svg";var V1="./assets/icon-ini-30c1f7addc4a45b0.svg";var Q1="./assets/icon-json-72188f5285d8a412.svg";var T1="./assets/icon-markdown-070856945802769c.svg";var J1="./assets/icon-micropython-00b80a7b0306f321.svg";var X1="./assets/icon-text-e3fcfa7f9edb7357.svg";var _1="./assets/icon-image-ce19e915bc1158a6.svg";var P1="./assets/icon-svg-b32916bd8eb3bb12.svg";import{jsx as P0} from"preact/jsx-runtime";var K2=(I)=>{if(I>1048576)return`${(I/1024/1024).toFixed(2)}MB`;if(I>1024)return`${(I/1024).toFixed(2)}KB`;return`${I}B`},U2=(I)=>{if(I.endsWith(".csv"))return G1;if(I.endsWith(".ini"))return V1;if(I.endsWith(".json"))return Q1;if(I.endsWith(".md"))return T1;if(I.endsWith(".py"))return J1;if(I.endsWith(".txt"))return X1;if(I.endsWith(".svg"))return P1;if(/$.*\.(png|jpg|jpeg|gif|bmp)$/.test(I))return _1;return Y1};function o0(){const{getText:I}=X2(),{fileList:x,selectedIndex:j,addFile:o,openFile:P,deleteFile:v}=J2(),b=async({target:A})=>{for(let H of A.files)o({name:H.name,.../^(text|image\/svg).*$/i.test(H.type)?{content:await H.text()}:{content:`------------------------------
${I("micropython.fileInfo.title","File Info")}
------------------------------
${I("micropython.fileInfo.name","File")}: ${H.name}
${I("micropython.fileInfo.type","Type")}: ${H.type}
${I("micropython.fileInfo.size","Size")}: ${K2(H.size)}
${I("micropython.fileInfo.modified","Modified")}: ${new Date(H.lastModified).toLocaleString()}`,buffer:await H.arrayBuffer(),readOnly:!0}})};return P0("div",{className:_0.fileSelectorWrapper,children:[P0(n0,{}),P0(P2,{items:x.map((A,H)=>({...A,icon:U2(A.name),order:A.order||H,contextMenu:[[{label:I("micropython.contextMenu.duplicate","duplicate"),onClick:()=>o({...A,name:`${A.name.split(".")[0]}-${x.length+1}.py`})},{label:I("micropython.contextMenu.export","export"),onClick:()=>_2(A.content,A.name)}],[{label:I("micropython.contextMenu.delete","delete"),className:_0.deleteMenuItem,onClick:()=>v(H)}]]})),selectedIndex:j,onSelect:P,onDelete:v}),P0(k2,{className:_0.addButton,icon:m1,tooltip:I("micropython.actionButton.newCode","Create new Code"),onClick:()=>o({name:`code-${x.length+1}.py`,content:""}),moreButtons:[{icon:B1,tooltip:I("micropython.actionButton.upload","Upload File"),fileAccept:"image/*,audio/*,video/*,text/*",fileMultiple:!0,onFileChange:b},{icon:M1,tooltip:I("micropython.actionButton.newJSON","Create new JSON"),onClick:()=>o({name:`text-${x.length+1}.json`,content:"{\n    \n}"})},{icon:q1,tooltip:I("micropython.actionButton.newCode","Create new Code"),onClick:()=>o({name:`code-${x.length+1}.py`,content:""})}]})]})}w0(".gzH9cG_sidebar-wrapper{flex-direction:column;width:20rem;height:100%;display:flex}.gzH9cG_list-wrapper{flex-direction:row;height:100%;display:flex}");var r0={sidebarWrapper:"gzH9cG_sidebar-wrapper",listWrapper:"gzH9cG_list-wrapper"};import{jsx as k0} from"preact/jsx-runtime";function s0(){return k0("div",{className:r0.sidebarWrapper,children:[k0(l0,{}),k0("div",{className:r0.listWrapper,children:k0(o0,{})})]})}w0(".fPtN-q_pane{height:8rem}");var k1={pane:"fPtN-q_pane"};import{jsx as N2} from"preact/jsx-runtime";function i0(){return N2("div",{className:k1.pane})}var K1={fileList:[{id:"main",type:"text/x-python",content:`# hello world!
import machine

print("hello world!")
`},{id:"test",type:"text/x-python",content:'print("test")'}]};var U1="./assets/icon-code-08d9a776dd0807e8.svg";var N1="./assets/icon-repl-0766a6776154c7b8.svg";var z1={"micropython.menu.file":"File","micropython.menu.newProject":"New","micropython.menu.openProject":"Open","micropython.menu.saveProject":"Save","micropython.menu.uploadProject":"Load from your computer","micropython.menu.downloadProject":"Save to your computer","micropython.menu.edit":"Edit","micropython.menu.undo":"Undo","micropython.menu.redo":"Redo","micropython.runCode":"Run","micropython.stopAll":"Stop","micropython.syncDevice":"Sync","micropython.codeTab":"Code","micropython.replTab":"REPL","micropython.deviceManager.connect":"Connect Hardware...","micropython.deviceManager.notReady":"Not ready","micropython.deviceManager.ready":"Ready","micropython.packageList.title":"Modules","micropython.packageList.addPackage":"Add Package","micropython.fileInfo.title":"File Info","micropython.fileInfo.name":"File","micropython.fileInfo.type":"Type","micropython.fileInfo.size":"Size","micropython.fileInfo.modified":"Modified","micropython.actionButton.newCode":"Create new Code","micropython.actionButton.newJSON":"Create new JSON","micropython.actionButton.upload":"Upload File","micropython.contextMenu.duplicate":"duplicate","micropython.contextMenu.export":"export","micropython.contextMenu.delete":"delete","micropython.recordPane.title":"Record"};var u1={"micropython.menu.file":"\u6587\u4EF6","micropython.menu.newProject":"\u65B0\u4F5C\u54C1","micropython.menu.openProject":"\u6253\u5F00","micropython.menu.saveProject":"\u4FDD\u5B58","micropython.menu.uploadProject":"\u4ECE\u7535\u8111\u4E2D\u6253\u5F00","micropython.menu.downloadProject":"\u4FDD\u5B58\u5230\u7535\u8111","micropython.menu.edit":"\u7F16\u8F91","micropython.menu.undo":"\u64A4\u9500","micropython.menu.redo":"\u6062\u590D","micropython.runCode":"\u8FD0\u884C","micropython.stopAll":"\u505C\u6B62","micropython.syncDevice":"\u540C\u6B65","micropython.codeTab":"\u4EE3\u7801","micropython.replTab":"\u4EA4\u4E92\u6267\u884C","micropython.deviceManager.connect":"\u8FDE\u63A5\u786C\u4EF6...","micropython.deviceManager.notReady":"\u672A\u8FDE\u63A5","micropython.deviceManager.ready":"\u5DF2\u8FDE\u63A5","micropython.packageList.title":"\u6269\u5C55\u5305","micropython.packageList.addPackage":"\u6DFB\u52A0\u6269\u5C55\u5305","micropython.fileInfo.title":"\u6587\u4EF6\u4FE1\u606F","micropython.fileInfo.name":"\u6587\u4EF6","micropython.fileInfo.type":"\u7C7B\u578B","micropython.fileInfo.size":"\u5927\u5C0F","micropython.fileInfo.modified":"\u4FEE\u6539\u65E5\u671F","micropython.actionButton.newCode":"\u521B\u5EFA\u65B0\u4EE3\u7801","micropython.actionButton.newJSON":"\u521B\u5EFA\u65B0 JSON","micropython.actionButton.upload":"\u4E0A\u4F20\u6587\u4EF6","micropython.contextMenu.duplicate":"\u590D\u5236","micropython.contextMenu.export":"\u5BFC\u51FA","micropython.contextMenu.delete":"\u5220\u9664","micropython.recordPane.title":"\u8BB0\u5F55"};import{jsx as e0} from"preact/jsx-runtime";function x2({addLocaleData:I,setLayout:x,openProject:j,changeFile:o}){I({en:z1,"zh-Hans":u1}),j(Object.assign({selectedIndex:0},K1)),x({menus:S1(),tabs:[{icon:U1,label:e0(t0,{id:"micropython.codeTab",defaultMessage:"Code"}),Content:z0},{icon:N1,label:e0(t0,{id:"micropython.replTab",defaultMessage:"REPL"}),Content:c0}],sidebars:[{expand:"left",Content:s0}],pane:{label:e0(t0,{id:"micropython.recordPane.title",defaultMessage:"Record"}),Content:i0},tutorials:!0,canEditProjectName:!0})}export{x2 as default};
