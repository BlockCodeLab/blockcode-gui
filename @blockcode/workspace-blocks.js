var t1=Object.create;var{defineProperty:L1,getPrototypeOf:o1,getOwnPropertyNames:e1}=Object;var Z0=Object.prototype.hasOwnProperty;var W0=(W,Y,Q)=>{Q=W!=null?t1(o1(W)):{};const H=Y||!W||!W.__esModule?L1(Q,"default",{value:W,enumerable:!0}):Q;for(let K of e1(W))if(!Z0.call(H,K))L1(H,K,{get:()=>W[K],enumerable:!0});return H};var Y0=(W,Y)=>()=>(Y||W((Y={exports:{}}).exports,Y),Y.exports);var C1=Y0((U1)=>{(function(){var W=typeof U1!="undefined"&&U1||typeof define!="undefined"&&{}||this||window;if(typeof define!=="undefined")define("save-svg-as-png",[],function(){return W});W.default=W;var Y="http://www.w3.org/2000/xmlns/",Q="http://www.w3.org/1999/xhtml",H="http://www.w3.org/2000/svg",K='<?xml version="1.0" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd" [<!ENTITY nbsp "&#160;">]>',U=/url\(["']?(.+?)["']?\)/,I={woff2:"font/woff2",woff:"font/woff",otf:"application/x-font-opentype",ttf:"application/x-font-ttf",eot:"application/vnd.ms-fontobject",sfnt:"application/font-sfnt",svg:"image/svg+xml"},N=function $(R){return R instanceof HTMLElement||R instanceof SVGElement},f=function $(R){if(!N(R))throw new Error("an HTMLElement or SVGElement is required; got "+R)},V=function $(R){return new Promise(function(q,z){if(N(R))q(R);else z(new Error("an HTMLElement or SVGElement is required; got "+R))})},_=function $(R){return R&&R.lastIndexOf("http",0)===0&&R.lastIndexOf(window.location.host)===-1},w=function $(R){var q=Object.keys(I).filter(function(z){return R.indexOf("."+z)>0}).map(function(z){return I[z]});if(q)return q[0];return console.error("Unknown font format for "+R+". Fonts may not be working correctly."),"application/octet-stream"},C=function $(R){var q="",z=new Uint8Array(R);for(var F=0;F<z.byteLength;F++)q+=String.fromCharCode(z[F]);return window.btoa(q)},B=function $(R,q,z){var F=R.viewBox&&R.viewBox.baseVal&&R.viewBox.baseVal[z]||q.getAttribute(z)!==null&&!q.getAttribute(z).match(/%$/)&&parseInt(q.getAttribute(z))||R.getBoundingClientRect()[z]||parseInt(q.style[z])||parseInt(window.getComputedStyle(R).getPropertyValue(z));return typeof F==="undefined"||F===null||isNaN(parseFloat(F))?0:F},D=function $(R,q,z,F){if(R.tagName==="svg")return{width:z||B(R,q,"width"),height:F||B(R,q,"height")};else if(R.getBBox){var A=R.getBBox(),M=A.x,O=A.y,E=A.width,L=A.height;return{width:M+E,height:O+L}}},m=function $(R){return decodeURIComponent(encodeURIComponent(R).replace(/%([0-9A-F]{2})/g,function(q,z){var F=String.fromCharCode("0x"+z);return F==="%"?"%25":F}))},u=function $(R){var q=window.atob(R.split(",")[1]),z=R.split(",")[0].split(":")[1].split(";")[0],F=new ArrayBuffer(q.length),A=new Uint8Array(F);for(var M=0;M<q.length;M++)A[M]=q.charCodeAt(M);return new Blob([F],{type:z})},t=function $(R,q){if(!q)return;try{return R.querySelector(q)||R.parentNode&&R.parentNode.querySelector(q)}catch(z){console.warn('Invalid CSS selector "'+q+'"',z)}},o=function $(R,q){var z=R.cssText.match(U),F=z&&z[1]||"";if(!F||F.match(/^data:/)||F==="about:blank")return;var A=F.startsWith("../")?q+"/../"+F:F.startsWith("./")?q+"/."+F:F;return{text:R.cssText,format:w(A),url:A}},J=function $(R){return Promise.all(Array.from(R.querySelectorAll("image")).map(function(q){var z=q.getAttributeNS("http://www.w3.org/1999/xlink","href")||q.getAttribute("href");if(!z)return Promise.resolve(null);if(_(z))z+=(z.indexOf("?")===-1?"?":"&")+"t="+(new Date()).valueOf();return new Promise(function(F,A){var M=document.createElement("canvas"),O=new Image;O.crossOrigin="anonymous",O.src=z,O.onerror=function(){return A(new Error("Could not load "+z))},O.onload=function(){M.width=O.width,M.height=O.height,M.getContext("2d").drawImage(O,0,0),q.setAttributeNS("http://www.w3.org/1999/xlink","href",M.toDataURL("image/png")),F(!0)}})}))},P={},h=function $(R){return Promise.all(R.map(function(q){return new Promise(function(z,F){if(P[q.url])return z(P[q.url]);var A=new XMLHttpRequest;A.addEventListener("load",function(){var M=C(A.response),O=q.text.replace(U,'url("data:'+q.format+";base64,"+M+'")')+"\n";P[q.url]=O,z(O)}),A.addEventListener("error",function(M){console.warn("Failed to load font from: "+q.url,M),P[q.url]=null,z(null)}),A.addEventListener("abort",function(M){console.warn("Aborted loading font from: "+q.url,M),z(null)}),A.open("GET",q.url),A.responseType="arraybuffer",A.send()})})).then(function(q){return q.filter(function(z){return z}).join("")})},S=null,i=function $(){if(S)return S;return S=Array.from(document.styleSheets).map(function(R){try{return{rules:R.cssRules,href:R.href}}catch(q){return console.warn("Stylesheet could not be loaded: "+R.href,q),{}}})},Q1=function $(R,q){var z=q||{},F=z.selectorRemap,A=z.modifyStyle,M=z.modifyCss,O=z.fonts,E=z.excludeUnusedCss,L=M||function(T,s){var x=F?F(T):T,X=A?A(s):s;return x+"{"+X+"}\n"},g=[],b=typeof O==="undefined",d=O||[];return i().forEach(function(T){var{rules:s,href:x}=T;if(!s)return;Array.from(s).forEach(function(X){if(typeof X.style!="undefined"){if(t(R,X.selectorText))g.push(L(X.selectorText,X.style.cssText));else if(b&&X.cssText.match(/^@font-face/)){var l=o(X,x);if(l)d.push(l)}else if(!E)g.push(X.cssText)}})}),h(d).then(function(T){return g.join("\n")+T})},z1=function $(){if(!navigator.msSaveOrOpenBlob&&!("download"in document.createElement("a")))return{popup:window.open()}};W.prepareSvg=function($,R,q){f($);var z=R||{},F=z.left,A=F===void 0?0:F,M=z.top,O=M===void 0?0:M,E=z.width,L=z.height,g=z.scale,b=g===void 0?1:g,d=z.responsive,T=d===void 0?!1:d,s=z.excludeCss,x=s===void 0?!1:s;return J($).then(function(){var X=$.cloneNode(!0);X.style.backgroundColor=(R||{}).backgroundColor||$.style.backgroundColor;var l=D($,X,E,L),c=l.width,a=l.height;if($.tagName!=="svg")if($.getBBox){if(X.getAttribute("transform")!=null)X.setAttribute("transform",X.getAttribute("transform").replace(/translate\(.*?\)/,""));var T1=document.createElementNS("http://www.w3.org/2000/svg","svg");T1.appendChild(X),X=T1}else{console.error("Attempted to render non-SVG element",$);return}if(X.setAttribute("version","1.1"),X.setAttribute("viewBox",[A,O,c,a].join(" ")),!X.getAttribute("xmlns"))X.setAttributeNS(Y,"xmlns",H);if(!X.getAttribute("xmlns:xlink"))X.setAttributeNS(Y,"xmlns:xlink","http://www.w3.org/1999/xlink");if(T)X.removeAttribute("width"),X.removeAttribute("height"),X.setAttribute("preserveAspectRatio","xMinYMin meet");else X.setAttribute("width",c*b),X.setAttribute("height",a*b);if(Array.from(X.querySelectorAll("foreignObject > *")).forEach(function(q1){q1.setAttributeNS(Y,"xmlns",q1.tagName==="svg"?H:Q)}),x){var O1=document.createElement("div");O1.appendChild(X);var j1=O1.innerHTML;if(typeof q==="function")q(j1,c,a);else return{src:j1,width:c,height:a}}else return Q1($,R).then(function(q1){var N1=document.createElement("style");N1.setAttribute("type","text/css"),N1.innerHTML="<![CDATA[\n"+q1+"\n]]>";var S1=document.createElement("defs");S1.appendChild(N1),X.insertBefore(S1,X.firstChild);var _1=document.createElement("div");_1.appendChild(X);var w1=_1.innerHTML.replace(/NS\d+:href/gi,'xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href');if(typeof q==="function")q(w1,c,a);else return{src:w1,width:c,height:a}})})},W.svgAsDataUri=function($,R,q){return f($),W.prepareSvg($,R).then(function(z){var{src:F,width:A,height:M}=z,O="data:image/svg+xml;base64,"+window.btoa(m(K+F));if(typeof q==="function")q(O,A,M);return O})},W.svgAsPngUri=function($,R,q){f($);var z=R||{},F=z.encoderType,A=F===void 0?"image/png":F,M=z.encoderOptions,O=M===void 0?0.8:M,E=z.canvg,L=function g(b){var{src:d,width:T,height:s}=b,x=document.createElement("canvas"),X=x.getContext("2d"),l=window.devicePixelRatio||1;if(x.width=T*l,x.height=s*l,x.style.width=x.width+"px",x.style.height=x.height+"px",X.setTransform(l,0,0,l,0,0),E)E(x,d);else X.drawImage(d,0,0);var c=void 0;try{c=x.toDataURL(A,O)}catch(a){if(typeof SecurityError!=="undefined"&&a instanceof SecurityError||a.name==="SecurityError"){console.error("Rendered SVG images cannot be downloaded in this browser.");return}else throw a}if(typeof q==="function")q(c,x.width,x.height);return Promise.resolve(c)};if(E)return W.prepareSvg($,R).then(L);else return W.svgAsDataUri($,R).then(function(g){return new Promise(function(b,d){var T=new Image;T.onload=function(){return b(L({src:T,width:T.width,height:T.height}))},T.onerror=function(){d("There was an error loading the data URI as an image on the following SVG\n"+window.atob(g.slice(26))+"Open the following link to see browser\'s diagnosis\n"+g)},T.src=g})})},W.download=function($,R,q){if(navigator.msSaveOrOpenBlob)navigator.msSaveOrOpenBlob(u(R),$);else{var z=document.createElement("a");if("download"in z){z.download=$,z.style.display="none",document.body.appendChild(z);try{var F=u(R),A=URL.createObjectURL(F);z.href=A,z.onclick=function(){return requestAnimationFrame(function(){return URL.revokeObjectURL(A)})}}catch(M){console.error(M),console.warn("Error while getting object URL. Falling back to string URL."),z.href=R}z.click(),document.body.removeChild(z)}else if(q&&q.popup)q.popup.document.title=$,q.popup.location.replace(R)}},W.saveSvg=function($,R,q){var z=z1();return V($).then(function(F){return W.svgAsDataUri(F,q||{})}).then(function(F){return W.download(R,F,z)})},W.saveSvgAsPng=function($,R,q){var z=z1();return V($).then(function(F){return W.svgAsPngUri(F,q||{})}).then(function(F){return W.download(R,F,z)})}})()});import{Text as n1} from"@blockcode/ui";var m1=W0(C1(),1);import{Keys as G} from"@blockcode/core";import{Text as k,Spinner as R0} from"@blockcode/ui";import{ScratchBlocks as W1} from"@blockcode/blocks-editor";import{connectDevice as u1,disconnectDevice as q0,downloadDevice as J0} from"@blockcode/device-pyboard";var $1=[{usbVendorId:12346},{usbVendorId:11914}];var v1="./assets/icon-file-1def53419f4ad0ae.svg";var g1="./assets/icon-edit-2b1e47b495524ed2.svg";var f1="./assets/icon-device-c2fafab2eaccf043.svg";import{jsx as j,Fragment as P1} from"preact/jsx-runtime";var H1=/Mac/i.test(navigator.platform||navigator.userAgent);function X1({newProject:W,openStoreLibrary:Y,setPrompt:Q,setAlert:H,removeAlert:K,extendsMenu:U,deviceFilters:I,onSave:N,onDownload:f=async(...V)=>Promise.all([].concat(...V).map((_)=>Promise.resolve(_)))}={}){let V=()=>{},_=()=>{},w=()=>{};const C=()=>{const J=W1.getMainWorkspace();if(J){J.addChangeListener(()=>{V(J.undoStack_.length===0),_(J.redoStack_.length===0)}),V(J.undoStack_.length===0),_(J.redoStack_.length===0);return}setTimeout(C)};C();const B=(J)=>{if(!B.id)B.id=`download.${Date.now()}`,w(!0);if(J<100){if(H)H({id:B.id,icon:j(R0,{level:"success"}),message:j(k,{id:"blocks.alert.downloading",defaultMessage:"Downloading...{progress}%",progress:J})})}else{if(H)H({id:B.id,icon:null,message:j(k,{id:"blocks.alert.downloadCompleted",defaultMessage:"Download completed."})});setTimeout(()=>{if(K)K(B.id);w(!1),delete B.id},1000)}},D=async(J,P,h)=>{const S=await f(P,h);try{J0(J,S,B)}catch(i){console.error(i)}},m={label:j(P1,{children:[j("img",{src:v1}),j(k,{id:"blocks.menu.file",defaultMessage:"File"})]}),menuItems:[[{label:j(k,{id:"blocks.menu.file.newProject",defaultMessage:"New"}),hotkey:[H1?G.COMMAND:G.CONTROL,G.N],onClick({context:J}){if(J.modified)Q({title:j(k,{id:"gui.projects.notSaved",defaultMessage:"Not saved"}),label:j(k,{id:"gui.projects.replaceProject",defaultMessage:"Replace contents of the current project?"}),onSubmit:W});else W()}}],[{label:j(k,{id:"blocks.menu.file.openProject",defaultMessage:"Open"}),hotkey:[H1?G.COMMAND:G.CONTROL,G.O],onClick(){Y()}},{label:j(k,{id:"blocks.menu.file.saveProject",defaultMessage:"Save"}),hotkey:[H1?G.COMMAND:G.CONTROL,G.S],async onClick({context:J}){let P;const h=W1.getMainWorkspace();if(h)P=await m1.svgAsDataUri(h.getCanvas(),{});if(J.saveNow((S)=>{const i={thumb:P,...S,...N()};return i.fileList=i.fileList.map((Q1)=>({...Q1,script:void 0,content:void 0})),i}),B.id)return;if(J.device&&J.editor.autoDownload)await D(J.device,J.fileList,J.assetList)}}],[{label:j(k,{id:"blocks.menu.file.uploadProject",defaultMessage:"Load from your computer"}),disabled:!0},{label:j(k,{id:"blocks.menu.file.downloadProject",defaultMessage:"save to your computer"}),disabled:!0}]]},u={label:j(P1,{children:[j("img",{src:g1}),j(k,{id:"blocks.menu.edit",defaultMessage:"Edit"})]}),menuItems:[[{label:j(k,{id:"blocks.menu.edit.undo",defaultMessage:"Undo"}),hotkey:[H1?G.COMMAND:G.CONTROL,G.Z],onDisable({setDisable:J}){V=J;const P=W1.getMainWorkspace();if(P)V(P.undoStack_.length===0)},async onClick(J){const P=W1.getMainWorkspace();if(J instanceof MouseEvent&&P)P.undo(!1)}},{label:j(k,{id:"blocks.menu.edit.redo",defaultMessage:"Redo"}),hotkey:H1?[G.SHIFT,G.COMMAND,G.Z]:[G.CONTROL,G.Y],onDisable({setDisable:J}){_=J;const P=W1.getMainWorkspace();if(P)_(P.redoStack_.length===0)},async onClick(J){const P=W1.getMainWorkspace();if(J instanceof MouseEvent&&P)P.undo(!0)}}]]},t={label:j(P1,{children:[j("img",{src:f1}),j(k,{id:"blocks.menu.device",defaultMessage:"Device"})]}),menuItems:[[{label:j(k,{id:"blocks.menu.device.connect",defaultMessage:"Connect your device"}),onLabel({locale:J,context:P}){if(P.device)return J.getText("blocks.menu.device.disconnect","Disconnect this device");return J.getText("blocks.menu.device.connect","Connect your device")},onClick({context:J}){if(J.device){if(q0(J.device,J.connectDevice),B.id){if(K)K(B.id);delete B.id}}else u1(I||$1,J.connectDevice)}},{label:j(k,{id:"blocks.menu.device.download",defaultMessage:"Download program"}),onDisable({setDisable:J}){w=J,w(!!B.id)},async onClick({context:J}){if(B.id)return;let{device:P}=J;if(!P)P=await u1(I||$1,J.connectDevice);await D(P,J.fileList,J.assetList)}}],[{label:j(k,{id:"blocks.menu.device.turnOnAutoDownload",defaultMessage:"Turn on auto download"}),onLabel({locale:J,context:P}){if(P.editor.autoDownload)return J.getText("blocks.menu.device.turnOffAutoDownload","Turn off auto download");return J.getText("blocks.menu.device.turnOnAutoDownload","Turn on auto download")},onDisable({context:J,setDisable:P}){if(!J.device&&J.editor.autoDownload)J.setEditor({autoDownload:!1});P(!J.device)},async onClick({context:J}){J.setEditor({autoDownload:!J.editor.autoDownload})}}]]};U=U||[];const o=(J,P)=>{const h=U.findIndex((S)=>S.id===P);if(h>=0){const[S]=U.splice(h,1);if(S.hidden)return[];if(S.label)J.label=S.label;J.menuItems=[].concat(J.menuItems,S.menuItems)}return J};return[].concat(o(m,"file"),o(u,"edit"),o(t,"device"),U)}var x1={assetList:[{id:"main",type:"text/x-python",content:`
from popsicle.blocks import *
import code1
run()
`}],fileList:[{id:"code1",type:"text/x-python"}]};import{ScratchBlocks as y} from"@blockcode/blocks-editor";var Z=new y.Generator("Python");Z.addReservedWords("False,None,True,and,as,assert,break,class,continue,def,del,elif,else,except,exec,finally,for,from,global,if,import,in,is,lambda,nonlocal,not,or,pass,print,raise,return,try,while,with,yield,NotImplemented,Ellipsis,__debug__,quit,exit,copyright,license,credits,ArithmeticError,AssertionError,AttributeError,BaseException,BlockingIOError,BrokenPipeError,BufferError,BytesWarning,ChildProcessError,ConnectionAbortedError,ConnectionError,ConnectionRefusedError,ConnectionResetError,DeprecationWarning,EOFError,Ellipsis,EnvironmentError,Exception,FileExistsError,FileNotFoundError,FloatingPointError,FutureWarning,GeneratorExit,IOError,ImportError,ImportWarning,IndentationError,IndexError,InterruptedError,IsADirectoryError,KeyError,KeyboardInterrupt,LookupError,MemoryError,ModuleNotFoundError,NameError,NotADirectoryError,NotImplemented,NotImplementedError,OSError,OverflowError,PendingDeprecationWarning,PermissionError,ProcessLookupError,RecursionError,ReferenceError,ResourceWarning,RuntimeError,RuntimeWarning,StandardError,StopAsyncIteration,StopIteration,SyntaxError,SyntaxWarning,SystemError,SystemExit,TabError,TimeoutError,TypeError,UnboundLocalError,UnicodeDecodeError,UnicodeEncodeError,UnicodeError,UnicodeTranslateError,UnicodeWarning,UserWarning,ValueError,Warning,ZeroDivisionError,_,__build_class__,__debug__,__doc__,__import__,__loader__,__name__,__package__,__spec__,abs,all,any,apply,ascii,basestring,bin,bool,buffer,bytearray,bytes,callable,chr,classmethod,cmp,coerce,compile,complex,copyright,credits,delattr,dict,dir,divmod,enumerate,eval,exec,execfile,exit,file,filter,float,format,frozenset,getattr,globals,hasattr,hash,help,hex,id,input,int,intern,isinstance,issubclass,iter,len,license,list,locals,long,map,max,memoryview,min,next,object,oct,open,ord,pow,print,property,quit,range,raw_input,reduce,reload,repr,reversed,round,set,setattr,slice,sorted,staticmethod,str,sum,super,tuple,type,unichr,unicode,vars,xrange,zip");Z.ORDER_ATOMIC=0;Z.ORDER_COLLECTION=1;Z.ORDER_STRING_CONVERSION=1;Z.ORDER_MEMBER=2.1;Z.ORDER_FUNCTION_CALL=2.2;Z.ORDER_EXPONENTIATION=3;Z.ORDER_UNARY_SIGN=4;Z.ORDER_BITWISE_NOT=4;Z.ORDER_MULTIPLICATIVE=5;Z.ORDER_ADDITIVE=6;Z.ORDER_BITWISE_SHIFT=7;Z.ORDER_BITWISE_AND=8;Z.ORDER_BITWISE_XOR=9;Z.ORDER_BITWISE_OR=10;Z.ORDER_RELATIONAL=11;Z.ORDER_LOGICAL_NOT=12;Z.ORDER_LOGICAL_AND=13;Z.ORDER_LOGICAL_OR=14;Z.ORDER_CONDITIONAL=15;Z.ORDER_LAMBDA=16;Z.ORDER_NONE=99;Z.ORDER_OVERRIDES=[[Z.ORDER_FUNCTION_CALL,Z.ORDER_MEMBER],[Z.ORDER_FUNCTION_CALL,Z.ORDER_FUNCTION_CALL],[Z.ORDER_MEMBER,Z.ORDER_MEMBER],[Z.ORDER_MEMBER,Z.ORDER_FUNCTION_CALL],[Z.ORDER_LOGICAL_NOT,Z.ORDER_LOGICAL_NOT],[Z.ORDER_LOGICAL_AND,Z.ORDER_LOGICAL_AND],[Z.ORDER_LOGICAL_OR,Z.ORDER_LOGICAL_OR]];Z.init=(W)=>{if(Z.PASS=Z.INDENT+"pass\n",Z.definitions_=Object.create(null),Z.functionNames_=Object.create(null),!Z.variableDB_)Z.variableDB_=new y.Names(Z.RESERVED_WORDS_);else Z.variableDB_.reset();Z.variableDB_.setVariableMap(W.getVariableMap());const Y=[],Q=W.getAllVariables();for(let K=0;K<Q.length;K++){if(Q[K].type===y.BROADCAST_MESSAGE_VARIABLE_TYPE)continue;let U=Z.variableDB_.getName(Q[K].getId(),y.Variables.NAME_TYPE),I="";if(Q[K].type===y.LIST_VARIABLE_TYPE)U=`${U}_${y.LIST_VARIABLE_TYPE}`,I="[]";Y.push(`${U} = ${I}`)}const H=y.Variables.allDeveloperVariables(W);for(let K=0;K<H.length;K++){let U=Z.variableDB_.getName(H[K],y.Names.DEVELOPER_VARIABLE_TYPE),I="";if(Q[K].type===y.LIST_VARIABLE_TYPE)U=`${U}_${y.LIST_VARIABLE_TYPE}`,I="[]";Y.push(`${U} = ${I}`)}if(Y.length)Z.definitions_.variables=Y.join("\n");Z.definitions_.import_blocks="from blocks import *"};Z.finish=(W)=>{const Y=[],Q=[];for(let K in Z.definitions_){const U=Z.definitions_[K];if(U.match(/^(from\s+\S+\s+)?import\s+\S+/))Y.push(U);else Q.push(U)}return delete Z.definitions_,delete Z.functionNames_,Z.variableDB_.reset(),(Y.join("\n")+"\n\n"+Q.join("\n\n")).replace(/\n\n+/g,"\n\n").replace(/\n*$/,"\n\n\n")+W};Z.scrubNakedValue=(W)=>{return W+"\n"};Z.quote_=(W)=>{W=W.replace(/\\/g,"\\\\").replace(/\n/g,"\\\n").replace(/\%/g,"\\%");let Y='"';if(W.indexOf('"')!==-1)if(W.indexOf("'")===-1)Y="'";else W=W.replace(/"/g,'\\"');return Y+W+Y};Z.scrub_=(W,Y)=>{let Q="";if(!W.outputConnection||!W.outputConnection.targetConnection){let H=W.getCommentText();if(H=y.utils.wrap(H,Z.COMMENT_WRAP-3),H)if(W.getProcedureDef)Q+='"""'+H+'\n"""\n';else Q+=Z.prefixLines(H+"\n","# ");for(let K=0;K<W.inputList.length;K++)if(W.inputList[K].type==y.INPUT_VALUE){const U=W.inputList[K].connection.targetBlock();if(U){const I=Z.allNestedComments(U);if(I)Q+=Z.prefixLines(I,"# ")}}}if(W.startHat_){const H=W.nextConnection&&W.nextConnection.targetBlock();let K=Z.blockToCode(H);if(K)K=Z.prefixLines(K,Z.INDENT),Y=Y.replace(`\n${Z.PASS}`,`\n${K}`);return Q+Y}if(W.parentBlock_){const H=W.nextConnection&&W.nextConnection.targetBlock(),K=Z.blockToCode(H);return Q+Y+K}};Z.getAdjustedInt=(W,Y,Q,H)=>{let K=Q||0;if(W.workspace.options.oneBasedIndex)K--;const U=W.workspace.options.oneBasedIndex?"1":"0",I=K?Z.ORDER_ADDITIVE:Z.ORDER_NONE;let N=Z.valueToCode(W,Y,I)||U;if(y.isNumber(N)){if(N=parseInt(N,10)+K,H)N=-N}else{if(K>0)N="int("+N+" + "+K+")";else if(K<0)N="int("+N+" - "+-K+")";else N="int("+N+")";if(H)N="-"+N}return N};Z.hatToCode=(W="",...Y)=>{if(!Z.functionNames_[W])Z.functionNames_[W]=0;Z.functionNames_[W]+=1;const Q=`${W}_${Z.functionNames_[W]}`;return Z.HAT_FUNCTION_PLACEHOLDER=Q,`async def ${Q}(${Y.join(", ")}):\n  this_func = ${Q}\n${Z.PASS}\n`};var R1="  await runtime.next_frame()\n";Z.control_wait=(W)=>{let Y="";if(Z.STATEMENT_PREFIX)Y+=Z.injectId(Z.STATEMENT_PREFIX,W);const Q=Z.valueToCode(W,"DURATION",Z.ORDER_NONE)||0;return Y+=`await runtime.wait_for(num(${Q}))\n`,Y};Z.control_repeat=(W)=>{let Y="";if(Z.STATEMENT_PREFIX)Y+=Z.injectId(Z.STATEMENT_PREFIX,W);let Q=Z.statementToCode(W,"SUBSTACK")||Z.PASS;if(Z.STATEMENT_SUFFIX)Q=Z.prefixLines(Z.injectId(Z.STATEMENT_SUFFIX,W),Z.INDENT)+Q;const H=Z.valueToCode(W,"TIMES",Z.ORDER_NONE)||10;return Y+=`for _ in range(num(${H})):\n${Q}${R1}`,Y};Z.control_forever=(W)=>{let Y="";if(Z.STATEMENT_PREFIX)Y+=Z.injectId(Z.STATEMENT_PREFIX,W);let Q=Z.statementToCode(W,"SUBSTACK")||Z.PASS;if(Z.STATEMENT_SUFFIX)Q=Z.prefixLines(Z.injectId(Z.STATEMENT_SUFFIX,W),Z.INDENT)+Q;return Y+=`while True:\n${Q}${R1}`,Y};Z.control_if=(W)=>{let Y="";if(Z.STATEMENT_PREFIX)Y+=Z.injectId(Z.STATEMENT_PREFIX,W);let Q=Z.statementToCode(W,"SUBSTACK")||Z.PASS;if(Z.STATEMENT_SUFFIX)Q=Z.prefixLines(Z.injectId(Z.STATEMENT_SUFFIX,W),Z.INDENT)+Q;const H=Z.valueToCode(W,"CONDITION",Z.ORDER_NONE)||"False";if(Y+=`if ${H}:\n${Q}`,W.getInput("SUBSTACK2")){if(Q=Z.statementToCode(W,"SUBSTACK2")||Z.PASS,Z.STATEMENT_SUFFIX)Q=Z.prefixLines(Z.injectId(Z.STATEMENT_SUFFIX,W),Z.INDENT)+Q;Y+=`else:\n${Q}`}return Y};Z.control_if_else=Z.control_if;Z.control_wait_until=(W)=>{let Y="";if(Z.STATEMENT_PREFIX)Y+=Z.injectId(Z.STATEMENT_PREFIX,W);const Q=Z.valueToCode(W,"CONDITION",Z.ORDER_NONE)||"False";return Y+=`while not ${Q}:${R1}`,Y};Z.control_repeat_until=(W)=>{let Y="";if(Z.STATEMENT_PREFIX)Y+=Z.injectId(Z.STATEMENT_PREFIX,W);let Q=Z.statementToCode(W,"SUBSTACK")||Z.PASS;if(Z.STATEMENT_SUFFIX)Q=Z.prefixLines(Z.injectId(Z.STATEMENT_SUFFIX,W),Z.INDENT)+Q;const H=Z.valueToCode(W,"CONDITION",Z.ORDER_NONE)||"False";return Y+=`while not ${H}:\n${Q}${R1}`,Y};Z.control_while=(W)=>{let Y="";if(Z.STATEMENT_PREFIX)Y+=Z.injectId(Z.STATEMENT_PREFIX,W);let Q=Z.statementToCode(W,"SUBSTACK")||Z.PASS;if(Z.STATEMENT_SUFFIX)Q=Z.prefixLines(Z.injectId(Z.STATEMENT_SUFFIX,W),Z.INDENT)+Q;const H=Z.valueToCode(W,"CONDITION",Z.ORDER_NONE)||"False";return Y+=`while ${H}:\n${Q}${R1}`,Y};Z.control_stop=(W)=>{let Y="";if(Z.STATEMENT_PREFIX)Y+=Z.injectId(Z.STATEMENT_PREFIX,W);switch(W.getFieldValue("STOP_OPTION")){case"all":Y+="runtime.stop()\n";break;case"this script":Y+="return\n";break;case"other scripts in sprite":Y+="runtime.stop_tasks(this_func)\n";break}return Y};import{ScratchBlocks as V1} from"@blockcode/blocks-editor";Z.data_variable=(W)=>{return[Z.variableDB_.getName(W.getFieldValue("VARIABLE"),V1.Variables.NAME_TYPE),Z.ORDER_ATOMIC]};Z.data_setvariableto=(W)=>{let Y="";if(javascriptGenerator.STATEMENT_PREFIX)Y+=javascriptGenerator.injectId(javascriptGenerator.STATEMENT_PREFIX,W);const Q=Z.variableDB_.getName(W.getFieldValue("VARIABLE"),V1.Variables.NAME_TYPE),H=Z.valueToCode(W,"VALUE",Z.ORDER_NONE)||'""';return Y+=`${Q} = ${H}\n`,Y};Z.data_changevariableby=(W)=>{let Y="";if(javascriptGenerator.STATEMENT_PREFIX)Y+=javascriptGenerator.injectId(javascriptGenerator.STATEMENT_PREFIX,W);const Q=Z.variableDB_.getName(W.getFieldValue("VARIABLE"),V1.Variables.NAME_TYPE),H=Z.valueToCode(W,"VALUE",Z.ORDER_NONE)||0;return Y+=`${Q} = num(${Q}) + num(${H})\n`,Y};Z.data_listcontents=(W)=>{};Z.data_addtolist=(W)=>{};Z.data_deleteoflist=(W)=>{};Z.data_deletealloflist=(W)=>{};Z.data_insertatlist=(W)=>{};Z.data_replaceitemoflist=(W)=>{};Z.data_itemoflist=(W)=>{};Z.data_itemnumoflist=(W)=>{};Z.data_lengthoflist=(W)=>{};Z.data_listcontainsitem=(W)=>{};import{ScratchBlocks as G1} from"@blockcode/blocks-editor";Z.event_whenflagclicked=(W)=>{return`${Z.hatToCode("start")}runtime.when_start(${Z.HAT_FUNCTION_PLACEHOLDER})\n`};Z.event_whengreaterthan=(W)=>{const Y=W.getFieldValue("WHENGREATERTHANMENU"),Q=Z.valueToCode(W,"VALUE",Z.ORDER_NONE)||0;return`${Z.hatToCode("greaterthen")}runtime.when_greaterthen("${Y}", num(${Q}), ${Z.HAT_FUNCTION_PLACEHOLDER})\n`};Z.event_whenbroadcastreceived=(W)=>{const Y=Z.variableDB_.getName(W.getFieldValue("BROADCAST_OPTION"),G1.Variables.NAME_TYPE);return`${Z.hatToCode("broadcastreceived")}runtime.when_broadcastreceived("${Y}", ${Z.HAT_FUNCTION_PLACEHOLDER})\n`};Z.event_broadcast_menu=(W)=>{return[Z.variableDB_.getName(W.getFieldValue("BROADCAST_OPTION"),G1.Variables.NAME_TYPE),Z.ORDER_ATOMIC]};Z.event_broadcast=(W)=>{return`runtime.broadcast("${Z.valueToCode(W,"BROADCAST_INPUT",Z.ORDER_NONE)||'"message1"'}")\n`};Z.event_broadcastandwait=(W)=>{return`await runtime.broadcast("${Z.valueToCode(W,"BROADCAST_INPUT",Z.ORDER_NONE)||'"message1"'}")\n`};Z.addReservedWords("math,random,Number");Z.math_number=(W)=>{let Y=parseFloat(W.getFieldValue("NUM")),Q;if(Y===Infinity)Y='float("inf")',Q=Z.ORDER_FUNCTION_CALL;else if(Y===(-Infinity))Y='-float("inf")',Q=Z.ORDER_UNARY_SIGN;else if(Number.isNaN(Y))Y='float("nan")',Q=Z.ORDER_UNARY_SIGN;else Q=Y<0?Z.ORDER_UNARY_SIGN:Z.ORDER_ATOMIC;return[Y,Q]};Z.math_integer=(W)=>{const Y=parseInt(W.getFieldValue("NUM")),Q=Y<0?Z.ORDER_UNARY_SIGN:Z.ORDER_ATOMIC;return[Y,Q]};Z.math_whole_number=(W)=>{return[Math.abs(parseInt(W.getFieldValue("NUM"))),Z.ORDER_ATOMIC]};Z.math_positive_number=(W)=>{let Y=parseFloat(W.getFieldValue("NUM")),Q;if(Y===Infinity)Y='float("inf")',Q=Z.ORDER_FUNCTION_CALL;else if(Y===(-Infinity))Y='-float("inf")',Q=Z.ORDER_FUNCTION_CALL;else if(Number.isNaN(Y))Y='float("nan")',Q=Z.ORDER_FUNCTION_CALL;else Y=Y<0?0:Y,Q=Z.ORDER_ATOMIC;return[Y,Q]};Z.math_angle=(W)=>{let Y=parseFloat(W.getFieldValue("NUM")),Q;if(Y==Infinity)Y='float("inf")',Q=Z.ORDER_FUNCTION_CALL;else if(Y==(-Infinity))Y='-float("inf")',Q=Z.ORDER_UNARY_SIGN;else Y=Y%360,Y=Y<0?Y+360:Y,Q=Z.ORDER_ATOMIC;return[Y,Q]};Z.operator_add=(W)=>{const Y=Z.valueToCode(W,"NUM1",Z.ORDER_NONE)||0,Q=Z.valueToCode(W,"NUM2",Z.ORDER_NONE)||0;return[`(num(${Y}) + num(${Q}))`,Z.ORDER_SUBTRACTION]};Z.operator_subtract=(W)=>{const Y=Z.valueToCode(W,"NUM1",Z.ORDER_NONE)||0,Q=Z.valueToCode(W,"NUM2",Z.ORDER_NONE)||0;return[`(num(${Y}) - num(${Q}))`,Z.ORDER_SUBTRACTION]};Z.operator_multiply=(W)=>{const Y=Z.valueToCode(W,"NUM1",Z.ORDER_NONE)||0,Q=Z.valueToCode(W,"NUM2",Z.ORDER_NONE)||0;return[`(num(${Y}) * num(${Q}))`,Z.ORDER_SUBTRACTION]};Z.operator_divide=(W)=>{const Y=Z.valueToCode(W,"NUM1",Z.ORDER_NONE)||0,Q=Z.valueToCode(W,"NUM2",Z.ORDER_NONE)||0;return[`(num(${Y}) / num(${Q}))`,Z.ORDER_SUBTRACTION]};Z.operator_random=(W)=>{const Y=Z.valueToCode(W,"FROM",Z.ORDER_NONE)||0,Q=Z.valueToCode(W,"TO",Z.ORDER_NONE)||0;return[`runtime.random(${Y}, ${Q})`,Z.ORDER_FUNCTION_CALL]};Z.operator_gt=(W)=>{const Y=Z.valueToCode(W,"OPERAND1",Z.ORDER_NONE)||0,Q=Z.valueToCode(W,"OPERAND2",Z.ORDER_NONE)||0;return[`(num(${Y}) > num(${Q}))`,Z.ORDER_RELATIONAL]};Z.operator_lt=(W)=>{const Y=Z.valueToCode(W,"OPERAND1",Z.ORDER_NONE)||0,Q=Z.valueToCode(W,"OPERAND2",Z.ORDER_NONE)||0;return[`(num(${Y}) < num(${Q}))`,Z.ORDER_RELATIONAL]};Z.operator_equals=(W)=>{const Y=Z.valueToCode(W,"OPERAND1",Z.ORDER_NONE)||0,Q=Z.valueToCode(W,"OPERAND2",Z.ORDER_NONE)||0;return[`(num(${Y}) == num(${Q}) or str(${Y}) == str(${Q}))`,Z.ORDER_RELATIONAL]};Z.operator_and=(W)=>{const Y=Z.valueToCode(W,"OPERAND1",Z.ORDER_NONE)||"False",Q=Z.valueToCode(W,"OPERAND2",Z.ORDER_NONE)||"False";return[`(${Y} and ${Q})`,Z.ORDER_LOGICAL_AND]};Z.operator_or=(W)=>{const Y=Z.valueToCode(W,"OPERAND1",Z.ORDER_NONE)||"False",Q=Z.valueToCode(W,"OPERAND2",Z.ORDER_NONE)||"False";return[`(${Y} or ${Q})`,Z.ORDER_LOGICAL_OR]};Z.operator_not=(W)=>{return[`(not ${Z.valueToCode(W,"OPERAND",Z.ORDER_NONE)||"False"})`,Z.ORDER_LOGICAL_NOT]};Z.operator_join=(W)=>{const Y=Z.valueToCode(W,"STRING1",Z.ORDER_NONE)||'""',Q=Z.valueToCode(W,"STRING2",Z.ORDER_NONE)||'""';return[`(str(${Y}) + str(${Q}))`,Z.ORDER_ATOMIC]};Z.operator_letter_of=(W)=>{const Y=Z.valueToCode(W,"LETTER",Z.ORDER_NONE)||0;return[`(str(${Z.valueToCode(W,"STRING",Z.ORDER_NONE)||'""'})[num(${Y}) - 1] || "")`,Z.ORDER_MEMBER]};Z.operator_length=(W)=>{return[`len(str(${Z.valueToCode(W,"STRING",Z.ORDER_NONE)||'""'}))`,Z.ORDER_FUNCTION_CALL]};Z.operator_contains=(W)=>{const Y=Z.valueToCode(W,"STRING1",Z.ORDER_NONE)||'""',Q=Z.valueToCode(W,"STRING2",Z.ORDER_NONE)||'""';return[`(str(${Y}).count(str(${Q})) > 0)`,Z.ORDER_FUNCTION_CALL]};Z.operator_mod=(W)=>{const Y=Z.valueToCode(W,"NUM1",Z.ORDER_NONE)||0,Q=Z.valueToCode(W,"NUM2",Z.ORDER_NONE)||0;return[`(num(${Y}) % num(${Q}))`,Z.ORDER_MODULUS]};Z.operator_round=(W)=>{return Z.definitions_.import_math="import math",[`math.round(num(${Z.valueToCode(W,"NUM",Z.ORDER_NONE)||0}))`,Z.ORDER_FUNCTION_CALL]};Z.operator_mathop=(W)=>{Z.definitions_.import_math="import math";const Y=Z.valueToCode(W,"NUM",Z.ORDER_NONE)||0,Q=W.getFieldValue("OPERATOR");let H="";if(Q==="ceiling")H+=`math.ceil(num(${Y}))`;else if(Q==="sin"||Q==="cos"||Q==="tan")H+=`math.${Q}(math.radians(num(${Y})))`;else if(Q==="asin"||Q==="acos"||Q==="atan")H+=`math.degrees(math.${Q}(num(${Y})))`;else if(Q==="ln")H+=`(math.log(num(${Y}))`;else if(Q==="log")H+=`(math.log10(num(${Y}))`;else if(Q==="e ^")H+=`math.exp(num(${Y}))`;else if(Q==="10 ^")H+=`math.pow(10, num(${Y}))`;else H+=`math.${Q}(num(${Y}))`;return[H,Z.ORDER_FUNCTION_CALL]};Z.procedures_definition=(W)=>{};Z.procedures_call=(W)=>{};Z.procedures_prototype=(W)=>{};Z.procedures_declaration=(W)=>{};Z.argument_reporter_boolean=(W)=>{};Z.argument_reporter_string_number=(W)=>{};Z.argument_editor_boolean=(W)=>{};Z.argument_editor_string_number=(W)=>{};Z.sensing_timer=(W)=>{return["runtime.time",Z.ORDER_MEMBER]};Z.sensing_resettimer=(W)=>{return"runtime.reset_timer()\n"};Z.text=(W)=>{const Y=W.getFieldValue("TEXT");return[isNaN(Y)?Z.quote_(Y):+Y,Z.ORDER_ATOMIC]};import{useState as M1} from"preact/hooks";import{useLocale as S0,useEditor as _0} from"@blockcode/core";import{classNames as w0} from"@blockcode/ui";import{BlocksEditor as L0,ScratchBlocks as n,makeToolboxXML as C0} from"@blockcode/blocks-editor";import{ScratchBlocks as K0,blockSeparator as F0} from"@blockcode/blocks-editor";var N0=1,U0=2,$0=3,k1="#0FBD8C",b1="#0DA57A",P0="#0B8E69",J1=(W,Y)=>{if(typeof W==="string")return W;if(W.props.children)return W.props.children.map((Q)=>J1(Q,Y)).join(" ");return Y(W.props.id,W.props)},r=(W)=>{if(typeof W!=="string")if(Array.isArray(W))W=String(W);else return W;return W.replace(/[<>&'"]/g,(Y)=>{switch(Y){case"<":return"&lt;";case">":return"&gt;";case"&":return"&amp;";case"'":return"&apos;";case'"':return"&quot;"}})};function A1(W,Y){const{id:Q}=W,H=J1(W.name,Y);let K=`<category name="${r(H)}" id="${r(Q)}"`;if(K+=` colour="${r(W.themeColor||k1)}"`,K+=` secondaryColour="${r(W.inputColor||b1)}"`,W.iconURI)K+=` iconURI="${r(W.iconURI)}"`;return K+=">\n",W.blocks.forEach((U)=>{if(U==="---")return K+=`${F0}\n`,K;const I=`${Q}_${U.id.toLowerCase()}`,N={message0:J1(U.text,Y),category:Q,outputShape:$0,colour:W.themeColor||k1,colourSecondary:W.inputColor||b1,colourTertiary:W.otherColor||P0};let f=1;if(W.iconURI)N.message0=`%1 %2 ${N.message0}`,N.args0=[{type:"field_image",src:W.iconURI,width:40,height:40},{type:"field_vertical_separator"}],N.extensions=["scratch_extension"],f+=2;if(U.hat)N.nextStatement=null;else if(U.output)if(U.output==="boolean")N.output="Boolean",N.outputShape=N0;else N.output="String",N.outputShape=U0;else N.previousStatement=null,N.nextStatement=null;let V=`<block type="${r(I)}">\n`;if(U.inputs)N.args0=[].concat(N.args0||[],Object.entries(U.inputs).map(([_,w])=>{const C={name:_,type:"input_value"};if(w.menu)C.type="field_dropdown",C.options=w.menu.map(([B,D])=>[J1(B,Y),D]);else if(w.type==="boolean")C.check="Boolean";else{if(V+=`<value name="${r(_)}">\n`,w.type==="number")V+='<shadow type="math_number">\n',V+='<field name="NUM">';else if(w.type==="angle")V+='<shadow type="math_angle">\n',V+='<field name="NUM">';else V+=`<shadow type="${r(w.type)}">\n`,V+=`<field name="${r(w.type.toUpperCase())}">`;V+=`${r(w.default)}</field>\n`,V+="</shadow>\n",V+="</value>"}return N.message0=N.message0.replace(`[${_}]`,`%${f++}`),C}));if(K0.Blocks[I]={init(){this.jsonInit(N)}},U.python)Z[I]=U.python.bind(Z);else Z[I]=()=>"";V+="</block>\n",K+=V}),K+="</category>\n",K}import{useRef as X0,useEffect as V0,useState as d1} from"preact/hooks";import{classNames as A0,Text as Y1,Button as y1,Modal as E0,BufferedInput as D0} from"@blockcode/ui";function e(W){const Y=globalThis.document,Q=Y.createElement("style");Q.appendChild(Y.createTextNode(W)),Y.head.append(Q)}e(".R1cW-q_prompt-modal{width:360px}.R1cW-q_prompt-content{background:var(--ui-white);padding:1.5rem 2.25rem}.R1cW-q_prompt-content input[type=checkbox],.R1cW-q_prompt-content input[type=radio]{margin:3px}.R1cW-q_label{margin:0 0 .75rem;font-weight:500}.R1cW-q_variable-name-text-input{border:1px solid var(--ui-black-transparent);color:var(--text-primary-transparent);border-radius:5px;width:100%;height:3rem;margin-bottom:1.5rem;padding:0 1rem;font-size:.875rem}.R1cW-q_info-message{text-align:center;margin-bottom:1.5rem;font-size:.875rem;font-weight:400}.R1cW-q_options{justify-content:space-between;margin-bottom:1.5rem;font-weight:400;display:flex}.R1cW-q_button-row{text-align:right;font-weight:bolder}.R1cW-q_button{padding:.75rem 1rem;font-size:.85rem;font-weight:600}.R1cW-q_ok-button{background:var(--motion-primary);border:var(--motion-primary);color:var(--ui-white);margin-left:var(--space)}");var p={variableNameTextInput:"R1cW-q_variable-name-text-input",promptContent:"R1cW-q_prompt-content",buttonRow:"R1cW-q_button-row",okButton:"R1cW-q_ok-button",promptModal:"R1cW-q_prompt-modal",label:"R1cW-q_label",infoMessage:"R1cW-q_info-message",button:"R1cW-q_button",options:"R1cW-q_options"};import{jsx as v} from"preact/jsx-runtime";function E1({title:W,label:Y,defaultValue:Q,enableLocalVariable:H,showListMessage:K,showVariableOptions:U,showCloudOption:I,onClose:N,onSubmit:f}){const V=X0(null),[_,w]=d1(Q),[C,B]=d1({scope:"global",isCloud:!1}),D=()=>{f(_,C)},m=(u)=>{if(u.key==="Escape")N();if(u.key==="Enter")f(V.current.base.value,C)};return V0(()=>{if(V.current)V.current.base.focus(),window.addEventListener("keydown",m);return()=>{window.removeEventListener("keydown",m)}},[V]),v(E0,{title:W,className:p.promptModal,onClose:N,children:v("div",{className:p.promptContent,children:[v("div",{className:p.label,children:Y}),v(D0,{autoFocus:!0,forceFocus:!0,ref:V,className:p.variableNameTextInput,defaultValue:_,onSubmit:w}),U&&v("div",{children:H?v("div",{className:p.options,children:[v("label",{children:[v("input",{checked:C.scope==="global",name:"variableScopeOption",type:"radio",value:"global",onChange:()=>B({...C,scope:"global"})}),v(Y1,{id:"blocks.dataPrompt.forAllTargets",defaultMessage:"For all targets"})]}),v("label",{children:[v("input",{checked:C.scope==="local",name:"variableScopeOption",type:"radio",value:"local",onChange:()=>B({...C,scope:"local"})}),v(Y1,{id:"blocks.dataPrompt.forThisTarget",defaultMessage:"For this target only"})]})]}):v("div",{className:p.infoMessage,children:K?v(Y1,{id:"blocks.dataPrompt.listAvailableToAllTargets",defaultMessage:"This list will be available to all targets."}):v(Y1,{id:"blocks.dataPrompt.availableToAllTargets",defaultMessage:"This variable will be available to all targets."})})}),v("div",{className:p.buttonRow,children:[v(y1,{className:p.button,onClick:N,children:v(Y1,{id:"blocks.dataPrompt.cancel",defaultMessage:"Cancel"})}),v(y1,{className:A0(p.button,p.okButton),onClick:D,children:v(Y1,{id:"blocks.dataPrompt.ok",defaultMessage:"OK"})})]})]})})}import{useEffect as M0,useState as i1} from"preact/hooks";import{useLocale as I0,useEditor as m6} from"@blockcode/core";import{Library as B0} from"@blockcode/ui";var h1=["servo","pen","request","text"].map(async(W)=>{const{default:Y}=await import(`@blockcode/extension-${W}`);return Y.id=W,Y});import{jsx as O0} from"preact/jsx-runtime";var T0=Promise.all(h1);function D1({onSelect:W,onClose:Y,onFilter:Q,onShowPrompt:H,onShowAlert:K,onHideAlert:U}){const[I,N]=i1([]),[f,V]=i1(!1),{language:_,getText:w}=I0(),C=(B)=>{if(Q){const D=B.tags||[],m=Q(D);if(Array.isArray(m))return m.every((u)=>{if(Array.isArray(u))return u.some((t)=>D.includes(t));return D.includes(u)});return m}return!0};return M0(()=>{T0.then((B)=>{N(B.filter(C).map((D)=>Object.assign({...D,featured:!0,onSelect:async()=>{K("importing",{id:D.id});const{default:m}=await import(`@blockcode/extension-${D.id}/blocks`);m.id=D.id,W(m),U(D.id),Y()}},D.translations&&D.translations[_]?{name:D.translations[_].name||D.name,description:D.translations[_].description||D.description,collaborator:D.translations[_].collaborator||D.collaborator}:{}))),V(!1)})},[]),O0(B0,{loading:f,items:I,title:w("blocks.extensions.addExtension","Add Extension"),emptyText:w("blocks.extensions.empty","No extension!"),onClose:Y})}e(".OF790G_editor-wrapper{border-radius:inherit;width:100%;height:100%;position:relative}.OF790G_extension-button{z-index:var(--z-index-extension-button);background:var(--motion-primary);border:1px solid var(--motion-primary);box-sizing:content-box;border-bottom-left-radius:inherit;border-top:0;height:3.25rem;position:absolute;bottom:-1px;left:-1px}.OF790G_extension-button:before{--fade-out-distance:15px;content:\"\";top:calc(calc(-1*var(--fade-out-distance)));height:var(--fade-out-distance);background:linear-gradient(#0000,#00000026);position:absolute;left:0;right:0}.OF790G_add-button{cursor:pointer;background:0 0;border:none;outline:none;width:100%;height:100%}.OF790G_add-button img{width:1.75rem;height:1.75rem}");var K1={extensionButton:"OF790G_extension-button",addButton:"OF790G_add-button",editorWrapper:"OF790G_editor-wrapper"};var p1="./assets/icon-extension-5ec2ee35b87b4126.svg";import{jsx as Z1} from"preact/jsx-runtime";var s1=new Map;function F1({toolbox:W,messages:Y,enableMultiTargets:Q,enableLocalVariable:H,disableGenerator:K,disableExtension:U,onChange:I,onExtensionsFilter:N,onLoadExtension:f,onShowPrompt:V,onShowAlert:_,onHideAlert:w,onReady:C}){const{addLocaleData:B,getText:D}=S0(),{editor:m,fileList:u,selectedIndex:t,openFile:o,modifyFile:J}=_0(),[P,h]=M1(),[S,i]=M1(!1),[Q1,z1]=M1(!1);if(m.splash){let E=!0;if(u.length>1){for(let L=0;L>-u.length;L--)if(!u.at(L).content){E=!1,setTimeout(()=>{o((L+u.length)%u.length)},100);break}}if(E&&typeof m.splash==="boolean")m.splash=setTimeout(C,100)}Y={EVENT_WHENPROGRAMSTART:D("blocks.event.programStart","when program start"),CONTROL_STOP_OTHER:D("blocks.control.stopOther","other scripts"),...Y||[]},n.prompt=(E,L,g,b,d)=>{const T={callback:g,message:E,defaultValue:L};T.title=b?b:n.Msg.VARIABLE_MODAL_TITLE,T.varType=typeof d==="string"?d:n.SCALAR_VARIABLE_TYPE,T.showVariableOptions=Q&&d!==n.BROADCAST_MESSAGE_VARIABLE_TYPE&&T.title!==n.Msg.RENAME_VARIABLE_MODAL_TITLE&&T.title!==n.Msg.RENAME_LIST_MODAL_TITLE,T.showCloudOption=d===n.SCALAR_VARIABLE_TYPE&&this.props.canUseCloud,i(T)};let $;if(P)$=P.getAllVariables().filter((E)=>{if(E.isLocal)return!1;if(E.type===n.BROADCAST_MESSAGE_VARIABLE_TYPE){if(E.name===n.Msg.DEFAULT_BROADCAST_MESSAGE_NAME)return!1;const L=E.id_.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),g=new RegExp(`<field name="BROADCAST_OPTION" id="${L}"[^>]+>[^<]+</field>`,"g");for(let b of u)if(g.test(b.xml))return!0;return!1}return!0});let R=W||C0();s1.forEach((E)=>{R+=A1(E,D)});const q=(E,L)=>{let g;if(!K)g=Z.workspaceToCode(L);if(J({xml:E,content:g}),I)I(E,L)},z=(E,L)=>{S.callback(E,[],L),i(!1)},F=()=>i(!1),A=()=>z1(!0),M=()=>z1(!1),O=(E)=>{if(B(E.translations),f)f(E);s1.set(E.id,E),setTimeout(()=>{P.toolbox_.setSelectedCategoryById(E.id)},10)};return Z1("div",{className:K1.editorWrapper,children:[Z1(L0,{toolbox:R,messages:Y,globalVariables:$,onWorkspaceCreated:h,onChange:t!==-1?q:null}),U?null:Z1("div",{className:w0("scratchCategoryMenu",K1.extensionButton),children:Z1("button",{className:K1.addButton,title:D("blocks.extensions.addExtension","Add Extension"),onClick:A,children:Z1("img",{src:p1,title:"Add Extension"})})}),S&&Z1(E1,{title:S.title,label:S.message,defaultValue:S.defaultValue,enableLocalVariable:H,showListMessage:S.varType===n.LIST_VARIABLE_TYPE,showVariableOptions:S.showVariableOptions,showCloudOption:S.showCloudOption,onClose:F,onSubmit:z}),Q1&&Z1(D1,{onFilter:N,onSelect:O,onClose:M,onShowPrompt:V,onShowAlert:_,onHideAlert:w})]})}e(".GS2oYa_pane{height:8rem}");var l1={pane:"GS2oYa_pane"};import{jsx as v0} from"preact/jsx-runtime";function I1(){return v0("div",{className:l1.pane})}var c1="./assets/icon-blocks-d7e4a3a3eb74d0fb.svg";var a1={"blocks.menu.file":"File","blocks.menu.file.newProject":"New","blocks.menu.file.openProject":"Open","blocks.menu.file.saveProject":"Save","blocks.menu.file.uploadProject":"Load from your computer","blocks.menu.file.downloadProject":"Save to your computer","blocks.menu.edit":"Edit","blocks.menu.edit.undo":"Undo","blocks.menu.edit.redo":"Redo","blocks.menu.device":"Device","blocks.menu.device.connect":"Connect to your device","blocks.menu.device.disconnect":"Disconnect this device","blocks.menu.device.download":"Download program","blocks.menu.device.turnOnAutoDownload":"Turn on Auto Download","blocks.menu.device.turnOffAutoDownload":"Turn off Auto Download","blocks.alert.downloading":"Downloading...{progress}%","blocks.alert.downloadCompleted":"Download completed.","blocks.codeTab":"Code","blocks.backpackPane.title":"Backpack","blocks.downloadToDevice":"Download","blocks.extensions.addExtension":"Add Extension","blocks.extensions.empty":"No extension!","blocks.dataPrompt.forAllTargets":"For all targets","blocks.dataPrompt.forThisTarget":"For this target only","blocks.dataPrompt.availableToAllTargets":"This variable will be available to all targets.","blocks.dataPrompt.listAvailableToAllTargets":"This list will be available to all targets.","blocks.dataPrompt.cancel":"Cancel","blocks.dataPrompt.ok":"OK","blocks.event.programStart":"when program start","blocks.control.stopOther":"other scripts"};var r1={"blocks.menu.file":"\u6587\u4EF6","blocks.menu.file.newProject":"\u65B0\u4F5C\u54C1","blocks.menu.file.openProject":"\u6253\u5F00","blocks.menu.file.saveProject":"\u4FDD\u5B58","blocks.menu.file.uploadProject":"\u4ECE\u7535\u8111\u4E2D\u6253\u5F00","blocks.menu.file.downloadProject":"\u4FDD\u5B58\u5230\u7535\u8111","blocks.menu.edit":"\u7F16\u8F91","blocks.menu.edit.undo":"\u64A4\u9500","blocks.menu.edit.redo":"\u6062\u590D","blocks.menu.device":"\u8BBE\u5907","blocks.menu.device.connect":"\u8FDE\u63A5\u8BBE\u5907","blocks.menu.device.disconnect":"\u65AD\u5F00\u8BBE\u5907\u8FDE\u63A5","blocks.menu.device.download":"\u4E0B\u8F7D\u7A0B\u5E8F","blocks.menu.device.turnOnAutoDownload":"\u6253\u5F00\u81EA\u52A8\u4E0B\u8F7D","blocks.menu.device.turnOffAutoDownload":"\u5173\u95ED\u81EA\u52A8\u4E0B\u8F7D","blocks.alert.downloading":"\u6B63\u5728\u4E0B\u8F7D\u2026{progress}%","blocks.alert.downloadCompleted":"\u4E0B\u8F7D\u5B8C\u6210\u3002","blocks.codeTab":"\u4EE3\u7801","blocks.backpackPane.title":"\u4E66\u5305","blocks.downloadToDevice":"\u4E0B\u8F7D","blocks.extensions.addExtension":"\u6DFB\u52A0\u6269\u5C55","blocks.extensions.empty":"\u6CA1\u6709\u6269\u5C55\uFF01","blocks.dataPrompt.forAllTargets":"\u9002\u7528\u4E8E\u5168\u5C40","blocks.dataPrompt.forThisTarget":"\u4EC5\u9002\u7528\u4E8E\u5F53\u524D","blocks.dataPrompt.availableToAllTargets":"\u5168\u5C40\u90FD\u53EF\u4F7F\u7528\u8BE5\u53D8\u91CF\u3002","blocks.dataPrompt.listAvailableToAllTargets":"\u5168\u5C40\u90FD\u53EF\u4F7F\u7528\u8BE5\u5217\u8868\u3002","blocks.dataPrompt.cancel":"\u53D6\u6D88","blocks.dataPrompt.ok":"\u786E\u5B9A","blocks.event.programStart":"\u5F53\u7A0B\u5E8F\u5F00\u59CB\u8FD0\u884C","blocks.control.stopOther":"\u5176\u4ED6\u811A\u672C"};import{jsx as B1} from"preact/jsx-runtime";var f0={en:a1,"zh-Hans":r1},u0={icon:c1,label:B1(n1,{id:"blocks.codeTab",defaultMessage:"Code"}),Content:F1},A9={label:B1(n1,{id:"blocks.backpackPane.title",defaultMessage:"Backpack"}),Content:I1};function m0({addLocaleData:W,setLayout:Y,openStoreLibrary:Q,closeStoreLibrary:H,setPrompt:K,setAlert:U,removeAlert:I,hideSplashScreen:N,openProject:f}){W(f0);const V=()=>{f(Object.assign({selectedIndex:0},x1))};V(),Y({menus:X1({openStoreLibrary:Q,closeStoreLibrary:H,newProject:V,setPrompt:K,setAlert:U,removeAlert:I}),tabs:[{...u0,Content:()=>B1(F1,{onShowPrompt:K,onShowAlert:U,onHideAlert:I,onReady:N})}],sidebars:[],pane:!1,tutorials:!0,canEditProjectName:!0})}export{Z as pythonGenerator,X1 as makeMenus,f0 as locales,m0 as default,u0 as CodeTab,A9 as BackpackPane};
